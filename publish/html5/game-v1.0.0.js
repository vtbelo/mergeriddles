(function () {var projects={default:{languages:["en","fr","ru","de","es","pt","it","nl","ar","ja","ko","tr","zh","pl","lv"],boardgame:{languages:["en","fr","ru","de","es","it","ja","nl"]},leagues:[30,60,100,200,500,1e3,!1],terms:"https://cleverappssg.com/legal/terms.html",privacy:"https://cleverappssg.com/legal/privacy.html"},mergecraft:{basic:{type:"merge",metha:"none",title:"MergeCraft",fakeRestApiURL:"http://localhost:3006",languages:["en"],adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://mergecraft-staging.labsystech.ru/publish/html5-staging/",deployment:"https://mergecraft-staging.labsystech.ru"}},facebook:{shortname:"mergecraft",appId:"365815270676633",groupId:"rachelholmesfinddifferences",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"365815270676633"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{id:""}},wondermerge:{basic:{type:"merge",metha:"none",title:"WonderMerge",fakeRestApiURL:"http://localhost:3012",languages:["en"],
adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://wondermerge-staging.labsystech.ru/publish/html5-staging/",deployment:"https://wondermerge-staging.labsystech.ru"}},facebook:{shortname:"cleverwondermerge",appId:"699542957221997",groupId:"rachelholmesfinddifferences",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"699542957221997"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{id:""}},mergeriddles:{basic:{type:"match3",metha:"simple",staticUrl:"https://mergecraft.cleverappssg.com/publish/html5/",deployment:"https://mergecraft.cleverappssg.com",title:"MergeRiddles",lives:!0,fakeRestApiURL:"http://localhost:3015",languages:["en"],adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://mergecraft-staging.labsystech.ru/publish/html5-staging/",deployment:"https://mergecraft-staging.labsystech.ru"}},facebook:{shortname:"mergecraft",appId:"365815270676633",groupId:"WonderMerge-Community-105125691516212",
gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"386728805962593"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{id:""}},mergeheroes:{basic:{type:"match3",metha:"simple",staticUrl:"https://wondermerge.cleverappssg.com/publish/html5/",deployment:"https://wondermerge.cleverappssg.com",title:"MergeHeroes",lives:!0,fakeRestApiURL:"http://localhost:3016",languages:["en"],adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://wondermerge-staging.labsystech.ru/publish/html5-staging/",deployment:"https://wondermerge-staging.labsystech.ru"}},facebook:{shortname:"cleverwondermerge",appId:"699542957221997",groupId:"MergeCraft-Community-104474434917397",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"597596791051962"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{id:""}},wordheaps:{basic:{type:"board",subtype:"stacks",metha:"simple",staticUrl:"https://wordheaps.cleverappssg.com/publish/html5/",
deployment:"https://wordheaps.cleverappssg.com",title:"WordHeaps",fakeRestApiURL:"http://localhost:3013",adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://wordheaps-staging.labsystech.ru/publish/html5-staging/",deployment:"https://wordheaps-staging.labsystech.ru"}},facebook:{shortname:"cleverwordheaps",appId:"299923727721026",groupId:"wordheapscommunity",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"513633536223627"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{id:""}},differences:{basic:{type:"differences",subtype:"knockoutGame",metha:"simple",staticUrl:"https://differences.cleverappssg.com/publish/html5/",deployment:"https://differences.cleverappssg.com",title:"Differences",fakeRestApiURL:"http://localhost:3004",lives:!0,adjust:{token:"lmk8mnhq4xs0",purchaseToken:"pnfv7v",events:{ad_finish_rewarded:"7e3jp0",ad_start_interstitial:"txnnp5"}},stand:{staticUrl:"https://differences-staging.labsystech.ru/publish/html5-staging/",
deployment:"https://differences-staging.labsystech.ru"}},facebook:{shortname:"cleverdifferences",appId:"278637090036923",groupId:"rachelholmesfinddifferences",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"195225751884161"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{},instant:{appId:"",rewarded:"",interstitial:"",groupId:""},ok:{shortname:"cleverdifferences",appId:"512000594608",appKey:"CBLDBOJGDIHBABABA",groupId:"58829738606762",stand:{appId:"512000589370",appKey:"CLDPPNJGDIHBABABA"}},vk:{shortname:"cleverdifferences",appId:"7605538",groupId:"differences_group",stand:{appId:""}},mm:{appId:"782111",privateKey:"44828036769062a2148cbf76f6bd33d6",groupId:"differences",stand:{appId:"",privateKey:""}},mbga:{appId:"",groupId:""},nk:{appId:"",groupId:""},draugiem:{appId:"",groupId:""},plinga:{appId:"120653a94b0a48cf9050fff4a258f5cf"}},tripeaks:{basic:{type:"solitaire",metha:"simple",staticUrl:"https://tripeaks.cleverappssg.com/publish/html5/",
deployment:"https://tripeaks.cleverappssg.com",title:"Kings & Queens: Solitaire Tri Peaks",fakeRestApiURL:"http://localhost:3002",lives:!0,levelEditor:!0,adjust:{token:"ng66lafe248w",purchaseToken:"6nlpft",events:{ad_finish_rewarded:"zculm1",ad_start_interstitial:"yxw2sg"}},stand:{staticUrl:"https://tripeaks-staging.labsystech.ru/publish/html5-staging/",deployment:"https://tripeaks-staging.labsystech.ru"},leagues:[30,60,100,200,500,!1]},facebook:{shortname:"tripeakscard",appId:"1079919015696954",groupId:"KingsAndQueensTripeaksCommunity",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"585880102065094"}},android:{package:"com.cleverapps.tripeaks",unityGameId:""},amazon:{package:"com.cleverapps.tripeaks",id:"B08CNK8GSB"},ios:{package:"com.cleverapps.tripeaks",id:"1523134029"},instant:{appId:"582264172486698",rewarded:"583410035705445",interstitial:"583409625705486",groupId:""},ok:{shortname:"tripeaks",appId:"512000516286",appKey:"CPLBOMJGDIHBABABA",
groupId:"58210808561834",stand:{appId:"512000567965",appKey:"COJLKNJGDIHBABABA"}},vk:{shortname:"tripeaks",appId:"7522400",groupId:"tripeaks_group",stand:{appId:"7522400"}},mm:{appId:"779517",privateKey:"f5117307f5652c346c8a492698ec5520",groupId:"tripeaks",stand:{appId:"",privateKey:""}},mbga:{appId:"12026813",groupId:""},nk:{appId:"kings-queens",groupId:"1419067"},draugiem:{appId:"",groupId:""},fotostrana:{appId:"tripeaks",privateKey:"b97e8a2478376c1d7261f87ab1b2f8aa",groupId:"352512",stand:{appId:"",privateKey:""}},plinga:{appId:"344fff78cd674f62a549533551505ebb"}},spades:{basic:{type:"solitaire",metha:"simple",lives:!0,staticUrl:"https://spades.cleverappssg.com/publish/html5/",deployment:"https://spades.cleverappssg.com",title:"Spades",fakeRestApiURL:"http://localhost:3014",languages:["en"],adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://spades-staging.labsystech.ru/publish/html5-staging/",deployment:"https://spades-staging.labsystech.ru"}},facebook:{
shortname:"cleverspades",appId:"1152275768461536",groupId:"solitairekingdomcommunity",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"234186548097136"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{id:""}},riddles:{basic:{metha:"hose",type:"match3",lives:!0,staticUrl:"https://riddles.gcdn.co/publish/html5/",deployment:"https://riddles.labsystech.ru",results:!0,title:"Candy Riddles",fakeRestApiURL:"http://localhost:3007",levelEditor:!0,adjust:{token:"7h99civw80sg",purchaseToken:"pwy8hj",events:{}},stand:{staticUrl:"https://riddles-staging.labsystech.ru/publish/html5-staging/",deployment:"https://riddles-staging.labsystech.ru"}},facebook:{shortname:"candyriddles",appId:"1996120880405386",groupId:"CandyRiddlesCommunity",gameroom_rate_postId:"140958473298826",dontLikeGameUrl_postId:"145984586129548",stand:{appId:"109585006443834"}},android:{package:"com.cleverapps.candyriddles",unityGameId:"500007109"},amazon:{package:"com.cleverapps.candyriddles",
id:"B078YB7FBX"},ios:{package:"com.cleverapps.riddles",id:"1340236132"},instant:{appId:"169228177248519",rewarded:"171407780363892",interstitial:"171665730338097",groupId:"337681893427623"},ok:{shortname:"candyriddles",appId:"1269377792",appKey:"CBAMCKKMEBABABABA",groupId:"54360798855338",stand:{appId:"1270935552",appKey:"CBABPBMMEBABABABA"}},vk:{shortname:"candy_riddles",appId:"6745237",groupId:"candyriddles",stand:{appId:"6790773"}},mm:{appId:"763558",privateKey:"832ab94c8979ec52da1ce740f71d7ad7",groupId:"candyriddles",stand:{appId:"763556",privateKey:"40f493f6966593a1f447980cd30bd92c"}},mbga:{appId:"12026417",groupId:"32844341"},nk:{appId:"candy-riddles",groupId:"1417264"},draugiem:{appId:"riddles",groupId:"riddlespage",stand:{appId:"riddlesstaging",groupId:"riddlespage"}},plinga:{appId:"639df47033804f18bf39e113ef29f4fa"},fotostrana:{appId:"candyriddles",privateKey:"00fcabb0bbbf4de8fd200683a099dc13",groupId:"352511",stand:{appId:"",privateKey:""}}},heroes:{basic:{metha:"farm",
type:"match3",lives:!0,staticUrl:"https://heroes.gcdn.co/publish/html5/",deployment:"https://heroes.cleverappssg.com",results:!0,title:"Sugar Heroes",fakeRestApiURL:"http://localhost:3008",adjust:{token:"mmimvhbjk1z4",purchaseToken:"83oly9",events:{}},stand:{staticUrl:"https://heroes-staging.labsystech.ru/publish/html5-staging/",deployment:"https://heroes-staging.labsystech.ru"}},facebook:{shortname:"sugarheroes",appId:"205918406663140",groupId:"sugarheroescommunity",gameroom_rate_postId:"",dontLikeGameUrl_postId:"283957348885460",stand:{appId:"148448049182010"}},android:{package:"com.cleverapps.heroes",unityGameId:""},amazon:{package:"com.cleverapps.heroes",id:"B07JMZLTV7"},ios:{package:"com.cleverapps.heroes",id:"1439884631"},instant:{appId:"2096828893670802",rewarded:"2105178429502515",interstitial:"2105484592805232",groupId:"278630749647866"},ok:{shortname:"sugarheroes",appId:"1271685376",appKey:"CBACGNMMEBABABABA",groupId:"54384511877290",stand:{appId:"512000694356",
appKey:"CFFJJPJGDIHBABABA"}},vk:{shortname:"sugar_heroes",appId:"6830710",groupId:"sugarheroes",stand:{appId:""}},mm:{appId:"763582",privateKey:"8558918e7b85be33743d63b68ac7be00",groupId:"sugarheroes",stand:{appId:"",privateKey:""}},mbga:{appId:"12026480",groupId:"32846074"},nk:{appId:"sugar-heroes",groupId:"1417638"},draugiem:{appId:"sugarheroes",groupId:"sugarheroespage"},plinga:{appId:"b24567e39b5248eabe77a704dbb555a9"},fotostrana:{appId:"sugarheroes",privateKey:"5480cd9bf57b7ed5be7f2decf8541e18",groupId:"352509",stand:{appId:"",privateKey:""}}},adventure:{basic:{metha:"hose",type:"match3",lives:!0,rpg:!0,staticUrl:"https://adventure.gcdn.co/publish/html5/",deployment:"https://adventure.cleverappssg.com",title:"Secrets of Charmland",fakeRestApiURL:"http://localhost:3010",adjust:{token:"yxn8ttu1ydj4",purchaseToken:"2th34l",events:{ad_finish_rewarded:"804ekp",ad_start_interstitial:"l647mw"}},stand:{staticUrl:"https://adventure-staging.labsystech.ru/publish/html5-staging/",
deployment:"https://adventure-staging.labsystech.ru"}},facebook:{shortname:"secretsofcharmland",appId:"1311019545689756",groupId:"secretsofcharmland",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"247075149531781"}},android:{package:"com.cleverapps.adventure",unityGameId:""},amazon:{package:"com.cleverapps.adventure",id:"B08NXG74BD"},ios:{package:"com.cleverapps.adventure",id:"1541304616"},instant:{appId:"",rewarded:"",interstitial:"",groupId:""},ok:{shortname:"secretsofcharmland",appId:"512000026303",appKey:"CQLHGFJGDIHBABABA",groupId:"56035155116202",stand:{appId:"512000646929",appKey:"CCBQNOJGDIHBABABA"}},vk:{shortname:"thesecretsofcharmland",appId:"7139584",groupId:"secretsofcharmland",stand:{appId:""}},mm:{appId:"766832",privateKey:"6f8c46ea0f3720ee03b02083db09340b",groupId:"secretsofcharmland",stand:{appId:"",privateKey:""}},mbga:{appId:"",groupId:""},nk:{appId:"secrets-of-charmland",groupId:"1419069"},draugiem:{appId:"",groupId:""},plinga:{
appId:"49d17c8657104ee2806feebe41e0f2cd"}},runes:{basic:{metha:"hose",type:"match3",lives:!0,rpg:!0,staticUrl:"https://runes.gcdn.co/publish/html5/",deployment:"https://runes.cleverappssg.com",title:"Heroes of Match-3",fakeRestApiURL:"http://localhost:3011",adjust:{token:"eolgyc1elq0w",purchaseToken:"ya20wl",events:{}},stand:{staticUrl:"https://runes-staging.labsystech.ru/publish/html5-staging/",deployment:"https://runes-staging.labsystech.ru"}},facebook:{shortname:"heroesofmatch",appId:"582954732182317",groupId:"heroesofmatch3",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"320708625483001"}},android:{package:"com.cleverapps.runes",unityGameId:""},amazon:{package:"com.cleverapps.runes",id:"B07WPW533K"},ios:{package:"com.cleverapps.runes",id:"1476535667"},instant:{appId:"346516946289630",rewarded:"376156803325644",interstitial:"376156129992378",groupId:"101372134583131"},ok:{shortname:"heroesofmatch",appId:"1279575808",appKey:"CBAIMFENEBABABABA",
groupId:"55547515044010",stand:{appId:"512000465394",appKey:"CDPKBMJGDIHBABABA"}},vk:{shortname:"heroesofmatch",appId:"7016437",groupId:"heroes_of_match",stand:{appId:""}},mm:{appId:"765770",privateKey:"e52e74b4f487b2cccf2405816652956c",groupId:"heroesmatch3",stand:{appId:"",privateKey:""}},mbga:{appId:"12026637",groupId:"32852303"},nk:{appId:"heroes-of-match-3",groupId:"1419068"},draugiem:{appId:"",groupId:""},plinga:{appId:"bfd6c484cdd9475f895bee03e3b633ff"}},wordsoup:{basic:{staticUrl:"https://wordsoup.gcdn.co/publish/html5/",deployment:"https://wordsoup.labsystech.ru",title:"Word Sauce",type:"board",fakeRestApiURL:"http://localhost:3000",metha:"homefix",adjust:{token:"ez2lszhmg4xs",purchaseToken:"1ghfoq",events:{ad_finish_rewarded:"g49v7g",ad_start_interstitial:"kr85gz"}},stand:{staticUrl:"https://wordsoup-staging.labsystech.ru/publish/html5-staging/",deployment:"https://wordsoup-staging.labsystech.ru"}},facebook:{shortname:"word_soup",appId:"1839614776298283",
groupId:"WordSoupPuzzle",gameroom_rate_postId:"520764398277098",dontLikeGameUrl_postId:"",stand:{appId:"1847284985531262"}},android:{package:"org.cocos2dx.wordsoup",unityGameId:""},amazon:{package:"org.cocos2dx.wordsoup",id:"B07192HTZ9"},ios:{package:"org.cocos2dx.wordsoup",id:"1236153570"},instant:{appId:"177170139576790",rewarded:"194546684505802",interstitial:"194552307838573",groupId:"wordsaucelite"},ok:{shortname:"wordsoup",appId:"512000025924",appKey:"CFEGGFJGDIHBABABA",groupId:"56042597515434",stand:{appId:"512000436024",appKey:"CJDIKLJGDIHBABABA"}},vk:{shortname:"wordsoup",appId:"7139277",groupId:"wordsauce",stand:{appId:""}},mm:{appId:"766829",privateKey:"bce7dc4c706f1c0f9f53a38586ab0f14",groupId:"wordsauce",stand:{appId:"",privateKey:""}},mbga:{appId:"",groupId:""},nk:{appId:"word-soup",groupId:"1419071"},draugiem:{appId:"",groupId:""},plinga:{appId:"8d8965a1f1af4d2b884e0bc48737925d"},fotostrana:{appId:"wordsoup",privateKey:"ec5a95876a991b883c9c4848dde8b6d8",groupId:"352514",
stand:{appId:"",privateKey:""}}},crocword:{basic:{metha:"hose",staticUrl:"https://crocword.gcdn.co/publish/html5/",deployment:"https://crocword.labsystech.ru",title:"Croc Word",type:"board",fakeRestApiURL:"http://localhost:3005",adjust:{token:"6c299ak7zkw0",purchaseToken:"taza3r",events:{ad_finish_rewarded:"t1g1gj",ad_start_interstitial:"w692c3"}},stand:{staticUrl:"https://crocword-staging.labsystech.ru/publish/html5-staging/",deployment:"https://crocword-staging.labsystech.ru"}},facebook:{shortname:"crocword",appId:"480756825591552",groupId:"CrocwordPuzzleCommunity",gameroom_rate_postId:"365661064045146",dontLikeGameUrl_postId:"",stand:{appId:"2040725746155240"}},android:{package:"com.cleverapps.crocword",unityGameId:""},amazon:{package:"com.cleverapps.crocword",id:"B074JB1CB3"},ios:{package:"com.cleverapps.crocword",id:"1269673961"},instant:{appId:"999103806910942",rewarded:"1000698236751499",interstitial:"1000697493418240",groupId:"1017684138380915"},ok:{shortname:"crocword",
appId:"512000231014",appKey:"CHGHIIJGDIHBABABA",groupId:"56496148775082",stand:{appId:"512000309461",appKey:"CGNJLJJGDIHBABABA"}},vk:{shortname:"crocword",appId:"7234712",groupId:"crocwordgroup",stand:{appId:""}},mm:{appId:"768269",privateKey:"d4754dc73b088c188a115f27a6955a30",groupId:"crocwordgroup",stand:{appId:"",privateKey:""}},fotostrana:{appId:"crocword",privateKey:"f520f6ab3bd7fd0800700c49352315d5",groupId:"352327",stand:{appId:"",privateKey:""}},mbga:{appId:"12026781",groupId:"32861692"},nk:{appId:"crocword",groupId:"1419072"},draugiem:{appId:"",groupId:""},plinga:{appId:"3e314ff40f40472f9aefed5b046f6dcc"}},magicwords:{basic:{metha:"hose",deployment:"https://magicwords.labsystech.ru",title:"Magic Words",fakeRestApiURL:"http://localhost:3003",type:"board",adjust:{token:"",purchaseToken:"",events:{}},stand:{deployment:"https://magicwords-staging.labsystech.ru"}},facebook:{shortname:"magic_words_puzzle",appId:"116453995539327",groupId:"MagicWordsGameCommunity",
gameroom_rate_postId:"424848868061655",dontLikeGameUrl_postId:"",stand:{appId:"442317226120273"}},android:{package:"com.cleverapps.magicwords",unityGameId:""},amazon:{package:"com.cleverapps.magicwords",id:"B071KKB243"},ios:{package:"com.cleverapps.magicwords",id:"1256304845"},instant:{appId:"635365383471881",rewarded:"636636986678054",interstitial:"636637626677990",groupId:"214767095976110"},ok:{shortname:"",appId:"",appKey:"",groupId:"",stand:{appId:"",appKey:""}},vk:{shortname:"",appId:"",groupId:"",stand:{appId:""}},mm:{appId:"",privateKey:"",groupId:"",stand:{appId:"",privateKey:""}},mbga:{appId:"",groupId:""},nk:{appId:"",groupId:""},draugiem:{appId:"",groupId:""}},olympics:{basic:{staticUrl:"https://olympics.gcdn.co/publish/html5/",deployment:"https://olympics.labsystech.ru",title:"Word Olympics",type:"board",fakeRestApiURL:"http://localhost:3009",lives:!0,metha:"knockout",adjust:{token:"oq5rkne31atc",purchaseToken:"1jir4j",events:{}},stand:{
staticUrl:"https://olympics-staging.labsystech.ru/publish/html5-staging/",deployment:"https://olympics-staging.labsystech.ru"}},facebook:{shortname:"word_olympics",appId:"404908173269801",groupId:"WordOlympicsPuzzle",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"144582389701216"}},android:{package:"com.cleverapps.olympics",unityGameId:""},amazon:{package:"com.cleverapps.olympics",id:"B07DGGRN8K"},ios:{package:"com.cleverapps.olympics",id:"1394966990"},instant:{appId:"403603626714071",rewarded:"404667946607639",interstitial:"404667353274365",groupId:"803998833127843"},ok:{shortname:"olympics",appId:"512000487372",appKey:"CNMQGMJGDIHBABABA",groupId:"57516329402562",stand:{appId:"512000563796",appKey:"CFFLJNJGDIHBABABA"}},vk:{shortname:"wordolympics",appId:"7394144",groupId:"wordolympicsgoup",stand:{appId:""}},mm:{appId:"771991",privateKey:"21595777945c95784a620c87da88c1df",groupId:"wordolympicsgroup",stand:{appId:"",privateKey:""}},mbga:{appId:"",groupId:""},nk:{
appId:"crossword-online",groupId:"1419073"},draugiem:{appId:"",groupId:""},fotostrana:{appId:"olympics",privateKey:"11f5cd81d3000cdff01280a75074394a",groupId:"352515",stand:{appId:"",privateKey:""}}},scramble:{basic:{metha:"simple",staticUrl:"https://scramble.gcdn.co/publish/html5/",deployment:"https://scramble.labsystech.ru",title:"Kitty Scramble",type:"board",subtype:"stacks",languages:["en","fr","ru","it","de","es","nl","pt","ja"],fakeRestApiURL:"http://localhost:3001",levelEditor:!0,changeLevelsDisabled:!0,adjust:{token:"tyz2dqp6yt4w",purchaseToken:"iyhfum",events:{ad_finish_rewarded:"fz4ds8",ad_start_interstitial:"1yuq60"}},stand:{staticUrl:"https://scramble-staging.labsystech.ru/publish/html5-staging/",deployment:"https://scramble-staging.labsystech.ru"}},facebook:{shortname:"kittyscramble",appId:"229294690917786",groupId:"kittyscramblecommunity",gameroom_rate_postId:"503600920012105",dontLikeGameUrl_postId:"",stand:{appId:"540455343011567"}},android:{
package:"com.cleverapps.scramble",unityGameId:""},amazon:{package:"com.cleverapps.scramble",id:"B073RHS2TQ"},ios:{package:"com.cleverapps.scramble",id:"1256286028"},instant:{appId:"170256430308082",rewarded:"170975370236188",interstitial:"170976206902771",groupId:"kittyscramblelite"},ok:{shortname:"kittyscramble",appId:"512000595430",appKey:"CHOGBOJGDIHBABABA",groupId:"58437883658410",stand:{appId:"512000542947",appKey:"CEOJENJGDIHBABABA"}},vk:{shortname:"kittyscramble",appId:"7559026",groupId:"kittyscramble_group",stand:{appId:""}},mm:{appId:"781640",privateKey:"ea277cd8e592c36afdc068eef84052ba",groupId:"kittyscramble",stand:{appId:"",privateKey:""}},mbga:{appId:"",groupId:""},nk:{appId:"kitty-scramble",groupId:"1419070"},draugiem:{appId:"",groupId:""},plinga:{appId:"944186abe50e452dac7f0e8d3e0a8814"},fotostrana:{appId:"scramble",privateKey:"e2f2fa801cdd8f976a50b78561587172",groupId:"352513",stand:{appId:"",privateKey:""}}}};"undefined"!=typeof exports&&(module.exports=projects)
;var cleverapps={bundles:{}},projectName=(config="undefined"!=typeof document&&document.ccConfig||cc.game.config).projectName;cleverapps.config=config[projectName],cleverapps.config.debugMode=config.debugMode,cleverapps.config.useStandFbAppId=config.useStandFbAppId,cleverapps.config.name=projectName,cleverapps.config.prefix=projectName,cleverapps.config.restApiURL="/"+projectName+"-rest",cleverapps.config.staticUrl=config.staticUrl||"",cleverapps.config.source=config.source,"match3"===cleverapps.config.type&&(match3={}),cleverapps.config.languages||(cleverapps.config.languages="board"===cleverapps.config.type?projects.default.boardgame.languages:projects.default.languages),cleverapps.config.leagues||(cleverapps.config.leagues=projects.default.leagues),cleverapps.config.prices={prolongations:[100,300,500,700,1e3],boosters:{0:{1:100,3:270,7:600},1:{1:150,3:400,7:900},2:{1:200,3:550,7:1200},3:{1:50},4:{1:150},5:{1:50},6:{1:100},7:{1:150},8:{1:100},9:{1:50},10:{1:50},11:{1:100},12:{1:150},
13:{1:50},14:{1:100},15:{1:150}}};var projectAddedToNetwork=function(e,t,i){return!!i[e]&&(!!i[e][t]&&("android"===t?i[e][t].package:"ios"===t||"amazon"===t?i[e][t].id:i[e][t].appId))},generateNetworkLinks=function(e,t){var i={};for(var s in t[e])if(projectAddedToNetwork(e,s,t)){var n=t[e][s],o=!1;switch("undefined"==typeof exports&&(o=cleverapps.config.debugMode&&n.stand&&n.stand.appId),s){case"facebook":i.facebook=o?"https://apps.facebook.com/"+n.stand.appId:"https://apps.facebook.com/"+(n.shortname?n.shortname:n.appId);break;case"android":i.android="https://play.google.com/store/apps/details?id="+n.package;break;case"amazon":i.amazon="https://www.amazon.com/dp/"+n.id;break;case"ios":i.ios="https://apps.apple.com/app/id"+n.id;break;case"instant":i.instant=n.appId;break;case"ok":o?(i.web_ok="https://ok.ru/game/"+n.stand.appId,i.mobile_ok="https://m.ok.ru/game/"+n.stand.appId):(i.web_ok="https://ok.ru/game/"+n.shortname,i.mobile_ok="https://m.ok.ru/game/"+n.shortname);break;case"vk":
o?(i.web_vk="https://vk.com/app"+n.stand.appId,i.mobile_vk="vk://vk.com/app"+n.stand.appId):(i.web_vk="https://vk.com/"+n.shortname,i.mobile_vk="vk://vk.com/"+n.shortname);break;case"mm":o?(i.web_mm="https://my.mail.ru/apps/"+n.stand.appId,i.mobile_mm="https://m.my.mail.ru/apps/"+n.stand.appId):(i.web_mm="https://my.mail.ru/apps/"+n.appId,i.mobile_mm="https://m.my.mail.ru/apps/"+n.appId);break;case"mbga":"undefined"==typeof exports&&cleverapps.config.debugMode?i.mbga="http://sb.yahoo-mbga.jp/game/"+n.appId+"/play":i.mbga="http://yahoo-mbga.jp/game/"+n.appId+"/play",i.sp_mbga="http://sp.mbga.jp/_pf_install?game_id="+n.appId;break;case"nk":i.nk="https://nk.pl/#gry-online/"+n.appId;break;case"draugiem":i.draugiem="https://www.draugiem.lv/"+n.appId;break;case"fotostrana":i.fotostrana=o?"https://fotostrana.ru/app/"+n.stand.appId:"https://fotostrana.ru/app/"+n.appId}}return i};if("undefined"!=typeof exports)module.exports=generateNetworkLinks;else{for(
var project in cleverapps.projectLinks={},projects)cleverapps.projectLinks[project]=generateNetworkLinks(project,projects);var networkConfig=projects[projectName];for(var network in cleverapps.config.rate={urls:{}},cleverapps.config.helpURL={},cleverapps.config.dontLikeGameUrl={},networkConfig)if(projectAddedToNetwork(projectName,network,projects)){var data=networkConfig[network],useStandData=cleverapps.config.debugMode&&data.stand&&data.stand.appId;switch(network){case"facebook":config.plugin||(config.plugin={}),config.plugin.facebook={status:!0,frictionlessRequests:!0,version:"v3.3"},useStandData||cleverapps.config.useStandFbAppId?config.plugin.facebook.appId=data.stand.appId:config.plugin.facebook.appId=data.appId,cleverapps.config.facebook={url:cleverapps.projectLinks[projectName].facebook};var helpUrl="https://www.facebook.com/"+data.groupId;cleverapps.config.helpURL.default=helpUrl,
cleverapps.config.rate.urls.gameroom=data.gameroom_rate_postId?helpUrl+"/posts/"+data.gameroom_rate_postId:helpUrl,cleverapps.config.rate.urls.facebook="https://www.facebook.com/games/manage/",cleverapps.config.dontLikeGameUrl.default=data.dontLikeGameUrl_postId?helpUrl+"/posts/"+data.dontLikeGameUrl_postId:helpUrl;break;case"android":cleverapps.config.android={url:cleverapps.projectLinks[projectName].android,unityGameId:data.unityGameId},cleverapps.config.rate.urls.android="market://details?id="+data.package;break;case"amazon":cleverapps.config.amazon={url:cleverapps.projectLinks[projectName].amazon},cleverapps.config.rate.urls.amazon="amzn://apps/android?p="+data.package,cleverapps.config.dontLikeGameUrl.amazon=!1;break;case"ios":cleverapps.config.ios={url:cleverapps.projectLinks[projectName].ios},cleverapps.config.rate.urls.ios="itms-apps://itunes.apple.com/app/id"+data.id;break;case"instant":cleverapps.config.instantAds={rewarded:data.appId+"_"+data.rewarded,
interstitial:data.appId+"_"+data.interstitial},cleverapps.config.helpURL.instant="https://www.facebook.com/"+data.groupId;break;case"ok":cleverapps.config.mobile_ok=useStandData?{url:cleverapps.projectLinks[projectName].mobile_ok,appId:data.stand.appId,appKey:data.stand.appKey}:{url:cleverapps.projectLinks[projectName].mobile_ok,appId:data.appId,appKey:data.appKey},cleverapps.config.web_ok={url:cleverapps.projectLinks[projectName].web_ok},cleverapps.config.helpURL.web_ok="https://ok.ru/group/"+data.groupId,cleverapps.config.helpURL.mobile_ok="https://m.ok.ru/group/"+data.groupId;break;case"vk":cleverapps.config.vk=useStandData?{url:cleverapps.projectLinks[projectName].web_vk,appId:data.stand.appId}:{url:cleverapps.projectLinks[projectName].web_vk,appId:data.appId},cleverapps.config.helpURL.web_vk="https://vk.com/"+data.groupId,cleverapps.config.helpURL.mobile_vk="vk://vk.com/"+data.groupId;break;case"mm":cleverapps.config.myMailRu=useStandData?{
url:cleverapps.projectLinks[projectName].web_mm,appId:data.stand.appId,privateKey:data.stand.privateKey}:{url:cleverapps.projectLinks[projectName].web_mm,appId:data.appId,privateKey:data.privateKey},cleverapps.config.helpURL.web_mm="https://my.mail.ru/community/"+data.groupId,cleverapps.config.helpURL.mobile_mm="https://m.my.mail.ru/community/"+data.groupId;break;case"mbga":cleverapps.config.mbga={url:cleverapps.projectLinks[projectName].mbga},cleverapps.config.sp_mbga={url:data.appId+"-4"},cleverapps.config.helpURL.mbga="http://yahoo-mbga.jp/group/"+data.groupId,cleverapps.config.helpURL.sp_mbga="http://sp.mbga.jp/_grp_view?g="+data.groupId;break;case"nk":cleverapps.config.nk={url:cleverapps.projectLinks[projectName].nk},cleverapps.config.helpURL.nk="https://nk.pl/#grupa/"+data.groupId;break;case"draugiem":cleverapps.config.draugiem={url:cleverapps.projectLinks[projectName].draugiem},cleverapps.config.helpURL.draugiem="https://www.draugiem.lv/"+data.groupId;break;case"plinga":
cleverapps.config.plinga={appId:data.appId};break;case"fotostrana":cleverapps.config.fotostrana=useStandData?{url:cleverapps.projectLinks[projectName].fotostrana,appId:data.stand.appId,privateKey:data.stand.privateKey}:{url:cleverapps.projectLinks[projectName].fotostrana,appId:data.appId,privateKey:data.privateKey},cleverapps.config.helpURL.fotostrana="https://fotostrana.ru/public/"+data.groupId}}}cleverapps.EventEmitter=function(){this.bindings={}},cleverapps.EventEmitter.prototype.on=function(t,i,e){this.bindings[t]||(this.bindings[t]=[]),this.bindings[t].push(i);var s={clear:function(){if(this.bindings[t]){var e=this.bindings[t].indexOf(i);0<=e&&this.bindings[t].splice(e,1)}}.bind(this)};return e instanceof cc.Node&&e.registerCleanupCallback(s.clear),s},cleverapps.EventEmitter.prototype.off=function(e){this.bindings[e]=void 0},cleverapps.EventEmitter.prototype.purge=function(){this.bindings={}},cleverapps.EventEmitter.prototype.trigger=function(){for(var t=[],
e=0;e<arguments.length;e++)t.push(arguments[e]);var i=t.shift();this.bindings[i]&&this.bindings[i].forEach(function(e){e.apply(this,t)})},cleverapps.EventsQueue=function(e){this.data=[],this.interval=cleverapps.parseInterval(e)},cleverapps.EventsQueue.prototype.add=function(e){this.data.push(e),this.data.sort(),this.shrink()},cleverapps.EventsQueue.prototype.first=function(){if(this.shrink(),0<this.data.length)return this.data[0]},cleverapps.EventsQueue.prototype.shrink=function(){for(;0<this.data.length&&this.data[0]+this.interval<=Date.now();)this.data.shift()},cleverapps.EventsQueue.prototype.getShrinkLeftTime=function(){if(0<this.data.length)return this.data[0]+this.interval-Date.now()},cleverapps.EventsQueue.prototype.size=function(){return this.shrink(),this.data.length},cleverapps.Cache=function(e){this.capacity=e||100,this.data={},this.queue=[]},cleverapps.Cache.prototype.set=function(e,t){if(!this.data[e]){var i=this.queue.indexOf(e);-1!==i&&this.queue.splice(i,1)}
this.data[e]=t,this.queue.push(e),this.queue.length>this.capacity&&(e=this.queue.shift(),delete this.data[e])},cleverapps.Cache.prototype.get=function(e){return this.data[e]},cleverapps.isRumble=function(){var e=cleverapps.metha.getMainObject().knockoutGame;return e&&e.isRumble()},cleverapps.isKnockoutGame=function(){return cleverapps.metha.getMainObject().knockoutGame},cleverapps.humanReadableNumber=function(e,t){return(parseInt(e)||0)*Episode.LEVELS_PER_EPISODE+t+1},cleverapps.arrayFill=function(e,t){for(var i=[],s=0;s<e;s++)i.push(t);return i},cleverapps.formatAmount=function(e){if(e<1e3)return e;var t=Math.floor(e/1e3);(e-=1e3*t)<10?e="00"+e:e<100&&(e="0"+e);return t+" "+e},cleverapps.cmp=function(e,t){return(e=JSON.stringify(e))===(t=JSON.stringify(t))},cleverapps.loadSdk=function(e,t,i,s){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",e);var o=function(){clearTimeout(a),1<s?(document.body.contains(n
)&&document.body.removeChild(n),cleverapps.loadSdk(e,t,i,s-1)):i()}.bind(this);n.onload=function(){clearTimeout(a),t()},n.onerror=o;var a=setTimeout(o,3e4);document.body.appendChild(n)},cleverapps.getRequestParameters=function(e){var t={},i=e||window.location.search;if(i)for(var s=(i=i.substr(1)).split("&"),n=0;n<s.length;n++){var o=s[n].split("="),a=o[0],r=o[1]||"";r=decodeURIComponent(r.replace(/\+/g," ")),t[a]=r}return t},cleverapps.bySource=function(e){var t,i=cleverapps.User.calcSource();return!cc.sys.isNative&&(-1<(t=navigator.userAgent||navigator.vendor||window.opera).indexOf("FBAN")||-1<t.indexOf("FBAV"))&&(i="gameroom"),e[i]?e[i]:"gameroom"===i&&e.facebook?e.facebook:e.default?e.default:void 0},cleverapps.INTERVALS={second:1,minute:60,hour:3600,day:86400,week:604800,month:2592e3},cleverapps.padZeroes=function(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i},cleverapps.parseInterval=function(e){var t=1e3*parseInt(e);for(var i in cleverapps.INTERVALS){if(-1!==e.indexOf(i)
)return t*cleverapps.INTERVALS[i]}return t},cleverapps.goalCollectSound=function(){cleverapps.audio.playSound(bundles.game.urls.goal_inc_effect,{throttle:100})},cleverapps.once=function(e){var t=!1;return function(){t||(e.apply(this,arguments),t=!0)}},cleverapps.shuffle=function(e){for(var t=0;t<e.length;t++){var i=cleverapps.Random.random(e.length),s=e[t];e[t]=e[i],e[i]=s}return e},cleverapps.extractDateFromDateTime=function(e){return new Date(e).setHours(0,0,0,0)},cleverapps.extractNumber=function(e){if(e){for(var t="",i=0;i<e.length;i++){var s=e.charAt(i);s.match(/\d+/g)?t+=s:","!==s&&"."!==s||(t+=".")}return-1!==t.indexOf(".")?parseFloat(t):parseInt(t)}},cleverapps.extend=function(e,t){if(Object.assign)return Object.assign.apply(this,arguments);for(var i=1;i<arguments.length;i++)for(var s in arguments[i])e[s]=arguments[i][s];return e},cleverapps.override=function(e,t){for(var i in t){var s=e[i],n=t[i];s instanceof cc.Color?(console.log("Override color: "+i),e[i]=n):Array.isArray(s
)&&Array.isArray(n)?e[i]=n:"object"==typeof s&&"object"==typeof n?cleverapps.override(s,n):e[i]=n}return e},cleverapps.overrideStyles=function(e,t,i){for(var s in void 0!==e&&void 0!==t||console.log(e,t),i&&(e=cleverapps.clone(e,!0)),t){var n=e[s],o=t[s];n instanceof cc.Color||n&&n.fnt?e[s]=o:Array.isArray(n)&&Array.isArray(o)?e[s]=o:"object"==typeof n&&"object"==typeof o?cleverapps.overrideStyles(n,o):e[s]=o}return e},cleverapps.overrideColors=function(e,t){var i=function(e){return e instanceof cc.Color||cc.sys.isNative&&e&&void 0!==e.r&&void 0!==e.g&&void 0!==e.b&&void 0!==e.a};for(var s in t){var n=e[s],o=t[s];void 0===n?e[s]=o:i(n)&&i(o)?(n.r=o.r,n.g=o.g,n.b=o.b,n.a=o.a):"object"==typeof n&&"object"==typeof o?cleverapps.overrideColors(n,o):e[s]=o}return e},cleverapps.overrideFonts=function(e,t){for(var i in t){var s=e[i],n=t[i];void 0===s?e[i]=n:(n.size&&(s.size=n.size),n.color&&(s.color=n.color),n.scale&&(s.scale=n.scale),n.alternativeSizes&&(s.alternativeSizes=n.alternativeSizes)
,s.prefix=n.prefix,s.stroke=n.stroke,s.shadow=n.shadow),e[i].fnt=!0}return e},cleverapps.clone=function(e,t){if(null===e)return null;if("object"!=typeof e)return e;if(e instanceof cc.Color)return cc.color(e);if(Array.isArray(e)){for(var i=[],s=0;s<e.length;s++)t?i.push(cleverapps.clone(e[s],!0)):i.push(e[s]);return i}i={};for(var n in e)e[n]&&e[n].fnt?i[n]=e[n]:i[n]=t?cleverapps.clone(e[n],!0):e[n];return i},cleverapps.accumulate=function(e,t){var i,s,n=void 0;return function(){i=this,s=arguments,void 0===n&&(n=setTimeout(function(){clearTimeout(n),n=void 0,t.apply(i,s)},e))}},cleverapps.throttle=function(e,t,i){return i=void 0!==i?i:0,function(){i+e<Date.now()&&(i=Date.now(),t.apply(this,arguments))}},cleverapps.timeredThrottle=function(i,e,s){var n,o,a;s=void 0!==s?s:0;var r=function(){void 0!==a&&(clearTimeout(a),a=void 0),o=n=void 0},l=function(){n&&o&&(e.apply(n,o),s=Date.now()),r()};return function(){r(),n=this,o=arguments;var e=Date.now(),t=s+i-e;t<=0?l():a=setTimeout(l,t)}},
cleverapps.createSet=function(e){var t={};return e.forEach(function(e){t[e]=!0}),t},cleverapps.contains=function(t,e){return t=t||[],(e=e||[]).filter(function(e){return-1!==t.indexOf(e)}).length===e.length},cleverapps.substract=function(e,t,i){i=i||function(e){return e},e=e||[];var s={};return(t=t||[]).forEach(function(e){s[i(e)]=!0}),e.filter(function(e){return void 0===s[i(e)]})},cleverapps.intersect=function(e,t){e=e||[];var i={};return(t=t||[]).forEach(function(e){i[e]=!0}),e.filter(function(e){return void 0!==i[e]})},cleverapps.unique=function(e){if("undefined"!=typeof Set&&"function"==typeof Array.from)return Array.from(new Set(e));var t={},i=[];return e.forEach(function(e){!0!==t[e]&&(i.push(e),t[e]=!0)}),i},cleverapps.values=function(e){if(!e)return[];if(Object.values)return Object.values(e);var t=[];for(var i in e)t.push(e[i]);return t},cleverapps.callFunc=function(e){e()},cleverapps.intervalToString=function(e,t){void 0===t&&(t=!0);var i=(e=Math.ceil(e/1e3))%60,s=(
e=Math.floor(e/60))%60,n=Math.floor(e/60);if(i<10&&(i="0"+i),s<10&&(s="0"+s),24<n||24===n&&(0<s||0<i)){var o=Math.floor(n/24);return n%=24,Messages.get("dayTimeString",{day:o,hr:n})}return n<10&&(n="0"+n),(t?n+":":"")+s+":"+i},cleverapps.isLevels=function(){return cleverapps.metha.getType()!==Metha.NONE},cleverapps.isStaging=function(){return!cc.sys.isNative&&cleverapps.config.debugMode&&!cleverapps.isLocalhost()},cleverapps.isLocalhost=function(){return!cc.sys.isNative&&("localhost"===location.host||"127.0.0.1"===location.host||0===location.host.indexOf("192.168."))},cleverapps.isStagingHost=function(){return-1!==location.host.indexOf("staging.labsystech.ru")},cleverapps.isInstant=function(){return"instant"===cc.game.config.source},cleverapps.isOkApp=function(){var e=!cc.sys.isNative&&window&&window.navigator&&window.navigator.userAgent;return e&&0<=e.indexOf("OkApp")},cleverapps.checkStatus=function(e,t){return Array.isArray(t)||(t=[t]),Array.isArray(e)?0<e.filter(function(e){
return cleverapps.checkStatus(e,t)}.bind(this)).length:-1!==t.indexOf(e)||e&&e.errorMessage&&e.errorMessage.status&&-1!==t.indexOf(e.errorMessage.status)},cleverapps.wait=function(e,t){if(0!==e){var i=0;return function(){++i===e&&t()}}t()},cleverapps.waitNoMore=function(e,t){var i=setTimeout(function(){console.log("waitNoMore timeout: "+e),i=void 0,t()},e);return function(){void 0!==i&&(clearTimeout(i),t())}},cleverapps.doubleReward=function(e){if(void 0!==e.gold&&(e.gold*=2),void 0!==e.boosters)for(var t in e.boosters)e.boosters[t]*=2;return void 0!==e.exp&&(e.exp*=2),void 0!==e.stars&&(e.stars*=2),void 0!==e.lives&&(e.lives*=2),e},cleverapps.throwAsync=function(e){e=e+" "+JSON.stringify((new Error).stack),setTimeout(function(){throw e},0)},cleverapps.isNumber=function(e){return"string"==typeof e&&e&&/^[0-9]+$/.test(e)||"number"==typeof e&&!isNaN(e)},cleverapps.castType=function(e){return"string"==typeof e&&cleverapps.isNumber(e)?parseInt(e):e},cleverapps.rangeArray=function(e,t){for(
var i=[],s=e;s<=t;s++)i.push(s);return i},cleverapps.splitToChunks=function(e,t){for(var i=Math.ceil(e.length/t),s=[];0<e.length;)s.push(e.splice(0,i));return s},cleverapps.EXCHANGE_RATES={EUR:.9,RUB:64.23,GBP:.79,DEM:1.77,JPY:108.31,INR:70.86,FRF:5.95,CAD:1.32,AUD:1.47,BEF:36.58},cleverapps.NO_ACTION="no_action";var ResourceProcessor={addStaticUrl:function(e){e=e||Object.keys(bundles);var t,i=function(e){return"string"==typeof e&&-1!==[".plist",".atlas"].indexOf(cc.path.extname(e))},n=function(e,t){if("string"==typeof e&&"@"===e.charAt(0))return e;if("string"==typeof e&&-1===e.indexOf(t))return t+e;if("font"===e.type)return e.srcs=e.srcs.map(function(e){return n(e,t)}),e;if("object"==typeof e){var i={};for(var s in e)i[s]=n(e[s],t);return i}return e},s=cleverapps.config;for(var o in e){var a=e[o],r=bundles[a],l=s.staticUrl,c="";if(cc.sys.isNative&&(l="",c=s.staticUrl.replace("html5-staging","external-staging").replace("html5","external")),l||c)for(var o in r.urls){var p=r.urls[o],
d=r.external&&("string"==typeof(t=p)&&-1!==[".png",".jpg"].indexOf(cc.path.extname(t)))&&c||l;d&&(r.urls[o]=n(p,d))}l&&Object.keys(r.jsons).forEach(function(e){var t;(i(r.jsons[e])||"string"==typeof(t=r.jsons[e])&&-1!==[".json"].indexOf(cc.path.extname(t))&&"levels"===e&&r.urls.levels)&&(r.jsons[e]=n(r.jsons[e],l))}),Object.keys(r.urls).forEach(function(e){i(r.urls[e])&&(r.jsons[e]=r.urls[e])})}},preprocessCompat:function(){ResourceProcessor.addStaticUrl();["game","main","heroes","transition"].forEach(function(e){bundles[e]&&new Bundle(e).injectTo(res)})},calcProbablyNeed:function(){var e=["main","transition","language_"+cleverapps.settings.language],t=cleverapps.Plot.onStartup(void 0,!0),i=[];"object"==typeof t&&(i=t.options,t=t.scene);var s=cleverapps.bundleLoader.getClassBundles(t,this,i);return e=e.concat(s),cleverapps.config.debugMode&&e.push("dev_resources"),e=(e=cleverapps.unique(e)).filter(function(e){return void 0!==bundles[e]&&!bundles[e].noCache})}},bundles={admin:{urls:{
png:"@%n-e6a6a8ddd3.png",json:"@%n-d774488e5b.json"},jsons:{plist:"@%n-e6a6a8ddd3.plist"},frames:{admin_image_font_colon:"#%n-numbers-colon.png",admin_image_font_minus:"#%n-numbers-minus.png",admin_image_font_plus:"#%n-numbers-plus.png",admin_image_font_point:"#%n-numbers-point.png",admin_image_font_space:"#%n-numbers-space.png",admin_image_font_0:"#%n-numbers-number0.png",admin_image_font_1:"#%n-numbers-number1.png",admin_image_font_2:"#%n-numbers-number2.png",admin_image_font_3:"#%n-numbers-number3.png",admin_image_font_4:"#%n-numbers-number4.png",admin_image_font_5:"#%n-numbers-number5.png",admin_image_font_6:"#%n-numbers-number6.png",admin_image_font_7:"#%n-numbers-number7.png",admin_image_font_8:"#%n-numbers-number8.png",admin_image_font_9:"#%n-numbers-number9.png",admin_image_font_left_square_bracket:"#%n-numbers-square_bracket_left.png",admin_image_font_right_square_bracket:"#%n-numbers-square_bracket_right.png",admin_image_font_x:"#%n-numbers-letter_x.png",
annotation_icon:"#%n-button_icons-%n_annotation.png",current_icon:"#%n-button_icons-%n_current.png",hard_icon:"#%n-button_icons-%n_hot.png",push_icon:"#%n-button_icons-%n_push.png",revert_icon:"#%n-button_icons-%n_rev.png",play_icon:"#%n-button_icons-%n_play.png",edit_icon:"#%n-button_icons-%n_edit.png",copy_icon:"#%n-button_icons-%n_copy.png",delete_icon:"#%n-button_icons-%n_delete.png",release_icon:"#%n-button_icons-%n_release.png",debug_icon:"#%n-button_icons-%n_debug.png",download_icon:"#%n-button_icons-%n_download.png",update_icon:"#%n-button_icons-%n_update.png",upload_icon:"#%n-button_icons-%n_upload.png",left:"#%n-button_icons-left.png",right:"#%n-button_icons-right.png",left_double:"#%n-button_icons-left_double.png",right_double:"#%n-button_icons-right_double.png",number_bg:"#%n-numbers.png",area_selection:"#%n-diffr_red.png",hard_level_mark:"#%n-hard_level_pin.png",yellow_flag:"#%n-%n_yellow_flag.png",in_process:"#%n-in_process.png",regular_button:"#%n-regular_button.png",
regular_button_on:"#%n-regular_button_on.png",disabled_button:"#%n-disabled_button.png",selected_button:"#%n-selected_button.png",plus_button:"#%n-plus_button.png",lvl_bg:"#%n-level_frame_regular.png",lvl_selected_bg:"#%n-level_frame_selected.png",lvl_miniature_bg:"#%n-level_miniature_frame_regular.png",tool_tip_bg:"#%n-editor_yellow_substrate.png",tool_tip_button:"#%n-description_button.png",loading_png:"#%n-loading.png",delete_button:"#%n-delete_button.png",enlarge_button:"#%n-enlarge_button.png",language_regular:"#%n-language_regular.png",language_selected:"#%n-language_selected.png",difficulty_bar:"#%n-difficulty_bar.png",navigation_level_episode:"#%n-navigation_level_episode.png",current_arrow:"#%n-current_arrow.png",feature_bg:"#%n-features-editor_bg.png",log_entry_separator:"#%n-log_entry_separator.png",log_bg:"#%n-level_frame_add.png",admin_de:"#%n-langs-%n_de.png",admin_en:"#%n-langs-%n_en.png",admin_es:"#%n-langs-%n_es.png",admin_fr:"#%n-langs-%n_fr.png",
admin_it:"#%n-langs-%n_it.png",admin_ja:"#%n-langs-%n_ja.png",admin_nl:"#%n-langs-%n_nl.png",admin_pt:"#%n-langs-%n_pt.png",admin_ru:"#%n-langs-%n_ru.png",gold_small_png:"#%n-reward_icons-gold_small.png",gold_png:"#%n-reward_icons-gold.png",reward_exp_png:"#%n-reward_icons-exp.png",exp_png:"#%n-menubar-exp.png",cellbooster_small:"#%n-reward_icons-cell_small.png",linebooster_small:"#%n-reward_icons-line_small.png",colorbooster_small:"#%n-reward_icons-color_small.png",cellbooster:"#%n-reward_icons-cell.png",linebooster:"#%n-reward_icons-line.png",colorbooster:"#%n-reward_icons-color.png",life_unlim:"#%n-reward_icons-life_unlim.png",life_unlim_small:"#%n-reward_icons-life_unlim_small.png",stars_png:"#%n-reward_icons-stars.png",heroes_png:"#%n-reward_icons-heroes.png",moves_png:"#%n-reward_icons-moves.png",multicolor_png:"#%n-reward_icons-multicolor.png",heroes_small_png:"#%n-reward_icons-heroes_small.png",moves_small_png:"#%n-reward_icons-moves_small.png",
multicolor_small_png:"#%n-reward_icons-multicolor_small.png"}},avatar:{urls:{},injectTo:["main"],frameIds:["%n_frame","%n_frame2"],jsonIds:[],soundIds:[]},backgrounds_window_0:{urls:{background:"@background_0-a29cd22d74.jpg"}},backgrounds_window_1:{urls:{background:"@background_1-fd1757b0d1.jpg"}},backgrounds_window_10:{urls:{background:"@background_10-37d18549cc.jpg"}},backgrounds_window_11:{urls:{background:"@background_11-6f0e72d4b6.jpg"}},backgrounds_window_12:{urls:{background:"@background_12-427c95171c.jpg"}},backgrounds_window_13:{urls:{background:"@background_13-a4cf79d158.jpg"}},backgrounds_window_14:{urls:{background:"@background_14-d7dce94599.jpg"}},backgrounds_window_2:{urls:{background:"@background_2-87ce7af271.jpg"}},backgrounds_window_3:{urls:{background:"@background_3-9c95f058f6.jpg"}},backgrounds_window_4:{urls:{background:"@background_4-c2e504175d.jpg"}},backgrounds_window_5:{urls:{background:"@background_5-074b5f196f.jpg"}},backgrounds_window_6:{urls:{
background:"@background_6-65ce18dfdc.jpg"}},backgrounds_window_7:{urls:{background:"@background_7-e227c70ca9.jpg"}},backgrounds_window_8:{urls:{background:"@background_8-20e9b0ccb6.jpg"}},backgrounds_window_9:{urls:{background:"@background_9-26fee1f61f.jpg"}},bag:{urls:{png:"@%n-e6fd9c7251.png",json:"@%n-d52d2967ba.json"},jsons:{bag_spine_json:"@jsons/%n_spine-f885deabb7.json",plist:"@%n-e6fd9c7251.plist",atlas:"@%n-e6fd9c7251.atlas"},frames:{bag_cell_a:"#%n-images-%n_blue.png",bag_cell_b:"#%n-images-%n_green.png",bag_cell_c:"#%n-images-%n_purple.png",bag_cell_d:"#%n-images-%n_red.png",bag_cell_e:"#%n-images-%n_yellow.png",bag_cell_w:"#%n-images-%n_white.png",bag_cell_goal:"#%n-images-%n_goal.png"}},battle_pass:{urls:{png:"@%n-40bfe0369c.png",json:"@%n-b95bc14f60.json"},jsons:{plist:"@%n-40bfe0369c.plist"},frames:{ticket:"#%n-pass_ticket.png",arrow:"#%n-pass_arrow.png",hoverBg:"#%n-bp_hint_bg.png",reward_button:"#%n-bp_button.png",reward_button_on:"#%n-bp_button_on.png",
bp_task_icon0:"#%n-bp_task_icon0.png",bp_task_icon1:"#%n-bp_task_icon1.png",bp_task_icon4:"#%n-bp_task_icon4.png",bp_task_icon9:"#%n-bp_task_icon9.png",bp_task_icon10:"#%n-bp_task_icon10.png",bp_task_icon11:"#%n-bp_task_icon11.png",bp_task_icon12:"#%n-bp_task_icon12.png",bp_task_icon13:"#%n-bp_task_icon13.png",top_level_bg:"#%n-pass_bg_0.png",top_cur_level_bg:"#%n-pass_bg_1.png",bottom_level_bg:"#%n-pass_bg_gold.png",titleBg:"#%n-pass_title.png"}},beatfriendwindow:{urls:{png:"@%n-00aa507135.png",json:"@%n-402fef6471.json"},jsons:{plist:"@%n-00aa507135.plist"},frames:{beat_friend_bg_png:"#%n-windows-beat_friend_bg.png"}},blanket:{urls:{png:"@%n-6ac433c1f0.png",json:"@%n-555b693d65.json"},jsons:{wrapper_spine1_json:"@jsons/wrapper_spine-ecdc3fe564.json",plist:"@%n-6ac433c1f0.plist",atlas:"@%n-6ac433c1f0.atlas"},frames:{eater_goal_png:"#%n-images-%n_bg.png",tartlet_png:"#%n-images-tartlet.png",tartlet2_png:"#%n-images-tartlet2.png"}},bomb:{urls:{
bomb_explosion:"~sounds/%nexplosion-e79f56d2ba.mp3",png:"@%n-79876308db.png",json:"@%n-5098c41dd3.json"},jsons:{bomb_spine_json:"@jsons/%n_spine-51e3585dbd.json",bomb_splash_json:"@jsons/%n_splash-4c353adfa6.json",bomb_window_json:"@jsons/%n_window-f6fcb390ea.json",plist:"@%n-79876308db.plist",atlas:"@%n-79876308db.atlas"},frames:{bomb_a:"#%n-images-%n_blue.png",bomb_b:"#%n-images-%n_green.png",bomb_c:"#%n-images-%n_purple.png",bomb_d:"#%n-images-%n_red.png",bomb_e:"#%n-images-%n_yellow.png",bomb_w:"#%n-images-%n_white.png",bomb_goal:"#%n-images-%n_goal.png",bomb_danger_a:"#%n-images-%n_blue_danger.png",bomb_danger_b:"#%n-images-%n_green_danger.png",bomb_danger_c:"#%n-images-%n_purple_danger.png",bomb_danger_d:"#%n-images-%n_red_danger.png",bomb_danger_e:"#%n-images-%n_yellow_danger.png",bomb_danger_w:"#%n-images-%n_white_danger.png",white_digit_0:"#%n-white_digits-0.png",white_digit_1:"#%n-white_digits-1.png",white_digit_2:"#%n-white_digits-2.png",
white_digit_3:"#%n-white_digits-3.png",white_digit_4:"#%n-white_digits-4.png",white_digit_5:"#%n-white_digits-5.png",white_digit_6:"#%n-white_digits-6.png",white_digit_7:"#%n-white_digits-7.png",white_digit_8:"#%n-white_digits-8.png",white_digit_9:"#%n-white_digits-9.png"}},booster_digits:{urls:{},injectTo:["game"],frameIds:["booster_digit_0","booster_digit_1","booster_digit_2","booster_digit_3","booster_digit_4","booster_digit_5","booster_digit_6","booster_digit_7","booster_digit_8","booster_digit_9"],jsonIds:[],soundIds:[]},boosters_before:{urls:{},injectTo:["main"],frameIds:["booster_before_bg_png","booster_before_bg_on_png","booster_before_bg_off_png","booster_before_green_button_png","booster_before_purple_button_png","booster_before_check_icon_png","booster_before_plus_icon_png","booster_before_lantern_icon_png","booster_before_price_bg_png"],jsonIds:[],soundIds:["booster_before_selection_effect","booster_before_cancel_effect"]},boosters_sale:{urls:{png:"@%n-7f818a7784.png",
json:"@%n-37adcac2b0.json"},jsons:{balloon_json:"@jsons/balloon-989d1625e7.json",prize_json:"@jsons/%n_prize-7756df2619.json",plist:"@%n-7f818a7784.plist",atlas:"@%n-7f818a7784.atlas"},frames:{boosterssale_streak_bar_bg:"#%n-streak_bar_bg.png",boosterssale_streak_bar:"#%n-streak_bar.png",boosterssale_streak_bar_line:"#%n-streak_bar_line.png",badge_png:"#%n-tile_shop-shop_best_seller.png",product_bg_png:"#%n-tile_shop-shop_inner_bg.png",row_bg_png:"#%n-tile_shop-shop_bg_white.png"}},box:{urls:{png:"@%n-0b959f213d.png",json:"@%n-ce498df710.json"},jsons:{box_spine_json:"@jsons/%n-bc038a755d.json",atlas:"@%n-0b959f213d.atlas"}},browser_resources:{urls:{left_bg:{},right_bg:{},sidebar:{}}},burst:{urls:{burst_fill_effect:"~sounds/s_container_fill-11ce97136c.mp3",png:"@%n-f1095135b2.png",json:"@%n-1dcd011853.json"},jsons:{burst_json:"@jsons/gummachine-f71aaee491.json",burst_blast_json:"@jsons/gummachine_blast-98aa3d1901.json",plist:"@%n-f1095135b2.plist",atlas:"@%n-f1095135b2.atlas"},frames:{
burst_0:"#%n-images-gummachine_0.png",burst_1:"#%n-images-gummachine_1.png",burst_2:"#%n-images-gummachine_2.png",burst_3:"#%n-images-gummachine_3.png",ball_purple:"#%n-images-ball_pink_gummachine.png",ball_green:"#%n-images-ball_green_gummachine.png",ball_red:"#%n-images-ball_red_gummachine.png",ball_yellow:"#%n-images-ball_yellow_gummachine.png",ball_blue:"#%n-images-ball_blue_gummachine.png"}},buttons:{urls:{},injectTo:["game","main"],frameIds:["window_button_png","window_button_on_png","window_button_disabled_png"],jsonIds:[],soundIds:[]},buttons_main:{urls:{},injectTo:["main"],frameIds:["window_close_png","window_close_on_png","blue_button_png","blue_button_on_png","help_button_png","help_button_on_png","exit_button_icon","scene_exit_button","small_green_button","small_green_button_on","small_blue_button","small_blue_button_on","music_off_png","music_on_png","sound_off_png","sound_on_png","close_small","close_small_on","red_button","red_button_on","vibro_off_png","vibro_on_png"],
jsonIds:[],soundIds:[]},cake:{urls:{png:"@%n-93d6d57fba.png",json:"@%n-e1fe87587d.json"},jsons:{cake_splash_json:"@jsons/%n_splash-59ab6c1782.json",plist:"@%n-93d6d57fba.plist",atlas:"@%n-93d6d57fba.atlas"},frames:{cake_goal_png:"#%n-images-%n_goal.png",plate_png:"#%n-images-plate.png",cake_1_1_png:"#%n-images-%n_1_1.png",cake_1_2_png:"#%n-images-%n_1_2.png",cake_1_3_png:"#%n-images-%n_1_3.png",cake_2_1_png:"#%n-images-%n_2_1.png",cake_2_2_png:"#%n-images-%n_2_2.png",cake_2_3_png:"#%n-images-%n_2_3.png",cake_3_1_png:"#%n-images-%n_3_1.png",cake_3_2_png:"#%n-images-%n_3_2.png",cake_3_3_png:"#%n-images-%n_3_3.png",cake_4_1_png:"#%n-images-%n_4_1.png",cake_4_2_png:"#%n-images-%n_4_2.png",cake_4_3_png:"#%n-images-%n_4_3.png"}},candle:{urls:{png:"@%n-074021ddc3.png",json:"@%n-046c8c7e76.json"},jsons:{candle_json:"@jsons/%n-145d5e7ece.json",atlas:"@%n-074021ddc3.atlas"}},cannon:{urls:{png:"@%n-85c5b2dad1.png",json:"@%n-45b89a0bae.json"},jsons:{json:"@jsons/%n-b00e20b359.json",
plist:"@%n-85c5b2dad1.plist",atlas:"@%n-85c5b2dad1.atlas"},frames:{cannonBullet:"#%n-images-gun_mustard2.png"}},champion_window:{urls:{png:"@%n-6b898b3ba6.png",json:"@%n-1f849339d6.json"},jsons:{champion_spine_json:"@jsons/champion_1-d08f74eb44.json",atlas:"@%n-6b898b3ba6.atlas"}},chat:{urls:{window_bg:"@window_bg-122eed08e5.jpg",chatfont_ttf:{type:"font",name:"Rubic",srcs:["~%n/all/font.ttf","~%n/all/font.eot"]},png:"@%n-6e3d474d70.png",json:"@%n-f5429dbe4c.json"},jsons:{plist:"@%n-6e3d474d70.plist"},frames:{dialog_box_green:"#%n-dialog_box.png",dialog_box_white:"#%n-dialog_box_2.png",icon_back:"#%n-icon_back.png",icon_photo:"#%n-icon_photo.png",panel_off:"#%n-panel_off.png",panel_on:"#%n-panel_on.png",panelup:"#%n-panelup.png",paneldown:"#%n-paneldown.png",textbox:"#%n-textbox.png"}},clock:{urls:{png:"@%n-3daea11e20.png",json:"@%n-d09f9fb07a.json"},jsons:{clock_json:"@jsons/%n-2fb7b16459.json",petal_json:"@jsons/petal-bdea5bdf50.json",plist:"@%n-3daea11e20.plist",
atlas:"@%n-3daea11e20.atlas"},frames:{clock_goal:"#%n-images-%n_goal.png"}},color_bomb:{urls:{bomb_explosion:"~sounds/bombexplosion-e79f56d2ba.mp3",png:"@%n-7c1cad34eb.png",json:"@%n-0950c8249c.json"},jsons:{color_bomb_json:"@jsons/%n-7ccf9aaac0.json",plist:"@%n-7c1cad34eb.plist",atlas:"@%n-7c1cad34eb.atlas"},frames:{mark_on_colorcell:"#%n-mark-mark.png"}},color_container:{urls:{fill_effect:"~sounds/s_bottle_fill-23d2c6afee.mp3",collect_effect:"~sounds/s_chameleon_collect-bca9b4221b.mp3",png:"@%n-d734a3ca5b.png",json:"@%n-db95fb8ec8.json"},jsons:{color_container_json:"@jsons/%n-2a6913c84d.json",plist:"@%n-d734a3ca5b.plist",atlas:"@%n-d734a3ca5b.atlas"},frames:{color_container_goal:"#%n-images-%n_goal.png"}},colorcookieman:{urls:{png:"@%n-23669100d8.png",json:"@%n-3c2359c7ac.json"},jsons:{color_cookieman_spine_json:"@jsons/color_cookieman2-0660517f76.json",plist:"@%n-23669100d8.plist",atlas:"@%n-23669100d8.atlas"},frames:{color_cookieman_a:"#%n-images-cookieman_blue_stable.png",
color_cookieman_b:"#%n-images-cookieman_green_stable.png",color_cookieman_c:"#%n-images-cookieman_purple_stable.png",color_cookieman_d:"#%n-images-cookieman_red_stable.png",color_cookieman_e:"#%n-images-cookieman_yellow_stable.png",color_cookieman_w:"#%n-images-cookieman_white_stable.png",color_cookieman_goal:"#%n-images-cookieman_cells.png"}},comicses:{urls:{png:"@%n-edbfdde817.png",json:"@%n-61a7df9b5c.json"},jsons:{begin_json:"@jsons/begin-b622c30173.json",atlas:"@%n-edbfdde817.atlas"}},confirmexit_window:{urls:{png:"@%n-745abbfc7c.png",json:"@%n-8f2433b1dd.json"},jsons:{sad_candy_spine_json:"@jsons/sad_candy-53c190e5b8.json",atlas:"@%n-745abbfc7c.atlas"}},controlbuttons:{urls:{},injectTo:["game","main"],frameIds:["menu_icon_png","button_png","button_on_png","fullscreen_icon_png","back_button_png","back_button_on_png","back_icon_png"],jsonIds:[],soundIds:[]},cookieman:{urls:{png:"@%n-df3b450c8b.png",json:"@%n-c4d3631203.json"},jsons:{cookieman_spine_json:"@jsons/%n-818e616c2d.json",
plist:"@%n-df3b450c8b.plist",atlas:"@%n-df3b450c8b.atlas"},frames:{cookieman_stable:"#%n-images-%n_stable.png"}},crab_maker:{urls:{png:"@%n-8053fa95c4.png",json:"@%n-5214a623df.json"},jsons:{crab_maker_animation_json:"@jsons/worm_farm29-0a35a3f132.json",plist:"@%n-8053fa95c4.plist",atlas:"@%n-8053fa95c4.atlas"},frames:{crab_maker_stable_0:"#%n-images-%n_stable0.png",crab_maker_stable_1:"#%n-images-%n_stable1.png",crab_maker_stable_2:"#%n-images-%n_stable2.png",crab_maker_stable_3:"#%n-images-%n_stable0.png"}},cryptex:{urls:{}},daily_cup:{urls:{bg:"@%n_bg-259ed2b3c9.jpg",png:"@%n-3428669380.png",json:"@%n-7700a5a90f.json"},jsons:{daily_cup_json:"@jsons/%n-6ecd71aee2.json",plist:"@%n-3428669380.plist",atlas:"@%n-3428669380.atlas"},frames:{daily_cup_table_bg:"#%n-images-%n_table_bg.png",daily_cup_leaders_icon_png:"#%n-images-bonus_cup.png"}},dailytasks:{urls:{png:"@%n-ac70a3637c.png",json:"@%n-e7c6d8a93b.json"},jsons:{plist:"@%n-ac70a3637c.plist"},frames:{
daily_task_icon_0_png:"#%n-dailytask_fb_icon.png",daily_task_icon_1_png:"#%n-icon1.png",daily_task_icon_2_png:"#%n-icon2.png",daily_task_icon_3_png:"#%n-icon3.png",daily_task_icon_4_png:"#%n-level_open.png",daily_task_icon_6_png:"#%n-free_moves_friends.png",daily_task_icon_7_png:"#%n-adicon.png",daily_task_icon_13_png:"#%n-coin_task.png",missions_easy_bg_png:"#%n-mission-easy_frame_1.png",missions_medium_bg_png:"#%n-mission-medium_frame_1.png",missions_hard_bg_png:"#%n-mission-hard_frame_1.png",missions_frame_white_png:"#%n-mission-frame_white.png",missions_frame_green_png:"#%n-mission-frame_green.png",daily_task_icon_bg_png:"#%n-mission-icon_bg.png",daily_task_missions_easy_top_png:"#%n-mission-easy_top_1.png",daily_task_missions_medium_top_png:"#%n-mission-medium_top_1.png",daily_task_missions_hard_top_png:"#%n-mission-hard_top_1.png",daily_task_icon_5_png:"#%n-stars5.png",daily_task_icon_8_png:"#%n-colorful.png",daily_task_icon_9_0_png:"#%n-cell.png",
daily_task_icon_9_1_png:"#%n-line.png",daily_task_icon_9_2_png:"#%n-color.png",daily_task_icon_10_a_png:"#%n-blue.png",daily_task_icon_10_b_png:"#%n-green.png",daily_task_icon_10_c_png:"#%n-purple.png",daily_task_icon_10_d_png:"#%n-red.png",daily_task_icon_10_e_png:"#%n-yellow.png",daily_task_icon_10_w_png:"#%n-white.png",daily_task_icon_11_png:"#%n-checkpoint_icon.png",daily_task_icon_12_png:"#%n-1st_place.png",daily_task_icon_24_a_png:"#%n-hero_stable_a.png",daily_task_icon_24_b_png:"#%n-hero_stable_b.png",daily_task_icon_24_c_png:"#%n-hero_stable_c.png",daily_task_icon_24_d_png:"#%n-hero_stable_d.png",daily_task_icon_24_e_png:"#%n-hero_stable_e.png",daily_task_icon_24_w_png:"#%n-hero_stable_w.png",daily_task_cell_cake_png:"#%n-cell_cake_task.png",daily_task_cell_cookieman_png:"#%n-cell_cookieman_task.png",daily_task_cell_dragon_png:"#%n-cell_dragon_task.png",daily_task_cell_ice_png:"#%n-cell_ice_task.png",daily_task_cell_mouse_png:"#%n-cell_mouse_task.png",
daily_task_cell_muffin_png:"#%n-cell_muffin_task.png",daily_task_cell_waffles_png:"#%n-cell_waffles_task.png",daily_task_cell_colorcookieman_png:"#%n-cell_colorcookieman_task.png",daily_task_cell_truffle_png:"#%n-cell_truffle_task.png",daily_task_cell_lollipop_png:"#%n-cell_lollipop_task.png",daily_task_cell_dog_png:"#%n-cell_dog_task.png"}},dev_resources:{urls:{png:"@%n-0efe7e5928.png",json:"@%n-b5ad17e809.json"},jsons:{plist:"@%n-0efe7e5928.plist"},frames:{border:"#%n-border_2px.png",modes_slider_bg:"#%n-modes_slider_bg.png",modes_slider_selected:"#%n-modes_slider_selected.png"}},dialogues:{urls:{png:"@%n-467a0de39d.png",json:"@%n-f49a742202.json"},jsons:{default_json:"@jsons/yellow_tutorial-5441371aa8.json",dialogue_green_json:"@jsons/dialogue_green-50dd17b6fe.json",dialogue_purple_json:"@jsons/dialogue_purple-4c78f71c25.json",dialogue_red_json:"@jsons/dialogue_red-705a46c80d.json",dialogue_yellow_json:"@jsons/dialogue_yellow-9fb6e0a3a6.json",plist:"@%n-467a0de39d.plist",
atlas:"@%n-467a0de39d.atlas"},frames:{bg_png:"#%n-tutorial_text_bg.png",dialogue_name:"#%n-char_name_bg.png"},injectTo:!1},digits:{urls:{},injectTo:["tile_shop","game","main"],frameIds:["level_digit_0","level_digit_1","level_digit_2","level_digit_3","level_digit_4","level_digit_5","level_digit_6","level_digit_7","level_digit_8","level_digit_9","timer_digit_0","timer_digit_1","timer_digit_2","timer_digit_3","timer_digit_4","timer_digit_5","timer_digit_6","timer_digit_7","timer_digit_8","timer_digit_9","timer_digit_colon","timer_digit_slash","timer_digit_x"],jsonIds:[],soundIds:[]},digits_game:{urls:{},injectTo:["game"],frameIds:["white_digit_0","white_digit_1","white_digit_2","white_digit_3","white_digit_4","white_digit_5","white_digit_6","white_digit_7","white_digit_8","white_digit_9","white_digit_slash","white_digit_plus","white_digit_minus","moves_digit_0","moves_digit_1","moves_digit_2","moves_digit_3","moves_digit_4","moves_digit_5","moves_digit_6","moves_digit_7","moves_digit_8",
"moves_digit_9","goals_digit_0","goals_digit_1","goals_digit_2","goals_digit_3","goals_digit_4","goals_digit_5","goals_digit_6","goals_digit_7","goals_digit_8","goals_digit_9","goals_digit_slash"],jsonIds:[],soundIds:[]},dirt_maker:{urls:{png:"@%n-2b4377a2da.png",json:"@%n-cd66df2ed8.json"},jsons:{dirt_maker_spine_json:"@jsons/jam_jar-f7bdbf8afa.json",plist:"@%n-2b4377a2da.plist",atlas:"@%n-2b4377a2da.atlas"},frames:{dirt_blob:"#%n-images-splash_drop2_jam_jar.png",dirt_maker_stable_0:"#%n-images-jam_jar_stable0.png",dirt_maker_stable_1:"#%n-images-jam_jar_stable1.png",dirt_maker_stable_2:"#%n-images-jam_jar_stable2.png",dirt_maker_stable_3:"#%n-images-jam_jar_stable3.png"}},dog:{urls:{png:"@%n-cd16f0701a.png",json:"@%n-bda8687425.json"},jsons:{eater_spine_json:"@jsons/%n-8977b5f1d4.json",atlas:"@%n-cd16f0701a.atlas"}},donut_box:{urls:{donutBox_maker_fill_effect:"~sounds/s_container_fill-11ce97136c.mp3",png:"@%n-14b1f6ae5f.png",json:"@%n-85bb8c10b1.json"},jsons:{
donutBox_spine_json:"@jsons/%nx-43c679b723.json",plist:"@%n-14b1f6ae5f.plist",atlas:"@%n-14b1f6ae5f.atlas"},frames:{donutBox_0:"#%n-images-%n_0.png",donutBox_1:"#%n-images-%n_1.png",donutBox_2:"#%n-images-%n_2.png",donutBox_3:"#%n-images-%n_3.png",donutBox_4:"#%n-images-%n_4.png"}},dragon:{urls:{png:"@%n-bd431708d0.png",json:"@%n-028cc696ec.json"},jsons:{dragon_spine_json:"@jsons/%n-9f2dc0d299.json",plist:"@%n-bd431708d0.plist",atlas:"@%n-bd431708d0.atlas"},frames:{dragon_stable_png:"#%n-images-%n_stable.png",dragon_stable_goal_png:"#%n-images-%n_stable_goal.png"}},easter:{urls:{png:"@%n-9040f22ada.png",json:"@%n-a12fa30f22.json"},jsons:{tournament_rose_icon_json:"@jsons/icon_rose-588c20f70c.json",rose_tournament_json:"@jsons/rose_tournament-ca42f4887b.json",plist:"@%n-9040f22ada.plist",atlas:"@%n-9040f22ada.atlas"},frames:{toolbar_right:"#%n-toolbar_right.png",window_bottom_left:"#%n-window_bottom_left.png",window_bottom_right:"#%n-window_bottom_right.png",
rose_png:"#%n-gold_icon.png",rose_1:"#%n-gold1.png",rose_2:"#%n-gold2.png"}},editor:{urls:{png:"@%n-71ca08c57a.png",json:"@%n-bd2ccd440d.json"},jsons:{plist:"@%n-71ca08c57a.plist"},frames:{editor_button:"#%n-admin-regular_button.png",editor_select:"#%n-%n_select.png",editor_button_off:"#%n-%n_button_off.png",editor_button_on:"#%n-%n_button_on.png",editor_clear_icon:"#%n-%n_clear.png",editor_play_icon:"#%n-%n_play.png",editor_undo_icon:"#%n-undo.png",editor_arrow_left:"#%n-%n_arrow_left.png",editor_arrow_right:"#%n-%n_arrow_right.png",editor_arrow_up:"#%n-%n_arrow_up.png",editor_arrow_down:"#%n-%n_arrow_down.png",editor_plus_icon:"#%n-%n_plus.png",editor_minus_icon:"#%n-%n_minus.png",editor_tabs_button_off:"#%n-%n_cards_button_off.png",editor_tabs_button_on:"#%n-%n_cards_button_on.png",switch_state_button:"#%n-windows-graphics_switch.png"}},episode_0:{urls:{json:"~%n/all/%n-b89f2393de.json"},jsons:{levels:"~%n/all/jsons/0-b34b65874f.json"},episodeNo:0,levelsAmount:15,hard:[],
levelPositions:"levels_1"},episode_1:{urls:{json:"~%n/all/%n-b56725ba0b.json"},jsons:{levels:"~%n/all/jsons/1-48c500856c.json"},episodeNo:1,levelsAmount:15,hard:[1],levelPositions:"levels_2"},episode_10:{urls:{json:"~%n/all/%n-f550fcbb4a.json"},jsons:{levels:"~%n/all/jsons/10-509d30cfc3.json"},episodeNo:10,levelsAmount:15,hard:[4,14],levelPositions:"levels_1"},episode_100:{urls:{json:"~%n/all/%n-604a53c5d0.json"},jsons:{levels:"~%n/all/jsons/100-81f1ce17ca.json"},episodeNo:100,levelsAmount:15,hard:[0],levelPositions:"levels_1"},episode_101:{urls:{json:"~%n/all/%n-ec7a51d71b.json"},jsons:{levels:"~%n/all/jsons/101-87c7d45a74.json"},episodeNo:101,levelsAmount:15,hard:[3,9],levelPositions:"levels_2"},episode_102:{urls:{json:"~%n/all/%n-c9b94f44e4.json"},jsons:{levels:"~%n/all/jsons/102-ee7b30618a.json"},episodeNo:102,levelsAmount:15,hard:[9],levelPositions:"levels_1"},episode_103:{urls:{json:"~%n/all/%n-5add8f7acd.json"},jsons:{levels:"~%n/all/jsons/103-64fd5bf335.json"},episodeNo:103,
levelsAmount:15,hard:[1,7,12],levelPositions:"levels_2"},episode_104:{urls:{json:"~%n/all/%n-2e56c90668.json"},jsons:{levels:"~%n/all/jsons/104-5c8a4d07d0.json"},episodeNo:104,levelsAmount:15,hard:[12],levelPositions:"levels_1"},episode_105:{urls:{json:"~%n/all/%n-6f2ab7e523.json"},jsons:{levels:"~%n/all/jsons/105-caab5da267.json"},episodeNo:105,levelsAmount:15,hard:[4,11],levelPositions:"levels_2"},episode_106:{urls:{json:"~%n/all/%n-df0be70917.json"},jsons:{levels:"~%n/all/jsons/106-55a4b03571.json"},episodeNo:106,levelsAmount:15,hard:[5],levelPositions:"levels_1"},episode_107:{urls:{json:"~%n/all/%n-4cdc5ce3ec.json"},jsons:{levels:"~%n/all/jsons/107-6588500b4e.json"},episodeNo:107,levelsAmount:15,hard:[2,11],levelPositions:"levels_2"},episode_108:{urls:{json:"~%n/all/%n-f5d6b51a59.json"},jsons:{levels:"~%n/all/jsons/108-d77ad46e74.json"},episodeNo:108,levelsAmount:15,hard:[4,9],levelPositions:"levels_1"},episode_109:{urls:{json:"~%n/all/%n-d1de015e99.json"},jsons:{
levels:"~%n/all/jsons/109-611260bc90.json"},episodeNo:109,levelsAmount:15,hard:[8],levelPositions:"levels_2"},episode_11:{urls:{json:"~%n/all/%n-d63e9f4c2e.json"},jsons:{levels:"~%n/all/jsons/11-bd62c90fe6.json"},episodeNo:11,levelsAmount:15,hard:[2,14],levelPositions:"levels_2"},episode_110:{urls:{json:"~%n/all/%n-5d9e1d731b.json"},jsons:{levels:"~%n/all/jsons/110-fe9a9dc137.json"},episodeNo:110,levelsAmount:15,hard:[3,10],levelPositions:"levels_1"},episode_111:{urls:{json:"~%n/all/%n-95d14d1481.json"},jsons:{levels:"~%n/all/jsons/111-96c776673f.json"},episodeNo:111,levelsAmount:15,hard:[13],levelPositions:"levels_2"},episode_112:{urls:{json:"~%n/all/%n-f444c38b8b.json"},jsons:{levels:"~%n/all/jsons/112-f7e5a8dd82.json"},episodeNo:112,levelsAmount:15,hard:[4,8],levelPositions:"levels_1"},episode_113:{urls:{json:"~%n/all/%n-995bd1f592.json"},jsons:{levels:"~%n/all/jsons/113-c540284fbf.json"},episodeNo:113,levelsAmount:15,hard:[1],levelPositions:"levels_2"},episode_114:{urls:{
json:"~%n/all/%n-6d5150c967.json"},jsons:{levels:"~%n/all/jsons/114-ab6af1ef3e.json"},episodeNo:114,levelsAmount:15,hard:[0,10],levelPositions:"levels_1"},episode_115:{urls:{json:"~%n/all/%n-5d1928e83d.json"},jsons:{levels:"~%n/all/jsons/115-ee34f097b0.json"},episodeNo:115,levelsAmount:15,hard:[6],levelPositions:"levels_2"},episode_116:{urls:{json:"~%n/all/%n-7aaca8e36b.json"},jsons:{levels:"~%n/all/jsons/116-9f8fb719e0.json"},episodeNo:116,levelsAmount:15,hard:[0,11],levelPositions:"levels_1"},episode_117:{urls:{json:"~%n/all/%n-23178856d9.json"},jsons:{levels:"~%n/all/jsons/117-fffd181280.json"},episodeNo:117,levelsAmount:15,hard:[11],levelPositions:"levels_2"},episode_118:{urls:{json:"~%n/all/%n-4dd788894a.json"},jsons:{levels:"~%n/all/jsons/118-9411d03c53.json"},episodeNo:118,levelsAmount:15,hard:[4],levelPositions:"levels_1"},episode_119:{urls:{json:"~%n/all/%n-315efc4aea.json"},jsons:{levels:"~%n/all/jsons/119-4a5e4df84d.json"},episodeNo:119,levelsAmount:15,hard:[10],
levelPositions:"levels_2"},episode_12:{urls:{json:"~%n/all/%n-2063f96ee8.json"},jsons:{levels:"~%n/all/jsons/12-e58a951392.json"},episodeNo:12,levelsAmount:15,hard:[5,9],levelPositions:"levels_1"},episode_120:{urls:{json:"~%n/all/%n-3fc1f2ae34.json"},jsons:{levels:"~%n/all/jsons/120-be1bfbb252.json"},episodeNo:120,levelsAmount:15,hard:[0,12],levelPositions:"levels_1"},episode_121:{urls:{json:"~%n/all/%n-f9581006d3.json"},jsons:{levels:"~%n/all/jsons/121-d1e6441b16.json"},episodeNo:121,levelsAmount:15,hard:[6],levelPositions:"levels_2"},episode_122:{urls:{json:"~%n/all/%n-3f1a51ad01.json"},jsons:{levels:"~%n/all/jsons/122-e631470246.json"},episodeNo:122,levelsAmount:15,hard:[1,11],levelPositions:"levels_1"},episode_123:{urls:{json:"~%n/all/%n-4730e67316.json"},jsons:{levels:"~%n/all/jsons/123-f56a9bda4d.json"},episodeNo:123,levelsAmount:15,hard:[5],levelPositions:"levels_2"},episode_124:{urls:{json:"~%n/all/%n-bf260ac54d.json"},jsons:{levels:"~%n/all/jsons/124-e94ebe0d8f.json"},
episodeNo:124,levelsAmount:15,hard:[0,12],levelPositions:"levels_1"},episode_125:{urls:{json:"~%n/all/%n-ea39f4b73a.json"},jsons:{levels:"~%n/all/jsons/125-2c94022bf0.json"},episodeNo:125,levelsAmount:15,hard:[6],levelPositions:"levels_2"},episode_126:{urls:{json:"~%n/all/%n-926234eb3f.json"},jsons:{levels:"~%n/all/jsons/126-b124646374.json"},episodeNo:126,levelsAmount:15,hard:[7,14],levelPositions:"levels_1"},episode_127:{urls:{json:"~%n/all/%n-a143977a98.json"},jsons:{levels:"~%n/all/jsons/127-b0c41661ac.json"},episodeNo:127,levelsAmount:15,hard:[5],levelPositions:"levels_2"},episode_128:{urls:{json:"~%n/all/%n-ad77d3a1db.json"},jsons:{levels:"~%n/all/jsons/128-0a933e2bd8.json"},episodeNo:128,levelsAmount:15,hard:[13],levelPositions:"levels_1"},episode_129:{urls:{json:"~%n/all/%n-c492693e3e.json"},jsons:{levels:"~%n/all/jsons/129-9f6cc4e575.json"},episodeNo:129,levelsAmount:15,hard:[6,12],levelPositions:"levels_2"},episode_13:{urls:{json:"~%n/all/%n-baa7df21f3.json"},jsons:{
levels:"~%n/all/jsons/13-44c00349d6.json"},episodeNo:13,levelsAmount:15,hard:[3,8],levelPositions:"levels_2"},episode_130:{urls:{json:"~%n/all/%n-9d0476e89e.json"},jsons:{levels:"~%n/all/jsons/130-bef5e12c2d.json"},episodeNo:130,levelsAmount:15,hard:[8,13],levelPositions:"levels_1"},episode_131:{urls:{json:"~%n/all/%n-7ccf2e25e9.json"},jsons:{levels:"~%n/all/jsons/131-1bc8ba58a1.json"},episodeNo:131,levelsAmount:15,hard:[2,12],levelPositions:"levels_2"},episode_132:{urls:{json:"~%n/all/%n-c091aae327.json"},jsons:{levels:"~%n/all/jsons/132-9c57fba223.json"},episodeNo:132,levelsAmount:15,hard:[4,12],levelPositions:"levels_1"},episode_133:{urls:{json:"~%n/all/%n-29b60c4325.json"},jsons:{levels:"~%n/all/jsons/133-2661935dbb.json"},episodeNo:133,levelsAmount:15,hard:[6,11],levelPositions:"levels_2"},episode_134:{urls:{json:"~%n/all/%n-1cc0a96d4a.json"},jsons:{levels:"~%n/all/jsons/134-f118bf5d52.json"},episodeNo:134,levelsAmount:15,hard:[6],levelPositions:"levels_1"},episode_135:{urls:{
json:"~%n/all/%n-2d67fdfef9.json"},jsons:{levels:"~%n/all/jsons/135-805971c234.json"},episodeNo:135,levelsAmount:15,hard:[10],levelPositions:"levels_2"},episode_136:{urls:{json:"~%n/all/%n-f57f110377.json"},jsons:{levels:"~%n/all/jsons/136-c8b5066688.json"},episodeNo:136,levelsAmount:15,hard:[7,14],levelPositions:"levels_1"},episode_137:{urls:{json:"~%n/all/%n-a7c176d5db.json"},jsons:{levels:"~%n/all/jsons/137-469269142b.json"},episodeNo:137,levelsAmount:15,hard:[3],levelPositions:"levels_2"},episode_138:{urls:{json:"~%n/all/%n-17d46eb96e.json"},jsons:{levels:"~%n/all/jsons/138-02aceda187.json"},episodeNo:138,levelsAmount:15,hard:[10],levelPositions:"levels_1"},episode_139:{urls:{json:"~%n/all/%n-276dd8e1be.json"},jsons:{levels:"~%n/all/jsons/139-f5a79a93f9.json"},episodeNo:139,levelsAmount:15,hard:[4,10],levelPositions:"levels_2"},episode_14:{urls:{json:"~%n/all/%n-3f7c0f0439.json"},jsons:{levels:"~%n/all/jsons/14-ddd24aa3c0.json"},episodeNo:14,levelsAmount:15,hard:[2,12],
levelPositions:"levels_1"},episode_140:{urls:{json:"~%n/all/%n-5fd1a44324.json"},jsons:{levels:"~%n/all/jsons/140-d7ac094d03.json"},episodeNo:140,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_141:{urls:{json:"~%n/all/%n-02fdaeda62.json"},jsons:{levels:"~%n/all/jsons/141-9cd2b167e7.json"},episodeNo:141,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_142:{urls:{json:"~%n/all/%n-7235b340e4.json"},jsons:{levels:"~%n/all/jsons/142-084ec6f6a1.json"},episodeNo:142,levelsAmount:15,hard:[4,11],levelPositions:"levels_1"},episode_143:{urls:{json:"~%n/all/%n-d785b43724.json"},jsons:{levels:"~%n/all/jsons/143-000646b63a.json"},episodeNo:143,levelsAmount:15,hard:[11],levelPositions:"levels_2"},episode_144:{urls:{json:"~%n/all/%n-8eeee4ec80.json"},jsons:{levels:"~%n/all/jsons/144-7c67cfd358.json"},episodeNo:144,levelsAmount:15,hard:[0,11],levelPositions:"levels_1"},episode_145:{urls:{json:"~%n/all/%n-cc6e65804e.json"},jsons:{levels:"~%n/all/jsons/145-d1cb33a3f5.json"},
episodeNo:145,levelsAmount:15,hard:[0,7],levelPositions:"levels_2"},episode_146:{urls:{json:"~%n/all/%n-06568d24a0.json"},jsons:{levels:"~%n/all/jsons/146-1bb729a95c.json"},episodeNo:146,levelsAmount:15,hard:[4],levelPositions:"levels_1"},episode_147:{urls:{json:"~%n/all/%n-b8c32c48d5.json"},jsons:{levels:"~%n/all/jsons/147-7c57bdb4d8.json"},episodeNo:147,levelsAmount:15,hard:[4,14],levelPositions:"levels_2"},episode_148:{urls:{json:"~%n/all/%n-03c8a9b232.json"},jsons:{levels:"~%n/all/jsons/148-ffd3e34fa8.json"},episodeNo:148,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_149:{urls:{json:"~%n/all/%n-353f23f41b.json"},jsons:{levels:"~%n/all/jsons/149-4a89413bb1.json"},episodeNo:149,levelsAmount:15,hard:[6],levelPositions:"levels_2"},episode_15:{urls:{json:"~%n/all/%n-1a47cd7b21.json"},jsons:{levels:"~%n/all/jsons/15-7c542b0223.json"},episodeNo:15,levelsAmount:15,hard:[6,14],levelPositions:"levels_2"},episode_150:{urls:{json:"~%n/all/%n-955e35b3ef.json"},jsons:{
levels:"~%n/all/jsons/150-67ae0bd7a4.json"},episodeNo:150,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_151:{urls:{json:"~%n/all/%n-e0827c0ce4.json"},jsons:{levels:"~%n/all/jsons/151-07c0b1b4f0.json"},episodeNo:151,levelsAmount:15,hard:[11],levelPositions:"levels_2"},episode_152:{urls:{json:"~%n/all/%n-ce8a4b25db.json"},jsons:{levels:"~%n/all/jsons/152-c4ab1d3b43.json"},episodeNo:152,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_153:{urls:{json:"~%n/all/%n-c40d9e4598.json"},jsons:{levels:"~%n/all/jsons/153-6b55098d98.json"},episodeNo:153,levelsAmount:15,hard:[2],levelPositions:"levels_2"},episode_154:{urls:{json:"~%n/all/%n-fdb1743716.json"},jsons:{levels:"~%n/all/jsons/154-b31ccbf515.json"},episodeNo:154,levelsAmount:15,hard:[6,14],levelPositions:"levels_1"},episode_155:{urls:{json:"~%n/all/%n-b0774a1c8e.json"},jsons:{levels:"~%n/all/jsons/155-efd3959698.json"},episodeNo:155,levelsAmount:15,hard:[9],levelPositions:"levels_2"},episode_156:{urls:{
json:"~%n/all/%n-6b18e36a7a.json"},jsons:{levels:"~%n/all/jsons/156-e36f9c6ea5.json"},episodeNo:156,levelsAmount:15,hard:[9],levelPositions:"levels_1"},episode_157:{urls:{json:"~%n/all/%n-a4b1662dd5.json"},jsons:{levels:"~%n/all/jsons/157-e0c8aa7fb2.json"},episodeNo:157,levelsAmount:15,hard:[3],levelPositions:"levels_2"},episode_158:{urls:{json:"~%n/all/%n-3677312f1a.json"},jsons:{levels:"~%n/all/jsons/158-aba77c9f5c.json"},episodeNo:158,levelsAmount:15,hard:[2,10],levelPositions:"levels_1"},episode_159:{urls:{json:"~%n/all/%n-7ddf2c3056.json"},jsons:{levels:"~%n/all/jsons/159-2993ca8cae.json"},episodeNo:159,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_16:{urls:{json:"~%n/all/%n-168c1fcc0a.json"},jsons:{levels:"~%n/all/jsons/16-ffe5c38430.json"},episodeNo:16,levelsAmount:15,hard:[5,12],levelPositions:"levels_1"},episode_160:{urls:{json:"~%n/all/%n-0fb7e308b5.json"},jsons:{levels:"~%n/all/jsons/160-cea203fd3c.json"},episodeNo:160,levelsAmount:15,hard:[0,9],
levelPositions:"levels_1"},episode_161:{urls:{json:"~%n/all/%n-af4f650ede.json"},jsons:{levels:"~%n/all/jsons/161-570497f15b.json"},episodeNo:161,levelsAmount:15,hard:[13],levelPositions:"levels_2"},episode_162:{urls:{json:"~%n/all/%n-ff3d396fbf.json"},jsons:{levels:"~%n/all/jsons/162-aa29ae7761.json"},episodeNo:162,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_163:{urls:{json:"~%n/all/%n-2f9869c2cd.json"},jsons:{levels:"~%n/all/jsons/163-7e08e4e7a2.json"},episodeNo:163,levelsAmount:15,hard:[6],levelPositions:"levels_2"},episode_164:{urls:{json:"~%n/all/%n-5a1dbd5604.json"},jsons:{levels:"~%n/all/jsons/164-46c88dbadc.json"},episodeNo:164,levelsAmount:15,hard:[0,7],levelPositions:"levels_1"},episode_165:{urls:{json:"~%n/all/%n-67df091fbe.json"},jsons:{levels:"~%n/all/jsons/165-de7fd76fa4.json"},episodeNo:165,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_166:{urls:{json:"~%n/all/%n-35545d6120.json"},jsons:{levels:"~%n/all/jsons/166-6c94353a52.json"},
episodeNo:166,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_167:{urls:{json:"~%n/all/%n-b30315cd6d.json"},jsons:{levels:"~%n/all/jsons/167-1d9c6a5922.json"},episodeNo:167,levelsAmount:15,hard:[5],levelPositions:"levels_2"},episode_168:{urls:{json:"~%n/all/%n-43034e56a7.json"},jsons:{levels:"~%n/all/jsons/168-169c0f85e9.json"},episodeNo:168,levelsAmount:15,hard:[5],levelPositions:"levels_1"},episode_169:{urls:{json:"~%n/all/%n-198b79c082.json"},jsons:{levels:"~%n/all/jsons/169-50488220ac.json"},episodeNo:169,levelsAmount:15,hard:[3,13],levelPositions:"levels_2"},episode_17:{urls:{json:"~%n/all/%n-5d812a8827.json"},jsons:{levels:"~%n/all/jsons/17-798591e1e0.json"},episodeNo:17,levelsAmount:15,hard:[1,9],levelPositions:"levels_2"},episode_170:{urls:{json:"~%n/all/%n-ac6c6e5472.json"},jsons:{levels:"~%n/all/jsons/170-e6691546c2.json"},episodeNo:170,levelsAmount:15,hard:[3,9],levelPositions:"levels_1"},episode_171:{urls:{json:"~%n/all/%n-2b03bb625a.json"},jsons:{
levels:"~%n/all/jsons/171-a6b2ecaf9a.json"},episodeNo:171,levelsAmount:15,hard:[1,14],levelPositions:"levels_2"},episode_172:{urls:{json:"~%n/all/%n-e88c802411.json"},jsons:{levels:"~%n/all/jsons/172-d4e032109b.json"},episodeNo:172,levelsAmount:15,hard:[1,10],levelPositions:"levels_1"},episode_173:{urls:{json:"~%n/all/%n-8bfc09a5a7.json"},jsons:{levels:"~%n/all/jsons/173-8e8799a409.json"},episodeNo:173,levelsAmount:15,hard:[1,7,14],levelPositions:"levels_2"},episode_174:{urls:{json:"~%n/all/%n-3d4c41a9c7.json"},jsons:{levels:"~%n/all/jsons/174-8e094aed00.json"},episodeNo:174,levelsAmount:15,hard:[14],levelPositions:"levels_1"},episode_175:{urls:{json:"~%n/all/%n-d7ebedc359.json"},jsons:{levels:"~%n/all/jsons/175-89b7958342.json"},episodeNo:175,levelsAmount:15,hard:[3,11],levelPositions:"levels_2"},episode_176:{urls:{json:"~%n/all/%n-c97c8c36c6.json"},jsons:{levels:"~%n/all/jsons/176-074ac6ccec.json"},episodeNo:176,levelsAmount:15,hard:[1,9],levelPositions:"levels_1"},episode_177:{
urls:{json:"~%n/all/%n-b902e56c0b.json"},jsons:{levels:"~%n/all/jsons/177-335476a248.json"},episodeNo:177,levelsAmount:15,hard:[5],levelPositions:"levels_2"},episode_178:{urls:{json:"~%n/all/%n-caa2b4cb9b.json"},jsons:{levels:"~%n/all/jsons/178-b0c6ef5bf9.json"},episodeNo:178,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_179:{urls:{json:"~%n/all/%n-44b584ecb4.json"},jsons:{levels:"~%n/all/jsons/179-461f0ca7ee.json"},episodeNo:179,levelsAmount:15,hard:[14],levelPositions:"levels_2"},episode_18:{urls:{json:"~%n/all/%n-da564a90e9.json"},jsons:{levels:"~%n/all/jsons/18-965e0b652b.json"},episodeNo:18,levelsAmount:15,hard:[4,9],levelPositions:"levels_1"},episode_180:{urls:{json:"~%n/all/%n-22a8d4761f.json"},jsons:{levels:"~%n/all/jsons/180-2b95196838.json"},episodeNo:180,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_181:{urls:{json:"~%n/all/%n-7d9fbca9da.json"},jsons:{levels:"~%n/all/jsons/181-fdd0d9b0e5.json"},episodeNo:181,levelsAmount:15,hard:[4],
levelPositions:"levels_2"},episode_182:{urls:{json:"~%n/all/%n-8b002a866f.json"},jsons:{levels:"~%n/all/jsons/182-7092fba438.json"},episodeNo:182,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_183:{urls:{json:"~%n/all/%n-de57416153.json"},jsons:{levels:"~%n/all/jsons/183-171da9f7ae.json"},episodeNo:183,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_184:{urls:{json:"~%n/all/%n-d88b26dadb.json"},jsons:{levels:"~%n/all/jsons/184-22b658ee7f.json"},episodeNo:184,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_185:{urls:{json:"~%n/all/%n-092fdb594f.json"},jsons:{levels:"~%n/all/jsons/185-cc7400255e.json"},episodeNo:185,levelsAmount:15,hard:[7],levelPositions:"levels_2"},episode_186:{urls:{json:"~%n/all/%n-5f5bdbf7a2.json"},jsons:{levels:"~%n/all/jsons/186-fcce5338fd.json"},episodeNo:186,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_187:{urls:{json:"~%n/all/%n-38877a7e97.json"},jsons:{levels:"~%n/all/jsons/187-a732de6eaa.json"},episodeNo:187,
levelsAmount:15,hard:[8],levelPositions:"levels_2"},episode_188:{urls:{json:"~%n/all/%n-a6f44c4d99.json"},jsons:{levels:"~%n/all/jsons/188-3a37ea5e2d.json"},episodeNo:188,levelsAmount:15,hard:[1],levelPositions:"levels_1"},episode_189:{urls:{json:"~%n/all/%n-6fdb0e14c6.json"},jsons:{levels:"~%n/all/jsons/189-fe65f6eecc.json"},episodeNo:189,levelsAmount:15,hard:[4,11],levelPositions:"levels_2"},episode_19:{urls:{json:"~%n/all/%n-3518961cd1.json"},jsons:{levels:"~%n/all/jsons/19-807bb73799.json"},episodeNo:19,levelsAmount:15,hard:[6,8],levelPositions:"levels_2"},episode_190:{urls:{json:"~%n/all/%n-a7ab80594f.json"},jsons:{levels:"~%n/all/jsons/190-7742da3874.json"},episodeNo:190,levelsAmount:15,hard:[2,10],levelPositions:"levels_1"},episode_191:{urls:{json:"~%n/all/%n-04d5323d3c.json"},jsons:{levels:"~%n/all/jsons/191-26f8c3b5be.json"},episodeNo:191,levelsAmount:15,hard:[7],levelPositions:"levels_2"},episode_192:{urls:{json:"~%n/all/%n-c362324828.json"},jsons:{
levels:"~%n/all/jsons/192-bddcf8a2b0.json"},episodeNo:192,levelsAmount:15,hard:[0,5,9],levelPositions:"levels_1"},episode_193:{urls:{json:"~%n/all/%n-fd640daa2c.json"},jsons:{levels:"~%n/all/jsons/193-6af26acda2.json"},episodeNo:193,levelsAmount:15,hard:[3,12],levelPositions:"levels_2"},episode_194:{urls:{json:"~%n/all/%n-d77669bee8.json"},jsons:{levels:"~%n/all/jsons/194-ff0aa4d401.json"},episodeNo:194,levelsAmount:15,hard:[2,6,8,12],levelPositions:"levels_1"},episode_195:{urls:{json:"~%n/all/%n-4d93c63d11.json"},jsons:{levels:"~%n/all/jsons/195-7141251422.json"},episodeNo:195,levelsAmount:15,hard:[5],levelPositions:"levels_2"},episode_196:{urls:{json:"~%n/all/%n-758a430878.json"},jsons:{levels:"~%n/all/jsons/196-447c69929f.json"},episodeNo:196,levelsAmount:15,hard:[1,12],levelPositions:"levels_1"},episode_197:{urls:{json:"~%n/all/%n-a1fd7e977b.json"},jsons:{levels:"~%n/all/jsons/197-79b8b2a005.json"},episodeNo:197,levelsAmount:15,hard:[0,7],levelPositions:"levels_2"},episode_198:{
urls:{json:"~%n/all/%n-1b77932e47.json"},jsons:{levels:"~%n/all/jsons/198-c331b4121f.json"},episodeNo:198,levelsAmount:15,hard:[5,11],levelPositions:"levels_1"},episode_199:{urls:{json:"~%n/all/%n-db942870d2.json"},jsons:{levels:"~%n/all/jsons/199-c100403237.json"},episodeNo:199,levelsAmount:15,hard:[1,9],levelPositions:"levels_2"},episode_2:{urls:{json:"~%n/all/%n-c09314f496.json"},jsons:{levels:"~%n/all/jsons/2-bffd3c252e.json"},episodeNo:2,levelsAmount:15,hard:[12],levelPositions:"levels_1"},episode_20:{urls:{json:"~%n/all/%n-d13f0c4e53.json"},jsons:{levels:"~%n/all/jsons/20-4ba568b8a3.json"},episodeNo:20,levelsAmount:15,hard:[6,11],levelPositions:"levels_1"},episode_200:{urls:{json:"~%n/all/%n-a2e0b7d8c4.json"},jsons:{levels:"~%n/all/jsons/200-f1dc6952a4.json"},episodeNo:200,levelsAmount:15,hard:[1,9],levelPositions:"levels_1"},episode_201:{urls:{json:"~%n/all/%n-3bdd9501af.json"},jsons:{levels:"~%n/all/jsons/201-1152edfb74.json"},episodeNo:201,levelsAmount:15,hard:[4,13],
levelPositions:"levels_2"},episode_202:{urls:{json:"~%n/all/%n-34e6b511bb.json"},jsons:{levels:"~%n/all/jsons/202-a58d35dfb9.json"},episodeNo:202,levelsAmount:15,hard:[3,11],levelPositions:"levels_1"},episode_203:{urls:{json:"~%n/all/%n-609a3cb626.json"},jsons:{levels:"~%n/all/jsons/203-3340361abd.json"},episodeNo:203,levelsAmount:15,hard:[5],levelPositions:"levels_2"},episode_204:{urls:{json:"~%n/all/%n-cd40c302fc.json"},jsons:{levels:"~%n/all/jsons/204-7515871d37.json"},episodeNo:204,levelsAmount:15,hard:[2],levelPositions:"levels_1"},episode_205:{urls:{json:"~%n/all/%n-22acadd369.json"},jsons:{levels:"~%n/all/jsons/205-6ce815c40e.json"},episodeNo:205,levelsAmount:15,hard:[2],levelPositions:"levels_2"},episode_206:{urls:{json:"~%n/all/%n-e6463e0b8b.json"},jsons:{levels:"~%n/all/jsons/206-56750f7f64.json"},episodeNo:206,levelsAmount:15,hard:[1],levelPositions:"levels_1"},episode_207:{urls:{json:"~%n/all/%n-85e808a3f3.json"},jsons:{levels:"~%n/all/jsons/207-dfcc05a890.json"},
episodeNo:207,levelsAmount:15,hard:[2,6],levelPositions:"levels_2"},episode_208:{urls:{json:"~%n/all/%n-f4f30e36aa.json"},jsons:{levels:"~%n/all/jsons/208-0afa49e82e.json"},episodeNo:208,levelsAmount:15,hard:[5],levelPositions:"levels_1"},episode_209:{urls:{json:"~%n/all/%n-8d64e1769e.json"},jsons:{levels:"~%n/all/jsons/209-035ceafc7b.json"},episodeNo:209,levelsAmount:15,hard:[10],levelPositions:"levels_2"},episode_21:{urls:{json:"~%n/all/%n-9396515b91.json"},jsons:{levels:"~%n/all/jsons/21-b705b0078e.json"},episodeNo:21,levelsAmount:15,hard:[7],levelPositions:"levels_2"},episode_210:{urls:{json:"~%n/all/%n-267a48b44c.json"},jsons:{levels:"~%n/all/jsons/210-6a3b2b4d5d.json"},episodeNo:210,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_211:{urls:{json:"~%n/all/%n-27646c49bc.json"},jsons:{levels:"~%n/all/jsons/211-0853a6defc.json"},episodeNo:211,levelsAmount:15,hard:[10],levelPositions:"levels_2"},episode_212:{urls:{json:"~%n/all/%n-408048ec2d.json"},jsons:{
levels:"~%n/all/jsons/212-22b47ae69d.json"},episodeNo:212,levelsAmount:15,hard:[3,14],levelPositions:"levels_1"},episode_213:{urls:{json:"~%n/all/%n-edbf073d61.json"},jsons:{levels:"~%n/all/jsons/213-e6606ba62b.json"},episodeNo:213,levelsAmount:15,hard:[13],levelPositions:"levels_2"},episode_214:{urls:{json:"~%n/all/%n-1e1b07e215.json"},jsons:{levels:"~%n/all/jsons/214-598b5d806e.json"},episodeNo:214,levelsAmount:15,hard:[3,12],levelPositions:"levels_1"},episode_215:{urls:{json:"~%n/all/%n-eb0341a53d.json"},jsons:{levels:"~%n/all/jsons/215-619d0d6da5.json"},episodeNo:215,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_216:{urls:{json:"~%n/all/%n-7b4fdd19b4.json"},jsons:{levels:"~%n/all/jsons/216-d1b8edc7ea.json"},episodeNo:216,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_217:{urls:{json:"~%n/all/%n-d40b2e72b4.json"},jsons:{levels:"~%n/all/jsons/217-1c1793b3dd.json"},episodeNo:217,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_218:{urls:{
json:"~%n/all/%n-bcd65ac25a.json"},jsons:{levels:"~%n/all/jsons/218-141111362b.json"},episodeNo:218,levelsAmount:15,hard:[2],levelPositions:"levels_1"},episode_219:{urls:{json:"~%n/all/%n-3fce0c8fd1.json"},jsons:{levels:"~%n/all/jsons/219-92f6a72c43.json"},episodeNo:219,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_22:{urls:{json:"~%n/all/%n-861e1904bc.json"},jsons:{levels:"~%n/all/jsons/22-d9d4e0936b.json"},episodeNo:22,levelsAmount:15,hard:[4,14],levelPositions:"levels_1"},episode_220:{urls:{json:"~%n/all/%n-4ea69cd143.json"},jsons:{levels:"~%n/all/jsons/220-0907eb38c9.json"},episodeNo:220,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_221:{urls:{json:"~%n/all/%n-1928d49d1a.json"},jsons:{levels:"~%n/all/jsons/221-7f1fa3775f.json"},episodeNo:221,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_222:{urls:{json:"~%n/all/%n-c013c7cc89.json"},jsons:{levels:"~%n/all/jsons/222-81fe2cf1d8.json"},episodeNo:222,levelsAmount:15,hard:[],
levelPositions:"levels_1"},episode_223:{urls:{json:"~%n/all/%n-153381bf0a.json"},jsons:{levels:"~%n/all/jsons/223-5d4a7e1fd9.json"},episodeNo:223,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_224:{urls:{json:"~%n/all/%n-fc28b1dab8.json"},jsons:{levels:"~%n/all/jsons/224-a28e9d8253.json"},episodeNo:224,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_225:{urls:{json:"~%n/all/%n-a494070f42.json"},jsons:{levels:"~%n/all/jsons/225-7dddbe4e56.json"},episodeNo:225,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_226:{urls:{json:"~%n/all/%n-5559659d6f.json"},jsons:{levels:"~%n/all/jsons/226-4d6a3e863e.json"},episodeNo:226,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_227:{urls:{json:"~%n/all/%n-881c25a7b6.json"},jsons:{levels:"~%n/all/jsons/227-77620bd4c8.json"},episodeNo:227,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_228:{urls:{json:"~%n/all/%n-c7302eac81.json"},jsons:{levels:"~%n/all/jsons/228-576d3ec3a1.json"},episodeNo:228,
levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_229:{urls:{json:"~%n/all/%n-1a045d8d2f.json"},jsons:{levels:"~%n/all/jsons/229-554fa3dfc7.json"},episodeNo:229,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_23:{urls:{json:"~%n/all/%n-327ff6ef16.json"},jsons:{levels:"~%n/all/jsons/23-94701381c6.json"},episodeNo:23,levelsAmount:15,hard:[3,11],levelPositions:"levels_2"},episode_230:{urls:{json:"~%n/all/%n-7f1a03ab0a.json"},jsons:{levels:"~%n/all/jsons/230-b4b6678d6e.json"},episodeNo:230,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_24:{urls:{json:"~%n/all/%n-72369f3213.json"},jsons:{levels:"~%n/all/jsons/24-b65cfd9bad.json"},episodeNo:24,levelsAmount:15,hard:[0,8,14],levelPositions:"levels_1"},episode_25:{urls:{json:"~%n/all/%n-bb98ef8f75.json"},jsons:{levels:"~%n/all/jsons/25-5a7eb302b4.json"},episodeNo:25,levelsAmount:15,hard:[3,9],levelPositions:"levels_2"},episode_26:{urls:{json:"~%n/all/%n-3639fe8bad.json"},jsons:{
levels:"~%n/all/jsons/26-76c8cf0bb1.json"},episodeNo:26,levelsAmount:15,hard:[3,14],levelPositions:"levels_1"},episode_27:{urls:{json:"~%n/all/%n-efef030052.json"},jsons:{levels:"~%n/all/jsons/27-f9fcc7a8ff.json"},episodeNo:27,levelsAmount:15,hard:[8],levelPositions:"levels_2"},episode_28:{urls:{json:"~%n/all/%n-af5602b0b4.json"},jsons:{levels:"~%n/all/jsons/28-0b1b1b70e2.json"},episodeNo:28,levelsAmount:15,hard:[7],levelPositions:"levels_1"},episode_29:{urls:{json:"~%n/all/%n-9ef450e928.json"},jsons:{levels:"~%n/all/jsons/29-95f1f0badd.json"},episodeNo:29,levelsAmount:15,hard:[8,14],levelPositions:"levels_2"},episode_3:{urls:{json:"~%n/all/%n-85968e1137.json"},jsons:{levels:"~%n/all/jsons/3-5e2bed457c.json"},episodeNo:3,levelsAmount:15,hard:[11],levelPositions:"levels_2"},episode_30:{urls:{json:"~%n/all/%n-e00adbc138.json"},jsons:{levels:"~%n/all/jsons/30-812fe61bd2.json"},episodeNo:30,levelsAmount:15,hard:[3,13],levelPositions:"levels_1"},episode_31:{urls:{
json:"~%n/all/%n-2c483e14c9.json"},jsons:{levels:"~%n/all/jsons/31-c571cd18ad.json"},episodeNo:31,levelsAmount:15,hard:[1,14],levelPositions:"levels_2"},episode_32:{urls:{json:"~%n/all/%n-53bc5001cf.json"},jsons:{levels:"~%n/all/jsons/32-9c2da60c65.json"},episodeNo:32,levelsAmount:15,hard:[5,9],levelPositions:"levels_1"},episode_33:{urls:{json:"~%n/all/%n-8f2948b5c7.json"},jsons:{levels:"~%n/all/jsons/33-b4e52983a1.json"},episodeNo:33,levelsAmount:15,hard:[4,7],levelPositions:"levels_2"},episode_34:{urls:{json:"~%n/all/%n-5157244950.json"},jsons:{levels:"~%n/all/jsons/34-9e7a56a165.json"},episodeNo:34,levelsAmount:15,hard:[1],levelPositions:"levels_1"},episode_35:{urls:{json:"~%n/all/%n-c2668caabe.json"},jsons:{levels:"~%n/all/jsons/35-35b38e1ecb.json"},episodeNo:35,levelsAmount:15,hard:[10,14],levelPositions:"levels_2"},episode_36:{urls:{json:"~%n/all/%n-7c93824ecd.json"},jsons:{levels:"~%n/all/jsons/36-c51611ef4f.json"},episodeNo:36,levelsAmount:15,hard:[2,4,6],
levelPositions:"levels_1"},episode_37:{urls:{json:"~%n/all/%n-b3875ac0fd.json"},jsons:{levels:"~%n/all/jsons/37-1efcf32801.json"},episodeNo:37,levelsAmount:15,hard:[5,12],levelPositions:"levels_2"},episode_38:{urls:{json:"~%n/all/%n-09e9d91254.json"},jsons:{levels:"~%n/all/jsons/38-2a33048419.json"},episodeNo:38,levelsAmount:15,hard:[11,13],levelPositions:"levels_1"},episode_39:{urls:{json:"~%n/all/%n-a700738caf.json"},jsons:{levels:"~%n/all/jsons/39-3c611a996a.json"},episodeNo:39,levelsAmount:15,hard:[2,7],levelPositions:"levels_2"},episode_4:{urls:{json:"~%n/all/%n-0e9c2b123a.json"},jsons:{levels:"~%n/all/jsons/4-7e88818451.json"},episodeNo:4,levelsAmount:15,hard:[7],levelPositions:"levels_1"},episode_40:{urls:{json:"~%n/all/%n-a27030d6e4.json"},jsons:{levels:"~%n/all/jsons/40-b9b52faed2.json"},episodeNo:40,levelsAmount:15,hard:[9,11,14],levelPositions:"levels_1"},episode_41:{urls:{json:"~%n/all/%n-06187f107f.json"},jsons:{levels:"~%n/all/jsons/41-c8822d8ece.json"},episodeNo:41,
levelsAmount:15,hard:[3,11],levelPositions:"levels_2"},episode_42:{urls:{json:"~%n/all/%n-2305546085.json"},jsons:{levels:"~%n/all/jsons/42-bcf2373421.json"},episodeNo:42,levelsAmount:15,hard:[9,13],levelPositions:"levels_1"},episode_43:{urls:{json:"~%n/all/%n-a95ce9ed00.json"},jsons:{levels:"~%n/all/jsons/43-3d69f85b6d.json"},episodeNo:43,levelsAmount:15,hard:[10],levelPositions:"levels_2"},episode_44:{urls:{json:"~%n/all/%n-1b2684ad0b.json"},jsons:{levels:"~%n/all/jsons/44-6e2d2fb287.json"},episodeNo:44,levelsAmount:15,hard:[5,9],levelPositions:"levels_1"},episode_45:{urls:{json:"~%n/all/%n-243218f089.json"},jsons:{levels:"~%n/all/jsons/45-78b013456e.json"},episodeNo:45,levelsAmount:15,hard:[4,8],levelPositions:"levels_2"},episode_46:{urls:{json:"~%n/all/%n-854d6c7fe1.json"},jsons:{levels:"~%n/all/jsons/46-8d0a440c1d.json"},episodeNo:46,levelsAmount:15,hard:[12],levelPositions:"levels_1"},episode_47:{urls:{json:"~%n/all/%n-488f02fc7d.json"},jsons:{
levels:"~%n/all/jsons/47-ec885b6f6a.json"},episodeNo:47,levelsAmount:15,hard:[3,5,12],levelPositions:"levels_2"},episode_48:{urls:{json:"~%n/all/%n-352fade8c6.json"},jsons:{levels:"~%n/all/jsons/48-8da43ede98.json"},episodeNo:48,levelsAmount:15,hard:[1],levelPositions:"levels_1"},episode_49:{urls:{json:"~%n/all/%n-b5428bc302.json"},jsons:{levels:"~%n/all/jsons/49-61cfe91b62.json"},episodeNo:49,levelsAmount:15,hard:[10,12],levelPositions:"levels_2"},episode_5:{urls:{json:"~%n/all/%n-c5c13cad68.json"},jsons:{levels:"~%n/all/jsons/5-60efa0c016.json"},episodeNo:5,levelsAmount:15,hard:[6],levelPositions:"levels_2"},episode_50:{urls:{json:"~%n/all/%n-0221015f3d.json"},jsons:{levels:"~%n/all/jsons/50-20601d0ac9.json"},episodeNo:50,levelsAmount:15,hard:[1,7],levelPositions:"levels_1"},episode_51:{urls:{json:"~%n/all/%n-de2a4c0e87.json"},jsons:{levels:"~%n/all/jsons/51-09a761c41b.json"},episodeNo:51,levelsAmount:15,hard:[4,10],levelPositions:"levels_2"},episode_52:{urls:{
json:"~%n/all/%n-1000b1b8ce.json"},jsons:{levels:"~%n/all/jsons/52-66428a02b4.json"},episodeNo:52,levelsAmount:15,hard:[13],levelPositions:"levels_1"},episode_53:{urls:{json:"~%n/all/%n-544a009a92.json"},jsons:{levels:"~%n/all/jsons/53-9d8bcc853c.json"},episodeNo:53,levelsAmount:15,hard:[3,8],levelPositions:"levels_2"},episode_54:{urls:{json:"~%n/all/%n-e4aaf8557e.json"},jsons:{levels:"~%n/all/jsons/54-5ff0528467.json"},episodeNo:54,levelsAmount:15,hard:[7,13],levelPositions:"levels_1"},episode_55:{urls:{json:"~%n/all/%n-f1009b2004.json"},jsons:{levels:"~%n/all/jsons/55-d5a1997ccd.json"},episodeNo:55,levelsAmount:15,hard:[1,11],levelPositions:"levels_2"},episode_56:{urls:{json:"~%n/all/%n-0718e43744.json"},jsons:{levels:"~%n/all/jsons/56-7a7cc9ed3a.json"},episodeNo:56,levelsAmount:15,hard:[0,9,14],levelPositions:"levels_1"},episode_57:{urls:{json:"~%n/all/%n-89771852a9.json"},jsons:{levels:"~%n/all/jsons/57-116d955cb1.json"},episodeNo:57,levelsAmount:15,hard:[10],
levelPositions:"levels_2"},episode_58:{urls:{json:"~%n/all/%n-a3a95c527f.json"},jsons:{levels:"~%n/all/jsons/58-382c2a5929.json"},episodeNo:58,levelsAmount:15,hard:[2,9],levelPositions:"levels_1"},episode_59:{urls:{json:"~%n/all/%n-d7c6da6c91.json"},jsons:{levels:"~%n/all/jsons/59-4ab63860b2.json"},episodeNo:59,levelsAmount:15,hard:[14],levelPositions:"levels_2"},episode_6:{urls:{json:"~%n/all/%n-e1d68bf3eb.json"},jsons:{levels:"~%n/all/jsons/6-63f462549e.json"},episodeNo:6,levelsAmount:15,hard:[6],levelPositions:"levels_1"},episode_60:{urls:{json:"~%n/all/%n-81b1dd1edb.json"},jsons:{levels:"~%n/all/jsons/60-0291184554.json"},episodeNo:60,levelsAmount:15,hard:[14],levelPositions:"levels_1"},episode_61:{urls:{json:"~%n/all/%n-4db5bef485.json"},jsons:{levels:"~%n/all/jsons/61-38b1552103.json"},episodeNo:61,levelsAmount:15,hard:[2,8],levelPositions:"levels_2"},episode_62:{urls:{json:"~%n/all/%n-157587cf00.json"},jsons:{levels:"~%n/all/jsons/62-c0ffa442c3.json"},episodeNo:62,
levelsAmount:15,hard:[0,14],levelPositions:"levels_1"},episode_63:{urls:{json:"~%n/all/%n-cf716bff55.json"},jsons:{levels:"~%n/all/jsons/63-797db6b62f.json"},episodeNo:63,levelsAmount:15,hard:[7],levelPositions:"levels_2"},episode_64:{urls:{json:"~%n/all/%n-93b541b01d.json"},jsons:{levels:"~%n/all/jsons/64-8e98877549.json"},episodeNo:64,levelsAmount:15,hard:[4,10],levelPositions:"levels_1"},episode_65:{urls:{json:"~%n/all/%n-48f1f76510.json"},jsons:{levels:"~%n/all/jsons/65-ee87a96438.json"},episodeNo:65,levelsAmount:15,hard:[6],levelPositions:"levels_2"},episode_66:{urls:{json:"~%n/all/%n-8a68999042.json"},jsons:{levels:"~%n/all/jsons/66-8dc95078c5.json"},episodeNo:66,levelsAmount:15,hard:[9],levelPositions:"levels_1"},episode_67:{urls:{json:"~%n/all/%n-91261cdc80.json"},jsons:{levels:"~%n/all/jsons/67-366b3ee164.json"},episodeNo:67,levelsAmount:15,hard:[5,14],levelPositions:"levels_2"},episode_68:{urls:{json:"~%n/all/%n-fd4165ad59.json"},jsons:{
levels:"~%n/all/jsons/68-a85501bf40.json"},episodeNo:68,levelsAmount:15,hard:[3,13],levelPositions:"levels_1"},episode_69:{urls:{json:"~%n/all/%n-6eb70dde54.json"},jsons:{levels:"~%n/all/jsons/69-04a7481ed3.json"},episodeNo:69,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_7:{urls:{json:"~%n/all/%n-3a1e58d82e.json"},jsons:{levels:"~%n/all/jsons/7-fd71af1f16.json"},episodeNo:7,levelsAmount:15,hard:[10],levelPositions:"levels_2"},episode_70:{urls:{json:"~%n/all/%n-cceb796335.json"},jsons:{levels:"~%n/all/jsons/70-3b644189d2.json"},episodeNo:70,levelsAmount:15,hard:[8],levelPositions:"levels_1"},episode_71:{urls:{json:"~%n/all/%n-56adcb56d3.json"},jsons:{levels:"~%n/all/jsons/71-d729c08877.json"},episodeNo:71,levelsAmount:15,hard:[2,13],levelPositions:"levels_2"},episode_72:{urls:{json:"~%n/all/%n-d0237ba42b.json"},jsons:{levels:"~%n/all/jsons/72-a0586ef284.json"},episodeNo:72,levelsAmount:15,hard:[4,13],levelPositions:"levels_1"},episode_73:{urls:{
json:"~%n/all/%n-659602eac3.json"},jsons:{levels:"~%n/all/jsons/73-a8da748e05.json"},episodeNo:73,levelsAmount:15,hard:[3,7],levelPositions:"levels_2"},episode_74:{urls:{json:"~%n/all/%n-99f829a2a8.json"},jsons:{levels:"~%n/all/jsons/74-0bb50c1c67.json"},episodeNo:74,levelsAmount:15,hard:[5,11],levelPositions:"levels_1"},episode_75:{urls:{json:"~%n/all/%n-d2a18d7591.json"},jsons:{levels:"~%n/all/jsons/75-f0df1a3f29.json"},episodeNo:75,levelsAmount:15,hard:[2,14],levelPositions:"levels_2"},episode_76:{urls:{json:"~%n/all/%n-0f4deb2ba3.json"},jsons:{levels:"~%n/all/jsons/76-723412b206.json"},episodeNo:76,levelsAmount:15,hard:[9],levelPositions:"levels_1"},episode_77:{urls:{json:"~%n/all/%n-f0e5eab2a0.json"},jsons:{levels:"~%n/all/jsons/77-aeed3439b2.json"},episodeNo:77,levelsAmount:15,hard:[2,8],levelPositions:"levels_2"},episode_78:{urls:{json:"~%n/all/%n-6a920b225e.json"},jsons:{levels:"~%n/all/jsons/78-26de436fee.json"},episodeNo:78,levelsAmount:15,hard:[4,8],levelPositions:"levels_1"
},episode_79:{urls:{json:"~%n/all/%n-5b9f9b0e31.json"},jsons:{levels:"~%n/all/jsons/79-dad87a915c.json"},episodeNo:79,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_8:{urls:{json:"~%n/all/%n-3c984f054d.json"},jsons:{levels:"~%n/all/jsons/8-83325c2db7.json"},episodeNo:8,levelsAmount:15,hard:[6],levelPositions:"levels_1"},episode_80:{urls:{json:"~%n/all/%n-15db85373a.json"},jsons:{levels:"~%n/all/jsons/80-820b9dc72e.json"},episodeNo:80,levelsAmount:15,hard:[9],levelPositions:"levels_1"},episode_81:{urls:{json:"~%n/all/%n-2536a1b135.json"},jsons:{levels:"~%n/all/jsons/81-fc0b22d504.json"},episodeNo:81,levelsAmount:15,hard:[5],levelPositions:"levels_2"},episode_82:{urls:{json:"~%n/all/%n-85b5c4c9bf.json"},jsons:{levels:"~%n/all/jsons/82-4a53fd9b7a.json"},episodeNo:82,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_83:{urls:{json:"~%n/all/%n-beaa00550e.json"},jsons:{levels:"~%n/all/jsons/83-5a8e6b82a9.json"},episodeNo:83,levelsAmount:15,hard:[],
levelPositions:"levels_2"},episode_84:{urls:{json:"~%n/all/%n-6c84b17ec1.json"},jsons:{levels:"~%n/all/jsons/84-4d8ed9f7f6.json"},episodeNo:84,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_85:{urls:{json:"~%n/all/%n-83c86aea3f.json"},jsons:{levels:"~%n/all/jsons/85-0f3215f3e7.json"},episodeNo:85,levelsAmount:15,hard:[],levelPositions:"levels_2"},episode_86:{urls:{json:"~%n/all/%n-fc1126f6e6.json"},jsons:{levels:"~%n/all/jsons/86-c420770f21.json"},episodeNo:86,levelsAmount:15,hard:[3],levelPositions:"levels_1"},episode_87:{urls:{json:"~%n/all/%n-894157f573.json"},jsons:{levels:"~%n/all/jsons/87-6e05025bb5.json"},episodeNo:87,levelsAmount:15,hard:[4,14],levelPositions:"levels_2"},episode_88:{urls:{json:"~%n/all/%n-36ad1b53ea.json"},jsons:{levels:"~%n/all/jsons/88-5ddf284357.json"},episodeNo:88,levelsAmount:15,hard:[1],levelPositions:"levels_1"},episode_89:{urls:{json:"~%n/all/%n-e507b7b15d.json"},jsons:{levels:"~%n/all/jsons/89-a866c819cc.json"},episodeNo:89,levelsAmount:15,
hard:[3],levelPositions:"levels_2"},episode_9:{urls:{json:"~%n/all/%n-c71c212604.json"},jsons:{levels:"~%n/all/jsons/9-6666cdf35c.json"},episodeNo:9,levelsAmount:15,hard:[4,11],levelPositions:"levels_2"},episode_90:{urls:{json:"~%n/all/%n-97856d287f.json"},jsons:{levels:"~%n/all/jsons/90-bd53203175.json"},episodeNo:90,levelsAmount:15,hard:[10],levelPositions:"levels_1"},episode_91:{urls:{json:"~%n/all/%n-8beebd821f.json"},jsons:{levels:"~%n/all/jsons/91-de4a088a76.json"},episodeNo:91,levelsAmount:15,hard:[2,13],levelPositions:"levels_2"},episode_92:{urls:{json:"~%n/all/%n-02072c1311.json"},jsons:{levels:"~%n/all/jsons/92-28e5ae9356.json"},episodeNo:92,levelsAmount:15,hard:[7,14],levelPositions:"levels_1"},episode_93:{urls:{json:"~%n/all/%n-766216027d.json"},jsons:{levels:"~%n/all/jsons/93-0556d7c7df.json"},episodeNo:93,levelsAmount:15,hard:[7,14],levelPositions:"levels_2"},episode_94:{urls:{json:"~%n/all/%n-718271eaad.json"},jsons:{levels:"~%n/all/jsons/94-3fb7b7643e.json"},
episodeNo:94,levelsAmount:15,hard:[],levelPositions:"levels_1"},episode_95:{urls:{json:"~%n/all/%n-1d8ff970a9.json"},jsons:{levels:"~%n/all/jsons/95-cd46552ed3.json"},episodeNo:95,levelsAmount:15,hard:[0],levelPositions:"levels_2"},episode_96:{urls:{json:"~%n/all/%n-deeb46ebfe.json"},jsons:{levels:"~%n/all/jsons/96-7670190c88.json"},episodeNo:96,levelsAmount:15,hard:[0,11],levelPositions:"levels_1"},episode_97:{urls:{json:"~%n/all/%n-87ea4978e3.json"},jsons:{levels:"~%n/all/jsons/97-0b3a390b75.json"},episodeNo:97,levelsAmount:15,hard:[3,12],levelPositions:"levels_2"},episode_98:{urls:{json:"~%n/all/%n-a4b37f7016.json"},jsons:{levels:"~%n/all/jsons/98-f785e7ff34.json"},episodeNo:98,levelsAmount:15,hard:[5,13],levelPositions:"levels_1"},episode_99:{urls:{json:"~%n/all/%n-ad17c69640.json"},jsons:{levels:"~%n/all/jsons/99-6f466cd969.json"},episodeNo:99,levelsAmount:15,hard:[10],levelPositions:"levels_2"},episode_coming_soon:{urls:{png:"@%n-2ad6663338.png",json:"@%n-5e61b84b43.json"},
jsons:{spine_0_json:"@jsons/builder-d810dc6e1f.json",join_json:"@jsons/join-8f0e5223b2.json",cup_json:"@jsons/cup-7d5a78449c.json",atlas:"@%n-2ad6663338.atlas"},levelPositions:"coming_soon"},exclamations:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["animation"],soundIds:[]},exp_window:{urls:{png:"@%n-b524df116a.png",json:"@%n-9bf5228a2a.json"},jsons:{plist:"@%n-b524df116a.plist"},frames:{exp_box:"#%n-heroes-exp_box.png",small_exp_box:"#%n-heroes-small_exp_box.png"}},extrawindow:{urls:{}},favorite_sale:{urls:{png:"@%n-6c325effb7.png",json:"@%n-2f9a524dd5.json"},jsons:{story_light_animation_json:"@jsons/story_light_animation-76b10a280a.json",plist:"@%n-6c325effb7.plist",atlas:"@%n-6c325effb7.atlas"},frames:{plus_png:"#%n-plus_big.png",bonus_icon_png:"#%n-bonus_icon.png",badge_png:"#%n-only_now.png"}},figure_dragon:{urls:{png:"@%n-4872104198.png",json:"@%n-298e288caa.json"},jsons:{plist:"@%n-4872104198.plist"},frames:{figure_dragon_0:"#%n-images-%n_0.png",
figure_dragon_1:"#%n-images-%n_1.png",figure_dragon_2:"#%n-images-%n_2.png",figure_dragon_3:"#%n-images-%n_3.png",figure_dragon_goal:"#%n-images-%n_goal.png"}},finger:{urls:{},injectTo:["game","main"],frameIds:["tutorial_click_png","tutorial_hand_png"],jsonIds:[],soundIds:[]},finish_episode_window:{urls:{png:"@%n-f4e0455832.png",json:"@%n-31c4225bfa.json"},jsons:{episode_completed_json:"@jsons/episode_completed-672ef2757a.json",atlas:"@%n-f4e0455832.atlas"}},firefly_jar:{urls:{png:"@%n-cad9252677.png",json:"@%n-fb925cf821.json"},jsons:{firefly_jar_json:"@jsons/fireflies_jar-d39514f4e2.json",firefly_goal_json:"@jsons/firefly_goal-87efbfbfeb.json",plist:"@%n-cad9252677.plist",atlas:"@%n-cad9252677.atlas"},frames:{firefly_goal_png:"#%n-images-firefly_goal.png"}},fireworks:{urls:{fireworks_effect:"~sounds/%n-9366af071d.mp3",png:"@%n-ff4004f811.png",json:"@%n-95d1516555.json"},jsons:{fireworks_json:"@jsons/%n-ac0ffff7c1.json",atlas:"@%n-ff4004f811.atlas"}},flappy:{urls:{
collect_coin_effect:"~sounds/cr_cow_coin-86aa84bdf8.mp3",background:"@scene_bg-5b2ec8f729.jpg",png:"@%n-520c3a3a61.png",json:"@%n-8da35ab35c.json"},jsons:{flappy_cow_json:"@jsons/%n_cow-af11121525.json",flappy_coin_json:"@jsons/%n_coin-b687703fb9.json",json:"~%n/all/jsons/redtournament-1f90e6c9d5.json",plist:"@%n-520c3a3a61.plist",atlas:"@%n-520c3a3a61.atlas"},frames:{flappy_bg:"#%n-%n_bird-%n_bg.png",flappy_wall:"#%n-%n_bird-%n_wall.png",flappy_wall_decor:"#%n-%n_bird-%n_wall_decor.png",flappy_wall_end:"#%n-%n_bird-%n_wall_end.png",flappy_cloud_1:"#%n-%n_bird-%n_cloud_1.png",flappy_cloud_2:"#%n-%n_bird-%n_cloud_2.png",flappy_ground:"#%n-%n_bird-%n_ground.png",flappy_ground_decor:"#%n-%n_bird-%n_ground_decor.png",text_bg:"#%n-%n_bird-text_bg.png"}},game:{urls:{background_music_game:"~sounds/music-9aa3df297e.mp3",background_music_hard:"~sounds/hardmusic-12949c9cc1.mp3",win_effect:"~sounds/win-e48777d616.mp3",lose_window_effect:"~sounds/lose-f740d6d0d4.mp3",
lose_effect:"~sounds/exit_%n-741834bf4d.mp3",cell_collect_effect:"~sounds/s_target-97af6fa9e3.mp3",hero_sound_a:"~sounds/cr_blue_magic-792a22a9f3.mp3",hero_sound_b:"~sounds/cr_green_hit-0c52f488c0.mp3",hero_sound_d:"~sounds/cr_redhero_swoosh-b82b0ef879.mp3",hero_sound_c:"~sounds/cr_purple_hero-6022087062.mp3",hero_sound_e:"~sounds/cr_yellowhero_trin-a09b783f7c.mp3",hero_sound_w:"~sounds/cr_white_hero-318b1f3dd7.mp3",boom_effect:"~sounds/s_hide-e614ce8494.mp3",create_multicolor_effect:"~sounds/s_color_bomb-4da6e91a4d.mp3",bomb_by_left_moves_explosion_effect:"~sounds/s_finish_bang-6fac09148b.mp3",firework_explode:"~sounds/s_container_full-3078e47d93.mp3",dirt_maker_fill:"~sounds/s_container_fill-11ce97136c.mp3",dirt_maker_explode:"~sounds/s_container_full-3078e47d93.mp3",five_moves_effect:"~sounds/s_five_moves-306e3b4b3c.mp3",select_booster_effect:"~sounds/s_get_bonus-387c2aa2f4.mp3",no_moves_effect:"~sounds/s_no_moves-b2e152de36.mp3",bubble_effect:"~sounds/s_no_moves-b2e152de36.mp3",
burstcell_open_effect:"~sounds/s_target_full-9c5eb4cd38.mp3",goal_completed_effect:"~sounds/s_target_full-9c5eb4cd38.mp3",chain_decorator_stage_decrease_effect:"~sounds/s_ribbon-e06185c724.mp3",chain_decorator_die_effect:"~sounds/s_ribbon-e06185c724.mp3",box_decorator_die_effect:"~sounds/s_ribbon-e06185c724.mp3",bag_decorator_die_effect:"~sounds/s_ribbon-e06185c724.mp3",dirt_decorator_grow_up_effect:"~sounds/s_ribbon-e06185c724.mp3",dirt_decorator_die_effect:"~sounds/s_ribbon-e06185c724.mp3",colorbomb_stage_decrease_effect:"~sounds/s_ribbon-e06185c724.mp3",game_start_effect:"~sounds/s_start-9082b8da1c.mp3",game_finish_effect:"~sounds/s_finish-f5196abd70.mp3",perfect_effect:"~sounds/win-fd55d0b4a7.mp3",keep_going_effect:"~sounds/s_keep_going-63e80cbc0d.mp3",show_score_effect:"~sounds/s_score-c6c331668b.mp3",move_effect:"~sounds/s_move-ce9b987d98.mp3",goal_inc_effect:"~sounds/s_target_get-c8490b92da.mp3",nut_effect:"~sounds/s_get_hamburger-a378dc41ed.mp3",
crab_decorator_move_effect:"~sounds/s_get_hamburger-a378dc41ed.mp3",multicolor_use_effect:"~sounds/s_use_color_bomb-bfcddc2566.mp3",rocket_use_effect:"~sounds/s_use_rocket-db8cd97703.mp3",rolling_pin_use_effect:"~sounds/s_use_rolling_pin-b4c7ab1246.mp3",spoon_use_effect:"~sounds/s_use_spoon-4812d1afe2.mp3",wrong_move_effect:"~sounds/s_touch_block-c131486118.mp3",crab_decorator_die_effect:"~sounds/s_touch_block-c131486118.mp3",booster_5_show_effect:"~sounds/s_booster_5_show-813d3c43b9.mp3",inc_coef_effect:"~sounds/s_bonus-21f4eeb77c.mp3",flower_open_effect:"~sounds/s_chocolate_open-402f0b9cd7.mp3",blanket_cell_stage_decrease_effect:"~sounds/s_chocolate_open-402f0b9cd7.mp3",blanket_cell_die_effect:"~sounds/s_ribbon-e06185c724.mp3",upgrade_effect:"~sounds/win-fd55d0b4a7.mp3",lanternhide_effect:"~sounds/sh_tour_slot-a72cf54f4f.mp3",png:"@%n-6e8f4559d9.png",json:"@%n-2213f211e5.json"},jsons:{story_light_animation_json:"@jsons/story_light_animation-76b10a280a.json",
flower_spine_json:"@jsons/flower-2a4f960f2e.json",nut_spine_json:"@jsons/nut_spine-beef7a4c7a.json",fish_spine_json:"@jsons/fish-d8ba185593.json",crab_spine_json:"@jsons/crab-33682c84ce.json",dirt_spine_json:"@jsons/dirt-e92be931a4.json",dirty_honey_json:"@jsons/dirty_honey-44259c8f1a.json",chain_animation_json:"@jsons/chain-515a69b7e0.json",chain2_animation_json:"@jsons/chain2-ec77ce7bfb.json",multicolor_animation_json:"@jsons/colorful-9c0d38c52e.json",multicolor_field_animation_json:"@jsons/skeleton-298fd485a2.json",firework_animation_json:"@jsons/cell_firework-de99ad166d.json",stars_json:"@jsons/stars_line-e6fbd1cd86.json",available_move_json:"@jsons/available_move-809fefcd67.json",coef_animation_json:"@jsons/coef_animation-8109f66a8e.json",target_json:"@jsons/target-7f60e44300.json",A_spine_json:"@jsons/blue-c654f9412d.json",B_spine_json:"@jsons/green-4a5c0cb753.json",C_spine_json:"@jsons/purple-53fc3aa6d8.json",D_spine_json:"@jsons/red-5eda38bcb1.json",
E_spine_json:"@jsons/yellow-e4ba228811.json",W_spine_json:"@jsons/white-a130b2cd4e.json",cellbooster_spine_json:"@jsons/cell-30b27cee81.json",linebooster_spine_json:"@jsons/line-946c287fbe.json",colorbooster_spine_json:"@jsons/color-83df21e841.json",mark_spine_json:"@jsons/mark_animations-b8233c693d.json",gun_animation_json:"@jsons/mag_bomber-02de2a65a4.json",cells_swap_json:"@jsons/swap-7b782102f8.json",wrong_move_json:"@jsons/spark-de5b452c92.json",story_star_animation_json:"@jsons/story_star_animation-fa0f46794a.json",start_level_animation_json:"@jsons/start_level_animation-d2e90b54da.json",help_from_buddies_json:"@jsons/help_from_buddies-3b56ac2a33.json",send_help_spine_json:"@jsons/send_help-7a402e8796.json",bomb_animation_json:"@jsons/bomb-7f717757b3.json",boosters_before_json:"@jsons/boosters_before-0e3566750c.json",shovel_json:"@jsons/shovel-ac430566f3.json",medallion_json:"@jsons/banner-5b2462e734.json",blast_spine_json:"@jsons/blast-753888136a.json",
plane_combo_spine_json:"@jsons/plane-3bf5c23e33.json",rocket_combo_spine_json:"@jsons/rocket-af73a9b4e7.json",cross_combo_spine_json:"@jsons/rocket_cross-9b0c6af056.json",animation:"@jsons/exclamation-edc9c67c97.json",plist:"@%n-6e8f4559d9.plist",atlas:"@%n-6e8f4559d9.atlas"},frames:{ratewindow_on:"#%n-color-red.png",game_moves_icon:"#%n-%n_moves_icon.png",shovel:"#%n-treasure_search-shovel.png",goal_common_bg:"#%n-goal-goals_bg.png",goal_done_sign:"#%n-goal-complete_goal.png",border_left_left:"#%n-border-left_left.png",border_left_straight:"#%n-border-left_straight.png",border_left_right:"#%n-border-left_right.png",border_top_left:"#%n-border-top_left.png",border_top_straight:"#%n-border-top_straight.png",border_top_right:"#%n-border-top_right.png",border_right_left:"#%n-border-right_left.png",border_right_straight:"#%n-border-right_straight.png",border_right_right:"#%n-border-right_right.png",border_bottom_left:"#%n-border-bottom_left.png",
border_bottom_straight:"#%n-border-bottom_straight.png",border_bottom_right:"#%n-border-bottom_right.png",score_bar_bg:"#%n-score-score_bar_bg.png",score_bar:"#%n-score-score_bar.png",game_stars_1star0:"#%n-star-score_star_off.png",game_stars_1star1:"#%n-star-score_star_on.png",game_stars_2star0:"#%n-star-score_star_off.png",game_stars_2star1:"#%n-star-score_star_on.png",game_stars_3star0:"#%n-star-score_star_off.png",game_stars_3star1:"#%n-star-score_star_on.png",ice_block_1_stable:"#%n-images-ice_block1_stable.png",ice_block_2_stable:"#%n-images-ice_block2_stable.png",gum_body_png:"#%n-gum-gum_1.png",gum_border_png:"#%n-gum-gum_2.png",gum_goal_png:"#%n-gum-gum_3.png",dirty_honey_tile:"#%n-images-dirty_honey_tile.png",dirty_honey_decorator:"#%n-images-dirty_honey_decorator.png",barrier:"#%n-barrier-barrier2.png",chain_decorator_cell:"#%n-chain-chain_stable.png",chain_decorator_cell2:"#%n-chain-chain_stable2.png",cell_fish:"#%n-fish-fish_0.png",flower_cell_0:"#%n-flower-flower_0.png",
flower_cell_1:"#%n-flower-flower_1.png",flower_cell_2:"#%n-flower-flower_2.png",flower_cell_3:"#%n-flower-flower_3.png",nut_cell_0:"#%n-nut-nut_1.png",nut_cell_1:"#%n-nut-nut_1.png",cell_life:"#%n-life-cell_life.png",cell_life_bg:"#%n-life-cell_life_bg.png",cell_life2_bg:"#%n-life-cell_life2_bg.png",cell_a:"#%n-color-blue.png",cell_b:"#%n-color-green.png",cell_c:"#%n-color-purple.png",cell_d:"#%n-color-red.png",cell_e:"#%n-color-yellow.png",cell_w:"#%n-color-white.png",cell_A:"#%n-goals-blue.png",cell_B:"#%n-goals-green.png",cell_C:"#%n-goals-purple.png",cell_D:"#%n-goals-red.png",cell_E:"#%n-goals-yellow.png",cell_W:"#%n-goals-white.png",cell_multicolor:"#%n-cells-colorful.png",cell_dirt:"#%n-dirt-dirt_stable.png",cell_dirt_goal:"#%n-dirt-dirt_goal.png",cell_crab:"#%n-crab-crab_stable.png",firework_cell_a:"#%n-firework-firework_blue.png",firework_cell_b:"#%n-firework-firework_green.png",firework_cell_c:"#%n-firework-firework_purple.png",firework_cell_d:"#%n-firework-firework_red.png",
firework_cell_e:"#%n-firework-firework_yellow.png",firework_cell_w:"#%n-firework-firework_white.png",firework_cell_goal:"#%n-firework-firework_goal.png",box_stable1_png:"#%n-box-box_stable.png",box_stable2_png:"#%n-box-box_stable2.png",box_stable3_png:"#%n-box-box_stable3.png",box_stable4_png:"#%n-box-box_stable4.png",coef_1:"#%n-coef-1.png",coef_2:"#%n-coef-2.png",coef_3:"#%n-coef-3.png",coef_4:"#%n-coef-4.png",coef_5:"#%n-coef-5.png",coef_6:"#%n-coef-6.png",coef_7:"#%n-coef-7.png",coef_8:"#%n-coef-8.png",coef_9:"#%n-coef-9.png",selected_cell:"#%n-select.png",tile_background_1:"#%n-tiles-tile_background1.png",tile_background_2:"#%n-tiles-tile_background2.png",tile_grass:"#%n-grass-grass.png",ice_goal:"#%n-ice-ice_goal.png",ice_tile:"#%n-ice-ice_tile.png",cellbooster_png:"#%n-boosters-cell.png",cellbooster_moving_png:"#%n-boosters-cell.png",cellbooster_active_png:"#%n-boosters-cell_on.png",cellbooster_disabled_png:"#%n-boosters-cell.png",
cellbooster_small_png:"#%n-boosters-cell_small.png",linebooster_png:"#%n-boosters-line.png",linebooster_moving_png:"#%n-boosters-line.png",linebooster_active_png:"#%n-boosters-line_on.png",linebooster_disabled_png:"#%n-boosters-line.png",linebooster_small_png:"#%n-boosters-line_small.png",colorbooster_png:"#%n-boosters-color.png",colorbooster_moving_png:"#%n-boosters-color.png",colorbooster_active_png:"#%n-boosters-color_on.png",colorbooster_disabled_png:"#%n-boosters-color.png",colorbooster_small_png:"#%n-boosters-color_small.png",booster_icon_bg_png:"#%n-boosters-booster_icon_bg.png",booster_icon_bg_on_png:"#%n-boosters-booster_icon_bg_on.png",locked_png:"#%n-locked.png",goals_background:"#%n-goal-top_bg.png",boosters_background_png:"#%n-boosters-bottom_bg.png",booster_price_0:"#%n-boosters-price_100.png",booster_price_1:"#%n-boosters-price_150.png",booster_price_2:"#%n-boosters-price_200.png",boom_frames_1:"#%n-boom_frames-boom_1.png",boom_frames_2:"#%n-boom_frames-boom_2.png",
boom_frames_3:"#%n-boom_frames-boom_3.png",boom_frames_4:"#%n-boom_frames-boom_4.png",boom_frames_5:"#%n-boom_frames-boom_5.png",boom_frames_6:"#%n-boom_frames-boom_6.png",mark_goal:"#%n-mark-mark_goal.png",gun_amount_bg_png:"#%n-gun-gun_amount.png",gun_price_bg_png:"#%n-gun-gun_price.png",lantern_streak_icon:"#%n-lantern-lantern_streak_icon.png",gun_view_png:"#%n-bomb.png",bomb_png:"#%n-bomb.png",cell_crab_goal:"#%n-crab-crab_goal.png",score_bar_back_bg:"#%n-score-scorebar_back.png",force_decor_left:"#%n-tutorial-tutorial_text_decor_1.png",force_decor_right:"#%n-tutorial-tutorial_text_decor_2.png",moves_jar_content_bg:"#%n-moves-moves_counter_mid.png",moves_jar_bg:"#%n-moves-moves_counter_top.png",goals_background_decor_left:"#%n-goal-top_decor_left.png",goals_background_decor_right:"#%n-goal-top_decor_right.png",goals_title:"#%n-goal-goals_eng.png",goals_title_ru:"#%n-goal-goals_rus.png",locked_flower:"#%n-locked_flower.png",tooltip_bg_png:"#%n-tooltip-box.png",
tooltip_shadow_arrow_png:"#%n-tooltip-arrow.png",tooltip_arrow_png:"#%n-tooltip-arrow2.png",gold_small_png:"#%n-reward_icons-gold_small.png",gold_png:"#%n-reward_icons-gold.png",reward_exp_png:"#%n-reward_icons-exp.png",exp_png:"#%n-menubar-exp.png",cellbooster_small:"#%n-reward_icons-cell_small.png",linebooster_small:"#%n-reward_icons-line_small.png",colorbooster_small:"#%n-reward_icons-color_small.png",cellbooster:"#%n-reward_icons-cell.png",linebooster:"#%n-reward_icons-line.png",colorbooster:"#%n-reward_icons-color.png",life_unlim:"#%n-reward_icons-life_unlim.png",life_unlim_small:"#%n-reward_icons-life_unlim_small.png",stars_png:"#%n-reward_icons-stars.png",heroes_png:"#%n-reward_icons-heroes.png",moves_png:"#%n-reward_icons-moves.png",multicolor_png:"#%n-reward_icons-multicolor.png",heroes_small_png:"#%n-reward_icons-heroes_small.png",moves_small_png:"#%n-reward_icons-moves_small.png",multicolor_small_png:"#%n-reward_icons-multicolor_small.png",adicon_png:"#%n-shared-adicon.png",
tutorial_click_png:"#%n-tutorial-circle.png",tutorial_hand_png:"#%n-tutorial-hand.png",level_digit_0:"#%n-level-0.png",level_digit_1:"#%n-level-1.png",level_digit_2:"#%n-level-2.png",level_digit_3:"#%n-level-3.png",level_digit_4:"#%n-level-4.png",level_digit_5:"#%n-level-5.png",level_digit_6:"#%n-level-6.png",level_digit_7:"#%n-level-7.png",level_digit_8:"#%n-level-8.png",level_digit_9:"#%n-level-9.png",timer_digit_0:"#%n-timer-0.png",timer_digit_1:"#%n-timer-1.png",timer_digit_2:"#%n-timer-2.png",timer_digit_3:"#%n-timer-3.png",timer_digit_4:"#%n-timer-4.png",timer_digit_5:"#%n-timer-5.png",timer_digit_6:"#%n-timer-6.png",timer_digit_7:"#%n-timer-7.png",timer_digit_8:"#%n-timer-8.png",timer_digit_9:"#%n-timer-9.png",timer_digit_colon:"#%n-timer-colon.png",timer_digit_slash:"#%n-timer-slash.png",timer_digit_x:"#%n-timer-x.png",menu_icon_png:"#%n-controlbuttons-menu.png",button_png:"#%n-controlbuttons-menu_button.png",button_on_png:"#%n-controlbuttons-menu_button_on.png",
fullscreen_icon_png:"#%n-controlbuttons-fullscreen_icon.png",back_button_png:"#%n-controlbuttons-back_button.png",back_button_on_png:"#%n-controlbuttons-back_button_on.png",back_icon_png:"#%n-controlbuttons-back.png",life_png:"#%n-menubar-life.png",life_unlim_png:"#%n-menubar-life_unlim.png",coin_png:"#%n-menubar-coin.png",star_chest_icon_png:"#%n-menubar-chest.png",menu_gold_bg_png:"#%n-menubar-bar_bg.png",plus_button_png:"#%n-menubar-plus.png",plus_button_on_png:"#%n-menubar-plus_on.png",window_button_png:"#%n-buttons-button.png",window_button_on_png:"#%n-buttons-button_on.png",window_button_disabled_png:"#%n-buttons-button_off.png",booster_digit_0:"#%n-booster_digits-0.png",booster_digit_1:"#%n-booster_digits-1.png",booster_digit_2:"#%n-booster_digits-2.png",booster_digit_3:"#%n-booster_digits-3.png",booster_digit_4:"#%n-booster_digits-4.png",booster_digit_5:"#%n-booster_digits-5.png",booster_digit_6:"#%n-booster_digits-6.png",booster_digit_7:"#%n-booster_digits-7.png",
booster_digit_8:"#%n-booster_digits-8.png",booster_digit_9:"#%n-booster_digits-9.png",white_digit_0:"#%n-white_digits-0.png",white_digit_1:"#%n-white_digits-1.png",white_digit_2:"#%n-white_digits-2.png",white_digit_3:"#%n-white_digits-3.png",white_digit_4:"#%n-white_digits-4.png",white_digit_5:"#%n-white_digits-5.png",white_digit_6:"#%n-white_digits-6.png",white_digit_7:"#%n-white_digits-7.png",white_digit_8:"#%n-white_digits-8.png",white_digit_9:"#%n-white_digits-9.png",white_digit_slash:"#%n-white_digits-slash.png",white_digit_plus:"#%n-white_digits-plus.png",white_digit_minus:"#%n-white_digits-minus.png",moves_digit_0:"#%n-moves-0.png",moves_digit_1:"#%n-moves-1.png",moves_digit_2:"#%n-moves-2.png",moves_digit_3:"#%n-moves-3.png",moves_digit_4:"#%n-moves-4.png",moves_digit_5:"#%n-moves-5.png",moves_digit_6:"#%n-moves-6.png",moves_digit_7:"#%n-moves-7.png",moves_digit_8:"#%n-moves-8.png",moves_digit_9:"#%n-moves-9.png",goals_digit_0:"#%n-goal-0.png",goals_digit_1:"#%n-goal-1.png",
goals_digit_2:"#%n-goal-2.png",goals_digit_3:"#%n-goal-3.png",goals_digit_4:"#%n-goal-4.png",goals_digit_5:"#%n-goal-5.png",goals_digit_6:"#%n-goal-6.png",goals_digit_7:"#%n-goal-7.png",goals_digit_8:"#%n-goal-8.png",goals_digit_9:"#%n-goal-9.png",goals_digit_slash:"#%n-goal-slash.png",clover_png:"#%n-tournament-clover.png",rose_png:"#%n-tournament-crystal.png",tulpan_png:"#%n-tournament-bone.png",fly_clover_png:"#%n-tournament-clover.png",mark_on_colorcell:"#%n-mark-mark.png"}},game_background:{urls:{background:"@level_bg-96094a07cd.jpg"}},game_background_2:{urls:{background:"@game_background2-611f3594cc.jpg"}},game_background_3:{urls:{background:"@game_background3-72ba9383b2.jpg"}},game_background_hard:{urls:{background:"@hard_level_bg-daa65731ec.jpg"}},game_mark:{urls:{},injectTo:["game","color_bomb"],frameIds:["mark_on_colorcell"],jsonIds:[],soundIds:[]},gamemessage:{urls:{}},gingerbread_house:{urls:{png:"@%n-bc5db4e211.png",json:"@%n-61c28b6752.json"},jsons:{
plist:"@%n-bc5db4e211.plist"},frames:{ginger_house_wall_png:"#%n-images-gbh_wall.png",ginger_house_door_png:"#%n-images-gbh_door.png",ginger_house_roof_png:"#%n-images-gbh_roof.png",ginger_house_window_png:"#%n-images-gbh_window.png",ginger_house_part_wall_png:"#%n-images-gbh_wall_cell.png",ginger_house_part_door_png:"#%n-images-gbh_door_cell.png",ginger_house_part_roof_png:"#%n-images-gbh_roof_cell.png",ginger_house_part_window_png:"#%n-images-gbh_window_cell.png",ginger_house_slot_png:"#%n-images-gbh_slot.png",ginger_house_goal_png:"#%n-images-gbh_goal.png"}},halloween:{urls:{png:"@%n-4c53dff3b8.png",json:"@%n-e9a4c06141.json"},jsons:{halloween_jack_json:"@jsons/%n_jack-26aa44dede.json",halloween_candle_json:"@jsons/%n_candle-fedb3d9112.json",halloween_owls_json:"@jsons/%n_owls-e2cf4ee13f.json",plist:"@%n-4c53dff3b8.plist",atlas:"@%n-4c53dff3b8.atlas"},frames:{halloween_web_bottom:"#%n-%n_decor_1.png",halloween_web_top:"#%n-%n_decor_2.png",
halloween_decor_forest:"#%n-%n_decor_forest.png",halloween_pumpkins:"#%n-%n_pumpkins.png",halloween_roots_top_left:"#%n-%n_roots_top_left.png",halloween_roots_top_right:"#%n-%n_roots_top_right.png"}},help_from_friends:{urls:{png:"@%n-2d173566ea.png",json:"@%n-95e9549268.json"},jsons:{help_from_friends_json:"@jsons/%n-c600c96b2d.json",atlas:"@%n-2d173566ea.atlas"}},hero:{urls:{},injectTo:["main"],frameIds:[],jsonIds:[],soundIds:[]},hero_window:{urls:{png:"@%n-962185167e.png",json:"@%n-7b9296a2a8.json"},jsons:{hero_window_help_json:"@jsons/%n_help-39cec1903b.json",atlas:"@%n-962185167e.atlas"}},heroes:{urls:{png:"@%n-7d476adc31.png",json:"@%n-a48b2fa1f9.json"},jsons:{E_hero_spine_json:"@jsons/yellow_hero-400cfe5e6b.json",D_hero_spine_json:"@jsons/red_hero-5d5f30f03c.json",A_hero_spine_json:"@jsons/blue_hero-efd0fbc4d8.json",A_hero_spine_effect_json:"@jsons/blue_hero_effect-eb03d3e806.json",B_hero_spine_json:"@jsons/green_hero-eafd3e5c1e.json",
C_hero_spine_json:"@jsons/purple_hero-64429013fb.json",C_hero_spine_effect_json:"@jsons/purple_hero_target-b1bf34bbef.json",W_hero_spine_json:"@jsons/white_hero-f077e97922.json",plist:"@%n-7d476adc31.plist",atlas:"@%n-7d476adc31.atlas"},frames:{heroes_level_bg:"#%n-%n_lvlup.png"}},heroes_backgrounds:{urls:{heroes_bg:"@heroes_bg-27f52e43f7.jpg",png:"@%n-6225967142.png",json:"@%n-eada51bce5.json"},jsons:{heroes_bg_json:"@jsons/heroes_bg-c867024a54.json",atlas:"@%n-6225967142.atlas"}},ice:{urls:{png:"@%n-5c8d041af3.png",json:"@%n-0586e76ef9.json"},jsons:{ice_spine_json:"@jsons/honey-211bd8f6c2.json",atlas:"@%n-5c8d041af3.atlas"}},ice_block:{urls:{ice_block_live_effect:"~sounds/cr_iceblocker_01-bd8658e4c4.mp3",ice_block_explode_effect:"~sounds/cr_iceblocker_00-87a3531bed.mp3",png:"@%n-3266155a6a.png",json:"@%n-2053c2fee7.json"},jsons:{ice_block_spine_json:"@jsons/%n-a355a15c17.json",atlas:"@%n-3266155a6a.atlas"}},ice_block_maker:{urls:{png:"@%n-e91ba6d183.png",json:"@%n-d5dc2b3306.json"},
jsons:{ice_block_maker_json:"@jsons/%n-10dbc3dbe4.json",atlas:"@%n-e91ba6d183.atlas"}},ice_cream_maker:{urls:{icecream_maker_fill_effect:"~sounds/s_container_fill-11ce97136c.mp3",png:"@%n-b024e4cf98.png",json:"@%n-1a1cca43d4.json"},jsons:{iceCreamMaker_spine_json:"@jsons/%n-eef469e60e.json",plist:"@%n-b024e4cf98.plist",atlas:"@%n-b024e4cf98.atlas"},frames:{iceCreamMaker_0:"#%n-images-%n_0.png",iceCreamMaker_1:"#%n-images-%n_1.png",iceCreamMaker_2:"#%n-images-%n_2.png",iceCreamMaker_3:"#%n-images-%n_3.png"}},ice_maker:{urls:{ice_maker_fly_effect:"~sounds/cr_bee_fly-dce9fc8a57.mp3",png:"@%n-6b943b8cd6.png",json:"@%n-94efe6b955.json"},jsons:{ice_maker_json:"@jsons/%n-a1ed0d7d69.json",plist:"@%n-6b943b8cd6.plist",atlas:"@%n-6b943b8cd6.atlas"},frames:{white_digit_0:"#%n-white_digits-0.png",white_digit_1:"#%n-white_digits-1.png",white_digit_2:"#%n-white_digits-2.png",white_digit_3:"#%n-white_digits-3.png",white_digit_4:"#%n-white_digits-4.png",white_digit_5:"#%n-white_digits-5.png",
white_digit_6:"#%n-white_digits-6.png",white_digit_7:"#%n-white_digits-7.png",white_digit_8:"#%n-white_digits-8.png",white_digit_9:"#%n-white_digits-9.png"}},language_en:{urls:{json:"@%n-64089e9a30.json"},jsons:{common_json:"~%n/all/jsons/common_en-5823f3aa95.json",skin_json:"~%n/all/jsons/riddles_en-0716c8fa65.json",lang_json:"~%n/all/jsons/match3_en-c1cd0791fa.json",project_json:"~%n/all/jsons/en-39ff8a7d66.json"}},languageswindow:{urls:{png:"@%n-c6339e0f67.png",json:"@%n-2ea0fe0352.json"},jsons:{plist:"@%n-c6339e0f67.plist"},frames:{buttoncheck_png:"#%n-languages-check.png",buttonbg_png:"#%n-languages-bg.png",buttonbg_on_png:"#%n-languages-bg_on.png"}},lantern:{urls:{png:"@%n-d7d478b900.png",json:"@%n-d293c716e1.json"},jsons:{lantern_game_json:"@jsons/%n-1684e0ce90.json",atlas:"@%n-d7d478b900.atlas"}},lantern_window:{urls:{png:"@%n-a795b323b0.png",json:"@%n-43daff7d82.json"},jsons:{plist:"@%n-a795b323b0.plist"},frames:{bonus_bg_on_png:"#%n-lantern-bonus_bg_on.png",
bonus_bg_off_png:"#%n-lantern-bonus_bg_off.png",lantern_arrow_png:"#%n-lantern-arrow.png",lantern_bg_png:"#%n-lantern-bg_picture.png"}},level:{urls:{},injectTo:["main"],frameIds:[],jsonIds:["%n_json"],soundIds:[]},loading_scene_backgrounds:{urls:{background_en:"@background-11c1a50bf8.jpg",background_ru:"@background_ru-07a5887ce9.jpg",background_mobile_en:"@background_mobile-0a8c9d926d.jpg",background_mobile_ru:"@background_mobile_ru-5ee3da4468.jpg"}},lollipop:{urls:{png:"@%n-28b66e6a74.png",json:"@%n-1dd8680e96.json"},jsons:{lollipop_json:"@jsons/%n-3ef033e59f.json",plist:"@%n-28b66e6a74.plist",atlas:"@%n-28b66e6a74.atlas"},frames:{lollipop_cell_a:"#%n-images-%n_blue.png",lollipop_cell_b:"#%n-images-%n_green.png",lollipop_cell_c:"#%n-images-%n_purple.png",lollipop_cell_d:"#%n-images-%n_red.png",lollipop_cell_e:"#%n-images-%n_yellow.png",lollipop_cell_w:"#%n-images-%n_white.png",lollipop_goal:"#%n-images-%n_goal.png"}},lose_window:{urls:{png:"@%n-affe88bd84.png",
json:"@%n-9cad840603.json"},jsons:{lose_json:"@jsons/lose-e9a668d81a.json",atlas:"@%n-affe88bd84.atlas"}},lottery:{urls:{},injectTo:["tile_shop","main"],frameIds:["%n_en","%n_ru","ok_%n","ok_%n_10k","vk_%n"],jsonIds:[],soundIds:[]},magic_tournament:{urls:{png:"@%n-e87f835696.png",json:"@%n-577082802c.json"},jsons:{json:"@jsons/redtournament-1f90e6c9d5.json",atlas:"@%n-e87f835696.atlas"}},main:{urls:{click_effect:"~sounds/click-f06aa1403b.mp3",notification_effect:"~sounds/notification-5f77114cb5.mp3",window_effect:"~sounds/window-6460b2b9aa.mp3",play_button_effect:"~sounds/play_button_effect-0caa47ecd1.mp3",blank_bg_jpg:"@blank_ep_background-b1ac69231f.jpg",background_music_map:"~sounds/background_music-bf1d6eb065.mp3",close_window_effect:"~sounds/s_close_window-2ded11d762.mp3",shop_buy_effect:"~sounds/s_buy-6e6a4bd1d4.mp3",star_1_effect:"~sounds/s_one_star-318fa14506.mp3",star_2_effect:"~sounds/s_two_star-060d1c8675.mp3",star_3_effect:"~sounds/s_three_star-47142c5276.mp3",
daily_game_mix_effect:"~sounds/s_daily_game_mix-e2acdeddd9.mp3",stage_change_effect:"~sounds/sound_stage_change-24fd51ec31.mp3",score_star_effect:"~sounds/s_star_line-e876dc1457.mp3",available_move_effect:"~sounds/notification-5f77114cb5.mp3",star_chest_reward_effect:"~sounds/s_reward-073d6fbafd.mp3",treasure_search_open_effect:"~sounds/cr_tour_bailer-dbb6d15107.mp3",treasure_search_found_effect:"~sounds/cr_tour_flower-41c9717fdd.mp3",open_window_effect:"~sounds/cr_starter_pack-6548402c32.mp3",champion_window_effect:"~sounds/s_champion-a1de436036.mp3",reward_window_effect:"~sounds/s_champion-a1de436036.mp3",beat_friend_effect:"~sounds/s_beat_friend-ddfe613116.mp3",collect_coins_effect:"~sounds/s_coins_short-8bfd5fced0.mp3",basefont_ttf:{type:"font",name:"Riffic-Bold",srcs:["~%n/all/riffic-bold.ttf","~%n/all/riffic-bold.eot"]},booster_before_selection_effect:"~sounds/s_booster_selection-bea15c1d6f.mp3",booster_before_cancel_effect:"~sounds/s_booster_cancel-e36ae11dc3.mp3",
star_collect_effect:"~sounds/star_collect-326dc2cce6.mp3",simple_win_effect:"~sounds/simple_win-08e9e6772c.mp3",simple_transition_effect:"~sounds/simple_transition-209db99faf.mp3",metha_present_effect:"~sounds/present-788b433cdc.mp3",png:"@%n-7d56066329.png",json:"@%n-5bf24869ed.json"},jsons:{share_json:"~%n/all/jsons/share-1108537642.json",loading_json:"@jsons/loading-2427ff5b1d.json",level_failed_small_hearts_json:"@jsons/level_failed_small_heart-96e9356156.json",reward_spine_json:"@jsons/reward_animation-ae5266cb00.json",friday_schedule:{url:"cleverapps/utils/events/client/mergeriddlesschedule.json",data:"[]",inline:!0},play_button_transition_json:"@jsons/play_button_transition-86d4e931e5.json",shop_animations_json:"@jsons/shop_coins_animations-6df6b9e2cf.json",between_episodes_json:"@jsons/flag-473f720ba6.json",episode_clouds_spine_json:"@jsons/clouds-427a92396a.json",episode_clouds_line_spine_json:"@jsons/clouds_line-a0825992cb.json",
yellow_hi_spine_json:"@jsons/yellow_hi-2e162d3e17.json",settings_animation_json:"@jsons/settings_animation-d779a89b6e.json",score_animation_json:"@jsons/score_animation-b34e09d9ef.json",levelstart_stars_json:"@jsons/stars-5f8c3654ef.json",hero_oblako_spine_json:"@jsons/hero_oblako-8e8237dd6c.json",tournament_flappy_bird_icon_json:"@jsons/icon_flappy_bird-ce58fc990c.json",present_json:"@jsons/present-0fd162771c.json",hl_animation_left_json:"@jsons/hl_animation_left-eaf3fa3a22.json",hl_animation_right_json:"@jsons/hl_animation_right-d0dab3ebe2.json",lives_sale_icon_json:"@jsons/lives_sale_icon-acacd1b6a7.json",dailycup_icon_json:"@jsons/icon_dailycup-0166b4b572.json",piggybank_icon_json:"@jsons/icon_piggy-7eaddeffd2.json",pack_icon_json:"@jsons/icon_pack1-4bcd193f71.json",pack1_icon_json:"@jsons/icon_pack2-b4f5b43cc9.json",pack2_icon_json:"@jsons/icon_pack3-487ea76aa7.json",premium_icon_json:"@jsons/icon_premium-2be3f364be.json",
tournament_magic_icon_json:"@jsons/icon_magic-decab7fb52.json",tournament_tulpan_icon_json:"@jsons/icon_tulpan-a08d940a6d.json",tournament_rose_icon_json:"@jsons/icon_rose-4a440ec059.json",heroes_icon_json:"@jsons/icon_heroes-ffd58d6a81.json",lantern_icon_json:"@jsons/lantern-d0d283da4a.json",boosters_sale_icon_json:"@jsons/booster_sale_icon-9fac765eb0.json",treasure_search_icon_json:"@jsons/gem_icon-b1f28ac9fc.json",battlepass_icon_json:"@jsons/bp_icon-59af38c2b6.json",raffle_icon_json:"@jsons/icon_raffle-76b1860262.json",transition_json:"@jsons/transition-15aa5070c9.json",star_json:"@jsons/star-b95e191930.json",progress_bar_json:"@jsons/progress_bar-6fc7b7e73d.json",avatar_spark_json:"@jsons/avatar_spark-dae07e0bd6.json",progress_bar_spark_json:"@jsons/progress_bar_spark-536c458f3d.json",level_json:"@jsons/level-ab16bf5440.json",plist:"@%n-7d56066329.plist",atlas:"@%n-7d56066329.atlas"},frames:{notification_bg_png:"#%n-notification-notification_bg.png",
fb_icon_png:"#%n-socialicons-fb_icon.png",ok_icon_png:"#%n-socialicons-ok_icon.png",vk_icon_png:"#%n-socialicons-vk_icon.png",nk_icon_png:"#%n-socialicons-nk_icon.png",mm_icon_png:"#%n-socialicons-mm_icon.png",fs_icon_png:"#%n-socialicons-fs_icon.png",draugiem_icon_png:"#%n-socialicons-draugiem_icon.png",mobage_icon_png:"#%n-socialicons-yahoo_icon.png",google_icon_png:"#%n-socialicons-google_icon.png",apple_icon_png:"#%n-socialicons-apple_icon.png",white_button_png:"#%n-socialicons-white_button.png",white_outline_button_png:"#%n-socialicons-white_outline_button.png",white_shadow_button_png:"#%n-socialicons-white_shadow_button.png",blue_outline_button_png:"#%n-socialicons-blue_outline_button.png",select_friend_checkbox:"#%n-selectfriends-checkbox_sf.png",select_friend_checkbox_selected:"#%n-selectfriends-checkbox_mark.png",level_failed_heart_png:"#%n-lvf_heart.png",level_failed_heart_empty_png:"#%n-lvf_heart_empty.png",moves_icon:"#%n-moves_icon.png",
light_bg_png:"#%n-tournament-light_bg.png",row_player_png:"#%n-tournament-row_player.png",row_you_png:"#%n-tournament-row_you.png",missions_easy_top_png:"#%n-mission-easy_top_1.png",missions_medium_top_png:"#%n-mission-medium_top_1.png",missions_hard_top_png:"#%n-mission-hard_top_1.png",missions_icon_bg_png:"#%n-mission-icon_bg.png",missions_item_bg_png:"#%n-mission-item_bg.png",global_icon:"#%n-leaderboard-world.png",friends_icon:"#%n-leaderboard-friends.png",league_arrow_png:"#%n-leaderboard-league_arrow.png",levelstart_cup_1:"#%n-leaderboard-1_place.png",levelstart_cup_2:"#%n-leaderboard-2_place.png",levelstart_cup_3:"#%n-leaderboard-3_place.png",shop_tab_off:"#%n-leaderboard-tab_off.png",shop_tab_on:"#%n-leaderboard-tab_on.png",wood_bg:"#%n-bghlw_icon.png",accept_life_icon:"#%n-friend_messages-accept_life_icon.png",send_life_icon:"#%n-friend_messages-send_life_icon.png",bounty_item_bg:"#%n-friend_messages-bounty_bg.png",android_avatar:"#%n-avatars-android_avatar.png",
ios_avatar:"#%n-avatars-ios_avatar.png",user_avatar:"#%n-avatars-user_avatar.png",default_avatar:"#%n-avatars-default_avatar.png",send_star_icon:"#%n-friend_messages-star_send_icon.png",accept_star_icon:"#%n-friend_messages-star_accept_icon.png",bot_avatar_1:"#%n-avatars-bot_1.png",bot_avatar_2:"#%n-avatars-bot_2.png",bot_avatar_3:"#%n-avatars-bot_3.png",avatar_invite_friend:"#%n-avatars-invite_friend_ava.png",timer_bg_png:"#%n-bar-timer_bg.png",tournamentstory_bg:"#%n-tournament-speech_bubble.png",tournamentstory_bg_triangle:"#%n-tournament-speech_bubble_triangle.png",accept_stuck_coins_icon:"#%n-friend_messages-accept_coins.png",small_grey_button:"#%n-friend_messages-small_button_grey.png",tutorial_text_bg_png:"#%n-gold_view-speak_bg.png",stars_star:"#%n-victory-stars_star_1a.png",life_unlim_heart_png:"#%n-windows-life_unlim.png",ok_icon_button_png:"#%n-socialicons-ok_icon.png",invite_friends_icon:"#%n-dailytasks-icon3.png",window_bg_light_png:"#%n-windows-window_bg_light.png",
thg_present_box_pink:"#%n-present_box_pink.png",flappy_coin_png:"#%n-flappy_bird-flappy_coin.png",red_banner_png:"#%n-tournament-red_banner.png",blue_banner_png:"#%n-tournament-blue_banner.png",green_banner_png:"#%n-tournament-green_banner.png",ribbon:"#%n-victory-high_scores_full.png",game_distribution_avatar:"#%n-avatars-game_distribution.png",tooltip_bg_png:"#%n-tooltip-box.png",tooltip_shadow_arrow_png:"#%n-tooltip-arrow.png",tooltip_arrow_png:"#%n-tooltip-arrow2.png",gold_small_png:"#%n-reward_icons-gold_small.png",gold_png:"#%n-reward_icons-gold.png",reward_exp_png:"#%n-reward_icons-exp.png",exp_png:"#%n-menubar-exp.png",cellbooster_small:"#%n-reward_icons-cell_small.png",linebooster_small:"#%n-reward_icons-line_small.png",colorbooster_small:"#%n-reward_icons-color_small.png",cellbooster:"#%n-reward_icons-cell.png",linebooster:"#%n-reward_icons-line.png",colorbooster:"#%n-reward_icons-color.png",life_unlim:"#%n-reward_icons-life_unlim.png",
life_unlim_small:"#%n-reward_icons-life_unlim_small.png",stars_png:"#%n-reward_icons-stars.png",heroes_png:"#%n-reward_icons-heroes.png",moves_png:"#%n-reward_icons-moves.png",multicolor_png:"#%n-reward_icons-multicolor.png",heroes_small_png:"#%n-reward_icons-heroes_small.png",moves_small_png:"#%n-reward_icons-moves_small.png",multicolor_small_png:"#%n-reward_icons-multicolor_small.png",window_bg_png:"#%n-windows-window_bg.png",window_decor_1_png:"#%n-windows-window_decor_1.png",window_decor_2_png:"#%n-windows-window_decor_2.png",hard_level_fire:"#%n-hard_level-hard_level_fire.png",hard_level_title_bg:"#%n-hard_level-hard_level_title_bg.png",adicon_png:"#%n-shared-adicon.png",level_victory_reward_bg:"#%n-victory-reward_bg.png",level_victory_reward_line:"#%n-victory-reward_line.png",tutorial_click_png:"#%n-tutorial-circle.png",tutorial_hand_png:"#%n-tutorial-hand.png",level_digit_0:"#%n-level-0.png",level_digit_1:"#%n-level-1.png",level_digit_2:"#%n-level-2.png",
level_digit_3:"#%n-level-3.png",level_digit_4:"#%n-level-4.png",level_digit_5:"#%n-level-5.png",level_digit_6:"#%n-level-6.png",level_digit_7:"#%n-level-7.png",level_digit_8:"#%n-level-8.png",level_digit_9:"#%n-level-9.png",timer_digit_0:"#%n-timer-0.png",timer_digit_1:"#%n-timer-1.png",timer_digit_2:"#%n-timer-2.png",timer_digit_3:"#%n-timer-3.png",timer_digit_4:"#%n-timer-4.png",timer_digit_5:"#%n-timer-5.png",timer_digit_6:"#%n-timer-6.png",timer_digit_7:"#%n-timer-7.png",timer_digit_8:"#%n-timer-8.png",timer_digit_9:"#%n-timer-9.png",timer_digit_colon:"#%n-timer-colon.png",timer_digit_slash:"#%n-timer-slash.png",timer_digit_x:"#%n-timer-x.png",toolbar_bg_png:"#%n-toolbar-toolbar_bg.png",toolbar_attention_icon_png:"#%n-toolbar-toolbar_notification.png",toolbar_dailybonus_icon_png:"#%n-toolbar-tb_dailyquest.png",toolbar_daily_tasks_icon_png:"#%n-toolbar-tb_daily_tasks.png",toolbar_mail_icon_png:"#%n-toolbar-tb_messages.png",
toolbar_leader_board_icon_png:"#%n-toolbar-tb_leaderboard_icon.png",toolbar_rewarded_video_icon_png:"#%n-toolbar-tb_video.png",menu_icon_png:"#%n-controlbuttons-menu.png",button_png:"#%n-controlbuttons-menu_button.png",button_on_png:"#%n-controlbuttons-menu_button_on.png",fullscreen_icon_png:"#%n-controlbuttons-fullscreen_icon.png",back_button_png:"#%n-controlbuttons-back_button.png",back_button_on_png:"#%n-controlbuttons-back_button_on.png",back_icon_png:"#%n-controlbuttons-back.png",life_png:"#%n-menubar-life.png",life_unlim_png:"#%n-menubar-life_unlim.png",coin_png:"#%n-menubar-coin.png",star_chest_icon_png:"#%n-menubar-chest.png",menu_gold_bg_png:"#%n-menubar-bar_bg.png",plus_button_png:"#%n-menubar-plus.png",plus_button_on_png:"#%n-menubar-plus_on.png",window_button_png:"#%n-buttons-button.png",window_button_on_png:"#%n-buttons-button_on.png",window_button_disabled_png:"#%n-buttons-button_off.png",window_close_png:"#%n-buttons-close.png",
window_close_on_png:"#%n-buttons-close_on.png",blue_button_png:"#%n-buttons-button_blue.png",blue_button_on_png:"#%n-buttons-button_blue_on.png",help_button_png:"#%n-buttons-help_small.png",help_button_on_png:"#%n-buttons-help_small_on.png",exit_button_icon:"#%n-buttons-exit_icon.png",scene_exit_button:"#%n-buttons-scene_exit.png",small_green_button:"#%n-buttons-small_green_button.png",small_green_button_on:"#%n-buttons-small_green_button_on.png",small_blue_button:"#%n-buttons-small_blue_button.png",small_blue_button_on:"#%n-buttons-small_blue_button_on.png",music_off_png:"#%n-sounds-music_off.png",music_on_png:"#%n-sounds-music_on.png",sound_off_png:"#%n-sounds-sound_off.png",sound_on_png:"#%n-sounds-sound_on.png",close_small:"#%n-buttons-close_small.png",close_small_on:"#%n-buttons-close_small_on.png",red_button:"#%n-buttons-red_button.png",red_button_on:"#%n-buttons-red_button_on.png",vibro_off_png:"#%n-sounds-vibro_off.png",vibro_on_png:"#%n-sounds-vibro_on.png",
icon_bg:"#%n-sidebar-icon_bg.png",icon_text_bg:"#%n-icons-icon_text_bubble.png",icon_text_arrow_bg:"#%n-icons-icon_text_bubble_arrow.png",avatar_frame:"#%n-avatars-avatar_frame.png",avatar_frame2:"#%n-avatars-avatar_frame2.png",booster_before_bg_png:"#%n-boosters_before-booster_before_bg.png",booster_before_bg_on_png:"#%n-boosters_before-booster_before_bg_on.png",booster_before_bg_off_png:"#%n-boosters_before-booster_before_bg_off.png",booster_before_green_button_png:"#%n-boosters_before-booster_before_green_button.png",booster_before_purple_button_png:"#%n-boosters_before-booster_before_purple_button.png",booster_before_check_icon_png:"#%n-boosters_before-booster_before_check_icon.png",booster_before_plus_icon_png:"#%n-boosters_before-booster_before_plus_icon.png",booster_before_lantern_icon_png:"#%n-boosters_before-booster_before_lantern_icon.png",booster_before_price_bg_png:"#%n-boosters_before-booster_before_price_bg.png",arrow_png:"#%n-simple-arrow.png",
bar_png:"#%n-simple-bar.png",bar_bg_png:"#%n-simple-bar_bg.png",frame_gold_png:"#%n-simple-frame_gold.png",frame_silver_png:"#%n-simple-frame_silver.png",star_png:"#%n-simple-star.png",tape_png:"#%n-simple-tape.png",lock_png:"#%n-simple-lock.png",scroll_bg_png:"#%n-simple-scroll_bg.png",backgrounds_window_title_bg:"#%n-simple-backgrounds_window_title_bg.png",closed_bg_png:"#%n-simple-closed_bg.png",background_icon_0:"#%n-simple-background_icon_0.png",background_icon_1:"#%n-simple-background_icon_1.png",background_icon_2:"#%n-simple-background_icon_2.png",background_icon_3:"#%n-simple-background_icon_3.png",background_icon_4:"#%n-simple-background_icon_4.png",background_icon_5:"#%n-simple-background_icon_5.png",background_icon_6:"#%n-simple-background_icon_6.png",background_icon_7:"#%n-simple-background_icon_7.png",background_icon_8:"#%n-simple-background_icon_8.png",background_icon_9:"#%n-simple-background_icon_9.png",background_icon_10:"#%n-simple-background_icon_10.png",
background_icon_11:"#%n-simple-background_icon_11.png",background_icon_12:"#%n-simple-background_icon_12.png",background_icon_13:"#%n-simple-background_icon_13.png",background_icon_14:"#%n-simple-background_icon_14.png",lottery_en:"#%n-lottery-lottery_en.png",lottery_ru:"#%n-lottery-lottery_ru.png",ok_lottery:"#%n-lottery-ok_lottery.png",ok_lottery_10k:"#%n-lottery-ok_lottery_10000.png",vk_lottery:"#%n-lottery-vk_lottery.png",switch_state_button:"#%n-windows-graphics_switch.png",clover_png:"#%n-tournament-clover.png",rose_png:"#%n-tournament-crystal.png",tulpan_png:"#%n-tournament-bone.png",fly_clover_png:"#%n-tournament-clover.png"}},memorial:{urls:{png:"@%n-f1c9faed96.png",json:"@%n-f7d6e22c26.json"},jsons:{json:"@jsons/scientist-8c279820ff.json",icon_json:"@jsons/icon_tulpan-8fb7a698c2.json",plist:"@%n-f1c9faed96.plist",atlas:"@%n-f1c9faed96.atlas"},frames:{memorial_decor_top:"#%n-window_up.png",toolbar_decor:"#%n-toolbar_decor.png",mission_icon_png:"#%n-mission_icon.png",
memorial_decor_bottom_left:"#%n-window_down_left.png",memorial_decor_bottom_right:"#%n-window_down_right.png"}},menubar:{urls:{},injectTo:["game","main","race"],frameIds:["life_png","life_unlim_png","coin_png","star_chest_icon_png","menu_gold_bg_png","plus_button_png","plus_button_on_png","exp_png"],jsonIds:[],soundIds:[]},merge:{urls:{}},metha_simple_main:{urls:{}},metha_top_layer_0:{urls:{}},minesweeper:{urls:{}},mouse:{urls:{png:"@%n-a911668083.png",json:"@%n-846f5a5fe3.json"},jsons:{eater_spine_json:"@jsons/%n-e8f709b710.json",atlas:"@%n-a911668083.atlas"}},moves_cell:{urls:{png:"@%n-e9c2cd586b.png",json:"@%n-1b32b5f89a.json"},jsons:{plist:"@%n-e9c2cd586b.plist"},frames:{moves_cell:"#%n-images-%n.png"}},muffin:{urls:{png:"@%n-977511313b.png",json:"@%n-be6ee76f80.json"},jsons:{muffin_json:"@jsons/%n-5dc8145d88.json",plist:"@%n-977511313b.plist",atlas:"@%n-977511313b.atlas"},frames:{muffin_cherry:"#%n-images-%n_cherry.png"}},petards:{urls:{
petards_explosion_effect:"~sounds/s_firecrackerrelease-93392dff39.mp3",png:"@%n-a934616a7d.png",json:"@%n-5bc48be7b9.json"},jsons:{petards_json:"@jsons/%n-c45a22cdbf.json",petards_explosion_json:"@jsons/%n_explosion-2e8719d695.json",plist:"@%n-a934616a7d.plist",atlas:"@%n-a934616a7d.atlas"},frames:{mclrbmb_a:"#%n-images-mclrbmb_blue.png",mclrbmb_b:"#%n-images-mclrbmb_green.png",mclrbmb_c:"#%n-images-mclrbmb_purple.png",mclrbmb_d:"#%n-images-mclrbmb_red.png",mclrbmb_e:"#%n-images-mclrbmb_yellow.png",mclrbmb_w:"#%n-images-mclrbmb_white.png"}},piggybank_window:{urls:{png:"@%n-6ff301a98a.png",json:"@%n-d3c5a25ffc.json"},jsons:{piggy_bank_window_json:"@jsons/piggy_bank-e45517874a.json",atlas:"@%n-6ff301a98a.atlas"}},prolongation_window:{urls:{png:"@%n-877c9fcc5c.png",json:"@%n-92f3f13802.json"},jsons:{sad_jelly_spine_json:"@jsons/sad_jelly-cff4755324.json",atlas:"@%n-877c9fcc5c.atlas"}},promotion_adventure_en:{urls:{image:"@adventure-5d35db83ca.jpg"}},promotion_adventure_ru:{urls:{
image:"@adventure-81c39864ca.jpg"}},promotion_crocword_de:{urls:{image:"@crocword-8e180fa28c.jpg"}},promotion_crocword_en:{urls:{image:"@crocword-50a3c2e09b.jpg"}},promotion_crocword_es:{urls:{image:"@crocword-5d726c18ef.jpg"}},promotion_crocword_fr:{urls:{image:"@crocword-b29ec54414.jpg"}},promotion_crocword_it:{urls:{image:"@crocword-52921a2490.jpg"}},promotion_crocword_ru:{urls:{image:"@crocword-04c2173528.jpg"}},promotion_differences_en:{urls:{image:"@differences-4d856bb693.jpg"}},promotion_differences_ru:{urls:{image:"@differences-2936f83b67.jpg"}},promotion_heroes_en:{urls:{image:"@heroes-a832bb6d6d.jpg"}},promotion_heroes_ru:{urls:{image:"@heroes-09bae5b254.jpg"}},promotion_olympics_de:{urls:{image:"@olympics-499c616821.jpg"}},promotion_olympics_en:{urls:{image:"@olympics-fb3fadbc6f.jpg"}},promotion_olympics_es:{urls:{image:"@olympics-767b28ab28.jpg"}},promotion_olympics_fr:{urls:{image:"@olympics-28fa89a300.jpg"}},promotion_olympics_it:{urls:{image:"@olympics-a9eb2d4445.jpg"}},
promotion_olympics_ru:{urls:{image:"@olympics-657a1659cd.jpg"}},promotion_riddles_en:{urls:{image:"@riddles-6e4a64f461.jpg"}},promotion_riddles_ru:{urls:{image:"@riddles-a04f70fa4d.jpg"}},promotion_runes_en:{urls:{image:"@runes-4189fa6106.jpg"}},promotion_runes_ru:{urls:{image:"@runes-8ea348dfc8.jpg"}},promotion_scramble_en:{urls:{image:"@scramble-8e2a61d6d9.jpg"}},promotion_scramble_fr:{urls:{image:"@scramble-da8e269592.jpg"}},promotion_scramble_ru:{urls:{image:"@scramble-8ab8306ddd.jpg"}},promotion_tripeaks_de:{urls:{image:"@tripeaks-d748eb75e8.jpg"}},promotion_tripeaks_en:{urls:{image:"@tripeaks-190f4e7ac8.jpg"}},promotion_tripeaks_es:{urls:{image:"@tripeaks-e80b0dbc61.jpg"}},promotion_tripeaks_fr:{urls:{image:"@tripeaks-c7665a69ae.jpg"}},promotion_tripeaks_it:{urls:{image:"@tripeaks-82d49cd2e2.jpg"}},promotion_tripeaks_ru:{urls:{image:"@tripeaks-b79c82d8e6.jpg"}},promotion_wordsoup_de:{urls:{image:"@wordsoup-8392808e0c.jpg"}},promotion_wordsoup_en:{urls:{
image:"@wordsoup-26337c641b.jpg"}},promotion_wordsoup_es:{urls:{image:"@wordsoup-cde236a3a6.jpg"}},promotion_wordsoup_fr:{urls:{image:"@wordsoup-d02f7f9b50.jpg"}},promotion_wordsoup_it:{urls:{image:"@wordsoup-c9f4605075.jpg"}},promotion_wordsoup_ru:{urls:{image:"@wordsoup-4b87340634.jpg"}},rabbit:{urls:{png:"@%n-d5741ec213.png",json:"@%n-2142db1792.json"},jsons:{wrapper_spine1_json:"@jsons/wrapper_spine-61813b5efb.json",plist:"@%n-d5741ec213.plist",atlas:"@%n-d5741ec213.atlas"},frames:{rabbit_goal:"#%n-images-%n_x1.png",rabbit_tile_1:"#%n-images-%n_x1.png",rabbit_tile_2:"#%n-images-%n_x4.png",rabbit_tile_cover:"#%n-images-%n_wrapper.png"}},race:{urls:{png:"@%n-24a5f7ea09.png",json:"@%n-27d4533ec4.json"},jsons:{plist:"@%n-24a5f7ea09.plist"},frames:{life_png:"#%n-menubar-life.png",life_unlim_png:"#%n-menubar-life_unlim.png",coin_png:"#%n-menubar-coin.png",star_chest_icon_png:"#%n-menubar-chest.png",menu_gold_bg_png:"#%n-menubar-bar_bg.png",plus_button_png:"#%n-menubar-plus.png",
plus_button_on_png:"#%n-menubar-plus_on.png",exp_png:"#%n-menubar-exp.png"}},raffle_victory:{urls:{png:"@%n-fc95f70897.png",json:"@%n-5e7d5e581e.json"},jsons:{raffle_json:"@jsons/victory_raffle-9790397f98.json",atlas:"@%n-fc95f70897.atlas"}},raffle_window:{urls:{png:"@%n-948b71df9b.png",json:"@%n-e6b43199e4.json"},jsons:{tickets_json:"@jsons/tickets-2f04c88317.json",tickets_rules_json:"@jsons/iphone_tutorial-ed10652731.json",plist:"@%n-948b71df9b.plist",atlas:"@%n-948b71df9b.atlas"},frames:{tickets:"#%n-raffle-icon_balance.png",progress_bar:"#%n-raffle-bar.png",progress_bar_bg:"#%n-raffle-barbg.png"}},reward_icons:{urls:{},injectTo:["tile_shop","game","main","shop_user_gold_view","admin"],frameIds:["gold_small_png","gold_png","reward_exp_png","exp_png","cellbooster_small","linebooster_small","colorbooster_small","cellbooster","linebooster","colorbooster","life_unlim","life_unlim_small","stars_png","heroes_png","moves_png","multicolor_png","heroes_small_png","moves_small_png",
"multicolor_small_png"],jsonIds:[],soundIds:[]},rose_tournament:{urls:{png:"@%n-d11daeefe4.png",json:"@%n-3eecb01b0c.json"},jsons:{json:"@jsons/greentournament-a28088016c.json",atlas:"@%n-d11daeefe4.atlas"}},rotate_phone:{urls:{rotate_png:"@phoneturn-7a474f6b71.png"}},ruby_tournament:{urls:{}},rug:{urls:{png:"@%n-901d0c16ac.png",json:"@%n-f629fbda76.json"},jsons:{plist:"@%n-901d0c16ac.plist"},frames:{rug_tile:"#%n-images-%n_tile.png",rug_goal:"#%n-images-%n_goal.png"}},shared:{urls:{},injectTo:["main","game"],frameIds:["adicon_png"],jsonIds:[],soundIds:[]},shark:{urls:{shark_effect:"~sounds/s_fry-37a5c60c4f.mp3",shark_poof_effect:"~sounds/s_fry_poof-26512bc49e.mp3",png:"@%n-de7df9fcc0.png",json:"@%n-cebfc3d741.json"},jsons:{shark_json:"@jsons/%n-b7b16ebd7b.json",atlas:"@%n-de7df9fcc0.atlas"}},shop_digits:{urls:{},injectTo:["tile_shop"],frameIds:["shop_digit_0","shop_digit_1","shop_digit_2","shop_digit_3","shop_digit_4","shop_digit_5","shop_digit_6","shop_digit_7","shop_digit_8",
"shop_digit_9","shop_digit_x"],jsonIds:[],soundIds:[]},shop_user_gold_view:{urls:{png:"@%n-9123600037.png",json:"@%n-187ad6f5a4.json"},jsons:{yellow_money_spine_json:"@jsons/yellow_money-299965371d.json",plist:"@%n-9123600037.plist",atlas:"@%n-9123600037.atlas"},frames:{shopusergold_bg_png:"#%n-gold_view-speak_bg.png",gold_small_png:"#%n-reward_icons-gold_small.png",gold_png:"#%n-reward_icons-gold.png",reward_exp_png:"#%n-reward_icons-exp.png",exp_png:"#%n-menubar-exp.png",cellbooster_small:"#%n-reward_icons-cell_small.png",linebooster_small:"#%n-reward_icons-line_small.png",colorbooster_small:"#%n-reward_icons-color_small.png",cellbooster:"#%n-reward_icons-cell.png",linebooster:"#%n-reward_icons-line.png",colorbooster:"#%n-reward_icons-color.png",life_unlim:"#%n-reward_icons-life_unlim.png",life_unlim_small:"#%n-reward_icons-life_unlim_small.png",stars_png:"#%n-reward_icons-stars.png",heroes_png:"#%n-reward_icons-heroes.png",moves_png:"#%n-reward_icons-moves.png",
multicolor_png:"#%n-reward_icons-multicolor.png",heroes_small_png:"#%n-reward_icons-heroes_small.png",moves_small_png:"#%n-reward_icons-moves_small.png",multicolor_small_png:"#%n-reward_icons-multicolor_small.png"}},sidebar:{urls:{},injectTo:["main"],frameIds:["icon_bg","icon_text_bg","icon_text_arrow_bg"],jsonIds:["lives_sale_icon_json","dailycup_icon_json","piggybank_icon_json","pack_icon_json","pack1_icon_json","pack2_icon_json","premium_icon_json","tournament_magic_icon_json","tournament_tulpan_icon_json","tournament_rose_icon_json","heroes_icon_json","lantern_icon_json","boosters_sale_icon_json","treasure_search_icon_json","battlepass_icon_json","raffle_icon_json"],soundIds:[]},simple:{urls:{},injectTo:["main"],frameIds:["arrow_png","bar_png","bar_bg_png","frame_gold_png","frame_silver_png","star_png","tape_png","lock_png","scroll_bg_png","backgrounds_window_title_bg","closed_bg_png","background_icon_0","background_icon_1","background_icon_2","background_icon_3",
"background_icon_4","background_icon_5","background_icon_6","background_icon_7","background_icon_8","background_icon_9","background_icon_10","background_icon_11","background_icon_12","background_icon_13","background_icon_14"],jsonIds:["star_json","progress_bar_json","avatar_spark_json","progress_bar_spark_json"],soundIds:["star_collect_effect","%n_win_effect","%n_transition_effect","metha_present_effect"]},simple_background_0:{urls:{background:"@background_0-a27654ed73.jpg"}},simple_background_1:{urls:{background:"@background_1-13783761de.jpg"}},simple_background_10:{urls:{background:"@background_10-8248c0b459.jpg"}},simple_background_11:{urls:{background:"@background_11-cabb13e5a0.jpg"}},simple_background_12:{urls:{background:"@background_12-8ad1c2e1dc.jpg"}},simple_background_13:{urls:{background:"@background_13-2a6cf53de5.jpg"}},simple_background_14:{urls:{background:"@background_14-0553ecb3c1.jpg"}},simple_background_2:{urls:{background:"@background_2-6cbce1b938.jpg"}},
simple_background_3:{urls:{background:"@background_3-e39b7d284c.jpg"}},simple_background_4:{urls:{background:"@background_4-307d7d34fc.jpg"}},simple_background_5:{urls:{background:"@background_5-857fe83585.jpg"}},simple_background_6:{urls:{background:"@background_6-59397a40c9.jpg"}},simple_background_7:{urls:{background:"@background_7-21266837fc.jpg"}},simple_background_8:{urls:{background:"@background_8-8e12c551ab.jpg"}},simple_background_9:{urls:{background:"@background_9-e5dcc4afaf.jpg"}},small_petard:{urls:{png:"@%n-489be2280f.png",json:"@%n-4948dbba6e.json"},jsons:{small_petard_json:"@jsons/%n-68f002d569.json",plist:"@%n-489be2280f.plist",atlas:"@%n-489be2280f.atlas"},frames:{small_petard_lives_bg:"#%n-images-%n_lives_bg.png",small_petard_wave:"#%n-images-%n_wave.png"}},sounds:{urls:{}},starchest_window:{urls:{png:"@%n-5d4cf21090.png",json:"@%n-ad36a122ce.json"},jsons:{star_chest_spine_json:"@jsons/star_chest-84717f7c82.json",
starchest_life_jelly_spine_json:"@jsons/star_life_jelly_animation-8bde06f426.json",atlas:"@%n-5d4cf21090.atlas"}},starter_pack:{urls:{png:"@%n-e5df61e4ad.png",json:"@%n-fe4a29d0b5.json"},jsons:{pack_json:"@jsons/%n_flower-c73b72fed0.json",atlas:"@%n-e5df61e4ad.atlas"}},store_links:{urls:{amazon_png:"@amazon-fff217ce99.png",ios_png:"@appstore-7ca2da36e4.png",android_png:"@googleplay-d959d72ee5.png"}},subscription_window:{urls:{png:"@%n-3a478513f8.png",json:"@%n-d6f5102698.json"},jsons:{subscription_window_star_json:"@jsons/premium_star-e44eee891d.json",subscription_window_boosters_json:"@jsons/premium_boosters-6b3229edd2.json",plist:"@%n-3a478513f8.plist",atlas:"@%n-3a478513f8.atlas"},frames:{heap_gold_png:"#%n-tile_shop-shop_coins_3800.png",premium_bg:"#%n-subscription-premium_bg.png"}},switch_state_button:{urls:{},injectTo:["editor","main"],frameIds:["%n"],jsonIds:[],soundIds:[]},syrup:{urls:{png:"@%n-d7ba69852d.png",json:"@%n-26465937d5.json"},jsons:{
syrup_json:"@jsons/%n-202f40398e.json",syrup_goal_json:"@jsons/%n_goal-ab64d19b3c.json",atlas:"@%n-d7ba69852d.atlas"}},tile_shop:{urls:{png:"@%n-538776575b.png",json:"@%n-add03adf76.json"},jsons:{shop_sparkles_small_json:"@jsons/shop_sparkles_small-11e96d2c9e.json",shop_sparkles_large_json:"@jsons/shop_sparkles_large-cba75331e0.json",shop_lives_animations_json:"@jsons/unlim_lives_animation-7184cb8292.json",plist:"@%n-538776575b.plist",atlas:"@%n-538776575b.atlas"},frames:{shop_tile_bg_png:"#%n-shop_bg_white.png",shop_badge_bestseller_png:"#%n-shop_best_seller.png",tile_stripe_png:"#%n-shop_inner_bg.png",tile_best_stripe_png:"#%n-shop_inner_bg.png",askLives_png:"#%n-life_friends.png",refillLives_5_png:"#%n-life_5.png",red_stripe_png:"#%n-shop_purple_ribbon.png",unlimitedLives_png:"#%n-life_infinity.png",more_button_png:"#%n-more_button.png",shop_gold1_png:"#%n-shop_coins_500.png",shop_gold2_png:"#%n-shop_coins_500.png",shop_gold3_png:"#%n-shop_coins_1800.png",
heap_gold_png:"#%n-shop_coins_3800.png",shop_gold4_png:"#%n-shop_coins_6000.png",shop_gold5_png:"#%n-shop_coins_25000.png",small_shop_button:"#%n-buttons-small_green_button.png",small_shop_button_on:"#%n-buttons-small_green_button_on.png",ok_icon_png:"#%n-socialicons-ok_icon.png",shop_inner_bg_png:"#%n-shop_inner_bg.png",epic_pack_png:"#%n-epic_pack.png",honey_pack_png:"#%n-honey_pack.png",jam_pack_png:"#%n-jam_pack.png",sweet_pack_png:"#%n-sweet_pack.png",tasty_pack_png:"#%n-tasty_pack.png",gold_small_png:"#%n-reward_icons-gold_small.png",gold_png:"#%n-reward_icons-gold.png",reward_exp_png:"#%n-reward_icons-exp.png",exp_png:"#%n-menubar-exp.png",cellbooster_small:"#%n-reward_icons-cell_small.png",linebooster_small:"#%n-reward_icons-line_small.png",colorbooster_small:"#%n-reward_icons-color_small.png",cellbooster:"#%n-reward_icons-cell.png",linebooster:"#%n-reward_icons-line.png",colorbooster:"#%n-reward_icons-color.png",life_unlim:"#%n-reward_icons-life_unlim.png",
life_unlim_small:"#%n-reward_icons-life_unlim_small.png",stars_png:"#%n-reward_icons-stars.png",heroes_png:"#%n-reward_icons-heroes.png",moves_png:"#%n-reward_icons-moves.png",multicolor_png:"#%n-reward_icons-multicolor.png",heroes_small_png:"#%n-reward_icons-heroes_small.png",moves_small_png:"#%n-reward_icons-moves_small.png",multicolor_small_png:"#%n-reward_icons-multicolor_small.png",level_digit_0:"#%n-level-0.png",level_digit_1:"#%n-level-1.png",level_digit_2:"#%n-level-2.png",level_digit_3:"#%n-level-3.png",level_digit_4:"#%n-level-4.png",level_digit_5:"#%n-level-5.png",level_digit_6:"#%n-level-6.png",level_digit_7:"#%n-level-7.png",level_digit_8:"#%n-level-8.png",level_digit_9:"#%n-level-9.png",timer_digit_0:"#%n-timer-0.png",timer_digit_1:"#%n-timer-1.png",timer_digit_2:"#%n-timer-2.png",timer_digit_3:"#%n-timer-3.png",timer_digit_4:"#%n-timer-4.png",timer_digit_5:"#%n-timer-5.png",timer_digit_6:"#%n-timer-6.png",timer_digit_7:"#%n-timer-7.png",timer_digit_8:"#%n-timer-8.png",
timer_digit_9:"#%n-timer-9.png",timer_digit_colon:"#%n-timer-colon.png",timer_digit_slash:"#%n-timer-slash.png",timer_digit_x:"#%n-timer-x.png",lottery_en:"#%n-lottery-lottery_en.png",lottery_ru:"#%n-lottery-lottery_ru.png",ok_lottery:"#%n-lottery-ok_lottery.png",ok_lottery_10k:"#%n-lottery-ok_lottery_10000.png",vk_lottery:"#%n-lottery-vk_lottery.png",shop_digit_0:"#%n-shop-0.png",shop_digit_1:"#%n-shop-1.png",shop_digit_2:"#%n-shop-2.png",shop_digit_3:"#%n-shop-3.png",shop_digit_4:"#%n-shop-4.png",shop_digit_5:"#%n-shop-5.png",shop_digit_6:"#%n-shop-6.png",shop_digit_7:"#%n-shop-7.png",shop_digit_8:"#%n-shop-8.png",shop_digit_9:"#%n-shop-9.png",shop_digit_x:"#%n-shop-x.png"}},toolbar:{urls:{},injectTo:["main"],frameIds:["%n_bg_png","%n_attention_icon_png","%n_dailybonus_icon_png","%n_daily_tasks_icon_png","%n_mail_icon_png","%n_leader_board_icon_png","%n_rewarded_video_icon_png"],jsonIds:[],soundIds:[]},tooltip:{urls:{},injectTo:["game","main"],frameIds:["%n_bg_png",
"%n_shadow_arrow_png","%n_arrow_png"],jsonIds:[],soundIds:[]},tournament_icon:{urls:{},injectTo:["main","game"],frameIds:["clover_png","rose_png","tulpan_png","fly_clover_png"],jsonIds:[],soundIds:[]},transition:{urls:{},injectTo:["main"],frameIds:[],jsonIds:["%n_json"],soundIds:[]},transporter:{urls:{png:"@%n-e8ec0cc776.png",json:"@%n-f22faa075e.json"},jsons:{transporter_json:"@jsons/%n-d62c135fe3.json",plist:"@%n-e8ec0cc776.plist",atlas:"@%n-e8ec0cc776.atlas"},frames:{transporter_straight_tile:"#%n-images-%n_hrzt.png",transporter_corner_tile:"#%n-images-%n_curve.png"}},treasuresearch:{urls:{png:"@%n-266374dccc.png",json:"@%n-3063f12561.json"},jsons:{clouds:"@jsons/gem_clouds-33d4e099aa.json",weed:"@jsons/weed-aeae0fb5a4.json",hover:"@jsons/hover-0e1a30fcb3.json",holder:"@jsons/flowers-6ae6cd5e50.json",prize:"@jsons/treasure_prise-c8c13165e3.json",plist:"@%n-266374dccc.plist",atlas:"@%n-266374dccc.atlas"},frames:{tile:"#%n-treasure_search-ground.png",bg:"#%n-treasure_search-bg.png",
win_bg:"#%n-treasure_search-win_bg.png",shovel:"#%n-treasure_search-shovel.png",bg_left:"#%n-treasure_search-ogorod_decor_l.png",bg_right:"#%n-treasure_search-ogorod_decor_r.png"}},truffle:{urls:{png:"@%n-b97c6390b1.png",json:"@%n-560595db37.json"},jsons:{truffles_spine_json:"@jsons/%ns_spine-d06f555089.json",plist:"@%n-b97c6390b1.plist",atlas:"@%n-b97c6390b1.atlas"},frames:{truffle_cell_a:"#%n-images-%ns_blue.png",truffle_cell_b:"#%n-images-%ns_green.png",truffle_cell_c:"#%n-images-%ns_purple.png",truffle_cell_d:"#%n-images-%ns_red.png",truffle_cell_e:"#%n-images-%ns_yellow.png",truffle_cell_w:"#%n-images-%ns_white.png",truffle_goal:"#%n-images-%ns_goal.png",truffle_cell_last_a:"#%n-images-blue_%n_last.png",truffle_cell_last_b:"#%n-images-green_%n_last.png",truffle_cell_last_c:"#%n-images-purple_%n_last.png",truffle_cell_last_d:"#%n-images-red_%n_last.png",truffle_cell_last_e:"#%n-images-yellow_%n_last.png",truffle_cell_last_w:"#%n-images-white_%n_last.png"}},tulpan_tournament:{urls:{
png:"@%n-730edc2af4.png",json:"@%n-ad565ee880.json"},jsons:{json:"@jsons/scientist-5953db0081.json",atlas:"@%n-730edc2af4.atlas"}},valentines:{urls:{png:"@%n-1266436f90.png",json:"@%n-3c096f039a.json"},jsons:{json:"@jsons/scientist-8c279820ff.json",icon_json:"@jsons/icon_tulpan-8fb7a698c2.json",plist:"@%n-1266436f90.plist",atlas:"@%n-1266436f90.atlas"},frames:{valentines_icon_bg_png:"#%n-icon_bg.png",mission_icon_png:"#%n-mission_icon.png",valentines_menu_bar_decor_1_png:"#%n-menu_bar_item_decor_1.png",valentines_menu_bar_decor_2_png:"#%n-menu_bar_item_decor_2.png",valentines_scene_button_decor_png:"#%n-scene_button_decor.png",valentines_toolbar_decor_1_png:"#%n-toolbar_cloud_right.png",valentines_window_cloud_up_heart_png:"#%n-window_cloud_up_heart.png",valentines_window_cloud_up2_png:"#%n-window_cloud_up2.png",valentines_window_decor_cloud_2_png:"#%n-window_decor_cloud_2.png"}},victorywindow:{urls:{},injectTo:["main"],frameIds:["level_victory_reward_bg","level_victory_reward_line"],
jsonIds:[],soundIds:[]},waffle:{urls:{png:"@%n-dae20d4066.png",json:"@%n-97d23a09cc.json"},jsons:{plist:"@%n-dae20d4066.plist"},frames:{waffle_cell_a:"#%n-images-%ns_blue.png",waffle_cell_b:"#%n-images-%ns_green.png",waffle_cell_c:"#%n-images-%ns_purple.png",waffle_cell_d:"#%n-images-%ns_red.png",waffle_cell_e:"#%n-images-%ns_yellow.png",waffle_cell_w:"#%n-images-%ns_white.png",waffle_goal:"#%n-images-%ns_goal.png"}},wall:{urls:{png:"@%n-8d01f4ebd1.png",json:"@%n-fa3c08fd6d.json"},jsons:{plist:"@%n-8d01f4ebd1.plist"},frames:{wall_tile:"#%n-images-%n_tile.png"}},wardrobe_window:{urls:{}},white_digits:{urls:{},injectTo:["ice_maker","bomb"],frameIds:["white_digit_0","white_digit_1","white_digit_2","white_digit_3","white_digit_4","white_digit_5","white_digit_6","white_digit_7","white_digit_8","white_digit_9"],jsonIds:[],soundIds:[]},windows:{urls:{},injectTo:["main"],frameIds:["window_bg_png","window_decor_1_png","window_decor_2_png","hard_level_fire","hard_level_title_bg"],jsonIds:[
"present_json","hl_animation_left_json","hl_animation_right_json"],soundIds:[]},world_map:{urls:{}},xmas:{urls:{png:"@%n-e3695c9b95.png",json:"@%n-2efda966b8.json"},jsons:{E_hero_spine_json:"@jsons/yellow_hero-4f2aadfc49.json",D_hero_spine_json:"@jsons/red_hero-c06a636ef3.json",A_hero_spine_json:"@jsons/blue_hero-3cde023395.json",B_hero_spine_json:"@jsons/green_hero-f5e737a7d3.json",C_hero_spine_json:"@jsons/purple_hero-38acee4177.json",W_hero_spine_json:"@jsons/white_hero-89cb998d0f.json",plist:"@%n-e3695c9b95.plist",atlas:"@%n-e3695c9b95.atlas"},frames:{window_bg_png:"#%n-window_bg.png",window_decor_1_png:"#%n-window_decor_1.png",window_decor_2_png:"#%n-window_decor_2.png"}}},buildConfig={resolutions:{high:{scale:1,id:"high",height:1334,options:{pngcrush:!0,depth:6}}},target:"web",env:"release",project:"mergeriddles|mergeheroes",buildDir:"publish/html5"},resolutions=buildConfig.resolutions,unmifiyBundlesRec=function(e,t,i){var s=e[t];if("object"==typeof s)for(var n in s
)unmifiyBundlesRec(s,n,i);else"string"==typeof s&&(s=(s=(s=s.replace("@","~%n/%r/")).replace("~","res/packed/")).replace(new RegExp("%n","g"),i),e[t]=s)},isVirtualLink=function(e){return"string"==typeof e&&"@"===e.charAt(0)},parseVirtualLink=function(e){var t=e.indexOf("#");return{bundle:e.substr(1,t-1),id:e.substr(t+1)}},processVirtualUrl=function(e){if(!isVirtualLink(e))return e;var t=parseVirtualLink(e),i=bundles[t.bundle];for(var s in i.injectTo){var n=i.injectTo[s];if(cleverapps.bundleLoader.isLoaded(n))return bundles[n].urls[t.id]}var o="no urlId "+e+" for bundle "+t.bundle;if(console.log(o),cleverapps.config.debugMode)throw o},processVirtualFrame=function(e){if(!isVirtualLink(e))return e;var t=parseVirtualLink(e),i=bundles[t.bundle];for(var s in i.injectTo){var n=i.injectTo[s];if(cleverapps.bundleLoader.isLoaded(n))return bundles[n].frames[t.id]}var o="no frameId "+e+" for bundle "+t.bundle;if(console.log(o),cleverapps.config.debugMode)throw o},processVirtualJson=function(e){if(
!isVirtualLink(e))return e;var t=parseVirtualLink(e),i=bundles[t.bundle];for(var s in i.injectTo){var n=i.injectTo[s];if(cleverapps.bundleLoader.isLoaded(n))return bundles[n].jsons[t.id]}var o="no json "+e+" for bundle "+t.bundle;if(console.log(o),cleverapps.config.debugMode)throw o},processInlineJSONs=function(e){for(var t in e.jsons){var i=e.jsons[t];if(i.inline){var s=JSON.parse(i.data),n=i.url;cc.loader.cache[n]=s,e.jsons[t]=n}}},unminifyBundles=function(e){for(var t in e=e||Object.keys(bundles)){var i=e[t];unmifiyBundlesRec(bundles,i,i),bundles[i].frames||(bundles[i].frames={}),bundles[i].jsons||(bundles[i].jsons={}),processInlineJSONs(bundles[i]);var s=bundles[i];s.injectTo&&s.frameIds&&(s.frameIds.forEach(function(e){s.frames[e]="@"+i+"#"+e}),delete s.frameIds),s.injectTo&&s.jsonIds&&(s.jsonIds.forEach(function(e){s.jsons[e]="@"+i+"#"+e}),delete s.jsonIds),s.injectTo&&s.soundIds&&(s.soundIds.forEach(function(e){s.urls[e]="@"+i+"#"+e}),delete s.soundIds)}};unminifyBundles()
;var Bundle=function(e){this.name=e,this.data=bundles[e]};Bundle.prototype.onLoad=function(){var e=cc.loader.getRes(this.data.urls.json);for(var t in e){var i=this.data.jsons[t],s=e[t];"string"==typeof i&&".plist"===cc.path.extname(i)&&(s=cc.plistParser.parse(s)),cc.loader.cache[i]=s}this.data.jsons.plist&&cc.spriteFrameCache.addSpriteFrames(this.data.jsons.plist),-1!==["game","main","heroes","transition"].indexOf(this.name)&&this.injectTo(res)},Bundle.prototype.isResourceSound=function(e){return e&&"string"==typeof e&&(-1!==e.indexOf("/sfx/")||-1!==e.indexOf(".mp3"))},Bundle.prototype.listSoundUrls=function(){return cleverapps.values(this.data.urls).filter(function(e){return this.isResourceSound(e)}.bind(this)).filter(function(e){return-1===e.indexOf("music")})},Bundle.prototype.listUrls=function(){return cleverapps.values(this.data.urls).filter(function(e){return!this.isResourceSound(e)&&!isVirtualLink(e)}.bind(this))},Bundle.prototype.listJsons=function(){return cleverapps.values(
this.data.jsons)},Bundle.prototype.injectTo=function(t){["urls","frames","jsons"].forEach(function(e){cleverapps.extend(t,this.data[e])},this)};var BundleLoader=function(){this.handles={},this.blockedCounter=0,this.unusedResources={},this.unusedBundles={},this.waitWindow=void 0,this.onceFinishLoadCallback=void 0};BundleLoader.prototype.whenLoadFinish=function(e){0===this.blockedCounter?e():this.onceFinishLoadCallback=cleverapps.once(e)},BundleLoader.prototype.addBlockWindow=function(){if(0===this.blockedCounter){var e=cc.director.getRunningScene();e&&e.scene&&!cleverapps.scenes.isLoaderScene()&&!this.waitWindow&&(this.waitWindow=new WaitWindow)}this.blockedCounter++},BundleLoader.prototype.removeBlockWindow=function(){this.blockedCounter--,this.blockedCounter<=0&&(this.waitWindow&&(this.waitWindow.close(),this.waitWindow=void 0),this.onceFinishLoadCallback&&this.onceFinishLoadCallback())},BundleLoader.prototype.onFailure=function(e,t){var i=this.getHandle(e),s=i&&i.onFailures
;cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAIL_BUNDLE+e),i&&i.blocked?(this.waitWindow&&(this.waitWindow.close(),this.waitWindow=!1),new RestartWindow):this.deleteBundle(e,!0),cleverapps.versionChecker.isClientVersionActual()&&!cleverapps.config.debugMode&&cleverapps.checkStatus(t,404)&&setTimeout(function(){throw"load actual bundle "+e+" 404 error"},0),s&&s.forEach(function(e){e(t)})},BundleLoader.prototype.loadBundles=function(e,t){var i=t&&t.onSuccess||function(){},s=t&&t.onFailure,n=cleverapps.wait(e&&e.length||0,i);s&&(s=cleverapps.once(s));for(var o=0;o<e.length;o++){var a={onSuccess:n,onFailure:s,blocked:t&&t.blocked};this.loadBundle(e[o],a)}},BundleLoader.prototype.getHandle=function(e){return this.handles[e]},BundleLoader.prototype.countLoaded=function(e){if(Array.isArray(e))return e.filter(function(e){return this.countLoaded(e)}.bind(this)).length;var t=this.getHandle(e);return t&&t.loaded?1:0},BundleLoader.prototype.isLoaded=function(e){return Array.isArray(e)||(e=[
e]),this.countLoaded(e)===e.length},BundleLoader.prototype.loadBundle=function(t,e){if(t&&t.loadBundle)t.loadBundle(e);else{var i=bundles[t],s=this.getHandle(t),n=(e=e||{}).onSuccess,o=e.onFailure,a=e.blocked;if(s)return s.counter++,void(s.loaded?n&&n(i):(n&&s.onSuccesses.push(n),o&&s.onFailures.push(o),!s.blocked&&a&&(s.blocked=!0,this.addBlockWindow())));var r=[];n&&(r=Array.isArray(n)?n:[n]);var l=[];o&&(l=Array.isArray(o)?o:[o]);var c={loaded:!1,counter:1,onSuccesses:r,onFailures:l,blocked:a};if(this.handles[t]=c,a&&this.addBlockWindow(),c.onLoadedUrls=cleverapps.once(function(){c.loaded=!0,c.blocked&&this.removeBlockWindow(),new Bundle(t).onLoad();for(var e=0;e<c.onSuccesses.length;e++)r[e].call(this,i);delete c.onSuccesses,delete c.onFailures,delete c.blocked}.bind(this)),bundles[t].injectTo)c.onLoadedUrls();else{var p=3,d=function(){if(this.getHandle(t)){var e=cc.game.config.noCache;i.noCache&&!e&&(cc.game.config.noCache=!0),cc.loader.load(new Bundle(t).listUrls(),function(e){
e?(console.log("load failed",e,JSON.stringify(new Bundle(t).listUrls())),p<=1||cleverapps.checkStatus(e,404)?cleverapps.versionChecker.loadClientVersion(function(){this.onFailure(t,e)}.bind(this)):(p--,d())):(c.onLoadedUrls(),cc.loader.load(new Bundle(t).listSoundUrls()))}.bind(this)),cc.game.config.noCache=e}}.bind(this);d()}}},BundleLoader.prototype.checkUrlUseInLoadedBundles=function(e){for(var t in this.handles){var i=new Bundle(t).listUrls();for(var s in i)if(i[s]===e)return!0}return!1},BundleLoader.prototype.deleteBundles=function(e){if(e)for(var t=0;t<e.length;t++)this.deleteBundle(e[t])},BundleLoader.prototype.deleteBundle=function(e,t){var i=this.handles[e];if(void 0!==i&&-1===["main","transition","episodes_resources"].indexOf(e)&&(i.counter--,!(0<i.counter||bundles[e].storage)))if(bundles[e].injectTo)delete this.handles[e];else{t||i.loaded||!i.blocked||console.log("Remove blocked loading bundle (maybe error!)",e),i.loaded&&this.clearOverrides(i);var s=new Bundle(e).listUrls()
;for(var n in i.onLoadedUrls=function(){},delete this.handles[e],s){var o=s[n];this.checkUrlUseInLoadedBundles(o)||(this.unusedResources[o]=!0)}this.unusedBundles[e]=!0}},BundleLoader.prototype.override=function(e,t,i,s){if(t){var n=t[i];t[i]=s,e.overrides=e.overrides||[],e.overrides.push({target:t,key:i,value:s,oldValue:n})}},BundleLoader.prototype.clearOverrides=function(e){if(e.overrides){for(var t=e.overrides.length-1;0<=t;t--){var i=e.overrides[t];i.target[i.key]=i.oldValue}delete e.overrides}},BundleLoader.prototype.clearUnusedResources=function(){var e=this.unusedResources;for(var t in e)if(!this.checkUrlUseInLoadedBundles(t)){var i=cc.textureCache.getTextureForKey(t);i&&(cc.spriteFrameCache.removeSpriteFramesFromTexture(i),cc.textureCache.removeTextureForKey(t)),cc.loader.release(t)}this.unusedResources={},Object.keys(this.unusedBundles).forEach(function(e){bundles[e].injectTo||this.handles[e]||new Bundle(e).listJsons().forEach(function(e){delete cleverapps.Spine.cache[e]})
}.bind(this)),this.unusedBundles={}},BundleLoader.prototype.getClassBundles=function(e,t,i){var s=[];return"function"==typeof e.BUNDLES?s=e.BUNDLES.apply(t,i):Array.isArray(e.BUNDLES)&&(s=e.BUNDLES),cleverapps.skins.getBundle()&&s.push(cleverapps.skins.getBundle()),s},BundleLoader.prototype.allLoaded=function(e){return 0===e.filter(function(e){return bundles[e]&&!this.isLoaded(e)},this).length};var res={};ResourceProcessor.preprocessCompat();var cleverapps_events={APP_INITIALIZE:"app_initialize",PUSH_IOS:"push_ios",BEFORE_LEAVE_WINDOW:"before_leave_window",BEFORE_LEAVE_CATCH:"before_leave_catch",BOOKMARK:"bookmark",JOIN_GROUP:"join_group",AD_READY:"ad_ready",AD_START:"ad_start",AD_FINISH:"ad_finish",HINT_USED:"hint_used",REWARD_RECEIVED:"reward_received",SHOP_OPEN:"shop_open",TILE_SHOP_OPEN:"tile_shop_open",DAU:"dau",DAU_LANGUAGE:"dau_language",USER_GOLD_DAU:"user_gold_dau",UNIQUE_START:"lev_start",UNIQUE_FINISH:"lev_finish",ERROR_AMOUNT:"error_amount",DAU_WFRIENDS_0:"dau_wfriends_0",
DAU_WFRIENDS_1:"dau_wfriends_1",DAU_WFRIENDS_2:"dau_wfriends_2",DAU_WFRIENDS_3:"dau_wfriends_3",DAU_WFRIENDS_4:"dau_wfriends_4",DAU_WFRIENDS_5:"dau_wfriends_5",RETENTION_0:"retention_0",RETENTION_1:"retention_1",RETENTION_2:"retention_2",RETENTION_3:"retention_3",RETENTION_7:"retention_7",RETENTION_14:"retention_14",RETENTION_30:"retention_30",PRODUCT_BOUGHT:"product_bought",PRODUCT_BOUGHT_LANGUAGE:"product_bought_language",PURCHASE_VALIDATE_SUCCESS:"purchase_validate_success",PURCHASE_VALIDATE_FAILURE:"purchase_validate_failure",MOVES_SHOW:"moves_show",MOVES_BOUGHT:"moves_bought",MOVES_USED_FORCE:"moves_used_force",UNDO_USED:"undo",UNDO_USED_FORCE:"undo_force",BOMB_MOVES_BOUGHT:"bomb_moves_bought",LIVES_BOUGHT:"lives_bought",SHARE:"share",SHARE_ITEM:"share_item",BOOSTERS_BOUGHT:"boosters_bought",BOOSTERS_BOUGHT_ITEM:"boosters_bought_item",BOOSTERS_EXECUTE:"boosters_execute",STAR_CHEST_OPEN:"star_chest_open",STAR_CHEST_OPEN_ITEM:"star_chest_open_item",DAILY_BONUS:"daily_bonus",
DAILY_BONUS_DOUBLE:"daily_bonus_double",GUN_FORCE:"gun_force",DAILY_TASKS_FORCE:"daily_tasks_force",FREE_HINT_FORCE:"free_hint_force",FREE_PAINT_FORCE:"free_paint_force",HEROES_AVAILABLE_FORCE:"heroes_available_force",LANTERN_FORCE:"lantern_force",FIRST_BOOSTERS_BEFORE:"first_boosters_before",SECOND_BOOSTERS_BEFORE:"second_boosters_before",THIRD_BOOSTERS_BEFORE:"third_boosters_before",FREE_WILDCARD_FORCE:"free_wildcard_force",FREE_UNDO_FORCE:"free_undo_force",FREE_ADD_MOVES_FORCE:"free_add_moves_force",MOVES_FOR_BUY_SUCCESS:"moves_for_buy_success",MOVES_FOR_BUY_SHOW:"moves_for_buy_show",MOVES_FOR_VIDEO_SUCCESS:"moves_for_video_success",MOVES_FOR_VIDEO_SHOW:"moves_for_video_show",LIVES_FOR_VIDEO_SUCCESS:"lives_for_video_success",LIVES_FOR_VIDEO_SHOW:"lives_for_video_show",COINS_FOR_VIDEO_SUCCESS:"coins_for_video_success",COINS_FOR_VIDEO_SHOW:"coins_for_video_show",HINT_FOR_INVITE_SUCCESS:"hint_for_invite_success",HINT_FOR_INVITE_SHOW:"hint_for_invite_show",
SIGN_IN_REWARD:"sign_in_reward",HELP_BY_FIVE_ATTEMPTS:"help_by_five_attemts",HELP_BY_ATTEMPTS_DAU:"help_by_attemts_dau",HELP_BY_ATTEMPTS_ONE_AND_MORE:"help_by_attemts_1_and_more",HELP_BY_ATTEMPTS_THREE_AND_MORE:"help_by_attemts_3_and_more",HELP_BY_ATTEMPTS_FIVE_AND_MORE:"help_by_attemts_5_and_more",FREE_MOVES:"free_moves",FREE_BOMB_MOVES:"free_bomb_moves",RATE_WINDOW:"rate_window",RATE_SEND:"rate_send",RATE_1:"rate_1",RATE_2:"rate_2",RATE_3:"rate_3",RATE_4:"rate_4",RATE_5:"rate_5",TUTORIAL_STEP_1:"tutorial_step_1",TUTORIAL_STEP_2:"tutorial_step_2",TUTORIAL_STEP_3:"tutorial_step_3",TUTORIAL_COMPLETED:"fb_mobile_tutorial_completion",LEVEL_PASS_EVENT:"level_passed",LEVEL_START:"level_start",LEVEL_FINISH:"level_finish",LEVEL_GIVEUP:"level_giveup",ACHIEVED_LEVEL:"fb_mobile_level_achieved",LEVEL_PASSED_TIME:"level_passed_time",LEVEL_STARS:"level_stars",LEVEL_LEFT_MOVES:"level_left_moves",LEVEL_UP:"level_up",LEVEL_FPS:"level_fps",PLAY_TIMES:"play_times",MESSAGE_SENT_FRIEND:"message_friend",
MESSAGE_SENT_INVITE:"message_invite",MESSAGE_SENT_PREFIX:"message_sent_",MESSAGE_CANCEL_PREFIX:"message_cancel_",MESSAGE_ERROR:"message_error",FAKEFB_BY_TIMEOUT:"fakefb_by_timeout",FAKEFB_BY_SCRIPT_ERROR:"fakefb_by_script_error",FACEBOOK_INITED:"facebook_inited",PAYER_PROMO_FOUND:"payer_promo_found",PAYER_PROMO_SHOW:"payer_promo_show",PAYER_PROMO_BUY:"payer_promo_buy",PAYER_PROMO_DONE:"payer_promo_done",BOUNTY_OPENED:"bounty_opened",PACKWINDOW_OPENED:"packwindow_opened",PACK_STARTED:"pack_started",PACK_BOUGHT:"pack_bought",PACK_BOUGHT_WITH_PAYMENT:"pack_bought_with_payment",FREE_HINT_SHOWED:"free_hint_showed",TOURNAMENT_LEVEL_PLACE:"tournament_level_place",VIRAL_SENT_NONE:"viral_sent0",VIRAL_SENT_3:"viral_sent3",VIRAL_SENT_REST:"viral_sent_rest",FPS_AUTO:"fps_auto",FPS_LOW:"fps_low",FPS_HIGH:"fps_high",REWARDED_AVAILABLE:"rewarded_available",REWARDED_WATCHED:"rewarded_watched",MAKE_CHOICE:"make_choice",REDO_CHOICE:"redo_choice",BUY_CHOICE:"buy_choice",REWARDED_CHOICE:"rewarded_choice",
REWARDED_SHARE:"rewarded_share_1",REWARDED_HINT:"rewarded_hint_1",REWARDED_ADD_MOVES:"rewarded_add_moves_1",REWARDED_ADD_LIVES:"rewarded_add_lives_1",REWARDED_ADD_COINS:"rewarded_add_coins_1",REWARDED_TOOLBAR:"rewarded_toolbar_1",REWARDED_DAILY_BONUS:"rewarded_dailybonus_1",REWARDED_TOOLBAR_WINDOW_SHOW:"rewarded_toolbar_window_show",REWARDED_TOOLBAR_WINDOW_CLOSE:"rewarded_toolbar_window_close",REWARD_BUY:"reward_buy",LEADERS_WINDOW_OPEN:"leaders_window_open",NEW_LEAGUE:"new_league",PERIODIC_BONUS_FORCE:"periodic_bonus_force",BONUS_ROUND_FORCE:"bonus_round_force",GIVEUP_ATTENTION:"giveup_attention",GIVEUP_MISSION:"giveup_mission",GIVEUP_CHANGE:"giveup_change",GIVEUP_ATTENTION_NEARLY:"giveup_attention1",GIVEUP_CHANGE_NEARLY:"giveup_change1",SESSION_DAILY_TASK_AVAILABLE:"session_daily_task_available",SESSION_DAILY_TASK_FINISH:"session_daily_task_finish",SESSION_DAILY_TASK_REWARD:"session_daily_task_reward",SESSION_DAILY_TASK_OPEN_WINDOW:"session_daily_task_open_window",
DAILY_TASK_CREATE:"daily_task_create",DAILY_TASK_REWARD:"daily_task_rewarded",DAILY_TASKS_OPEN_WINDOW:"daily_tasks_open_window",DAILY_TASKS_START:"daily_tasks_start",SPEND_COINS:"spend_coins",FBLOGINORINVITE_LOGIN:"extra_login",FBLOGINORINVITE_INVITE:"extra_invite",HIGHSCORE_INVITE:"extra_highscore_invite",BOOSTER_CELL_ADDED:"booster_cell_added",BOOSTER_CELL_COLLECTED:"booster_cell_collected",BOOSTER_CELL_RECEIVED:"booster_cell_recevied",BUY_MOVES:"buy_moves_",MISSION_FINISH:"mission_finish",COMBO_PRIZE:"combo_3",COOKIEJAR_REWARD:"cookiejar_reward",GUN_SHOT_FORCE:"gunshotforce",GUN_SHOT:"gunshot",FAIL_BUNDLE:"fail_bundle_",PIGGY_BANK:"piggy_bank",PIGGY_BANK_LEVEL:"piggy_bank_level_",ACTIVE_TIME:"active_time",CHRISTMAS_FORCE:"christmas_force",CRYPTEX_REWARD:"cryptex_reward",CRYPTEX_FAIL:"cryptex_fail",WIN_KNOCKOUT:"win_knockout",LOSE_KNOCKOUT:"lose_knockout",SUBSCRIPTION_WINDOW_OPEN:"subscription_window_open",SUBSCRIPTION_REWARD:"subscription_reward",
SUBSCRIPTION_BOUGHT:"subscription_bought",SUBSCRIPTION_CANCELLED:"subscription_cancelled",DAILY_CUP_REWARD:"daily_cup_reward",DAILY_CUP_DAU:"daily_cup_dau",DAILY_CUP_PLAYERS:"daily_cup_players",INSTANT_SHORTCUT_SHOW:"instant_shortcut_show",INSTANT_SHORTCUT:"instant_shortcut",INSTANT_BOT_SHOW:"instant_bot_show",INSTANT_BOT:"instant_bot",INSTANT_UPDATE:"instant_update",MISSION_DAU:"mission_dau",MISSION_START_DAU:"mission_start_dau",FAVORITE_REGULAR:"favorite_regular",FAVORITE_PRODUCT_BOUGHT:"favorite_sale_product_bought",LANTERN_COMBO_NO_PLACE:"lantern_combo_no_place",LANTERN_MULTICOLOR_NO_PLACE:"lantern_multicolor_no_place",BOOSTER_COMBO_NO_PLACE:"booster_combo_no_place",BOOSTER_MULTICOLOR_NO_PLACE:"booster_multicolor_no_place",BATTLE_PASS_FINISH_TASK:"battle_pass_finish_task",BATTLE_PASS_RECEIVED:"battle_pass_received",BATTLE_PASS_RECEIVED_PREMIUM:"battle_pass_received_premium",BATTLE_PASS_BOUGHT:"battle_pass_bought",RACE_FREE_REWARD:"race_free_reward",RACE_BUY_PREM:"race_buy_prem",
RACE_FINISH_PLACE:"race_finish_place",RACE_LEVELS_PASSED:"race_levels_passed",RACE_LEVELS_PASSED_PREM:"race_levels_passed_prem",METHA_ITEM:"metha_item",METHA_LEVEL:"metha_level",MINIGAME_FINISH:"minigame_finish",MINIGAME_REWARD:"minigame_reward",LOCALSTORAGE_CLEARED:"localstorage_cleared",LOCALSTORAGE_ERROR_SET_ITEM:"localstorage_error_set_item",RAFFLE_RESULT_UPDATE:"raffle_result_update",PAYMENT_OPEN:"payment_open",PAYMENT_CANCEL:"payment_cancel",PAYMENT_FAILURE:"payment_failure",PAYMENT_NOT_INITIALIZED:"payment_not_initialized",PAYMENT_NOT_REFRESHED:"payment_not_refreshed",PAYMENT_SUCCESS:"payment_success",TREASURE_SEARCH_START:"treasure_search_start",TREASURE_SEARCH_FINISH:"treasure_search_finish",SIMPLE_METHA_BACKGROUND:"simple_metha_background",CARD_SKIN_CHANGED:"card_skin_changed",CARD_SKIN_BOUGHT_USING_COINS:"card_skin_bought_using_coins",LOGIN:"login",SIGN_UP:"sign_up",TUTORIAL_COMPLETE:"tutorial_complete",TUTORIAL_BEGIN:"tutorial_begin",SEARCH:"search",
PRESENT_OFFER:"present_offer",JOIN_GROUP:"join_group",SELECT_CONTENT:"select_content",UNLOCK_ACHIEVEMENT:"unlock_achievement",POST_SCORE:"post_score"};"undefined"!=typeof module&&(module.exports=cleverapps_events),cleverapps.setupResolution=function(){var l;cc.view.enableRetina(!0),cc.view.adjustViewPort(!0);var e=cleverapps.setupDesignResolution=function(e){var S=cc.view.getFrameSize();if(e=e||{},cc.sys.isMobile||"undefined"==typeof window||(S={width:window.innerWidth,height:window.innerHeight},l=window.innerHeight),!(S.width<cleverapps.SETUP_RESOLUTION_MIN_FRAME_SIZE||S.height<cleverapps.SETUP_RESOLUTION_MIN_FRAME_SIZE))if(cleverapps.initedVertical)cleverapps.rotatePhoneInfo(S.width<S.height);else{void 0!==cleverapps&&cleverapps.decCanvasHeight&&S.height>cleverapps.decCanvasHeight&&(S.height-=cleverapps.decCanvasHeight),e.width&&(S.width=e.width),e.height&&(S.height=e.height);var t=S.width/S.height;if(S.width&&S.height){var i={width:S.width,height:S.height}
;cleverapps.info.setKeyValue("resolution",i)}var s=cleverapps.styles.SCENE_HEIGHT,n=s*t;if(n<cleverapps.styles.SCENE_MIN_WIDTH&&(s=(n=cleverapps.styles.SCENE_MIN_WIDTH)/t),cleverapps.styles.WINDOW_MIN_WIDTH&&n<cleverapps.styles.WINDOW_MIN_WIDTH&&(cleverapps.styles.WINDOW_SCALE=n/cleverapps.styles.WINDOW_MIN_WIDTH*.98),cc.sys.isNative)cc.view.setDesignResolutionSize(n,s,cc.ResolutionPolicy.SHOW_ALL);else{var o=cc.ContainerStrategy.extend({apply:function(e,t){var i,s,n=S.width,o=S.height,a=cc.container.style,r=t.width,l=t.height,c=n/r,p=o/l;c<p?(i=n,s=l*c):(i=r*p,s=o);var d=Math.round((n-i)/2);i=Math.round(i),s=Math.round(s),this._setupContainer(e,i,s),e._isRotated?a.marginLeft=o+"px":a.margin="0",a.paddingLeft="0",a.paddingRight="0",a.paddingTop="0",a.paddingBottom="0",a.padding="0",a.margin="0 "+d+"px";var h=document.getElementById("bg");h&&(h.style.position="absolute",h.style.left="0px",h.style.top="0px");var u=document.getElementById("LeftBg");if(u)if(0<d){u.style.width=d+1+"px"
;var v=bundles.browser_resources.urls.left_bg||bundles.browser_resources.urls.pattern_bg_png;v&&(u.style.backgroundImage="url('"+v+"')")}else u.style.width="0";var g=document.getElementById("RightBg");if(g)if(0<d){g.style.left=d+i-1+"px",g.style.width=n-d-i+2+"px";var m=bundles.browser_resources.urls.right_bg||bundles.browser_resources.urls.pattern_bg_png;m&&(g.style.backgroundImage="url('"+m+"')")}else g.style.width="0";var f=document.getElementById("LeftSideBar"),_=document.getElementById("RightSideBar");if(f&&bundles.browser_resources.urls.sidebar){var y=cleverapps.styles.SIDEBAR_WIDTH,w=Math.ceil(y*s/1334),b=Math.ceil(5*s/1334);b<cleverapps.styles.MIN_SIDEBAR_X&&(b=cleverapps.styles.MIN_SIDEBAR_X),0<d?(f.style.left=d-w+b+"px",f.style.width=w+"px",f.style.backgroundImage="url('"+bundles.browser_resources.urls.sidebar+"')",_.style.left=d+i-b+"px",_.style.width=w+"px",_.style.backgroundImage="url('"+bundles.browser_resources.urls.sidebar+"')"):(f.style.width="0",_.style.width="0")}}})
;if(n>cleverapps.styles.SCENE_MAX_WIDTH){var a=resolutions[cleverapps.settings.calcResolution()].horizontal;n=void 0!==cleverapps.styles.SCENE_HORIZONTAL_WIDTH&&n>=cleverapps.styles.SCENE_HORIZONTAL_WIDTH&&(S.height<cleverapps.styles.SCENE_HORIZONTAL_MAX_HEIGHT||a||cleverapps.wideMode&&cleverapps.wideMode.mode===cleverapps.WideMode.HORIZONTAL)?cleverapps.styles.SCENE_HORIZONTAL_WIDTH:cleverapps.styles.SCENE_MAX_WIDTH}var r=new cc.ResolutionPolicy(new o,cc.ContentStrategy.SHOW_ALL);cc.view.setDesignResolutionSize(n,s,r),void 0!==cleverapps&&cleverapps.canvasTop&&(document.getElementById("Cocos2dGameContainer").style["margin-top"]=cleverapps.canvasTop)}cc.director.getRunningScene()&&cc.director.getRunningScene().onChangeSize&&cc.director.getRunningScene().onChangeSize(),cleverapps.onResolutionChanged(),(cleverapps.MobileOK.isAppropriate()||cleverapps.MobileMyMailRu.isAppropriate()||cleverapps.SPMobage.isAppropriate())&&!cleverapps.initedVertical&&n<s&&(cleverapps.initedVertical=!0)}}
;cc.view._orientationChanging=!1,cc.view.resizeWithBrowserSize(!0),cc.view.setResizeCallback(e),resolutionScale=resolutions[cleverapps.settings.calcResolution()].scale,cleverapps.UI.updateSizes(resolutionScale),cleverapps.UI.selectSkinResources(cleverapps.settings.calcResolution()),cleverapps.home&&cleverapps.home.setupResolution(),cleverapps.farm&&cleverapps.farm.setupResolution(),e(),cc.sys.isMobile||"undefined"==typeof window||setTimeout(function(){l!==window.innerHeight&&e(),setTimeout(function(){l!==window.innerHeight&&e()},3e3)},1e3)},cleverapps.rotatePhoneInfo=function(e){document.getElementById("RotatePhoneText").innerText=Messages.get("Rotate.device"),document.getElementById("RotatePhoneIcon").src=bundles.rotate_phone.urls.rotate_png,document.getElementById("RotatePhone").style.display=e?"none":"block"},cleverapps.afterResolutionChanged=function(e){cleverapps._afterResolutionChangedCallbacks||(cleverapps._afterResolutionChangedCallbacks=[]),
cleverapps._afterResolutionChangedCallbacks.push(e)},cleverapps.onResolutionChanged=function(){cleverapps._resolutionChangeTimeout&&clearInterval(cleverapps._resolutionChangeTimeout),cleverapps._whenResolutionStableTimeouts&&(cleverapps._whenResolutionStableTimeouts.forEach(function(e){clearInterval(e)}),delete cleverapps._whenResolutionStableTimeouts),cleverapps._afterResolutionChangedCallbacks&&cleverapps._afterResolutionChangedCallbacks.forEach(function(e){e()}),cleverapps._resolutionChangeTimeout=setTimeout(cleverapps.onResolutionStable,500)},cleverapps.onResolutionStable=function(){cleverapps._whenResolutionStableCallbacks&&(cleverapps._whenResolutionStableCallbacks.forEach(function(e){e()}),delete cleverapps._whenResolutionStableCallbacks)},cleverapps.whenResolutionStable=function(e){cleverapps._whenResolutionStableCallbacks||(cleverapps._whenResolutionStableCallbacks=[]),e=cleverapps.once(e),cleverapps._whenResolutionStableCallbacks.push(e),
cleverapps._whenResolutionStableTimeouts||(cleverapps._whenResolutionStableTimeouts=[]),cleverapps._whenResolutionStableTimeouts.push(setTimeout(e,500))},window.ENABLE_IMAEG_POOL=!1,cleverapps.EVENTS=cleverapps_events,cleverapps.whenAllInitialized=function(e){cleverapps.allInitialized&&e(),cleverapps.__whenAllInitializedCallbacks||(cleverapps.__whenAllInitializedCallbacks=[]),cleverapps.__whenAllInitializedCallbacks.push(e)},cleverapps.afterAllLoadingFinish=function(){cleverapps.allInitialized=!0,cleverapps.__whenAllInitializedCallbacks&&cleverapps.__whenAllInitializedCallbacks.forEach(function(e){e()})},cleverapps.customBoardGameInitialization=function(e){levels.gameHints=new levels.GameHints,levels.cookieJar=new cleverapps.CookieJar,levels.tutorial=new cleverapps.Tutorial},cleverapps.customMatch3Initialization=function(e){levels.levelAttempts=new levels.LevelAttempts},cleverapps.afterResourceLoaded=function(e){"undefined"!=typeof document&&(document.title=Messages.get(
cleverapps.config.title)),levels.initialize(),"board"===cleverapps.config.type?cleverapps.customBoardGameInitialization(e):"match3"===cleverapps.config.type&&cleverapps.customMatch3Initialization(e),cleverapps.metha.distract({focus:"afterAllLoadingFinish",action:function(e){if(cleverapps.afterAllLoadingFinish(),cleverapps.dailyLevel.isStartFromPortlet())return cleverapps.eventLogger.logEvent("daily_level_channel_"+cleverapps.dailyLevel.getCurrentEvent()),void cleverapps.dailyLevel.start(e);cleverapps.Plot.onStartup(e)}})},cleverapps.createGlobalObjects=function(){cleverapps.bundleLoader=new BundleLoader,cleverapps.flags=new cleverapps.Flags,cleverapps.social=cleverapps.SocialManager.create(),cleverapps.DataLoader.init(),cleverapps.synchronizer=new cleverapps.Synchronizer,cleverapps.eventLogger=new cleverapps.EventsLogger,cleverapps.metha=new Metha,cleverapps.playSession=new PlaySession,cleverapps.info=new cleverapps.Information;var e=levels.initUser()
;return cleverapps.abTest=new cleverapps.ABTest,cleverapps.history=new History,cleverapps.scenes=new cleverapps.Scenes,cleverapps.environment=new cleverapps.Environment,cleverapps.communityManager=new CommunityManager,cleverapps.skins=new cleverapps.SkinManager,cleverapps.windows=new Windows,cleverapps.settings=new cleverapps.Settings(e),cleverapps.audio=new cleverapps.Audio,cleverapps.versionChecker=new VersionChecker,cleverapps.userresult=new UserResult,cleverapps.info.reportPhone(),cleverapps.info.reportUserAgent(),cleverapps.info.reportAppVersion(),cleverapps.info.reportMaxTextureSize(),cleverapps.info.reportSysLanguage(),cleverapps.firebase=cleverapps.FirebaseManager.run(),cleverapps.firebase.init(),cleverapps.metha.getType()===Metha.FARM?(cleverapps.farm=new Farm,MethaHelper.prepare()):cleverapps.metha.getType()===Metha.HOMEFIX?(cleverapps.home=new Home,MethaHelper.prepare()):cleverapps.metha.getType()===Metha.KNOCKOUT&&(cleverapps.knockout=new Knockout),cleverapps.metha.getType(
)===Metha.SIMPLE&&(cleverapps.simple=new Simple),cleverapps.promotion=new cleverapps.Promotion,cleverapps.adjust=new cleverapps.Adjust,cleverapps.friends=new FriendsCache,cleverapps.invitalbleFriends=new FriendsCache(!0),cleverapps.payments=cleverapps.PaymentsManager.init(),cleverapps.paymentsHistory=new cleverapps.PaymentsHistory,cleverapps.localPushes=new cleverapps.LocalPushes,levels.progress=new Progress,levels.episodes=EpisodesManager.create(),cleverapps.serverFlags=new cleverapps.ServerFlags,cleverapps.periodicBonus=new cleverapps.MiniGame(e),cleverapps.boostersCounter=new cleverapps.BoostersCounter(e),cleverapps.gun=new Gun,cleverapps.isKnockoutGame()&&(cleverapps.knockoutTutorial=new KnockoutTutorial),cleverapps.tempGoods=new cleverapps.TempGoods,cleverapps.config.lives&&("tripeaks"===cleverapps.config.name&&cleverapps.abTest.isRunning("betorlives")&&"bet"===cleverapps.abTest.group?cleverapps.bet=new cleverapps.Bet:cleverapps.lives=new cleverapps.Lives(e)),
cleverapps.dailyTasks=new cleverapps.DailyTasks(e),cleverapps.forces=new Forces,cleverapps.packManager=new PackManager,cleverapps.piggyBank=new PiggyBank,Subscription.IsModelAvailable()&&(cleverapps.subscription=new Subscription),void 0!==Heroes&&(match3.heroes=new Heroes),"match3"===cleverapps.config.type&&(cleverapps.starChest=new cleverapps.StarChest),levels.friendSorter=new FriendSorter,levels.friendRequests=new levels.FriendRequests,cleverapps.eventManager=new EventManager,cleverapps.competitionPlayers=new CompetitionPlayers,cleverapps.competitionStatistics=new CompetitionStatistics,cleverapps.bountyManager=new BountyManager,cleverapps.leadersWindowTable=new cleverapps.Table,cleverapps.dailyCupLeadersWindowTable=new cleverapps.Table,cleverapps.dailyCup=new DailyCup(DailyCup.TYPE_DAILY),-1!==["olympics","differences"].indexOf(cleverapps.config.name)&&(cleverapps.weeklyCup=new DailyCup(DailyCup.TYPE_WEEKLY),cleverapps.weeklyCupTop=new WeeklyCupTop),-1!==["tripeaks","spades"
].indexOf(cleverapps.config.name)&&(cleverapps.cardSkins=new CardSkins),cleverapps.dailyLevel=new DailyLevel,cleverapps.user.calcIdfa(),cleverapps.rewardedAdsManager=new RewardedAdsManager,cleverapps.toolbar=new Toolbar,cleverapps.sideBar=new SideBar,cleverapps.menuBar=new MenuBar,cleverapps.missionManager=new MissionManager,void 0!==cleverapps.BonusRoundChest&&(cleverapps.bonusRoundChest=new cleverapps.BonusRoundChest(e),cleverapps.toolbar.addItem(new BonusRoundToolbarItem)),cleverapps.exclamation=new Exclamation,cleverapps.tooltipManager=new TooltipManager,cleverapps.metha.getType()!==Metha.NONE&&(cleverapps.playButton=new PlayButton),cleverapps.chat=new Chat,cleverapps.keyboardController=new KeyboardController,e},cleverapps.onStart=function(){"undefined"!=typeof document&&(document.title=cleverapps.config.title);var t,e=cleverapps.createGlobalObjects(),i=2;cleverapps.flags.norest||(i++,cleverapps.synchronizer._onceFirstSyncCompletedListener=cleverapps.waitNoMore(3e3,function(){
console.log("first sync"),n()})),cc.sys.os===cc.sys.OS_IOS&&cc.sys.isNative&&cc.sys.isWebView&&cleverapps.LocalPushes.IosWebViewSender.askPermission();var s=function(){cleverapps.afterResourceLoaded(e)},n=cleverapps.wait(i,function(){cc.loaderScene.beforeTransitionAnimations?cc.loaderScene.beforeTransitionAnimations(s):s()});cleverapps.social.initialize(function(){cleverapps.versionChecker.check(),0===levels.user.getProgress()&&(cc.sys.isNative||-1===["sp_mbga"].indexOf(cleverapps.User.calcSource())||"solitaire"!==cleverapps.config.name||cleverapps.social.checkConnection()),cleverapps.social.isLoggedIn()?cleverapps.SocialManager.onLogin():cleverapps.synchronizer.syncWhenReady(),cleverapps.FBLike.createLikeButtons(),cleverapps.NativeLinks.createLinks(),n()}),function(){cleverapps.setupResolution(),cleverapps.Spine.prepare(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,cleverapps.Parallax.refresh),
cleverapps.social instanceof cleverapps.Instant?cc.loaderScene=t=InstantLoaderScene:(t=cc.LoaderScene,cc.loaderScene=new LoaderScene,t.beforeTransitionAnimations=LoaderScene.beforeTransitionAnimations,cc.loaderScene.init(),cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){cc.loaderScene._updateTransform()})),cc.loaderScene.sceneBundles=ResourceProcessor.calcProbablyNeed();var e=[].concat.apply([],cc.loaderScene.sceneBundles.map(function(e){return new Bundle(e).listUrls()}));t.preload(e,function(){cleverapps.bundleLoader.loadBundles(cc.loaderScene.sceneBundles,{onSuccess:function(){cc.sys.isNative||"undefined"==typeof logTimeStart||(logTimeStartTimeout&&clearTimeout(logTimeStartTimeout),logTimeStart.save()),Messages.preload(cleverapps.settings.language,n)}})})}()},cleverapps.styles={},cleverapps.styles.ALIGN_BOTTOM="b",cleverapps.styles.GetRealCoord=function(e,t){return"number"==typeof e?e:e===cleverapps.styles.ALIGN_BOTTOM?t.height/2:void 0},
cleverapps.styles.SCENE_HEIGHT=1334,cleverapps.styles.SCENE_MAX_WIDTH=1500,cleverapps.styles.WINDOW_MIN_WIDTH=750,cleverapps.styles.SCENE_MIN_WIDTH=660,cleverapps.SETUP_RESOLUTION_MIN_FRAME_SIZE=150,cleverapps.styles.SQUARE_MODE_WIDTH=1300,cleverapps.styles.SIDEBAR_WIDTH=35,cleverapps.styles.MIN_SIDEBAR_X=2,cleverapps.styles.COLORS={BLACK:new cc.Color(0,0,0,255),COLOR_GRAY:new cc.Color(200,200,200,255),COLOR_DARK_GRAY:new cc.Color(150,150,150,255),COLOR_VERY_DARK_GRAY:new cc.Color(100,100,100,255),WHITE:new cc.Color(255,255,255,255),GREEN:new cc.Color(13,119,0,255),YELLOW:new cc.Color(255,255,0,255),HOVER:new cc.Color(230,230,230,255),COLOR_BROWN:new cc.Color(60,45,25,255),COLOR_RED:new cc.Color(255,0,0,255),MESSAGE_GREEN:new cc.Color(4,160,41,255),LIFE_GREEN:new cc.Color(24,200,61,255),PINK:new cc.Color(255,102,102,255),COLOR_DARK_BROWN:new cc.Color(120,85,85,255),HERO_STATS:new cc.Color(154,81,7,255),HERO_UPGRADE:new cc.Color(0,81,19,255),HERO_STATS_UPGRADE:new cc.Color(0,255,0,255),
GUN_PRICE_FONT_COLOR:new cc.Color(176,125,82,255),REWARDS_TEXT_STROKE_COLOR:new cc.Color(76,98,109,255),GRAY_SCALE_COLOR:new cc.Color(135,135,135,255),GRAY_SCALE_RESTORE_COLOR:new cc.Color(255,255,255,255),DAILY_TOURNAMENT_TIMER:new cc.Color(130,70,40,255),BOOSTERS_SALE_TEXT_COLOR:new cc.Color(191,164,119,255),DARK_RED:new cc.Color(200,0,0,255),COLOR_DARK_YELLOW:new cc.Color(255,194,9,255),COLOR_BROWN_2:new cc.Color(173,61,0,255),COLOR_WINDOW_TEXT:new cc.Color(130,70,40,255),COLOR_VERYLIGHTBROWN:new cc.Color(220,191,144,255),TOOLTIP_COLOR:new cc.Color(148,49,19,255),COINS_REWARD_YELLOW:new cc.Color(255,244,55,255),COINS_REWARD_STROKE_COLOR:new cc.Color(149,67,23,255),MINIGAME_REWARD_TEXT:new cc.Color(66,68,80)},cleverapps.styles.DECORATORS={DARK_OLIVE_GREEN_STROKE:{color:new cc.Color(121,94,46,255),size:4},WHITE_TEXT_SHADOW:{color:cleverapps.styles.COLORS.BLACK,direction:cc.size(0,-4),blur:5},BROWN_STROKE:{color:cleverapps.styles.COLORS.COLOR_BROWN_2,size:3},BUTTON_TEXT_SHADOW:{
color:cleverapps.styles.COLORS.BLACK,direction:cc.size(0,0),blur:5},BUTTON_TEXT_STROKE:{color:cleverapps.styles.COLORS.BLACK,size:2},WINDOW_WHITE_TEXT_STROKE:{color:cleverapps.styles.COLORS.BLACK,size:1},HERO_STATS_VALUE:{color:cleverapps.styles.COLORS.HERO_STATS,size:2},HERO_UPGRADE:{color:cleverapps.styles.COLORS.HERO_UPGRADE,size:2},REWARDS_TEXT_STROKE:{color:cleverapps.styles.COLORS.REWARDS_TEXT_STROKE_COLOR,size:3},DAILY_TOURNAMENT_TITLE_STROKE:{color:new cc.Color(116,17,168,255),size:4},TILE_SHOP_WINDOW_STROKE:{color:new cc.Color(150,111,72,255),size:2},TILE_SHOP_WINDOW_TITLE_SHADOW:{color:new cc.Color(112,109,109,255),direction:cc.size(0,-4),blur:0}},cleverapps.styles.FONTS=cleverapps.overrideFonts({},{VICTORY_TEXT:{size:56,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.WHITE_TEXT_SHADOW},GUN_PRICE_TEXT:{size:40,color:cleverapps.styles.COLORS.GUN_PRICE_FONT_COLOR},MISSION_RULES_BUTTON_TEXT:{size:64,color:cleverapps.styles.COLORS.WHITE},
FBLOGINORINVITE_TEXT:{size:28,color:cleverapps.styles.COLORS.WHITE},BUTTON_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},SUBSCRIPTION_BUTTON_SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE},SUBSCRIPTION_BUTTON_TEXT:{size:60,color:cleverapps.styles.COLORS.WHITE},SUBSCRIPTION_OFFERS_MAIN_TEXT:{size:44,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},SUBSCRIPTION_OFFERS_TEXT:{size:16,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},TOURNAMENTSTORY_OFFERS_MAIN_TEXT:{size:38,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},TOURNAMENTSTORY_OFFERS_TEXT:{size:16,
color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},TOURNAMENTSTORY_ARROW_TEXT:{size:32,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},TOURNAMENTSTORY_BUTTON_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE},BUTTON_SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},GAME_REWARD_BUTTON_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE},MENUBAR_TEXT:{size:40,color:cleverapps.styles.COLORS.COLOR_BROWN},VICTORY_CHEST_TEXT:{prefix:"digits#timer_digit_",scale:.85,size:50,color:cleverapps.styles.COLORS.WHITE},SMALL_TEXT:{
size:30,color:cleverapps.styles.COLORS.WHITE},EXTRA_WORD:{size:50,color:cleverapps.styles.COLORS.WHITE},SMALL_TEXT_BROWN:{size:30,color:cleverapps.styles.COLORS.COLOR_BROWN},WINDOW_TEXT:{size:40,color:cleverapps.styles.COLORS.COLOR_BROWN},MISSIONS_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE},DAILY_TASK_BOOSTER_AMOUNT_TEXT:{size:60,color:cleverapps.styles.COLORS.COLOR_BROWN},WINDOW_SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.COLOR_BROWN},SUBSCRIBE_TERMS_TEXT:{size:22,color:cleverapps.styles.COLORS.COLOR_GRAY},SUBSCRIBE_CTA_TITLE:{size:36,color:cleverapps.styles.COLORS.COLOR_BROWN},SUBSCRIBE_FEATURE_TEXT:{size:36,color:cleverapps.styles.COLORS.COLOR_VERY_DARK_GRAY},SUBSCRIBE_BUTTON_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE},SUBSCRIBE_CTA_TEXT:{size:36,color:cleverapps.styles.COLORS.COLOR_BROWN},SUBSCRIBE_TITLE_TEXT:{size:70,color:cleverapps.styles.COLORS.COLOR_BROWN},SUBSCRIBE_TERMS_BUTTIONS_TEXT:{size:24,color:cleverapps.styles.COLORS.COLOR_BROWN},
SUBSCRIPTION_MAIN_TEXT:{size:25,color:cleverapps.styles.COLORS.COLOR_BROWN},SUBSCRIPTION_REWARD_READY_TEXT:{size:34,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},SUBSCRIPTION_BUTTON_ADDITIONAL_TEXT:{size:18,color:cleverapps.styles.COLORS.GUN_PRICE_FONT_COLOR},REWARDS_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.REWARDS_TEXT_STROKE},HERO_STATS_VALUE:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.HERO_STATS_VALUE},HERO_UPGRADE:{size:34,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.HERO_UPGRADE},HERO_STATS_UPGRADE_VALUE:{size:30,color:cleverapps.styles.COLORS.HERO_STATS_UPGRADE,stroke:cleverapps.styles.DECORATORS.HERO_STATS_VALUE},INFO_EXP_TEXT:{size:26,color:cleverapps.styles.COLORS.WHITE},WINDOW_HERO_UPGRADE_LEVEL_TEXT:{size:40,color:cleverapps.styles.COLORS.HERO_STATS_UPGRADE},SMALL_TEXT_ERROR:{size:30,color:cleverapps.styles.COLORS.COLOR_RED},EPISODE_TITLE_TEXT:{size:40,
color:cleverapps.styles.COLORS.COLOR_BROWN},SHARE_BUTTON_REWARD_TEXT:{},WHITE_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE},WAIT_WINDOW_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.WINDOW_WHITE_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.WHITE_TEXT_SHADOW},GREEN_TEXT:{size:40,color:cleverapps.styles.COLORS.LIFE_GREEN},TIMER_WHITE_TEXT:{size:36,color:cleverapps.styles.COLORS.WHITE},MEDIUM_WHITE_TEXT:{size:35,color:cleverapps.styles.COLORS.WHITE},SMALL_WHITE_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE},LIVES_AMOUNT_TEXT:{prefix:"digits#timer_digit_",scale:.8,size:40,color:cleverapps.styles.COLORS.WHITE},SHOP_TAB_BUTTON_TEXT:{size:35,color:cleverapps.styles.COLORS.WHITE},SUBSCRIPTION_ICON_TEXT:{size:23,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},PACK_ICON_TEXT:{prefix:"digits#timer_digit_",size:40,scale:.55,color:cleverapps.styles.COLORS.WHITE},DAILY_TASKS_LEVEL_TEXT:{size:35,color:cleverapps.styles.COLORS.WHITE},
DAILY_TASK_BUTTON_TEXT:{size:46,color:cleverapps.styles.COLORS.WHITE},PIGGY_BANK_AMOUNT_TEXT:{size:44,color:cleverapps.styles.COLORS.WHITE},PACK_WINDOW_TEXT:{size:35,color:cleverapps.styles.COLORS.BLACK},FORCE_MESSAGE_TEXT:{size:40,color:cleverapps.styles.COLORS.COLOR_BROWN},DAILY_TOURNAMENT_TITLE_TEXT:{size:55,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.DAILY_TOURNAMENT_TITLE_STROKE},DAILY_TOURNAMENT_TEXT:{size:40,color:cleverapps.styles.COLORS.DAILY_TOURNAMENT_TIMER},BIG_BUTTON_TEXT:{size:70,color:cleverapps.styles.COLORS.WHITE},BREAKVIEW_AMOUNT_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE},TILE_SHOP_WINDOW_TEXT:{size:35,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.TILE_SHOP_WINDOW_STROKE},TILE_SHOP_WINDOW_TITLE_TEXT:{size:85,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TILE_SHOP_WINDOW_TITLE_SHADOW},WHITE_TITLE_TEXT:{size:60,color:cleverapps.styles.COLORS.WHITE},LEVEL_TUTORIAL_TEXT:{size:30,
color:cleverapps.styles.COLORS.WHITE},TOOLTIP_TEXT:{size:40,color:cleverapps.styles.COLORS.TOOLTIP_COLOR},TOOLTIP_IMAGE_FONT:{prefix:"digits#timer_digit_",color:cleverapps.styles.COLORS.TOOLTIP_COLOR,scale:.7,size:40},TREASURE_SEARCH_PROGRESS_BAR_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:{size:1,color:cleverapps.styles.COLORS.BLACK}}}),cleverapps.styles.SpineSkins={},cleverapps.Environment=function(){this.episodeNo=levels.user.episode,this.levelNo=levels.user.level,this.scene=void 0,this.onOpenWindowListener=function(e){},this.paused=!1,this.onShowCallbacks=[],this.onShowCounter=0,cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,this.onShow.bind(this)),cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,this.onHide.bind(this)),this.onShowTime=Date.now()},cleverapps.whenShow=function(i){return function(){var e=this,t=arguments;cleverapps.environment.whenShow(function(){i.apply(e,t)})}},cleverapps.Environment.prototype.whenShow=function(e){
this.paused?this.onShowCallbacks.push(e):e()},cleverapps.Environment.prototype.onHide=function(){this.paused=!0,this.onShowTimeout&&(clearTimeout(this.onShowTimeout),delete this.onShowTimeout)},cleverapps.Environment.prototype.onShow=function(){this.onShowTime=Date.now(),this.onShowCounter++,this.onShowTimeout=setTimeout(function(){delete this.onShowTimeout,this.paused=!1;var e=this.onShowCallbacks;this.onShowCallbacks=[],e.forEach(function(e){this.whenShow(e)}.bind(this))}.bind(this),300)},cleverapps.Environment.prototype.setScene=function(e){this.scene=e,cleverapps.firebase&&cleverapps.firebase.setScreenName(this.getScreen(),this.getScene())},cleverapps.Environment.prototype.isDailyCupScene=function(){return this.scene===cleverapps.Environment.SCENE_DAILY_CUP},cleverapps.Environment.prototype.isMainScene=function(){return this.scene===cleverapps.Environment.SCENE_MAIN},cleverapps.Environment.prototype.isMethaScene=function(){
return this.scene===cleverapps.Environment.SCENE_METHA||this.scene===cleverapps.Environment.SCENE_MAIN&&!cleverapps.metha.withSimpleMain()},cleverapps.Environment.prototype.isHeroesScene=function(){return this.scene===cleverapps.Environment.SCENE_HEROES},cleverapps.Environment.prototype.isGameScene=function(){return this.scene===cleverapps.Environment.SCENE_GAME},cleverapps.Environment.prototype.isEditorScene=function(){return this.scene===cleverapps.Environment.SCENE_EDITOR},cleverapps.Environment.prototype.isChatScene=function(){return this.scene===cleverapps.Environment.SCENE_CHAT},cleverapps.Environment.prototype.isAdministratorScene=function(){return this.scene===cleverapps.Environment.SCENE_ADMINISTRATOR},cleverapps.Environment.prototype.isSceneWithPreview=function(){return this.scene===cleverapps.Environment.SCENE_EDITOR||this.scene===cleverapps.Environment.SCENE_ADMINISTRATOR},cleverapps.Environment.prototype.isRaceScene=function(){
return this.scene===cleverapps.Environment.SCENE_RACE},cleverapps.Environment.prototype.onOpenWindow=function(e){this.onOpenWindowListener(e),cleverapps.firebase&&cleverapps.firebase.setScreenName(this.getScreen(),this.getScene())},cleverapps.Environment.prototype.onCloseWindow=function(e){cleverapps.firebase&&cleverapps.firebase.setScreenName(this.getScreen(),this.getScene())},cleverapps.Environment.prototype.getActiveWindow=function(){var e=cleverapps.windows&&cleverapps.windows.currentWindow();if(e&&e.name)return e.name},cleverapps.Environment.prototype.getScreen=function(){return this.getActiveWindow()||this.getScene()},cleverapps.Environment.prototype.getScene=function(){return this.scene},cleverapps.Environment.SCENE_MAIN="main",cleverapps.Environment.SCENE_METHA="metha",cleverapps.Environment.SCENE_GAME="game",cleverapps.Environment.SCENE_EDITOR="editor",cleverapps.Environment.SCENE_ADMINISTRATOR="administrator",cleverapps.Environment.SCENE_COMICS="comics",
cleverapps.Environment.SCENE_HEROES="heroes",cleverapps.Environment.SCENE_CARD_SKINS="cardskins",cleverapps.Environment.SCENE_DAILY_CUP="dailycup",cleverapps.Environment.SCENE_RACE="race",cleverapps.Environment.SCENE_TRIPEAKS="tripeaks",cleverapps.Environment.SCENE_CHAT="chat",resolutionScale=1,cleverapps.UI={updateSizes:function(s){var n=["verticalAlignment","texType","opacity","scale9","parent","scale","minScale","rotation","baseScale","zoomScale","zoom","scaleX","scaleY","anchorX","anchorY","zIndex","zOrder","mobileScaleAdd","coinScale","SIDEBAR_WIDTH","MIN_SIDEBAR_X","duration","delay","idleDelay","visiblePages","type","hideDirection","widthMultiplier","number","mobileScale","innerScale","dialogueStages","baseline","skew","anchor"],o=function(e,t,i){return!(i instanceof cc.Color)&&(("direction"!==t||"object"==typeof i)&&!(0<=n.indexOf(t)))},a={},r=[],l=function(e){if(!e.isUpdated)for(var t in e.isUpdated=!0,r.push(e),e){var i=e[t];if("number"==typeof i){if(Array.isArray(e))continue
;o(0,t,i)&&(a[t]=!0,e[t]*=s,e[t]=Math.round(e[t]))}else"object"==typeof i&&o(0,t,i)&&l(i)}};cleverapps.styles.isUpdated||(l(cleverapps.styles),cleverapps.values(Forces).forEach(function(e){e.style&&l(e.style),e.Finger&&l(e.Finger)}),r.forEach(function(e){delete e.isUpdated}),cleverapps.styles.isUpdated=!0)},selectSkinResources:function(e){var n=function(e,t,i){for(var s in e)"string"==typeof e[s]&&(e[s]=e[s].replace("/%r/","/"+t+"/")),i&&"object"==typeof e[s]&&n(e[s],t,i)};for(var t in n(res,e),bundles){var i=bundles[t];n(i.urls,e),n(i.frames,e),n(i.jsons,e)}for(var s in cleverapps.styles){var o=cleverapps.styles[s];n(o,e,!0)}"object"==typeof HeroesLibrary&&n(HeroesLibrary,e,!0),"undefined"!=typeof CardSkins&&n(CardSkins,e,!0)},HORIZONTAL:0,VERTICAL:1,ALIGN_START:0,ALIGN_CENTER:1,ALIGN_END:2,TOP_TO_BOTTOM:2,SCALE_ANIMATION:2,OPACITY_ANIMATION:3,arrangeWithMargins:function(a,r){var l=r.margin;void 0===l&&(l=0);var c=0;c=r.direction===cleverapps.UI.HORIZONTAL?r.x||0:r.y||0
;var p=r.iterator;return p||(p=function(e,t,i){if(r.align===cleverapps.UI.ALIGN_START||r.align===cleverapps.UI.ALIGN_END){var s=r.direction===cleverapps.UI.HORIZONTAL?e.height/2:e.width/2;r.align===cleverapps.UI.ALIGN_END&&(s=-s),r.direction===cleverapps.UI.HORIZONTAL?i+=s:t+=s}e.setPositionRound(t,i)}),a.forEach(function(e,t){r.direction===cleverapps.UI.TOP_TO_BOTTOM&&(e=a[a.length-1-t]);var i=e.baseScaleX||e.baseScale||e.scaleX,s=e.baseScaleY||e.baseScale||e.scaleY;if(r.direction===cleverapps.UI.HORIZONTAL){var n=e.y;void 0!==r.y&&(n=r.y-(.5-e.anchorY)*e.height*Math.abs(s)),p(e,c+e.width*Math.abs(i)*e.anchorX,n),c+=e.width*Math.abs(i)}else{var o=e.x;void 0!==r.x&&(o=r.x-(.5-e.anchorX)*e.width*Math.abs(i)),p(e,o,c+e.height*Math.abs(s)*e.anchorY),c+=e.height*Math.abs(s)}c+=l}),c-l},calculateContentSize:function(e){var t=0,i=0;return e.children.forEach(function(e){t<e.x+e.width*e.scaleX/2&&(t=e.x+e.width*e.scaleX/2),i<e.y+e.height*e.scaleY/2&&(i=e.y+e.height*e.scaleY/2)}),cc.size(
Math.round(t),Math.round(i))},fitToBox:function(e,t){var i=Math.min(t.width/e.width,t.height/e.height),s=t.maxScale||1;s<i&&(i=s),e.setScale(i)},LabelTTF:cc.LabelTTF.extend({ctor:function(e,t){this.___enabled=!0,this._super("",t)},onEnter:function(){this.___enabled=!0,this._super()},onExit:function(){this.___enabled=!1,this._super()},fitTo:function(e,t){if(this._autoDimensions&&(this.setDimensions(0,0),2048<this.width)){var i=this.getString();cleverapps.ReportStream.debug("Text width > 2048 - "+i+" - "+JSON.stringify((new Error).stack))}cleverapps.UI.ImageFont.prototype.fitTo.apply(this,arguments)},canAttachLastLine:function(){var e=this._renderCmd._strings;return!(!e||e.length<=1)&&(10<=e[e.length-2].length&&e[e.length-1].length<=2)},setDimensions:function(){this._super.apply(this,arguments),this._autoDimensions=!1},setFontSize:function(e){cleverapps.styles.UI.glyphScale&&-1!==["ja","zh","ko"].indexOf(cleverapps.settings.language)&&(e=Math.round(e*cleverapps.styles.UI.glyphScale.scale
)),this._super(e)},setFont:function(e){if(this.___enabled){this.setFontFillColor(e.color),this.setFontSize(e.size);var t=cleverapps.styles.UI.TTFText,i=t.verticalAlignment;this.safariCheck()&&(i=t.safari.verticalAlignment),void 0!==i&&this.setVerticalAlignment(i),e.shadow?this.enableShadowColor?this.enableShadowColor(e.shadow.direction,e.shadow.blur,e.shadow.color):this.enableShadow(e.shadow.color,e.shadow.direction,e.shadow.blur):this.disableShadow(),e.stroke?this.enableStroke(e.stroke.color,e.stroke.size):this.disableStroke();var s=this.getString();cc.LabelTTF.prototype.setString.call(this,""),cc.LabelTTF.prototype.setString.call(this,s)}},byLetterAnimation:function(e){var s=(e=e||{}).speed||.03,t=e.delay||.1;if(cc.sys.isMobile&&!cc.sys.isNative)return this.setOpacity(0),this.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.FadeIn(.3))),void(e.callback&&e.callback());this._fullString=this.getString();var n=0;this._byLetterAnimationRunning&&this.stopAllActions(),
this._byLetterAnimationRunning=!0,this._byLetterAnimationDone=function(){this._byLetterAnimationRunning&&(this.stopAllActions(),this._byLetterAnimationRunning=!1,cc.LabelTTF.prototype.setString.call(this,this._fullString),this._byLetterAnimationDone=void 0,e.callback&&e.callback())}.bind(this),cc.LabelTTF.prototype.setString.call(this,"");var o=void 0,a=function(e){this.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.CallFunc(function(){var e=0<n?this._fullString[n-1]:void 0;n++;var t=this._fullString[n-1];if(" "===e&&" "!==t){for(var i=n;i<this._fullString.length&&" "!==this._fullString[i];)i++;cc.LabelTTF.prototype.setString.call(this,this._fullString.substr(0,i)),o&&this.height!==o&&(this._fullString=this._fullString.substr(0,n-2)+"\n"+this._fullString.substr(n-1))}cc.LabelTTF.prototype.setString.call(this,this._fullString.substr(0,n)),n<this._fullString.length?(a(s),o=this.height):this._byLetterAnimationDone&&this._byLetterAnimationDone()}.bind(this))))}.bind(this);a(t)},
byLetterAnimationFinish:function(){this._byLetterAnimationRunning&&this._byLetterAnimationDone()},setString:function(e,t){this.___enabled&&(e=this.getLocalizedText(e,t),cc.LabelTTF.prototype.setString.call(this,e))},getLocalizedText:function(e,t){return"number"==typeof e?e+"":"string"!=typeof e||0!==e.indexOf("messages:")?(e||"")+"":Messages.get(e.substring("messages:".length),t)},setTextureRect:function(){this._super.apply(this,arguments),this._offsetPosition=cc.p(0,this.getBaseline())},safariCheck:function(){var e=cleverapps.UI.getBrowserName();return"Safari"===e||"Mobile Safari"===e||cc.sys.isWebView&&cc.sys.OS_IOS===cc.sys.os},getBaseline:function(){var e=cleverapps.styles.UI.TTFText,t=e.baseline;return this.safariCheck()&&(t=e.safari.baseline),this.getFontSize()<=40?Math.floor(t*this.getFontSize()/3):t*this.getFontSize()}}),animateDelta:function(e,t){if(0!==e){0<e&&(e="+"+e);var i=cleverapps.UI.generateTTFText(""+e,
t.font||cleverapps.styles.FONTS.WHITE_TEXT||cleverapps.styles.FONTS.TEXT);if(t.icon){var s=new cc.Sprite(t.icon);(i=new cleverapps.Layout([i,s],{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.UI.delta.margin})).setCascadeOpacityEnabled(!0)}t.parent&&t.parent.addChild(i),i.setPositionRound(t),t.zOrder&&i.setLocalZOrder(t.zOrder);var n=cleverapps.styles.UI.delta.y;t.dy&&(n=t.dy),t.delay=t.delay||0;var o=t.duration||2;return i.opacity=0,i.runAction(new cc.Sequence(new cc.DelayTime(t.delay),new cc.CallFunc(function(){i.opacity=255}),new cc.Spawn(new cc.MoveBy(o,cc.p(0,n)),new cc.Sequence(new cc.FadeTo(o,0),new cc.RemoveSelf)))),i}},getAppFontName:function(){var e=res.basefont_ttf;return cc.sys.isNative&&!cc.sys.isWebView&&cc.sys.os===cc.sys.OS_ANDROID?e.srcs[0]:e.name},generateTTFText:function(e,t,i,s){var n;if(cleverapps.UI.ImageFont.IsApplicable(t,e))n=new cleverapps.UI.ImageFont(t,e);else{e=(n=new cleverapps.UI.LabelTTF("",s||cleverapps.UI.getAppFontName())
).getLocalizedText(e,i);var o=cleverapps.UI.getSceneSize().width;1700<e.length*t.size*.5&&(n.setDimensions(o,0),n._autoDimensions=!0),n.setString(e),n.setFont(t)}return n},CheckBox:cc.Node.extend({ctor:function(e){this._super(),(e=e||{}).styles=e.styles||{},this.options=e,this.onChangeCallback=e.onChange||function(e){};var t=[];this.createCheckBox(),t.push(this.checkBox),e.label&&(this.createLabel(),t.push(this.label));var i=this.getStyles(),s=new cleverapps.Layout(t,{margin:i.margin,padding:i.padding,direction:cleverapps.UI.HORIZONTAL});this.addChild(s),this.setAnchorPoint2(),this.setContentSize2(s.getContentSize()),s.setPositionRound(this.width/2,this.height/2),cleverapps.UI.applyHover(this)},_onChange:function(e,t){switch(t){case ccui.CheckBox.EVENT_SELECTED:this.onChangeCallback(!0);break;case ccui.CheckBox.EVENT_UNSELECTED:this.onChangeCallback(!1)}cleverapps.audio.playSound(res.click_effect)},createCheckBox:function(){var e=this.getStyles(),t=this.checkBox=new ccui.CheckBox
;t.loadTextureBackGround(this.getSpriteFrameName(e.bgImage),ccui.Widget.PLIST_TEXTURE),t.loadTextureFrontCross(this.getSpriteFrameName(e.checkImage),ccui.Widget.PLIST_TEXTURE),t.addEventListener(this._onChange.bind(this),t),t.setSelected(this.options.isSelected)},createLabel:function(){this.label=cleverapps.UI.generateTTFText(this.options.label.text,this.options.label.font||cleverapps.styles.FONTS.WINDOW_TEXT),this.options.label.clickable&&cleverapps.UI.onClick(this,function(){this.checkBox.setSelected(!this.checkBox.isSelected()),this._onChange(null,this.checkBox.isSelected()?ccui.CheckBox.EVENT_SELECTED:ccui.CheckBox.EVENT_UNSELECTED)}.bind(this),{noThrottle:!0})},getSpriteFrameName:function(e){return"#"===e[0]?e.substr(1):e},setSelected:function(e){this.checkBox.setSelected(e)},getStyles:function(){return this.styles||(this.styles=cleverapps.overrideStyles(cleverapps.styles.UI.CheckBox,this.options.styles,!0)),this.styles}}),makeHideable:function(e,t){
e.hideHandler=new cleverapps.UI.HideHandler(e,t)},wrap:function(e,t){if(0===e.children.length)return e;for(var i,s,n,o,a=0;a<e.children.length;a++){var r=e.children[a],l=r.baseScaleX||r.baseScale||r.scaleX,c=r.baseScaleY||r.baseScale||r.scaleY,p=r.height,d=r.width;t&&(p=r.getBoundingBox().height,d=r.getBoundingBox().width,c=l=1);var h=r.y-p*c*r.anchorY,u=h+p*c;(void 0===i||h<i)&&(i=h),(void 0===s||s<u)&&(s=u);var v=r.x-d*l*r.anchorX,g=v+d*l;(void 0===n||v<n)&&(n=v),(void 0===o||o<g)&&(o=g)}return o<0&&(o=0),s<0&&(s=0),0<i&&(i=0),0<n&&(n=0),n=-n,i=-i,e.setContentSize2(n+o,i+s),e.children.forEach(function(e){e.x+=n,e.y+=i}),e.setAnchorPoint2(),e},shake:function(t,e){var i=(e=e||{}).delay||0,s=e.power||1,n=e.vibro;void 0===n&&(n=500);var o=e.strength;o||(o=cleverapps.styles.UI.shake);var a=e.base;a||(a={x:t.x,y:t.y,r:t.rotation});var r=[{x:2,y:1,r:0},{x:-1,y:-2,r:-1},{x:-3,y:0,r:1},{x:0,y:2,r:0},{x:1,y:-1,r:1},{x:0,y:0,r:0}].map(function(e){return new cc.CallFunc(function(){t.setPosition(
a.x+e.x*o.dx*s,a.y+e.y*o.dy*s),t.setRotation(a.r+e.r)})}),l=[new cc.DelayTime(i/1e3)];cleverapps.settings.vibro&&n&&l.push(new cc.CallFunc(function(){cc.sys.isNative&&void 0!==cc.Device?cc.Device.vibrate(n/1e3):"undefined"!=typeof navigator&&navigator.vibrate&&navigator.vibrate(n)})),r.forEach(function(e){l.push(e),l.push(new cc.DelayTime(.05))}),t.stopAllActions(),t.runAction(new cc.Sequence(l))},wrapWithPadding:function(e,t,i){if(t=t||{x:0,y:0},i)return e.children.forEach(function(e){e.x+=t.x,e.y+=t.isTop?0:t.y}),e.width+=2*t.x,e.height+=t.y+(t.isTop?0:t.y),e;var s=new cc.Node;return s.addChild(e),s.setContentSize2(e.width*e.scaleX+2*t.x,e.height*e.scaleY+t.y+(t.isTop?0:t.y)),s.setAnchorPoint2(),e.setPosition(s.width/2,s.height/2+(t.isTop?-t.y/2:0)),s},targetContainPoint:function(e,t,i){if(i){if(!cc.rectContainsPoint(cc.rect(0,0,e.width,e.height),t))return!1;if(t.x+=(i.width-e.width)/2,t.x<0||t.x>i.width)return!1;var s=i.width/2,n=i.height/2;t.x>s&&(t.x=i.width-t.x);var o=e.height
;return o<i.height&&(o=i.height),t.y>n&&t.y<o-n?!0:(t.y>n&&(t.y=o-t.y),!(t.y<0||t.y>n)&&(s-t.x)*n<t.y*s)}var a=e.clickPosition||{x:0,y:0};return cc.rectContainsPoint(cc.rect(a.x,a.y,e.width,e.height),t)},onDrag:function(i,s){var n,o=void 0!==(s=s||{}).dragMinDist?s.dragMinDist:cleverapps.styles.UI.DRAG_MIN_DIST,e=cleverapps.UI.DRAG_THROTTLE,a=cleverapps.throttle(e,s.onDragMove),r=!1,t=!1;return void 0!==s.swallowTouches&&(t=s.swallowTouches),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:t,onTouchBegan:function(e){if(!i.isDisplayed())return!1;var t=cleverapps.UI.targetContainPoint(i,i.convertTouchToNodeSpace(e),s.isometricCell);return t&&(n=e.getLocation(),s.onTouchBegan&&s.onTouchBegan()),t},onTouchMoved:function(e){var t=e.getLocation();if(cc.pDistance(t,n)>=o){if(!r){if(s.onDragStart&&!s.onDragStart())return;r=!0}s.followPointer&&i.setPositionRound(i.parent.convertTouchToNodeSpace(e)),a({dx:t.x-n.x,dy:t.y-n.y,touch:e})}},onTouchEnded:function(e){
if(r||0===o){r=!1;var t=e.getLocation();s.onDragMove({dx:t.x-n.x,dy:t.y-n.y,touch:e}),s.onDragEnd({dx:t.x-n.x,dy:t.y-n.y,touch:e})}}},i)},onTouchBegan:function(i,s,n){n=n||{},s&&!n.noThrottle&&(s=cleverapps.throttle(n.clickThrottle||cleverapps.UI.CLICK_THROTTLE,s));var e=!0;return void 0!==n.swallowTouches&&(e=n.swallowTouches),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:e,onTouchBegan:function(e){if(!i.isDisplayed())return!1;var t=i.convertTouchToNodeSpace(e);return!!cleverapps.UI.targetContainPoint(i,t,n.isometricCell)&&(s(t),!0)}},i)},onClick:function(i,s,n){n=n||{},s&&!n.noThrottle&&(s=cleverapps.throttle(n.clickThrottle||cleverapps.UI.CLICK_THROTTLE,s));var o,a,r=n.ignoreOnTouchMoved,e=!0;return void 0!==n.swallowTouches&&(e=n.swallowTouches),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:e,onTouchBegan:function(e){if(!i.isDisplayed())return!1;var t=cleverapps.UI.targetContainPoint(i,
i.convertTouchToNodeSpace(e),n.isometricCell);return t&&(o=e.getLocation(),a=!0),t&&i.onTouchBegan&&i.onTouchBegan(),t},onTouchMoved:function(e){if(r&&a){var t=o,i=e.getLocation();Math.abs(t.x-i.x)+Math.abs(t.y-i.y)>cleverapps.styles.UI.onClick.ignoreOnTouchMovedThreshold&&(a=!1)}},onTouchEnded:function(e){i.onTouchEnded&&i.onTouchEnded();var t=i.convertTouchToNodeSpace(e);if(cleverapps.UI.targetContainPoint(i,t,n.isometricCell)&&a)return s(t),!0}},i)},applyHover:function(o,a){o.onMouseOver||(a&&console.log("CREATE ON"),o.onMouseOver=function(){o.setScale(1.05*o.baseScale||1.05),o.settings&&o.settings.hint&&o.showHint(o.settings.hint)}),o.onMouseOut||(o.onMouseOut=function(){o.setScale(void 0===o.baseScale?1:o.baseScale),o.settings&&o.settings.hint&&o.hideHint()}),o.hoverListener=cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:function(e){a&&console.log("MOUSE MOVE");var t=o.convertToNodeSpace(e.getLocation()),i=o.getContentSize(),s=o.hoverPosition||{x:0,y:0},
n=cc.rect(s.x,s.y,i.width,i.height);cc.rectContainsPoint(n,t)?(o.onMouseOver(),o.mouseOver=!0):o.mouseOver&&(o.onMouseOut(),o.mouseOver=!1)}},o)},removeHover:function(e){e.hoverListener&&(cc.eventManager.removeListener(e.hoverListener),delete e.hoverListener)},convertToGrayScale:function(e,t){"undefined"!=typeof gl&&(t?e.normalShader?e.setShaderProgram(e.normalShader):e.opacity=255:cc.shaderCache&&cleverapps.Shaders&&cc.shaderCache.getProgram(cleverapps.Shaders.GRAYSCALE_SPRITE_KEY)?(e.normalShader||(e.normalShader=e.getShaderProgram()),e.setShaderProgram(cc.shaderCache.getProgram(cleverapps.Shaders.GRAYSCALE_SPRITE_KEY))):e.opacity=150)},_setShaderUpdate:function(e,t,i){if(e._superUpdate)e.update=e._superUpdate.bind(e),delete e._superUpdate,e.normalShader&&e.setShaderProgram(e.normalShader);else if(cc.shaderCache&&cleverapps.Shaders&&cc.shaderCache.getProgram(t)){e.normalShader||(e.normalShader=e.getShaderProgram()),e.setShaderProgram(cc.shaderCache.getProgram(t))
;var s=e.getShaderProgram();e._superUpdate=e.update,e.scheduleUpdate(),e.update=function(e){i(e,s)}.bind(e)}},toggleFlickering:function(s,e){if("undefined"!=typeof gl){var n=(e=e||{}).flickSpeed||2,o=e.flickPause||.2,a=e.color;(!a||!Array.isArray(a)||a.length<3)&&(a=[.35,.35,.35]);var r=0;this._setShaderUpdate(s,cleverapps.Shaders.FLICKER_SHADER_KEY,function(e,t){s._superUpdate(e),t.use(),r+=e;var i=Math.abs(Math.sin(Math.max(r-o,0)*n));i=Math.max(0,Math.min(1,i)),t.setUniformLocationWith1f("sineTime",i),t.setUniformLocationWith3f("flickColor",a[0],a[1],a[2])})}},toggleBlur:function(c,p){if((p=p||{}).animate=p.animate||{},"undefined"!=typeof gl){var i=p.blurLength||.005,d=p.strength||1,h=function(e,t){c.blurShader.use(),c.blurShader.setUniformLocationWith1f("u_blurOffset",i),c.blurShader.setUniformLocationWith1f("u_blurStrength",e),c.blurShader.setUniformLocationWith1f("u_extent",t)},e=function(e,t){t=t||function(){};var i=p.animate.type||cleverapps.UI.BLUR_ANIMATION.FADE,
s=p.animate.time||.2,n=p.animate.steps||20,o=e?d:0,a=e?1:0,r=d/n,l=1/n;c.blurAction=c.runAction(new cc.Sequence(new cc.Repeat(new cc.Sequence(new cc.CallFunc(function(){i===cleverapps.UI.BLUR_ANIMATION.FADE?h(o+=e?-r:r,1):h(d,a+=e?-l:l)}),new cc.DelayTime(s/n)),n),new cc.CallFunc(t))),c.blurAction.whenDone=t};if(c.blurAction&&!c.blurAction.isDone()&&(c.stopAction(c.blurAction),c.blurAction.whenDone(),delete c.blurAction),c.normalShader){var t=function(){c.setShaderProgram(c.normalShader),delete c.normalShader,delete c.blurShader};p.animate?e(!0,function(){t(),p.animate.callback&&p.animate.callback()}):t()}else if(cc.shaderCache&&cleverapps.Shaders){var s=cleverapps.Shaders.BLUR_FADE_KEY;p.animate.type===cleverapps.UI.BLUR_ANIMATION.CURTAIN&&(s=p.animate.reverseCurtain?cleverapps.Shaders.BLUR_CURTAIN_REVERSE_KEY:cleverapps.Shaders.BLUR_CURTAIN_KEY),cc.shaderCache.getProgram(s)&&(c.normalShader=c.getShaderProgram(),c.setShaderProgram(cc.shaderCache.getProgram(s)),
c.blurShader=c.getShaderProgram(),p.animate?e(!1,p.animate.callback):h(d,1))}}else p.animate&&p.animate.callback&&p.animate.callback()},getSceneSize:function(){var e=cc.director.getWinSize();return e.height=cleverapps.styles.SCENE_HEIGHT,e},getSceneOffsetY:function(){var e=cc.director.getRunningScene(),t=1;return e&&e.scene&&(t=e.scene.resizeScale),(cc.director.getWinSize().height-cleverapps.styles.SCENE_HEIGHT*t)/2/t},addShadowLayer:function(e,t){var s=cc.director.getWinSize(),n=this.layer=new cc.LayerColor(cleverapps.styles.COLORS.BLACK,1.05*s.width+5,1.05*s.height+5);return(t=t||cc.director.getRunningScene()).onChangeSizeListeners&&(t.onChangeSizeListeners[e||"changeSizeShadowLayer"]=n.createListener(function(){var e=cc.director.getWinSize(),t=Math.max(e.width/s.width,s.width/e.width),i=Math.max(e.height/s.height,s.height/e.height);n.setScale(t*i)})),n.setAnchorPoint2(),n.setPosition(.025*-s.width-2,.025*-s.height-2),n},createPatternSprite:function(e,t){void 0===t&&(
t=cc.director.getWinSize());var i=new cc.Sprite(e);if("auto"===t.width&&(t.width=i.width-2),"auto"===t.height&&(t.height=i.height-2),"undefined"!=typeof gl&&i.getTexture()){i.getTexture().setTexParameters({minFilter:gl.NEAREST,magFilter:gl.NEAREST,wrapS:gl.REPEAT,wrapT:gl.REPEAT});var s=i.getTextureRect();s.width=t.width,s.height=t.height,i.setTextureRect(s)}else t.width&&t.height&&i.setScale(t.width/i.width,t.height/i.height);return i.setPositionRound(t.width/2,t.height/2),i},createSprite:function(e){if(!e)return new cc.Sprite;if("string"==typeof(a=e&&e.image||e)&&res[a]&&0!==a.indexOf("#")&&(a=res[a]),a=processVirtualFrame(a),void 0!==e.scale9&&!1!==e.scale9){var t,i,s=cleverapps.UI.createScale9Sprite(a,e.scale9);e.sizes?(t=e.sizes[cleverapps.wideMode.mode].width,i=e.sizes[cleverapps.wideMode.mode].height):(t=e.width,i=e.height);var n=e.rotation;if(e.rotations&&(n=e.rotations[cleverapps.wideMode.mode]),n){var o=i;i=t,t=o,s.setRotation(n)}return s.setContentSize2(t,i),s}var a,r=a
;return(a=new cc.Sprite(a)).scale=e.scale||1,a.spriteFrameName=r,a},createScale9Sprite:function(e,t){void 0===t&&(t=cleverapps.UI.Scale9Rect.Default);var i=cc.spriteFrameCache.getSpriteFrame(e);if(!i){if(cleverapps.config.debugMode)throw"No scale9 sprite: "+e;return new cc.Scale9Sprite}var s=i.getOriginalSize(),n=t===cleverapps.UI.Scale9Rect.TwoPixelXY,o=Math.round(n?s.width/2-1:s.width/3),a=Math.round(n?2:s.width/3),r=t===cleverapps.UI.Scale9Rect.TwoPixelY||t===cleverapps.UI.Scale9Rect.TwoPixelXY,l=Math.round(r?s.height/2-1:s.height/3),c=Math.round(r?2:s.height/3),p=new cc.Scale9Sprite(e,cc.rect(o,l,a,c));return p.spriteFrameName=e,p},createAnimation:function(e){e=e.spine;var t=new cleverapps.Spine(e.json);return t.setAnimation(0,e.openAnimation,!1),e.idleAnimation&&t.setCompleteListener(function(){t.setAnimation(0,e.idleAnimation,!0)}),t},getBrowserName:function(){return cleverapps.UI.browserName?cleverapps.UI.browserName:cleverapps.UI.browserName=(new UAParser).getBrowser().name}},
cleverapps.styles.UI={DRAG_MIN_DIST:5,delta:{y:20,icon:{margin:5}},Avatar:{x:8,top:8,bottom:8},onClick:{ignoreOnTouchMovedThreshold:30},shake:{dx:1,dy:1},TTFText:{verticalAlignment:void 0,baseline:0,safari:{verticalAlignment:void 0,baseline:0}},CheckBox:{checkImage:res.goal_done_sign,bgImage:res.select_friend_checkbox,margin:10}},cleverapps.UI.Scale9Rect={Default:0,TwoPixelX:1,TwoPixelY:2,TwoPixelXY:3},cleverapps.UI.DRAG_THROTTLE=50,cleverapps.UI.CLICK_THROTTLE=500,cleverapps.UI.SOCIAL_CLICK_THROTTLE=cleverapps.UI.CLICK_THROTTLE,cleverapps.UI.BLUR_ANIMATION={FADE:1,CURTAIN:2},cleverapps.UI.ScrollBarContainer=cc.Node.extend({}),cleverapps.UI.ScrollView=ccui.Layout.extend({ctor:function(e,t){switch(this.options=t||{},this.dir=cleverapps.UI.ScrollView.DIR_NONE,this.options.childrenVisibility=void 0===this.options.childrenVisibility?cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_FULLCHECK:this.options.childrenVisibility,this.options.childrenVisibility){
case cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_LINEAR:this.childrenVisibility=new ScrollChildrenLinearVisibility(this);break;case cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_FULLCHECK:this.childrenVisibility=new ScrollChildrenFullCheckVisibility(this)}this._super(),(void 0===this.options.clipping||this.options.clipping)&&this.setClippingEnabled(!0),this.setAnchorPoint2(),this.centerNode=new cc.Node,this.addChild(this.centerNode),!1!==this.options.scrollBarEnabled&&(this.barContainer=new cleverapps.UI.ScrollBarContainer,this.addChild(this.barContainer,2),this.barContainer.setCascadeOpacityEnabled(!0),this.barContainer.setOpacity(0),this.barContainer.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.FadeTo(.3,255))),this.barHandler=new ScrollBarHandler(this)),this.scrollHandler=new cleverapps.UI.ScrollHandler(this),e&&this.setInnerContent(e),this.scheduleUpdate()},isEmpty:function(){return!this.innerContent||!this.innerContent.children.length},setContentSize:function(e,t){
var i=this.width,s=this.height;this._super(e,t),i===this.width&&s===this.height||(this.barContainer&&this.barContainer.setContentSize(this.getContentSize()),this.centerNode&&this.centerNode.setPosition(this.width/2,this.height/2),this.innerContent&&(this.calcBorders(),this.scrollToDefault()))},updateVisibility:function(){if(this.childrenVisibility&&this.currentVisibleChildIds&&!this.isEmpty()&&this.width+this.height!==0){var e;for(e=0;e<this.currentVisibleChildIds.length;e++)this.innerContent.children[this.currentVisibleChildIds[e]].visible=!1;for(this.currentVisibleChildIds=this.childrenVisibility.visibleIds(),e=0;e<this.currentVisibleChildIds.length;e++)this.innerContent.children[this.currentVisibleChildIds[e]].visible=!0}},isVisiblePoint:function(e){var t=cc.rect(this.innerContent.width/2-this.width/2-this.innerContent.x,this.innerContent.height/2-this.height/2-this.innerContent.y,this.width,this.height);return cc.rectContainsPoint(t,e)},calcBorders:function(){if(this.isEmpty()
)return this.min=cc.p(0,0),void(this.max=cc.p(0,0));this.min=cc.p(-this.innerContent.width/2+this.width/2,-this.innerContent.height/2+this.height/2),0<this.min.x&&(this.min.x=0),0<this.min.y&&(this.min.y=0),this.max=cc.p(this.innerContent.width/2-this.width/2,this.innerContent.height/2-this.height/2),this.max.x<0&&(this.max.x=0),this.max.y<0&&(this.max.y=0),this.setDirection(),this.barHandler&&this.barHandler.reset()},setInnerContent:function(e){this.innerContent&&this.innerContent.removeFromParent(),this.innerContent=e,this.innerContent.setAnchorPoint2(),this.innerContent.setPositionRound(0,0),this.centerNode.addChild(e),this.width&&this.height?(this.updateInnerContent(),this.scrollToDefault()):this.initChildrenVisibility()},scrollToDefault:function(){this.innerContent&&this.scrollTo(this.options.defaultPoint?this.options.defaultPoint:cleverapps.UI.ScrollView.SCROLLS.UPPER_LEFT)},initChildrenVisibility:function(){if(this.childrenVisibility){this.currentVisibleChildIds=[];for(
var e=0;e<this.innerContent.children.length;e++)this.currentVisibleChildIds.push(e)}},updateInnerContent:function(){this.calcBorders(),this.initChildrenVisibility(),this.scrollToPoint(this.normalizePoint(this.getContainerPosition()))},scrollToMakeNodeVisible:function(e,t,i){var s=e.getBoundingBox(),n=cc.p(s.x,s.y),o=cc.p(s.x+s.width,s.y+s.height);n=this.centerNode.convertToNodeSpace(e.getParent().convertToWorldSpace(n)),o=this.centerNode.convertToNodeSpace(e.getParent().convertToWorldSpace(o)),i*=.01;var a=cc.p(-this.width/2*i,-this.height/2*i),r=cc.p(this.width/2*i,this.height/2*i),l=cc.p(0,0);if(n.x<a.x&&(l.x=-(a.x-n.x)),o.x>r.x&&(l.x=o.x-r.x),n.y<a.y&&(l.y=-(a.y-n.y)),o.y>r.y&&(l.y=o.y-r.y),cleverapps.config.debugMode&&0<Math.abs(l.x)+Math.abs(l.y)){var c=new cc.Node;c.setContentSize(r.x-a.x,r.y-a.y),c.setAnchorPoint2(),c.debugBorder(),this.centerNode.addChild(c)}this.scrollHandler.startAutoScroll(l,t)},scrollTo:function(e,t){if(void 0!==e){switch(e){
case cleverapps.UI.ScrollView.SCROLLS.UPPER_LEFT:e=cc.p(this.min.x,this.max.y);break;case cleverapps.UI.ScrollView.SCROLLS.CENTER:e=cc.p(0,0);break;case cleverapps.UI.ScrollView.SCROLLS.LOWER_RIGHT:e=cc.p(this.max.x,this.min.y);break;default:e instanceof cc.Node&&(e=this.innerContent.convertToNodeSpace(e.getParent().convertToWorldSpace(e.getPosition()))),e.x-=this.innerContent.width/2,e.y-=this.innerContent.height/2}e=this.normalizePoint(e),t?this.scrollHandler.startAutoScroll(cc.pSub(e,this.getContainerPosition()),t):this.scrollToPoint(e)}},update:function(e){this._super(e),this.scrollHandler.processAutoScroll(e)},getCurScrollPercent:function(){if(!this.innerContent)return{x:0,y:0};var e=this.max.x-this.min.x,t=this.max.y-this.min.y;return{x:0!==e?(this.innerContent.x-this.min.x)/e*100:0,y:0!==t?(this.innerContent.y-this.min.y)/t*100:0}},normalizePoint:function(e){return{x:Math.max(this.min.x,Math.min(this.max.x,e.x)),y:Math.max(this.min.y,Math.min(this.max.y,e.y))}},
getContainerPosition:function(){return cc.p(-this.innerContent.x,-this.innerContent.y)},scrollToPoint:function(e){this.innerContent.setPosition(-e.x,-e.y),this.updateVisibility(),this.barHandler&&this.barHandler.updatePos(),this.options.containerMovedListener&&this.options.containerMovedListener()},scrollToPercent:function(e,t){var i;if(e=Math.min(100,Math.max(0,e)),this.dir&cleverapps.UI.ScrollView.DIR_VERTICAL){var s=(this.max.y-this.min.y)*e/100+this.min.y;i=cc.p(this.innerContent.x,s)}else{var n=(this.max.x-this.min.x)*e/100+this.min.x;i=cc.p(n,this.innerContent.y)}t?this.scrollHandler.startAutoScroll(cc.pSub(i,this.getContainerPosition()),t):this.scrollToPoint(i)},setDirection:function(){this.options.direction?this.dir=this.options.direction:(this.dir=cleverapps.UI.ScrollView.DIR_BOTH,this.min.y===this.max.y&&(this.dir^=cleverapps.UI.ScrollView.DIR_VERTICAL),this.min.x===this.max.x&&(this.dir^=cleverapps.UI.ScrollView.DIR_HORIZONTAL))},getInnerContainer:function(){
return this.innerContent},setBarPadding:function(e){this.barHandler&&this.barHandler.setPadding(e)}}),cleverapps.UI.ScrollView.SCROLLS={UPPER_LEFT:0,CENTER:1,LOWER_RIGHT:2},cleverapps.UI.ScrollView.DIR_NONE=0,cleverapps.UI.ScrollView.DIR_VERTICAL=1,cleverapps.UI.ScrollView.DIR_HORIZONTAL=2,cleverapps.UI.ScrollView.DIR_BOTH=cleverapps.UI.ScrollView.DIR_VERTICAL|cleverapps.UI.ScrollView.DIR_HORIZONTAL,cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_NONE=0,cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_LINEAR=1,cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_FULLCHECK=2;var ScrollBarHandler=function(e){this.scroll=e};ScrollBarHandler.prototype.reset=function(){!this.barY&&this.scroll.dir&cleverapps.UI.ScrollView.DIR_VERTICAL&&this.scroll.min.y!==this.scroll.max.y&&(this.barY=new ScrollBar(this.scroll,cleverapps.UI.ScrollView.DIR_VERTICAL)),!this.barX&&this.scroll.dir&cleverapps.UI.ScrollView.DIR_HORIZONTAL&&this.scroll.min.x!==this.scroll.max.x&&(this.barX=new ScrollBar(this.scroll,
cleverapps.UI.ScrollView.DIR_HORIZONTAL)),this.barX&&this.barX.reset(),this.barY&&this.barY.reset(),this.updatePos()},ScrollBarHandler.prototype.setAutoHide=function(e){this.barX&&(this.barX.autoHideEnabled=e),this.barY&&(this.barY.autoHideEnabled=e)},ScrollBarHandler.prototype.setPadding=function(e){this.barPadding=e,this.barX&&this.barX.setPadding(this.barPadding),this.barY&&this.barY.setPadding(this.barPadding)},ScrollBarHandler.prototype.updatePos=function(){var e=this.scroll.scrollHandler.getHowMuchOutOfBoundary();this.barY&&this.barY.onScrolled(e),this.barX&&this.barX.onScrolled(e)},ScrollBarHandler.prototype.onTouchBegan=function(){this.barY&&this.barY.onTouchBegan(),this.barX&&this.barX.onTouchBegan()},ScrollBarHandler.prototype.onTouchEnded=function(){this.barY&&this.barY.onTouchEnded(),this.barX&&this.barX.onTouchEnded()};var ScrollBar=ccui.ScrollViewBar.extend({ctor:function(e,t){this.scroll=e,this.dir=t,this._super(e,t),e.barContainer.addChild(this),this.autoHideEnabled=!1,
this.setPadding(this.scroll.barHandler.barPadding),this.addControls(),this.setWidth(cleverapps.styles.ScrollBar.barWidth)},setPadding:function(e){e=e||{};var t=cleverapps.styles.ScrollBar,i=void 0!==e.cornerPadding?e.cornerPadding:t.cornerPadding,s=void 0!==e.sidePadding?e.sidePadding:t.sidePadding,n=cc.p(this.dir===cleverapps.UI.ScrollView.DIR_VERTICAL?s:i,this.dir===cleverapps.UI.ScrollView.DIR_VERTICAL?i:s);this.setPositionFromCorner(n),this.onScrolled(this.scroll.scrollHandler.getHowMuchOutOfBoundary())},reset:function(){this.scroll.dir&this.dir?this.setVisible(!0):this.setVisible(!1)},onScrolled:function(e){this._autoHideEnabled&&(this._autoHideRemainingTime=this.autoHideTime,cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity));var t=this.scroll.getInnerContainer(),i=0,s=0,n=0,o=0;this._direction===cleverapps.UI.ScrollView.DIR_VERTICAL?(i=t.height,s=this.scroll.height,n=e.y,o=-t.getPositionY()+(this.scroll.max.y-this.scroll.min.y)/2
):this._direction===cleverapps.UI.ScrollView.DIR_HORIZONTAL&&(i=t.width,s=this.scroll.width,n=e.x,o=-t.getPositionX()+(this.scroll.max.x-this.scroll.min.x)/2);var a=this._calculateLength(i,s,n),r=this._calculatePosition(i,s,o,n,a);this._updateLength(a),this.setPosition(r)},getActualContentSize:function(){return{width:this._body.getBoundingBox().width,height:this._body.getBoundingBox().height}},addControls:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onBarTouchBegan.bind(this),onTouchMoved:this.onBarTouchMoved.bind(this),onTouchEnded:this.onBarTouchEnded.bind(this),onTouchCancelled:this.onTouchEnded.bind(this)},this)},onBarTouchBegan:function(e){if(!this.visible)return!1;var t=this.convertTouchToNodeSpace(e),i=this.getActualContentSize();return cc.rectContainsPoint(cc.rect(-i.width/2,0,i.width,i.height),t)?(this.scroll.scrollHandler.stopAutoScroll(),!0):void 0},onBarTouchMoved:function(e){
var t=this.convertToNodeSpace(e.getLocation()),i=this.convertToNodeSpace(e.getPreviousLocation()),s=cc.pSub(t,i),n=this.getPosToPercent(s);this.scroll.scrollToPercent(n)},getPosToPercent:function(e){if(this.dir===cleverapps.UI.ScrollView.DIR_VERTICAL){var t=this.scroll.height-2*this.getPositionFromCorner().y-this.getActualContentSize().height;return(this.y+e.y-this.getPositionFromCorner().y)/t*100}t=this.scroll.width-2*this.getPositionFromCorner().x-this.getActualContentSize().height;return(this.x+e.y-this.getPositionFromCorner().x)/t*100},onBarTouchEnded:function(e){}});cleverapps.styles.ScrollBar={barWidth:12,cornerPadding:20,sidePadding:20};var ScrollChildrenLinearVisibility=function(e){this.scroll=e};ScrollChildrenLinearVisibility.prototype.visibleIds=function(){var e,t;if(this.scroll.innerContent.children.length<=1)e=0,t=this.scroll.innerContent.children.length;else{var i,s,n=this.scroll.innerContent.children.length-1,o=this.scroll.innerContent.children[0].getPosition(),
a=this.scroll.innerContent.children[n].getPosition();a.x-=o.x,a.x/=n,a.y-=o.y,a.y/=n,0!==a.y?(i=a.y,s=this.scroll.innerContent.children[0].height/2,e=(-this.scroll.innerContent.y-o.y+this.scroll.innerContent.height/2-this.scroll.height/2)/i,t=(this.scroll.height+2*s)/i):(i=a.x,s=this.scroll.innerContent.children[0].width/2,e=(-this.scroll.innerContent.x-o.x+this.scroll.innerContent.width/2-this.scroll.width/2)/i,t=(this.scroll.width+2*s)/i),t<0&&(e-=t=-t),e=Math.ceil(e-s/Math.abs(i)),t=Math.floor(t+2*s/Math.abs(i))}for(var r=[],l=0;l<t;l++)this.scroll.innerContent.children[e+l]&&r.push(e+l);return r};var ScrollChildrenFullCheckVisibility=function(e){this.scroll=e};ScrollChildrenFullCheckVisibility.prototype.visibleIds=function(){for(var e=[],t=0;t<this.scroll.innerContent.children.length;t++){var i=this.scroll.innerContent.children[t],s=i.x-this.scroll.innerContent.width/2,n=i.y-this.scroll.innerContent.height/2
;-this.scroll.innerContent.x-this.scroll.width/2-i.width/2<=s&&s<=-this.scroll.innerContent.x+this.scroll.width/2+i.width/2&&-this.scroll.innerContent.y-this.scroll.height/2-i.height/2<=n&&n<=-this.scroll.innerContent.y+this.scroll.height/2+i.height/2&&e.push(t)}return e},cleverapps.UI.HideHandler=function(e,t){switch(this.target=e,this.initialized=!1,this.direction=t||cleverapps.UI.HORIZONTAL,this.isShow=!0,this.paused=!1,e.hide||(e.hide=e.createListener(this.hide.bind(this))),e.show||(e.show=e.createListener(this.show.bind(this))),e.isShown=e.createListener(function(){return this.isShow}.bind(this)),this.direction){case cleverapps.UI.SCALE_ANIMATION:e.hideAnimation||(e.hideAnimation=e.createListener(this.scaleHideAnimation.bind(this))),e.showAnimation||(e.showAnimation=e.createListener(this.scaleShowAnimation.bind(this)));break;case cleverapps.UI.OPACITY_ANIMATION:e.hideAnimation||(e.hideAnimation=e.createListener(this.opacityHideAnimation.bind(this))),e.showAnimation||(
e.showAnimation=e.createListener(this.opacityShowAnimation.bind(this)));break;default:e.hideAnimation||(e.hideAnimation=e.createListener(this.hideAnimation.bind(this))),e.showAnimation||(e.showAnimation=e.createListener(this.showAnimation.bind(this)))}e.showForDuration=e.createListener(this.showForDuration.bind(this)),e.toggle=e.createListener(this.toggle.bind(this)),e.pauseHideHandler=e.createListener(this.pauseHideHandler.bind(this)),e.resumeHideHandler=e.createListener(this.resumeHideHandler.bind(this)),e.parent&&this.initialize()},cleverapps.UI.HideHandler.prototype.pauseHideHandler=function(){this.paused=!0},cleverapps.UI.HideHandler.prototype.resumeHideHandler=function(){this.paused=!1},cleverapps.UI.HideHandler.prototype.toggle=function(e,t){e?this.show(t):this.hide(t)},cleverapps.UI.HideHandler.prototype.showForDuration=function(e,t){t=t||{};this.clearTimeouts(),this.show(),this.callbackTimeout=setTimeout(function(){e&&e()},500),this.hideTimeout=setTimeout(function(){this.hide(
),this.clearTimeouts()}.bind(this),2e3)},cleverapps.UI.HideHandler.prototype.postponeHiding=function(e){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(function(){this.hide(),this.clearTimeouts()}.bind(this),e))},cleverapps.UI.HideHandler.prototype.clearTimeouts=function(){this.callbackTimeout&&(clearTimeout(this.callbackTimeout),delete this.callbackTimeout),this.hideTimeout&&(clearTimeout(this.hideTimeout),delete this.hideTimeout)},cleverapps.UI.HideHandler.prototype.showAnimation=function(e,t){if(this.target.stopAllActions(),e)return this.target.setPosition(this.originalPosition),void(this.target.visible=!0);this.target.visible=!0,this.target.runAction(new cc.Sequence(new cc.DelayTime(t||0),new cc.MoveTo(.3,this.originalPosition)))},cleverapps.UI.HideHandler.prototype.hideAnimation=function(e,t){if(this.target.stopAllActions(),e)return this.target.setPosition(this.hidePosition),void(this.target.visible=!1);this.target.runAction(new cc.Sequence(
new cc.DelayTime(t||0),new cc.MoveTo(.15,this.hidePosition),new cc.CallFunc(function(){this.target.visible=!1}.bind(this))))},cleverapps.UI.HideHandler.prototype.opacityShowAnimation=function(e,t){this.target.stopAllActions();var i=this.target.baseOpacity||255;if(e)return this.target.visible=!0,void this.target.setOpacity(i);this.target.visible=!0,this.target.runAction(new cc.Sequence(new cc.DelayTime(t||0),new cc.FadeTo(.3,i)))},cleverapps.UI.HideHandler.prototype.opacityHideAnimation=function(e,t){if(this.target.stopAllActions(),e)return this.target.setOpacity(0),void(this.target.visible=!1);this.target.runAction(new cc.Sequence(new cc.DelayTime(t||0),new cc.FadeTo(.15,0),new cc.CallFunc(function(){this.target.visible=!1}.bind(this))))},cleverapps.UI.HideHandler.prototype.scaleShowAnimation=function(e,t){this.target.stopAllActions();var i=this.target.baseScale||1;if(e)return this.target.visible=!0,void this.target.setScale(i);this.target.visible=!0,this.target.runAction(
new cc.Sequence(new cc.DelayTime(t||0),new cc.ScaleTo(.3,i)))},cleverapps.UI.HideHandler.prototype.scaleHideAnimation=function(e,t){if(this.target.stopAllActions(),e)return this.target.setScale(0),void(this.target.visible=!1);this.target.runAction(new cc.Sequence(new cc.DelayTime(t||0),new cc.ScaleTo(.15,0),new cc.CallFunc(function(){this.target.visible=!1}.bind(this))))},cleverapps.UI.HideHandler.prototype.show=function(e,t){(!0!==this.isShow||e)&&(this.isShow=!0,this.initialized&&!this.paused&&(this.clearTimeouts(),this.target.showAnimation(e,t)))},cleverapps.UI.HideHandler.prototype.hide=function(e,t){(!1!==this.isShow||e)&&(this.isShow=!1,this.initialized&&!this.paused&&this.target.hideAnimation(e,t))},cleverapps.UI.HideHandler.prototype.initialize=function(){if(!this.initialized){if(this.initialized=!0,this.target.originalPosition?this.originalPosition=this.target.originalPosition:this.originalPosition=this.target.getPosition(),this.target.hidePosition
)this.hidePosition=this.target.hidePosition;else{var e,t=this.target.getParent().convertToWorldSpace(this.originalPosition),i=cc.director.getWinSize();this.direction===cleverapps.UI.VERTICAL?(e=t.y>i.height/2?i.height-t.y:-t.y,this.hidePosition=cc.p(this.originalPosition.x,this.originalPosition.y+2*e)):(e=t.x>i.width/2?i.width-t.x:-t.x,this.hidePosition=cc.p(this.originalPosition.x+2*e,this.originalPosition.y))}this.paused||(!1===this.isShow?this.target.hideAnimation(!0):this.target.showAnimation(!0))}},cleverapps.UI.ScrollHandler=function(e,t){t=t||{},this.target=e,this.bounceEnabled=!0,this.initAutoScrollParams(),this.enableMouseWheelScroll(),this.enableTouchScroll()},cleverapps.UI.ScrollHandler.prototype.enableMouseWheelScroll=function(){"mouse"in cc.sys.capabilities&&cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseScroll:function(e){this.target.isDisplayed()&&cc.rectContainsPoint(cc.rect(0,0,this.target.width,this.target.height),this.target.convertToNodeSpace(
e.getLocation()))&&(this.handleMouseWheel(e.getScrollY()),e.stopPropagation())}.bind(this)},this.target)},cleverapps.UI.ScrollHandler.prototype.handleMouseWheel=function(e){if(0!=(this.target.dir&cleverapps.UI.ScrollView.DIR_VERTICAL)){var t=this.getHowMuchOutOfBoundary();!this.fltEqualZero(t)&&(t.y<0&&0<e||0<t.y&&e<0)||this.lastMouseWheelTime&&this.lastMouseWheelTime>Date.now()-100||((!this.mouseWheelSpeed||this.lastMouseWheelTime<Date.now()-500||e*this.mouseWheelSpeed<0)&&(this.mouseWheelSpeed=0),Math.abs(e)<65&&this.lastMouseWheelTime&&this.lastMouseWheelTime>Date.now()-2e3||(this.mouseWheelSpeed+=cleverapps.styles.ScrollHandler.mouseWheelAcceleration*Math.sign(e),Math.abs(this.mouseWheelSpeed)>cleverapps.styles.ScrollHandler.mouseWheelMaxSpeed&&(this.mouseWheelSpeed=Math.sign(this.mouseWheelSpeed)*cleverapps.styles.ScrollHandler.mouseWheelMaxSpeed),Math.abs(this.mouseWheelSpeed)<cleverapps.styles.ScrollHandler.mouseWheelMinSpeed&&(this.mouseWheelSpeed=Math.sign(this.mouseWheelSpeed
)*cleverapps.styles.ScrollHandler.mouseWheelMinSpeed),this.startInertialScroll(cc.p(0,this.mouseWheelSpeed)),this.lastMouseWheelTime=Date.now()))}},cleverapps.UI.ScrollHandler.prototype.enableTouchScroll=function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this),onTouchCancelled:this.onTouchEnded.bind(this)},this.target)},cleverapps.UI.ScrollHandler.prototype.onTouchBegan=function(e){if(!this.target.touchScrollDisabled&&this.target.isDisplayed()&&cc.rectContainsPoint(cc.rect(0,0,this.target.width,this.target.height),this.target.convertTouchToNodeSpace(e)))return this.handlePress(),!0},cleverapps.UI.ScrollHandler.prototype.onTouchMoved=function(e){this.handleMove(this.getTouchDelta(e))},cleverapps.UI.ScrollHandler.prototype.onTouchEnded=function(e){this.handleRelease(this.getTouchDelta(e))},
cleverapps.UI.ScrollHandler.prototype.getTouchDelta=function(e){var t=this.target.convertToNodeSpace(e.getLocation()),i=this.target.convertToNodeSpace(e.getPreviousLocation()),s=cc.pSub(i,t);return 0==(this.target.dir&cleverapps.UI.ScrollView.DIR_HORIZONTAL)&&(s.x=0),0==(this.target.dir&cleverapps.UI.ScrollView.DIR_VERTICAL)&&(s.y=0),s},cleverapps.UI.ScrollHandler.prototype.initAutoScrollParams=function(){this._outOfBoundaryAmountDirty=!0,this._outOfBoundaryAmount=cc.p(0,0)},cleverapps.UI.ScrollHandler.prototype.afterContainerMove=function(){this._outOfBoundaryAmountDirty=!0,this.target.barHandler&&this.target.barHandler.updatePos(),this.bounceEnabled&&!this.inTouch&&this.startBounceBackIfNeeded()},cleverapps.UI.ScrollHandler.prototype.startBounceBackIfNeeded=function(){if(!this.bounceEnabled)return!1;var e=this.getHowMuchOutOfBoundary();if(this.fltEqualZero(e))return!1;return this.startAutoScroll(e,1),!0},cleverapps.UI.ScrollHandler.prototype.handlePress=function(){this.inTouch=!0,
this._autoScrolling=!1,this._touchMovePreviousTimestamp=(new Date).getTime(),this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this.target.barHandler&&this.target.barHandler.onTouchBegan()},cleverapps.UI.ScrollHandler.prototype.handleMove=function(e){if(this.bounceEnabled){var t=this.getHowMuchOutOfBoundary(e);e.x*=0===t.x?1:.5,e.y*=0===t.y?1:.5}else{t=this.getHowMuchOutOfBoundary(e);e.x+=t.x,e.y+=t.y}this.gatherMoveData(e);var i=cc.pAdd(this.target.getContainerPosition(),e);this.moveContainer(i)},cleverapps.UI.ScrollHandler.prototype.gatherMoveData=function(e){for(;5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.splice(0,1),this._touchMoveTimeDeltas.splice(0,1);this._touchMoveDisplacements.push(e);var t=(new Date).getTime();this._touchMoveTimeDeltas.push((t-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=t},cleverapps.UI.ScrollHandler.prototype.handleRelease=function(e){if(this.inTouch=!1,this.gatherMoveData(e),
!this.startBounceBackIfNeeded()){var t=this.calcTouchVelocity();0===t.x&&0===t.y||this.startInertialScroll(t)}this.target.barHandler&&this.target.barHandler.onTouchEnded()},cleverapps.UI.ScrollHandler.prototype.processAutoScroll=function(e){if(this._autoScrolling&&!this.inTouch){var t=this.isNecessaryAutoScrollBrake()?.05:1;this._autoScrollAccumulatedTime+=e*(1/t);var i=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(i=(i-=1)*i*i*i*i+1),Math.abs(i-1)<=1e-4&&(i=1,this._autoScrolling=!1);var s=cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,i));s=cc.pAdd(this._autoScrollBrakingStartPosition,cc.pMult(cc.pSub(s,this._autoScrollBrakingStartPosition),t)),this.moveContainer(s)}},cleverapps.UI.ScrollHandler.prototype.moveContainer=function(e){this.target.scrollToPoint(e),this.afterContainerMove()},cleverapps.UI.ScrollHandler.prototype.isOutOfBoundary=function(){var e=this.getHowMuchOutOfBoundary()
;return!this.fltEqualZero(e)},cleverapps.UI.ScrollHandler.prototype.calcTouchVelocity=function(){var e=this._touchMoveTimeDeltas.reduce(function(e,t){return e+t},0);if(0===e||e>=this._touchTotalTimeThreshold)return cc.p(0,0);var t=cc.p(0,0);return this._touchMoveDisplacements.forEach(function(e){t.x+=e.x,t.y+=e.y}),cc.pMult(t,1/e)},cleverapps.UI.ScrollHandler.prototype.isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this.isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.target.getContainerPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},cleverapps.UI.ScrollHandler.prototype.startInertialScroll=function(e){var t=cc.pMult(e,.7),i=this.calculateAutoScrollTimeByInitialSpeed(cc.pLength(e));this.startAutoScroll(t,i)},cleverapps.UI.ScrollHandler.prototype.calculateAutoScrollTimeByInitialSpeed=function(e){
return Math.sqrt(Math.sqrt(e/5))},cleverapps.UI.ScrollHandler.prototype.fltEqualZero=function(e){return Math.abs(e.x)<=1e-4&&Math.abs(e.y)<=1e-4},cleverapps.UI.ScrollHandler.prototype.startAutoScroll=function(e,t){this._autoScrolling=!0,this._autoScrollTargetDelta=e,this._autoScrollAttenuate=!0,this._autoScrollStartPosition=this.target.getContainerPosition(),this._autoScrollTotalTime=t,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0);var i=this.getHowMuchOutOfBoundary();if(!this.fltEqualZero(i)){this._autoScrollCurrentlyOutOfBoundary=!0;var s=this.getHowMuchOutOfBoundary(e);(0<i.x*s.x||0<i.y*s.y)&&(this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.target.getContainerPosition())}},cleverapps.UI.ScrollHandler.prototype.stopAutoScroll=function(){this._autoScrolling=!1},cleverapps.UI.ScrollHandler.prototype.getHowMuchOutOfBoundary=function(e){if(void 0===e&&(e=cc.p(0,0)),
0===e.x&&0===e.y&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var t=cc.p(0,0),i=this.target.getContainerPosition();return i.x+e.x>this.target.max.x?t.x=this.target.max.x-(i.x+e.x):i.x+e.x<this.target.min.x&&(t.x=this.target.min.x-(i.x+e.x)),i.y+e.y<this.target.min.y?t.y=this.target.min.y-(i.y+e.y):i.y+e.y>this.target.max.y&&(t.y=this.target.max.y-(i.y+e.y)),0===e.x&&0===e.y&&(this._outOfBoundaryAmount=t,this._outOfBoundaryAmountDirty=!1),t},cleverapps.styles.ScrollHandler={mouseWheelAcceleration:200,mouseWheelMinSpeed:500,mouseWheelMaxSpeed:2e3},cleverapps.UI.MapScrollHandler=function(e,t){t=t||{},this.target=e,this.bounceEnabled=!1,this.initAutoScrollParams()},cleverapps.UI.MapScrollHandler.prototype.initAutoScrollParams=function(){this._outOfBoundaryAmountDirty=!0,this._outOfBoundaryAmount=cc.p(0,0)},cleverapps.UI.MapScrollHandler.prototype.afterContainerMove=function(){this._outOfBoundaryAmountDirty=!0},
cleverapps.UI.MapScrollHandler.prototype.handlePress=function(){this._autoScrolling=!1,this._touchMovePreviousTimestamp=(new Date).getTime(),this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[]},cleverapps.UI.MapScrollHandler.prototype.gatherMoveData=function(e){var t=this.getHowMuchOutOfBoundary(e);for(e.x+=t.x,e.y+=t.y;5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.splice(0,1),this._touchMoveTimeDeltas.splice(0,1);this._touchMoveDisplacements.push(e);var i=(new Date).getTime();this._touchMoveTimeDeltas.push((i-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=i},cleverapps.UI.MapScrollHandler.prototype.handleRelease=function(e){this.gatherMoveData(e);var t=this.calcTouchVelocity();0===t.x&&0===t.y||this.startInertialScroll(t)},cleverapps.UI.MapScrollHandler.prototype.processAutoScroll=function(e){if(this._autoScrolling){var t=this.isNecessaryAutoScrollBrake()?.05:1;this._autoScrollAccumulatedTime+=e*(1/t);var i=Math.min(1,
this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(i=(i-=1)*i*i*i*i+1);var s=cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,i)),n=Math.abs(i-1)<=1e-4,o=cc.pSub(s,this.target.getContainerPosition()),a=this.getHowMuchOutOfBoundary(o);this.fltEqualZero(a)||(s.x+=a.x,s.y+=a.y,n=!0),n&&(this._autoScrolling=!1),this.target.moveContainer(cc.pSub(s,this.target.getContainerPosition()))}},cleverapps.UI.MapScrollHandler.prototype.isOutOfBoundary=function(){var e=this.getHowMuchOutOfBoundary();return!this.fltEqualZero(e)},cleverapps.UI.MapScrollHandler.prototype.calcTouchVelocity=function(){var e=this._touchMoveTimeDeltas.reduce(function(e,t){return e+t},0);if(0===e||e>=this._touchTotalTimeThreshold)return cc.p(0,0);var t=cc.p(0,0);return this._touchMoveDisplacements.forEach(function(e){t.x+=e.x,t.y+=e.y}),cc.pMult(t,1/e)},cleverapps.UI.MapScrollHandler.prototype.isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking
)return!0;if(this.isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContainerPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},cleverapps.UI.MapScrollHandler.prototype.startInertialScroll=function(e){var t=cc.pMult(e,.7),i=this.calculateAutoScrollTimeByInitialSpeed(cc.pLength(e));this.startAutoScroll(t,i,!0)},cleverapps.UI.MapScrollHandler.prototype.calculateAutoScrollTimeByInitialSpeed=function(e){return Math.sqrt(Math.sqrt(e/5))},cleverapps.UI.MapScrollHandler.prototype.fltEqualZero=function(e){return Math.abs(e.x)<=1e-4&&Math.abs(e.y)<=1e-4},cleverapps.UI.MapScrollHandler.prototype.startAutoScroll=function(e,t){this._autoScrolling=!0,this._autoScrollTargetDelta=e,this._autoScrollAttenuate=!0,this._autoScrollStartPosition=this.target.getContainerPosition(),this._autoScrollTotalTime=t,this._autoScrollAccumulatedTime=0,
this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0);var i=this.getHowMuchOutOfBoundary();if(!this.fltEqualZero(i)){this._autoScrollCurrentlyOutOfBoundary=!0;var s=this.getHowMuchOutOfBoundary(e);(0<i.x*s.x||0<i.y*s.y)&&(this._autoScrollBraking=!0)}},cleverapps.UI.MapScrollHandler.prototype.stopAutoScroll=function(){this._autoScrolling=!1},cleverapps.UI.MapScrollHandler.prototype.getHowMuchOutOfBoundary=function(e){if(void 0===e&&(e=cc.p(0,0)),0===e.x&&0===e.y&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var t=cc.p(0,0),i=this.target.container.getBoundingBox();return 0<i.x+e.x?t.x=-(i.x+e.x):i.width+i.x+e.x<this.target.width&&(t.x=this.target.width-(i.width+i.x+e.x)),i.height+i.y+e.y<this.target.height?t.y=this.target.height-(i.height+i.y+e.y):0<i.y+e.y&&(t.y=-(i.y+e.y)),0===e.x&&0===e.y&&(this._outOfBoundaryAmount=t,this._outOfBoundaryAmountDirty=!1),t},cleverapps.UI.Button=cc.Node.extend({ctor:function(o){this._super(),this.setAnchorPoint2(),
this.settings=o;var e=cleverapps.styles.UI.Button;this.bright=!0,this.createBackground(),o.disabled&&this.disable();var a=o.contentOffset&&void 0!==o.contentOffset.x?o.contentOffset.x:e.contentOffset.x,r=o.contentOffset&&void 0!==o.contentOffset.y?o.contentOffset.y:e.contentOffset.y,l=void 0!==o.contentPadding?o.contentPadding:e.contentPadding;if(o.content)["content","contentOff"].forEach(function(e,t){if(o[e]){o[e].setPositionRound(this.width/2+a,this.height/2+r),o[e].setAnchorPoint2(),this[e]=o[e],this.addChild(this[e]),0<t&&this[e].setOpacity(0);var i=o[e],s=.8*this.width-l;if(!1!==o.fitTo)if(i.fitTo)i.fitTo(s);else{var n=s/i.width;n<1&&i.setScale(n)}}},this);else if(o.text){var t=this.text=cleverapps.UI.generateTTFText(o.text,o.font||cleverapps.styles.FONTS.BUTTON_TEXT),i=t.width;o.padding&&(i+=2*o.padding.x),i>o.maxWidth&&(i=o.maxWidth),i>this.width&&this.resize(i,this.height);var s=Math.min(i,.8*this.width);o.padding&&(s-=2*o.padding.x),t.fitTo(s),t.setPositionRound(
this.width/2+a,this.height/2+r),this.addChild(t)}o.onMouseOver&&(this.onMouseOver=o.onMouseOver),o.onMouseOut&&(this.onMouseOut=o.onMouseOut),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,this.action.bind(this),{clickThrottle:o.clickThrottle,noThrottle:o.noThrottle,swallowTouches:o.swallowTouches,ignoreOnTouchMoved:o.ignoreOnTouchMoved})},showAlert:function(){!this.disabled&&this.settings.spine&&this.settings.button_alert_animation&&(this.alert=!0,this.background.setAnimation(0,this.settings.button_alert_animation,!0))},hideAlert:function(){this.settings.spine&&(this.alert=!1,this._innerUpdateBgContent())},showHint:function(e){setTimeout(function(){!this.disabled&&this.isDisplayed()&&!this.hint&&this.mouseOver&&(this.hint=new cleverapps.UI.Tooltip(this.background,{text:e,size:cleverapps.styles.UI.Button.tooltipSize}),this.addChild(this.hint),this.hint.setPositionRound(cleverapps.styles.UI.Tooltip.LOCATION.above),this.hint.replaceParentSamePlace(cc.director.getRunningScene()
))}.bind(this),1e3)},hideHint:function(){this.hint&&(this.hint.removeFromParent(),this.hint=void 0)},createBackground:function(){var e,t;this.settings.noBg?this.setContentSize2(this.settings.width,this.settings.height):(this.settings.spine?(e=this.settings.width,t=this.settings.height,this.background=new cleverapps.Spine(this.settings.spine),this.settings.skin&&this.background.setSkin(this.settings.skin),this.background.setAnimation(0,this.settings.button_animation,!0)):(this.button_png=new cc.Sprite(this.settings.button_png||bundles.buttons.frames.window_button_png).getSpriteFrame(),this.button_on_png=new cc.Sprite(this.settings.button_on_png||bundles.buttons.frames.window_button_on_png).getSpriteFrame(),this.button_off_png=new cc.Sprite(this.settings.button_off_png||bundles.buttons.frames.window_button_disabled_png).getSpriteFrame(),this.background=new cc.Scale9Sprite(this.button_png),e=this.settings.width||this.background.width,t=this.settings.height||this.background.height),
this.addChild(this.background),this.resize(e,t))},setBackgroundImage:function(e){this.button_png=new cc.Sprite(e).getSpriteFrame(),this._innerUpdateBgContent()},setBackgroundImagePressed:function(e){this.button_on_png=new cc.Sprite(e).getSpriteFrame(),this._innerUpdateBgContent()},resize:function(e,t){var i=cleverapps.styles.UI.Button;if(this.setContentSize2(e,t),!this.settings.spine)if(i.scaleYOnly&&!1!==this.settings.scale){var s=t/this.background.height;s<1&&(s=1),this.background.width=e/s,this.background.setScale(s)}else this.background.setContentSize2(e,t);this.background.setPositionRound(this.width/2,this.height/2)},onTouchBegan:function(){this.disabled||(this.settings.spine?this.settings.button_on_animation&&this.background.setAnimation(0,this.settings.button_on_animation,!0):this.background&&this.background.setSpriteFrame(this.button_on_png))},onTouchEnded:function(){this.disabled||this._innerUpdateBgContent()},action:function(){this.disabled||this._isAncestorsVisible(this)&&(
cleverapps.audio.playSound(this.settings.click_effect||bundles.main.urls.click_effect),this.settings.onClicked())},setBright:function(e){this.bright=e,this._innerUpdateBgContent()},disable:function(){this.disabled||(this.disabled=!0,this._innerUpdateBgContent(),this.tmpOnMouseOver=this.onMouseOver,this.onMouseOver=function(){},this.tmpOnMouseOut=this.onMouseOut,this.onMouseOut=function(){})},enable:function(){this.disabled&&(this.disabled=!1,this._innerUpdateBgContent(),this.tmpOnMouseOver&&(this.onMouseOver=this.tmpOnMouseOver,this.tmpOnMouseOver=void 0),this.tmpOnMouseOut&&(this.onMouseOut=this.tmpOnMouseOut,this.tmpOnMouseOut=void 0))},_innerUpdateBgContent:function(){var e=this.bright&&!this.disabled;this.settings.spine?this.alert?this.background.setAnimation(0,this.settings.button_alert_animation,!0):this.background.setAnimation(0,this.settings.button_off_animation&&!e?this.settings.button_off_animation:this.settings.button_animation,!0):(
this.background&&this.background.setSpriteFrame(e?this.button_png:this.button_off_png),this.content&&this.contentOff&&(e?(this.content.setOpacity(255),this.contentOff.setOpacity(0)):(this.content.setOpacity(0),this.contentOff.setOpacity(255))))},_isAncestorsVisible:function(e){if(null==e)return!0;var t=e.getParent();return!(t&&!t.isVisible())&&this._isAncestorsVisible(t)}}),cleverapps.styles.UI.Button={contentPadding:15,contentOffset:{x:0,y:0},tooltipSize:{width:180,height:80}},cleverapps.UI.StateButton=cc.Node.extend({ctor:function(e){this._super(),this.buttonLabelStyles=[cleverapps.styles.FONTS.SWITCH_BUTTON_OFF,cleverapps.styles.FONTS.SWITCH_BUTTON_ON];var t=new cc.Sprite(bundles.switch_state_button.frames.switch_state_button),i=new cc.Sprite(bundles.switch_state_button.frames.switch_state_2_button||bundles.switch_state_button.frames.switch_state_button);bundles.switch_state_button.frames.switch_state_2_button||(i.setScaleX(-1),this.buttonLabelStyles.reverse()),this.setContentSize2(
t.width,t.height),this.setAnchorPoint2(),this.onClick=e.onClick,this.fitTo=(e.fitTo||.4)*this.width,this.state=0,this.states=[t,i],i.visible=!1,this.states.forEach(function(e){e.setPosition(this.width/2,this.height/2),this.addChild(e)},this);var n=cleverapps.styles.UI.StateButton;this.labels=[e.off,e.on].map(function(e,t){var i=new cleverapps.UI.generateTTFText(e,this.buttonLabelStyles[t]);i.setPositionRound(0===t?n.offText:n.onText),i.fitTo(this.fitTo);var s=new cc.Node;return s.setContentSize2(this.width/2,this.height),s.setAnchorPoint2(),s.setPosition(0===t?this.width/4:this.width/4*3,this.height/2),this.addChild(s),s.addChild(i),i},this),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,this.action.bind(this))},setState:function(e){this.state!==e&&(this.states[this.state].visible=!1,this.labels[this.state].setFont(this.buttonLabelStyles[1]),this.labels[this.state].fitTo(this.fitTo),this.state=e,this.states[this.state].visible=!0,this.labels[this.state].setFont(
this.buttonLabelStyles[0]),this.labels[this.state].fitTo(this.fitTo))},action:function(){cleverapps.audio.playSound(bundles.main.urls.click_effect),this.setState(0===this.state?1:0),this.onClick(this.state)}}),cleverapps.overrideColors(cleverapps.styles.COLORS,{COLOR_SWITCH_BUTTON_OFF:new cc.Color(85,93,70,255)}),cleverapps.styles.FONTS=cleverapps.overrideFonts(cleverapps.styles.FONTS,{SWITCH_BUTTON_ON:{size:38,color:cleverapps.styles.COLORS.WHITE},SWITCH_BUTTON_OFF:{size:24,color:cleverapps.styles.COLORS.COLOR_SWITCH_BUTTON_OFF}}),cleverapps.styles.UI.StateButton={onText:{x:{align:"center",dx:-8},y:{align:"center",dy:0}},offText:{x:{align:"center",dx:8},y:{align:"center",dy:0}}},cleverapps.Layout=cc.Node.extend({ctor:function(e,t){this._super(),this.options=t,e.forEach(function(e){this.addChild(t.each?e.applyStyles(t.each):e)},this),this.reshape()},reshape:function(){return cleverapps.UI.arrangeWithMargins(this.children,this.options),cleverapps.UI.wrap(this,this.options),
this.options.padding&&cleverapps.UI.wrapWithPadding(this,this.options.padding,!0),this}}),cleverapps.Layout.AsyncChild=cc.Node.extend({ctor:function(){this._super(),this.setAnchorPoint2()}}),cleverapps.Layout.AsyncChild.prototype.reshape=function(e){this.setContentSize2(e.width*e.scaleX,e.height*e.scaleY),this.addChild(e),e.setPositionRound(this.width/2,this.height/2),this.alignment&&this.setPositionRound(this.alignment),this.parent&&this.parent.reshape&&this.parent.reshape()},cleverapps.Shaders={GRAYSCALE_SPRITE_KEY:"grayscaleSprite",FLICKER_SHADER_KEY:"flicker",BLUR_FADE_KEY:"blur_fade",BLUR_CURTAIN_KEY:"blur_curtain",BLUR_CURTAIN_REVERSE_KEY:"blur_curtain_reverse",VERTEX_SRC:"  attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",
GRAYSCALE_SRC:"varying vec2 v_texCoord;\nvarying vec4 v_fragmentColor; \nvoid main(){vec4 col = texture2D(CC_Texture0, v_texCoord);\nfloat gray = dot(col.rgb, vec3(0.25, 0.25, 0.25));\ngl_FragColor = v_fragmentColor * vec4(gray, gray, gray, col.a);\n}\n",FLICKER_FRAGM:"precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform float sineTime; \nuniform vec3 flickColor; \nvoid main() \n{ \n    vec4 c = texture2D(CC_Texture0, v_texCoord); \n    vec3 deltacolor = c.rgb * flickColor * sineTime;\n    vec3 color = clamp(c.rgb + deltacolor, 0.0, 1.0);\n    gl_FragColor = v_fragmentColor * vec4(color, c.a); \n}",
BLUR_TEMPLATE:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nuniform float u_blurOffset;\nuniform float u_extent;\nuniform float u_blurStrength;\n#define MAX_BLUR_WIDTH 4\nbool skipPixel(float y)\n{\n   %{skipFunction}}\nvoid main()\n{\n    vec2 u_blurOffset1 = vec2(0.0, float(u_blurOffset));\n    vec2 u_blurOffset2 = vec2(float(u_blurOffset), 0.0);\n    vec2 u_blurOffset3 = vec2(float(u_blurOffset) * sqrt(2.0), float(u_blurOffset) * sqrt(2.0));\n    vec2 u_blurOffset4 = vec2(float(u_blurOffset) * sqrt(2.0), -float(u_blurOffset) * sqrt(2.0));\n    vec4 color = texture2D(CC_Texture0, v_texCoord);\n    if (skipPixel(v_texCoord.y)) {\n       gl_FragColor = color;\n    } else {\n       float blurWidth = u_blurStrength * float(MAX_BLUR_WIDTH);\n       vec4 blurColor  = vec4(color.rgb, 1.0);\n       for (int i = 1; i < MAX_BLUR_WIDTH; ++ i)\n       {\n           if ( float(i) >= blurWidth ) break;           float weight = 1.0 - float(i) / blurWidth;\n           weight = weight * weight * (3.0 - 2.0 * weight); // smoothstep\n           vec4 sampleColor1 = texture2D(CC_Texture0, v_texCoord + u_blurOffset1 * float(i));\n           vec4 sampleColor2 = texture2D(CC_Texture0, v_texCoord - u_blurOffset1 * float(i));\n           vec4 sampleColor3 = texture2D(CC_Texture0, v_texCoord + u_blurOffset2 * float(i));\n           vec4 sampleColor4 = texture2D(CC_Texture0, v_texCoord - u_blurOffset2 * float(i));\n           vec4 sampleColor5 = texture2D(CC_Texture0, v_texCoord + u_blurOffset3 * float(i));\n           vec4 sampleColor6 = texture2D(CC_Texture0, v_texCoord - u_blurOffset3 * float(i));\n           vec4 sampleColor7 = texture2D(CC_Texture0, v_texCoord + u_blurOffset4 * float(i));\n           vec4 sampleColor8 = texture2D(CC_Texture0, v_texCoord - u_blurOffset4 * float(i));\n           blurColor += vec4(sampleColor1.rgb + sampleColor2.rgb + sampleColor3.rgb + sampleColor4.rgb + sampleColor5.rgb + sampleColor6.rgb + sampleColor7.rgb + sampleColor8.rgb, 8.0) * weight; \n       }\n       gl_FragColor = vec4(blurColor.rgb / blurColor.w, color.a);\n    }\n}",
BLUR_FADE_FRAGM:"",BLUR_CURTAIN_FRAGM:"",BLUR_CURTAIN_REVERSE_FRAGM:"",BLUR_FADE_SKIP:"   return false;\n",BLUR_CURTAIN_SKIP:"   return y > u_extent;\n",BLUR_CURTAIN_REVERSE_SKIP:"   return y < (1. - u_extent);\n",initialize:function(){if("undefined"!=typeof gl){var e=function(t,e,i){try{var s=new cc.GLProgram;s.initWithString(e,i),s.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),s.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),s.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),s.link(),s.updateUniforms(),cc.shaderCache.addProgram(s,t)}catch(e){cleverapps.Shaders[t]=void 0,console.log(e)}};e(cleverapps.Shaders.GRAYSCALE_SPRITE_KEY,cleverapps.Shaders.VERTEX_SRC,cleverapps.Shaders.GRAYSCALE_SRC),e(cleverapps.Shaders.FLICKER_SHADER_KEY,cleverapps.Shaders.VERTEX_SRC,cleverapps.Shaders.FLICKER_FRAGM),cleverapps.Shaders.BLUR_FADE_FRAGM=cleverapps.Shaders.BLUR_TEMPLATE.replace("%{skipFunction}",cleverapps.Shaders.BLUR_FADE_SKIP),
cleverapps.Shaders.BLUR_CURTAIN_FRAGM=cleverapps.Shaders.BLUR_TEMPLATE.replace("%{skipFunction}",cleverapps.Shaders.BLUR_CURTAIN_SKIP),cleverapps.Shaders.BLUR_CURTAIN_REVERSE_FRAGM=cleverapps.Shaders.BLUR_TEMPLATE.replace("%{skipFunction}",cleverapps.Shaders.BLUR_CURTAIN_REVERSE_SKIP),e(cleverapps.Shaders.BLUR_FADE_KEY,cleverapps.Shaders.VERTEX_SRC,cleverapps.Shaders.BLUR_FADE_FRAGM),e(cleverapps.Shaders.BLUR_CURTAIN_KEY,cleverapps.Shaders.VERTEX_SRC,cleverapps.Shaders.BLUR_CURTAIN_FRAGM),e(cleverapps.Shaders.BLUR_CURTAIN_REVERSE_KEY,cleverapps.Shaders.VERTEX_SRC,cleverapps.Shaders.BLUR_CURTAIN_REVERSE_FRAGM)}}},cleverapps.UI.Avatar=cc.Node.extend({ctor:function(e,t){var i=e;e&&(e.avatar||e.id)&&(i=e.avatar,t=e.id),this._super();var s=t===levels.user.id,n=new cc.Sprite(s?res.user_avatar:res.default_avatar);this.addChild(n),this.avatar=n;var o=e&&e.frame;o||(o=s?bundles.avatar.frames.avatar_frame2:bundles.avatar.frames.avatar_frame);var a=new cc.Sprite(o);a.setLocalZOrder(1),
this.addChild(a);var r=cleverapps.styles.UI.Avatar;this.setAnchorPoint(.5,.5),this.setContentSize2(a.getContentSize()),n.setPositionRound(this.width/2,this.height/2+(r.bottom-r.top)/2),a.setPositionRound(this.width/2,this.height/2),this.adjustSize(),(this.image=i)&&"string"==typeof i&&cleverapps.social.isLoggedIn()&&t&&0<=i.indexOf("fbsbx.com")&&(cleverapps.social instanceof cleverapps.MobileFacebook||cleverapps.social instanceof cleverapps.Html5)&&(this.avatarFBUserId=t,this.onImageLoadErrorSafe=this.createListener(this.onImageLoadError.bind(this))),this.onImageLoadSafe=this.createListener(this.onImageLoad.bind(this))},onImageLoadError:function(){cleverapps.social.aboutUser(this.avatarFBUserId,this.createListener(this.onFBUserLoaded.bind(this)))},onFBUserLoaded:function(e){if(e&&e.picture&&e.picture.data&&e.picture.data.url){this.image=e.picture.data.url,this.onImageLoadErrorSafe=void 0,this.setImage(this.image);var t={avatar:this.image};cleverapps.RestClient.post(
"/info/"+this.avatarFBUserId,t,function(e){},function(){console.log("Failed updating user avatar: "+t.avatar)})}},onEnter:function(){if(this._super(),this.image){var t=!0;["stub_128x128.gif","camera_200.png"].forEach(function(e){"string"==typeof this.image&&-1!==this.image.indexOf(e)&&(t=!1)}.bind(this)),t&&this.setImage(this.image)}},adjustSize:function(){this.avatar.setScale((this.width-2*cleverapps.styles.UI.Avatar.x)/this.avatar.width,(this.height-cleverapps.styles.UI.Avatar.top-cleverapps.styles.UI.Avatar.bottom)/this.avatar.height)},onImageLoad:cleverapps.whenShow(function(e,t){if(e)this.onImageLoadErrorSafe&&this.onImageLoadErrorSafe(),console.log("Error loading avatar image!");else try{var i=new cc.Sprite(t);i.setPositionRound(this.width/2,this.height/2),this.avatar.removeFromParent(),this.addChild(i),this.avatar=i,this.adjustSize()}catch(e){console.log("Cross-domain??",e)}}),loadGif:function(n){if(cc.sys.isNative||(n=n.replace("https:","").replace("http:","")),
n!==this.imageUrl){this.imageUrl=n;try{var o=new SuperGif;o.load_url(n,this.createListener(function(){if(n===this.imageUrl){var e=o.getFrames();if(Array.isArray(e)&&0<e.length){var t=new cc.Sprite(e[0]);t.setPositionRound(this.width/2,this.height/2),this.avatar.removeFromParent(),this.addChild(t),this.avatar=t,this.adjustSize();var i=[];e.forEach(function(e){i.push(new cc.Sprite(e).getSpriteFrame())});var s=new cc.Animation(i,.075);this.avatar.runAction(new cc.RepeatForever(cc.animate(s)))}}}.bind(this)))}catch(e){n===this.imageUrl&&delete this.imageUrl,console.log("Cross-domain??",e),this.onImageLoadErrorSafe&&this.onImageLoadErrorSafe()}}},getImageSpriteFrame:function(e){if(0===e.indexOf("#"))return cc.spriteFrameCache.getSpriteFrame(e)||cc.spriteFrameCache.getSpriteFrame(e.replace(/\//g,"-"))||cc.spriteFrameCache.getSpriteFrame(e.replace(/\//g,"-").replace("#","#main-"))},setImage:cleverapps.whenShow(function(i){if(i instanceof cc.SpriteFrame)this.avatar.setSpriteFrame(i),
this.adjustSize();else if(0===i.indexOf("#")&&this.getImageSpriteFrame(i))this.avatar.setSpriteFrame(this.getImageSpriteFrame(i)),this.adjustSize();else if(-1!==i.indexOf(".gif"))this.loadGif(i);else{var e=cleverapps.UI.Avatar.cache.get(i);if(e)return void this.onImageLoadSafe(0,e);var s=cleverapps.environment.onShowCounter;cc.loader.loadImg(i,cleverapps.whenShow(function(e,t){if(s!==cleverapps.environment.onShowCounter&&cc.sys.isNative)return cc.textureCache.removeTextureForKey(i),void this.setImage(i);this.onImageLoadSafe(e,t)}.bind(this)))}})}),cleverapps.UI.Avatar.cache=new cleverapps.Cache,cleverapps.UI.Avatar.preload=function(i,s){if(s=s||function(){},Array.isArray(i)){var t=cleverapps.wait(i.length,s);i.forEach(function(e){cleverapps.UI.Avatar.preload(e.avatar||e,t)})}else if("string"==typeof i&&0!==i.indexOf("#")&&-1===i.indexOf(".gif")){var e=cleverapps.UI.Avatar.cache.get(i);e?s(e):cc.loader.loadImg(i,function(e,t){e||cleverapps.UI.Avatar.cache.set(i,t),s(!e&&t)})}else s()},
cleverapps.Parallax={apply:function(e){e.scene&&(e=e.scene),e.parallaxContainer=new cc.Node,e.parallaxContainer.setAnchorPoint(.5,.5),e.parallaxContainer.setLocalZOrder(cleverapps.styles.parallax.zOrder),e.addChild(e.parallaxContainer),e._parallaxContainerPosition={x:0,y:0},this.isAvailable()&&(cc.sys.isNative||(cc.sys.BROWSER_TYPE_MOBILE_QQ=cc.sys.browserType),cleverapps.Parallax.onChangeSize(e),cleverapps.Parallax.refresh=cleverapps.Parallax._refresh.bind(e),cleverapps.Parallax.setEnabled=cleverapps.Parallax._changeEnabled.bind(e),e._parallaxEnabled=!0,cc.inputManager.setAccelerometerInterval(1/60),cc.inputManager.setAccelerometerEnabled(!0),cc.eventManager.addListener({event:cc.EventListener.ACCELERATION,callback:cleverapps.Parallax._handleOrientation.bind(e)},e))},isAvailable:function(){return cc.sys.isMobile&&cc.sys.capabilities.hasOwnProperty("accelerometer")&&"board"===!cleverapps.config.type},onChangeSize:function(e){if(e.scene&&(e=e.scene),this.isAvailable(
)&&e.parallaxContainer){var t=(cleverapps.styles.SCENE_HEIGHT+2*cleverapps.styles.parallax.height)/cleverapps.styles.SCENE_HEIGHT;e.width+2*cleverapps.styles.parallax.width>cleverapps.styles.SQUARE_MODE_WIDTH&&(t=Math.max(t,(cleverapps.styles.SQUARE_MODE_WIDTH+2*cleverapps.styles.parallax.width)/cleverapps.styles.SQUARE_MODE_WIDTH)),e.parallaxContainer.setScale(t),e._parallaxContainerPosition={x:(e.width-e.width*t)/2,y:(e.height-e.height*t)/2},e.parallaxContainer.setPosition(e._parallaxContainerPosition)}},setEnabled:function(){},refresh:function(){},_changeEnabled:function(e){e||this.parallaxContainer.stopAllActions(),e!==this._parallaxEnabled&&(this._parallaxEnabled=e,this._parallaxEnabled&&cleverapps.Parallax.refresh())},_refresh:function(){this._parallaxEnabled&&(delete this._parallaxBaseAngle,delete this._parallaxDx,delete this._parallaxDy,this._parallaxEnabled=!1,this.parallaxContainer.stopAllActions(),this.parallaxContainer.runAction(new cc.Sequence(new cc.MoveTo(.3,
this._parallaxContainerPosition),new cc.CallFunc(function(){this._parallaxEnabled=!0}.bind(this)))))},_handleOrientation:function(e){if(this._parallaxEnabled&&!(Math.abs(e.x)<1e-4&&Math.abs(e.y)<1e-4)){var t=90*e.x,i=90*e.y;this._parallaxBaseAngle||(this._parallaxBaseAngle={x:t,y:i},this._parallaxDx=t,this._parallaxDy=i),this._parallaxDx=.1*t+.9*this._parallaxDx,this._parallaxDy=.1*i+.9*this._parallaxDy,t=this._parallaxDx-this._parallaxBaseAngle.x,i=this._parallaxDy-this._parallaxBaseAngle.y,Math.abs(t)<cleverapps.Parallax.PARALLAX_MAX_ANGLE&&(this.parallaxContainer.x=this._parallaxContainerPosition.x+t*cleverapps.styles.parallax.width/cleverapps.Parallax.PARALLAX_MAX_ANGLE),Math.abs(i)<cleverapps.Parallax.PARALLAX_MAX_ANGLE&&(this.parallaxContainer.y=this._parallaxContainerPosition.y+i*cleverapps.styles.parallax.height/cleverapps.Parallax.PARALLAX_MAX_ANGLE)}},PARALLAX_MAX_ANGLE:30},cleverapps.styles.parallax={width:40,height:40,zOrder:0},cleverapps.FixedWidthScene=cc.Scene.extend({
ctor:function(e){cleverapps.wideMode=new cleverapps.WideMode,this.onChangeSizeListeners={},this._super(),cleverapps.environment.setScene(e);var t=cc.director.getWinSize();this.setContentSize(t),this.scene=new cc.Node,this.scene.resizeScale=1,this.scene.sceneName=e,this.scene.setPositionRound(this.width/2,this.height/2),this.scene.setAnchorPoint(.5,.5),this.scene.setContentSize2(cleverapps.UI.getSceneSize());var i=new ShadowView(cleverapps.windows,this);i.setPosition(0,-cleverapps.UI.getSceneOffsetY()),this.scene.addChild(i,20),this.addChild(this.scene),cleverapps.Parallax.apply(this),this.backgroundStyles=this.getBackgroundStyles(),this.setBackground(),this.ctorCustomize(),this.needDisplayIntro=!0;var s=this.scene.width;if(!SceneControlButtonsView.needToAddInsidePanel()){var n=this.upMenuButtons=new SceneControlButtonsView;n.deltaY=cleverapps.UI.getSceneOffsetY()-cleverapps.styles.MenuBar.minOffest,n.deltaY<0&&(n.deltaY=0),n.alignment=cleverapps.clone(n.alignment,!0),
n.alignment.y.dy+=n.deltaY,this.scene.addChild(n),s-=this.scene.width-n.x+n.width/2}this.upMenuBar=new MenuBarView(s,this.scene),cleverapps.windows.reset();var o=this.getAudioStyles();this.runAction(new cc.Sequence(new cc.DelayTime(o.delay||0),new cc.CallFunc(function(){cleverapps.audio.insertDisk(o.res)}))),this.currentOrientation=this.calcOrientation()},calcOrientation:function(){return cc.sys.isNative||void 0===typeof window?0:window.innerHeight<window.innerWidth?0:1},getAudioStyles:function(){return cleverapps.styles.FixedWidthScene.sound},_playIntro:function(){this.needDisplayIntro=!1,cleverapps.metha.display({focus:"Scene.intro",action:this.displayIntro.bind(this)})},displayIntro:function(e){e()},getBackgroundStyles:function(){return cleverapps.skins.getSlot("sceneBg")||cleverapps.styles.FixedWidthScene.background},setBackground:function(){var e=this.backgroundStyles;if(e)if(e.pattern){var t=cc.director.getWinSize();t.height+=2,(s=this.background=new cc.Node).setAnchorPoint(.5,.5
),s.setPosition(t.width/2,t.height/2-cleverapps.UI.getSceneOffsetY()),s.setContentSize(t);var i=cleverapps.UI.createPatternSprite(e.background||e.pattern,t);s.addChild(i),s.setLocalZOrder(-10),this.updateBackgroundScale(),this.scene.addChild(s)}else{var s=this.background=new cc.Sprite(e.background);if(e.animation){var n=new cleverapps.Spine(e.animation);n.setAnimation(0,"animation",!0),e.skin&&n.setSkin(e.skin),n.setPositionRound(s.width/2,s.height/2),s.addChild(n)}s.setPosition(this.scene.width/2,this.scene.height/2),this.updateBackgroundScale();var o=this.scene.parallaxContainer;!1===e.parallax?(o=this.scene,s.setLocalZOrder(-10)):o.setLocalZOrder(-10),o.addChild(s)}},getRefreshSceneActionOnChangeSize:function(){return!1},onChangeSize:function(e){var t=this.calcOrientation();if(t!==this.currentOrientation||e){this.currentOrientation=t;var i=this.getRefreshSceneActionOnChangeSize();if(i)return void(cleverapps.metha.isFocused()?cleverapps.FixedWidthScene.canDistractChangeSize?(
cleverapps.FixedWidthScene.canDistractChangeSize=!1,cleverapps.metha.distract({focus:"refreshSceneOnChangeSize"+Date.now(),action:i})):cleverapps.FixedWidthScene.changedOrientation=!0:(cleverapps.FixedWidthScene.canDistractChangeSize=!1,cleverapps.metha.display({focus:"refreshSceneOnChangeSize"+Date.now(),action:i})))}cleverapps.metha.isFocused()&&!cleverapps.FixedWidthScene.canDistractChangeSize&&(cleverapps.FixedWidthScene.changedSize=!0),this.setContentSize(cc.view.getDesignResolutionSize()),this.setContentSize2(this.getContentSize()),this.scene.resizeScale=Math.min(1,this.getContentSize().width/this.scene.width),this.scene.setScale(this.scene.resizeScale),this.scene.setPositionRound(this.width/2,this.height/2),this.updateBackgroundScale();var s,n=cleverapps.UI.getSceneOffsetY(),o=n-cleverapps.styles.MenuBar.minOffest;for(var a in o<0&&(o=0),this.upMenuBar&&(s=o-this.upMenuBar.deltaY,this.upMenuBar.y+=s,this.upMenuBar.hideHandler&&(this.upMenuBar.hideHandler.originalPosition.y+=s,
this.upMenuBar.hideHandler.hidePosition.y+=s),this.upMenuBar.deltaY=o),this.upMenuButtons&&(s=o-this.upMenuButtons.deltaY,this.upMenuButtons.y+=s,this.upMenuButtons.hideHandler&&(this.upMenuButtons.hideHandler.originalPosition.y+=s,this.upMenuButtons.hideHandler.hidePosition.y+=s),this.upMenuButtons.deltaY=o),this.downToolBar&&(s=n-this.downToolBar.deltaY,this.downToolBar.y-=s,this.downToolBar.hideHandler&&(this.downToolBar.hideHandler.originalPosition.y-=s,this.downToolBar.hideHandler.hidePosition.y-=s),this.downToolBar.deltaY=n),cleverapps.Notification.remove(!0),this.onChangeSizeListeners)this.onChangeSizeListeners[a]()},updateBackgroundScale:function(){if(this.background){var e=this.backgroundStyles;if("number"==typeof e.scale)this.background.setScale(e.scale);else{var t=this.bgScaleMargin||1,i=Math.max(this.width/this.background.width*t/this.scene.scale,this.height/this.background.height*t/this.scene.scale);this.background.setScale(i),this.background.stopAllActions()}}},
onExit:function(){this._super(),cleverapps.bundleLoader.clearUnusedResources()},onEnter:function(){this._super(),cc.sys.garbageCollect()},onTransitionAnimationDidStart:function(){cleverapps.audio.fadeOut()},closeAction:function(){cleverapps.metha.display({focus:"closeScene",action:function(e){cleverapps.metha.gotoMainScene(e)}})}}),cleverapps.FixedWidthScene.prototype.createFilmEffect=function(e){(e=e||{}).layerSizeKoef=void 0!==e.layerSizeKoef?e.layerSizeKoef:.1,e.layerTimeout=e.layerTimeout||.3,e.onComplete=e.onComplete||function(){},this.scene.stopAllActions(),this.scene.basePosition=this.scene.getPosition();var t={x:this.scene.basePosition.x,y:this.scene.basePosition.y};if(e.scale=e.scale||1.3,this.upperFilmLayer=new cc.LayerColor(cc.color.BLACK,this.scene.width,this.scene.height*e.layerSizeKoef+(e.layerSizeKoef?3:0)),this.downFilmLayer=new cc.LayerColor(cc.color.BLACK,this.scene.width,this.scene.height*e.layerSizeKoef+(e.layerSizeKoef?3:0)),e.moveBy&&(e.moveBy.x&&(t.x+=e.moveBy.x)
,e.moveBy.y)){if(e.moveBy.y<0){var i=this.upperFilmLayer.height+this.scene.height*(e.scale-1)/2;e.moveBy.y<-i&&(e.moveBy.y=-i)}else{i=this.downFilmLayer.height+this.scene.height*(e.scale-1)/2;e.moveBy.y>i&&(e.moveBy.y=i)}t.y+=e.moveBy.y}this.upperFilmLayer.setPositionRound(0,this.height-this.upperFilmLayer.height+2),this.downFilmLayer.setPositionRound(0,-1),this.downFilmLayer.setLocalZOrder(50),this.upperFilmLayer.setLocalZOrder(50),this.addChild(this.upperFilmLayer),this.addChild(this.downFilmLayer),e.silent?(this.scene.setScale(e.scale),this.scene.setPositionRound(t),e.onComplete()):(e.scaleTimeout=e.scaleTimeout||1,this.upperFilmLayer.setOpacity(0),this.downFilmLayer.setOpacity(0),this.scene.runAction(new cc.Sequence(new cc.DelayTime(e.layerTimeout),new cc.Spawn(new cc.MoveTo(e.scaleTimeout,t),new cc.ScaleTo(e.scaleTimeout,e.scale)),new cc.CallFunc(e.onComplete))),this.upperFilmLayer.runAction(new cc.FadeTo(e.layerTimeout,255)),this.downFilmLayer.runAction(new cc.FadeTo(
e.layerTimeout,255))),e.noControls||(cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(){return!0},onTouchEnded:function(){return e.onClick&&e.onClick(),!0}},this.upperFilmLayer),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseScroll:function(e){return e&&e.stopPropagation&&e.stopPropagation(),!0},onMouseMove:function(e){return e&&e.stopPropagation&&e.stopPropagation(),!0}},this.upperFilmLayer))},cleverapps.FixedWidthScene.prototype.removeFilmEffect=function(e){var t;(e=e||{}).scaleTimeout=void 0===e.scaleTimeout?1:e.scaleTimeout,e.layerTimeout=e.layerTimeout||.3,this.scene.stopAllActions(),this.stopAllActions(),cc.audioEngine.stopAllEffects(),this.scene.runAction(new cc.Spawn(new cc.MoveTo(e.scaleTimeout,this.scene.basePosition),new cc.ScaleTo(e.scaleTimeout,1))),this.runAction(new cc.Sequence(new cc.DelayTime(e.scaleTimeout),new cc.CallFunc(function(){this.scene.setScale(1),this.scene.setPositionRound(
this.scene.basePosition),e.onComplete&&e.onComplete()}.bind(this)))),e.scaleLayerSameTime&&(e.layerTimeout=e.scaleTimeout,e.scaleTimeout=0),this.upperFilmLayer&&(this.upperFilmLayer.stopAllActions(),t=e.layerSlide?new cc.MoveBy(e.layerTimeout,{x:0,y:this.upperFilmLayer.height}):new cc.FadeTo(e.layerTimeout,0),this.upperFilmLayer.runAction(new cc.Sequence(new cc.DelayTime(e.scaleTimeout),t,new cc.RemoveSelf)),this.upperFilmLayer=void 0),this.downFilmLayer&&(this.downFilmLayer.stopAllActions(),t=e.layerSlide?new cc.MoveBy(e.layerTimeout,{x:0,y:-this.downFilmLayer.height}):new cc.FadeTo(e.layerTimeout,0),this.downFilmLayer.runAction(new cc.Sequence(new cc.DelayTime(e.scaleTimeout),t,new cc.RemoveSelf)),this.downFilmLayer=void 0)};var SceneProxy=function(e,t,arguments){this.superClass=e,this.self=t,this.arguments=arguments,this.instance=void 0,this.callbacks=[]};SceneProxy.prototype.instantiate=function(){var e=cc.Node.superClassCreateFunction(this.superClass);this.instance=e.apply(
this.self,this.arguments),this.instance.sceneBundles=this.sceneBundles,this.onLoad()},SceneProxy.prototype.onLoad=function(){this.callbacks.forEach(function(e){e(this.instance)},this),this.callbacks=[]},SceneProxy.prototype.whenLoaded=function(e){this.instance?e(this.instance):this.callbacks.push(e)},cleverapps.FixedWidthScene.superExtend=cleverapps.FixedWidthScene.extend,cleverapps.FixedWidthScene.extend=function(){var n=cleverapps.FixedWidthScene.superExtend.apply(this,arguments),o=function(){cleverapps.eventManager.setCurrentFeatures(),cleverapps.skins.update();var e=new SceneProxy(n,this,arguments);e.sceneBundles=cleverapps.bundleLoader.getClassBundles(o,this,arguments).filter(function(e){return bundles[e]}),cleverapps.config.debugMode&&e.sceneBundles.push("dev_resources");var t=!1,i=!1;this.onSuccess=function(){t&&e.instantiate(),i=!0},cleverapps.bundleLoader.loadBundles(e.sceneBundles,{onSuccess:this.onSuccess.bind(this),onFailure:function(){new RestartWindow}})
;var s=cc.director.getRunningScene();return s&&s.sceneBundles&&(cleverapps.bundleLoader.deleteBundles(s.sceneBundles),delete s.sceneBundles),cc.pool.drainAllPools(),t=!0,i?(e.instantiate(),e.instance):e};return o.DebugConstructor=n,o.prototype=n.prototype,o.extend=cleverapps.FixedWidthScene.extend,o},cleverapps.FixedWidthScene.prototype.ctorCustomize=function(){},cleverapps.styles.FixedWidthScene={background:!1,sound:{res:bundles.main.urls.background_music_map,delay:.5}};var Windows=function(){this.list=[],this.bundles=0,this.onHideShadow=function(e){},this.onShowShadow=function(e){},this.onOpenListeners={},this.onCloseListeners={},this.onAllClosed=[],this.onceNoWindowsListener=void 0};Windows.prototype.isActive=function(){return 0<this.list.length||0<this.bundles},Windows.prototype.reset=function(){this.list=[],this.onAllClosed=[],this.bundles=0,this.onHideShadow()},Windows.prototype.currentWindow=function(){if(0!==this.list.length)return this.list[this.list.length-1]},
Windows.prototype.add=function(e){if(cleverapps.metha.isFocused()||-1!==["promptwindow"].indexOf(e.name)||cleverapps.metha.debugMessage("Trying to show window without user focus!"),e instanceof WaitWindow)e.displaySelf();else{if(0<this.list.length){var t=this.list[this.list.length-1];e.windowForce?(t.originalZOrder=t.getLocalZOrder(),t.setLocalZOrder(19)):(t.setVisible(!1),this.onHideShadow(),t.initializedSuccess&&t.onHide())}if(this.list.push(e),this.showWindow(),1===this.list.length&&!(this.list[0]instanceof Force))for(var i in this.onOpenListeners)this.onOpenListeners[i]()}},Windows.prototype.showWindow=function(){var e=this.currentWindow();e&&e.displaySelf()},Windows.prototype.whenAllClosed=function(e){cleverapps.windows.isActive()?cleverapps.windows.onAllClosed.push(e):e()},Windows.prototype.notifyMetha=function(){if(!this.isActive()&&cleverapps.metha.onceNoWindowsListener){var e=cleverapps.metha.onceNoWindowsListener;cleverapps.metha.onceNoWindowsListener=void 0,e()}},
Windows.prototype.closeCallback=function(e){for(cleverapps.environment&&cleverapps.environment.onCloseWindow(e.name),e.closeAnimationCallbacks&&(e.closeAnimationCallbacks.forEach(function(e){e()}),e.closeAnimationCallbacks=[]),e.shareCheckBox&&e.shareCheckBox.onWindowClose(),e.removeFromParent();!this.isActive()&&0<this.onAllClosed.length;){this.onAllClosed.shift()()}setTimeout(this.notifyMetha.bind(this),0)},Windows.prototype.remove=function(e){if(!e.closed){e.closed=!0;var t=e===this.currentWindow();this.delete(e,t),e.onClose&&e.onClose(),t?e.closeAnimation(this.closeCallback.bind(this,e)):this.closeCallback(e)}},Windows.prototype.delete=function(e,t){var i=this.list.indexOf(e);if(-1!==i&&this.list.splice(i,1),t)if(0===this.list.length){this.onHideShadow(),cleverapps.Parallax.setEnabled(!0);var s=cc.director.getRunningScene();s&&s.onShow&&s.onShow(),setTimeout(function(){0===this.list.length&&cleverapps.values(this.onCloseListeners).forEach(cleverapps.callFunc)}.bind(this),
e.closeDuration())}else if(e.windowForce){var n=this.list[this.list.length-1];n.setLocalZOrder(n.originalZOrder)}else this.showWindow()};var ShadowView=cc.Node.extend({ctor:function(e,t){this._super(),this.shadow=cleverapps.UI.addShadowLayer("windowShadow",t),this.addChild(this.shadow),this.shadow.visible=!1,this.show=!1,e.onHideShadow=this.createListener(this.deleteShadow.bind(this)),e.onShowShadow=this.createListener(this.createShadow.bind(this))}});ShadowView.prototype.createShadow=function(e){if(!this.show){this.show=!0,this.shadow.stopAllActions(),this.shadow.visible=!0,e.color&&this.shadow.setColor(e.color);var t=cleverapps.styles.ShadowView;this.shadow.runAction(new cc.FadeTo(t.duration,e.opacity||t.opacity))}},ShadowView.prototype.deleteShadow=function(){if(this.show){this.show=!1,this.shadow.stopAllActions();var e=cleverapps.styles.ShadowView;this.shadow.runAction(new cc.Sequence(new cc.FadeTo(e.duration,0),new cc.CallFunc(function(){this.shadow.visible=!1}.bind(this))))}},
cleverapps.styles.ShadowView={duration:.3,opacity:110};var BaseWindow=cc.Node.extend({listBundles:function(){return[]},ctor:function(e){if(!cleverapps.environment.isEditorScene()||this.editorWindow){this._super(),this.isBundlesLoaded=!1;var t=arguments;e=e||{};var i=cc.director.getRunningScene(),s=i.width,n=i.height;if(e.parentScene||i.windowsContainer||(i=i.scene),this.setScale(1/i.getScale()),this.setContentSize(s,n),this.setPositionRound((i.width*i.getScale()-s)/2,(i.height*i.getScale()-n)/2),this.setLocalZOrder(21),i.addChild(this),cleverapps.windows.add(this),this.applyTouch(),this.bundles=this.listBundles.apply(this,arguments)||[],cleverapps.skins.getBundle()&&this.bundles.push(cleverapps.skins.getBundle()),this.bundles.push("windows"),this.bundles=cleverapps.unique(this.bundles),this.bundles=this.bundles.filter(function(e){return bundles[e]}),0!==this.bundles.length){this.showLoading();var o=[this.createListener(function(){this.hideLoading(),this.runWindow(t)}.bind(this)),
this.createListener(function(){this.deleteSelf(),new RestartWindow}.bind(this))];Array.prototype.push.apply(o,arguments),this.load.apply(this,o)}else this.runWindow(t)}},load:function(e,t,i){cleverapps.bundleLoader.loadBundles(this.bundles,{onSuccess:e,onFailure:t})},applyTouch:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchStart.bind(this),onTouchEnded:this.onTouchEnd.bind(this)},this),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:function(e){return!!this.isVisible()&&(e&&e.stopPropagation&&e.stopPropagation(),!0)}.bind(this),onMouseScroll:function(e){return!!this.isVisible()&&(e&&e.stopPropagation&&e.stopPropagation(),!0)}.bind(this)},this)},showLoading:function(){var e=this.loading=WaitWindow.prototype.showLoading.call(this,"messages:Loading");e.setPositionRound(this.width/2,this.height/2),this.addChild(e),e.visible=!1,e.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.CallFunc(
function(){e.visible=!0})))},hideLoading:function(){this.loading&&(this.loading.removeFromParent(),delete this.loading)},hasAppeared:function(){return this.isBundlesLoaded},runWindow:function(e){this.isBundlesLoaded=!0,this.onWindowLoaded.apply(this,e),this.initializedSuccess?this.displaySelf():this.deleteSelf()},displaySelf:function(){this.hasAppeared()&&cleverapps.windows.currentWindow()===this&&(this.setVisible(!0),this.styles.shadow&&cleverapps.windows.onShowShadow(this.styles.shadow),this.popUpAnimation(),this.onShow(),cleverapps.environment&&cleverapps.environment.onOpenWindow(this.name))},deleteSelf:function(){var e=this===cleverapps.windows.currentWindow();cleverapps.windows.delete(this,e),this.removeFromParent()},close:function(){!0===this.closed&&cleverapps.ReportStream.send("doubleclose","Closing already closed window: "+this.name+" "+JSON.stringify((new Error).stack)),this.isBundlesLoaded&&!this.closed&&(cleverapps.bundleLoader.deleteBundles(this.bundles),
cleverapps.windows.remove(this))}}),Window=BaseWindow.extend({addBottomButtons:function(e,t){var i=this.buttons=new Buttons(e);this.window.addChild(i);var s=(n=this.styles.BottomButton||cleverapps.styles.Window.BottomButton).bottomPadding;if(t&&(s+=t),i.setPositionRound(this.window.width/2,i.height/2+s),this.shareCheckBox){var n=cleverapps.styles.Window.ShareCheckBox;this.shareCheckBox.setPositionRound(this.window.width/2,i.y+i.height/2+this.shareCheckBox.height/2+n.offsetBottom)}},onWindowLoaded:function(e){this.initializedSuccess=!0,cleverapps.Parallax.setEnabled(!1);var t=this.styles=e.styles||cleverapps.styles.Window;this.name=e&&e.name||e&&e.title||"window",this.onClose=e&&e.onClose||this.onClose;var i=e.content;if(i){this.customizeContent();var s=i.getContentSize(),n=[];if(e.button){var o=this.button=new BottomButton(this,e.button);if(n.push(o),e.button.hasPrice){var a=new CoinsPriceView(cleverapps.Bet.REGEN_AMOUNT,{bg:bundles.main.frames.price_substrate_png});a.setPositionRound(
this.styles.BottomButton.price),s.height+=this.styles.BottomButton.price.height;var r=this.styles.BottomButton.price.offset;o.addChild(a)}}e.buttons&&(n=n.concat(e.buttons)),this.withBg=!e.noBackground&&!t.noBackground,!e.shareCheckBox||cleverapps.flags.noviral||cleverapps.flags.noshares||(this.createShareCheckBox(n,e.shareCheckBox),s.height+=this.getShareCheckBoxHeight());var l=this.calcBackgroundSize(s,e),c=cc.size(l.width,l.height),p=cleverapps.UI.getSceneSize();c.width+2*t.Background.paddingX>p.width&&(c.width=p.width-2*t.Background.paddingX),this.windowScale=Math.min(c.width/l.width,c.height/l.height),t.noWindowScale&&(this.windowScale=1),this.withBg?this.window=this.createBackground(l,t,e):(this.window=new cc.Node,this.window.setContentSize2(l),this.window.setAnchorPoint2(.5,.5),this.addChild(this.window)),this.window.setScale(this.windowScale);var d=cleverapps.skins.getSlot("windowDecors",{decors:t.decors,window:this,level:e.level});d&&(this.decors=new Decors(this,d))
;var h=t.bgOffset?t.bgOffset.x:0,u=t.bgOffset?t.bgOffset.y:0;this.window.setPositionRound(this.width/2+h,this.height/2+u),this.window.basePosition=this.window.getPosition(),this.withBg&&this.createInnerBackground(),!1!==e.closeButton&&!1!==t.closeButton&&(this.withBg&&!t.bandButton||t.regularCloseButton?this.createCloseButton():this.createCloseBandButton()),e.help&&this.createHelpButton(e.help),t.Title&&e.title&&(this.addTitle(e.title),t.Title.bg&&!e.noTitleBg&&this.addTitleBg(t.Title.bg));var v=t.contentOffset+this.getShareCheckBoxHeight()/2;i.setPositionRound(this.window.width/2,this.window.height/2+v),this.window.addChild(i),this.shareCheckBox&&(this.window.addChild(this.shareCheckBox),this.shareCheckBox.setPositionRound(this.window.width/2,this.shareCheckBox.height/2+t.ShareCheckBox.offsetBottom)),0<n.length&&this.addBottomButtons(n,r)}(!1!==e.closeButton||e.closeByBackButton)&&(this.closeByBackButton=this.close.bind(this));var g=this.onTouchInShadow;this.onTouchInShadow=function(
){},this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){g?this.onTouchInShadow=g:e.notCloseByTouchInShadow||(this.onTouchInShadow=this.close.bind(this))}.bind(this)))),this.closeAnimationCallbacks=[],this.customize(),this.checkFit(i)},addTitleBg:function(e){var t,i=cleverapps.skins.getSlot("windowTitle",{image:e.image});(t=!1===e.scale9?new cc.Sprite(i):cleverapps.UI.createScale9Sprite(i,e.scale9)).setLocalZOrder(e.zIndex),this.window.addChild(t),t.setPositionRound(e.x,e.y),this.titleBg=t,this.decors&&this.decors.initTitleDecorators(),this.updateTitleBg()},checkFit:function(e){var t=cleverapps.UI.getSceneSize(),i=t.width+cleverapps.styles.Window.checkFitThreshold;if(this.window&&this.window.width*this.window.scale>i){var s="Window width "+this.window.width+" scale "+this.window.scale+" windowScale "+this.windowScale+" is greater than scene width "+t.width;e&&(s+=", content width "+e.width+" scale "+e.scale),cleverapps.ErrorHandler.logError(s)}},
createCloseBandButton:function(){var e=new BandButton({onClicked:this.close.bind(this)});this.addChild(e),e.hide(!0),e.show(.2),this.closeButton=e},createCloseButton:function(){var e,t=this.styles.CloseButton;e=new cleverapps.UI.Button({button_png:bundles.main.frames.window_close_png,button_on_png:bundles.main.frames.window_close_on_png,onClicked:this.close.bind(this)}),this.styles.CloseButton.relativeToScene?(this.addChild(e),e.setPositionRound(this.styles.CloseButton.relativeToScene)):(this.window.addChild(e),e.setPositionRound(this.window.width-e.width/2+t.offsetX,this.window.height-e.height/2+t.offsetY)),e.setLocalZOrder(this.styles.CloseButton.zOrder),this.closeButton=e},createHelpButton:function(e){var t=this.styles.HelpButton,i=new cleverapps.UI.Button({button_png:res.help_button_png,button_on_png:res.help_button_on_png,onClicked:e});i.setPositionRound(t),i.setLocalZOrder(t.zOrder),this.helpButton=i,this.window.addChild(i)},createShareCheckBox:function(e,t){var i=!0;(
!cleverapps.social.isLoggedIn()||cleverapps.social instanceof cleverapps.Instant)&&(i=!1),e&&e.forEach(function(e){e instanceof ShareBonusButton&&e.shareBonus.type===cleverapps.ShareBonus.DIALOG&&(i=!1),e.doubleType===RewardWindow.DOUBLE_SHARE&&(i=!1)}),i&&(this.shareCheckBox=new ShareCheckBox(t,this))},getShareCheckBoxHeight:function(){return this.shareCheckBox?this.shareCheckBox.height+this.styles.ShareCheckBox.offsetBottom+this.styles.ShareCheckBox.offsetTop:0},onChangeBackground:function(e){this.decors&&this.decors.updateAll(),this.titleBg&&this.titleBg.setPositionRound(this.styles.Title.bg)},customizeContent:function(){},customize:function(){},onShow:function(){this.shareCheckBox&&this.shareCheckBox.updateState()},onHide:function(){},createBackground:function(e,t,i){var s;s=i.windowBg?i.windowBg:t.Background.image?res[t.Background.image]||t.Background.image:bundles.windows.frames.window_bg_png;var n=cleverapps.skins.getSlot("windowBg",{image:s,level:i.level}),
o=cleverapps.UI.createScale9Sprite(n,t.Background.scale9);return o.setContentSize2(e),t.Background.opacity&&o.setOpacity(t.Background.opacity),this.addChild(o),this.bg=o,t.Background.stitches&&new StitchesComponent(this.bg,t.Background.stitches),o},createInnerBackground:function(){if(this.styles.Background.inner){var e=this.innerBg=cleverapps.UI.createScale9Sprite(bundles.main.frames.window_inner_bg_png);e.setContentSize2(this.window.width-2*this.styles.Background.inner.padding.x,this.window.height-2*this.styles.Background.inner.padding.y),this.window.addChild(e),e.setPositionRound(this.styles.Background.inner)}},calcBackgroundSize:function(e,t){var i=!this.withBg&&!(this.styles.noBackground&&this.styles.noBackground.keepSize||t.noBackground&&t.noBackground.keepSize),s=e.width+(this.withBg?2*this.styles.Border.x:0),n=e.height+(i?0:2*this.styles.Border.y),o=void 0!==t.minHeight?t.minHeight:cleverapps.styles.Window.minHeight;n<o&&(n=o)
;var a=void 0!==t.minWidth?t.minWidth:cleverapps.styles.Window.minWidth;return s<a&&(s=a),cc.size(s,n)},onTouchStart:function(e){return!!this.isVisible()},onTouchEnd:function(e){if(this.initializedSuccess){if(this.window){var t=this.window.convertToNodeSpace(e.getLocation()),i=this.window.getContentSize();if(cc.rectContainsPoint(cc.rect(0,0,i.width,i.height),t))return}this.onTouchInShadow(e)}},addTitle:function(e){var t=e;e.text&&(t=e.text);var i=cleverapps.styles.FONTS.WINDOW_TITLE_TEXT;e.font&&(i=e.font);var s={};e.toReplace&&(s=e.toReplace);var n=this.styles.Title.offset||cleverapps.styles.Window.Title.offset;this.styles.Title.offsetY&&(n=this.styles.Title.offsetY),this.styles.Title.offsetMobileY&&cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(n=this.styles.Title.offsetMobileY),this.styles.useSceneOffset&&cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(n+=cleverapps.UI.getSceneOffsetY());var o=this.styles.Title.offsetX?this.styles.Title.offsetX:0,
a=cleverapps.UI.generateTTFText(t,i,s);a.setPositionRound(this.window.width/2-o,this.window.height-n),a.setAnchorPoint2(),a.setLocalZOrder(this.styles.Title.zIndex),this.window.titleText=a,this.window.addChild(a),this.setTitle(t,s)},setTitle:function(e,t){this.window.titleText&&(this.window.titleText.setString(e,t),!this.closeButton||this.closeButton instanceof BandButton?this.window.titleText.fitTo(this.window.width*this.styles.maxTitleSize.scale):this.window.titleText.fitTo(this.window.width-2*(this.closeButton.width+this.styles.titleCloseButtonMargin))),this.titleBg&&this.updateTitleBg()},updateTitleBg:function(){var e=this.styles.Title.bg;if(e.adjustToWindow){var t=this.window.width+e.adjustToWindow.width;!1===e.scale9?this.titleBg.setScale(t/this.titleBg.width):this.titleBg.setContentSize2(t,this.titleBg.getContentSize().height),!this.closeButton||this.closeButton instanceof BandButton||!e.adjustToWindow.closeButtonOffset||this.closeButton.setPositionRound(
this.titleBg.x+this.titleBg.width*this.titleBg.scaleX/2-this.closeButton.width/2+e.adjustToWindow.closeButtonOffset.x,this.titleBg.y+e.adjustToWindow.closeButtonOffset.y),this.helpButton&&e.adjustToWindow.helpButtonOffset&&this.helpButton.setPositionRound(this.titleBg.x-this.titleBg.width*this.titleBg.scaleX/2+this.helpButton.width/2+e.adjustToWindow.helpButtonOffset.x,this.titleBg.y+e.adjustToWindow.helpButtonOffset.y)}else if(e.adjustToText){this.titleBg.setContentSize(this.window.titleText.width+e.adjustToText.width,this.titleBg.height);var i=this.window.titleText.getPosition();e.adjustToText.offset&&(i.x+=e.adjustToText.offset.x,i.y+=e.adjustToText.offset.y),this.titleBg.setPositionRound(i),!this.closeButton||this.closeButton instanceof BandButton||!e.adjustToText.closeButtonOffset||this.closeButton.setPositionRound(this.titleBg.x+this.titleBg.width/2-this.closeButton.width/2+e.adjustToText.closeButtonOffset.x,this.titleBg.y+e.adjustToText.closeButtonOffset.y),
this.helpButton&&e.adjustToText.helpButtonOffset&&this.helpButton.setPositionRound(this.titleBg.x-this.titleBg.width/2+this.helpButton.width/2+e.adjustToText.helpButtonOffset.x,this.titleBg.y+e.adjustToText.helpButtonOffset.y)}else{t=this.window.titleText.getContentSize().width;t*=1.2;var s=this.styles.Title.bg.minWidth,n=this.styles.Title.bg.maxWidth;s&&t<s&&(t=s),n&&n<t&&(t=n),this.titleBg.scaleX=t/this.titleBg.width}this.decors&&this.decors.updateAll()}});cleverapps.styles.Window={shadow:!0,checkFitThreshold:10,maxTitleSize:{scale:.77},titleCloseButtonMargin:46,CloseButton:{offsetX:20,offsetY:20,zOrder:1},HelpButton:{zOrder:1,x:{align:"left",dx:70},y:{align:"top",dy:-45}},BottomButton:{width:void 0,height:void 0,bottomPadding:50,padding:{x:30},marginX:30,price:{x:{align:"center"},y:{align:"center",dy:-74},height:0,offset:26}},minHeight:200,minWidth:240,contentOffset:16,windowShowUpAnimation:{name:"default",force:!1},Background:{image:bundles.windows.frames.window_bg_png,
scale9:cleverapps.UI.Scale9Rect.Default,paddingX:15},Title:{offset:70,zIndex:2},Border:{x:75,y:150},ShareCheckBox:{offsetBottom:15,offsetTop:-20},closeAnimation:{duration:200}},Window.prototype.onPopUpAnimationFinished=function(){},Window.prototype.popUpAnimation=function(){var e=this.chooseAnimation();e?(this.window.stopAllActions(),e.open.call(this,this.onPopUpAnimationFinished.bind(this))):this.onPopUpAnimationFinished()},Window.prototype.closeAnimation=function(e){cleverapps.audio.playSound(res.close_window_effect||res.window_effect);var t=this.chooseAnimation();!t||0<cleverapps.windows.list.length&&!this.styles.windowShowUpAnimation.force?e():(this.window.stopAllActions(),cc.eventManager.removeListeners(this,!0),t.close.call(this,e))},Window.prototype.chooseAnimation=function(){var e=this.styles;if(e.windowShowUpAnimation&&this.window)return this.bg||e.windowShowUpAnimation.force?WINDOW_ANIMATIONS[e.windowShowUpAnimation.name]:WINDOW_ANIMATIONS.default},
Window.prototype.closeDuration=function(){return(this.styles||cleverapps.styles.Window).closeAnimation.duration},cleverapps.overrideFonts(cleverapps.styles.FONTS,{WINDOW_TITLE_TEXT:{size:70,color:cleverapps.styles.COLORS.COLOR_BROWN}});var BottomButton=cleverapps.UI.Button.extend({ctor:function(e,t){var i=cleverapps.styles.Window.BottomButton;t.onClicked=function(){!1!==e.visible?t.onPressed?t.onPressed():e.close():console.log("Blocked onClick as invisible")}.bind(this),t.font=t.font||cleverapps.styles.FONTS.BUTTON_TEXT,t.texType=t.hasOwnProperty("texType")?t.texType:i.texType,t.width=t.width||i.width,t.height=t.height||i.height,t.padding=t.padding||i.padding,this._super(t)}}),reportAboutNoWebGLThrottle=cleverapps.throttle(1e4,function(e){cleverapps.ReportStream.debug(["checkGLErrorDebug: afterCreateProgramObj ","isUndefined "+(void 0===e._programObj),"is WebGLProgram "+(e._programObj instanceof WebGLProgram)])});cc.checkGLErrorDebug=function(e,t){if(
cc._renderType===cc.game.RENDER_TYPE_WEBGL){var i=cc._renderContext.getError();i||"afterCreateProgramObj"!==t||e._programObj instanceof WebGLProgram||(reportAboutNoWebGLThrottle(e),i="notWebGLProgram"),i&&!cc.sys.isNative&&(alert("An error occurred"),window.location.reload())}};var checkBrokenLink=function(e,t){e||0===t.length||null===e||(console.log(t),cleverapps.throwAsync("broken frame: "+e))};if(cc.Scale9Sprite.prototype.scale9Ctor=cc.Scale9Sprite.prototype.ctor,cc.Scale9Sprite.prototype.ctor=function(e){checkBrokenLink(e,arguments),cc.Scale9Sprite.prototype.scale9Ctor.apply(this,arguments)},cc.Sprite.prototype.spriteCtor=cc.Sprite.prototype.ctor,cc.Sprite.prototype.ctor=function(e){checkBrokenLink(e,arguments),0<arguments.length&&"string"==typeof e&&(e=processVirtualFrame(e),this.spriteFrameName=e),cc.Sprite.prototype.spriteCtor.apply(this,arguments)},cc.Sprite.prototype._setSpriteFrame=cc.Sprite.prototype.setSpriteFrame,cc.Sprite.prototype.setSpriteFrame=function(e){
return checkBrokenLink(e,arguments),"string"==typeof(e=processVirtualFrame(e))&&0===e.indexOf("#")&&(e=e.substr(1,e.length-1)),this.spriteFrameName=e&&e.spriteFrameName||e,cc.Sprite.prototype._setSpriteFrame.call(this,e)},cc.Scale9Sprite.prototype._setSpriteFrame=cc.Scale9Sprite.prototype.setSpriteFrame,cc.Scale9Sprite.prototype.setSpriteFrame=function(e){return checkBrokenLink(e,arguments),this.spriteFrameName=e&&e.spriteFrameName||e,cc.Scale9Sprite.prototype._setSpriteFrame.call(this,e)},cc.spriteFrameCache._getSpriteFrame=cc.spriteFrameCache.getSpriteFrame,cc.spriteFrameCache.getSpriteFrame=function(e){"string"==typeof(e=processVirtualFrame(e))&&0===e.indexOf("#")&&(e=e.substr(1,e.length-1));var t=cc.spriteFrameCache._getSpriteFrame.call(this,e);return t&&(t.spriteFrameName=e),t},cleverapps.styles.FONTS.SYSTEM={type:{name:"Arial"},size:20,color:cleverapps.styles.COLORS.BLACK},cc.Node.prototype.replaceParent=function(e){this.removeFromParent(!1),e.addChild(this)},
cc.Node.prototype.replaceParentSamePlace=function(e,t){t&&t.keepScale&&this.setScale(this.scale*this.parent.scale*this.parent.parent.scale*this.parent.parent.parent.scale);var i=e.convertToNodeSpace(this.parent.convertToWorldSpace(this.getPosition()));this.removeFromParent(!1),e.addChild(this),this.setPosition(i)},cc.Node.prototype.debugGetName=function(){var i=this.constructor,s="[unknown]";return[window,cc,ccui,cleverapps,cleverapps.UI,sp,levels].forEach(function(e){for(var t in e)if(e[t]===i){s=t;break}}),s},cc.Node.prototype.debugParents=function(){for(var e=[],t=this;t;)e.push(t.debugGetName()),t=t.parent;console.log("window.debug -> "+e.join("->"))},cc.Node.prototype.debugBorder=function(t){if(window.debug=this,t=t||{},this.debugBorderDx=this.debugBorderDx||0,this.debugBorderDy=this.debugBorderDy||0,this.debugBorderKeyboardListener=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(e){if(-1!==[cc.KEY.up,cc.KEY.down,cc.KEY.right,cc.KEY.left].indexOf(e)
){switch(e){case cc.KEY.left:--this.x,--this.debugBorderDx;break;case cc.KEY.right:++this.x,++this.debugBorderDx;break;case cc.KEY.down:--this.y,--this.debugBorderDy;break;case cc.KEY.up:++this.y,++this.debugBorderDy}console.log("pos: "+this.x+" x "+this.y+"\toffset: "+this.debugBorderDx+" x "+this.debugBorderDy),n&&t.showPosition&&n.setString("pos: "+this.x+" x "+this.y+"\noffset: "+this.debugBorderDx+" x "+this.debugBorderDy)}}.bind(this)}),cc.eventManager.addListener(this.debugBorderKeyboardListener,this),!this.spriteSavedPtr){var e=cleverapps.UI.createScale9Sprite(bundles.dev_resources.frames.border,cleverapps.UI.Scale9Rect.TwoPixelY);e.setAnchorPoint2(0,0),e.setContentSize(this.getContentSize()),this.spriteSavedPtr=e;var i=[new cc.Color(255,0,0,255),new cc.Color(255,0,255,0),new cc.Color(255,255,0,0)];e.setColor(cleverapps.Random.choose(i,this.debugGetName().length)),this.addChild(e),e.setLocalZOrder(10)}if(!this.labelSavedPtr){var s
;s=t.labelText?t.labelText:t.showZOrder?this.getLocalZOrder():t.showPosition?"pos: "+this.x+" x "+this.y+"\noffset: "+this.debugBorderDx+" x "+this.debugBorderDy:this.getContentSize().width+" x "+this.getContentSize().height+" "+this.debugGetName();var n=cleverapps.UI.generateTTFText(s,cleverapps.styles.FONTS.SYSTEM,{});n.setAnchorPoint2(0,0),n.setPosition(0,this.getContentSize().height),this.labelSavedPtr=n,this.addChild(n),n.setLocalZOrder(10)}},cc.Node.prototype.cleanupBorder=function(){this.spriteSavedPtr&&(this.spriteSavedPtr.removeFromParent(),delete this.spriteSavedPtr),this.labelSavedPtr&&(this.labelSavedPtr.removeFromParent(),delete this.labelSavedPtr),cc.eventManager.removeListener(this.debugBorderKeyboardListener)},cc.Node.prototype.isRunningSafe=function(){return this.runningSafe&&this.isRunning()},cc.Node.listener=function(e){return function(){if(!this.stopListeners)return e.apply(this,arguments)}},cc.Node.prototype.createListener=function(e){return function(){if(
!this.stopListeners)return e.apply(this,arguments)}.bind(this)},cc.Node.prototype.hasTouch=function(e){if(!this.visible)return!1;var t=this.convertTouchToNodeSpace(e);return cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)},cc.Node.prototype.createListener_onExitTransitionDidStart=cc.Node.prototype.onExitTransitionDidStart,cc.Node.prototype.onExitTransitionDidStart=function(){this.stopListeners=!0,this.runningSafe=!1,this.createListener_onExitTransitionDidStart()},cc.Node.RegisterShowAffected=function(e){},cleverapps.config.debugMode&&!cc.sys.isNative){var showDrawCalls=void 0;cc.Node.prototype.showDrawCall=function(){void 0!==showDrawCalls&&((showDrawCalls[this.__instanceId]=this).numberOfDraw=cc.g_NumberOfDraws,this.drawStack=(new Error).stack)};var analyzeDrawCalls=function(){Object.values(showDrawCalls).sort(function(e,t){return e.numberOfDraw-t.numberOfDraw}).forEach(function(e){e.debugBorder({labelText:e.numberOfDraw});var t=e.numberOfDraw+" "+e.debugGetName()
;e instanceof cc.LabelTTF&&(t+=" "+e.getString()),"string"==typeof e.spriteFrameName&&(t+=" "+e.spriteFrameName),"string"==typeof e.jsonName&&(t+=" "+e.jsonName),"SkeletonAnimation"===e.debugGetName()&&(t+=" stack - "+e.drawStack),console.log(t)}),console.log(Object.keys(showDrawCalls).length+" draw calls"),console.log(cc.g_NumberOfVertexes+" vertexes")};cc.eventManager.addListener(cc.EventListener.create({event:cc.EventListener.KEYBOARD,isTextsVisible:!0,onKeyPressed:function(e){var t=cleverapps.keyboardController.isPressed(cc.KEY.ctrl);t&&e===cc.KEY.q?void 0===showDrawCalls?(showDrawCalls={},setTimeout(analyzeDrawCalls,100)):(Object.values(showDrawCalls).forEach(function(e){e.cleanupBorder()}),showDrawCalls=void 0):t&&e===cc.KEY.y&&(this.isTextsVisible?$(cc.LabelTTF).hide():$(cc.LabelTTF).show(),this.isTextsVisible=!this.isTextsVisible)}}),2);var matchedDebugNodes=[];cc.eventManager.addListener(cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,
processTouch:function(t){if(t&&t.visible&&!("undefined"!=typeof EditorScene&&t instanceof EditorScene)&&(t.hasTouch(this.touch)&&!this.excluded.some(function(e){return t instanceof e})&&(this.matchedNode=t),t.children))for(var e=0;e<t.children.length;e++)this.processTouch(t.children[e])},onTouchBegan:function(e){var t=cleverapps.keyboardController.isPressed(cc.KEY.ctrl),i=cleverapps.keyboardController.isPressed(cc.KEY.shift);return this.matchedNode=void 0,this.touch=e,this.excluded=[SideBarView,cleverapps.UI.ScrollView,cleverapps.UI.ScrollBarContainer],"undefined"!=typeof KeypadView&&this.excluded.push(KeypadView),(t||i)&&(t&&(matchedDebugNodes.forEach(function(e){e.cleanupBorder()}),matchedDebugNodes=[]),this.processTouch(cc.director.getRunningScene()),this.matchedNode)?(this.matchedNode.debugParents(),this.matchedNode.debugBorder({showPosition:!0}),matchedDebugNodes.push(this.matchedNode),!0):(matchedDebugNodes.length&&(matchedDebugNodes.forEach(function(e){e.cleanupBorder()}),
matchedDebugNodes=[]),!1)}}),-100)}cc.Node.prototype.createListener_onEnterTransitionDidFinish=cc.Node.prototype.onEnterTransitionDidFinish,cc.Node.prototype.onEnterTransitionDidFinish=function(){this.stopListeners=!1,this.runningSafe=!0,cc.Node.prototype.createListener_onEnterTransitionDidFinish.apply(this,arguments),cc.Node.RegisterShowAffected(this)},cc.Node.prototype.createListener_cleanup=cc.Node.prototype.cleanup,cc.Node.prototype.cleanup=function(){this.stopListeners=!0,this.runningSafe=!1,this.runCleanupCallbacks(),this.createListener_cleanup()},cc.Node.prototype.registerTarget=function(e,t){(e[t=t||"target"]=this).registerCleanupCallback(function(){this===e[t]&&delete e[t]}.bind(this))},cc.Node.prototype.registerCleanupCallback=function(e){this.cleanupCallbacks||(this.cleanupCallbacks=[]),this.cleanupCallbacks.push(e)},cc.Node.prototype.runCleanupCallbacks=function(){(this.cleanupCallbacks||[]).forEach(function(e){e()}),this.cleanupCallbacks=[]}
;var oldAddChild=cc.Node.prototype.addChild;cc.Node.prototype.addChild=function(e){oldAddChild.apply(this,arguments),e.alignment&&e.setPositionRound(e.alignment),e.hideHandler&&e.hideHandler.initialize()},cc.Node.prototype.setRecCascadeColorEnabled=function(){for(var e=[this];0<e.length;){var t=e.pop();t.setCascadeColorEnabled(!0),e=e.concat(t.children)}},cc.Node.prototype.setPositionRound=function(e,t){if(Array.isArray(e)&&(e=e[cleverapps.wideMode.mode]),void 0===t&&(t=e.y,e=e.x),"object"==typeof e||"object"==typeof t){if(!this.parent)return void(this.alignment={x:e,y:t});var i=this.parent.getContentSize();"object"==typeof e&&(e=this.calculateCoordinate(e,"x",i.width)),"object"==typeof t&&(t=this.calculateCoordinate(t,"y",i.height))}this.setPosition(Math.floor(e),Math.floor(t))},cc.Node.prototype.calculateCoordinate=function(t,e,i){if(t.random){var s=void 0!==t.random.start?t.random.start:0,n=void 0!==t.random.end?t.random.end:i;return Math.round(Math.random()*(n-s)+s)}
var o="x"===e?this.getAnchorPoint().x:this.getAnchorPoint().y,a="x"===e?"dx":"dy",r=0;Object.keys(t).forEach(function(e){0===e.indexOf(a)&&(r+=t[e])});var l="x"===e?this.width*Math.abs(this.scaleX):this.height*Math.abs(this.scaleY);switch(t.align||"center"){case"left":case"bottom":r+=Math.abs(o)<.1?0:Math.abs(o-1)<.1?l:l/2,"center"===t.anchor&&(r-=l/2);break;case"center":r+=i/2+(Math.abs(o)<.1?-l/2:Math.abs(o-1)<.1?l/2:0);break;case"right":case"top":r+=i+(Math.abs(o)<.1?-l:Math.abs(o-1)<.1?0:-l/2),"center"===t.anchor&&(r+=l/2)}return r},cc.Node.prototype.getRelativeCoordinates=function(e){var t=e.hideHandler&&e.hideHandler.originalPosition||e.originalPosition||e.getPosition();return this.getParent().convertToNodeSpace(e.getParent().convertToWorldSpace(t))},cc.Node.prototype.setAnchorPoint2=function(e,t){void 0===e&&(e=.5),void 0===t&&(t=.5),0<this.width&&(e=Math.round(this.width*e)/this.width),0<this.height&&(t=Math.round(this.height*t)/this.height),this.setAnchorPoint(e,t)},
cc.Node.prototype.setContentSize2=function(e,t){Array.isArray(e)&&(e=e[cleverapps.wideMode.mode]),void 0===t&&(t=e.height,e=e.width),this.setContentSize(2*Math.round(e/2),2*Math.round(t/2))},cc.Node.prototype.setScale2=function(e){Array.isArray(e)&&(e=e[cleverapps.wideMode.mode]),this.setScale(e)},cc.Node.prototype.isDisplayed=function(){for(var e=this;e;){if(!e.isVisible())return!1;e=e.getParent()}return!0},cc.Node.prototype.setVisibleAsync=function(e,t){"function"!=typeof(t=t||this).setVisible&&(t=this),this.runAction(new cc.CallFunc(function(){t.setVisible(e)}))},cc.Node.prototype.runAsync=function(e){this.runAction(new cc.CallFunc(e))},cc.Sprite.prototype.setSpriteFrameAsync=function(e){this.runAction(new cc.CallFunc(function(){this.setSpriteFrame(e)}.bind(this)))},cc.pRound=function(e,t){return void 0===t&&(t=e.y,e=e.x),"number"==typeof e&&(e=Math.floor(e)),"number"==typeof t&&(t=Math.floor(t)),cc.p(e,t)},cc.sizeRound=function(e,t){return void 0===t&&(t=e.height,e=e.width),
cc.size(e,t)},cc.size2=function(e,t){return void 0===t&&(t=e.height,e=e.width),cc.size(2*Math.round(e/2),2*Math.round(t/2))},cc.Node.prototype.applyStyles=function(e){var t=new cc.Node;return e.size&&t.setContentSize2(e.size),this.setPositionRound(t.width/2,t.height/2),t.addChild(this),t},cc.Node.superClassCreateFunction=function(t){function e(e){return t.apply(this,e)}return e.prototype=t.prototype,function(){return new e(arguments)}},cc.Node.prototype.getGlobalBoundingBox=function(e,t){if(!e){var i=this.scaleX,s=this.scaleY;this.scaleX=this.baseScaleX||this.baseScale||i,this.scaleY=this.baseScaleY||this.baseScale||s,e=this.getBoundingBox(),this.originalPosition&&(e.x+=this.originalPosition.x-this.x,e.y+=this.originalPosition.y-this.y),this.scaleX=i,this.scaleY=s}t=t||this.getParent();var n=cc.director.getRunningScene().scene.convertToNodeSpace(t.convertToWorldSpace(cc.p(e.x,e.y)));return e.x=n.x,e.y=n.y,e},cc.sys.isNative&&config.debugMode&&!cc.sys.isWebView&&(
Function.prototype.debugBindSuper=Function.prototype.bind,Function.prototype.bind=function(e){if("object"!=typeof this.prototype)throw console.log("Function.this.prototype - is not an object",JSON.stringify((new Error).stack)),new TypeError("Function.this.prototype - is not an object");return Function.prototype.debugBindSuper.apply(this,arguments)}),cc.CallFunc.prototype.initWithFunctionSuper=cc.CallFunc.prototype.initWithFunction,cc.CallFunc.prototype.initWithFunction=function(e,t,i){var s=this.initWithFunctionSuper.apply(this,arguments);return this._function&&!this._function.call&&cleverapps.throwAsync("no call method on CallFunc function"),s},cc.ACTION_TAG_SHOW=10,cc.ACTION_TAG_HIDE=11,cc.ACTION_TAG_PLAYERS_WARNING=13,cleverapps.Spine=cc.Node.extend({ctor:function(e,t){this._super(),this.setAnchorPoint2(),e=processVirtualJson(e),e=cleverapps.skins.getSlot("spine",{json:e});var i=cleverapps.Spine.jsonToBundle[e];if(cleverapps.bundleLoader.isLoaded(i
)||"loading_scene"===i||cleverapps.ReportStream.debug("Json "+e+" bundle "+i+" not loaded"),void 0===i)throw console.log("json bundles cache",cleverapps.Spine.jsonToBundle),"Can't find bundle for json - "+e+" in bundles cache "+JSON.stringify(Object.keys(cleverapps.Spine.jsonToBundle)).substr(0,100);cc.loader.getRes(bundles[i].jsons.atlas)||cleverapps.ReportStream.debug("Atlas "+e+" bundle "+i+" not loaded");var s=e,n=bundles[i].jsons.atlas;t=t||1,cleverapps.Spine.cache[e]&&cleverapps.Spine.cache[e][t]&&(s=cleverapps.Spine.cache[e][t].data,n=cleverapps.Spine.cache[e][t].atlas);var o=this.spine=sp.SkeletonAnimation.createWithJsonFile(s,n,t);for(var a in cleverapps.styles.SpineSkins)if(cleverapps.styles.SpineSkins[a].json===e){o.setSkin(cleverapps.styles.SpineSkins[a].skin);break}o.jsonName=e,cleverapps.Spine.cache[e]||(cleverapps.Spine.cache[e]={}),cleverapps.Spine.cache[e][t]||(cleverapps.Spine.cache[e][t]={data:o._skeletonData,atlas:!0});var r=cc.loader.getRes(e).skeleton
;this.setContentSize2(r.width*resolutionScale,r.height*resolutionScale),o.setPositionRound(this.width/2,this.height/2),this.addChild(o),this.runningAnimation=void 0,this.setVisible(!1),this.startVisibleListener=function(){},cleverapps.Spine.debugSlots&&this.setDebugSlots(!0),cleverapps.Spine.debugBones&&this.setDebugBones(!0)},setStartVisibleListener:function(e){this.startVisibleListener=e},setCompleteListenerRemove:function(e){this.setCompleteListener(function(){e&&e(),this.runAction(new cc.RemoveSelf)}.bind(this))},setIdle:function(e){this.idle=e,void 0===this.runningAnimation&&this.setAnimation(0,this.idle,!0)},setAnimation:function(e,t,i){this.spine.setAnimation(e,t,i);var s=this.spine.jsonName;if(!cc.loader.getRes(s).animations[t]){var n=(new Error).stack;setTimeout(function(){throw"Not found animation "+t+" in json "+s+" .. "+n},0)}this.visible||(this.visible=!0,this.startVisibleListener())},addAnimation:function(e,t,i,s){this.spine.addAnimation(e,t,i,s)},setTimeScale:function(e
){this.spine.setTimeScale(e)},getTimeScale:function(){return this.spine.getTimeScale()},clearTrack:function(e){this.spine.clearTrack(e)},setSkin:function(e){this.spine.setSkin(e)},setStartListener:function(e){this.spine.setStartListener(e)},setCompleteListener:function(e){this.spine.setCompleteListener(e)},setAnimationAndIdleAfter:function(e,t){this.setCompleteListener(function(){this.setAnimation(0,t,!0)}.bind(this)),this.setAnimation(0,e,!1)},setDebugSlots:function(e){this.spine.setDebugSolots(e)},setDebugBones:function(e){this.spine.setDebugBones(e)}}),cleverapps.Spine.updateSkin=function(e,t,i){cleverapps.styles.SpineSkins[e]={json:t,skin:i}},cleverapps.Spine.isAnimationLoaded=function(e){return e=cleverapps.skins.getSlot("spine",{json:e}),cleverapps.bundleLoader.isLoaded(cleverapps.Spine.jsonToBundle[e])},cleverapps.Spine.prepare=function(){var e={};for(var t in bundles){var i=bundles[t];if(!i.injectTo&&(0!==t.indexOf("episode_")||1!==Object.keys(i.jsons).length||!i.jsons.levels)
)for(var s in i.jsons){var n=i.jsons[s],o=t;if(0===s.indexOf("island_")&&0===t.indexOf("episode_")&&(o="episodes_resources"),e[n]&&e[n]!==o)throw"Already exist json: "+n;e[n]=o}}cleverapps.Spine.jsonToBundle=e},cleverapps.Spine.listBundles=function(t){Array.isArray(t)||(t=[t]);var i=[];return t.forEach(function(e){t&&cleverapps.Spine.jsonToBundle[e]&&i.push(cleverapps.Spine.jsonToBundle[e])}),cleverapps.unique(i)},cleverapps.Spine.removeSlot=function(e,t){e=processVirtualJson(e),e=cleverapps.skins.getSlot("spine",{json:e}),(e=cc.loader.getRes(e)).slots=e.slots.filter(function(e){return e.name!==t}),cleverapps.values(e.skins).forEach(function(e){delete e[t]}),cleverapps.values(e.animations).forEach(function(e){delete e.slots[t]})},cleverapps.Spine.cache={},cc.eventManager._sortEventListenersOfSceneGraphPriorityDes=function(e,t){var i=cc.eventManager._nodePriorityMap,s=e._getSceneGraphPriority(),n=t._getSceneGraphPriority();if(!(t&&n&&i[n.__instanceId]))return-1;if(
!e||!s||!i[s.__instanceId])return 1;var o=i[t._getSceneGraphPriority().__instanceId]-i[e._getSceneGraphPriority().__instanceId];return 0===o?e.__instanceId-t.__instanceId:o},cc.game.pause_super=cc.game.pause,cc.game.pause=function(){cc.game.pause_super.apply(this,arguments),cleverapps.values(cc.game.onPauseListeners).forEach(cleverapps.callFunc)},cc.game.resume_super=cc.game.resume,cc.game.resume=function(){cc.game.resume_super.apply(this,arguments),cleverapps.values(cc.game.onResumeListeners).forEach(cleverapps.callFunc)},cc.game.resumeNative=function(){this.config?this.isPaused()&&this.resume():setTimeout(this.resumeNative.bind(this),1e3)},cc.game.onPauseListeners={},cc.game.onResumeListeners={};var UIScrollBarFix=function(){var e=function(e,t){var i=new Image;i.src=e,setTimeout(function(){cc.textureCache.cacheImage(t,i)},0)};e(ccui.ScrollViewBar.HALF_CIRCLE_IMAGE,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY),e(ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT,
ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT_KEY)};cc.KEYBOARD_RETURNTYPE_DEFAULT=0,cc.KEYBOARD_RETURNTYPE_DONE=1,cc.KEYBOARD_RETURNTYPE_SEND=2,cc.KEYBOARD_RETURNTYPE_SEARCH=3,cc.KEYBOARD_RETURNTYPE_GO=4,cc.EDITBOX_INPUT_MODE_ANY=0,cc.EDITBOX_INPUT_MODE_EMAILADDR=1,cc.EDITBOX_INPUT_MODE_NUMERIC=2,cc.EDITBOX_INPUT_MODE_PHONENUMBER=3,cc.EDITBOX_INPUT_MODE_URL=4,cc.EDITBOX_INPUT_MODE_DECIMAL=5,cc.EDITBOX_INPUT_MODE_SINGLELINE=6,cc.EDITBOX_INPUT_FLAG_PASSWORD=0,cc.EDITBOX_INPUT_FLAG_SENSITIVE=1,cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD=2,cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE=3,cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS=4,cc.EditBoxDelegate=cc.Class.extend({editBoxEditingDidBegin:function(e){},editBoxEditingDidEnd:function(e){},editBoxTextChanged:function(e,t){},editBoxReturn:function(e){}}),cc.EditBox=cc.Node.extend({_backgroundSprite:null,_delegate:null,_editBoxInputMode:cc.EDITBOX_INPUT_MODE_ANY,_editBoxInputFlag:cc.EDITBOX_INPUT_FLAG_SENSITIVE,
_keyboardReturnType:cc.KEYBOARD_RETURNTYPE_DEFAULT,_maxLength:50,_text:"",_textColor:null,_placeholderText:"",_placeholderFontName:"",_placeholderFontSize:14,_placeholderColor:null,_className:"EditBox",_touchListener:null,_touchEnabled:!0,ctor:function(e,t){cc.Node.prototype.ctor.call(this),this._anchorPoint=cc.p(.5,.5),this._textColor=cc.color.WHITE,this._placeholderColor=cc.color.GRAY,this._renderCmd._createLabels(),this.createDomElementIfNeeded(),this.initWithSizeAndBackgroundSprite(e,t),this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan.bind(this),onTouchEnded:this._onTouchEnded.bind(this)}),cc.eventManager.addListener(this._touchListener,this),this.setInputFlag(this._editBoxInputFlag)},setTouchEnabled:function(e){this._touchEnabled!==e&&(this._touchEnabled=e,this._touchEnabled?cc.eventManager.addListener(this._touchListener,this):cc.eventManager.removeListener(this._touchListener))},
_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.EditBox.CanvasRenderCmd(this):new cc.EditBox.WebGLRenderCmd(this)},setContentSize:function(e,t){void 0!==e.width&&void 0!==e.height&&(t=e.height,e=e.width),cc.Node.prototype.setContentSize.call(this,e,t),this._updateEditBoxSize(e,t)},setVisible:function(e){cc.Node.prototype.setVisible.call(this,e),this._renderCmd.updateVisibility()},createDomElementIfNeeded:function(){this._renderCmd._edTxt||this._renderCmd._createDomTextArea()},setTabIndex:function(e){this._renderCmd._edTxt&&(this._renderCmd._edTxt.tabIndex=e)},getTabIndex:function(){return this._renderCmd._edTxt?this._renderCmd._edTxt.tabIndex:(cc.warn("The dom control is not created!"),-1)},setFocus:function(){this._renderCmd._edTxt&&this._renderCmd._edTxt.focus()},isFocused:function(){return this._renderCmd._edTxt?document.activeElement===this._renderCmd._edTxt:(cc.warn("The dom control is not created!"),!1)},stayOnTop:function(e){
this._alwaysOnTop!==e&&(this._alwaysOnTop=e,this._renderCmd.stayOnTop(this._alwaysOnTop))},cleanup:function(){this._super(),this._renderCmd._removeDomFromGameContainer()},_isAncestorsVisible:function(e){if(null==e)return!0;var t=e.getParent();return!(t&&!t.isVisible())&&this._isAncestorsVisible(t)},_onTouchBegan:function(e){if(this.isVisible()&&this._isAncestorsVisible(this)){var t=e.getLocation(),i=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return!!cc.rectContainsPoint(i,this.convertToNodeSpace(t))||(this._renderCmd._endEditing(),!1)}},_onTouchEnded:function(){this.isVisible()&&this._isAncestorsVisible(this)&&this._renderCmd._beginEditing()},_updateBackgroundSpriteSize:function(e,t){this._backgroundSprite&&this._backgroundSprite.setContentSize(e,t)},_updateEditBoxSize:function(e,t){var i="number"==typeof e.width?e.width:e,s="number"==typeof e.height?e.height:t;this._updateBackgroundSpriteSize(i,s),this._renderCmd.updateSize(i,s)},setLineHeight:function(e){
this._renderCmd.setLineHeight(e)},setFont:function(e,t){this._renderCmd.setFont(e,t)},_setFont:function(e){this._renderCmd._setFont(e)},getBackgroundSprite:function(){return this._backgroundSprite},setFontName:function(e){this._renderCmd.setFontName(e)},setFontSize:function(e){this._renderCmd.setFontSize(e)},setString:function(e){e.length>=this._maxLength&&(e=e.slice(0,this._maxLength)),this._text=e,this._renderCmd.setString(e)},setFontColor:function(e){this._textColor=e,this._renderCmd.setFontColor(e)},setMaxLength:function(e){isNaN(e)||(e<0&&(e=65535),this._maxLength=e,this._renderCmd.setMaxLength(e))},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(e){null!==e&&(this._renderCmd.setPlaceHolder(e),this._placeholderText=e)},setPlaceholderFont:function(e,t){this._placeholderFontName=e,this._placeholderFontSize=t,this._renderCmd._updateDOMPlaceholderFontStyle()},_setPlaceholderFont:function(e){var t=cc.LabelTTF._fontStyleRE.exec(e);t&&(
this._placeholderFontName=t[2],this._placeholderFontSize=parseInt(t[1]),this._renderCmd._updateDOMPlaceholderFontStyle())},setPlaceholderFontName:function(e){this._placeholderFontName=e,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontSize:function(e){this._placeholderFontSize=e,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontColor:function(e){this._placeholderColor=e,this._renderCmd.setPlaceholderFontColor(e)},setInputFlag:function(e){this._editBoxInputFlag=e,this._renderCmd.setInputFlag(e)},getString:function(){return this._text},initWithSizeAndBackgroundSprite:function(e,t){return this._backgroundSprite&&this._backgroundSprite.removeFromParent(),this._backgroundSprite=t,this.setContentSize(e),this._backgroundSprite&&!this._backgroundSprite.parent&&(this._backgroundSprite.setAnchorPoint(cc.p(0,0)),this.addChild(this._backgroundSprite),this._updateBackgroundSpriteSize(e.width,e.height)),this.x=0,!(this.y=0)},setDelegate:function(e){
this._delegate=e},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(e){if(this._editBoxInputMode!==e){var t=this.getString();this._editBoxInputMode=e,this._renderCmd.setInputMode(e),this._renderCmd.transform(),this.setString(t),this._renderCmd._updateLabelPosition(this.getContentSize())}},setReturnType:function(e){this._keyboardReturnType=e,this._renderCmd._updateDomInputType()},initWithBackgroundColor:function(e,t){this._edWidth=e.width,this.dom.style.width=this._edWidth.toString()+"px",this._edHeight=e.height,this.dom.style.height=this._edHeight.toString()+"px",this.dom.style.backgroundColor=cc.colorToHex(t)}});var _p=cc.EditBox.prototype;_p.font,cc.defineGetterSetter(_p,"font",null,_p._setFont),_p.fontName,cc.defineGetterSetter(_p,"fontName",null,_p.setFontName),_p.fontSize,cc.defineGetterSetter(_p,"fontSize",null,_p.setFontSize),_p.fontColor,cc.defineGetterSetter(_p,"fontColor",null,_p.setFontColor),_p.string,cc.defineGetterSetter(_p,"string",
_p.getString,_p.setString),_p.maxLength,cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength),_p.placeHolder,cc.defineGetterSetter(_p,"placeholder",_p.getPlaceHolder,_p.setPlaceHolder),_p.placeHolderFont,cc.defineGetterSetter(_p,"placeholderFont",null,_p._setPlaceholderFont),_p.placeHolderFontName,cc.defineGetterSetter(_p,"placeholderFontName",null,_p.setPlaceholderFontName),_p.placeHolderFontSize,cc.defineGetterSetter(_p,"placeholderFontSize",null,_p.setPlaceholderFontSize),_p.placeHolderFontColor,cc.defineGetterSetter(_p,"placeholderFontColor",null,_p.setPlaceholderFontColor),_p.inputFlag,cc.defineGetterSetter(_p,"inputFlag",null,_p.setInputFlag),_p.delegate,cc.defineGetterSetter(_p,"delegate",null,_p.setDelegate),_p.inputMode,cc.defineGetterSetter(_p,"inputMode",null,_p.setInputMode),_p.returnType,cc.defineGetterSetter(_p,"returnType",null,_p.setReturnType),_p=null,cc.EditBox.create=function(e,t,i,s){return new cc.EditBox(e,t,i,s)},function(e){e._polyfill={
zoomInvalid:!1},cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(e._polyfill.zoomInvalid=!0)}(cc.EditBox),function(g){function i(e){var t=e.convertToWorldSpace(cc.p(0,0)),i=cc.visibleRect.height,s=cc.visibleRect.width,n=.5;i<s&&(n=.7),setTimeout(function(){if(window.scrollY<40&&t.y<i*n){var e=i*n-t.y-window.scrollY;e<35&&(e=35),320<e&&(e=320),window.scrollTo(e,e)}},400)}var e=function(){}.prototype=Object.create(Object.prototype);e.updateMatrix=function(){if(this._edTxt){var e=this._node,t=cc.view._scaleX,i=cc.view._scaleY,s=cc.view._devicePixelRatio,n=this._worldTransform;t/=s,i/=s;var o=cc.game.container,a=n.a*t,r=n.b,l=n.c,c=n.d*i,p=o&&o.style.paddingLeft&&parseInt(o.style.paddingLeft),d=o&&o.style.paddingBottom&&parseInt(o.style.paddingBottom),h=n.tx*t+p,u=n.ty*i+d;g.zoomInvalid&&(this.updateSize(e._contentSize.width*a,e._contentSize.height*c),c=a=1);var v="matrix("+a+","+-r+","+-l+","+c+","+h+","+-u+")"
;this._edTxt.style.transform=v,this._edTxt.style["-webkit-transform"]=v,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}},e.updateVisibility=function(){this._edTxt&&(this._node.visible?this._edTxt.style.visibility="visible":this._edTxt.style.visibility="hidden")},e.stayOnTop=function(e){e?(this._removeLabels(),this._edTxt.style.display=""):(this._createLabels(),this._edTxt.style.display="none",this._showLabels())},e._beginEditingOnMobile=function(e){this.__orientationChanged=function(){i(e)},window.addEventListener("orientationchange",this.__orientationChanged),cc.view.isAutoFullScreenEnabled()?(this.__fullscreen=!0,cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()):this.__fullscreen=!1,this.__autoResize=cc.view.__resizeWithBrowserSize,cc.view.resizeWithBrowserSize(!1)},e._endEditingOnMobile=function(){if(this.__rotateScreen){var e=cc.game.container.style;e["-webkit-transform"]="rotate(90deg)",
e.transform="rotate(90deg)";var t=cc.view,i=t._originalDesignResolutionSize.width,s=t._originalDesignResolutionSize.height;0<i&&t.setDesignResolutionSize(i,s,t._resolutionPolicy),this.__rotateScreen=!1}window.removeEventListener("orientationchange",this.__orientationChanged),window.scrollTo(0,0),this.__fullscreen&&cc.view.enableAutoFullScreen(!0),this.__autoResize&&cc.view.resizeWithBrowserSize(!0)},e._onFocusOnMobile=function(e){if(cc.view._isRotated){var t=cc.game.container.style;t["-webkit-transform"]="rotate(0deg)",t.transform="rotate(0deg)",t.margin="0px",window.scrollTo(35,35),this.__rotateScreen=!0}else this.__rotateScreen=!1;i(e)},e._createDomInput=function(){this._removeDomFromGameContainer();var i=this,e=this._edTxt=document.createElement("input");return e.type="text",e.style.fontFamily=this._edFontName,e.style.fontSize=this._edFontSize+"px",e.style.color="#000000",e.style.border=0,e.style.background="transparent",e.style.width="100%",e.style.height="100%",e.style.active=0,
e.style.outline="medium",e.style.padding="0",e.style.textTransform="uppercase",e.style.display="none",e.style.position="absolute",e.style.bottom="0px",e.style.left="2px",e.style.className="cocosEditBox",this.setMaxLength(i._editBox._maxLength),e.addEventListener("input",function(){var e=i._editBox;this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength)),e._delegate&&e._delegate.editBoxTextChanged&&e._text!==this.value&&(e._text=this.value,i._updateDomTextCases(),e._delegate.editBoxTextChanged(e,e._text))}),e.addEventListener("keypress",function(e){var t=i._editBox;e.keyCode===cc.KEY.enter&&(e.stopPropagation(),e.preventDefault(),""===this.value&&(this.style.fontSize=t._placeholderFontSize+"px",this.style.color=cc.colorToHex(t._placeholderColor)),t._text=this.value,i._updateDomTextCases(),i._endEditing(),t._delegate&&t._delegate.editBoxReturn&&t._delegate.editBoxReturn(t),cc._canvas.focus())}),e.addEventListener("focus",function(){var e=i._editBox
;this.style.fontSize=i._edFontSize+"px",this.style.color=cc.colorToHex(e._textColor),i._hiddenLabels(),cc.sys.isMobile&&i._onFocusOnMobile(e),e._delegate&&e._delegate.editBoxEditingDidBegin&&e._delegate.editBoxEditingDidBegin(e)}),e.addEventListener("blur",function(){var e=i._editBox;e._text=this.value,i._updateDomTextCases(),e._delegate&&e._delegate.editBoxEditingDidEnd&&e._delegate.editBoxEditingDidEnd(e),""===this.value&&(this.style.fontSize=e._placeholderFontSize+"px",this.style.color=cc.colorToHex(e._placeholderColor)),i._endEditing()}),this._addDomToGameContainer(),e},e._createDomTextArea=function(){this._removeDomFromGameContainer();var i=this,e=this._edTxt=document.createElement("textarea");return e.type="text",e.style.fontFamily=this._edFontName,e.style.fontSize=this._edFontSize+"px",e.style.color="#000000",e.style.border=0,e.style.background="transparent",e.style.width="100%",e.style.height="100%",e.style.active=0,e.style.outline="medium",e.style.padding="0",
e.style.resize="none",e.style.textTransform="uppercase",e.style.overflow_y="scroll",e.style.display="none",e.style.position="absolute",e.style.bottom="0px",e.style.left="2px",e.style.className="cocosEditBox",this.setMaxLength(i._editBox._maxLength),e.addEventListener("input",function(){this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength));var e=i._editBox;e._delegate&&e._delegate.editBoxTextChanged&&e._text.toLowerCase()!==this.value.toLowerCase()&&(e._text=this.value,i._updateDomTextCases(),e._delegate.editBoxTextChanged(e,e._text))}),e.addEventListener("focus",function(){var e=i._editBox;i._hiddenLabels(),this.style.fontSize=i._edFontSize+"px",this.style.color=cc.colorToHex(e._textColor),cc.sys.isMobile&&i._onFocusOnMobile(e),e._delegate&&e._delegate.editBoxEditingDidBegin&&e._delegate.editBoxEditingDidBegin(e)}),e.addEventListener("keypress",function(e){var t=i._editBox;e.keyCode===cc.KEY.enter&&(e.stopPropagation(),
t._delegate&&t._delegate.editBoxReturn&&t._delegate.editBoxReturn(t))}),e.addEventListener("blur",function(){var e=i._editBox;e._text=this.value,i._updateDomTextCases(),e._delegate&&e._delegate.editBoxEditingDidEnd&&e._delegate.editBoxEditingDidEnd(e),""===this.value&&(this.style.fontSize=e._placeholderFontSize+"px",this.style.color=cc.colorToHex(e._placeholderColor)),i._endEditing()}),this._addDomToGameContainer(),e},e._createLabels=function(){var e=this._editBox.getContentSize();this._textLabel||(this._textLabel=new cc.LabelTTF,this._textLabel.setAnchorPoint(cc.p(0,1)),this._editBox.addChild(this._textLabel,100)),this._placeholderLabel||(this._placeholderLabel=new cc.LabelTTF,this._placeholderLabel.setAnchorPoint(cc.p(0,1)),this._placeholderLabel.setColor(cc.color.GRAY),this._editBox.addChild(this._placeholderLabel,100)),this._updateLabelPosition(e)},e._removeLabels=function(){this._textLabel&&(this._editBox.removeChild(this._textLabel),this._textLabel=null)},
e._updateLabelPosition=function(e){if(this._textLabel&&this._placeholderLabel){var t=cc.size(e.width-2,e.height);this._textLabel.setContentSize(t),this._textLabel.setDimensions(t),this._placeholderLabel.setLineHeight(e.height);var i=this._placeholderLabel.getContentSize();this._editBox._editBoxInputMode===cc.EDITBOX_INPUT_MODE_ANY?(this._textLabel.setPosition(2,e.height),this._placeholderLabel.setPosition(2,e.height),this._placeholderLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this._textLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP)):(this._textLabel.setPosition(2,e.height),this._placeholderLabel.setPosition(2,(e.height+i.height)/2),this._placeholderLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),this._textLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER))}},e.setLineHeight=function(e){this._textLabel&&this._textLabel.setLineHeight(e)},e._hiddenLabels=function(){this._textLabel&&this._textLabel.setVisible(!1),
this._placeholderLabel&&this._placeholderLabel.setVisible(!1)},e._updateDomTextCases=function(){var e,t=this._editBox._editBoxInputFlag;t===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS?this._editBox._text=this._editBox._text.toUpperCase():t===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD?this._editBox._text=this._editBox._text.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()}):t===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE&&(this._editBox._text=(e=this._editBox._text).charAt(0).toUpperCase()+e.slice(1))},e._updateLabelStringStyle=function(){if("password"===this._edTxt.type){for(var e="",t=this._editBox._text.length,i=0;i<t;++i)e+="";this._textLabel&&this._textLabel.setString(e)}else this._updateDomTextCases(),this._textLabel&&this._textLabel.setString(this._editBox._text)},e._showLabels=function(){this._hiddenLabels(),""===this._edTxt.value?this._placeholderLabel&&(this._placeholderLabel.setVisible(!0),this._placeholderLabel.setString(this._editBox._placeholderText)
):this._textLabel&&(this._textLabel.setVisible(!0),this._textLabel.setString(this._editBox._text)),this._updateLabelStringStyle()},e._beginEditing=function(){this._editBox._alwaysOnTop||"none"===this._edTxt.style.display&&(this._edTxt.style.display="",this._edTxt.focus()),cc.sys.isMobile&&!this._editingMode&&this._beginEditingOnMobile(this._editBox),this._editingMode=!0},e._endEditing=function(){if(this._editBox._alwaysOnTop||(this._edTxt.style.display="none"),this._showLabels(),cc.sys.isMobile&&this._editingMode){var e=this;setTimeout(function(){e._endEditingOnMobile()},400)}this._editingMode=!1},e._setFont=function(e){var t=cc.LabelTTF._fontStyleRE.exec(e),i=t[2],s=parseInt(t[1]);t&&this.setFont(i,s)},e.setFont=function(e,t){this._edFontName=e||this._edFontName,this._edFontSize=t||this._edFontSize,this._updateDOMFontStyle()},e.setFontName=function(e){this._edFontName=e||this._edFontName,this._updateDOMFontStyle()},e.setFontSize=function(e){this._edFontSize=e||this._edFontSize,
this._updateDOMFontStyle()},e.setFontColor=function(e){this._edTxt&&(this._edTxt.value!==this._editBox._placeholderText&&(this._edTxt.style.color=cc.colorToHex(e)),this._textLabel&&this._textLabel.setColor(e))},e.setPlaceHolder=function(e){this._placeholderLabel.setString(e)},e.setMaxLength=function(e){this._edTxt&&(this._edTxt.maxLength=e)},e._updateDOMPlaceholderFontStyle=function(){this._placeholderLabel.setFontName(this._editBox._placeholderFontName),this._placeholderLabel.setFontSize(this._editBox._placeholderFontSize)},e.setPlaceholderFontColor=function(e){this._placeholderLabel.setColor(e)},e._updateDomInputType=function(){var e=this._editBox._editBoxInputMode;e===cc.EDITBOX_INPUT_MODE_EMAILADDR?this._edTxt.type="email":e===cc.EDITBOX_INPUT_MODE_DECIMAL||e===cc.EDITBOX_INPUT_MODE_NUMERIC?this._edTxt.type="number":e===cc.EDITBOX_INPUT_MODE_PHONENUMBER?(this._edTxt.type="number",this._edTxt.pattern="[0-9]*"):e===cc.EDITBOX_INPUT_MODE_URL?this._edTxt.type="url":(
this._edTxt.type="text",this._editBox._keyboardReturnType===cc.KEYBOARD_RETURNTYPE_SEARCH&&(this._edTxt.type="search")),this._editBox._editBoxInputFlag===cc.EDITBOX_INPUT_FLAG_PASSWORD&&(this._edTxt.type="password")},e.setInputFlag=function(e){this._edTxt&&(this._updateDomInputType(),this._edTxt.style.textTransform="none",e===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS?this._edTxt.style.textTransform="uppercase":e===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD&&(this._edTxt.style.textTransform="capitalize"),this._updateLabelStringStyle())},e.setInputMode=function(e){e===cc.EDITBOX_INPUT_MODE_ANY?this._createDomTextArea():this._createDomInput(),this._updateDomInputType();var t=this._node.getContentSize();this.updateSize(t.width,t.height)},e.setString=function(e){this._edTxt&&null!==e&&(""===(this._edTxt.value=e)?(this._placeholderLabel&&(this._placeholderLabel.setString(this._editBox._placeholderText),this._placeholderLabel.setColor(this._editBox._placeholderColor)),
this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(!0),this._textLabel&&this._textLabel.setVisible(!1))):(this._edTxt.style.color=cc.colorToHex(this._editBox._textColor),this._textLabel&&this._textLabel.setColor(this._editBox._textColor),this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(!1),this._textLabel&&this._textLabel.setVisible(!0)),this._updateLabelStringStyle()))},e._updateDOMFontStyle=function(){this._edTxt&&(""!==this._edTxt.value&&(this._edTxt.style.fontFamily=this._edFontName,this._edTxt.style.fontSize=this._edFontSize+"px"),this._textLabel&&(this._textLabel.setFontSize(this._edFontSize),this._textLabel.setFontName(this._edFontName)))},e.updateSize=function(e,t){var i=this._edTxt;i&&(i.style.width=e+"px",i.style.height=t+"px",this._updateLabelPosition(cc.size(e,t)))},e._addDomToGameContainer=function(){cc.game.container.appendChild(this._edTxt)},e._removeDomFromGameContainer=function(){var e=this._edTxt;if(e){(
"contains"in cc.game.container?cc.game.container.contains(e):cc.game.container.compareDocumentPosition(e)%16)&&cc.game.container.removeChild(e)}this._edTxt=null},e.initializeRenderCmd=function(e){this._editBox=e,this._edFontSize=14,this._edFontName="Arial",this._textLabel=null,this._placeholderLabel=null,this._editingMode=!1,this.__fullscreen=!1,this.__autoResize=!1,this.__rotateScreen=!1,this.__orientationChanged=null},cc.EditBox.CanvasRenderCmd=function(e){this._rootCtor(e),this.initializeRenderCmd(e)};var t=cc.EditBox.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(e,t),t.constructor=cc.EditBox.CanvasRenderCmd,t.transform=function(e,t){this.originTransform(e,t),this.updateMatrix()},cc.EditBox.WebGLRenderCmd=function(e){this._rootCtor(e),this.initializeRenderCmd(e)};var s=cc.EditBox.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(e,s),s.constructor=cc.EditBox.WebGLRenderCmd,s.transform=function(e,t){
this.originTransform(e,t),this.updateMatrix()}}(cc.EditBox._polyfill),cleverapps.Plot={decideNext:function(e){if(e.isRegular()&&!e.isCurrentLevel()&&cleverapps.metha.getType()===Metha.HOSE&&"board"!==cleverapps.config.type&&cleverapps.config.results)return Boatswain.REPLAY_INTENT;var t=e.isRegular();if((cleverapps.metha.getType()===Metha.KNOCKOUT||cleverapps.forces.checkMainForces())&&(t=!1),t)switch(cleverapps.metha.getType()){case Metha.FARM:cleverapps.farm.isCompleted()||cleverapps.metha.withSimpleMain()||(cleverapps.farm.getBuilding().getQuest().isCompleted()&&(t=!1),cleverapps.farm.justCollectedDialogue&&(t=!1));break;case Metha.HOMEFIX:if(!cleverapps.home.isCompleted()&&!cleverapps.metha.withSimpleMain()){var i=cleverapps.home.getFurnitureToUpgrade();if(i){var s=i.getInfo().cost;cleverapps.home.stars>=s&&cleverapps.home.stars-cleverapps.home.amountLevelStars(e)<s&&(t=!1)}}break;case Metha.SIMPLE:t=!1;break;case Metha.HOSE:if(e.isCurrentLevel()&&!e.isLastLevelOnEpisode()||(t=!1),t
){var n=cleverapps.Plot.getDialogueAfterLevel(e),o=e.episode.levels[e.levelNo+1];(n||o.isHard())&&(t=!1)}}return t&&cleverapps.missionManager.skipNext()&&(t=!1),t?Boatswain.NEXT_INTENT:Boatswain.EXIT_INTENT},GameLeave:function(e,t){var i=t.level,s=this.isEpisodeFinished(i)&&cleverapps.metha.getType()===Metha.HOSE,n=[];if(this.isEpisodeFinished(i)){var o=levels.user.episode-1,a=cleverapps.styles.comicses["finishEpisode"+o]||cleverapps.styles.comicses.finishEpisode;a&&n.push(function(e){ComicsScene.showComics(e,a)})}var r,l=function(e){var t=cleverapps.missionManager.getMissionWithIntent();!s&&t&&t.logic.willUseIntent(i)?t.useMissionIntent(e):(cleverapps.rewardedAdsManager&&!cleverapps.isLocalhost()&&cleverapps.rewardedAdsManager.showInterstitial(),cleverapps.metha.gotoMainScene(e))};cleverapps.isKnockoutGame()&&i.isRegular()?((r=cleverapps.metha.getMainObject().knockoutGame.rumble).moveNextRound(),r.outcome===Rumble.OUTCOME_UNKNOWN?n.push(function(e){cleverapps.metha.getMainObject(
).wantsToPlay(e)}):(r.outcome===Rumble.OUTCOME_WIN&&(n.push(function(e){cleverapps.metha.getMainObject().knockoutGame.openWindow(e)}),n.push(function(e){new KnockoutVictoryWindow,cleverapps.metha.onceNoWindowsListener=e})),n.push(l))):n.push(l);cleverapps.metha.getType()===Metha.KNOCKOUT&&i.isRegular()&&((r=cleverapps.knockout.knockoutGame.rumble)&&r.outcome===Rumble.OUTCOME_WIN&&(cleverapps.knockout.gotoNextCupAnimation=!0,n.push(function(e){cleverapps.knockout.gotoNextCup(e)}),n.push(function(e){cleverapps.knockout.gotoNextCupAnimation=!1,e()})));if(s){levels.episodes.changeEpisodeAnimation=!0;var c=levels.user.episode-1,p=c+1;n.push(function(e){cleverapps.metha.compound(e,[function(e){cleverapps.Plot.onFinishEpisode(e,{episode:levels.episodes.episodes[c]})},function(e){levels.episodes.changeEpisodeAnimation=!1,levels.episodes.gotoNextEpisode(e,!0,p)},function(e){cleverapps.Plot.onStartEpisode(e,{episode:levels.episodes.episodes[p]})}])})}i.isRegular()&&i.isPassed&&i.isCurrentLevel(
)&&cleverapps.Plot.getDialogueAfterLevel(i)&&n.push(function(e){cleverapps.Plot.finishLevelDialogue(e,i)}),cleverapps.metha.compound(e,n)},onFinishEpisode:function(e,t){cleverapps.metha.controlFreeFocus("mainTableView"),cleverapps.metha.compound(e,[function(e){new FinishEpisodeWindow(t),cleverapps.metha.onceNoWindowsListener=e},function(e){t.episode.animatePass(e)}])},onStartup:function(e,t){return 0===levels.user.episode&&0===levels.user.level?this.onFirstInit(e,t):t?cleverapps.metha.getMainScene():void cleverapps.metha.gotoMainScene(e)},onFirstInit:function(e,t){var i=[];if(cleverapps.styles.comicses&&cleverapps.styles.comicses.begin){if(t)return{scene:ComicsScene,options:[cleverapps.styles.comicses.begin]};i.push(function(e){ComicsScene.showComics(e,cleverapps.styles.comicses.begin)})}else if(this.hasStartEpisodeWindow())return t?cleverapps.metha.getMainScene():(i.push(function(e){cleverapps.metha.gotoMainScene(e)}),i.push(function(e){this.onStartEpisode(e,{
episode:levels.episodes.getCurrentEpisode()})}.bind(this)),void cleverapps.metha.compound(e,i));if(cleverapps.metha.getType()===Metha.HOSE||cleverapps.metha.getType()===Metha.SIMPLE&&!cleverapps.isKnockoutGame()||cleverapps.metha.withSimpleMain()){if(t)return GameScene;i.push(function(e){cleverapps.metha.wantsToPlay(e)})}else{if(t)return cleverapps.metha.getMainScene();i.push(function(e){cleverapps.metha.gotoMainScene(e)})}cleverapps.metha.compound(e,i)},hasStartEpisodeWindow:function(){return cleverapps.metha.getType()===Metha.HOSE&&"riddles"===cleverapps.config.name},onStartEpisode:function(e,t){if(t.episode.isComingSoon())new FinisherWindow,cleverapps.metha.onceNoWindowsListener=e;else{var i=[];i.push(function(e){t.episode.animateOpen(e)}),this.hasStartEpisodeWindow()&&i.push(function(e){new StartEpisodeWindow(t.episode),cleverapps.metha.onceNoWindowsListener=e}),cleverapps.metha.compound(e,i)}},onFirstHeroesOpen:function(e,t){var i=[function(e){new HeroWindow({color:t.color},{
type:"unlocked"}),cleverapps.metha.onceNoWindowsListener=e}];if(cleverapps.styles.comicses){var s=ColorCell.CODE_COLORS[t.color];cleverapps.styles.comicses[s]&&i.push(function(e){ComicsScene.showComics(e,cleverapps.styles.comicses[s])})}cleverapps.metha.compound(e,i)},isEpisodeFinished:function(e){return e.isRegular()&&e.isPassed&&e.isLastLevelOnEpisode()&&e.isCurrentLevel()},getDialogueAfterLevel:function(e){if(!cleverapps.styles.dialogues)return!1;var t=e.getHumanReadableNumber();return cleverapps.styles.dialogues["finishLevel"+t]},finishLevelDialogue:function(e,t){var s=this.getDialogueAfterLevel(t);if(s){var n=cc.director.getRunningScene();cleverapps.metha.compound(e,[function(e){s.bundles?cleverapps.bundleLoader.loadBundles(s.bundles,{onSuccess:function(){e()},blocked:!0}):e()},function(e){var t=n.scene.height*(1.2-1);n.createFilmEffect({scale:1.2,layerTimeout:0,scaleTimeout:1,moveBy:{y:t},onComplete:e})},function(e){var t=new Dialogue(s.dialogue,{autoClose:!0,autoScroll:3,
showUp:!0});t.on("afterClose",e);var i=new DialogueView(t,{overlay:!0});i.setLocalZOrder(51),n.addChild(i),i.setPositionRound(n.width/2,i.height/2+n.downFilmLayer.height),t.run()},function(e){n.removeFilmEffect({scaleTimeout:.4,scaleLayerSameTime:!0,layerSlide:!0,onComplete:e})}])}}},cleverapps.styles.comicses={};var Dialogue=function(e,t){cleverapps.EventEmitter.call(this),this.options=t||{},this.bundles=this.options.bundles||[],this.autoScroll=3,void 0!==this.options.autoScroll&&(this.autoScroll=this.options.autoScroll),this.data=Array.isArray(e)?e:[e],this.stage=-1,this.stageData=this.data[0]};Dialogue.prototype=Object.create(cleverapps.EventEmitter.prototype),(Dialogue.prototype.constructor=Dialogue).prototype.run=function(){cleverapps.metha.isFocused()||(console.log("Dialogue:",this.data),cleverapps.metha.debugMessage("Trying to show dialogue without user focus!")),this.options.showUp&&this.showUp(),this.next()},Dialogue.prototype.showUp=function(){this.inShowUp=!0,this.trigger(
"showUp")},Dialogue.prototype.finishShowUp=function(){this.inShowUp=!1,this.onShowUpFinished&&this.onShowUpFinished()},Dialogue.prototype.finishClose=function(){this.trigger("afterClose")},Dialogue.prototype.close=function(){this.closing||(this.closing=!0,this.trigger("beforeClose"))},Dialogue.prototype.next=function(e){if(this.inShowUp)this.onShowUpFinished=this.next.bind(this);else{if(this.typing)return this.clearTimeout(this.finishTimeout),void this.finishTyping();e=e||0,this.stage<this.data.length-1?this.incStage(e):this.options.autoClose&&this.createTimeout(this.close.bind(this),1e3*e)}},Dialogue.prototype.incStage=function(e){this.clearTimeout(this.incTimeout),this.clearTimeout(this.finishTimeout),this.incTimeout=this.createTimeout(function(){this.stage++,this.stageData=this.data[this.stage],this.onChangeStage(),this.finishTimeout=this.createTimeout(function(){this.finishTyping()}.bind(this),1e3*this.getTypingDuration())}.bind(this),1e3*e)},
Dialogue.prototype.createTimeout=function(e,t){return new cleverapps.CountDown(t,{onFinish:function(){this.closing||e()}.bind(this),pauseOnGameHide:!0})},Dialogue.prototype.clearTimeout=function(e){e&&e.remove()},Dialogue.prototype.onChangeStage=function(){this.typing=!0,this.trigger("changedStage")},Dialogue.prototype.finishTyping=function(){this.typing=!1,this.trigger("finishTyping"),this.autoScroll&&this.next(this.autoScroll)},Dialogue.prototype.screenClicked=function(){this.trigger("screenClicked"),this.options.closeOnScreenClick?this.close():this.next()},Dialogue.prototype.buttonClicked=function(){this.typing&&this.next(),this.next(),this.trigger("buttonClicked")},Dialogue.prototype.getTypingDuration=function(){return this.getTypingDelay()+this.getTypingSpeed()*cleverapps.UI.LabelTTF.prototype.getLocalizedText.call(null,this.stageData.text).length},Dialogue.prototype.getTypingSpeed=function(){return.03},Dialogue.prototype.getTypingDelay=function(){return.2},Dialogue.POSITIONS={
TOP:"top",TOP_LOWER:"top_lower",BOTTOM:"bottom"};var Force=Window.extend({ctor:function(e,t,i){this.windowForce=t.window,this.forceConfig=t,this.options=i||{},this._super(e,t)},moveNodeAndKeepScale:function(e){e.realParent=e.getParent();for(var t=1,i=e.realParent;i;)t*=i.scale,i=i.getParent();var s=this;1!==t&&((s=new cc.Node).setScale(t),this.addChild(s)),e.replaceParentSamePlace(s)},returnNode:function(e){e.replaceParentSamePlace(e.realParent)},onWindowLoaded:function(e,t){this.id=t.id,this._super({name:"forcewindow"+this.id,notCloseByTouchInShadow:!0,closeButton:!1}),cleverapps.toolbar.freezeUpdates(),this.element=e,this.element.realParent=void 0;var i=[];if(e!==Force.NO_ELEMENT&&i.push(this.element.getGlobalBoundingBox()),this.options.highlights&&this.options.highlights.forEach(function(e){this.moveNodeAndKeepScale(e)},this),e!==Force.NO_ELEMENT&&(this.moveNodeAndKeepScale(e),!1!==t.Finger)){var s=1/e.parent.scale,n=1/e.parent.scale;this.options.scaleX&&(s*=this.options.scaleX),
this.finger=new FingerView({scaleX:s,scaleY:n}),this.finger.setVisible(!0),e.parent.addChild(this.finger),this.finger.setPositionRound(this.element.getPosition()),this.finger.delay(1);var o,a=cc.p(0,0);if(this.finger.setLocalZOrder(1e6),t.Finger){var r=t.Finger;r.mobile&&cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(r=r.mobile),a=cc.p(r.x||0,r.y||0),r.startY&&(o=cc.p(0,r.startY)),r.rotation&&this.finger.setRotation(r.rotation)}this.finger.fadeIn(a,o),this.finger.press(),this.finger.delay(.3),this.finger.unPress(),this.finger.fadeOut(),this.finger.delay(1.3),this.finger.run({looped:!0})}this.hint=new Dialogue({text:"function"==typeof t.text?t.text():t.text,person:t.person},{showUp:!0}),this.hint.on("buttonClicked",function(){cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce()}),new DialogueView(this.hint,{parent:this,rects:i,button:t.button||{noButton:!0},autoPosition:!0,forcePosition:"function"==typeof t.position?t.position():t.position,inner:!0}
).setLocalZOrder(1e6),this.hint.run(),e===Force.NO_ELEMENT&&this.addClickCloseWhenNoElement(),t.event&&cleverapps.eventLogger.logEvent(t.event),e!==Force.NO_ELEMENT&&(this.watchElementInterval=setInterval(function(){this.element.parent&&this.element.visible||cleverapps.forces.closeRunningForce()}.bind(this),5e3))},onClose:function(){this.watchElementInterval&&clearInterval(this.watchElementInterval),this.element.parent&&(this.finger&&this.finger.removeFromParent(!0),this.element&&this.element!==Force.NO_ELEMENT&&this.returnNode(this.element)),this.options.highlights&&this.options.highlights.forEach(function(e){e.getParent()&&this.returnNode(e)},this),cleverapps.toolbar.unfreezeUpdates()},addClickCloseWhenNoElement:function(){this.clickArea=new cc.Node,this.clickArea.setContentSize(this.getContentSize()),this.addChild(this.clickArea),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(e){cleverapps.forces.isRunningForce(
)&&cleverapps.forces.closeRunningForce()}.bind(this.clickArea)},this.clickArea)},listBundles:function(){return["dialogues"]}});Force.NO_ELEMENT="emptyForceElement";var Forces=function(){this.shownForces=[],this.load(),this.runningForceWindow=void 0,this.onceForceClosed=void 0};Forces.prototype.isRunningForce=function(e){return void 0!==this.runningForceWindow&&(void 0===e||this.runningForceWindow.id===e.id)},Forces.prototype.whenForceClosed=function(e){this._whenForceClosedCallbacks||(this._whenForceClosedCallbacks=[]),this._whenForceClosedCallbacks.push(e)},Forces.prototype._runForceClosedCallbacks=function(){this._whenForceClosedCallbacks&&(this._whenForceClosedCallbacks.forEach(function(e){e()}),delete this._whenForceClosedCallbacks)},Forces.prototype.closeRunningForce=function(){if(this.runningForceWindow.close(),this._runForceClosedCallbacks(this.runningForceWindow.id),void 0!==this.runningForceWindow.id&&this.saveForce(this.runningForceWindow.id),this.runningForceWindow=void 0,
this.onceForceClosed){var e=this.onceForceClosed;this.onceForceClosed=void 0,e()}},Forces.prototype.reset=function(){this.shownForces=[],this.save()},Forces.prototype.load=function(){this.shownForces=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.FORCES)||[]},Forces.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.FORCES,this.shownForces),e||cleverapps.synchronizer.addUpdateTask("forces")},Forces.prototype.getInfo=function(){var t=0;return this.shownForces.forEach(function(e){t|=1<<e}),{forces:t}},Forces.prototype.updateInfo=function(e,t){this.shownForces=[];for(var i=0;i<Forces.SYNCED_FORCES;i++)e.forces&1<<i&&this.shownForces.push(i);this.save(t)},Forces.prototype.isAvailable=function(e,t){return!(!e||e&&e!==Force.NO_ELEMENT&&!e.isRunningSafe())&&(void 0===t.id||-1===this.shownForces.indexOf(t.id))},Forces.prototype.isShown=function(e){return void 0!==e&&(this.shownForces&&0<=this.shownForces.indexOf(e))},Forces.prototype.saveForce=function(e){
e&&!this.isShown(e)&&(this.shownForces.push(e),this.save())},Forces.prototype.__clearForceTool=function(e){var t=this.shownForces.indexOf(e);-1!==t&&(this.shownForces.splice(t,1),this.save())},Forces.prototype.create=function(e,t,i){if(this.isAvailable(e,t))return this.runningForceWindow=new Force(e,t,i)},Forces.prototype.checkMainForces=function(){return this.checkDailyTasksForce()||this.checkPeriodicBonusForce()||this.checkBonusRoundForce()||this.checkHeroesForce()},Forces.prototype.checkDailyTasksForce=function(){return cleverapps.dailyTasks&&levels.user.checkAvailable(cleverapps.Availables.DAILY_TASKS)&&!this.isShown(Forces.DAILY_TASKS_FORCE.id)},Forces.prototype.checkPeriodicBonusForce=function(){return cleverapps.periodicBonus&&cleverapps.periodicBonus.isAvailable()&&!this.isShown(Forces.PERIODIC_BONUS_FORCE.id)},Forces.prototype.checkBonusRoundForce=function(){return cleverapps.bonusRoundChest&&cleverapps.bonusRoundChest.isActive()&&!this.isShown(Forces.BONUS_ROUND_FORCE.id)},
Forces.prototype.checkHeroesForce=function(){return"undefined"!=typeof match3&&match3.heroes.available()&&!this.isShown(Forces.HEROES_AVAILABLE.id)},Forces.SYNCED_FORCES=32,Forces.FREE_WILDCARD_FORCE={id:1,event:cleverapps.EVENTS.FREE_WILDCARD_FORCE,text:"messages:WildCardTutorialMessage",position:Dialogue.POSITIONS.TOP},Forces.FREE_UNDO_FORCE={id:2,event:cleverapps.EVENTS.FREE_UNDO_FORCE,text:"messages:UndoTutorialMessage",position:Dialogue.POSITIONS.TOP},Forces.FREE_HINT_FORCE={id:3,event:cleverapps.EVENTS.FREE_HINT_FORCE,text:"messages:hintTutorialMessage"},Forces.FIRST_BOOSTERS_BEFORE={id:4,window:!0,event:cleverapps.EVENTS.FIRST_BOOSTERS_BEFORE,text:"messages:FirstBoostersBefore.force",position:Dialogue.POSITIONS.BOTTOM},Forces.SECOND_BOOSTERS_BEFORE={id:5,window:!0,event:cleverapps.EVENTS.SECOND_BOOSTERS_BEFORE,text:"messages:SecondBoostersBefore.force",position:Dialogue.POSITIONS.BOTTOM},Forces.THIRD_BOOSTERS_BEFORE={id:6,window:!0,event:cleverapps.EVENTS.THIRD_BOOSTERS_BEFORE,
text:"messages:ThirdBoostersBefore.force",position:Dialogue.POSITIONS.BOTTOM},Forces.FREE_ADD_MOVES_FORCE={id:7,event:cleverapps.EVENTS.FREE_ADD_MOVES_FORCE,text:"messages:AddMovesTutorialMessage",position:Dialogue.POSITIONS.TOP,Finger:{y:50}},Forces.FREE_PAINT_FORCE={id:8,event:cleverapps.EVENTS.FREE_PAINT_FORCE,text:"messages:Paint.force"},Forces.DAILY_TASKS_FORCE={id:10,event:cleverapps.EVENTS.DAILY_TASKS_FORCE,text:"messages:Forces.DailyTasks",Finger:{startY:100}},Forces.PERIODIC_BONUS_FORCE={id:12,event:cleverapps.EVENTS.PERIODIC_BONUS_FORCE,text:"messages:Forces.PeriodicBonus",Finger:{startY:100}},Forces.GUN={id:15,event:cleverapps.EVENTS.GUN_FORCE,text:"messages:Forces.Gun",Finger:{startY:100,x:100,y:130}},Forces.HEROES_AVAILABLE={id:17,event:cleverapps.EVENTS.HEROES_AVAILABLE_FORCE,text:"messages:Forces.HeroesAvailable"},Forces.DAILY_CUP={id:18,text:"messages:DailyCup.force"},Forces.LANTERN={id:20,event:cleverapps.EVENTS.LANTERN_FORCE,text:"messages:LanternWindow.force"},
Forces.BONUS_ROUND_FORCE={id:21,event:cleverapps.EVENTS.BONUS_ROUND_FORCE,text:"messages:Forces.BonusRound",Finger:{startY:100}},Forces.UNLOCK_HEROES={text:"messages:Forces.UnlockHero",Finger:{y:-70}},Forces.UPGRADE_HEROES={text:"messages:Forces.UpgradeFirstHero",Finger:{y:-70}},Forces.RACE={id:22,text:"messages:Race.force"},Forces.METHA_PLAY_BUTTON={id:23,text:function(){return cleverapps.metha.getType()===Metha.SIMPLE?"messages:SimpleMethaPlayButton.force":"messages:MethaPlayButton.force"},position:Dialogue.POSITIONS.TOP_LOWER},Forces.KNOCKOUT_PLAYERS={id:24,text:"messages:KnockoutPlayers.force",button:{text:"messages:SkipButton",textLast:"messages:SkipButton"},Finger:!1},Forces.KEYPAD={id:25,text:"messages:Keypad.force",button:{text:"messages:SkipButton",textLast:"messages:SkipButton"},Finger:!1,position:function(){if("differences"===cleverapps.config.type)return Dialogue.POSITIONS.BOTTOM}},Forces.COMBO={id:26,text:"messages:Combo.force"},Forces.COOKIEJAR={id:27,
text:"messages:Cookiejar.force"},Forces.CRYPTEX={id:28,text:"messages:Cryptex.force"},Forces.FREE_SHUFFLE_FORCE={id:29,event:cleverapps.EVENTS.FREE_SHUFFLE_FORCE,text:"messages:ShuffleBooster.force"},Forces.PHOTO_CLOVER={id:30,text:"messages:PhotoClover.force"},Forces.COOLDOWN_FORCE={id:11,text:"messages:CoolDownNode.force",button:{text:"messages:SkipButton",textLast:"messages:OK"},Finger:!1};var Actor=cc.Node.extend({ctor:function(e){this._super(),this.setContentSize(e.size),this.setAnchorPoint2();var t=e;t.boostersAmountPosition&&(t=t.boostersAmountPosition[Game.currentGame.boosters.amountAvailable()]),t=t.wideModePositions?t.wideModePositions[cleverapps.wideMode.mode]:t.position,this.setPositionRound(t),this.baseScaleX=this.baseScaleY=1,e.scales&&(this.baseScaleX=this.baseScaleY=e.scales[cleverapps.wideMode.mode]),e.scaleX&&(this.baseScaleX*=e.scaleX),e.scaleY&&(this.baseScaleY*=e.scaleY),this.setScale(this.baseScaleX,this.baseScaleY),this.spine=new cleverapps.Spine(e.spine),
this.currSpine=e.spine,this.currSpineId=e.spineId,this.currSfx=e.sfx,e.spinePosition?this.spine.setPositionRound(this.width/2+e.spinePosition.x,this.height/2+e.spinePosition.y):this.spine.setPositionRound(this.width/2,0),this.addChild(this.spine),e.skin&&(this.spine.setSkin(e.skin),this.currSkin=e.skin),this.spine.setAnimation(0,Actor.ANIMATIONS.IDLE,!0),this.alive=!0},shake:function(){this.stopAllActions(),this.setScale(this.baseScaleX,this.baseScaleY),this.runAction(new cc.Sequence(new cc.ScaleTo(.1,1.07*this.baseScaleX,.93*this.baseScaleY),new cc.ScaleTo(.05,this.baseScaleX,this.baseScaleY)))},animate:function(t,i){if(i=i||{},!this.alive){if(t!==Actor.ANIMATIONS.REVIVE)return;this.alive=!0}var e;(-1!==[Actor.ANIMATIONS.DIE,Actor.ANIMATIONS.DIE_IDLE].indexOf(t)&&(this.alive=!1),-1!==[Actor.ANIMATIONS.HURT,Actor.ANIMATIONS.HURT2].indexOf(t)&&(-1!==[Actor.ANIMATIONS.ATTACK1,Actor.ANIMATIONS.ATTACK2,Actor.ANIMATIONS.ATTACK3,Actor.ANIMATIONS.ATTACK4].indexOf(this.animationRunning)&&(
this.animationRunning=!1),-1!==[Actor.ANIMATIONS.HURT,Actor.ANIMATIONS.HURT2].indexOf(this.animationRunning)&&this.animationStarted<Date.now()-300&&(this.animationRunning=!1)),-1!==[Actor.ANIMATIONS.GUN,Actor.ANIMATIONS.DIE,Actor.ANIMATIONS.DIE_IDLE,Actor.ANIMATIONS.REVIVE,Actor.ANIMATIONS.HEAL,Actor.ANIMATIONS.ENEMY_ATTACK].indexOf(t)&&(this.animationRunning=!1),this.animationRunning)||(this.currSfx&&!i.noSFX&&(e=this.currSfx[t]),e&&this.runAction(new cc.Sequence(new cc.DelayTime(i.sfxDelay||cleverapps.styles.Actor.sfx.delay),new cc.CallFunc(function(){cleverapps.audio.playSound(e)}))),this.animationRunning=t,this.animationStarted=Date.now(),this.spine.setAnimation(0,t,!1),this.spine.setCompleteListener(function(){var e;this.animationRunning=!1,this.spine.setCompleteListener(function(){}),e=i.idleAnimation?i.idleAnimation:-1!==[Actor.ANIMATIONS.DIE,Actor.ANIMATIONS.DIE_IDLE].indexOf(t)?Actor.ANIMATIONS.DIE_IDLE:Actor.ANIMATIONS.IDLE,this.spine.setAnimation(0,e,!0),
i.callback&&i.callback()}.bind(this)))}});Actor.ANIMATIONS={},Actor.ANIMATIONS.ENEMY_ATTACK="attack",Actor.ANIMATIONS.ATTACK1="attack1",Actor.ANIMATIONS.ATTACK2="attack2",Actor.ANIMATIONS.ATTACK3="attack3",Actor.ANIMATIONS.ATTACK4="attack4",Actor.ANIMATIONS.IDLE="idle",Actor.ANIMATIONS.HURT="hurt",Actor.ANIMATIONS.HURT2="hurt2",Actor.ANIMATIONS.DIE="die",Actor.ANIMATIONS.DIE_IDLE="die_idle",Actor.ANIMATIONS.HEAL="heal",Actor.ANIMATIONS.REVIVE="revive",Actor.ANIMATIONS.GUN="punish",cleverapps.styles.Actor={sfx:{delay:.7}},cleverapps.WideMode=function(){this.mode=cleverapps.WideMode.VERTICAL;var e=cc.director.getWinSize();e.width>cleverapps.styles.SQUARE_MODE_WIDTH&&(this.mode=cleverapps.WideMode.SQUARE),void 0!==cleverapps.styles.HORIZONTAL_MODE_WIDTH?e.width>cleverapps.styles.HORIZONTAL_MODE_WIDTH&&(this.mode=cleverapps.WideMode.HORIZONTAL):void 0!==cleverapps.styles.SCENE_HORIZONTAL_WIDTH&&e.width===cleverapps.styles.SCENE_HORIZONTAL_WIDTH&&(this.mode=cleverapps.WideMode.HORIZONTAL)},
cleverapps.WideMode.VERTICAL=0,cleverapps.WideMode.SQUARE=1,cleverapps.WideMode.HORIZONTAL=2;var Competition=function(e){this.type=e.type;var t=void 0;(this.options=e).store&&((t=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.COMPETITION+"_"+this.type))||-1===[Mission.TYPE_COMBO,Mission.TYPE_COLLECT_MARK,Mission.TYPE_BURN_NEARBY,Mission.TYPE_LETTER].indexOf(this.type)||(t=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.COMPETITION)),cleverapps.DataLoader.remove(cleverapps.DataLoaderTypes.COMPETITION));t?(this.results=t.results,e.algo.lastProcessed=t.algorithm):e.players?this.results=e.players:this.results=this.listFakePlayers(e.amount),this.player=this.getPlayerById(cleverapps.user.id),this.player||(this.player={player:!0,id:cleverapps.user.id,name:cleverapps.friends.getPlayer().name,avatar:cleverapps.friends.getPlayer().avatar,amount:0},this.results.push(this.player)),void 0!==e.playerResult&&(this.player.amount=e.playerResult),this.running=!0,
this.onChangeResultsListeners={},this.onLoseListener=function(){},0<this.countFakePlayers()&&this.onPlayersAvailable()};Competition.prototype.start=function(){this.algorithm=new CompetitionAlgorithm(this,this.options.algo)},Competition.optionsForTournament=function(e){var t="tournament",i=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.COMPETITION+"_"+t)||{};if(e.emptySave||i.level===e.level.getHumanReadableNumber()){var s=i.results||[];if(e.emptySave){Competition.CLEAN_SAVED(t);var n=[.5,.8,1.1].sort(function(){return Math.random()<.5?-1:1});(s=cleverapps.competitionPlayers.listPlayers(3)||[]).forEach(function(e,t){e.amount=0,e.force=n[t]})}if(!(s.length<3)){cleverapps.UI.Avatar.preload(s);var o=cleverapps.competitionStatistics.getBoardGameWordOpenByKeypadLengthTime(e.keypad.amountKeys());return{type:t,amount:3,level:e.level,store:!0,lose:!1,players:s,algo:{noPlayerEpisodeCoef:!0,averageProcessTimeout:cleverapps.parseInterval(o+" seconds"),botAheadPlayerCoef:.25,
botAheadPlayerBigDifferenceCoef:.3,bigDistanceLength:1,offlineProcess:!0,useRealForce:!0,start:Date.now(),finish:Date.now()+cleverapps.parseInterval("3 hour"),maxResult:e.totalItemsToSolve()}}}}},Competition.optionsForKnockoutGame=function(e){var t=10;"board"===e.type?t=cleverapps.competitionStatistics.getBoardGameWordOpenByKeypadLengthTime(e.keypad.amountKeys()):"differences"===e.type&&(t=cleverapps.competitionStatistics.getOneDifferenceFindTime());var i=cleverapps.metha.getMainObject().knockoutGame.rumble,s=i.getCurrentRound().getOpponent(cleverapps.user.id);s.force=[.6,.8,1][i.rounds.length-1],s.amount=0;var n=.3,o=1.5,a=.5;switch(cleverapps.metha.getMainObject().knockoutGame.calcTournamentType()){case KnockoutGame.BOT_CANNOT_WIN_TOURNAMENT:a=0,o=2,t=Math.floor(.8*t);break;case KnockoutGame.VERY_EASY_TOURNAMENT:n=.3,o=2,t=Math.floor(2.5*t);break;case KnockoutGame.EASY_TOURNAMENT:n=.4,o=1,a=.3,t=Math.floor(1.3*t);break;case KnockoutGame.NORMAL_TOURNAMENT:n=.5,o=1.2,a=.3,t=Math.floor(
1.1*t);break;case KnockoutGame.DIFFICULT_TOURNAMENT:n=.6,o=1.5,t=Math.floor(.8*t);break;case KnockoutGame.VERY_DIFFICULT_TOURNAMENT:n=.8,o=1.5,t=Math.floor(.5*t)}return{type:"knockout",amount:1,players:[s],algo:{noPlayerEpisodeCoef:!0,averageProcessTimeout:cleverapps.parseInterval(t+" seconds"),botAheadPlayerCoef:n,botAheadPlayerBigDifferenceCoef:.5,playerAheadBotCoef:o,playerAheadBotBigDifferenceCoef:2,bigDistanceLength:1,offlineProcess:!1,useRealForce:!0,start:Date.now(),finish:Date.now()+cleverapps.parseInterval("3 hour"),maxResult:e.totalItemsToSolve(),botFinishCoef:a}}},Competition.optionsByMission=function(e){var t={store:!0,type:e.type,playerResult:e.result,amount:Array.isArray(e.competition.amount)?cleverapps.Random.random(e.competition.amount[0],e.competition.amount[1],!1):e.competition.amount};return t.algo={start:e.started,finish:e.finishTime()},cleverapps.extend(t.algo,e.competition),t},Competition.prototype.calcPlace=function(){return this.results.sort(function(e,t){
return t.amount!==e.amount?t.amount-e.amount:e.event&&t.event&&e.event!==t.event?e.event-t.event:e===this.player?-1:t===this.player?1:0}.bind(this)),this.results.indexOf(this.player)},Competition.prototype.updatePlayerResult=function(e,t){this.options.algo.maxResult&&t>this.options.algo.maxResult&&(t=this.options.algo.maxResult);for(var i=0;i<this.results.length;i++)if(this.results[i].id===e){this.results[i].amount=t,this.results[i].event=Date.now(),this.runChangeResultsListeners(e);break}this.getFinishedOpponents().length===this.options.amount&&!1!==this.options.lose&&this.onLoseListener()},Competition.prototype.getFinishedOpponents=function(){return this.results.filter(function(e){return e.id!==cleverapps.user.id&&e.amount===this.options.algo.maxResult}.bind(this))},Competition.prototype.runChangeResultsListeners=function(t){cleverapps.values(this.onChangeResultsListeners).forEach(function(e){e(t)})},Competition.prototype.stop=function(){this.running=!1,
delete cleverapps.competitionPlayers.onAvailableListeners[this.type],this.algorithm&&this.algorithm.stop()},Competition.prototype.onPlayersAvailable=function(){if(delete cleverapps.competitionPlayers.onAvailableListeners[this.type],this.running){var e=cleverapps.competitionPlayers.listPlayers(Math.min(this.countFakePlayers(),cleverapps.competitionPlayers.getAmount()));this.replaceFakePlayers(e),0<this.countFakePlayers()&&(cleverapps.competitionPlayers.onAvailableListeners[this.type]=this.onPlayersAvailable.bind(this))}},Competition.CLEAN_SAVED=function(e){cleverapps.DataLoader.remove(cleverapps.DataLoaderTypes.COMPETITION+"_"+e)},Competition.prototype.listFakePlayers=function(e){for(var t=[],i=0;i<e;i++)t.push({id:Math.round(1e6*Math.random()),name:"player"+i,fake:!0});return t},Competition.prototype.countFakePlayers=function(e){var t=0;return this.results.forEach(function(e){e.fake&&t++}),t},Competition.prototype.replaceFakePlayers=function(e){for(var t=0,
i=0;i<this.results.length&&t<e.length;i++){var s=this.results[i];s.fake&&(s.id=e[t].id,s.name=e[t].name,s.avatar=e[t].avatar,delete s.fake,t++)}this.save()},Competition.prototype.getPlayerById=function(t){return this.results.filter(function(e){return e.id===t})[0]},Competition.prototype.getResults=function(){return this.results.slice()},Competition.prototype.save=function(){this.options.store&&cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.COMPETITION+"_"+this.type,{results:this.results,algorithm:this.algorithm?this.algorithm.getData():void 0,level:this.options.level?this.options.level.getHumanReadableNumber():void 0})},Competition.prototype.onUserInfoChanged=function(){this.player.name=cleverapps.friends.getPlayer().name,this.player.avatar=cleverapps.friends.getPlayer().avatar,this.player.id=cleverapps.friends.getPlayer().id,this.save()};var CompetitionPlayers=function(){this.onAvailableListeners={},this.load(),this.reload(),setInterval(this.reload.bind(this),
cleverapps.parseInterval(CompetitionPlayers.RELOAD_INTERVAL))};CompetitionPlayers.prototype.reload=function(){if(!this.reloading){this.reloading=!0;var e=function(e){this.reloading=!1,this.players=[];for(var t=0;t<e.length;t++)e[t].id!==levels.user.id&&e[t].name&&0<e[t].name.length&&this.players.push({id:e[t].id,name:e[t].name,avatar:e[t].avatar});if(this.save(),0<this.players.length)for(var i in this.onAvailableListeners)this.onAvailableListeners[i]()}.bind(this),t=function(){this.reloading=!1}.bind(this),i="/competitionplayers/?locale="+cleverapps.settings.language;cleverapps.config.debugMode&&(i="https://riddles.labsystech.ru/riddles-rest"+i),cleverapps.RestClient.get(i,{},e,t)}},CompetitionPlayers.prototype.getAmount=function(){return this.players.length},CompetitionPlayers.prototype.listPlayers=function(e){var t=this.players.splice(0,e);return this.save(),this.reload(),t},CompetitionPlayers.prototype.load=function(){this.players=cleverapps.DataLoader.load(
cleverapps.DataLoaderTypes.COMPETITION_PLAYERS)||[]},CompetitionPlayers.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.COMPETITION_PLAYERS,this.players)},CompetitionPlayers.RELOAD_INTERVAL="30 minutes";var CompetitionStatistics=function(){this.load()};CompetitionStatistics.prototype.onGameStarted=function(t){"board"===cleverapps.config.type&&(t.onChangeOutcomeListeners.competitionStatistics=function(){var e=Math.floor(t.timer.getTime()/t.board.countTotalWords()/1e3);this.saveBoardGameWordOpenByKeypadLengthTime(t.keypad.amountKeys(),e)}.bind(this))},CompetitionStatistics.prototype._newData=function(e,t){this.data[e]&&this._isAppropriateValue(e,t)&&(this.data[e]=Math.round(.9*this.data[e]+.1*t),this.save())},CompetitionStatistics.prototype._isAppropriateValue=function(e,t){return t>CompetitionStatistics.DEFAULTS[e]/5&&t<5*CompetitionStatistics.DEFAULTS[e]},CompetitionStatistics.prototype.saveBoardGameWordOpenByKeypadLengthTime=function(e,t){this._newData(
"brd_l"+e,t)},CompetitionStatistics.prototype.getBoardGameWordOpenByKeypadLengthTime=function(e){return e=Math.min(Math.max(e,4),9),this.data["brd_l"+e]},CompetitionStatistics.prototype.saveOneDifferenceFindTime=function(e){console.log("save diff time",e),this._newData("diff_time",e)},CompetitionStatistics.prototype.getOneDifferenceFindTime=function(){return this.data.diff_time},CompetitionStatistics.prototype.load=function(){this.updateInfo(cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.COMPETITION_STATISTICS)||{})},CompetitionStatistics.prototype.updateInfo=function(e,t){for(var i in this.data={},CompetitionStatistics.DEFAULTS)this.data[i]=e[i]&&this._isAppropriateValue(i,e[i])?e[i]:CompetitionStatistics.DEFAULTS[i];t&&this.save(!0)},CompetitionStatistics.prototype.getInfo=function(){var e={};for(var t in CompetitionStatistics.DEFAULTS)CompetitionStatistics.DEFAULTS[t]!==this.data[t]&&(e[t]=this.data[t]);return e},CompetitionStatistics.prototype.save=function(e){
cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.COMPETITION_STATISTICS,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("competitionstatistics")},CompetitionStatistics.DEFAULTS={brd_l4:8,brd_l5:15,brd_l6:20,brd_l7:30,brd_l8:40,brd_l9:50,diff_time:30};var CompetitionAlgorithm=function(e,t){this.competition=e,this.options=t,this.lastProcessed=t.lastProcessed||t.start,this.isPrepared()||this.prepareFromScratch(),this.competition.running&&(this.intervalProcess(),this.runInterval=setInterval(function(){this.competition.running?this.intervalProcess():this.stop()}.bind(this),this.intervalTimeout()))};CompetitionAlgorithm.prototype.stop=function(){this.runInterval&&(clearInterval(this.runInterval),this.runInterval=void 0)},CompetitionAlgorithm.prototype.getData=function(){return this.lastProcessed},CompetitionAlgorithm.prototype.process=function(e){for(var t=[],i=0;i<this.competition.results.length;i++){var s=this.competition.results[i];if(!s.player&&Math.random(
)<this.botProcessProb(s,e)){if(this.options.maxResult&&s.amount===this.options.maxResult)continue;var n=s.amount+this.processAmount();this.options.maxResult&&n>this.options.maxResult&&(n=this.options.maxResult),s.amount!==n&&t.push({id:s.id,amount:n})}}if(0<t.length){for(i=0;i<t.length;i++)this.competition.updatePlayerResult(t[i].id,t[i].amount);this.competition.save()}},CompetitionAlgorithm.prototype.isPrepared=function(){for(var e=0;e<this.competition.results.length;e++)if(!this.competition.results[e].player)return void 0!==this.competition.results[e].force;return!0},CompetitionAlgorithm.prototype.prepareFromScratch=function(){var e=this.competition.results;e.forEach(function(e){e.player||(e.amount=0,e.force=Math.floor(Math.random()*CompetitionAlgorithm.BOT_MAX_FORCE),this.options.minBotForce&&(e.force=Math.max(e.force,this.options.minBotForce)),e.sleep=this.generateSleepPeriod())},this);var t=this.options.superBotsForce;if(void 0===t){var i=Math.random()
;t=i<.2?0:i<.4?CompetitionAlgorithm.BOT_SUPER_FORCE:CompetitionAlgorithm.BOT_MAX_FORCE}if(0<e.length){var s=0,n=5;this.options.superBots&&(s=this.options.superBots[0],n=this.options.superBots[1]);var o=Math.floor(Math.random()*n)+1;o=Math.max(s,o);for(var a=0;a<o;a++)e[Math.floor(Math.random()*e.length)].force=t}this.competition.save()},CompetitionAlgorithm.prototype.generateSleepPeriod=function(){var e=this.options.finish-this.options.start;if(!(e<cleverapps.parseInterval("1 hour"))){var t=Math.floor(e/4+Math.random()*e/4),i=this.options.start+Math.floor(Math.random()*(e-t));return{s:i,f:i+t}}},CompetitionAlgorithm.prototype.offlineCoef=function(){return.2},CompetitionAlgorithm.prototype.playerAheadBotCoef=function(e){
return void 0!==this.options.playerAheadBotCoef?this.options.playerAheadBotCoef:e.force===CompetitionAlgorithm.BOT_SUPER_FORCE?10:e.force===CompetitionAlgorithm.BOT_MAX_FORCE?2:e.force===CompetitionAlgorithm.BOT_MAX_FORCE-1?1.5:e.force===CompetitionAlgorithm.BOT_MAX_FORCE-2?1.2:1},CompetitionAlgorithm.prototype.playerAheadBot5AmountCoef=function(e){return void 0!==this.options.playerAheadBotBigDifferenceCoef?this.options.playerAheadBotBigDifferenceCoef:e.force===CompetitionAlgorithm.BOT_SUPER_FORCE?100:2},CompetitionAlgorithm.prototype.botAheadPlayerCoef=function(e){return void 0!==this.options.botAheadPlayerCoef?this.options.botAheadPlayerCoef:.3},CompetitionAlgorithm.prototype.botAheadPlayer5AmountCoef=function(e){return void 0!==this.options.botAheadPlayerBigDifferenceCoef?this.options.botAheadPlayerBigDifferenceCoef:.1},CompetitionAlgorithm.prototype.mediumAmount=function(){var e=this.options.step;return e?(e[0]+e[1])/2:1},CompetitionAlgorithm.prototype.processAmount=function(){
var e=this.options.step;return e?cleverapps.Random.random(e[0],e[1],!1):1},CompetitionAlgorithm.prototype.getBotForceCoef=function(e){if(this.options.useRealForce)return e;if(e===CompetitionAlgorithm.BOT_SUPER_FORCE)return 7;return[0,.03,.08,.15,.25,.35,.5,.7,1,1.5,2][e]},CompetitionAlgorithm.prototype.sleepNow=function(e){return!!e.sleep&&(e.sleep.s<=this.lastProcessed&&this.lastProcessed<=e.sleep.f)},CompetitionAlgorithm.prototype.bigDistanceLength=function(){return this.options.bigDistanceLength?this.options.bigDistanceLength:5},CompetitionAlgorithm.prototype.calcFromBotAmountCoef=function(e){if(!this.options.maxResult||this.options.maxResult<2)return 1;var t=(this.options.maxResult-1)/2;return 1.25-.75*(e.amount-t)/t},CompetitionAlgorithm.prototype.botProcessProb=function(e,t){if(this.sleepNow(e))return 0;var i=this.competition.player.amount,s=this.perIntervalProb(t);return e.amount>=i?(s*=this.botAheadPlayerCoef(e),e.amount>i+this.bigDistanceLength()*this.mediumAmount()&&(
s*=this.botAheadPlayer5AmountCoef(e))):(s*=this.playerAheadBotCoef(e),i>e.amount+this.bigDistanceLength()*this.mediumAmount()&&(s*=this.playerAheadBot5AmountCoef(e))),this.options.botFinishCoef&&this.options.maxResult&&e.amount+this.mediumAmount()>=this.options.maxResult&&(s*=this.options.botFinishCoef),(s*=this.calcFromBotAmountCoef(e))*this.playerEpisodeCoef()*this.getBotForceCoef(e.force)},CompetitionAlgorithm.prototype.perIntervalProb=function(e){return e?(this.offlinePerIntervalProb||(this.offlinePerIntervalProb=this.offlineCoef()*this.intervalTimeout(e)/this.maxForceBotAverageProcessTimeout()),this.offlinePerIntervalProb):(this.onlinePerIntervalProb||(this.onlinePerIntervalProb=this.intervalTimeout(e)/this.maxForceBotAverageProcessTimeout()),this.onlinePerIntervalProb)},CompetitionAlgorithm.prototype.intervalTimeout=function(e){return cleverapps.parseInterval(e?"10 minutes":"5 seconds")},CompetitionAlgorithm.prototype.freeze=function(e){var t=Date.now()
;this.lastProcessed>t?this.lastProcessed+=e:this.lastProcessed=t+e},CompetitionAlgorithm.prototype.intervalProcess=function(){var e=Date.now();if(!(this.lastProcessed>e)){var t=this.intervalTimeout(!0),i=this.intervalTimeout();if(!1!==this.options.offlineProcess)for(;this.lastProcessed<e-2*t;)this.lastProcessed+=t,this.process(!0);for(;this.lastProcessed<e-i/2;)this.lastProcessed+=i,this.process();this.lastProcessed=e,this.competition.save()}},CompetitionAlgorithm.prototype.maxForceBotAverageProcessTimeout=function(){return this.options.averageProcessTimeout?this.options.averageProcessTimeout:cleverapps.parseInterval("3 minutes")},CompetitionAlgorithm.prototype.playerEpisodelevel=function(){return 10<=levels.user.episode?2:5<=levels.user.episode?1:0},CompetitionAlgorithm.prototype.playerEpisodeCoef=function(){return this.options.noPlayerEpisodeCoef?1:[.1,.13,.15][this.playerEpisodelevel()]},CompetitionAlgorithm.BOT_MAX_FORCE=10,CompetitionAlgorithm.BOT_SUPER_FORCE=100,
cleverapps.Notification=cc.Scale9Sprite.extend({ctor:function(){this._super(bundles.main.frames.notification_bg_png),this.setLocalZOrder(cleverapps.styles.Notification.zOrder),this.baseHeight=new cc.Sprite(bundles.main.frames.notification_bg_png).height},setMessage:function(e,t){this.text&&(this.text.removeFromParent(!0),this.text=void 0),this.image&&(this.image.removeFromParent(!0),this.image=void 0);var i,s,n=cleverapps.styles.Notification,o=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.NOTIFICATION_TEXT?cleverapps.styles.FONTS.NOTIFICATION_TEXT:cleverapps.styles.FONTS.TEXT,t.toReplace),a=.85*cleverapps.UI.getSceneSize().width,r=!1;t.image&&(i=t.image.width*t.image.scale,s=t.image.height*t.image.scale,a-=i+n.image.margin),o.width>a&&(r=!0,o.setDimensions(a,0),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER)),this.text=o,this.addChild(o);var l=Math.max(n.width,o.width+n.paddingX+(t.image?i+n.image.margin:0)),c=Math.max(n.height,this.baseHeight);r&&(c=Math.max(c,
o.height-2*n.text.y+n.paddingY)),t.image&&(c=Math.max(c,s+2*n.image.margin-2*n.text.y+n.paddingY)),this.setContentSize(l,c),o.setPositionRound(t.image?this.width/2+i/2+n.image.margin/2:this.width/2,this.height/2+n.text.y),t.image&&(this.image=t.image,this.addChild(t.image),t.image.setPositionRound(i/2+2*n.image.margin,this.height/2+n.text.y+n.image.y)),this.customize(),this.setPosition(this.base),cleverapps.audio.playSound(res.notification_effect),this.runAction(new cc.Sequence(new cc.MoveTo(.2,this.target),new cc.DelayTime(3),new cc.MoveTo(.5,this.base),new cc.RemoveSelf))},customize:function(){var e=cc.director.getWinSize();this.base=cc.p(e.width/2,e.height+this.height/2),this.target=cc.p(e.width/2,e.height-this.height/2-cleverapps.UI.getSceneOffsetY()+cleverapps.styles.Notification.targetY)}}),cleverapps.Notification.create=function(e,t){t=t||{};var i=cc.director.getRunningScene();if(i&&Messages.isInitialized()&&e&&cleverapps.allInitialized&&!cleverapps.scenes.isLoaderScene()){
var s=i.getChildByTag(cleverapps.Notification.TAG);s?s.stopAllActions():((s=new cleverapps.Notification).setTag(cleverapps.Notification.TAG),i.addChild(s)),this.leaveOnResize=t.leaveOnResize,s.setMessage(e,t)}},cleverapps.Notification.remove=function(e){var t=cc.director.getRunningScene();if(t&&!cleverapps.scenes.isLoaderScene()&&(!e||!this.leaveOnResize)){var i=t.getChildByTag(cleverapps.Notification.TAG);i&&i.removeFromParent()}},cleverapps.Notification.TAG=101,cleverapps.styles.Notification={zOrder:22,targetY:90,image:{margin:15,y:-10},text:{y:-30},height:200,width:150,paddingX:80,paddingY:30};var PagingScrollView=cc.Node.extend({ctor:function(e){this._super(),e=e||{},this.currentPage=e.beginPage?e.beginPage:0,this.amountPages=e.amountPages?e.amountPages:0;var t=this.styles=e.styles;this.direction=void 0!==t.direction?t.direction:PagingScrollView.DIRECTIONS.Horizontal,this.autoScroll=!t.noAutoScroll,this.visiblePages=t.visiblePages,this.prevPageShowed=t.prevEpisodeShowed,
this.firstOffset=0,this.pageHeight=e.pageHeight,this.pageWidth=e.pageWidth,this.middlePage=!1,cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:e.swallowTouches,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this),onTouchCancelled:this.onTouchEnded.bind(this)},this),e.noWheelScroll||cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseScroll:function(e){if(!this.isMoving&&!cleverapps.windows.list.length){var t=e._scrollY;if(0!=t)if(this.autoScroll)0<t?this.onNextPageListener():this.onPrevPageListener();else{t=0<t?cleverapps.styles.PagingScrollView.wheelScrollSpeed:-cleverapps.styles.PagingScrollView.wheelScrollSpeed,this.basePosition=this.container.getPosition();var i=this.getScrollLength();this.direction===PagingScrollView.DIRECTIONS.Horizontal?(t=Math.max(this.basePosition.x-this.firstOffset,Math.min(i.x+this.basePosition.x,t)),this.deltaMove([-t,0])):(t=Math.max(
this.basePosition.y-this.firstOffset,Math.min(i.y+this.basePosition.y,t)),this.deltaMove([0,-t]))}}}.bind(this)},this),this.onNextPageListener=function(){},this.onPrevPageListener=function(){},this.onScrolledToCurrentPage=function(){},this.container=new cc.Node,this.addChild(this.container),this.scheduleUpdate()},update:function(e){this._super(e),1<this.visiblePages&&this.calcCurrentPage(!0)},calcFirstOffset:function(){this.styles.firstOffset?this.firstOffset=this.styles.firstOffset:1<this.visiblePages&&(this.isHorizontal()?this.firstOffset=this.pageWidth/2:this.firstOffset=this.pageHeight/2)},getScrollLength:function(){var e={x:0,y:0};return this.direction===PagingScrollView.DIRECTIONS.Horizontal?e.x=(this.amountPages-this.visiblePages)*this.pageWidth:(e.y=(this.amountPages-this.visiblePages)*this.pageHeight+cleverapps.styles.PagingScrollView.comingSoonExtraLength[cleverapps.wideMode.mode],e.y-=2*cleverapps.UI.getSceneOffsetY()),e},onTouchBegan:function(e){if(
cleverapps.metha.isFocused())return!1;if(this.touchBeganId=e.getID(),this.isMoving){if(this.autoScroll)return!1;this.container.stopAllActions(),this.calcCurrentPage()}var t=this.convertTouchToNodeSpace(e);return this.horizontalLookDirection=void 0,this.basePoint=t,this.prevPoint=t,this.prevPointTime=0,this.prevPointCalcTimes=0,this.deltaPoint=0,this.basePosition=this.container.getPosition(),this.isMoving=!1,cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)},deltaMove:function(e,t){var i=this.getScrollLength();if(this.isHorizontal()){if(this.basePosition.x+e[0]>this.firstOffset+1e-6||this.basePosition.x+e[0]+1e-6<-i.x)return void(this.isMoving=!1)}else if(this.basePosition.y+e[1]>this.firstOffset+1e-6||this.basePosition.y+e[1]+1e-6<-i.y)return void(this.isMoving=!1);var s=t?PagingScrollView.MOVE_TRESHOLD:0;(Math.abs(e[0])>s*this.pageWidth||Math.abs(e[1])>s*this.pageHeight)&&(this.isMoving=!0,this.showPages(e)),this.isMoving&&(cleverapps.audio.playSound(res.pagingscroll),t?(
this.container.setPosition(this.basePosition.x+e[0],this.basePosition.y+e[1]),this.autoScroll||this.calcCurrentPage()):(this.showPages(e),this.container.runAction(new cc.Sequence(new cc.MoveTo(.3,{x:this.basePosition.x+e[0],y:this.basePosition.y+e[1]}),new cc.CallFunc(function(){this.isMoving=!1,this.calcCurrentPage()}.bind(this))))))},onTouchMoved:function(e){if(this.touchBeganId!==e.getID())return!1;var t=this.convertTouchToNodeSpace(e),i=[t.x-this.basePoint.x,t.y-this.basePoint.y];if(!this.autoScroll&&this.isVertical()&&this.width<cleverapps.styles.SCENE_MAX_WIDTH&&!cleverapps.styles.horizontalScrollDisabled&&(void 0===this.horizontalLookDirection&&(Math.abs(i[0])>PagingScrollView.MOVE_TRESHOLD*this.pageWidth||Math.abs(i[1])>PagingScrollView.MOVE_TRESHOLD*this.pageHeight)&&(Math.abs(i[0])>2*Math.abs(i[1])?this.horizontalLookDirection=!0:this.horizontalLookDirection=!1),this.horizontalLookDirection)){var s=i[0];return s=Math.min(s,(cleverapps.styles.SCENE_MAX_WIDTH-this.width
)/2-this.basePosition.x),s=Math.max(s,-(cleverapps.styles.SCENE_MAX_WIDTH-this.width)/2-this.basePosition.x),void this.container.setPosition(this.basePosition.x+s,this.basePosition.y)}this.isHorizontal()?i[1]=0:i[0]=0,this.autoScroll||this.calcDeltaPoint(t),this.deltaMove(i,!0)},onEnter:function(){this._super(),this.showCurrentPageOnly()},onExitTransitionDidStart:function(){this._super(),this.showCurrentPageOnly()},showPages:function(e){for(var t={},i=0;i<this.visiblePages;i++)t[this.currentPage+i]=!0;this.prevPageShowed&&(t[this.currentPage-1]=!0);var s=this.currentPage+(e[0]<0||e[1]<0?this.visiblePages:-1);if(t[s]=!0,"number"==typeof this.middlePage)t[this.middlePage]&&(t[this.middlePage+1]=!0),t[this.middlePage]=!0;else{var n=this.currentPage+(e[0]<0||e[1]<0?-1:this.visiblePages);t[n]=!0}this.getPages().forEach(function(e){e.setVisible(t[e.pageNo])}.bind(this))},getPages:function(){return this.container.getChildren().filter(function(e){return void 0!==e.pageNo})},
getVisiblePages:function(){return this.container.getChildren().filter(function(e){return void 0!==e.pageNo&&e.visible})},showCurrentPageOnly:function(){this.getPages().forEach(function(e){e.setVisible(this.currentPage+(this.prevPageShowed?-1:0)<=e.pageNo&&e.pageNo<this.currentPage+this.visiblePages||this.middlePage===e.pageNo)}.bind(this))},isHorizontal:function(){return this.direction===PagingScrollView.DIRECTIONS.Horizontal},isVertical:function(){return!this.isHorizontal()},getCurrentPagePosition:function(e){void 0===e&&(e=this.currentPage);var t=new cc.p(this.isHorizontal()?-e*this.pageWidth:0,this.isVertical()?-e*this.pageHeight:0);if(1<this.visiblePages){t=cc.p(t.x+(this.isHorizontal()?this.firstOffset:0),t.y+(this.isVertical()?this.firstOffset:0));var i=this.getScrollLength();this.isHorizontal()?t.x=Math.min(this.firstOffset,Math.max(t.x,-i.x)):t.y=Math.min(this.firstOffset,Math.max(t.y,-i.y))}return t},calcCurrentPage:function(e){var t=this.container.getPosition(),
i=this.pageWidth;this.isHorizontal()?t=t.x:(t=t.y,i=this.pageHeight),0<t&&(t=0);var s=this.currentPage;this.currentPage=cleverapps.config.rpg?Math.floor(-t/i)+1:Math.round(-t/i),e&&s===this.currentPage||(this.middlePage=this.currentPage+this.visiblePages,this.showCurrentPageOnly(),s<this.currentPage?this.onNextPageListener():s>this.currentPage&&this.onPrevPageListener())},scrollToPositionInPage:function(e,t){var i,s=this.getCurrentPagePosition();this.direction===PagingScrollView.DIRECTIONS.Horizontal?((i=this.width/2+e.x)<0&&(i=0),s.x=Math.max(this.container.x-i,-(this.amountPages-1)*this.width)):((i=this.height/2+e.y-.3*this.height)<0&&(i=0),s.y=Math.max(this.container.y-i,-(this.amountPages-1)*this.height),s.y<0&&(s.y+=cleverapps.UI.getSceneOffsetY())),this.scrollToPosition(s,t)},scrollToPosition:function(e,t,i){t?(this.container.setPosition(e),this.calcCurrentPage()):(this.container.stopAllActions(),i=i||1,this.showPages([e.x-this.container.x,e.y-this.container.y]),this.isMoving=!0,
this.container.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.MoveTo(i,e),new cc.CallFunc(function(){this.calcCurrentPage(),this.isMoving=!1}.bind(this)))))},scrollToCurrentPage:function(e,t,i,s){var n=this.getCurrentPagePosition(s);if(e)this.container.setPosition(n),this.autoScroll?this.showCurrentPageOnly():this.calcCurrentPage(),this.onScrolledToCurrentPage();else{if(t){var o=cleverapps.styles.PagingScrollView;cleverapps.audio.playSound(o.swipeSound?res[o.swipeSound]:res.window_effect)}this.container.stopAllActions();var a=.25;i&&(a=cleverapps.styles.PagingScrollView.slowScroll.timeout),this.showPages([this.container.x-n.x,n.y-this.container.y]),this.isMoving=!0,this.container.runAction(new cc.Sequence(new cc.MoveTo(a,n),new cc.CallFunc(function(){this.autoScroll?this.showCurrentPageOnly():this.calcCurrentPage(),this.onScrolledToCurrentPage(),this.isMoving=!1}.bind(this))))}},calcDeltaPoint:function(e){var t=Date.now();if(0===this.prevPointTime)return this.prevPointTime=t,
void(this.prevPoint=e);this.prevPointTime<t-PagingScrollView.SCROLL_SPEED_PERIODS[this.prevPointCalcTimes]&&(this.prevPointTime<t-200&&(this.prevPoint=e),this.deltaPoint=this.isHorizontal()?e.x-this.prevPoint.x:e.y-this.prevPoint.y,this.deltaPoint=this.deltaPoint/(t-this.prevPointTime)*cleverapps.styles.PagingScrollView.touchScrollSpeedLevel,this.prevPointTime=t,this.prevPointCalcTimes<PagingScrollView.SCROLL_SPEED_PERIODS.length-1&&this.prevPointCalcTimes++,this.prevPoint=e)},onTouchEnded:function(e){if(this.touchBeganId!==e.getID())return!1;if(this.isMoving=!1,this.autoScroll){var t=this.getCurrentPagePosition(),i=this.container.getPosition();Math.abs(t.x-i.x)>PagingScrollView.SWIPE_TRESHOLD*this.pageWidth||Math.abs(t.y-i.y)>PagingScrollView.SWIPE_TRESHOLD*this.pageHeight?i.x<t.x||i.y<t.y?this.onNextPageListener():this.onPrevPageListener():this.scrollToCurrentPage(!1)}else{if(this.horizontalLookDirection)return this.isMoving=!0,void this.container.runAction(new cc.Sequence(
new cc.MoveTo(.5,{x:0,y:this.basePosition.y}).easing(cc.easeOut(3)),new cc.CallFunc(function(){this.isMoving=!1}.bind(this))));this.calcCurrentPage(),this.calcDeltaPoint(this.convertTouchToNodeSpace(e)),this.deltaPoint=Math.max(Math.min(Math.round(this.deltaPoint),5),-5),this.showPages([this.deltaPoint,this.deltaPoint]),this.isMoving=!0;var s=this.container.getPosition(),n=Math.max(.5,Math.sqrt(Math.abs(this.deltaPoint))/2),o=this.getScrollLength();this.direction===PagingScrollView.DIRECTIONS.Horizontal?(s.x=Math.min(this.firstOffset,Math.max(s.x+this.deltaPoint*cleverapps.styles.PagingScrollView.scrollInertia,-o.x)),s.y=0):(s.x=0,s.y=Math.min(this.firstOffset,Math.max(s.y+this.deltaPoint*cleverapps.styles.PagingScrollView.scrollInertia,-o.y))),this.container.runAction(new cc.Sequence(new cc.MoveTo(n,s).easing(cc.easeOut(2)),new cc.CallFunc(function(){this.calcCurrentPage(),this.isMoving=!1}.bind(this))))}},addPage:function(e){this.container.addChild(e),e.onShow&&e.onShow(),
this.isMoving||this.showCurrentPageOnly()}});cleverapps.styles.PagingScrollView={swipeSound:!1,touchScrollSpeedLevel:2,wheelScrollSpeed:700,scrollInertia:200,comingSoonExtraLength:[0,0,0],slowScroll:{timeout:.8}},PagingScrollView.DIRECTIONS={Horizontal:0,Vertical:1},PagingScrollView.MOVE_TRESHOLD=.01,PagingScrollView.SWIPE_TRESHOLD=.05,PagingScrollView.SCROLL_SPEED_PERIODS=[25,50,75,100];var MapScrollView=cc.Node.extend({ctor:function(){this._super(),this.container=new cc.Node,this.addChild(this.container),this.scheduleUpdate(),this.scrollHandler=new cleverapps.UI.MapScrollHandler(this),this.zoom=1,this.updateChildren=cleverapps.throttle(25,this.checkChildrenVisibility.bind(this))},zoomTo:function(t){var i=this.zoom,s=Date.now(),n=(t.zoom-i)/t.timeout;this._zoomInterval=setInterval(this.createListener(function(){var e=Date.now()-s;if(e>=t.timeout)return this.setZoom(t.zoom),clearInterval(this._zoomInterval),void(t.onComplete&&t.onComplete());this.setZoom(i+n*e,t.centerPoint)}),13)},
setZoom:function(e,t){this.scrollHandler.stopAutoScroll();var i=cc.director.getWinSize(),s=this.getContainerSize();e=Math.max(e,cleverapps.styles.WorldMap.zoom.minScale,i.width/s.width,i.height/s.height),e=Math.min(e,1.1);var n=this.zoom;this.zoom=e,this.setScale(this.zoom);var o=this.getContainerPosition();this.setContentSize2(Math.ceil(i.width/this.zoom),Math.ceil(i.height/this.zoom));var a=0,r=0;if(n&&(a=Math.ceil(i.width/this.zoom)-Math.ceil(i.width/n),r=Math.ceil(i.height/this.zoom)-Math.ceil(i.height/n)),t){var l=Math.abs(t.x)+i.width/2-s.width/2;0<l&&(0<t.x?a-=l:a+=l);var c=Math.abs(t.y)+i.height/2-s.height/2;0<c&&(0<t.y?r-=c:r+=c)}this.setContainerPosition(this.availableScrollPosition({x:o.x+a/2,y:o.y+r/2}),this.zoom<n)},setContainerSize:function(e){this.innerWidth=e.width,this.innerHeight=e.height,this.container.setContentSize2(e)},getContainerSize:function(){return this.container.getContentSize()},getContainerPosition:function(){return this.container.getPosition()},
setContainerPosition:function(e,t){(e.x!==this.container.getPositionX()||e.y!==this.container.getPositionY()||t)&&(this.container.setPosition(e),this.updateChildren(),this.scrollHandler.afterContainerMove())},update:function(e){this._super(e),this.scrollHandler.processAutoScroll(e)},onEnter:function(){this._super(),this.addControls()},checkChildrenVisibility:function(){this.container.getChildren().forEach(function(e){!e.visible&&this.isInContainer(e)?e.needToHide&&e.needToHide()?e.visible=!1:e.visible=!0:e.visible&&!this.isInContainer(e)&&(e.visible=!1)},this)},isInContainer:function(e){var t=cleverapps.styles.MapScrollView.visiblePadding,i=this.getContainerPosition(),s=this.getContentSize(),n=cc.rect(-i.x,-i.y,s.width,s.height),o=e.getBoundingBox();o.x-=t.width/2,o.y-=t.height/2,o.width+=t.width/2,o.height+=t.height/2;var a=cc.rectIntersection(n,o);return 0<a.width&&0<a.height},addControls:function(){cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseScroll:function(e){
if(cleverapps.metha.isControlEnabled()){var t=e._scrollY;0!==t&&(t=0<t?.05:-.05,this.setZoom(this.zoom+t))}}.bind(this)},this),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this),onTouchCancelled:this.onTouchEnded.bind(this)},this),cc.sys.isMobile&&cc.sys.capabilities.touches&&this.addPinchZoom()},addPinchZoom:function(){var n={},o=0,a=function(){var e=Object.keys(n).slice(0,2).map(function(e){return n[e]},this),t=e[0],i=e[1];return Math.abs(t.x-i.x)+Math.abs(t.y-i.y)},e=function(e){for(var t=0;t<e.length&&t<2;t++)n[e[t].getID()]=e[t].getLocationInView();1<Object.keys(n).length&&(this.pinchZooming=!0,o=a())}.bind(this),t=function(e){for(var t=0;t<e.length&&t<2;t++)n[e[t].getID()]=e[t].getLocationInView();if(cleverapps.metha.isControlEnabled()&&1<Object.keys(n).length){var i=a(),s=o-i;3<Math.abs(s)&&(o=i,this.setZoom(
this.zoom-85e-5*s))}}.bind(this),i=function(e){for(var t=0;t<e.length;t++)delete n[e[t].getID()];Object.keys(n).length<2&&(this.pinchZooming=!1)}.bind(this);cc.eventManager.addListener({event:cc.EventListener.TOUCH_ALL_AT_ONCE,onTouchesBegan:e,onTouchesMoved:t,onTouchesCancelled:i,onTouchesEnded:i},this)},onTouchBegan:function(e){return!!cleverapps.metha.isControlEnabled()&&(this.container.stopAllActions(),this.scrollHandler.handlePress(),cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),this.convertTouchToNodeSpace(e)))},onTouchMoved:function(e){if(!cleverapps.metha.isControlEnabled())return!1;var t=this.convertToNodeSpace(e.getLocation()),i=this.convertToNodeSpace(e.getPreviousLocation()),s=cc.pSub(t,i);this.pinchZooming||(this.scrollHandler.gatherMoveData(s),this.moveContainer(s))},onTouchEnded:function(e){if(!cleverapps.metha.isControlEnabled())return!1;if(!this.pinchZooming){var t=this.convertToNodeSpace(e.getLocation()),i=this.convertToNodeSpace(e.getPreviousLocation()),
s=cc.pSub(t,i);this.scrollHandler.handleRelease(s)}},moveContainer:function(e){var t=cc.pAdd(this.getContainerPosition(),e);this.setContainerPosition(t)}});cleverapps.styles.MapScrollView={visiblePadding:{width:40,height:40}};var PagesViewParallax=function(e,t,i){if(this.parallaxBackgrounds=[],this.direction=i,e&&e.layers){for(var s=cleverapps.UI.getSceneSize(),n="scene"===e.width?s.width:e.width,o="scene"===e.height?s.height:e.height,a=0;a<e.layers[cleverapps.wideMode.mode];a++){var r,l=bundles.main.urls["episodes_bg_jpg_"+a],c=bundles[e.bundle];if(c&&(r=c.jsons["side_animation_"+a]),l||r){var p=new ParallaxBackground(e.speed[a],this.direction,function(e){var t=new cc.Node;if(t.setContentSize2(n,o),t.setAnchorPoint2(),l){var i=new cc.Sprite(l);i.setPositionRound(t.width/2,t.height/2),this.parallaxBackgrounds.push(i),t.addChild(i)}if(r){var s=new cleverapps.Spine(r);s.setAnimation(0,"animation",!0),t.addChild(s),s.setPositionRound(t.width/2,t.height/2)}return t}.bind(this))
;p.setLocalZOrder(e.zIndex[a]),t.addChild(p)}}this.updateScale()}};PagesViewParallax.prototype.updateScale=function(){var i=cc.director.getWinSize();this.parallaxBackgrounds.forEach(function(e){var t=Math.max(i.width/e.width,i.height/e.height);e.setScale(t)})};var ParallaxBackground=cc.Node.extend({ctor:function(e,t,i){this._super(),this.ratio=e,this.direction=t;var s=this.frame1=new ParallaxFrame(i(0),cc.p(0,0),t);this.addChild(s);var n=this.frame2=new ParallaxFrame(i(1),cc.p(s.width-2,s.height-2),t);this.addChild(n),this.scheduleUpdate()},onEnterTransitionDidFinish:function(){this._super(),this.updatePosition()},update:function(e){this._super(e),this.updatePosition()},updatePosition:function(){this.y=-this.parent.y*(1-this.ratio),this.x=-this.parent.x*(1-this.ratio),this.frame1.updatePosition(),this.frame2.updatePosition()}}),ParallaxFrame=cc.Node.extend({ctor:function(e,t,i){this._super(),this.direction=i,this.offset=t,this.frame=e,this.addChild(e),this.setContentSize2(
e.getContentSize()),this.setAnchorPoint2(),this.setPositionRound(this.width/2,this.height/2)},updatePosition:function(){var e=cleverapps.UI.getSceneSize(),t=this.frame,i=t.width,s=t.height;if(this.direction===PagingScrollView.DIRECTIONS.Horizontal){var n=-(this.parent.parent.x+this.parent.x);t.x=Math.floor(n/i)*i+i/2+this.offset.x,t.y=s/2,t.visible=0<=-n+t.x+i/2&&-n+t.x-i/2<e.width}else{var o=-(this.parent.parent.y+this.parent.y);t.x=i/2,t.y=Math.floor(o/s)*s+s/2+this.offset.y,t.visible=0<=-o+t.y+s/2&&-o+t.y-s/2<e.height}}}),Fireworks=cc.Node.extend({ctor:function(e){this._super(),this.loop=void 0===e||e,cleverapps.bundleLoader.loadBundle("fireworks",{onSuccess:function(){this.runOnePass()}.bind(this)}),this.setLocalZOrder(100)},runOnePass:function(){var e=cleverapps.styles.Fireworks.delays,t=cleverapps.styles.SCENE_HEIGHT*cleverapps.styles.SCENE_MAX_WIDTH,i=cleverapps.UI.getSceneSize(),s=i.height*i.width,n=Math.round(s/t*e.length);e=(e=e.sort(function(e,t){return Math.random()-.5})
).slice(0,n);var o=cleverapps.wait(e.length,this.runOnePass.bind(this));e.forEach(function(e){this.runAction(new cc.Sequence(new cc.DelayTime(e/1e3),new cc.CallFunc(function(){this.createFirework(),this.loop&&o()}.bind(this))))}.bind(this))},createFirework:function(){if(!cleverapps.flags.fireworkDisabled){var e=FireworksAnimation.Create();e.setScale(.3*Math.random()+.7),e.setAnimation(0,"animation"+(Math.floor(Math.random()*Fireworks.AMOUNT_ANIMATIONS)+1),!1),e.setCompleteListener(function(){e.removeFromParent(),cc.pool.putInPool(e)});var t=cleverapps.UI.getSceneSize();e.setPositionRound({random:{start:0,end:t.width}},{random:{start:Math.round(t.height/3),end:t.height}}),this.addChild(e),this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.fireworks.urls.fireworks_effect)})))}}}),FireworksAnimation=cleverapps.Spine.extend({ctor:function(){this._super(bundles.fireworks.jsons.fireworks_json)}})
;FireworksAnimation.Create=function(){return cc.pool.hasObject(FireworksAnimation)?cc.pool.getFromPool(FireworksAnimation):new FireworksAnimation},Fireworks.AMOUNT_ANIMATIONS=5,cleverapps.styles.Fireworks={delays:[0,100,200,300,400,500,3e3,3050,3130,3330,3400,4600,6e3,6030,6130,6200,6400,6420,6450]};var FingerView=cc.Node.extend({ctor:function(e){e=e||{},this._super(),this.setAnchorPoint2(),this.setScale(e.scaleX||1,e.scaleY||1),this.finger=new cc.Sprite(e.image?e.image:bundles.finger.frames.tutorial_hand_png),this.finger.setAnchorPoint(FingerView.ANCHOR_POINT),this.moveSpeed=500,this.actions=[],e.pathColor&&(this.pathNode=new cleverapps.Path(cc.color(e.pathColor.r,e.pathColor.g,e.pathColor.b,FingerView.PATH_BASE_ALPHA)),this.pathNode.lineWidth=FingerView.PATH_LINE_WIDTH,this.addChild(this.pathNode,-2),this.pathNode.runAction(new cc.RepeatForever(new cc.Sequence(new cc.DelayTime(.02),new cc.CallFunc(this.drawPath.bind(this)))))),this.addChild(this.finger),this.finger.setOpacity(0),
e.control&&cleverapps.metha.registerControl(e.control,this.createListener(function(e){this.setVisible(e)}.bind(this)))},standardLoop:function(){this.fadeIn({x:0,y:0}),this.addPressLoops(2),this.fadeOut(),this.delay(1),this.run({looped:!0})},addPressLoops:function(e){for(var t=0;t<(e||1);t++)this.delay(.1),this.press(),this.delay(.1),this.unPress()},clearActions:function(){this.actions=[]},drawPath:function(){this.pathNode.draw(this.finger.getPosition())},addAction:function(e){this.actions.push(e)},run:function(e){this.currentAction=0,this.runOptions=e||{},this.startCurrentAction()},runOnce:function(e){this.run({looped:!1,onFinish:function(){this.clearActions(),e&&e()}.bind(this)})},startCurrentAction:function(){if(0!==this.actions.length){if(this.currentAction===this.actions.length){if(!this.runOptions.looped)return void(this.runOptions.onFinish&&this.runOptions.onFinish());this.currentAction=0,this.runOptions.onIterationFinish&&this.runOptions.onIterationFinish()}
this.actions[this.currentAction](this.nextAction.bind(this))}},nextAction:function(){this.currentAction++,this.startCurrentAction()},fadeIn:function(t,i){i=i||cc.p(t.x,t.y+cleverapps.styles.FingerView.dy),this.addAction(function(e){this.finger.setOpacity(0),this.finger.setScale(1),this.finger.setRotation(FingerView.FINGER_UNPRESSED_ANGLE),this.pressed=!1,this.finger.setPosition(i),this.finger.runAction(new cc.Sequence(new cc.MoveTo(.3,cc.p(t.x+cleverapps.styles.FingerView.deltaXforCircle,t.y)),new cc.CallFunc(e))),this.finger.runAction(new cc.FadeIn(.3))}.bind(this))},fadeOut:function(){this.addAction(function(e){this.finger.runAction(new cc.MoveTo(.3,cc.p(this.finger.x,this.finger.y-cleverapps.styles.FingerView.dy))),this.finger.runAction(new cc.Sequence(new cc.FadeOut(.3),new cc.CallFunc(e)))}.bind(this))},delay:function(t){this.addAction(function(e){this.finger.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.CallFunc(e)))}.bind(this))},moveTo:function(i){this.addAction(
function(e){var t=Math.sqrt((i.x-this.finger.x)*(i.x-this.finger.x)+(i.y-this.finger.y)*(i.y-this.finger.y))/this.moveSpeed;this.finger.runAction(new cc.Sequence(new cc.MoveTo(t,i),new cc.CallFunc(function(){this.pressed&&this.pathNode&&this.pathNode.push(i),e()}.bind(this))))}.bind(this))},unPress:function(){this.addAction(function(e){this.pressed=!1,this.finger.runAction(new cc.RotateTo(.2,FingerView.FINGER_UNPRESSED_ANGLE)),this.pathNode&&this.pathNode.animateFadeOut(400),this.finger.runAction(new cc.Sequence(new cc.ScaleTo(.2,1),new cc.CallFunc(e)))}.bind(this))},press:function(){this.addAction(function(i){this.pressed=!0,this.pathNode&&(this.pathNode.reset(),this.pathNode.push(this.finger.getPosition())),this.finger.runAction(new cc.RotateTo(.2,FingerView.FINGER_PRESSED_ANGLE)),this.finger.runAction(new cc.Sequence(new cc.ScaleTo(.2,.7),new cc.CallFunc(function(){var e=new cc.Sprite(bundles.finger.frames.tutorial_click_png),t=this.finger.getPosition();e.setPosition(cc.p(
t.x-cleverapps.styles.FingerView.deltaXforCircle,t.y)),e.setScale(0),this.addChild(e,-1),e.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.FadeTo(.3,0),new cc.RemoveSelf)),e.runAction(new cc.ScaleTo(.5,1)),i()}.bind(this))))}.bind(this))}});FingerView.BUNDLES=["finger"],FingerView.ANCHOR_POINT=cc.p(.1,.9),FingerView.PATH_BASE_ALPHA=255,FingerView.PATH_SEGMENTS=100,FingerView.PATH_LINE_WIDTH=15,FingerView.FINGER_PRESSED_ANGLE=0,FingerView.FINGER_UNPRESSED_ANGLE=-7,cleverapps.styles.FingerView={dy:50,deltaXforCircle:0},cleverapps.CountDownView=cc.Node.extend({ctor:function(e,t){var i;t=t||{},i=(this.style=t).background_content?t.background_content:cleverapps.UI.createSprite(t.background_image),this._super(),this.setAnchorPoint(.5,.5),i&&(this.setContentSize2(i.getContentSize()),i.setPositionRound(this.width/2,this.height/2),this.addChild(i)),i.setCascadeOpacityEnabled(!0),this.countDown=e;var s=t.timerPosition||cleverapps.styles.CountDownView.timerPosition,n=new cc.Node
;n.setAnchorPoint(.5,.5),n.setContentSize2(this.getContentSize()),n.setPositionRound(this.width/2+s.x,this.height/2+s.y),n.setCascadeOpacityEnabled(!0),this.addChild(n),this.leftTimeText=n,this.font=t.font||cleverapps.styles.FONTS.TEXT,this.resetString(""),this.refresh(),n.setAnchorPoint2(.5,.5),this.width||(this.setContentSize2(this.text.getContentSize()),n.setContentSize2(this.getContentSize()),n.setPositionRound(this.width/2+s.x,this.height/2+s.y),this.text.setPositionRound(n.width/2,n.height/2))},onEnter:function(){this._super(),this.countDown.onSecond=this.createListener(function(){this.refresh()}.bind(this))},resetString:function(e){this.text&&this.text.removeFromParent(!0),this.text=cleverapps.UI.generateTTFText(e,this.font),this.text.setPositionRound(this.leftTimeText.width/2,this.leftTimeText.height/2),this.leftTimeText.addChild(this.text)},fitTo:function(e,t){this.text&&this.text.fitTo(e,t)},setString:function(e){
this.text instanceof cleverapps.UI.ImageFont===cleverapps.UI.ImageFont.IsApplicable(this.font,e)?this.text.setString(e):this.resetString(e)},refresh:function(){var e=cleverapps.intervalToString(this.countDown.getTimeLeft(),this.style.showHours);this.setString(e);var t=this.style.timerPosition;cleverapps.UI.ImageFont.IsApplicable(this.font,e)||(t=this.style.regularFontTimerPosition||this.style.timerPosition),t=t||cleverapps.styles.CountDownView.timerPosition,this.leftTimeText.setPositionRound(this.width/2+t.x,this.height/2+t.y)},whatToDoOnStop:function(){this.countDown.permanent?this.countDown.onSecond=function(){}:this.countDown.remove()},onExitTransitionDidStart:function(){this._super(),this.whatToDoOnStop()}}),cleverapps.CountDown=function(e,t){this.onSecond=function(){},t=t||{},this.onFinish=t.onFinish||function(){},this.onTick=t.onTick||function(){},this.permanent=t.permanent,this.pauseOnGameHide=t.pauseOnGameHide,e<=0?this.onFinish():this.resetTimeLeft(e),
cleverapps.CountDownManager.isPaused&&this.pause()},cleverapps.CountDown.prototype.remove=function(){void 0!==this.interval&&cleverapps.CountDownManager.removeListener(this.interval),this.interval=void 0,this.onFinish=function(){},this.onSecond=function(){}},cleverapps.CountDown.prototype.stop=function(){this.remove(),this.timeStop=Date.now()},cleverapps.CountDown.prototype.pause=function(){this.pauseOnGameHide&&!this.isPaused()&&this.isRunning()&&(this.timeFinish-Date.now()<=0||(this.timePause=Date.now(),cleverapps.CountDownManager.pause(this.interval)))},cleverapps.CountDown.prototype.resume=function(){this.isPaused()&&(this.timeFinish=Date.now()+(this.timeFinish-this.timePause),delete this.timePause,cleverapps.CountDownManager.resume(this.interval))},cleverapps.CountDown.prototype.isPaused=function(){return void 0!==this.timePause},cleverapps.CountDown.prototype.isRunning=function(){return void 0!==this.interval},cleverapps.CountDown.prototype.getTimeLeft=function(){
return this.timeFinish?this.timeStop?this.timeFinish-this.timeStop:Math.max(this.timeFinish-Date.now(),0):0},cleverapps.CountDown.prototype.resetTimeLeft=function(e){this.resume(),this.timeStart=Date.now(),this.timeFinish=this.timeStart+e,void 0===this.interval&&(this.interval=cleverapps.CountDownManager.addListener(this))},cleverapps.CountDown.prototype.nextSecond=function(e){var t=this.timeFinish-e;t<0&&(t=0),this.onTick(t),this.onSecond(t),0===t&&(cleverapps.CountDownManager.removeListener(this.interval),this.interval=void 0,this.onFinish())},cleverapps.LongTimeout=function(e,t,i){t<=cleverapps.LongTimeout.THRESHOLD?this.timeout=setTimeout(e,t):((i=i||{}).onFinish=e,cleverapps.CountDown.call(this,t,i))},cleverapps.LongTimeout.prototype=Object.create(cleverapps.CountDown.prototype),cleverapps.LongTimeout.prototype.constructor=cleverapps.CountDown,cleverapps.LongTimeout.prototype.clear=function(){void 0!==this.timeout?clearTimeout(this.timeout):this.remove()},
cleverapps.CountDownManager={listeners:{},pausedListeners:{},uid:0,interval:!1,isPaused:!1,onTick:function(){var e=Date.now();for(var t in this.listeners)this.listeners[t]&&this.listeners[t].nextSecond(e)},initHideListeners:function(){cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){for(var e in this.isPaused=!1,this.pausedListeners)this.pausedListeners[e].resume()}.bind(this)),cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){for(var e in this.isPaused=!0,this.listeners)this.listeners[e].pause()}.bind(this))},addListener:function(e){var t=this.uid;return this.listeners[t]=e,this.uid++,!1===this.interval&&(this.interval=setInterval(this.onTick.bind(this),cleverapps.CountDown.INTERVAL),this.initHideListeners()),t},removeListener:function(e){delete this.listeners[e]},pause:function(e){this.listeners[e]&&(this.pausedListeners[e]=this.listeners[e],this.removeListener(e))},resume:function(e){this.pausedListeners[e]&&(this.listeners[e]=this.pausedListeners[e],
delete this.pausedListeners[e])}},cleverapps.CountDown.INTERVAL=1e3,cleverapps.LongTimeout.THRESHOLD=cleverapps.CountDown.INTERVAL,cleverapps.styles.CountDownView={timerPosition:{x:0,y:0}};var MenuBarItemView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2(),this.styles=cleverapps.styles.MenuBarItem,this.item=e,this.centerAlign=this.item.centerAlign,this.reset(),this.item.onRemove=this.createListener(this.remove.bind(this)),this.item.onChangeText=this.createListener(this.onChangeText.bind(this)),this.item.onChanged=this.createListener(this.reset.bind(this)),this.item.onShowForce=this.createListener(this.showForce.bind(this)),this.item.target&&(cleverapps.styles.MenuBar[this.item.getName()]||(cleverapps.styles.MenuBar[this.item.getName()]={}),this.registerTarget(cleverapps.styles.MenuBar[this.item.getName()])),e.tooltip&&cleverapps.tooltipManager.create(this,{text:Messages.get(e.tooltip),position:cleverapps.styles.UI.Tooltip.LOCATION.below})},makeHideable:function(){
cleverapps.UI.makeHideable(this,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("MenuBar"+this.item.getName(),this)},reset:function(){this.removeAllChildren(),this.addBg(),this.addIcon(),this.bg.setPositionRound(this.bg.width/2+this.iconScaledWidth/2,this.styles.bg.height/2),this.setContentSize2(this.bg.width+this.iconScaledWidth/2,this.bg.height),this.addPlusButton(),this.addHelpButton(),this.addText(),this.addIconText(),this.addAction(),SceneDecors.add(this,cleverapps.skins.getSlot("menuBarItem",{target:this})),this.item.lottery&&(-1!==["board","differences"].indexOf(cleverapps.config.type)&&cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&cleverapps.environment.isGameScene()||Lottery.addIcon(this,cleverapps.styles.MenuBarItem.lotteryIconPosition))},updateToSmallSize:function(e){this.useSmallSize=!0,this.needDelta=e,this.reset()},remove:function(){this.pauseHideHandler(),this.runAction(new cc.Sequence(new cc.ScaleTo(.3,0),new cc.RemoveSelf))},showForce:function(e){
this.show(!0),cleverapps.forces.create(this,e)},onChangeText:function(e){if(e&&this.item.changeTextDeltaAnimation&&!this.item.timer){this.text.stopAllActions(),this.text.setScale(this.text.baseScale);var t=this.item.getDeltaSound();t&&cleverapps.audio.playSound(t),this.text.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.4*this.text.baseScale),new cc.CallFunc(function(){cleverapps.UI.animateDelta(e,{x:this.bg.width/2+this.iconScaledWidth/2,y:this.styles.deltaAnimation.dy,parent:this,font:cleverapps.styles.FONTS.MENUBAR_TEXT}),this.text.setString(this.item.getText()),this.text.setPositionRound(this.getTextPosition())}.bind(this)),new cc.ScaleTo(.2,this.text.baseScale),new cc.CallFunc(function(){this.textFitTo()}.bind(this))))}else this.text.setString(this.item.getText()),this.textFitTo(),this.text.setPositionRound(this.getTextPosition())},addIcon:function(){var e=new cc.Sprite(this.item.getIcon());(this.icon=e).setScale(this.styles.icon.scale),this.iconScaledWidth=e.width*e.scale,
this.styles.icon.fullInsideBg&&(this.iconScaledWidth=0),this.addChild(e),e.setPositionRound({x:this.iconScaledWidth/2+this.styles.icon.x,y:this.styles.bg.height/2+this.styles.icon.y})},addIconText:function(){if(this.item.iconText){var e=this.iconText=cleverapps.UI.generateTTFText(this.item.getIconText(),cleverapps.styles.FONTS.LIVES_AMOUNT_TEXT);this.icon.addChild(e),e.fitTo(.7*this.icon.getBoundingBox().width),e.setPositionRound(this.styles.iconText.position)}},addBg:function(){this.bg=cleverapps.UI.createScale9Sprite(bundles.menubar.frames.menu_gold_bg_png);var e=this.styles.bg.width;this.useSmallSize&&(e=this.needDelta>this.styles.bg.width-this.styles.bg.minWidth?this.styles.bg.minWidth:this.styles.bg.width-this.needDelta),this.bg.setContentSize2(e,this.styles.bg.height),this.addChild(this.bg)},textFitTo:function(){var e=this.width-this.styles.iconBlockWidth;(this.helpButton||this.plusButtonOnBg)&&(e-=this.styles.plusBlockWidth),this.text.fitTo(e),this.text.baseScale=this.text.scale
},getTextPosition:function(){var e=0;this.helpButton||this.plusButtonOnBg||(e=cleverapps.styles.MenuBarItem.noPlusDx);var t=cleverapps.styles.MenuBarItem.textOffset.y;return this.text instanceof cleverapps.UI.ImageFont&&(t=cleverapps.styles.MenuBarItem.textOffset.imageFont||0),cc.p(this.width/2+this.iconScaledWidth/4+cleverapps.styles.MenuBarItem.textOffset.x+e,this.height/2+t)},addText:function(){var e=cleverapps.UI.generateTTFText(this.item.getText(),cleverapps.styles.FONTS.MENUBAR_TEXT);this.addChild(e),(this.text=e).baseScale=e.scale,e.setPositionRound(this.getTextPosition()),this.textFitTo()},addAction:function(){this.item.action&&(this.item.needPayments&&cleverapps.flags.nopayments||(cleverapps.UI.onClick(this,function(){this.item.action()}.bind(this)),cleverapps.UI.applyHover(this)))},addPlusButton:function(){if(this.item.plusButton){if(!this.item.needPayments||!cleverapps.flags.nopayments){var e=this.plusButton=new cleverapps.UI.Button({
button_png:bundles.menubar.frames.plus_button_png,button_on_png:bundles.menubar.frames.plus_button_on_png,onClicked:this.item.action});this.addChild(e);var t=cc.p(this.icon.x+this.iconScaledWidth/2,0);this.styles.plusButton&&this.styles.plusButton.position&&(this.plusButtonOnBg=!0,t=this.styles.plusButton.position),e.setPositionRound(t)}}else this.plusButtonOnBg=!1},addHelpButton:function(){if(this.item.helpButton){var e=this.helpButton=new cleverapps.UI.Button({button_png:bundles.menubar.frames.menubar_help_button_png,button_on_png:bundles.menubar.frames.menubar_help_button_on_png,onClicked:this.item.action});this.addChild(e),e.setPositionRound(this.styles.helpButton.position)}}});cleverapps.styles.MenuBarItem={textOffset:{x:0,y:0},noPlusDx:14,bg:{width:200,minWidth:170,height:50},iconBlockWidth:50,plusBlockWidth:50,deltaAnimation:{dy:-5},icon:{fullInsideBg:!1,scale:1,x:-10,y:0},iconText:{position:{x:{align:"center",dx:0},y:{align:"center",dy:0}}},plusButton:{position:{x:{
align:"right",dx:-5},y:{align:"center",dy:0}}},helpButton:{position:{x:{align:"right",dx:-5},y:{align:"center",dy:0}}}};var MenuBar=function(){var e=[MenuBarGoldItem,MenuBarLivesItem,MenuBarMethaStarsItem,MenuBarExpItem,MenuBarStarChestItem,MenuBarCryptexItem,MenuBarBonusRoundTimerItem];this.items=[],e.forEach(function(e){this.items.push(new e)},this)};MenuBar.prototype.getSceneItems=function(){var t=[];return this.items.forEach(function(e){e.isAvailableOnScene()&&(e.init(),t.push(e))}),t};var MenuBarView=cc.Node.extend({ctor:function(e,t){this._super();var i=cleverapps.menuBar.getSceneItems(),s=[];i.forEach(function(e){s.push(new MenuBarItemView(e))});var n=new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.MenuBar.margin,padding:cleverapps.styles.MenuBar.padding});if(n.width<e&&2===s.length&&s[1].centerAlign){var o=cleverapps.UI.getSceneSize();s[1].x<o.width/2&&o.width/2+s[1].width/2+cleverapps.styles.MenuBar.padding.x<=e&&(s[1].x=o.width/2,
n.width=s[1].x+s[1].width/2+cleverapps.styles.MenuBar.padding.x)}if(n.width>e){var a=(n.width-e-(s.length-1)*(cleverapps.styles.MenuBar.margin-cleverapps.styles.MenuBar.smallMargin))/s.length;s.forEach(function(e){e.updateToSmallSize(a)}),n.options={direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.MenuBar.smallMargin,padding:cleverapps.styles.MenuBar.padding},n.reshape()}n.width>e&&n.setScale(e/n.width),this.setLocalZOrder(2),this.addChild(n),this.setContentSize(n.width*n.scale,n.height*n.scale),n.setPositionRound(this.width/2,this.height/2),this.setPositionRound(cleverapps.styles.MenuBar.position),this.deltaY=cleverapps.UI.getSceneOffsetY()-cleverapps.styles.MenuBar.minOffest,this.deltaY<0&&(this.deltaY=0),this.alignment=cleverapps.clone(this.alignment,!0),this.alignment.y.dy+=this.deltaY,t.addChild(this),s.forEach(function(e){e.makeHideable()})}});cleverapps.styles.MenuBar={minOffest:50,margin:16,smallMargin:12,padding:{x:20,y:0},position:{x:{align:"left",dx:0},y:{
align:"top",dy:-15}}};var MenuBarBaseItem=function(){this.onRemove=function(){},this.onChangeText=function(){},this.onChanged=function(){},this.onShowForce=function(){}};MenuBarBaseItem.prototype.init=function(){this.needPayments=!1,this.helpButton=!1,this.lottery=!1,this.iconText=!1,this.timer=!1,this.target=!1,this.centerAlign=!1,this.plusButton=!0,this.changeTextDeltaAnimation=!0,this.currentValue=this.getCurrentValue()},MenuBarBaseItem.prototype.remove=function(){this.onRemove()},MenuBarBaseItem.prototype.changeText=function(){this.changeTextAccumulate||(this.changeTextAccumulate=cleverapps.accumulate(100,this._changeText.bind(this))),this.changeTextAccumulate()},MenuBarBaseItem.prototype._changeText=function(){var e=0;this.changeTextDeltaAnimation&&void 0!==this.currentValue&&(e=this.getCurrentValue()-this.currentValue),this.currentValue=this.getCurrentValue(),this.onChangeText(e)},MenuBarBaseItem.prototype.getName=function(){throw"not defined"},
MenuBarBaseItem.prototype.showForce=function(){this.onShowForce(this.getForce())},MenuBarBaseItem.prototype.getDeltaSound=function(){},MenuBarBaseItem.prototype.getCurrentValue=function(){},MenuBarBaseItem.prototype.getForce=function(){},MenuBarBaseItem.prototype.getTextValue=function(){return""},MenuBarBaseItem.prototype.getText=function(){return this.timer?cleverapps.intervalToString(this.timer.getTimeLeft(),this.timerShowHours):this.getTextValue()},MenuBarBaseItem.prototype.timerRefresh=function(){this.onChangeText()},MenuBarBaseItem.prototype.setTimer=function(e,t){this.timer=e,this.timerShowHours=t,this.timer.onSecond=this.timerRefresh.bind(this)},MenuBarBaseItem.prototype.isAvailableOnScene=function(){return!1};var MenuBarBonusRoundTimerItem=function(){MenuBarBaseItem.call(this),this.tooltip="BonusRoundCountdownTooltip"};MenuBarBonusRoundTimerItem.prototype=Object.create(MenuBarBaseItem.prototype),(MenuBarBonusRoundTimerItem.prototype.constructor=MenuBarBonusRoundTimerItem
).prototype.init=function(){MenuBarBaseItem.prototype.init.call(this),this.centerAlign=!0,this.setTimer(Game.currentGame.bonusRoundCountDown,!1),this.plusButton=!1},MenuBarBonusRoundTimerItem.prototype.getName=function(){return"BonusRoundTimerItem"},MenuBarBonusRoundTimerItem.prototype.getIcon=function(){return bundles.menubar.frames.time_left_icon_png},MenuBarBonusRoundTimerItem.prototype.isAvailableOnScene=function(){return cleverapps.environment.isGameScene()&&Game.currentGame.bonusRoundCountDown};var MenuBarCryptexItem=function(){MenuBarBaseItem.call(this)};MenuBarCryptexItem.prototype=Object.create(MenuBarBaseItem.prototype),(MenuBarCryptexItem.prototype.constructor=MenuBarCryptexItem).prototype.init=function(){MenuBarBaseItem.prototype.init.call(this),this.centerAlign=!0,this.plusButton=!1,this.helpButton=!0;var e=Game.currentGame.cryptex;this.setTimer(e.countdown,!1),e.onShowForceListener=this.showForce.bind(this),e.onStop=this.remove.bind(this)},
MenuBarCryptexItem.prototype.getName=function(){return"CryptexItem"},MenuBarCryptexItem.prototype.getForce=function(){return Forces.CRYPTEX},MenuBarCryptexItem.prototype.getIcon=function(){return bundles.menubar.frames.cryptex_png},MenuBarCryptexItem.prototype.action=function(){cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce(),Game.currentGame.cryptex.isOpen()?Game.currentGame.cryptex.displayOpen():cleverapps.metha.display({focus:"CryptexWindow",action:function(e){new CryptexWindow,cleverapps.metha.onceNoWindowsListener=e}})},MenuBarCryptexItem.prototype.isAvailableOnScene=function(){return cleverapps.environment.isGameScene()&&Game.currentGame.cryptex};var MenuBarExpItem=function(){MenuBarBaseItem.call(this)};MenuBarExpItem.prototype=Object.create(MenuBarBaseItem.prototype),(MenuBarExpItem.prototype.constructor=MenuBarExpItem).prototype.init=function(){MenuBarBaseItem.prototype.init.call(this),this.lottery=!0,this.needPayments=!0,
cleverapps.user.onChangeExpListeners.expview=this.changeText.bind(this)},MenuBarExpItem.prototype.getName=function(){return"ExpItem"},MenuBarExpItem.prototype.getIcon=function(){return bundles.menubar.frames.exp_png},MenuBarExpItem.prototype.getCurrentValue=function(){return cleverapps.user.exp},MenuBarExpItem.prototype.getTextValue=function(){return cleverapps.user.exp+""},MenuBarExpItem.prototype.action=function(){cleverapps.metha.display({focus:"ExpInfoWindow",action:function(e){new ExpInfoWindow,cleverapps.metha.onceNoWindowsListener=e}})},MenuBarExpItem.prototype.isAvailableOnScene=function(){return 0<=[cleverapps.Environment.SCENE_HEROES].indexOf(cleverapps.environment.scene)};var MenuBarGoldItem=function(){MenuBarBaseItem.call(this)};MenuBarGoldItem.prototype=Object.create(MenuBarBaseItem.prototype),(MenuBarGoldItem.prototype.constructor=MenuBarGoldItem).prototype.init=function(){MenuBarBaseItem.prototype.init.call(this),this.lottery=!0,this.needPayments=!0,this.target=!0,
cleverapps.user.onChangeGoldListeners.menugoldview=this.changeText.bind(this)},MenuBarGoldItem.prototype.getDeltaSound=function(){return bundles.main.urls.coins_effect},MenuBarGoldItem.prototype.getName=function(){return"GoldItem"},MenuBarGoldItem.prototype.getIcon=function(){return bundles.menubar.frames.coin_png},MenuBarGoldItem.prototype.getCurrentValue=function(){return cleverapps.user.gold},MenuBarGoldItem.prototype.getTextValue=function(){return cleverapps.user.gold+""},MenuBarGoldItem.prototype.action=function(){cleverapps.metha.display({focus:"ShopWindow",control:"MenuBarGoldItem",action:function(e){new ShopWindow({tab:ShopWindow.TABS.COINS}),cleverapps.metha.onceNoWindowsListener=e}})},MenuBarGoldItem.prototype.isAvailableOnScene=function(){var e=[cleverapps.Environment.SCENE_MAIN,cleverapps.Environment.SCENE_HEROES,cleverapps.Environment.SCENE_DAILY_CUP,cleverapps.Environment.SCENE_RACE,cleverapps.Environment.SCENE_METHA,cleverapps.Environment.SCENE_CARD_SKINS];return-1===[
"match3"].indexOf(cleverapps.config.type)&&e.push(cleverapps.Environment.SCENE_GAME),0<=e.indexOf(cleverapps.environment.scene)};var MenuBarLivesItem=function(){MenuBarBaseItem.call(this)};MenuBarLivesItem.prototype=Object.create(MenuBarBaseItem.prototype),(MenuBarLivesItem.prototype.constructor=MenuBarLivesItem).prototype.init=function(){MenuBarBaseItem.prototype.init.call(this),this.lottery=!0,this.target=!0,this.updateType(),cleverapps.lives.onChangeAmountListeners.livesview=this.updateType.bind(this),cleverapps.lives.onStartRegenerateListener=function(){cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)||this.updateType()}.bind(this),cleverapps.lives.onBuyUnlimitedLivesListener=this.updateType.bind(this)},MenuBarLivesItem.prototype.getName=function(){return"LivesItem"},MenuBarLivesItem.prototype.updateType=function(){if(this.timer&&(this.timer.stop(),this.timer=!1),cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)){var e=function(){
cleverapps.metha.isFocused()||(cleverapps.environment.isMainScene()||cleverapps.environment.isDailyCupScene())&&cleverapps.tempGoods.displayPromotionOnFinish(),this.updateType()}.bind(this);this.iconText=!1,this.plusButton=!1,this.setTimer(new cleverapps.CountDown(cleverapps.tempGoods.goodLeftTime(cleverapps.TempGoods.UNLIMITED_LIVES),{onFinish:e}),!0)}else this.iconText=!0,this.plusButton=!0,cleverapps.lives.amount<cleverapps.Lives.MAX_REGEN_AMOUNT&&0<cleverapps.lives.calcTimeLeft()&&this.setTimer(new cleverapps.CountDown(cleverapps.lives.calcTimeLeft(),{onFinish:this.updateType.bind(this)}),!1);this.onChanged()},MenuBarLivesItem.prototype.getIcon=function(){return cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)?bundles.menubar.frames.life_unlim_png:bundles.menubar.frames.life_png},MenuBarLivesItem.prototype.getIconText=function(){return cleverapps.lives.amount},MenuBarLivesItem.prototype.getTextValue=function(){return"messages:Lives.Full"},
MenuBarLivesItem.prototype.action=function(){cleverapps.metha.display({focus:"ShopWindowLives",control:["MenuBarGoldItem","MenuBarLivesItem"],action:function(e){new ShopWindow({tab:ShopWindow.TABS.LIVES}),cleverapps.metha.onceNoWindowsListener=e}})},MenuBarLivesItem.prototype.isAvailableOnScene=function(){var e=[cleverapps.Environment.SCENE_MAIN,cleverapps.Environment.SCENE_METHA];return cleverapps.dailyCup.cupWithLives()&&e.push(cleverapps.Environment.SCENE_DAILY_CUP),cleverapps.lives&&0<=e.indexOf(cleverapps.environment.scene)};var MenuBarStarChestItem=function(){MenuBarBaseItem.call(this)};MenuBarStarChestItem.prototype=Object.create(MenuBarBaseItem.prototype),(MenuBarStarChestItem.prototype.constructor=MenuBarStarChestItem).prototype.init=function(){MenuBarBaseItem.prototype.init.call(this),this.plusButton=!1,this.target=!0,cleverapps.starChest.onStarsChangedListener=this.changeText.bind(this)},MenuBarStarChestItem.prototype.getName=function(){return"StarChestItem"},
MenuBarStarChestItem.prototype.getIcon=function(){return bundles.menubar.frames.star_chest_icon_png},MenuBarStarChestItem.prototype.getCurrentValue=function(){return cleverapps.starChest.stars},MenuBarStarChestItem.prototype.getTextValue=function(){return cleverapps.starChest.stars+"/"+cleverapps.StarChest.GOAL_AMOUNT},MenuBarStarChestItem.prototype.action=function(){cleverapps.metha.display({focus:"StarChestWindow",action:function(e){cleverapps.starChest.locked?new StarChestLockedWindow:new StarChestWindow,cleverapps.metha.onceNoWindowsListener=e}})},MenuBarStarChestItem.prototype.isAvailableOnScene=function(){return cleverapps.starChest&&0<=[cleverapps.Environment.SCENE_MAIN,cleverapps.Environment.SCENE_DAILY_CUP,cleverapps.Environment.SCENE_METHA].indexOf(cleverapps.environment.scene)};var MenuBarMethaStarsItem=function(){MenuBarBaseItem.call(this)};MenuBarMethaStarsItem.prototype=Object.create(MenuBarBaseItem.prototype),(
MenuBarMethaStarsItem.prototype.constructor=MenuBarMethaStarsItem).prototype.init=function(){MenuBarBaseItem.prototype.init.call(this),cleverapps.home.onChangeStars=this.changeText.bind(this)},MenuBarMethaStarsItem.prototype.getName=function(){return"MethaStarsItem"},MenuBarMethaStarsItem.prototype.getIcon=function(){return bundles.menubar.frames.menubar_metha_stars},MenuBarMethaStarsItem.prototype.getCurrentValue=function(){return cleverapps.home.stars},MenuBarMethaStarsItem.prototype.getTextValue=function(){return cleverapps.home.stars+""},MenuBarMethaStarsItem.prototype.action=function(){cleverapps.metha.display({focus:"showCollectStarsRules",action:function(e){new HomefixRulesWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},MenuBarMethaStarsItem.prototype.isAvailableOnScene=function(){return cleverapps.metha.getType()===Metha.HOMEFIX&&0<=[cleverapps.Environment.SCENE_METHA,cleverapps.Environment.SCENE_MAIN].indexOf(cleverapps.environment.scene)}
;var SceneControlButton=cleverapps.UI.Button.extend({ctor:function(e){e=e||{},this._super({button_png:e.button_png?e.button_png:bundles.controlbuttons.frames.button_png,button_on_png:e.button_on_png?e.button_on_png:bundles.controlbuttons.frames.button_on_png,onClicked:e.onClicked,content:new cc.Sprite(e.icon),contentPadding:e.contentPadding}),SceneDecors.add(this,cleverapps.skins.getSlot("sceneControlButton",{target:this}))}}),ControlButtonsLogic={fullscreenElement:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullscreenElement},requestFullscreen:function(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullscreen&&e.mozRequestFullscreen()},fullScreenIsAvailableAtScene:function(){if(cleverapps.config.editorMode)return!1;if(cleverapps.environment.isChatScene())return!1;if(
cc.sys.isNative||cc.sys.isMobile||cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL||cleverapps.isInstant()||cleverapps.Mobage.isAppropriate()||cleverapps.MobileOK.isAppropriate())return!1;var e=document.documentElement;return e.requestFullscreen||e.webkitRequestFullscreen||e.msRequestFullscreen||e.mozRequestFullscreen},exitFullscreen:function(e){ControlButtonsLogic.fullScreenIsAvailableAtScene()&&ControlButtonsLogic.fullscreenElement()?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozExitFullscreen&&document.mozExitFullscreen(),e&&setTimeout(e,100)):e&&e()},fullScreenOnClicked:function(){ControlButtonsLogic.fullscreenElement()?ControlButtonsLogic.exitFullscreen():ControlButtonsLogic.requestFullscreen()},exitSceneOnClicked:function(){cc.director.getRunningScene().closeAction()},exitSceneIsAvailableAtScene:function(){
return cleverapps.environment.isMainScene()?!!cleverapps.administrator:!(!cleverapps.environment.isGameScene()||"merge"!==cleverapps.config.type||"undefined"==typeof Editor)||(!(!cleverapps.environment.isEditorScene()||"merge"!==cleverapps.config.type)||(!cleverapps.environment.isGameScene()||-1===["riddles","heroes"].indexOf(config.projectName))&&(!cleverapps.environment.isChatScene()&&(levels&&levels.user&&levels.user.checkAvailable({level:1}))))},menuOnClicked:function(){cleverapps.metha.display({focus:"SettingsWindowFromMenu",action:function(e){new SettingsWindow,cleverapps.metha.onceNoWindowsListener=e}})},menuIsAvailableAtScene:function(){return!cleverapps.environment.isEditorScene()&&!cleverapps.environment.isChatScene()}},SceneControlButtonsView=cc.Node.extend({ctor:function(){this._super();var i=[];SceneControlButtonsView.controlButtons.forEach(function(e){if(e.isAvailableAtScene()){e.contentPadding=cleverapps.styles.SceneControlButtonsView.contentPadding
;var t=new SceneControlButton(e);t.baseScale=cleverapps.styles.SceneControlButtonsView.scale[cleverapps.wideMode.mode],t.setScale(t.baseScale),i.push(t)}});var e=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.SceneControlButtonsView.margin});e.setAnchorPoint2(0,0),this.addChild(e),this.setContentSize(e.getContentSize()),this.setAnchorPoint2(),this.setLocalZOrder(2);var t=cleverapps.clone(cleverapps.styles.SceneControlButtonsView.position,!0);cleverapps.isInstant()&&t&&t.x&&t.x.dx&&(t.x.dx+=cleverapps.styles.SceneControlButtonsView.instantPositionDelta),this.setPositionRound(t),cleverapps.UI.makeHideable(this,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("SceneControlButtonsView",this)}});SceneControlButtonsView.needToAddInsidePanel=function(){return cleverapps.environment.isGameScene()&&void 0!==ControlsPanel&&ControlsPanel.IS_DOWN()&&-1!==["riddles","heroes"].indexOf(cleverapps.config.name)},cleverapps.styles.SceneControlButtonsView={
scale:[1,1,1],margin:16,instantPositionDelta:-50,position:{x:{align:"right",dx:-20},y:{align:"top",dy:-10}}},SceneControlButtonsView.menuButtonData={id:"menu",onClicked:ControlButtonsLogic.menuOnClicked,isAvailableAtScene:ControlButtonsLogic.menuIsAvailableAtScene,icon:bundles.controlbuttons.frames.menu_icon_png},SceneControlButtonsView.controlButtons=[{id:"exitScene",onClicked:ControlButtonsLogic.exitSceneOnClicked,isAvailableAtScene:ControlButtonsLogic.exitSceneIsAvailableAtScene,icon:bundles.controlbuttons.frames.back_icon_png,button_png:bundles.controlbuttons.frames.back_button_png,button_on_png:bundles.controlbuttons.frames.back_button_on_png},{id:"fullScreen",onClicked:ControlButtonsLogic.fullScreenOnClicked,isAvailableAtScene:ControlButtonsLogic.fullScreenIsAvailableAtScene,icon:bundles.controlbuttons.frames.fullscreen_icon_png},SceneControlButtonsView.menuButtonData],cleverapps.UI.ImageFont=cc.Node.extend({ctor:function(e,t){this._super(),"string"==typeof(this.options=e)&&(e={
prefix:e}),this.prefix="timer_digit_",this.setFont(e),this.setAnchorPoint(.5,.5),this.setCascadeOpacityEnabled(!0),this.setString(t),this.setCascadeColorEnabled(!0)},setHorizontalAlignment:function(){},setVerticalAlignment:function(){},setDimensions:function(){},fitTo:function(e,t){for(var i=0;i<10;){var s=this.width*this.scale,n=this.height*this.scale,o=this.canAttachLastLine();if(!(e&&e<s||t&&t<n||o))break;i++;var a=.9;if(e&&e<s&&a<e/s&&(a=e/s),t&&t<n&&a<t/n&&(a=t/n),1<=a&&o&&(a=.9),this.setFontSize(Math.floor(this.getFontSize()*a)),this.getFontSize()<cleverapps.UI.ImageFont.getFontSizeThreshold())return void this.setFontSize(cleverapps.UI.ImageFont.getFontSizeThreshold())}},canAttachLastLine:function(){return!1},setFont:function(e){if(e.prefix&&(this.prefix=e.prefix),-1!==this.prefix.indexOf("#")){var t=this.prefix.split("#");this.bundle=t[0],this.prefix=t[1]}e.scale&&this.setScale(e.scale),e.color&&this.setColor(e.color)},setString:function(e){if(!this.stopListeners){e=""+e,
this.string=e,this.removeAllChildren(!0);var t=e?(""+e).split(""):[],s=0,n=0;t.forEach(function(e){cleverapps.UI.ImageFont.LETTERS_MAP[e]&&(e=cleverapps.UI.ImageFont.LETTERS_MAP[e]);var t=this.bundle&&bundles[this.bundle].frames[this.prefix+e]||res[this.prefix+e];t||console.log("No image for letter: ",e);var i=new cc.Sprite(t);n<i.height&&(n=i.height),i.setPositionRound(s+i.width/2,i.height/2),i.setAnchorPoint2(),s+=i.width,this.addChild(i)},this),this.setContentSize2(s,n),this.setAnchorPoint2(this.anchorX,this.anchorY)}},setAnchorPoint2:function(e,t){this.anchorX=e,this.anchorY=t,this._super(e,t)},getString:function(){return this.string},getFontSize:function(){return this.getScale()*this.options.size},setFontSize:function(e){this.setScale(e/this.options.size)}}),cleverapps.UI.ImageFont.LETTERS_MAP={"/":"slash","+":"plus","-":"minus",":":"colon","#":"sharp",".":"point"," ":"space","[":"left_square_bracket","]":"right_square_bracket"},
cleverapps.UI.ImageFont.getFontSizeThreshold=function(){var e=8;return cc.sys.isMobile||(e=5),e*resolutionScale},cleverapps.UI.ImageFont.IsApplicable=function(e,t){var i,s=e.prefix;if(!s)return!1;if(!t)return!0;if(-1!==s.indexOf("#")){var n=s.split("#");i=n[0],s=n[1]}if(i){var o=bundles[i].injectTo||[i];if(0===cleverapps.bundleLoader.countLoaded(o))return!1}for(var a=0;a<t.length;a++){var r=cleverapps.UI.ImageFont.LETTERS_MAP[t[a]]||t[a];if(i){if(!bundles[i].frames[s+r])return!1}else if(!res[s+r])return!1}return!0};var ScaledProgressBar=cc.Scale9Sprite.extend({ctor:function(e,t){"string"==typeof e&&(e=cc.spriteFrameCache.getSpriteFrame(e));var i=e.getRect();this._super(e,cc.rect(i.width/2-1,0,2,i.height)),this.ignoreAnchorPointForPosition(!0),this.minWidth=0,this.minHeight=0,this.totalWidth=this.width,this.totalHeight=this.height,this.setPercentage(0),this.layout=ScaledProgressBar.HORIZONTAL,t=t||{},this.setInsetLeft(t.horizontal||this.getInsetLeft()),this.setInsetRight(
t.horizontal||this.getInsetRight()),this.setInsetBottom(t.vertical||this.getInsetBottom()),this.setInsetTop(t.vertical||this.getInsetTop())},onChange:function(){if(this.layout===ScaledProgressBar.HORIZONTAL){var e=this.totalWidth*this.percentage/100;0<this.percentage&&e<this.minWidth&&(e=this.minWidth),this.setContentSize(e,this.totalHeight)}else{var t=this.totalHeight*this.percentage/100;0<this.percentage&&t<this.minHeight&&(t=this.minHeight),this.setContentSize(this.totalWidth,t)}},animatedChange:function(t){this.finalValue&&(this.setPercentage(this.finalValue),this.stopAllActions()),this.startValue=this.getPercentage(),this.finalValue=this.getPercentage()+t;var e=ScaledProgressBar.EASINGS.map(function(e){return new cc.CallFunc(function(){this.setPercentage(this.startValue+e*t),this.setVisible(1<=this.getPercentage())},this)},this),i=[];e.forEach(function(e){i.push(e),i.push(new cc.DelayTime(.04))}),this.runAction(new cc.Sequence(i))},setDimension:function(e,t){void 0===t&&(
t=e.height,e=e.width),this.totalWidth=e,this.totalHeight=t,this.onChange()},setAnchorPoint:function(){},setLayout:function(e){this.layout=e,this.onChange()},setMinWidth:function(e){this.minWidth=e,this.onChange()},setMinHeight:function(e){this.minHeight=e,this.onChange()},setPercentage:function(e){100<e?e=100:e<0&&(e=0),this.percentage!==e&&(this.percentage=e,this.onChange())},getPercentage:function(){return this.percentage}});ScaledProgressBar.EASINGS=[],function(){for(var e=0;e<=20;e++){var t=e/20;ScaledProgressBar.EASINGS.push(1-Math.pow(1-t,3))}}(),ScaledProgressBar.HORIZONTAL=0,ScaledProgressBar.VERTICAL=1,cleverapps.Chest=function(e){this.locked=!1,this.onceUnlocked=function(){},this.changeLockedListener=function(){},this.storage=e.storage,this.serverTaskName=e.serverTaskName,e.isNewUser?(this.initializeForNewUser(),this.save()):this.load()},cleverapps.Chest.prototype._receiveReward=function(e,t){cleverapps.audio.playSound(res.shop_buy_effect);var i=0;if(e.gold&&(
cleverapps.user.setGold(cleverapps.user.gold+e.gold),t||(i=e.gold)),e.exp&&levels.user.expAvailable()&&cleverapps.user.setExp(cleverapps.user.exp+e.exp),e.boosters)for(var s in e.boosters)0<e.boosters[s]&&(cleverapps.boostersCounter.add(s,e.boosters[s]),t||(i+=cleverapps.config.prices.boosters[s][1]*(e.boosters[s]||1)));if(e.unlimitedLives&&(cleverapps.tempGoods.buyGood(cleverapps.TempGoods.UNLIMITED_LIVES,cleverapps.parseInterval(e.unlimitedLives.interval)),cleverapps.lives.onBuyUnlimitedLivesListener()),e.stars&&cleverapps.starChest.addStars(e.stars),e.gun&&cleverapps.gun.addAmount(e.gun),cleverapps.lives&&e.lives&&cleverapps.lives.setAmount(cleverapps.lives.amount+e.lives),e.herolevels&&Array.isArray(e.herolevels)&&0<e.herolevels.length)for(var n=0;n<e.herolevels.length;n++)match3.heroes.setLevel(e.herolevels[n][0],Math.max(0,Math.min(Heroes.HEROES_MAX_LEVEL,e.herolevels[n][1])));if(e.wardrobe){var o=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_WARDROBE);if(o){
var a=o.logic.getProgressForStage(e.wardrobe);o.result<a&&(o.update(a-o.result),o.logic.stageToShow=e.wardrobe)}}t||cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARD_RECEIVED,{amount:i})},cleverapps.Chest.prototype.fromJSON=function(e){this.locked=e},cleverapps.Chest.prototype.toJSON=function(){return this.locked},cleverapps.Chest.prototype.load=function(){var e=cleverapps.DataLoader.load(this.storage);void 0===e?(this.initializeForNewUser(),this.save()):this.fromJSON(e)},cleverapps.Chest.prototype.save=function(e){cleverapps.DataLoader.save(this.storage,this.toJSON()),this.serverTaskName&&!1!==e&&cleverapps.synchronizer.addUpdateTask(this.serverTaskName)},cleverapps.Chest.prototype.initializeForNewUser=function(){this.locked=!1},cleverapps.Chest.prototype.unlock=function(){this.locked=!1,this.onceUnlocked(),this.changeLockedListener()},cleverapps.Chest.prototype.open=function(){this.locked=!0,this.changeLockedListener()},cleverapps.DailyChest=function(e){
cleverapps.config.debugMode&&(cleverapps.DailyChest.TIMEOUT="10 minutes"),e=cleverapps.extend({storage:cleverapps.DataLoaderTypes.DAILY_CHEST,interval:cleverapps.parseInterval(cleverapps.DailyChest.TIMEOUT)},e),this.onUnlockingStarted=function(){},this.interval=e.interval,cleverapps.Chest.call(this,e)},cleverapps.DailyChest.prototype=Object.create(cleverapps.Chest.prototype),cleverapps.DailyChest.prototype.constructor=cleverapps.DailyChest,cleverapps.DailyChest.prototype.initializeForNewUser=function(){this.locked=!0,this.startUnlockFromScratch()},cleverapps.DailyChest.prototype.fromJSON=function(e){this.locked=!0,this.setWhenUnlock(e.nextTime)},cleverapps.DailyChest.prototype.toJSON=function(){return{nextTime:this.when}},cleverapps.DailyChest.prototype.startUnlockFromScratch=function(){this.setWhenUnlock(Date.now()+this.interval)},cleverapps.DailyChest.prototype.open=function(){this.locked=!0,this.startUnlockFromScratch(),this.changeLockedListener()},
cleverapps.DailyChest.prototype.resetUnlockCountdown=function(){void 0!==this.countdown?this.countdown.resetTimeLeft(this.when-Date.now()):this.countdown=new cleverapps.CountDown(this.when-Date.now(),{onFinish:this.unlock.bind(this),permanent:!0}),this.onUnlockingStarted()},cleverapps.DailyChest.prototype.setWhenUnlock=function(e){e||(e=Date.now()),this.when=Math.min(e,Date.now()+this.interval),this.save(),this.resetUnlockCountdown()},cleverapps.DailyChest.TIMEOUT="3 hours";var StoryTeller=cc.Node.extend({ctor:function(){this._super();var e,t=cleverapps.styles.StoryTeller;this.setContentSize2(t.width,t.height),this.setAnchorPoint2(),t.json?((e=new cleverapps.Spine(t.json)).setAnimation(0,t.animation,!0),e.setScale(t.scale)):res.character_png&&(e=new cc.Sprite(res.character_png)).setScale(.6),this.addChild(e),e.setPositionRound(this.width/2,this.height/2+t.offsetY)}});StoryTeller.listBundles=function(){return cleverapps.Spine.listBundles(cleverapps.styles.StoryTeller.json)},
cleverapps.styles.StoryTeller={width:310,height:310,offsetY:0,json:bundles.dialogues?bundles.dialogues.jsons.default_json:void 0,animation:"animation",scale:1};var SideBar=function(){this.visible=!1,this.onAddIcon=function(){},this.onMoveIcon=function(){},this.onRemoveIcon=function(e){},this.onForceIcon=function(e){},this.onToggle=function(){},cleverapps.metha.registerControl("sidebar",function(e){e!==this.visible&&this.toggle()}.bind(this)),this.icons=[],this.defaultIcons=[MethaIcon,DailyLevelIcon,PackIcon,PiggyBankIcon,SubscriptionIcon,DailyCupIcon].map(function(e){return new SidebarIconModel(e)}),void 0!==HeroesIcon&&this.defaultIcons.push(new SidebarIconModel(HeroesIcon)),"undefined"!=typeof CardSkinsIcon&&this.defaultIcons.push(new SidebarIconModel(CardSkinsIcon)),this.updatesQueue=[],this.refreshDefaultIcons()};SideBar.prototype.reset=function(){this.icons=[]},SideBar.prototype.refreshDefaultIcons=function(){this.defaultIcons.forEach(function(e){e.isAvailable()?-1===this.indexOf(
e)&&this.addIcon(e):this.removeIcon(e)},this)},SideBar.prototype.anyIconWithForceIndex=function(){for(var e=0;e<this.icons.length;e++){var t=this.icons[e].getForce();if(t&&!cleverapps.forces.isShown(t.id))return e}},SideBar.prototype.unfreeze=function(){this.updatesQueue.forEach(function(e){e()}),this.updatesQueue=[],this.frozen=!1},SideBar.prototype.freeze=function(){this.frozen=!0},SideBar.prototype.showAnyForce=function(){var t=this.anyIconWithForceIndex(),i=this.icons[t].getForce();this.freeze(),cleverapps.metha.display({focus:"sidebarIconForce",control:"sidebar",actions:[function(e){setTimeout(e,1100)},function(e){this.onForceIcon(t,i),cleverapps.forces.onceForceClosed=e}.bind(this)]})},SideBar.prototype.toggle=function(){this.visible=!this.visible,this.onToggle(this.visible)},SideBar.prototype.addIcon=function(e){this.frozen?this.updatesQueue.push(this._addIcon.bind(this,e)):this._addIcon(e)},SideBar.prototype._addIcon=function(e){if(this.icons.length===SideBar.SLOTS.length){
var t=this.icons.map(function(e){return e.params&&e.params.type||""});cleverapps.ReportStream.debug("No vacant slot exists! icons - "+t.join(", "))}else this.icons.push(e),this.onAddIcon(this.icons.length-1,this.visible)},SideBar.prototype.indexOf=function(e){for(var t=0;t<this.icons.length;t++)if(this.icons[t].equals(e))return t;return-1},SideBar.prototype.removeIcon=function(e){this.frozen?this.updatesQueue.push(this._removeIcon.bind(this,e)):this._removeIcon(e)},SideBar.prototype._removeIcon=function(e){var t=this.indexOf(e);if(-1!==t){for(this.onRemoveIcon(t);t<this.icons.length-1;t++)this.icons[t]=this.icons[t+1],this.onMoveIcon(t,t+1);this.icons.pop()}},SideBar.LEFT_COLUMN=0,SideBar.RIGHT_COLUMN=1,SideBar.SLOTS=[{row:0,col:SideBar.LEFT_COLUMN},{row:1,col:SideBar.LEFT_COLUMN},{row:2,col:SideBar.LEFT_COLUMN},{row:0,col:SideBar.RIGHT_COLUMN},{row:1,col:SideBar.RIGHT_COLUMN},{row:2,col:SideBar.RIGHT_COLUMN},{row:3,col:SideBar.LEFT_COLUMN},{row:3,col:SideBar.RIGHT_COLUMN},{row:4,
col:SideBar.LEFT_COLUMN},{row:4,col:SideBar.RIGHT_COLUMN}];var SidebarIconModel=function(e,t){this.className=e,this.params=t,this.force=this.calcForce()};SidebarIconModel.prototype.calcForce=function(){return void 0!==HeroesIcon&&this.className===HeroesIcon?Forces.HEROES_AVAILABLE:this.className===DailyCupIcon?Forces.DAILY_CUP:this.className===MissionIcon&&this.params.iconForce?this.params.iconForce:void 0},SidebarIconModel.prototype.createView=function(){return new this.className(this,this.params)},SidebarIconModel.prototype.isAvailable=function(){return this.className.IsAvailable()},SidebarIconModel.prototype.equals=function(e){if(this.className!==e.className)return!1;if(this.params===e.params)return!0;var t=this.params&&this.params.type,i=e.params&&e.params.type;return void 0!==t&&t===i},SidebarIconModel.prototype.getForce=function(){return this.force};var SideBarIcon=cc.Node.extend({ctor:function(e,t,i){this.model=e,this.options=i||{},this.styles=t,this._super(),
this.setAnchorPoint2(),this.container=new cc.Node,this.container.setAnchorPoint2(),this.addChild(this.container),this.show(),this.runTimer(),this.addTitle(this.options.title),cleverapps.UI.onClick(this,this.onPressed.bind(this)),cleverapps.UI.applyHover(this),this.customize()},onPressed:function(){cleverapps.forces.isRunningForce()&&(cleverapps.forces.closeRunningForce(),cleverapps.sideBar.unfreeze()),cleverapps.audio.playSound(bundles.main.urls.click_effect)},showForce:function(e){cleverapps.forces.create(this,e)},setPermanent:function(e){this.timer&&(this.timer.permanent=e)},setSize:function(e){this.setContentSize2(e),this.container.setContentSize2(e),this.container.setPositionRound(this.width/2,this.height/2)},show:function(){var e=this.styles,t=this.bg=cleverapps.UI.createScale9Sprite(cleverapps.skins.getSlot("iconBg",{image:e.bg.image}));e.bg.width&&t.setContentSize(this.styles.bg),this.container.addChild(t),t.setPositionRound(t.width/2,t.height/2),this.setSize(t.getContentSize())
,e.bg.hideBg&&t.setVisible(!1);var i=this.iconNode=new cc.Node;if(i.baseScale=e.icon.scale,i.setScale(i.baseScale),i.setAnchorPoint2(),i.setContentSize2(this.getContentSize()),i.setPositionRound(this.width/2+e.icon.offset.x,this.height/2+e.icon.offset.y),this.container.addChild(i),e.animation){var s=this.animation=new cleverapps.Spine(e.animation);s.setPositionRound(i.width/2,i.height/2);s.setAnimation(0,"animation",!1),s.setCompleteListener(function(){s.runAction(new cc.Sequence(new cc.DelayTime(cleverapps.Random.mathChoose(SideBarIcon.RANDOM_ANIMATION_INTERVALS)),new cc.CallFunc(function(){s.setAnimation(0,"animation",!1)})))}),i.addChild(s)}},setIconDirection:function(e){this.column=e,this.container.setScaleX(e===SideBar.LEFT_COLUMN?1:-1),this.styles.hasDirection||this.iconNode.setScaleX(e===SideBar.LEFT_COLUMN?this.iconNode.baseScale:-this.iconNode.baseScale),this.container.lotteryIcon&&(this.container.lotteryIcon.setScaleX(
e===SideBar.LEFT_COLUMN?this.container.lotteryIcon.baseScale:-this.container.lotteryIcon.baseScale),void 0!==this.container.lotteryIcon.preservedX&&(this.container.lotteryIcon.x=SideBar.LEFT_COLUMN?this.container.lotteryIcon.preservedX:this.container.width-this.container.lotteryIcon.preservedX)),this.text&&this.text.setScaleX(e===SideBar.LEFT_COLUMN?this.text.baseScale:-this.text.baseScale),this.timerView&&this.timerView.setScaleX(e===SideBar.LEFT_COLUMN?this.timerView.baseScale:-this.timerView.baseScale)},addTitle:function(e){if(void 0!==e){var t=cleverapps.styles.SideBarIcon.title;this.text=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.ICON_TEXT),this.container.addChild(this.text),this.text.setPositionRound(t),this.text.fitTo(t.width),this.text.baseScale=this.text.scale}},runTimer:function(e){if(!(void 0===(e=void 0===e?this.options.leftTime:e)||e<=0)){this.hideTimer();var t=this.timer=new cleverapps.CountDown(e,{onFinish:this.createListener(function(){this.onFinishTimer()
}.bind(this))}),i=this.styles.timer,s={font:i.font,timerPosition:{x:0,y:i.offsetY},regularFontTimerPosition:{x:0,y:i.regularFont.offsetY}};if(i.bg){var n=new cc.Sprite(i.bg.image);if(i.bg.scale9&&((n=cleverapps.UI.createScale9Sprite(i.bg.image)).setContentSize2(i.bg.width,i.bg.height),i.bg.arrow)){var o=new cc.Sprite(i.bg.arrow.image);n.addChild(o),o.setPositionRound(i.bg.arrow)}s.background_content=n}var a=this.timerView=new cleverapps.CountDownView(t,s);this.container.addChild(a),this.text&&(this.text.visible=!1),i.textWidth&&a.text.fitTo(i.textWidth),a.setPositionRound(i),a.baseScale=a.scale,void 0!==this.column&&this.setIconDirection(this.column)}},hideTimer:function(){this.timerView&&(this.timerView.removeFromParent(),delete this.timerView,this.text&&(this.text.visible=!0)),this.timer&&(this.timer.remove(),delete this.timer)},turnOnAttention:function(){if(!this.mark){var e=this.mark=new cc.Sprite(this.styles.mark.icon);e.setLocalZOrder(2),this.container.addChild(e),
e.setPositionRound(this.styles.mark),e.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.3,1.1),new cc.ScaleTo(.3,1)))),void 0!==this.column&&this.setIconDirection(this.column)}},turnOffAttention:function(){this.mark&&(this.mark.removeFromParent(),delete this.mark)},onFinishTimer:function(){},customize:function(){},updateIcon:function(){},removeFromSideBar:function(){cleverapps.sideBar.removeIcon(this.model)}});cleverapps.styles.SideBarIcon={icon:{scale:1,offset:{x:0,y:0}},bg:{image:bundles.sidebar.frames.icon_bg},timer:{font:cleverapps.styles.FONTS.PACK_ICON_TEXT,offsetY:8,regularFont:{offsetY:8},x:{align:"center",dx:0},y:{align:"top",dy:20},bg:{image:bundles.sidebar.frames.icon_text_bg}},mark:{icon:bundles.toolbar.frames.toolbar_attention_icon_png,x:{align:"right",dx:-5},y:{align:"top",dy:-5}}},SideBarIcon.RANDOM_ANIMATION_INTERVALS=[5,7,9,11,12];var SideBarView=cc.Node.extend({ctor:function(){this._super(),cleverapps.sideBar.refreshDefaultIcons()
;var e=cleverapps.UI.getSceneSize();this.setAnchorPoint2(),this.setContentSize2(e.width,e.height),this.slots=SideBar.SLOTS.map(function(e){var t=new SideBarSlotView(e,this);return this.addChild(t),t},this);for(var t=0;t<cleverapps.sideBar.icons.length;t++)this.insert(t);cleverapps.sideBar.onAddIcon=this.createListener(this.insert.bind(this)),cleverapps.sideBar.onMoveIcon=this.createListener(this.move.bind(this)),cleverapps.sideBar.onRemoveIcon=this.createListener(this.eject.bind(this)),cleverapps.sideBar.onToggle=this.createListener(this.toggle.bind(this)),cleverapps.sideBar.onForceIcon=this.createListener(this.onForce.bind(this)),cleverapps.sideBar.visible&&this.toggle(!0)}});SideBarView.prototype.onForce=function(e,t){this.slots[e].showForce(t)},SideBarView.prototype.insert=function(e,t){this.slots[e].insert(cleverapps.sideBar.icons[e].createView(),{visible:t})},SideBarView.prototype.eject=function(e,t){return this.slots[e]&&this.slots[e].eject({retain:t})},
SideBarView.prototype.move=function(e,t){var i=this.eject(t,!0);this.slots[e].insert(i,{release:!0})},SideBarView.prototype.toggle=function(t){this.slots.forEach(function(e){t?e.show():e.hide()})};var SideBarSlotView=cc.Node.extend({ctor:function(e,t){this._super();var i=cleverapps.styles.SideBarSlot;this.setAnchorPoint2(),this.setContentSize2(i.width,i.height),this.setScale(i.scale[cleverapps.wideMode.mode]),this.row=e.row,this.col=e.col;var s=this.width/2*this.scale,n=(this.width+i.padding.horizontal)*this.scale,o=t.height-i.padding.top-this.row*(i.margin+this.height*this.scale);this.col===SideBar.LEFT_COLUMN?(this.hidePosition={x:-s,y:o},this.showPosition={x:this.hidePosition.x+n,y:o}):(this.hidePosition={x:t.width+s,y:o},this.showPosition={x:this.hidePosition.x-n,y:o}),this.visible=!1,this.setPositionRound(this.hidePosition)},insert:function(e,t){this.iconView=e,this.addChild(e),e.setPositionRound(this.width/2,this.height/2),e.setIconDirection(this.col),t.release&&e.setPermanent(!1
),void 0!==t.visible&&(t.visible?(this.hide(!0),this.show()):this.hide(!0))},eject:function(e){var t=this.iconView;return e.retain?(t.setPermanent(!0),t.removeFromParent(!1)):t.removeFromParent(!0),this.iconView=void 0,t},showForce:function(e){this.show(!0),this.iconView.showForce(e)},show:function(e){this.iconView&&(this.stopAllActions(),e?(this.visible=!0,this.setPositionRound(this.showPosition)):this.runAction(new cc.Sequence(new cc.DelayTime(.3+.1*this.row),new cc.CallFunc(function(){this.visible=!0}.bind(this)),new cc.MoveTo(.5,this.showPosition).easing(cc.easeBackOut()))))},hide:function(e){this.iconView&&(this.stopAllActions(),e?(this.visible=!1,this.setPositionRound(this.hidePosition)):this.runAction(new cc.Sequence(new cc.MoveTo(.15,this.hidePosition),new cc.CallFunc(function(){this.visible=!1}.bind(this)))))}});cleverapps.styles.SideBarSlot={width:200,height:200,scale:[.65,1,1],margin:20,padding:{top:220,horizontal:15}};var AutoScrollText=cc.Node.extend({ctor:function(e,t){
this._super(),this.options=t||{},this.styles=cleverapps.overrideStyles(cleverapps.styles.AutoScrollText,t.styles||{},!0),this.setAnchorPoint2(),this.styles.bg?this.bg=new cc.Scale9Sprite(this.styles.bg.image):this.bg=new cc.Node,this.addChild(this.bg),this.bg.setAnchorPoint2(),this.createTexts(e),this.createArrow(),this.currentTextIndex=0,this.texts[this.currentTextIndex].setVisible(!0)},createTexts:function(e){this.texts=[];var i=0;e.forEach(function(e){var t=cleverapps.UI.generateTTFText(e,this.styles.font);t.setDimensions(this.styles.width,0),t.setHorizontalAlignment(this.styles.horizontalAlignment),t.fitTo(void 0,this.styles.height),t.setVisible(!1),this.texts.push(t),this.bg.addChild(t),i=Math.max(i,t.height)}.bind(this)),this.bg.setContentSize2(this.styles.width+2*this.styles.padding.x,i+2*this.styles.padding.y),this.setContentSize2(this.bg.getContentSize()),this.bg.setPositionRound(this.width/2,this.height/2),this.texts.forEach(function(e){e.setPositionRound(this.bg.width/2,
this.bg.height/2)}.bind(this))},createArrow:function(){var e=cleverapps.UI.generateTTFText("",this.styles.font),t=new cc.Node;t.setContentSize2(3*e.width,3*e.height),t.setAnchorPoint2(),this.bg.addChild(t),t.setPositionRound(this.styles.arrow),t.addChild(e),e.setPositionRound(t.width/2,t.height/2),cleverapps.UI.onClick(t,function(){this.next(),this.reinitTimer()}.bind(this))},next:function(){this.texts[this.currentTextIndex].setVisible(!1),this.currentTextIndex=(this.currentTextIndex+1)%this.texts.length,this.texts[this.currentTextIndex].setVisible(!0)},reinitTimer:function(){this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(5),new cc.CallFunc(this.next.bind(this))).repeatForever())},setTextByIndex:function(e){this.texts[this.currentTextIndex]&&this.texts[this.currentTextIndex].setVisible(!1),this.currentTextIndex=e,this.texts[this.currentTextIndex].setVisible(!0)}});cleverapps.styles.AutoScrollText={font:cleverapps.styles.FONTS.WINDOW_TEXT,
horizontalAlignment:cc.TEXT_ALIGNMENT_CENTER,padding:{x:30,y:60},arrow:{x:{align:"right",dx:0},y:{align:"bottom",dy:-30}}};var FbButton=cleverapps.UI.Button.extend({ctor:function(e){this.options=e||{},this.login=e.login||!cleverapps.social.isLoggedIn()&&!cleverapps.social.nativeInviteFriends,this.options.hasOwnProperty("showIcon")||(this.options.showIcon=!0),this.options.hasOwnProperty("showText")||(this.options.showText=!0),this.options.onSuccess=this.options.onSuccess||function(){},this.options.onFailure=this.options.onFailure||function(){},this.source=this.options.source||cleverapps.User.calcSource();var t=this.generateContent(),i=cleverapps.styles.FbButton,s={button_png:this.options.button_png||i.button_png,button_on_png:this.options.button_on_png||i.button_on_png,width:this.options.width||t.width,height:this.options.height||i.height,onClicked:this.onClicked.bind(this),content:t,contentOffset:i.iconOffset,scale:!1,fitTo:!1};this.options.multiSocials&&(
s.button_png=i.multiSocials[this.source+"_button_png"]||i.multiSocials.button_png,s.button_on_png=s.button_png,s.width=1.1*s.height),this._super(s),this.onSuccess=e.onSuccess||function(){},cleverapps.social.isInitialized()||(this.connecting=!0,this.onMouseOver=function(){},this.onMouseOut=function(){})},generateContent:function(){var e=cleverapps.styles.FbButton;this.text=this.login?"messages:SignIn":"messages:FBLoginOrInvite.Button.Invite",this.connecting&&(this.text="messages:FBLoginOrInvite.Button.Connecting");var t,i=[],s=e.icon;if(this.login||this.options.showIcon&&!cleverapps.social.nativeInviteFriends?t=e.icon.image[this.source]||bundles.main.frames.fb_icon_png:this.options.showIcon&&cleverapps.social.nativeInviteFriends&&(t=bundles.main.frames.native_invite_icon_png,s=e.inviteIcon||s),t){var n=new cc.Sprite(t);n.setScale(this.options.iconScale||s.scale),n.setPositionY(s.offsetY),i.push(n)}if(this.options.showText){var o=cleverapps.UI.generateTTFText(this.text,
this.options.font||e.font);i.push(o)}var a=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:e.margin,padding:{x:e.padding,y:0}});return a.setCascadeOpacityEnabled(!0),a},onClicked:function(){if(cleverapps.social.isInitialized())if(this.login){var e=function(){var e=function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LOGIN,{method:this.options.source}),this.options.onSuccess()}.bind(this);cleverapps.social.login(e,this.options.onFailure,{source:this.options.source})}.bind(this);this.options.multiSocials&&cc.sys.isNative?(this.stopAllActions(),this.setScale(.95),this.runAction(new cc.Sequence(new cc.DelayTime(.05),new cc.CallFunc(e),new cc.ScaleTo(.15,1).easing(cc.easeBackInOut())))):e()}else{cleverapps.history.add("invt",1);var t={message:Messages.get("SettingsWindow.InviteFriends.message"),title:Messages.get("SettingsWindow.InviteFriends.title"),element:this};e=function(e){e===cleverapps.Social.CODE_SUCCEED?this.options.onSuccess():this.options.onFailure()
}.bind(this);cleverapps.social.inviteFriends(t,e)}else cleverapps.Notification.create("messages:SocialManager.Initialization")}});cleverapps.styles.FbButton={height:110,padding:70,margin:15,font:cleverapps.styles.FONTS.BUTTON_TEXT,multiSocials:{button_png:bundles.main.frames.white_outline_button_png,androidsocial_button_png:bundles.main.frames.white_shadow_button_png,facebook_button_png:bundles.main.frames.blue_outline_button_png},icon:{image:{mobile_ok:bundles.main.frames.ok_icon_png,web_ok:bundles.main.frames.ok_icon_png,facebook:bundles.main.frames.fb_icon_png,mobile_vk:bundles.main.frames.vk_icon_png,web_vk:bundles.main.frames.vk_icon_png,mbga:bundles.main.frames.mobage_icon_png,sp_mbga:bundles.main.frames.mobage_icon_png,nk:bundles.main.frames.nk_icon_png,draugiem:bundles.main.frames.draugiem_icon_png,web_mm:bundles.main.frames.mm_icon_png,mobile_mm:bundles.main.frames.mm_icon_png,fotostrana:bundles.main.frames.fs_icon_png,androidsocial:bundles.main.frames.google_icon_png,
applesocial:bundles.main.frames.apple_icon_png},scale:.9,offsetY:0},inviteIcon:{scale:1,offsetY:-3}};var BandButton=cc.Node.extend({ctor:function(e){this._super();var t=cleverapps.styles.BandButton;this.setAnchorPoint2(),this.setContentSize2(t);var i=cleverapps.clone(t.position,!0);this.setPositionRound(i);var s=cleverapps.UI.createScale9Sprite(res.scene_exit_button,cleverapps.UI.Scale9Rect.TwoPixelXY);s.setContentSize2(t),this.addChild(s),s.setPositionRound(this.width/2,this.height/2);var n=new cc.Sprite(res.exit_button_icon);this.addChild(n),n.setPositionRound(t.icon),cleverapps.UI.makeHideable(this,cleverapps.UI.VERTICAL),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,function(){cleverapps.audio.playSound(res.click_effect),e.onClicked()}.bind(this))},hide:function(e){if(e)return this.setPositionRound(this.hideHandler.hidePosition),void this.setVisible(!1);this._animate("close",function(){this.setVisible(!1)}.bind(this))},show:function(){this.setVisible(!0),this._animate(
"open")},_animate:function(e,t){this.stopAllActions();var i="open"===e?cc.easeBackOut(10):cc.easeBackIn(10),s="open"===e?this.hideHandler.originalPosition:this.hideHandler.hidePosition;this.runAction(new cc.Sequence(new cc.MoveTo(.3,s).easing(i),new cc.CallFunc(function(){t&&t()})))}});cleverapps.styles.BandButton={width:85,height:190,position:{x:{align:"right",dx:-40},y:{align:"top",dy:10}},icon:{x:{align:"center"},y:{align:"bottom",dy:25}}},cleverapps.Path=cc.Node.extend({ctor:function(e,t){this._super(),this.baseColor=e,this.pathColor=cc.color(this.baseColor),this.lineWidth=t||cleverapps.styles.Path.lineWidth,this.segments=[];for(var i=0;i<cleverapps.Path.MAX_SEGMENTS;++i)this.segments.push(cleverapps.UI.createScale9Sprite(cleverapps.styles.Path.image)),this.segments[i].setAnchorPoint2(0,.5),this.segments[i].visible=!1,this.addChild(this.segments[i]);this.path=[],this.animatingInterval=void 0,this.drawTrailing=!0,this.setCascadeOpacityEnabled(!0),this.setLocalZOrder(-1)},
clear:function(){this.segments.forEach(function(e){e.visible=!1})},reset:function(){this.animatingInterval&&(clearInterval(this.animatingInterval),this.animatingInterval=void 0),this.clearFadeInInterval(),this.path=[],this.pathColor=cc.color(this.baseColor),this.opacity=255,this.draw()},clearFadeInInterval:function(){void 0!==this.animateFadeInInterval&&(clearInterval(this.animateFadeInInterval),this.animateFadeInInterval=void 0)},push:function(e){this.path.push(e),this.draw()},pop:function(){this.path.pop(),this.draw()},setPath:function(e){this.path=e.map(function(e){return e})},listPath:function(){return this.path},onExitTransitionDidStart:function(){this.reset(),this._super()},drawSegment:function(e,t,i){var s=15*resolutionScale/2*.9,n=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))+2*s,o=this.segments[i];o.setColor(this.pathColor),o.setContentSize2(n,this.lineWidth);var a=Math.round(100*Math.atan2(t.y-e.y,t.x-e.x))/100;o.setPositionRound(e.x-s*Math.cos(a),e.y-s*Math.sin(a)),
o.rotation=180*-a/Math.PI,o.visible=!0},draw:function(e){if(this.clear(),0<this.path.length)for(var t=this.drawTrailing&&e?this.path.concat(e):this.path,i=0;i<t.length-1;i++)this.drawSegment(t[i],t[i+1],i)},stopAnimation:function(){this.animatingInterval&&this.reset()},animateFadeIn:function(e){e=e||300;var t=0,i=this.createListener(function(){this.opacity=Math.min(255,Math.floor(255*(1-(e-t)/e))),this.draw(),e<=(t+=16)&&this.clearFadeInInterval()});this.animateFadeInInterval=setInterval(i,16),i()},animateFadeOut:function(e){e=e||300;var t=0,i=this.createListener(function(){e<=t?this.reset():(this.opacity=Math.floor(Math.min(155,this.baseColor.a)*(e-t)/e),this.draw(),t+=16)});this.animatingInterval=setInterval(i,16),i()}}),cleverapps.Path.MAX_SEGMENTS=10,cleverapps.styles.Path={lineWidth:17,image:bundles.game.frames.line_png};var Product=function(e){var t={gameTitle:Messages.get(cleverapps.config.title)};e=Product.SearchProductId(e),cleverapps.extend(this,cleverapps.clone(
cleverapps.config.products[e],!0)),this.title=Messages.getLocalized(this.title,t),this.description=Messages.getLocalized(this.description,t);var i=cleverapps.settings.language+"/"+(0===cleverapps.config.debugMode?"production/":"");this.id||(this.id=e);var s="res/fbproducts/"+i+this.id.facebook;this.id.facebook=cleverapps.config.deployment+"/"+s,this.itemId=e};Product.SearchProductId=function(e){if(-1!==e.indexOf(".html"))for(var t in cleverapps.config.products){var i=cleverapps.config.products[t];if(i.id&&i.id.facebook===e)return t}return e},Product.FormatUnlimitedLives=function(e,t){if("object"==typeof e)return e;var i=Math.round(cleverapps.parseInterval(e)/1e3/60),s={15:"15 minutes",10:"10 minutes",30:"30 minutes",45:"45 minutes",60:"OneHour",120:"TwoHours",180:"ThreeHours",360:"6 hours",720:"12 hours"};return{title:(t?"messages:UnlimitedLivesShort.":"messages:UnlimitedLives.")+({1:"1 day",2:"2 day",3:"3 day",5:"5 day",9:"9 day",10:"10 day"}[Math.floor(i/60/24)]||s[i]),interval:e}},
Product.AddUpRewards=function(e,t){for(var i in t=t||{},e){var s=e[i];if("unlimitedLives"===i)t[i]=t[i]?t[i]+cleverapps.parseInterval(s):cleverapps.parseInterval(s);else if("boosters"===i)for(var n in t.boosters||(t.boosters={}),s)t.boosters[n]=t.boosters[n]?t.boosters[n]+parseInt(s[n]):parseInt(s[n]);else t[i]=t[i]?t[i]+parseInt(s):parseInt(s)}return t},Product.UnlimitedToHours=function(e){if(e.unlimitedLives){var t=Math.round(e.unlimitedLives/1e3/60/60);e.unlimitedLives={title:Messages.get("AMOUNT_HOURS",{amount:t}),interval:t+" hours"}}return e},Product.prototype.getCurrentPrice=function(){return this.loadedPrice?this.loadedPrice:Product.CURRENCY+" "+this.price},Product.prototype.validate=function(t,e){var i={itemId:this.itemId,price:this.price,textPrice:this.getCurrentPrice()};i.price=Math.round(i.price*cleverapps.User.calcPriceCoef()*100)/100;var s=function(){if("subscription"===this.type?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SUBSCRIPTION_BOUGHT,i):(
cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PRODUCT_BOUGHT,i),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PRODUCT_BOUGHT_LANGUAGE,{amount:i.price}),t&&cleverapps.payments.logPurchase(t),cleverapps.paymentsHistory.addPayment(this),this.favoriteId=Favorite.CalcFavorite(),this.favoriteId===i.itemId&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAVORITE_REGULAR,{amount:i.price}),cleverapps.history.add("paid",i.price),cleverapps.history.add("pmnt",1)),this.favorite)cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAVORITE_PRODUCT_BOUGHT,{amount:i.price});else if("gunShot"===this.itemId)cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GUN_SHOT);else if("battlepass"===this.itemId)cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BATTLE_PASS_BOUGHT);else if(-1!==["starterPack0","starterPack","starterPack2"].indexOf(this.itemId)){var e=["starterPack0","starterPack","starterPack2"].indexOf(this.itemId);cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PACK_BOUGHT_WITH_PAYMENT)
,cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PACK_BOUGHT+"_starterPack"+(0===e?"":"_"+e))}else-1!==["piggybank500","piggybank1800","piggybank6000","piggybank25000"].indexOf(this.itemId)?(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PIGGY_BANK),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PIGGY_BANK_LEVEL+this.piggyBankLevel)):-1!==["addMoves1","addMoves2","addMoves3","addMoves5"].indexOf(this.itemId)&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BUY_MOVES+this.itemId)}.bind(this);e?cleverapps.payments.compensateValidate?cleverapps.payments.compensateValidate(s):s():cleverapps.payments.validate(t,s)},Product.prototype.showBoughtMessage=function(e){var i=this.boughtMessage||"messages:Product.YouBought",s=this.boughtMessageParams||{};s.moves=this.moves,e&&e.gold&&(s.coins=e.gold);var n=cleverapps.isLocalhost()?this.image:cleverapps.config.deployment+this.image;cc.loader.load(n,function(e){var t=void 0;e||(t=new cc.Sprite(n)).setScale(.6*resolutionScale)
;cleverapps.Notification.create(i,{toReplace:s,image:t,leaveOnResize:!0})}.bind(this))},Product.prototype.compensate=function(){var t=this.compensateReward||this.reward;t&&(this.validate(void 0,!0),this.showBoughtMessage(t),cleverapps.metha.display({focus:"purchaseRewardWindow",action:function(e){new PurchaseRewardWindow({reward:t,callback:function(){}}),cleverapps.metha.onceNoWindowsListener=e}.bind(this)}),cleverapps.audio.playSound(res.shop_buy_effect))},Product.prototype.buy=function(n,o){var e=n,a=(n=function(){cleverapps.payments.onPaymentFinished&&cleverapps.payments.onPaymentFinished(),e&&e()},function(e,t,i){if(e){cleverapps.Notification.create("messages:Product.PurchaseCancelled"),cleverapps.payments.onPaymentFinished&&cleverapps.payments.onPaymentFinished(),i&&(cleverapps.metha.display({focus:"ErrorWindow",action:function(e){new ErrorWindow(i),cleverapps.metha.onceNoWindowsListener=e}}),cleverapps.ReportStream.send("product","product buy error "+i))}else{if(this.validate(t),
this.showBoughtMessage(this.reward),cleverapps.user.incProgressCompare(500),this.reward){var s={reward:this.reward,callback:n};cleverapps.metha.isFocused()?new PurchaseRewardWindow(s):cleverapps.metha.display({focus:"purchaseRewardWindow",control:o,action:function(e){new PurchaseRewardWindow(s),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})}else n();cleverapps.audio.playSound(res.shop_buy_effect)}}.bind(this)),r=cleverapps.metha.focus,t=function(){var s=this.waitWindow();cleverapps.payments.open(this,function(e,t,i){s&&s(),r!==cleverapps.metha.focus&&cleverapps.metha.isFocused()?cleverapps.metha.whenFreeFocus(function(){a(e,t,i)}):a(e,t,i)}.bind(this))}.bind(this);cc.sys.isNative?t():cleverapps.social.checkConnection(t)},Product.prototype.waitWindow=function(){var t;return cleverapps.metha.isFocused()?t=new WaitWindow:cleverapps.metha.display({focus:"WaitWindow",action:function(e){t=new WaitWindow,e()}}),cleverapps.waitNoMore(4e3,function(){t.close()})},Product.Create=function(
e){var t;switch(e){case"askLives":t=new AskLivesProduct(e);break;case"refillLives":t=new RefillLivesProduct;break;default:t=new Product(e)}return t},Product.CURRENCY="$",Product.CURRENCY_CODE="USD";var Terms=cc.Node.extend({ctor:function(){this._super();var e=new cc.Node;e.addChild(cleverapps.UI.generateTTFText("messages:Terms.TermsOfService",cleverapps.styles.FONTS.TERMS_LINK_TEXT)),cleverapps.UI.wrap(e),this.addChild(e);var t=cleverapps.UI.generateTTFText(" "+Messages.get("Terms.and")+" ",cleverapps.styles.FONTS.TERMS_TEXT);this.addChild(t);var i=new cc.Node;i.addChild(cleverapps.UI.generateTTFText("messages:Terms.PrivacyPolicy",cleverapps.styles.FONTS.TERMS_LINK_TEXT)),cleverapps.UI.wrap(i),this.addChild(i),cleverapps.UI.arrangeWithMargins(this.children,{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.Terms.margin}),cleverapps.UI.wrap(this),cleverapps.UI.applyHover(e),cleverapps.UI.applyHover(i),cleverapps.UI.onClick(e,function(){cc.sys.openURL(projects.default.terms)}),
cleverapps.UI.onClick(i,function(){cc.sys.openURL(projects.default.privacy)})}});cleverapps.overrideColors(cleverapps.styles.COLORS,{TERMS_LINK_COLOR:new cc.Color(97,167,221,255),TERMS_TEXT_COLOR:new cc.Color(55,80,58,255)}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{TERMS_TEXT:{size:25,color:cleverapps.styles.COLORS.TERMS_TEXT_COLOR},TERMS_LINK_TEXT:{size:25,color:cleverapps.styles.COLORS.TERMS_LINK_COLOR}}),cleverapps.styles.Terms={margin:6};var Restore=cc.Node.extend({ctor:function(){this._super();var e=cleverapps.UI.generateTTFText("messages:RestorePurchases",cleverapps.styles.FONTS.TERMS_LINK_TEXT);this.addChild(e),cleverapps.UI.wrap(this),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,function(){cleverapps.payments.restore();var e=new WaitWindow;this.stopWait=cleverapps.waitNoMore(5e3,cleverapps.once(function(){e.close(),this.recreateWindow(),delete this.stopWait}.bind(this))),cleverapps.subscription.onChangeStateListeners.restore=this.createListener(
this.onChangeSubscription.bind(this))}.bind(this))},recreateWindow:function(){var e=cleverapps.windows.currentWindow();new SubscriptionWindow,e instanceof SubscriptionWindow&&e.close()},onChangeSubscription:function(){cleverapps.subscription.isActive()&&(this.stopWait?this.stopWait():this.recreateWindow())}}),BonusButton=cleverapps.UI.Button.extend({ctor:function(e){var t=cleverapps.styles.BonusButton;this.onClick=e.onClick;var i,s=new cc.Node;s.setContentSize(t.width,t.height),s.setAnchorPoint(.5,.5),this.withBonus=e.reward||e.price,e.text?(i=cleverapps.UI.generateTTFText(e.text,cleverapps.styles.FONTS.BONUS_BUTTON_TEXT||cleverapps.styles.FONTS.BUTTON_TEXT)).fitTo(.8*s.width):i=e.content;var n=[i];if(this.withBonus){var o,a=[cleverapps.UI.generateTTFText(e.reward?"+"+e.reward:e.price,cleverapps.styles.FONTS.SHARE_BUTTON_REWARD_TEXT)];!1!==e.rewardIcon&&((o=new cc.Sprite(e.rewardIcon?e.rewardIcon:bundles.menubar.frames.coin_png)).setScale(t.RewardCoins.scale),this.coin=o,a.push(o)),
n.push(new cleverapps.Layout(a,{direction:cleverapps.UI.HORIZONTAL,margin:t.RewardCoins.margin})),o&&(o.y+=t.RewardCoins.offsetY)}var r=new cleverapps.Layout(n.reverse(),{direction:cleverapps.UI.VERTICAL,margin:t.margin});r.setPositionRound(s.width/2+t.content.offset.x,s.height/2+t.content.offset.y),s.addChild(r),this._super({content:s,width:s.width,height:s.height,fitTo:!1,onClicked:this.doAction.bind(this)})},doAction:function(){this.onClick()},animateCollectCoin:function(e){if(this.withBonus){cleverapps.audio.playSound(res.shop_buy_effect);var t=function(){e&&e()};cleverapps.styles.MenuBar.GoldItem.target&&this.coin?WindowHelper.animateCollect(this.coin,{scale:1,target:cleverapps.styles.MenuBar.GoldItem.target},t):t()}else e&&e()}});cleverapps.styles.BonusButton={width:300,height:110,RewardCoins:{scale:.5,margin:10,offsetY:0},margin:-10,content:{offset:{x:0,y:0}}};var CoinsPriceView=cc.Node.extend({ctor:function(e,t){this._super(),this.options=t||{},
this.styles=this.options.styles||cleverapps.styles.CoinsPriceView,this.price=e,this.setAnchorPoint2(),this.createContent(),this.createBg(),this.setCascadeOpacityEnabled(!0)},createContent:function(){this.content&&(this.content.removeFromParent(!0),delete this.content);var e=this.styles.icon&&this.styles.icon.image,t=new cc.Sprite(e||bundles.menubar.frames.coin_png);t.setScale(this.styles.icon.scale),e&&this.styles.icon.offsetY&&(t.y+=this.styles.icon.offsetY);var i=this.styles.text&&this.styles.text.font||cleverapps.styles.FONTS.COINS_PRICE_TEXT||cleverapps.styles.FONTS.TEXT,s=this.label=cleverapps.UI.generateTTFText(this.price,i),n=this.styles.isLabelFirst?[s,t]:[t,s];this.content=new cleverapps.Layout(n,{margin:this.styles.margin,direction:cleverapps.UI.HORIZONTAL}),this.label.y+=this.styles.label.offsetY,this.addChild(this.content),this.setContentSize2(this.content.getContentSize()),this.content.setPositionRound(this.width/2,this.height/2),this.content.setCascadeOpacityEnabled(!0)},
createBg:function(){this.styles.bg&&(this.bg&&(this.bg.removeFromParent(),delete this.bg),this.bg=new cc.Scale9Sprite(this.options.bg||this.styles.bg.image),this.addChild(this.bg),this.bg.setLocalZOrder(-1),this.bg.setContentSize2(this.width+2*this.styles.bg.padding.x,this.height+2*this.styles.bg.padding.y),this.bg.setPositionRound(this.width/2+this.styles.bg.dx,this.height/2+this.styles.bg.dy))},setPrice:function(e){this.price!==e&&(this.label.setString(e),this.price=e,this.createContent(),this.createBg())}});cleverapps.styles.CoinsPriceView={icon:{scale:.7},label:{offsetY:0},bg:{image:bundles.game.frames.ruby_substrate_png,padding:{x:2,y:-3},dx:4,dy:0},margin:0};var CoinsRewardView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2(),this.options=cleverapps.extend({},cleverapps.styles.CoinsRewardView,e)},collectCoins:function(e){var t=[];if((this.options.coins||cleverapps.styles.CoinsRewardView.coins).forEach(function(e){t=t.concat(this.drawCoinsInCircle(e))}.bind(
this)),e){var i=cleverapps.UI.generateTTFText("+"+e,cleverapps.styles.FONTS.COINS_REWARD_TEXT);i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setPositionRound(this.width/2,this.height/2),i.setScale(this.options.text.scale/2),i.setLocalZOrder(1000001),this.addChild(i),i.replaceParentSamePlace(cc.director.getRunningScene().scene),i.opacity=0,i.runAction(new cc.Sequence(new cc.FadeIn(.2),new cc.ScaleTo(this.options.showTextTime||CoinsRewardView.SHOW_TEXT_TIME,this.options.text.scale),new cc.FadeOut(.2),new cc.RemoveSelf))}var s=cc.director.getRunningScene().scene,n=this.options.target||cleverapps.styles.UI.RewardElementView.rewardGoldViewTarget||cleverapps.styles.MenuBar.GoldItem.target,o=s.convertToNodeSpace(n.getParent().convertToWorldSpace(n.getPosition()));if(t.sort(function(e,t){return e.getPositionX()-t.getPositionX()}).forEach(function(e,t){e.replaceParentSamePlace(s),e.runAction(new cc.Sequence(new cc.DelayTime(CoinsRewardView.APPEAR_TIME+.01*t),new cc.Spawn(new cc.MoveTo(
CoinsRewardView.COLLECT_COIN_TIME,o),new cc.RotateBy(CoinsRewardView.COLLECT_COIN_TIME,180)),new cc.RemoveSelf))}.bind(this)),this.options.sparkAnimation){var a=new cleverapps.Spine(bundles.game.jsons.coins_reward_json);a.setAnimation(0,"animation",!1),a.setPositionRound(this.width/2,this.height/2),this.addChild(a)}this.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.RemoveSelf))},drawCoinsInCircle:function(e){for(var t=[],i=0;i<e.count;i++){var s=new cc.Sprite(bundles.menubar.frames.coin_png);s.setRotation(120*(Math.random()-.5)),s.setScale(0),s.setLocalZOrder(1e6);var n=2*Math.PI*i/e.count,o=(e.baseAngle||0)*Math.PI/180,a=e.radiusX*Math.cos(n+o),r=e.radiusY*Math.sin(n+o);this.options.randomOffset&&(a+=.5*(Math.random()-.5)*a,r+=.5*(Math.random()-.5)*r),s.setPosition(this.width/2+a,this.height/2+r),s.runAction(new cc.Spawn(new cc.MoveBy(CoinsRewardView.APPEAR_TIME,new cc.p(.2*a,.2*r)),new cc.ScaleTo(CoinsRewardView.APPEAR_TIME,e.scale))),this.addChild(s),t.push(s)}return t}})
;cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{COINS_TEXT_STROKE:{size:3,color:cleverapps.styles.COLORS.COINS_REWARD_STROKE_COLOR}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{COINS_REWARD_TEXT:{size:120,color:cleverapps.styles.COLORS.COINS_REWARD_YELLOW,stroke:cleverapps.styles.DECORATORS.COINS_TEXT_STROKE}}),CoinsRewardView.APPEAR_TIME=.4,CoinsRewardView.SHOW_TEXT_TIME=1.2,CoinsRewardView.COLLECT_COIN_TIME=.5,cleverapps.styles.CoinsRewardView={sparkAnimation:!0,randomOffset:!0,text:{scale:1},coins:[{radiusX:80,radiusY:80,count:6,scale:1}]};var ReloadWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.styles.ReloadWindow,i=new cc.Node,s=function(e){e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.setDimensions(cc.sizeRound(t.width,0)),i.addChild(e)};s(cleverapps.UI.generateTTFText("messages:ReloadWindow.YouHaveSavedGame",cleverapps.styles.FONTS.WINDOW_TEXT)),s(cleverapps.UI.generateTTFText("messages:ReloadWindow.WeStoreGames",
cleverapps.styles.FONTS.WINDOW_TEXT,{gameTitle:Messages.get(cleverapps.config.title)})),cleverapps.UI.arrangeWithMargins(i.children,{direction:cleverapps.UI.VERTICAL,margin:t.margin,y:t.paddingY}),cleverapps.UI.wrap(i),i.setAnchorPoint2(),i=cleverapps.UI.wrapWithPadding(i,t.padding),this.content=i,this._super({content:i,title:"messages:ReloadWindow.Title",name:"reloadwindow",button:{width:t.Button.width,text:Messages.get("ReloadWindow.UpdateNow")},onClose:e,closeButton:!1,notCloseByTouchInShadow:!0}),cleverapps.audio.playSound(res.window_effect),cleverapps.windows.list=[this]}});cleverapps.styles.ReloadWindow={width:600,margin:20,paddingY:10,padding:{x:0,y:10},Button:{width:void 0}};var LocalStorageDisabledWindow=Window.extend({onWindowLoaded:function(){var t=cleverapps.styles.LocalStorageDisabledWindow,i=new cc.Node,e=function(e){e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.setDimensions(cc.sizeRound(t.width,0)),i.addChild(e)};e(cleverapps.UI.generateTTFText(
"messages:LocalStorageDisabledWindow.text2",cleverapps.styles.FONTS.WINDOW_TEXT)),e(cleverapps.UI.generateTTFText("messages:LocalStorageDisabledWindow.text1",cleverapps.styles.FONTS.WINDOW_TEXT)),cleverapps.UI.arrangeWithMargins(i.children,{direction:cleverapps.UI.VERTICAL,margin:t.margin,y:t.paddingY}),cleverapps.UI.wrap(i),i.setAnchorPoint2(),i=cleverapps.UI.wrapWithPadding(i,t.padding),this.content=i,this._super({content:i,title:"messages:LocalStorageDisabledWindow.title",name:"localstoragedisabledwindow",button:{text:Messages.get("OK"),width:t.button.width},closeButton:!1}),cleverapps.audio.playSound(res.window_effect)}});cleverapps.styles.LocalStorageDisabledWindow={width:600,margin:20,paddingY:20,padding:{x:0,y:5},button:{width:200}};var ErrorWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.WINDOW_TEXT);t.setDimensions(cleverapps.styles.ErrorWindow.dimensions),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),
this._super({content:t,title:{text:Messages.get("RestartWindow.Title"),localized:!0},name:"errorwindow",button:{text:Messages.get("OK")}}),cleverapps.audio.playSound(res.window_effect)}});cleverapps.styles.ErrorWindow={dimensions:{width:500,height:0}};var RestartWindow=Window.extend({ctor:function(e){if(!RestartWindow.showed&&!cleverapps.environment.isSceneWithPreview()&&cc.director.getRunningScene()){RestartWindow.showed=!0,this.options=e=e||{},cleverapps.versionChecker.isNewClientVersionAvailable()&&(e.title=e.title||"RestartWindow.NewVersionTitle",e.contentMessage=e.contentMessage||"RestartWindow.NewVersionAvailable");var t=e&&e.contentMessage?Messages.get(e.contentMessage):Messages.get("RestartWindow.AnErrorOccured")||"An error occurred";this.text=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.WINDOW_TEXT,!1),this.text.setDimensions(cleverapps.styles.RestartWindow.width,cleverapps.styles.RestartWindow.height),this.text.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),
this.text.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),this._super({parentScene:!0}),this.setLocalZOrder(1001)}},onWindowLoaded:function(){var e=this.options&&this.options.title?Messages.get(this.options.title):Messages.get("RestartWindow.Title")||"Try again";this._super({content:this.text,notCloseByTouchInShadow:!0,title:{text:e,font:cleverapps.styles.RestartWindow.title.font,localized:!0},name:"RestartWindow",button:{text:Messages.get("RestartWindow.ButtonMessage")||"Reload",width:cleverapps.styles.RestartWindow.button.width,onPressed:function(){window.location.reload()}},closeButton:!1,styles:cleverapps.styles.RestartWindow}),this.window&&0===this.window.height&&(this.text.removeFromParent(),this.window.titleText.removeFromParent()),cleverapps.settings&&cleverapps.audio.playSound(res.window_effect)}});cleverapps.styles.RestartWindow=cleverapps.overrideStyles(cleverapps.styles.Window,{width:570,height:460,Background:{scale9:3},button:{width:250},title:{}},!0),
cc._loadingImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAu4AAAU2CAMAAAD9CcM0AAADAFBMVEUCAgEDAwIEBAMFBQQGBgUHBwYICAcJCQgKCgkLCwoMDAsNDQwODg0PDw4QEA8RERASEhETExIUFBMVFRQWFhUXFxYYGBcZGRgaGhkbGxocHBsdHRweHh0fHx4gIB8hISAiIiEjIyIkJCMlJSQmJiUnJyYoKCcpKSgqKikrKyosLCstLSwuLi0vLy4wMC8xMTAyMjEzMzI0NDM1NTQ2NjU3NzY4ODc5OTg6Ojk7Ozo8PDs9PTw+Pj0/Pz5AQD9BQUBBQUFCQkJDQ0NERERFRUVGRkZHR0dISEhJSUlKSkpLS0tMTExNTU1OTk5PT09QUFBRUVFSUlJTU1NUVFRVVVVWVlZXV1dYWFhZWVlaWlpbW1tcXFxdXV1eXl5fX19gYGBhYWFiYmJjY2NkZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYCCgoGDg4KEhIOFhYSGhoWHh4aIiIeJiYiKiomLi4qMjIuNjYyOjo2Pj46QkI+RkZCSkpGTk5KUlJOVlZSWlpWXl5aYmJeZmZiampmbm5qcnJudnZyenp2fn56goJ+hoaCioqGjo6KkpKOlpaSmpqWnp6aoqKepqaiqqqmrq6qsrKutrayurq2vr66wsK+xsbCysrGzs7K0tLO1tbS2trW3t7a4uLe5ubi6urm7u7q8vLu9vby+vr2/v77AwL/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7///+xGNHLAABQFUlEQVR4AezSP2vVBxQA0JumCaUpdGpLW1oaCk3JkCUdSraEfoGGDoV2bad2URwE0clVlIc4OIkuDlE3CWRwcVHQVU0IakRDJGAkSv7EdzW+32/U3fvO+QwnEvpGJOgOuoPuoDvoDrqD7qA76A66g+7oDrqD7qA76A66g+6gO+gOuoPu6A66g+6gO+gOuoPuoDvoDrqD7ugOuoPuoDvoDrqD7qA76A66g+7oDrqD7qA76A66g+6gO+gOuoPuoDu6g+6gO+gOuoPuoDvoDrqD7qA7uoPuoDvoDrqD7qA76A66g+6gO7qD7qA76A66g+6gO+gOuoPuoDu6g+6gO+gOuoPuoDvoDrqD7qA7uoPuoDvoDrqD7qA76A66g+6gO+iO7qA76A66g+6gO+gOuoPuoDvoju6gO+gOuoPuoDvoDrqD7qA76I7uoDvoDrqD7qA76A66g+6gO+iO7qA76A66g+6gO+gOuoPuoDvo/g7oDrqD7qA76A66g+6gO+gOuoPu6A66g+6gO+gOuoPuoDvoDrqD7ugOuoPuoDvoDrqD7qA76A66g+7oDrqD7qA76A66g+6gO+gOuoPu6A66g+6gO+gOuoPuoDvoDrqD7qA7uoPuoDvoDrqD7qA76A66g+6gO7qD7qA76A66g+6gO+gOuoPuoDu6g+6gO+gOuoPuoDvoDrqD7qA7uoPuoDvoDrqD7qA76A66g+6gO7qD7qA76A66g+6gO+gOuoPuoDvoju6gO+gOuoPuoDvoDrqD7qA76I7uoDvoDrqD7qA76A66g+6gO+iO7qA76A66g+6gO+gOuoPuoDvoju6gO+gOuoPuoDvoDrqD7qA76A66ozvoDrqD7qA76A66g+6gO+gOuqM76A66g+6gO+gOuoPuoDvoDrqjO+gOuoPuoDvoDrqD7qA76A66ozvoDrqD7qA76A66g+6gO+gOuqM76A66g+6gO+gOuoPuoDvoDrqD7ugOuoPuoDvoDrqD7qA76A66g+7oDrqD7qA76M7La2cvLmU/0J2l2c8ixs7sZnm683Qm9n1yLsvTnU70TK5mcbqzNRs9g/NZnO7cH4/GqSxOd258EY0DWZzuzH8ajT93szbdufxxNKY3sjbdmRuMxsRa1qY7V4ai8cNK1qY78yPR+Ope1qY717+Mxuc3szbduTMWjaG5rE131qaidTxr052d36P1dzdr053/ozW1nrXpzolofXsra9OdqyPR+Oh81qY7y6PROpi16c7Wb9GaeZ616c6xaH29mLXpzsJQNAYXsjbdefZrtDpZnO50ovVvN2vTnccT0Zh5kcXpzumB6BlfzeJ0Z/2X6Bl9kNXpzqXheOv75axOd7pHBnrdH2Z5urP5X+z7cTXr053Nw8MR8fN69gHd2bvwU8TkRvYF3Vk89N0/29kndOfJo1dZn+6gO+gOuoPu7HSzP+jO7aN//HVyJevTne3ON/HG9N1E9/fY28sP32v27sM9qmp9+/i9p6QHEgLSe0ERsABKQbEoFrEAHjlKEdCDRbGIooiooFgURfmJBVCxewRROYigIiAIIohKAQHphBJIQnrJZO73nZk9mT2TMnt6Qp7PlT/he032XnutZ+U9YoDdWAsrIST34ytnPvnU7LUnWbNZphjh0PckheResZ9ubRdrMMS1/c9K1mjz46G6PJdCcq9Iydx2UDX/v2LWXHvPgcrwIiskJPdvWqJM9JQi1lgT4XTpMVZESO67r4RG9IusqTY1hKrDH6yQkNzn1oNWnW9YQz0JVZ15rJCQ3IvvNsBNx02skbLPg2psKYXkXqGM6+BhYD5rok2N4ND1IIXkXrHjV8GDYTprouWJsDN+QiG5VyJvGDylrGEN9Etd2I3Mp5DcKzM1Cp7O2sGa58TZsLlmN4XkXqlV7VDOJYdZ88xpAESPPEghuVcu/3EjyhmWyxrHsvThh/+XSyG5V2XfNShHebyEQnI/Ff3TH+UYX6OQ3E9J+283wVPihwyTkiILheQePvmftIOn0xYwlApTN//24+fTn5n85INjbh1117inZ3yydMPujPyiUgrJPcR2jUmAh+Y/MiSKj/+xYPrd1/VtFacYDdBSohud0feG2x/7vwUbj5QwRAQoCub1gIcz1jPo9i+bMaxPi2gFVTI16T1m5o97Chkikrs48mg83J2zkcGUs2X2bd3rKNAp7szb399ZzNCQ3MXS8+GuxyYGy4mfJl91mhE+ajr0g51WhoLkLo6OVeCmzzYGQ/HqFy9vAL8Yu47/IYehILmLD1rAzUV7GLADn9zYGAFIHvJRBkNAchcbLoKbKw8yILkr7j3dgAAZL5qVThH83MXR+4zQunof/Zf5xY3JCAbjBW+doAh67qJkdlNoXbybfkr76MoYBIv5oo9OUgQ9d/FzX2j13UJ/ZH92SVWxR6c0PuPSm0ffef+kl2dMe/bR+0YOuujsVilxRlQqcfDKUopg5y5S7zRD45y19FnevCuiKy29Yc8xz7y7+p+0zHyWsRYXZB3c/PPX70wec1mbeFSo/oQDFMHOXRTOag6Ndsvom+LlN8WiQjGtB0784s+jxayCZd+iyTd0qYMKdPmwmCLYuYu1l0Cj1Y/0xbax9VGR2PPv/3BHHvUo2j//rjOjUE7s7X9SBDt3cWxcLFzO2UHdMmedgQok9Zq08hB9kTZ/cFOU0/GdXIog5y5KPmoPl+et1GnZNRX9KPd4cuUJ+qx43aNd4Cl+2HaKYOcudvxbgdNN2dRl5yN1UU6z2z87Sj/9/dw58HTuVxTBzl3kT2sA1agc6nDy7a4op8vjv5cwAP9M6wwPSc/lUQQ7d7HkfNhFzbHSu403xcCDqceMfQzUjgeT4M74n0MUwc5dHJ+YAsBwxzF6lftme3gw9HrnKINh9b/NcHfFVoqg5y5WPzx4xHsn6NXOW2PhofurBxkkJ2d0grtzv6cIfu6i0ELvFp4DD82n7GMQbR1hhptWX1BEIneR+lgy3CXdtoHBVfhma7g57Z1ihp3kLn68EO6UixYXMejW9oGbxOmlDC/JXeS/0gTuOrySzlA4dKcZWgmvh7d3yV3sGW2Gm8Q7tjBEil9Nhlbi6xaGj+QuVveFuz7/LWbIWD9oBa06cxgukrso/bg13CSHek/6D2dCq8GnDA/JXWQ/kwQ33b4uZYj9fDa0Wv7IcJDcxb7hcBNz2y6G3m/dodV9C4XkHnrr+sBNu9n5DIdN3aB11WEKyT3U5rWCm+v/ZJis7wqt/+RQSO4hVfB8ErTqTT3JsPm5HTQM06wUknsIZT4UDa1u34Y1uW8bQaPREgrJPXRO3K5A6+a/GV6zE6Fx4SEKyT1UDtwErTqTTzLMip8yQeOxYgrJPTQ2XwmtFh+WMuwyboZG8jcUkntI/NoDWt1XMBJ2dofGhWkUknsILOsErRu2MzIWpcDFMKWUQnIPum/bQCPq4QxGiHUyNJpvoJDcg21+M2ikzLQwYjKvhMbwHArJPbg+agiNlvMYSUtPg0v8JxSSe1B91AAanb9nZE2ExkVpFJJ7EH1yGjR6rmeE7e8GF+MbVgrJPWg+awKNy7Yz4mYb4dIjlUJyD5a59aHxrwOMvPSL4WJ8m0JyD5J3k6Ex/Birg89i4XLRcQrJPSjm1IXGmAxWCycHwCX6YwrJPRg+S4GL8f4sVhPz4uEyMJ9Ccg/c/MZwMT2Uw+oi60q4NFhJIbkHbElLbe1PFLL6mBsDl3ElFJJ7gH7tBJfoCQWsRo5dAJdOf1NI7oHZ0hMuhnF5rFamG1DGNINCcg/I333hYhyXw+plZyu4XJVJIbkHYM+lcDE+nMtqpnAUXFJ+ppDc/XfsWmg8UMhq53MjXJ6hkNz9ljECGqOzWP3s7gqXq3IoJHc/5d0PjZtOsBoqHQOX5usoJHc/vRQFl8GprJa+iEMZwwwKyd0/81Pg0v8Aq6ddXeEyMJtCcvfH8pZw6b2V1VTJCLh03EIhufthVze4nPs7q63XDSgTP5++k9xF9o1wab+G1dfqRLhMttJXkrsoegguDZewGkvtDpfrcukryV28EYsyiXNZnRXcCpf2/9BHkrtY2QxlTC9YWa09A5fk7+gbyV3sPB9llAeKWb19k4wyynT6RHIXhXfAZcARVnPb2sLlwRL6QnIXHyWizLl/sbo73g8u12bSB5K72NIBZZotY7VXPBIuZxygkNz1KxiKMjEzWQOMh0vjPygkd/1mm1Hm3kLWANMVlKm7lEJy1217e5S5+DhrgvnxKGOaSyG561U8FmWar2GNsCIZLtMoam/uWWu+/Pyr5ZuPFFCfhQlwiprOmuH3JnB5uJRVKDyeeqxIcj9VLb+mHqDUaXbuZTcOGz3mnvvGPfrEKx+t2ptVwoplXIMyg7JZM2w7Ey7DClmJg/974Y4repzV/cq7pq/KldxPQUtboTxDfINW3YdM/XZHAct5LxZOLdawhjjY2/t51YwVd7Uywyn+wjfTJPdTTUZ/VKHJNZMXH6WbtPPhZJ7GmiLrMrj0O8ryNj7bHe6ilkjup5oN9VG12LPHL8+hy/+Z4XRxOmuKoqvg0n0vPVjX3NoQngYeltxPNavqwquLd7FMahc4xS1kjVFyPVxO30U3Jd/fEINyrjn1apfc93aCN5ctL2GZN41wuq+YNUbhELi0cs9966gElDcolZL7Kcc6FVVr/WI6XU5cDKcWm1lz5A2DS7Nt1FjQGuVFP5xJyf0UlP1EfVQq+YrXD1Dry7pQKZNKWXPk3gqXJr/TZW4dlNf1Cysl91OS5YdHLm+ZoMCTqf4lz67IoZviUXDqtJU1SOFouDRayTK/1Ec5zZ7cQ0rup6zCI5u//b9xQ6+7vF+f3j179ep1Qf+hT3y0/lAhPW3rBJUygTVJ6Ri4NPiOTiVD4anNhF2k5C7I2VFQtV3PGuUOuCQtotOe9nATffEru2knuYuRcBpezBrldrjELabTlmbQaPvQz9l0kNzF3s5QJSxgzTIcLjHf0ymtD5zqXDvnOAWoEgtjoep+gjVK6WC4xC2jk3WmEXbN711upZDcNabA6QHWLLnXwiVhGctkP9vcqCRdPOsg3UjuonQ4VIlfsmZJvwIuSUvpUrj+g/fX5NKD5C7SL4HqzF2sWY5cDJf6Sygkd282tYfqhmLWLPt6wqXh9xSSuzf/S4bqIdYwO7rCpclyCsndm5lmqKazhvmrLeDLISzJXUyESvkva5i1DeHSbhOF5K77y2T8SoZE4a51f6QzFJYmwuWMPRSSuxeFA6Fqso0Byd/09SdLd+TQ3YmvR56e0nDAKobA5zFwOS+NQnL3Iv1yqE7fxwBkfXpDq4To+Bb9J6/KYpld0/pGwabt9wy+t81wuTSDQnL3IrUPVN2P0H8bB8dClXLhhE9/3JqRl73j67HtAaBhlwZA28V0Z2XAXlDgcn02heTuxT/nQHVJBv2V9mJTIO6ysY/de20LADAktuh8zlktogGYuj+zNXtpW6DFrAw6pc2fOGb4yCdXMyCWR6ExooBCcvdi65lQDcihn5ZdAuCCeVkkCze+dk19lEm84aNDJPlVU8B8+VsbDxaQ2X+92jceNvXv3ccAFP4HGmMtFJK7FxvbQXVzMf1yYsppQKOpR6jK2/zp2CvPP/uss7pd9uSqHDp8dwYAQ8Nzrx16y0VNUKbT11b6LWcgNJ6gkNy92dACqv/QL8v6A8Yb11DLWlxYUFBQWEKXP0YlwaXeoAcGRQNA7CMZ9Fd6P7gor1BI7t5sOC2gPQRHJyYDbWbm0av8pQ92STQBQFSbB1bks3h2fdgM3kc/7e8MF9MHFJK7N5tSoJpEn2V/2BtIvH0L9Tmxad7LT0+a9u0h2n3TADbnr6d/1jeGS8J3FJK7N9vqQfUCfXVylBHGy78ppp8+T4FNp5/ol2/j4dJoDYXk7s3mZKim0lfrEoBJGfTfG2bYNPuG/nhbgUvHzRSSuzcb60P1qJU++i0JeJkBsEyAXdN5VvpuAjR67qOQ3L35oy1UtxXSRxtPAy7MZABy74Ddad/SZ6W3QOPqNArJ3Zt9PaC6voA+2nMWYP6CgcgYDruWvvee0Rcao/MoJHdvci+Aqn8ufZQzCMDAwsB6HwK7tpvoo7/bQmOChUJy96o/VH2O0Ff3A2iwmgFJvQ52Vx2nb36qC403KCR3726Gqs02+uptE4DHShmQg1fA7nn6Zq4CF/PXFJK7D+sb8b/QV7/UBdD5EAOz9TzYdD1In0yFRoPfKCR372ZCZfoffXWgIwDDFwzQr45dwwvoi6I7odHpAIXk7t38aDgYnqOv8gcCwFALA/RhPAC8WHSghLplXguNS3MoJHfv1reCagR99igAtN3OAFmeB4DJX/W5der3+dRnX3dojLBSSO7eHQvkONOn8QCMsxiovFsBvDwAwEV7qc+GptCYSB0kd1E4CKomf9JXG5sDwJASBiq1H+pNSwEwNIv6zIuGi+FN6iG5iyegMiykr470A4B22xiw39oPeQoAnqROk6CR+D/qIbmLj01QPUpfWcYCgHEOA7d26aUAzHOpT9710GjxB/WQ3MX6RlD1L6KvZpgA4LYCBm7daQAaLKM+f58OjfMOUw/JXaT3DOC76up6ANB2DwM33QzgrB3U55s4aNxSQD0kd1E6Dio/djemtgeA6C8ZsLzBAHBjOvV5HlrPUh/JXXyiQPUYfZX/L9jcz4DtbAMAEwupS84t0Ij5kvpI7mJLB6j6ZdFXk2HTJ42B+i4GgHmOlbps7wKNlhupj+Quiq4uy2YDffVZPAAk/8xAvQgAsd9Rn2/qQOPio9RJchdToFLm0Feb2wGA4QUGqOBaADhtsz+r7riniDpJ7uLHOKhuyaePMi+FzcBAg9vWGAA6H6UumVdA6y3qJbmLfV2garKTPrKOh027rQzMwigA6F9AXX5tBo3ktdRLchfWW+E0i776wASbLxmYVxRf5lTOMECj1wnqJrmLuWaobi6gjzY2gc1DVgaiYLQvk8wKhkNrjIW6Se5iRxuoWu+gj052g02vkwzE/u4AEPcFddnSBRrmt6mf5C5KxkBleos+stwBm8a/MhAr6gJAqw3U5b0YyHhIyd1v/42D6vo8+uhN2CizGYh3YNPzCPUouR1afY/QB5K7ONEVqobr6aOlSbC5zcIAjIfNoCLqsaMLtMaV0BeSu3gATlPpo4M9YHPuMfovfzBs7qYuH0ZDwziPQnL3ycJYqLodp28sQwBdO9W9/15PoR5FI6HVejeF5O6To92giplPH70Ku1fov68TAMA4m3ps6QStmy0UkrtvJrnyKaJvfkiAza0F9NtLsEn4hnq8HwUN05sUkruPfk2CKmUdfbO3C2zapNJvd8LmtLXUoWg0tBr/TiG5+yj/RjhNoG8Kr4dNwgr6q2AAbNrupA7bukKrfwb9J7nL0nvX/X4d8VBeor+Od4dN7zTq8HEMNJSnrRSSu6/SesHp/3wsaLEjwOFF9NPWprAZUeT7N6Y631NI7r57Ef7e47GtHWy67A5sYcbwPHXY2Qla5xyikNx9t6MdVHW+pU8KBsEm+Xv6aYoCAAlfUod3jdC6x0IhufvOOgZONxbSJ+PtuRqepX/yh8Cm2W/0Lv8maJnmUUju/vjeDFXdNfTJguiAhhsdOV//w9DaRtDquJdCcvdHzpVwustKX2xvCJtOe+iXra1hc1EavbI+Cze3Wigkd7+8FQ1V4zX0RfqlsDGvoF9W1oPNjbn06tDF0Ip7n0Jy909qNz/fAK13we41+mWeGTZ3ltCrbxKh1XE7heTupzdMUDX/g754Kwo2N1sDuQ3tSXpluRtu7iygkNz9tK8rnO4vpQ/WNIRNj4P0x0TYvenrmGuY51FI7n57Hk6NfqcPDnaHTd2f6If8EbCJ+opevQ03XQ9RSO5+S+0Epwet1K/4P7AxzKAf9veDTf1V9Obk1XDzOIXkHoApcGqxlT6YZoDNsBL67te2sGm/jd78lACtuj9TSO4B2NIKTg9Yqd/KurC5II2+m58Imz6H6UXRQ3BzeRaF5B6A0glwavoX9UttAZvGv9F36gS8wV7j3dQRWoYXrRSSeyB2tILTQ9Qv71rYzaPvHobduGJ6Md0ErUbrKCT3wDyuQNVkA3WzToTd0/RZ6c2wMb9FL473g5sbMykk98BsaQune4qp22wzbK610FdZjooTv6MX8+Lg5h0rheQeoKkKVI1/oW7rWsDmrAP01f7OsGm6iVUrugZu2uygkNwDtbcznO62UK9jPWCTuJS++qs1bLoeZNW+i4ObsRYKyT1gz8Ip+RfqVTgKdu/QV8sbwuaiE6xS3hC4SVpGIbkHbl87OA0tpl7TYHdHMX20oA5sBueySssbw8312QwCyV28oECV/BP1WpTg57UGs6Jgc1sRq1L6oAFa5ncoJPcgP70PKaBOe5rDpuUmP5+dHrOyKn93hptuuxkUkrt4UYEq/gvqlH0BbKLmU+Xj0ZBprNJLJrh5msEhuYvU7nDqd4L6WB6G3cv0TcYA2H3Aqhw+D25a/s4gkdzFXBNUxlnU6W0f325VW8+CTdRSVuU1A9zcaWGQSO4i8xI4nX+Y+nyfApvzTtAnPzWBTf3fWYX9Z8FN0ncMGsldfBULp+eoT2oX2LT4jT75NBY27f5hFabC3TVZDBrJXRQMgVOrTdSl8ArYGD+mT6YrsOlxlJXb0hFuYucyiCR3saYOnMZRF+t42L1InzwGuyuyWamSyXDX8wiDSHIXltFwaryJusyG3ZBC+sA6EnbDilipPzvATfQMBpXkLtY0htNIfQEvTYZNl3T6IP8q2D1sZWVKxxngpncqg0pyF9YJcKq7iHrsPhM2Tf+gD9K7wUZ5mZVa3xoh3j8guYsDXeHU/yR1yLoUNlGf0ge7W8Am/jNWpuQuuOubxmCT3MX/maCKmksdisf5ce/2umTYNFvJyvzUCG6M7zPoJHeReQGczkmlDu/A7t951G9xPGzO2sZKpN8IdxemMfgkd7EgFk4TS+ndD/Vg0y2V+n0cBZv+h1mJ9+LhJuY9hoDkLoqHwanRWnqXeiZsWq7zfcjMiCxW7J/ecHfZEYaC5C5+S4HTkBJ6VXwRbMwf+n45/fgiVsjyBNzFzGVISO6i5CE4xX1Jr6wPwO556ma9G3YvlbJCy5vCXf9jFD4DhW+XmPZMpVdvwe526lZ0E2wM77JCJ6+Fu/gPGCqSu3g3Gk6T6NXXMbDplUe9stVbnf7HCr1mhrvrMhkqkrvI/xecmq6lN5vPgE373dTrcHfY1FnLivzZEu7qLmToSO7il4ZwuimXXmT21r3pQLXtDNg0384K5AyEhzFFDCHJXTwGlY5T10VDYTeTeq1pUcUIselmuOuwmaEkuYv9Z8Pp/KP04gXYPWqhTl/Xh80FJ1jeymZwF/UqQ0tyF5+Y4PQEvfjUCJv+WdTpnTjY3JDDcv65GB4GpDG0JHdRPAROTTayamsawaZDKnV6xgib0cX0lHMHPDRdylCT3MW6RnC6pYBVSu0Imwa/Up/ie2H3YCk9vRQDd8rkEoac5C6eUKCK+y+rlNMfNqaPqc/JQbB7hp4W1oeHaw4z9CR3kdoXTudV3ZxlPOxeYpWyDh7at/LD9//kob6we5se/uoED81WMhwkd7E4EU7jrazKW/B8Fi/KzSu2FmWlpaYe3vrz0qUL35pw13+uP6tRSnKsocuGPZ1hY/qK7vZcCA+G1xgWkruwPgyn5GWsykL1jtRM8thfi2c888zjdw4ddP3g6/tf0K1z5w6NYuDmtjVtYVN3Od0cGQhPg/IYHpK7OHIunK5IZxW2t4NNl9STb/RvkohyTFFxdVv3GjBw1KT3Pr0UTR9vDpumG6l14jZ46riV4SK5i//GQmWczipk94BNs2nXGwC0P+e8vr3O633pNTcOGTx45CMvvz7j/cUbN28+YKHN/2KUNvVgc/pOamTdbYSHOh8zbCR3UTgcTm13sXKWobCJTknomNBi8rb9abnZaalH0ovIooISusu5DgYjbM5LpUvuo1HwoIwvZPhI7mJbWzjdWcrKTYFDhw5XbaQXq5rC4bIMlimaGAVP16YxnCR3MSsWqjqLWbl3DbCLu0NHom8lwm5ALp1yJ8TAU5eNDCvJXeQPh1OfE16vjYyaVEDvcvrB7tyjtLPmrB1ohKd63zDMJHex8ww4TShlZf45EwCazKcemRfDLvq/JHP3LJx0SQLKiXuTYSe5i89joUpZxsqc6Aeg3SrqsqcLHK7+e/Fz/zo93oDyYp4uZNhJ7sJ6D5wuTGdlHgLabqA+21vDxqCYmsQZUCHD+AIKyT0CNNffPZmenlXKCuSMREt9tecf3T6nHrww35tFIblHxI9JUNUddMOND763Zv/JwlJqlK4bYWi5hlUpyfzn168/enPSkJ5tG0ShagbTvZkUknuETDNAK6FJh3P7XD5w5LhJz736+pxPFyxd0AVdluSWWOmp5PjahfPeffbeof1PPy0xxqhAl4Qp2RSSe6Tkj0IlFIPRFB2fFJ9y3nW3j5/62pvvzJ4z543pr097/M6hA3q1a1I/McpoUKCfYlQMxhtyKCT3yDncF05RqIICKAiEIdZojrkqj0Jyj6DNvZPNgKHxxfc8fE40QkeJNZujOh+mkNwjaeedBuC0+XuyCw/OvLyhWUGIGE1mU9NdFJJ7JB24RgHaHqNNxs8zx3RPMikIIkVx9h5lTPmDQnKPpI3tAHRMp5V2RYd+nHFn3yYxioLAKYbo+t2uNMNOMRsT11JI7pH0UwqA07OoUXh0/fwXhp6dYoICfynG+Kbn3vTUvA3HVjUoyz12GYXkHknfxwNok0N31uLsPasXTBvVq2mcCT5RDOaE5j2HTHx36e97M4tJbu0MB5MxagmF5B5J38YCaJLDClgt+ambVn418+F/9WzXqG5clNloUP4/lKPAYDBFxyU3Pf2S4U+8PX/5X4fySum0qz8cjEbzNxSSeyQtiQGQdIBelKT+tmThgi8+nfv+7JkvTbrr31dd1LfPBf36XzP436Pvf/rltz/4/MtFS39ev+N4ET3tGQEHg9E8n0Jyj6QVdQDEzGPI7L/XlfunFJJ7JG1pBUC5toChcnAcHBSjeRaF5B5J6QMAIHZBKUPk0IPO3A1Rr1FI7pFU8pYJAJp8V8zQ2H+XUpb7ixSSe0Qd6AKbuuP+tjAUDgyHyhA9tZRCco8k60exsFHO3hmS3vcPcuU+2UIhuUdU7v1m2BhHZzIE9vWHyhD1RAmF5B5ZJ4YpsGm+myGw5wLXr/vjxRSSe2RZPjbDpv4uhsDubnBQjFETiigk98jKGAa7NkcYAjs7luUePaGQQnKPrPVNYHdVPkNgW0tn7qaox4soJPeIKpljgo3hCYbClnrO3KOinyqhkNwjKn0M7MyfMBT+iivLPeq5UgrJPaL+OQ928csZAqW/msrWIaPfpJDcI2t9Y9glr2cIFH1rKMs95nMKyT2yfk6AXb0NDIHcWYoz9+g6iykk98haFgO7xBUMgcznnbkr0U3XUUjukbU8Fnamjy0MvpNlucNw7n4KyT2y1iTB4ZZ0Bl/+XDOczk6nkNwja1s72CmJ/yti0JVsbAenultKKST3iDo2RFF777nDwmCzZk00QWV4oYhCco+ogvejnDnen1Ya/N53XQSnnpkUkntEWf85H6ro6ekMuqJvjFAlbqaQ3CMr/9NYqOrOzbEyyKy7k6EyfGClkNwjynp8GJza/FnEYDvRBU73llBI7pFV+ldrON2XxmDLuR5O/bIpJPcIy3svHqpmvzPYiu+CU+sMCsk90o5NMsMh+isGm+URBaqkNArJPdJK918KB+O7DLaSsXCKTqWQ3CMu8244KHMYbEVD4GTcSSG5R9yhy+Bg+ozBlt8XToYNFJJ7xG1rBYfohQy2zLZwUlZRSO4R93sCHOJXMNh2JsJJWW6lkNwjba0ZDnXWMdgWGuFkWC25S+6R94sBDskbGWSWUShj2sjqQ3KX3Ov/wSDb1xRlYndRSO4Rt9KZe72g5z7XhDKNj7P6kNwl98TfGFwnL4dL71wKyT3i1hjhELXUyqD6PgZllHuLKCT3iPs9ylnklAIGU87VcDF+YqWQ3CNuRz2oOmy3MIg+i4NLgx0UknvkHekNlWHksRIGTWpfaAzKo5DcIy/vSQNUxtt2FzNISt4ww8U0x0ohuUeeZU1dOCkXbMwNUpc720Gj5d+sDiR3kXkzXFKeOVDMIMgfBQ3lgWJWB5K7sKypDxel++LsUgbs43ho1NvE6kFyF1kvmqGR8srxQHsv2XQWNJRheaweJHdhOXqzARrRD52wBJD64e+mDGoErZQfWF1I7qJk1wAFGlET00vpl4Lfp1/b0KzAjXJ7LqsNyV0U7RtugkbcB9n0mfX46indEw0KPDXbxGpEchclaS/UUeDSYYuFPsnb8f6/20QrqIDp1VJWJ5K7KMlc1FUTqzL2uJU6Fadvmj3yzAQFlei/n9WL5C6sBTvGJqCMecSSQ0Xeiy9K/WHqdW1jFVSu+U8WVjeSu7BkftUILtFnP7p4d26lqRZmHFwxbUiXeiZFQVUS3ypm9SO5C2v+uubQUKJaDXlj+fb9R45n5+YVFBWVlJK05GUdP7Dukwcva1fXqMCrmCmFrJYkd1G8qgXcKab45udePXLsoxMefeS+0Tdd1a9bh0Z1o9XQvYurvrVL7qL4l7NREUWx/fks5XULqy3JXRRtGmxEkJh6L7OyGpPchTX19aTgxH7G9GMUknv1Zs2dEYWAGS76aG++lUJyr+5SbzHAL67ne/MjBawJJHdRevQ2I3xniG3fUs3d8K8jrCEkd3H430b4QjHEnTFs5pKbFDicvZU1huQuDgwy6n5+iWp84dgPt+RZD440wqHpj6w5JHdh3XJlrAIbY4Mks1Jx54opofUV4+ZuOF5CkpmTTXBImFXCGkRyF4U/3xALO0OvN+dOGtK7Q5OUhNgos8lsjoqJS2rcrvdNT3++Zm+OhaqiL+vCIWpyPmsWyV3sfFTtXen4xcn8nIy048ePHTty9MiRtKPHMzJPFtJN0dq2cDAOzWBNI7mLI3cZ1d6TJ6eyatadVyuwU/rvZI0juYvS7QMMcEgYf8DCqmQ8YYRD502sgSR3Ufh7VzgosQ/uL2XlihclwqHFt6yRJHdRvKIRVDH3Hayi952d4JD0WQlrJsldZL4aC1XM2EOshPXg1XBImFFja5fchXX/KCNUxm4/ZlhYkROjFdhFP5fLGktyF5Yt3RSolJT+t97/xMtvfzR/4eJlK9es+6eAJI9+fU9LOEQ9WaNrl9xF8U8pcKdAMZqi4+vWa9CoYePGDRNNUJkfreG1S+4i61kzdDE+mMeaTXIXpfv+ZYAO5kdqfu2Suyje1EOBV8nvFrHmk9xF0S8t4WA0m4yKggp0+KGYQnI/FeQubIAqGfqsKqSQ3E8J1qyZdVCFmJG7Sikk91PF8VmnKaiQYojv9dERCsn91GHN+vb600wK3NhOM7W7esKioxYKyf2UUnxk9dyX7rn63A7NG9avl5zUoHGHnv966PVvDxVRSO6nsNKM339YsnTt4WIKyV0IyV0IyV0IyV0IyV3YSO5CSO5CSO5CSO5CSO5CSO5CSO5CSO5CSO5CSO5CSO5CgDWUWP9Iz/qIanbZMzsoJPdT28a+cFIGbKWobrkfX/Ts7QMuu2LUq7+WMjDC+pIJGtGvUFSn3DPfusQIp0bjDzAAwno3PNxtpaguuWc+mgg3sU8W02/iMZTzGEU1yX1RE5Rz/lH6ScyD6swBCpzmUlSH3AvvQEU6ptEvIrUe7JQnrXwKTnF/U0Q+92N9UbHeFvpBWPvD4X6SBY3g1MtCEencD7WHS5dnFy15Kh6qqfSD+AQOZxaR5DiUeZMiwrkf6YgyyR9bSfKXKDjEpdJnIq85HBbR5ieUSTlJEdHc87qjTNOtdHgIqrHUJ3XGTT3atOly998UZU/r59CuMBZlJlJENPehKJO4iarDMXBIyKYOhQ9FwSH6c9Z6aQlweJcOl6FM3UyKCOY+Cy7vssxwnxbPrkeZGPl9fwwOyfl0eB4uL1NELvc9iShzCV0WQXUDvdsMjRGs5XKS4HAXVT/CpVUpRcRyvwRlDH/QJd8MhzoWevU3NOpYWLvNgGoVVRnQWEIRqdy/gMsganWDajO9i4PGdtZq1tPh0MxKp9ZwuYUiQrnnt4DL79S6E6qP6R20vmetthKq+1hmEFwSCigik/urcOlNN29A9RS9yoHWl6zVRkO1lGWegcZCiojknt8ILp/SzWKobqNXxyX3MoWJcEgoZJl50BhFEZHcZ8AlpZBu/vZhaWY/tBaxNvsGqmvosgkaDUopIpB7aTu43Et3J6C6kl5tgdbPrM1GQDWNLgUGaPxBEYHcv4PGGrqzGuHQl15tgNavrMWKkqDaSI2W0HiJIgK5D4RLEys91IXDFfRqFbQ2sRZbClVyKTUuh8ZVFOHPPTMaLmPoqQEcBtKrRdDaw1rsgYqbvgcaCRaKsOc+q+r3y7pwGE2v5kNrP2uxTlBNptZL0PqLIuy594NLbH6luU+iVx9L7qr9cFpGrc+gNYci3LkfMMBlAD0V+3AA503JXTUHKkM2tVZD63aKcOf+MqrclnrEhz0Br0DrAGuvYVCdTjcHoNWNIty5XwCNdfS0FqpUejUVWidZe7WCajjdlBihEVtKEd7cT5rhklhCT3PhUE//eQbJ/RCcXqO75tDaRRHe3BdA4wqWc58Pi8T3Se4O/4XTSro7H1rfUIQ39zHQmMJyzoXDq/TuP5K7w/1wSqe7gdB6jiK8ubeAxmJ6Ombw4XTHLZK7x/tQU3oYI0szkcx9O7SO0dNsOLSjDjdAq4C1VWlipfvqnoJWP4qw5j4bGi0qL3gqdbgGWqy1dsDpEXqYCa3mFGHN/VZoDKSn7DjYJR73eU0T8qYKfEgPX0JLKaQIZ+5tq35TfR8Ok6lHL8nd7rHKt7SvhpsdFGHM/bCX43aXwK5zIfXoAg2FtdZ1UBkL6WEX3PxAEcbc50FrOz1YO8Om4S7q0gEadVlrtYOqIz2dQOQ2iUnuj0AjuoSeMiacriSOOOzLoqbknm+A6jp6shqg9SRFGHO/EBpdWJFC6pYCjaasrTbC6RGW0wBaoynCl7slARr/ZoDqQKMFa6tP4fQOy+kIrSsowpf7n9CayABBqz1rq8lwWuFt9aorRfhyfxda7zEwOdDqwtpqKJwOsZzroNWAIny5j4XWCgbmqJxdsDsPqgSWNxJuiijClnufoB4/+gdafVlbJUF1ttdN0jhMEa7cSxOgEV3KwPwlb2HuS+tDWN4kuPmDIly574BWBwZoFbQGsJbaUOW7/8vyWTVSuc+D1sVBGb4n4/q/gNMsljcLbj6jCFfuT0NrGAM0H1ojWUu9WOWFDp/DzUyKcOV+I7TGM0AfQOsu1lJ3welvr/8CMZUiXLl3gtZrDNAb0HqEtdSAKnez/wI34ynClHuRCVrzGaDnoPU0a6mzoWrECmyCmzEUYcp9K9ysCcqpBrkntz5UPVmB3XBzE0WYcv8KwZ3xcxe03mTtVFB1yofhpj9FmHJ/AW6yGKBh0PqEtdM/VT+Xn4Sb8yjClPtt0IphoK6D1lesnVbD6Q1WwAo3HSjClPsF0GrJQF0stwi7zRpYwIrEQKsZRZhybwatHgxUN2j9wtrpLTj9xookQ444RiL3IgO0rmKgOshNZG6fqg95P9ALI0V4ct8BNyMYqEY+30RWcHh3aiHDK3P37kyG0J1QGUtYkZZwU0gRltyXwM0DDFQ8tI6xajkf3twSAAxtRnxdzPD4Y2KvOgBQ58Ipexkig6Bqwgp1gQyOjUTu78DNMwyQBW5yWZXMCXXh0uoLhsGynnAx3HqMIdEHqh66cj9KEZbcJ8HN2wxQBtywKosaw93IYoZY5jC4a/gLQ6E9VDfomSyI/RRhyX0U3MxjgPZDqw6rMFWBpxssDKl/ToenuF8ZAnW8bAntK1MiI5J7f7j5kQHaBK3GrNwEVOBphtKuZiiv4XEGXSGcJrNCl0PfAlbWn8t+SWfA9q39YUsxKbl3gpsNDNBqaLVjpabDydj5dANU5i0MnbR2cKrfLQlOwxh0R+A0S88QfGxkhf64wghAOf9TKwNgmdkCABJH7pDck4O8Q2wxtM5iZX40QnXJXvKvhlBdx5CxXApV3LulLLoXKmUjg20bnL7WlfsqVmR5NFTDA+l9OFQJS2t77oVwl8YAfaxv7saRsr7PzyPJGVApOxmI1PceGHrbi3+xIk9CZVxCksVNymJisP0Cp3W6cv+ZFSg5HWW+pN++R5mmJbU89wNwVxTcw0xXshLXQhV/gDbpBqgeZwAWxVR+Gm6dEar7PcZJRecwyBbCaZ+u3Bd56RQ302+D4PIzg8O6d+2i+Ss2F9W03NfDTRwD9Sy0BnudfvCY5ztEJ1asdPuCWZ/t1blhp46FnkrOgirhhOdtMvMYZB94+146WEfuD8Pl3ABvRFPNZuBK1zzRPwl25i5DZ26vSbl/BzeNGahxevYknGwClekQHW6o+nkq+6EkAFCuOsAqWKKgSq9iNMDd5UZS38sgew2qJF23ceJzVuBquLSmv/ZB4/+xd+7xNpdZ/F97n8s5jsPJhUI4CCNOY6RM0qU0/Qq5dElF1CiXDBGhlEwTSiZTNEYNokEuaU4kF5LQxeUkXdwvJ4xcOIdzHOey916/1w/7u/azv+tZz7MP83v5zsz7/zGyP9/nWc9an7XWWLxQjo2sBSp1B232jNzfA4VfXUT7vJB1HgBhHsDz9OLWuhJ3w3mqrpd/Wl2XysEUCPOja5plCxQ4vvuXIApkz35jxOxczSbJBlIwR8w0VV6vQI5TXy2e+8mXe82pMjktum/lR/NWZJ1CM3nDywLD9TMD3pD7eFD4LcaOdEsPRY49ieotrt7cfxZbP+EywXX2mb6a+wd361Au/ZmoIzCqGgCktBihEUP2iHT4f5T7Cz8DsiXy3G2xrqa2XK9b/0xDH5ylSttpeWKqTPg9zky/Lw3O4m/c50uUWVsHNDSY7wm5j4CLPNKxNei2+BG/hzAVitwd3QMNVchWIdRAw7nKup7kSernpModclDDA85BEOBaTnvEQ5hVGEE3OE8HtKqq/tVoEnYlKVtCJKnDdIfzIum2LRhVGSLJWIgCUxNAT7tfPCD3/he7Jb4ZEJqTOjuRGTJGcn+UXw5ATEMdQ52QhzfkqrmSXHO5YZWY1Ph7eXBorNRm25v20LQA83SfWnqv3YG2EM2VqyW582+pD6tBNA+cRB1TfBCBv1nHdo0ggivWXfpyfxQUnsQLpS5EMsmQcZjNyL2DyZZ/+Wn5LGbKW0fLAGV+GLlvMTuK3nLF9OH42wcAKWp+/RbTWKkMUHhFkDvzgP+gArhJmGCW+/1KIN4VGH6lq72ujgMivv/ZId17+8WDQ/KiS17u7UBhIF4oFY1PsNNUvvfTkTgEwrRFjlv1dwbRVNeUNQoc+sci91r6ToDvwruXay7dteCLHFT4tWnOTn1Q6GuUezY6BAYDzx+Ncm+LxK4mwFKV93Hk1gAizQndvr4SHFI2XOpybwkKL+CF4odIMtHNDNZj0Ic9gYi5QFQrQh5nUn0PVAjVAaZV+ohR7keBuBcVFqeGLyMu7k83rf6pbTF542pe7kUPgUPFOx5oWQYcxqCbzzVy30xtZ75GHdo3BIcqO/hAkYhfiQ6HIiR0TfASl3sjUBiDF0gOKCyXz+leXNjQBTlKrjBPrzkAYV7ShuBwiN4QRr/5eiBuVL++xPNKGR4SV3cssAtmfJw1L4OVe3EH+istCSDiCXp/+T6S5u0rct/s/BWTn9l79phuDGEa5aKLokpA9FNyO/eAw6eXuNyrXeTJy3uNI/gO+cFhCjp0AirxszzDS48/yP6mfaimo8MmcDgudDZy5s7MBDiLfxKyOI+6lchzO6hU/8Ig95/CF5Wz4ixxYii6qAVpe2S53+xYoZ3Nrk3CZYjc5lLG4lP9YvWSrhQpXuJyTwaFaRfcB2r0cU8A4jsuVTHW4k/eaWhEXKImzy9nYxL6BZOEJB6X+V6ZJCQQlVfBBnQoOLhtw/IF0yeOGdqna4eqEIWv7ScBSe5bop/0KUvQ4UEavyfLvZXLCn1jLlWbygmOtJHCbujgk3Ceey5tuRfARV4jsQoUmILfLeCQUIwO9SDMLOS5xpTJwEGaz2EF/zqZBmEa2uSsg5QmCnfYjjZWd7cjhnbMGdG1Zc0UMFFrlSx3ZTmxPxOJg2WZOE+Qe+A252zPRWIMXTb5SFAlQVeEDvWlw+RSlvtRkK1KMfORyU982M8uXQ0mGfdyjQCisZxmilM7d54CYhbnZmtvI/cTTgYyfDT2Nq9jyxx9Z3kQ0cvoBrfcf0rl276o47husXQr3hjVSFZeORfOUJZltOR6uB2jCQ2iCYGXsNz3wUXu3ZsKCqdFk87DnBE5rsBmx9kuZGhIAbrCVUBs5l7Hw2W5q4/FUPiral6EGlZDqaghVF7Xnn0vOgnOlgFdXWGyrpuSDphVfk3w+jqlfHI5x7JgMXo9AQCaFV/act8CcldNzLxhGkTwEBAjlFemyaVWlALEm+im2Klxt1YtOkD4C9DhZggzB3k+gQi2RVkry++S7e6xcyMvd/plhjvZlG3aetjVIZPcTzlp0jaokpOsrao9DERNZNg55O6eOZd43v1LUNl84R4cefZhqCoQ/0CHdyHM46jjdoO55wfNNoxJQNRlp2P+LF8oSvScFf6oZsg+09hJXM7KncLMLc73/KLwZlolyL2W4kdNduVxHtR+NQOA8OehzKUq92UgZlJkCrcfN3hwqnOSJL7m/jWnoI4hQJQplCpRY7W71tpxE3FqoyR3dbZpYfgBeQfqCIxNhdhJ7fKjZCObhRhq5RyvriAxWJ31HJHcyfqZFacvKi6Iip6INyGCzz0q949AZR/aM7sKQN2RzAOeqO92VWlmZ1HtaYfdAtjPpTGkC7VTK5/iDsSuVnJfo1xfSTtQdu7ERtvMfLnBbyLiFClf3B3ClCvUD/7xl2DwesctcAqjyU3QlT9WQAQjPCr3f0Cpp1ll+riJ1u0Ngwh6AJEYYgYi1LMsYb2ELh7kpxTthAhGc1b/9+zlviOJwgl5cYdCfMM7Hn321Tcnz/14+fqNGzdu270YVP5k8jO9iCcqORWvEnQxCxyWCt3I/8K/QZjX+Gn//A+RFwdEY4/K/a+gsh9tyS7Lji+/2TCI4Nd8Q9oeq7pceSB+hy4cy1NCiXZl7wzmPPQfRg3fAEQVyO/Un4z0ealc0XXqpjN8jxExwNTg1wMHiz7T/eAwTNiLszHvciewyUU3z4NDthBarfem3F8D8yRa8cZOK3ZLTpgWnx8HxE3c2bQc9fwWiAohfWLman337GdMevJmu8TVosjWoPHSP6ofHNKHfyffG4JRqAtEcEd2svP9FCBDTc0hcxIi+XAk91UQi7TGpHHq7n9Pyv2l0so9y0epLP0ukPsFz5WSdu/rxJMB23mW2/QbMzvp59NRmHNYNdgIcqefvyRsUqx5BgVWOUXOd0JimET8zrTDsE53KXJWetuT1CMIIhnkGAXiDiDDIa0p+Zd4IPybPSn3YSDMp5bopllvnioPIpiu2ajdlHsgyXfR+/qX7HMYSQ2+7rXAUcdxO7lPi3hov2W50iFLfhXIgzWeUqJ/vyO1vcgxUpdf8ynJTnocmzyDraROoLs9KfcBoIKWZMfzjr8SkAcRDOM7+3LiyDQmMAdUE6rKcP4aPqmZSDxQOwuH2AYRjMczNcNhb56l8e4AatgMKjWEs0i6CIh5ujAkDVRka3JrbdFke5wa2nlQ7n0s5C7138XliR6cYeIWymnuPXW3osRXYkdEO/502wh8lamJhXEiW80FvQ3nGWy7Q/iMbTk7yTgi2WSh+16XJ7wMOKoUI8FfKYekjblXnvKg3H8v/KML5IYjwKaosgPkQQRN+FanPjRAVOIgRJBcons2JBRrr4RrKUj1hTtwQpYOuv4lYdemf5/l/N9yUpikwqhnDHCUyTOaW7sJW8+o8MzzZ3D4ClWyU9Sb23tyfwQU0mLNX/aTnqIUrvAnzTpXkqRBECWCiRDBj6hwTDGGEK/xgcD7cmcUk8Tr9gFQQVVkK1dmk715sNO4z9zksa0KfKqpNnAsRZ75ght8NETgW+M9ud9fOrk31wWAy+TVN6chkq2ue3g6ytQWBs2thDCd9Q++zq7xT42kLywEEdzzG3oly3xBni/hAlD5WjhUFGYZfxRooLPNE5WKUe5X5JKthUpDecMznpN7W5PcZTu3/xh3NhAzxa2Wh6PToY0CKKM4wIfrbuFXtP+JlFzLTxHMkEQcEClOiJKPMvOEk5hCD5WPtauIVeJz0TiYrLKuLYboalG6ftEwUfQ5z8n9zlLJvT+FDVFMAYVMFIwXUBzdcr8wpsuovS5Plqn/tV+MtpPdEEKJNAupCP2JvVFLIhjH5s0EFSU9KLlmfHw5VDqIuAv4KTa5TyR86zW5tyqN3AsraZOB4+VukffYpOBG61zuANAPxc3QVL+rqslE9cyPM/xilwPDXGsX9EjUUhVURgo2GGZWhNy7nsfbYAj/cdRRRhrntq+s8vAv+W+Q+xw6R4XZdtzb/hVWro/BWcrtRRNjIQLfKeVUiuev8hI/EI4ZbJffrnO+PhD2yw+eYN8u8p/cSyjoy8uzmEROrhCwUhaXJ110Cqjn2ViPyb2FUe6SUy/hFHPCSPb53lxSMDtRkaLETP1Uj7WaZvx/AUHhUk84S+MCq/UIKm3QREeLvOp1oNJe6qUi0gI2dr9c9udSC9o6MkS5BxTFlNnpLblnlELuh+P13qonZPv8vUows1FJhj4U85yDSXzX4HNC+bJ78Jy9Jv7cr/UdGrgN3ExAE9fTYiYtHUCluWQ0INpYmblzhWSz6ZXUSpB7uKPK4baQl+V+ZUybKWAUbzknjorDhCpmRXhXmp1GMzv0FgXqgZ3vHrVE9AghYtE5PfqoeVAWpcoPaKKORftALzDuTVknhO7y1VfCFkMJ/wnUcrNhPu4LEMk7XpZ7LbSgmeB6vksuFTYDhcprEVeknPvQ9se+J7AVP21gt9qFAiqPFeLpjoJ0pOYs2qMhU8ZisdtIUPEXC5VXYrVVZ5poFDG0Z9xlqJsWKovH0w7+h8uduk2rBk1PX34aNpH4SKe4c2rfjjJcpiSNralWYAewEk1615U2i/A7P2Rnugo1wVZBPX+DKPbId5m5Kfp9TUw6EFx0Rz038o4nYo3y+O/wHy73oXRQmv68JGGEs0K6eiLLUTGRzU1zbC2UJqXuP/nmJiba7xDOQD2Z5nP7IDN83SrIrG/6b3gT9dDh/Qby9IVI5ntI7o1jlnuQGjg+4rNYwsu3ErC0PVY608MiLgP6vJXcU6bHurrKvm9tuY23ZjNE4X5I5AoVLvEmus3kNFsnLy801BfylFOrZp535F4rZrmvEPPPlWUTdxowVHs7hLY8o3u3tdFV4/8MHHftQCveh2iSi+yXqnZDPacgitF6xw7xKuq5SROrvA0uTqKWH7U2HmIhRDLkP1nu3Zj8NpGkxihmufubv1WA9rwJfMdksKJuLOU4cFHpsW/QkmV8gUZmjJUQqoBKb6nASd+yltNJmjhtGqjICbiJ7FwUKaGcsM0zcq8dq9zzU6V++GJQyBA32WSsXTBvXe6FzMXJYN7PV4m2wgmL5y7cGkJrNkE0T8bwvh2PYp85u/RQjv12oZYF4DCPL4ILBxXX2Ss8tPcrPZqdvPpUrR/D7R5/BF0cB4Wm4mXS2Pzme7Z9z5lK8JAFDkofxzsU3Ypyn4cGgjO63P/yD9w4C1bCclF1jn2rAX2n0ss+KSD9vzrsNXgR+qGWA36rdtRREMlar8i9KXMci9wptkxmG9x7dZQ3jrGeleB6d53UmBS6aS320yGSKShz6Hp19dAZiGZZDN0Aq2JJ+iQGdINziIaoZW+87h/2C4jmL6hluPSYIM6kK8unQ560iJnlftAvLnreIstd/bqSQijyKte1VJW3saZrh7pmxuJpOpgevaylHIiDp+TiwPZYBrhBtuxoUgMeKTv4hBSQyVaek5eBwyYUmKsmIz0i91tFuUv9ZImchTQLFO6WNxIdRIk5Pq7N7EZ2Bz3dKuUDovGkH0oUtHB9p41ApQwaKfYL/aeCCj83O3Z6oY5didohAVtBgY4EuRu8dggFQjcpgVixB7uZzHIP1ZeraWtAoa1sqVmHAjvKsc+zx9jTbob+C/sJImmHEr3dBbQ7QaVRDCsiyqFEng9UJsu/juyfbwcO1UuECJPayDh2JFuX4Tb4IYK3vCH3TrHJ/TNw+ETO2/ETXAZKHTUKRc1J0vo0+uWugQpjxFqNrNZ/Ok76DeqoBukLFpxdDVGkJmvKFb2Mb9tERmNN1Sp/AHkCN4NDmSMo011JbRZ5Qu7dBLmL2YTaQe2EQeIRuUg53GKQDcRvFdr/4BApR3djlGdyOSwHKjHZnZdAXm8thbWtUeR3oNJeslPLiaWt5QC0k06LgZAzjMPVyeAyexQn8HQvThFrjiL/SmQHNBOzDHKfL/++xBIfVV+kuU2fRnV8pxYb0hs/oo6g87BI+lmZR68wOoZ9PY+iSD9j2qU/RLEIQ8v/2PWWjhMKkKC1kZpfJgFc1ZXjf3+m/S09V0ddET5wKJsd21HZ0hNy/5Nwuku5s/gDyDHDIPctlkWtI1c40tuPKjUY9b0t5Yo7iWMriDHsCb4UVKagkUGSo1Ao7ieUGKfmfREOBzOOIHHsWiDqFxr7y5vg8erngraRSiyXKPvq5bf2Di/I/Z1Y5F5AjpiHrMbF/x6jKIqHSE4gT6idPni4DyJ5MOpJN9aU334GNax3fuzk/fyUSHqyyHS2fL+thCi2GceIrXHuqtso/t7dGAjfcnO1KgO/YCYnvRsPRJMiNNNQcfN4Qe4LQaGO5XHky7Lau9eHdZcSS4xdl2UPaYe60czH/DLSTtZZYHPp5lE8MNg9NJ7YEEMt40MUOWAcUvqWW+5Pu1oUMysJUznZZGoGFoZj/XLh4C6/J0SQ+iPaWcGJW7wg929j8MwU1TSWO8aY5N5FPzGV+ClFGGX+NSgcUYw0l4eQYEc5JeSb8gwVTkha2YtG6siOQqK8sLCGfTjAknBlw+k83NkZIukYkPrL6YxwxH3V2ago9IHSeJOQiTzF+p8i6QwSHtmaXRkFJgOYquPPm+Q+EZTiM3IUNpW81EWqTTBT2XLQ1Ww9XIwcs5UUspCqPY5GEml9pcz1oNLZOGhmUUQ+J+659WsntYlTH/9FojOYDrVtzv+u3txNi4fXg0gS5yFD3ht3V4O6g/ehQ1B5FHzjAblHFcnjUE9huvkZPoSRu9DUEM/6rp+WBxjdAZEMRCy8TM7kdzC7s/fQD9c0IE6dLkEThyO23Mk8CoaX0yKm+r85AXT4hgaEWiJxBbk2OWqskZr64nvl8D/FZC/I/TqQH4/EOPPhjn1Mcg9ebjRvZPpko+qr0bv9MulrZc/eCcbXeBGds751YrIpBY1kkaoMjDGlZlZxo+7+opWp7hn9ILjHq5xuBho6HDG0o1Tfz3byPusFuXeTkwPEiYpyZZGrQQ7WDdgS2n120EGbtM3Ca7IPHzbMT/zZZ9qU3Af0O7vXxzqIZ7FUxJDbVbegygYgaPLUq35gSH0uz/SrKL6fIy2Ao/GnyFPMvDGUL6+zF+Q+FhRWWBSk4r63XaA7zDQZK60Ao8hvbKq6hqqr/vPjyfw4eeJaw19qKjhUch1tZxJjHMQzRa6iSQtYZ0ivbJrotKalu2V7bI5YS2QisqLRlSGKxHuWhlAHFTwSN3F9Urd7Qe6rQWESatgUpz8AiTuNci+uKv7AgfbgcE2RzTCMa+iI8WXr+9EEp9/KRHCYY/hYasVQueuNBoIpAGJR4JCun/XLXvTNJ2U8PnmbeUIrE7Kefvf/JFKW4rZhH+ciIYVEDfOdBiqimRfkrh5eMBB5AhTqlT8oN6TJcsdnhc5PJaxI3Gz3hVYB0/KA3LJSbmZLGojVs6dilHs/3aYec4awtbj9QR2Ns++TKeMnTp6zemcAGeR2XcquFG6aM3ns5CkLvzmGJmYD0Z0plGV4Qe7YEmyKBaPsvJ6NzHLPVjMLn2l7wv6KGkL1gOct2djLT7bcWQMcGuQafma4Go3cJ/kN5NRMJYwiXva7x1o6F4pxZorSXV6K5d6T+8s2YyXWxFGuXDpNapjljj3U4z3ERx3ShNTXgSXuEGrITtIe74evAoeUb41rZVqgkZZyzVhcvnRAaGUnz0SsfABRrEIZcwNT4lJamEiniAfk/q1FK+YRknGZ7SiQZiH3n5N1Wyve8EXo6jRqySkHHLfbzr5rQH/2rgi1+z409/M+jkbqKnkWkUVgcOSkCytV7VksuhXs6QhE0sLoo7KLB+Tumqvfg7vGWinLxQSSZblzKw/KhlVx6nEgav+CKlLx1my5PlZJHYsavlI+rmo0Aapn2LwY5qEeRRN7gKCtUsJapeuwNKyFKKZiqTheD4iEkbk5DZQUmTfkrnqAL3MXOgP3KSGGBNjIvejXao3v7L2YP6k6ENV2osSJSuCmQoH9ff7I2XpUVke7Msm4sIJ9jwTRxOkYdtSGyhp6pVqBSj20R5gkPA5jhV71hD9O7STwgNypZyPM6y61dwWHjHyUKJTkTmwtDwrX9nn0JsUJU/V7u72uCoNQogcolLu39z3qi7d/CLXkfvrqgJ49h767C83sld2l8gqPiobyf0W0RG5WHY6l5Js00HGrBxyRTEdklROocLoDOFTZhyK5otyJzDiQqL0VDQRugGgSZUNW0e0g8gJeJDbEEnh0hyh2o8LDoOILYSnIAeICF15nVQce31dekfv3fvVCVVIvu68Fh7SNKHPC9hSZnwh6Wh5EI9tcx8wTKHPyVtCT9M5FrNvJJmnZ0P4RypsIjmEpCPnsEzwmDrYElkHoFbnjY6DQlt5YBeNSwSFlFRooApXXUceyVNDg61eEFvzTBwqph9BAQXvQUecimlfXq34gme8Mw+Ofl1bJ21PBPsFjpGQEd1TdG/CO3A9XBoWKQ1flI+Kp1YOrAFF2FRqpZt3YuTUDWNJXoB0vMQP6ZYIvxwOHr8+pi99BYHfeBWvLq5del4bL21NXXnsWI9+77kn/4AB6R+44D1yUvTIFFCp/FXssukF61o66DFykvVKAloTeSwGiUwgt2MgF8LduwItKE6fRzoKx8un+rrudqTQ0c7czXRBL1IaRZusRvSR3HAAm6m+30lOcYjAJypH+i3VAodbLMYWmuzqHT+vEfrZfybJ26lWc0GElXmRmy0O4VM6ozbsp2dKgEmqljpHWoFIBL5RNf7gifEJ1+TyEHpN74H6QaZODVkzwxVST2fCn+xuc1V/cVe1HZ4UwRg5N7dv2jnuHzj2G9uTM6HtT5XM/VIsn5+bixWdiOYCGH6Idu+sBkboQVVZIsb0990EUQbxgQpunvDj0tanf0R/lHblj0UMgkDzeWolLr3as4bYnUeHR3UcD+P+XnJ9/zsN/F6ezdqM1eS9UDB/t3fe4bktQkV2W5qIDFXy9AuC/heDzPtBx11a0J7h8yF3X3dBm8IJCtOJ/FK947emeQ8YtyWfOfiBEg7bMYIhix3+r3Ill6cByy1L0KN7nOETxGJaGVyCKb/4ndzwz3i34Sn3Xo2fxPiGfMDZVRPZcfPpfLHciuPLp3ySQd+uul9aWoJfxPpVBpdWFONWJmf+T+3mKt30+b+7c+St/+L/s3c+Lr2MYx/HLbzqnbJ2zkTjEUqNkyAZLk5rJjvxomB02o1lMGguGklIskKSMjcxSU2NnNQtkhQ2hsaCZiYn0nW4baq57eXvKVV6vv+G9eXquPvdB4z93U2S3tBG70XlN7gVxZ2TnprkA3pA7BT0Q2RVtxH50npJ7QTweneM24M/oPCz3gliLzg+TnETeL/eCeCU6X7QRFyKbl3tBvDvNZsbtkd0s94L4eJrNjIXIrpF7QexF56024tHILpd7QexH5+U2Yj06v8m9HmaXRrbWRrwRne/lXhDnI1tuI7aj85ncC+K2yJam+QT4RO4FsRDZPW3Ej9H5UO4FsRLZrW3E7JLI3pR7QTwf2XXTfAK8JPeCeDuyq9uQucielXtB7ERnNskh8bLcC+Kr6Pw8yW7WktwL4o+LJhlFfTWye+VeEecj25vkP9Oc3Cvirsh224gvI7tR7lT0WGTbbcTvF0dyTu5U9GJk77Uh10ZyVu5U9FFkr7ch90Umdyr6Zprcnwm5U9/JmUg225B3IjuSOxXd0b/eNOTzyA7lTkVPR/JcGzI7E8lPcqeiD6Y57ro7ku/kTkW/nu1f1Jxg4/2yY7lT0kaccuGgjTm+Pk5Zb3KnpJP1q+JvV64ctlHfzsc/bthqcqeqo53NJx9cfGh165f2b3z9/uoji0tPvPDprMkd5A5yB7mD3EHuIHeQO3IHuYPcQe4gd5A7yB3kDnIHuYPckTvIHeQOcge5g9xB7iB3kDvIHeSO3EHuIHeQO8gd5A5yB7mD3EHuIHeIBnIHuYPcQe4gd5A7yB3kDnIHuYPckTvIHeQOcge5g9xB7iB3kDvIHeSO3EHuIHeQO8gd5A5yB7mD3EHuIHfkDnIHuYPcQe4gd5A7yB3kDnIHuSN3kDvIHeQOcge5g9xB7iB3kDvIHeSO3EHuIHeQO8gd5A5yB7mD3EHuIHfkDnIHuYPcQe4gd5A7yB3kDnIHuSN3kDvIHeQOcge5g9xB7iB3kDvIHbmD3EHuIHeQO8gd5A5yB7mD3EHuyP3/7q926VgAAAAAYJC/9Sx2FUPoDrqD7qA76A66g+6gO+gOuoPu6A66g+6gO+gOuoPuoDvoDrqD7ugOuoPuoDvoDrqD7qA76A66g+7oDrqD7qA76A66g+6gO+gOuoPu6A66g+6gO+gOuoPuoDvoDrqD7qA7uoPuoDvoDrqD7qA76A66g+6gO7qD7qA76A66g+6gO+gOuoPuoDu6g+6gO+gOuoPuoDus3UF30B10B91Bd9AddAfdQXfQHd1Bd9AddAfdQXfQHXQH3UF30B3dQXfQHXQH3UF30B10B91Bd9Ad3UF30B10B91Bd9AddAfdQXfQHd1Bd9AddAfdQXfQHXQH3UF30B10R3fQHXQH3UF30B10B91Bd9AddEd30B10B91Bd9AddAfdQXfQHXRHd9AddAfdQXfQHXQH3UF30B10R3fQHXQH3UF30B10B91Bd9AddEd30B10B91Bd9AddAfdQXfQHXQH3dEddAfdQXfQHXQH3UF30B10B93RHXQH3UF30B10B91Bd9AddAfd0R10B91Bd9AddAfdQXfQHXQH3dEddAfdQXfQHXQH3UF30B10B90hcCKiPodek2oAAAAASUVORK5CYII="
;var LoaderScene=cc.LoaderScene.extend({ctor:function(){this._super(),this.bgContainer=new cc.Node,this.bgContainer.setAnchorPoint2(),this.bgContainer.setContentSize(this.getContentSize()),this.bgContainer.setPositionRound(this.width/2,this.height/2),this.addChild(this.bgContainer,10),this.contentContainer=new cc.Node,this.contentContainer.setAnchorPoint2(),this.contentContainer.setContentSize(this.getContentSize()),this.contentContainer.setPositionRound(this.width/2,this.height/2),this.addChild(this.contentContainer,11),this.sceneName="loaderScene";var e=LoaderScene.getLoadingText();this.message=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.LOADING_TEXT||cleverapps.styles.FONTS.TEXT),this.message.setPosition(cc.visibleRect.center.x+cleverapps.styles.LoadingScene.bar.x+cleverapps.styles.LoadingScene.message.x,cleverapps.styles.LoadingScene.barBg.y+cleverapps.styles.LoadingScene.message.y),this.bgContainer.addChild(this.message),this.hints=[e]},rewrite:function(){
var e=this.message.getString();this.message.removeFromParent(),this.message=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.LOADING_TEXT||cleverapps.styles.FONTS.TEXT),this.message.setPosition(cc.visibleRect.center.x+cleverapps.styles.LoadingScene.bar.x+cleverapps.styles.LoadingScene.message.x,cleverapps.styles.LoadingScene.barBg.y+cleverapps.styles.LoadingScene.message.y),this.bgContainer.addChild(this.message),this.onChangeSize()},onLoadError:function(e,t){this.message.setString("Error loading! Retry number: "+t)},createAnimations:function(){this.animations=cleverapps.styles.LoadingScene.animations.map(this.createAnimation.bind(this)),this.updateAnimations()},createAnimation:function(e){var t=new cleverapps.Spine(e.json);e.onBg?this._logo.addChild(t):this.contentContainer.addChild(t);var i=e.name&&e.name.idle&&(e.name.idle[cleverapps.settings.language]||e.name.idle.en)||"idle",s=e.name&&e.name.start&&(e.name.start[cleverapps.settings.language]||e.name.start.en)||"start"
;return s&&i&&t.setAnimationAndIdleAfter(s,i),s?t.setAnimation(0,s,!1):t.setAnimation(0,i,!0),t.setLocalZOrder(e.zOrder),t.setScale(resolutionScale),t.style=e,t},beforeTransitionAnimations:function(e){this.bgContainer.runAction(new cc.ScaleTo(1,1/1.1)),this.contentContainer.runAction(new cc.ScaleTo(1.3,.7)),setTimeout(e,500)},finishAnimations:function(){this.animations.forEach(function(e){if(e.style.name&&e.style.name.finish){e.setCompleteListener(function(){});var t=e.style.name.finish[cleverapps.settings.language]||e.style.name.finish.en;e.setAnimation(0,t,!1)}})},onTransitionAnimationDidStart:function(){this.finishAnimations()},init:function(){var e=bundles.loading_scene_backgrounds.urls,t=e["background_"+cleverapps.settings.language]||e.background_en||e.background;cc.sys.isMobile&&(t=e["background_mobile_"+cleverapps.settings.language]||e.background_mobile_en||t),cc._loaderImage=t;var s=function(){};this.animations=[],bundles.loading_scene&&cleverapps.bundleLoader.loadBundle(
"loading_scene",{onSuccess:function(){this._logo?this.createAnimations():s=this.createAnimations.bind(this)}.bind(this)});var n=function(i){cc.loader.loadImg(cc._loaderImage,function(e,t){i<=1||!e?(this._initStage(t,cc.visibleRect.center),s()):n(i-1)}.bind(this))}.bind(this);n(3);var o=null,a=null,i=cleverapps.once(function(){var e=cleverapps.styles.LoadingScene,t=new cc.Sprite(o);e.barBg.scale9&&(t=new cc.Scale9Sprite(t.getSpriteFrame())).setContentSize(e.barBg.scale9.width,e.barBg.scale9.height);this._background=t,resolutionScale&&t.setScale(resolutionScale);var i=this._bar=new ScaledProgressBar(new cc.Sprite(a).getSpriteFrame());i.setDimension(e.bar.scale9.width,e.bar.scale9.height),i.setMinWidth(e.bar.scale9.minWidth),this.drawPercent=0,this.needPercent=0,this.percentInterval=setInterval(function(){if(this.drawPercent!==this.needPercent){var e=(this.needPercent-this.drawPercent)/20;.01<e?this.drawPercent+=e:this.drawPercent=this.needPercent,this._bar.setPercentage(this.drawPercent)
}}.bind(this),.2),i.x=e.bar.x/resolutionScale,e.bar.initialX&&(i.x=e.bar.initialX/resolutionScale,setTimeout(function(){i.x=e.bar.x/resolutionScale},400)),i.y=e.bar.y/resolutionScale,t.addChild(i),t.x=cc.visibleRect.center.x,t.y=e.barBg.y,this.bgContainer.addChild(t),this.progressBar=t}.bind(this)),r=function(){o&&a&&i()};return cc.loader.loadImg(document.getElementById("loadingA").src,function(e,t){o=t,r()}),cc.loader.loadImg(document.getElementById("loadingB").src,function(e,t){a=t,r()}),!0},_updateLogoPosAndScale:function(e){if(this._logo){this._logo.x=e.x,this._logo.y=e.y;var t=cc.director.getWinSize(),i=Math.max(1,t.height/this._logo.height,t.width/this._logo.width);this._logo.setScale(cc.contentScaleFactor()*i*1.1)}},updateAnimations:function(){var i=cc.visibleRect.center;this.animations.forEach(function(e){e.setPositionRound(e.style.pos||cc.p(i.x,i.y));var t=1;e.style.width&&(t=Math.min(this.width/e.style.width*.9,1)),e.setScale(t)}.bind(this))},_initStage:function(e,t){
cleverapps.styles.LoadingScene.pattern?this._logo=cleverapps.UI.createPatternSprite(e||null,cc.director.getWinSize()):this._logo=new cc.Sprite(e||null),this._updateLogoPosAndScale(t),this.bgContainer.addChild(this._logo,-1),LoaderScene.showCanvas()},onChangeSize:function(){var e=cc.visibleRect.center;this.setContentSize(cc.director.getWinSize()),this.contentContainer.setContentSize(this.getContentSize()),this.contentContainer.setPositionRound(this.width/2,this.height/2),this.bgContainer.setContentSize(this.getContentSize()),this.bgContainer.setPositionRound(this.width/2,this.height/2),this._updateLogoPosAndScale(e),this.updateAnimations(),this.progressBar&&(this.progressBar.x=e.x),this.message&&(this.message.x=e.x+cleverapps.styles.LoadingScene.bar.x+cleverapps.styles.LoadingScene.message.x)},onExit:function(){clearInterval(this.percentInterval),cc.Node.prototype.onExit.call(this),cc.eventManager.removeCustomListeners(cc.Director.EVENT_PROJECTION_CHANGED),
cleverapps.bundleLoader.deleteBundle("loading_scene")},_startLoading:function(){this.unschedule(this._startLoading);var e=this.resources,i=function(t){cc.loader.load(e,function(e,t,i){var s=i/t*100|0;s=Math.min(Math.round(s),100),this.needPercent=s,this.rewrite()}.bind(this),function(e){e?(t++,this.onLoadError&&this.onLoadError(e,t),t<10&&i(t)):(this.needPercent=100,this.cb&&this.cb.call(this.target))}.bind(this))}.bind(this);i(0)},_updateTransform:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._logo&&this._logo._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._bar&&this._bar._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._background&&this._background._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},closeAction:function(){}});LoaderScene.showCanvas=function(){document.getElementById("gameCanvas").style.left="0",document.getElementById("gameCanvas").style.top="0",void 0!==cleverapps&&cleverapps.canvasTop&&(
document.getElementById("Cocos2dGameContainer").style["margin-top"]=cleverapps.canvasTop),document.getElementById("cocosLoading")&&document.body.removeChild(document.getElementById("cocosLoading"))},LoaderScene.getLoadingText=function(){var e={en:"Loading",ru:"",ja:"",zh:"",es:"cargando",de:"Wird geladen",pt:"Carregando",it:"Caricamento in corso",ar:" ",ko:" ",tr:"Ykleniyor",nl:"bezig met laden",fr:"chargement"};return(e[cleverapps.settings.language]||e.en)+"..."},cleverapps.styles.LoadingScene={barBg:{y:80,scale9:{width:400,height:19}},bar:{x:0,y:0,scale9:{width:400,height:19,minWidth:30}},message:{x:0,y:30},animations:[]};var InstantLoaderScene={whenLoaded:function(e){InstantLoaderScene.loaded?e():InstantLoaderScene.loadedCallback=e},setLoaded:function(){InstantLoaderScene.loaded=!0,InstantLoaderScene.loadedCallback&&(InstantLoaderScene.loadedCallback(),delete InstantLoaderScene.loadedCallback)},preload:function(e,t){var i=function(){
cleverapps.whenAllInitialized(function(){setTimeout(function(){LoaderScene.showCanvas()},500)}),t()};cc.loader.load(e,function(e,t,i){var s=i/t*100|0;s=Math.min(s,100),"undefined"!=typeof FBInstant&&FBInstant.setLoadingProgress(s)},function(){InstantLoaderScene.setLoaded(),cleverapps.social.whenInitialized("loaderscene",i)})}},VictoryWindowBase=Window.extend({createAddbutton:function(e,t,i){var s=[];switch(e){case GameBase.REWARD_CLOVER:s=["x2@100","x2@200","x2@300","x3@300","+10[=]"];break;case GameBase.REWARD_PIGGY_BANK:break;case GameBase.REWARD_EXP:s=["x2@100","x2@200","x2@300","+1[=]"];break;case GameBase.REWARD_GOLD:s=["+50[=]"],cleverapps.flags.reduceAds&&(s=["+10[=]"]);break;case GameBase.REWARD_BOOSTER:s="match3"===cleverapps.config.type?["x3@200","x2@100"]:["x3@300","x3@400","x2@100","x2@150"]}var n=cleverapps.Random.choose(s.filter(function(e){return!(-1!==e.indexOf("[=]")&&!cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED))&&(-1===e.indexOf("x2"
)&&-1===e.indexOf("x3")||0!==t)}));if(n){var o=new RewardBuyButton({window:this,game:this.game,type:e,config:n,onRemove:i});return o&&(o.setPositionRound(cleverapps.styles.VictoryWindowBase.rewards.button),this.rewardBuyButtons.push(o)),o}},listChanges:function(){return[new VictoryChestChange({level:this.level,stars:this.starChestChange,oldChestStars:this.oldChestStars}),new LanternChange({level:this.level,lantern:Lantern.Get()}),new TournamentBookChange({game:this.game}),new RaffleChange({level:this.level})].filter(function(e){return e.isActive()})},runChanges:function(e){this.runAction(new cc.Sequence(new cc.DelayTime(cleverapps.styles.VictoryWindowBase.changes.delay),new cc.CallFunc(function(){e.forEach(function(e){e.createView(this).animateChange(e.calculateDelta())},this)}.bind(this))))},createRewardsBlock:function(){var l=cleverapps.styles.VictoryWindowBase.rewards;this.rewardViews={},this.rewardBuyButtons=[],this.game.collectedBoosterCell&&cleverapps.eventLogger.logEvent(
cleverapps.EVENTS.BOOSTER_CELL_RECEIVED),void 0!==this.game.rewards[GameBase.REWARD_CLOVER]&&(!this.game.gameMission||this.game.gameMission&&!this.game.gameMission.isRunning())&&delete this.game.rewards[GameBase.REWARD_CLOVER];var c=function(e,t){t&&t.showUp&&(e.visible=!1,e.runAction(new cc.Sequence(new cc.DelayTime(t.showUp.delay),new cc.CallFunc(function(){e.scale=0,e.visible=!0}),new cc.ScaleTo(t.showUp.duration,e.baseScale||e.baseScaleX,e.baseScale||e.baseScaleY).easing(t.easing||cc.easeBackOut()))))},e=Object.keys(this.game.rewards).filter(function(e){return e!==GameBase.REWARD_BACKGROUND_CLOVER});3<e.length&&(e=e.filter(function(e){return e!==GameBase.REWARD_PIGGY_BANK}));var t=e.map(function(e){var t,i,s=this.game.rewards[e],n=this.rewardViews[e]=this.getRewardBackground(e),o=n.button=this.createAddbutton(e,s,function(){l.twoLinePrize.icon&&t.setPositionRound(l.twoLinePrize.icon),l.twoLinePrize.amount&&i.setPositionRound(l.twoLinePrize.amount)});t=n.icon=this.getRewardIcon(e),
n.addChild(t),t.setPositionRound(l.icon),e===GameBase.REWARD_EXP&&l.Exp&&l.Exp.position&&t.setPositionRound(l.Exp.position.x,l.Exp.position.y),!o&&l.twoLinePrize.icon&&t.setPositionRound(l.twoLinePrize.icon),e===GameBase.REWARD_PIGGY_BANK&&l.Piggy&&t.setPositionRound(l.Piggy),t.show&&"function"==typeof t.show&&t.show(),n.baseScale=n.scale,c(n,l.bg),t.baseScaleX=t.scaleX,t.baseScaleY=t.scaleY,c(t,l.icon);var a,r=s;return e===GameBase.REWARD_PIGGY_BANK&&cleverapps.piggyBank.isFull()&&(r="messages:VictoryWindowBase.piggyBankFull"),i=n.amount=cleverapps.UI.generateTTFText(r,cleverapps.styles.FONTS.REWARDS_TEXT),n.addChild(i),i.setPositionRound(l.amount),!o&&l.twoLinePrize.amount&&i.setPositionRound(l.twoLinePrize.amount),i.baseScale=i.scale,c(i,l.amount),o&&(n.addChild(o),cleverapps.UI.onClick(n,o.createListener(function(){o.action()})),o.baseScale=o.scale,c(o,l.button)),l.container?((a=new cc.Node).setAnchorPoint2(),a.setContentSize2(l.container),n.setPositionRound(l.container),
a.addChild(n)):a=n,a}.bind(this));if(0!==t.length){this.existRewards=!0;var i=new cleverapps.Layout(t,{direction:cleverapps.UI.HORIZONTAL,margin:l.prizesMargin,padding:l.prizesPadding});if(i.setLocalZOrder(2),!1===l.title)return i;var s=[cleverapps.UI.generateTTFText("messages:VictoryWindowBase.rewards",cleverapps.styles.FONTS.VICTORY_REWARDS_TITLE_TEXT||cleverapps.styles.FONTS.WINDOW_SMALL_TEXT)];bundles.victorywindow.frames.level_victory_reward_line&&(s.unshift(new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_line)),s.push(new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_line)));var n=new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL,margin:l.margin});return new cleverapps.Layout([i,n],{direction:cleverapps.UI.VERTICAL,margin:l.margin,padding:l.padding})}if(l.noRewards){var o=cleverapps.UI.generateTTFText("messages:VictoryWindow.rewardsAhead",cleverapps.styles.FONTS.VICTORY_NO_REWARDS_TEXT||cleverapps.styles.FONTS.WINDOW_SMALL_TEXT)
;return o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.setDimensions(l.noRewards.width,0),o}},getRewardBackground:function(e){var t,i=cleverapps.styles.VictoryWindowBase.rewards;if(bundles.victorywindow.jsons.level_victory_reward_bg_json)return(t=new cleverapps.Spine(bundles.victorywindow.jsons.level_victory_reward_bg_json)).setAnchorPoint2(),t.setContentSize2(cleverapps.styles.VictoryWindowBase.rewards.bg),t.setVisible(!1),t;if(bundles.victorywindow.frames.level_victory_reward_bg)return i.bg.scale9?((t=new cc.Scale9Sprite(bundles.victorywindow.frames.level_victory_reward_bg)).setContentSize2(i.bg),t):new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_bg);switch(e){case GameBase.REWARD_CLOVER:return new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_bg1);case GameBase.REWARD_PIGGY_BANK:return new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_bg2);case GameBase.REWARD_EXP:return new cc.Sprite(
bundles.victorywindow.frames.level_victory_reward_bg3);case GameBase.REWARD_GOLD:return new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_bg1);case GameBase.REWARD_BOOSTER:return new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_bg2)}},getCloverVictoryAnimation:function(){var e=this.mission.getIcon(),t=new cc.Sprite(e);return t.setScale(cleverapps.styles.VictoryWindowBase.rewards.Clover.scale),t},getGoldVictoryAnimation:function(){var e=new cc.Sprite(bundles.menubar.frames.coin_png);return e.setScale(cleverapps.styles.VictoryWindowBase.rewards.Coin.scale),e},getRewardIcon:function(e){var t=cleverapps.styles.VictoryWindowBase.rewards;switch(e){case GameBase.REWARD_CLOVER:return this.getCloverVictoryAnimation();case GameBase.REWARD_PIGGY_BANK:return new PiggyBankVictoryAnimation;case GameBase.REWARD_EXP:var i=new cc.Sprite(bundles.menubar.frames.exp_png);return i.setScale(t.Exp.scale),i;case GameBase.REWARD_GOLD:return this.getGoldVictoryAnimation()
;case GameBase.REWARD_BOOSTER:var s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(t.Booster);var n=BoosterCellView.prototype.getImage(this.game.collectedBoosterCell);return s.addChild(n),n.setPosition(s.width/2,s.height/2),void 0!==t.Booster.scaleX?s.setScale(t.Booster.scaleX,t.Booster.scaleY):s.setScale(t.Booster.scale),t.Booster.animationName&&cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&n.setAnimation(0,t.Booster.animationName,!0),s}},addButtons:function(){var e=[],t=new VictoryWindowButton({level:this.level,oldStars:this.oldStars,oldStoryStage:this.oldStoryStage,boatswain:this.boatswain,onPressed:this.close.bind(this)});if(e.push(t),this.level.isRegular()||this.level.episode.isDailyCup()){var i=this.getShareBonus(),s={window:this,shareBonus:i,toReplace:{}};this.game.level.episode.isDailyCup()?s.toReplace.stars=this.game.getDailyCupStars():(s.score=void 0!==this.score?this.score:cleverapps.userresult.getScoresForLevel(this.level.episode.episodeNo,
this.level.levelNo),s.level=this.level);var n=ShareBonusButton.create(s);n&&e.push(n)}return e},getShareBonus:function(){return this.game.level.episode.isDailyCup()?cleverapps.ShareBonus.SHARES.dailyCup:cleverapps.ShareBonus.SHARES.victory},getShareOptions:function(){var e=this.getShareBonus(),t={levelNo:this.level.episodeNo*Episode.LEVELS_PER_EPISODE+this.level.levelNo+1};if(void 0!==this.score?t.score=this.score:t.score=cleverapps.userresult.getScoresForLevel(this.level.episode.episodeNo,this.level.levelNo),this.game.level.episode.isDailyCup()){var i=this.game.getDailyCupStars(),s=i;"match3"===cleverapps.config.type&&(s=Messages.get("Share.DailyCup.stars"+i)),t={stars:s}}return{shareId:e.id,toReplace:t}},animateReward:function(e,t){var i=this.rewardViews[e];if(i){var s=i.icon;i.amount.setString(this.game.rewards[e]);var n=i.amount.scale;i.amount.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.2*n),new cc.Sequence(new cc.ScaleTo(.2,n)))),cleverapps.UI.animateDelta(t,{x:i.amount.x,
y:i.amount.y+cleverapps.styles.VictoryWindowBase.rewards.button.animation.dy,parent:i,font:cleverapps.styles.FONTS.VICTORY_WINDOW_REWARD_DELTA});var o=this.convertToNodeSpace(s.getParent().convertToWorldSpace(s.getPosition()));e===GameBase.REWARD_CLOVER&&MissionAnimationView.show(this.game.getMissionType(),this,{amount:Math.min(t,15),beginPos:o,victory:!0})}},listBundles:function(e){var t=["victorywindow","starchest_window"],i=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_RAFFLE);return i&&i.isRunning()&&i.raffle.needVictoryShow(e.level)&&t.push("raffle_victory"),Lantern.IsActive(e.level)&&t.push("lantern"),e.game.rewards[GameBase.REWARD_PIGGY_BANK]&&t.push("piggybank_window"),t}});cleverapps.styles.VictoryWindowBase={rewards:{margin:30,prizesMargin:0,prizesPadding:{x:0,y:0},padding:{x:0,y:0},icon:{x:{align:"center"},y:{align:"center",dy:54}},amount:{x:{align:"center"},y:{align:"center",dy:-6}},button:{x:{align:"center"},y:{align:"bottom",dy:4},animation:{dy:-30}},
Exp:{scale:1},twoLinePrize:{},Coin:{scale:1},Booster:{width:100,height:100,scale:1},Clover:{scale:.9},bg:{scale9:!1}},changes:{delay:0},share:{margin:{x:20}}};var VictoryFriendView=cc.Node.extend({ctor:function(e,t){this._super(),this.setAnchorPoint(.5,.5),this.place=t;var i=new cleverapps.UI.Avatar(e);this.addChild(i),this.avatar=i,this.setContentSize(i.width*i.scale,i.height*i.scale),i.setPositionRound(this.width/2,i.height/2)},showAnimation:function(){var e=1*(.5+this.place/4);this.scale=0,this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(e+.25),new cc.ScaleTo(.25,1)))}}),VictoryWindow=VictoryWindowBase.extend({onWindowLoaded:function(e){this.game=e.game,this.boatswain=e.boatswain,this.rewarded=this.game.rewards[GameBase.REWARD_GOLD],this.game.gameMission&&(this.mission=this.game.gameMission),this.level=e.level;var t=cleverapps.styles.VictoryWindow;this.createContent(),this.addRewardBlock(),cleverapps.isRumble()&&!cleverapps.config.adminMode&&(
this.addRoundResults(),this.addRoundCountDown(),this.addRoundHeroComponent()),this.level.episode.isBonusRound()&&t.bonusRound&&this.addBonusRoundAnimation(),this.level.episode.isDailyCup()&&t.dailyCup&&this.addDailyCupAnimation();var i={};this.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER]&&(-1!==["solitaire","differences"].indexOf(cleverapps.config.type)||cleverapps.config.debugMode&&0<=["wordsoup","crocword"].indexOf(cleverapps.config.name)||0<=["scramble"].indexOf(cleverapps.config.name))&&(i.shovels=this.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER]),cleverapps.metha.getType()===Metha.SIMPLE&&this.level.isRegular()&&(i.stars=cleverapps.simple.amountLevelStars(this.level)),0<Object.keys(i).length&&this.addChild(new MedallionComponent(i)),this.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER]&&TreasureSearchRewardComponent.IsAvailable()&&new TreasureSearchRewardComponent(this.content);var s,n,o=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.VictoryWindow.window
,!0);cleverapps.isRumble()||(s=this.addButtons(),n=this.getShareOptions()),this._super({name:"victorywindow",content:this.content,noBackground:t.noBackground,buttons:s,shareCheckBox:n,title:this.getTextTitle(),styles:o,windowBg:e.windowBg,closeButton:!this.game.round,notCloseByTouchInShadow:this.game.round}),cleverapps.metha.getType()===Metha.FARM?this.addProvidedKey():cleverapps.isKnockoutGame()&&!this.level.episode.isDailyLevel()||this.addAnimatedTitle();var a=cleverapps.styles.VictoryWindow.rewardBlock.padding||0;this.rewardBlock&&this.rewardBlock.width*this.rewardBlock.scale+a>this.window.width&&this.rewardBlock.setScale(this.window.width/(this.rewardBlock.width+a)),this.addInviteBlock(),this.runChanges(this.listChanges()),cleverapps.metha.getType()===Metha.HOMEFIX&&this.level.isRegular()&&this.window.addChild(this.flyStarAnimation()),this.game.round?cleverapps.audio.playSound(bundles.game.urls.round_win_effect):(setTimeout(function(){cleverapps.audio.playSound(
bundles.game.urls.win_effect),cleverapps.audio.playSound(bundles.game.urls.win_effect_2)},t.soundDelay?t.soundDelay:0),bundles.game.urls.victory_looped_effect&&this.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){this.runAction(new cc.RepeatForever(new cc.Sequence(new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.victory_looped_effect)}),new cc.DelayTime(4))))}.bind(this)))))},getTextTitle:function(){var e=cleverapps.styles.VictoryWindow;return e.title&&!e.title.onScene?void 0:"messages:VictoryWindow.title"},createContent:function(){var e=cleverapps.styles.VictoryWindow,t=cc.size(e.width,e.height);this.level.episode.isDailyCup()&&e.dailyCup&&(t=e.dailyCup),this.content=new cc.Node,this.content.setAnchorPoint2(),this.content.setContentSize(t)},flyStarAnimation:function(){var e=cleverapps.styles.VictoryWindow.flyStar,t=new cc.Node;t.setAnchorPoint2(),t.setPositionRound(e.position),t.setContentSize2(e);var i=new cleverapps.Spine(
bundles.victorywindow.jsons.victory_star);if(i.setAnimation(0,"animation",!1),i.addAnimation(0,"idle",!0),i.setPosition(t.width/2,t.height/2),t.addChild(i),t.setLocalZOrder(10),this.level.isHard()&&e.text){var s=cleverapps.UI.generateTTFText("x3",cleverapps.styles.FONTS.VICTORY_STAR_AMOUNT_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT);t.addChild(s),s.setPositionRound(e.text),s.setScale(0),s.runAction(new cc.Sequence(new cc.DelayTime(2.4),new cc.ScaleTo(.4,1).easing(new cc.easeBackOut)))}return t},addRoundResults:function(){var e=new RoundResultsComponent(this.game);e.setPositionRound(cleverapps.styles.VictoryWindow.roundResultsComponent),this.content.addChild(e)},addRoundCountDown:function(){this.roundCountdown=new RoundCountdownComponent(function(){this.roundHero.hide()}.bind(this)),this.roundCountdown.setPositionRound(cleverapps.styles.VictoryWindow.roundCountdownComponent),this.content.addChild(this.roundCountdown)},addRoundHeroComponent:function(){
this.roundHero=new RoundHeroComponent({window:this,round:this.game.round})},addBonusRoundAnimation:function(){var e=cleverapps.styles.VictoryWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.bonusRound),this.content.addChild(t),t.setPositionRound(e.bonusRound);var i=new cleverapps.Spine(bundles.main.jsons.hero_json);t.addChild(i),i.setAnimation(0,"bonus",!0),i.setPositionRound(t.width/2,t.height/2)},addDailyCupAnimation:function(){var e=cleverapps.styles.VictoryWindow,t=new cc.Sprite(bundles.sidebar.frames.daily_cup_icon);this.content.addChild(t),t.setPositionRound(e.dailyCup)},addProvidedKey:function(){if(cleverapps.farm&&cleverapps.farm.providedKey){var e=ProvidesComponent({key:cleverapps.farm.providedKey,victory:!0,noLabel:cleverapps.styles.VictoryWindow.providesComponent.noLabel});e.setPositionRound(cleverapps.styles.VictoryWindow.providesComponent),this.content.addChild(e)}},addAnimatedTitle:function(){var e=cleverapps.styles.VictoryWindow.title;if(e){
var t=new cleverapps.Spine(e.spine_json);if(t.open_animation=e.open_animation,t.setAnimation(0,t.open_animation,!1),e.scale&&t.setScale(e.scale),e.idle_animation&&t.setCompleteListener(function(){t.setAnimation(0,e.idle_animation,!0)}),e.skin){var i=e.skin,s=cleverapps.config.results?this.level.stars:void 0;"object"==typeof i&&void 0!==s&&(i=i[s]),t.setSkin(i)}if(e.onScene?(t.setPosition(cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?e.x+e.horisontalOffset:e.x,cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?e.y+e.verticalOffset:e.y),this.addChild(t)):(t.setPosition(this.content.width/2,e.y),this.content.addChild(t)),this.banner=t,e.text){var n=this.titleText=cleverapps.UI.generateTTFText(e.text.message,e.text.font);n.setPositionRound(0,e.text.y),t.addChild(n)}return t}},addRewardBlock:function(){var e=cleverapps.styles.VictoryWindow;this.rewardBlock=this.createRewardsBlock(),this.rewardBlock&&(this.content.addChild(this.rewardBlock),
e.rewardBlock.scale&&this.rewardBlock.setScale(e.rewardBlock.scale),this.rewardBlock.setPositionRound(this.content.width/2,e.rewardBlock.y))},onShow:function(){this.buttons&&this.buttons.onShow(),this.placeText&&(this.placeText.scale=0,this.placeText.stopAllActions(),this.placeText.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.ScaleTo(.3,1).easing(cc.easeBackOut()))),this.rewardBlock&&(this.rewardBlock.opacity=0,this.rewardBlock.stopAllActions(),this.rewardBlock.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.FadeIn(.2))))),this.banner&&this.banner.setAnimation(0,this.banner.open_animation,!1),this.roundCountdown&&this.roundCountdown.resumeCountdown()},addReward:function(e){if(this.rewardViews[GameBase.REWARD_GOLD]){var t=this.rewardViews[GameBase.REWARD_GOLD].amount,i=parseInt(t.getString())+e,s=cleverapps.styles.VictoryWindow.rewardBlock.text.format.replace("%{amount}",i);t.setString(s);var n=this.rewardViews[GameBase.REWARD_GOLD].scale
;return this.rewardViews[GameBase.REWARD_GOLD].runAction(new cc.Sequence(new cc.ScaleTo(.2,1.2*n),new cc.Sequence(new cc.ScaleTo(.2,n)))),!0}},addInviteBlock:function(){InviteComponent({parent:this})}});cleverapps.styles.VictoryWindow={width:400,height:200,noBackground:!1,providesComponent:{noLabel:!1,x:{align:"center"},y:{align:"top",dy:0}},title:{y:520,spine_json:bundles.victorywindow.jsons.victory_json,open_animation:"victory",idle_animation:"idle",skin:!1},rewardBlock:{y:400,x:0,margin:0,text:{y:8,format:"+%{amount}"},coin:{scale:1}},share:{margin:10},window:{decors:{}}};var LoseWindow=Window.extend({onWindowLoaded:function(e,t){this.replayCallback=e||function(){},this.level=t.level;var i=cleverapps.styles.LoseWindow,s=this.createContent(),n=i.button.tryAgain,o=cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.Window,!0),cleverapps.styles.LoseWindow),a=cleverapps.once(function(){this.replayCallback(),this.close()}.bind(this));this._super({name:"losewindow",content:s,
title:i.title,noBackground:i.noBackground,styles:o,button:{text:n?Messages.get("TryAgain"):Messages.get("OK"),width:i.button.width,height:i.button.height,onPressed:function(){if(n&&cleverapps.lives.isEmpty()){var e=new ShopWindow({tab:ShopWindow.TABS.LIVES});cleverapps.lives.onChangeAmountListeners["losewindow.TryAgain"]=e.createListener(a)}else a()}.bind(this)}}),cleverapps.lives.onChangeAmountListeners.losewindow=this.createListener(this.updateWindow.bind(this)),cleverapps.audio.playSound(res.window_effect);new HardLevelDecorationComponent({parent:this});this.runAction(new cc.Sequence(new cc.DelayTime(.45),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.lose_window_effect)})))},createAnimationNode:function(){var e=cleverapps.styles.LoseWindow,t=new cc.Node;t.setAnchorPoint2();var i=this.animation=cleverapps.UI.createAnimation(this.getAnimationStyles());return t.setContentSize2(e.animation.width,e.animation.height),i.setPositionRound(t.width/2+e.animation.x,
t.height/2+e.animation.y),t.addChild(i),t},getAnimationStyles:function(){return cleverapps.styles.LoseWindow.animation},createLivesLeftBlock:function(){var e,t=cleverapps.styles.LoseWindow,i=[],s=cleverapps.styles.FONTS.LOSE_WINDOW_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT;if(cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES))e=cleverapps.UI.generateTTFText("messages:LoseWindow.livesLeftUnlimited",s);else{e=cleverapps.UI.generateTTFText("messages:LoseWindow.livesLeft",s);for(var n=[],o=0;o<cleverapps.Lives.MAX_REGEN_AMOUNT;o++)if(o===cleverapps.lives.amount){var a=new cc.Sprite(t.lives.icon).getContentSize(),r=new cc.Node;r.setAnchorPoint2(),r.setContentSize2(a);var l=cleverapps.UI.createAnimation(t.lives.animation);r.addChild(l),l.setPositionRound(r.width/2,r.height/2),n.push(r)}else{var c=o<cleverapps.lives.amount?t.lives.icon:t.lives.icon_empty,p=new cc.Sprite(c);n.push(p)}var d=this.heartsNode=new cleverapps.Layout(n,{direction:cleverapps.UI.HORIZONTAL,
margin:t.heartsMargin});i.push(d)}return e.setAnchorPoint2(),i.push(e),new cleverapps.Layout(i,{direction:cleverapps.UI.VERTICAL,margin:t.lifesLeftMargin})},createContent:function(){var e=cleverapps.styles.LoseWindow,t=[],i=this.createAnimationNode();return t.push(i),this.livesLeftBlock=this.createLivesLeftBlock(),this.livesLeftBlock&&t.push(this.livesLeftBlock),new cleverapps.Layout(t.reverse(),{direction:cleverapps.UI.VERTICAL,margin:e.content.margin,y:e.content.y,padding:{x:e.content.padding.x,y:e.content.padding.y}})},updateWindow:function(){if(this.heartsNode){for(var e=[],t=cleverapps.styles.LoseWindow,i=0;i<cleverapps.Lives.MAX_REGEN_AMOUNT;i++){var s=i<cleverapps.lives.amount?t.lives.icon:t.lives.icon_empty,n=new cc.Sprite(s);e.push(n)}var o=new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL,margin:t.heartsMargin});this.livesLeftBlock.addChild(o),o.setPositionRound(this.heartsNode.getPosition()),this.heartsNode.removeFromParent(),this.heartsNode=o}}})
;LoseWindow.prototype.listBundles=function(){return["lose_window"]},cleverapps.styles.LoseWindow={width:650,height:550,title:"messages:LoseWindow.title",heartsMargin:5,lifesLeftMargin:15,content:{margin:40,y:25,padding:{x:0,y:10}},animation:{width:650,height:320,x:0,y:0,spine:{json:bundles.lose_window.jsons.lose_json,openAnimation:"open",idleAnimation:"idle"}},lives:{animation:{spine:{json:bundles.main.jsons.level_failed_small_hearts_json,openAnimation:"animation"}},icon:bundles.main.frames.level_failed_heart_png,icon_empty:bundles.main.frames.level_failed_heart_empty_png},button:{width:300,height:100,offset:{x:170},tryAgain:!0},adsButton:{width:350,icon:{scale:.8,x:30,y:40},text:{x:185,y:40}},decors:{}};var LevelStartWindow=Window.extend({onWindowLoaded:function(e){this.level=e.level,this.stars=this.level.stars,BoostersBefore.isAvailable()&&(this.boostersBefore=new BoostersBefore(e)),this.isHardLevel=this.level.isHard()&&!this.level.episode.isDailyLevel()
;var t=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.LevelStartWindow,!0);e.styles&&(t=cleverapps.overrideStyles(t,e.styles)),this.isHardLevel&&(t=cleverapps.overrideStyles(t,cleverapps.styles.HardLevelStartWindow));var i=new cleverapps.Layout(this.listContent(),{direction:cleverapps.UI.VERTICAL,margin:t.margin}),s=cleverapps.UI.wrapWithPadding(i,{x:0,y:t.padding});e.replay&&(this.onClose=function(){cleverapps.metha.distract({focus:"LevelReplayFromLevelStartWindow",action:function(e){this.level.play(e,{boostersBefore:this.boostersBefore})}.bind(this)})}.bind(this)),this._super({title:this.getTitle(),name:"levelstartwindow",content:s,button:this.getButton(),styles:t,level:this.level}),"board"!==cleverapps.config.type&&"tripeaks"!==cleverapps.config.name&&HighScoresComponent({parent:this,level:this.level}),new HardLevelDecorationComponent({parent:this}),cleverapps.audio.playSound(res.window_effect),this.boostersBefore&&this.boostersBefore.showTutorialStep()},
getTitle:function(){var e=cleverapps.styles.FONTS.LEVEL_WINDOW_TITLE;return!this.level.episode.isDailyCup()&&this.isHardLevel&&cleverapps.styles.FONTS.HARD_LEVEL_TITLE&&(e=cleverapps.styles.FONTS.HARD_LEVEL_TITLE),this.isHardLevel&&cleverapps.styles.FONTS.BOOSTER_BEFORE_HARD_LEVEL_TITLE&&(e=cleverapps.styles.FONTS.BOOSTER_BEFORE_HARD_LEVEL_TITLE),{text:this.getTitleText(),font:e,toReplace:{levelNo:this.level.isRegular()?this.level.getHumanReadableNumber():""}}},getTitleText:function(){return this.level.episode.isDailyCup()?"messages:DailyCup.title":this.isHardLevel?"messages:message.hardLevel":this.level.episode.isDailyLevel()?"messages:DailyLevelWindow.title":cleverapps.user.isPassedAll()&&-1!==["scramble","wordsoup","wordheaps"].indexOf(cleverapps.config.name)?"messages:LevelStartWindow.ComingSoonTitle":cleverapps.user.isPassedAll()&&-1!==["tripeaks","spades"].indexOf(cleverapps.config.name)&&cleverapps.metha.getType(
)===Metha.SIMPLE?"messages:message.regularLevel":"messages:LevelStartWindow.title"},getButton:function(){var e=bundles.buttons_main.frames.play_button_png,t=bundles.buttons_main.frames.play_button_on_png;return this.isHardLevel&&(e=bundles.buttons_main.frames.play_button_hard_png,t=bundles.buttons_main.frames.play_button_hard_on_png),{width:cleverapps.styles.LevelStartWindow.Button.width,height:cleverapps.styles.LevelStartWindow.Button.height,button_png:e,button_on_png:t,text:Messages.get("Play").toUpperCase(),font:cleverapps.styles.FONTS.LEVEL_START_PLAY_BUTTON_TEXT,hasPrice:void 0!==cleverapps.bet,onPressed:function(){cleverapps.lives&&cleverapps.lives.isEmpty()?new ShopWindow({tab:ShopWindow.TABS.LIVES}):cleverapps.bet&&!cleverapps.bet.isEnough()?new ShopWindow({tab:ShopWindow.TABS.COINS}):cleverapps.metha.distract({focus:"LevelStartFromLevelStartWindow",action:function(e){this.onClose=function(){},this.close(),this.level.play(e,{boostersBefore:this.boostersBefore})}.bind(this)})
}.bind(this)}},listContent:function(){var e=[];if(this.boostersBefore){var t=new BoostersBeforeComponent(this.boostersBefore);e.push(t)}if(cleverapps.styles.ScoreComponent.enabled&&this.level.isRegular()){var i=ScoreComponent({level:this.level,victory:!1});i&&e.push(i)}if(this.showStarsComponent()){var s=StarsComponent({level:this.level,stars:this.stars,victory:!1});e.push(s)}return e},showStarsComponent:function(){return cleverapps.config.results&&this.level.isRegular()}});LevelStartWindow.isAvailable=function(e,t){return("board"!==cleverapps.config.type||"stacks"===cleverapps.config.subtype)&&"differences"!==cleverapps.config.name&&((0!==e||0!==t)&&("stacks"===cleverapps.config.subtype?!cleverapps.GameStorage.load(WordGame.getStoreKey(e,t))&&BoostersBefore.isAvailable():"solitaire"!==cleverapps.config.type||BoostersBefore.isAvailable()))},LevelStartWindow.prototype.listBundles=function(e){var t=[];return BoostersBefore.isAvailable()&&0<Lantern.GetStreak(e.level)&&t.push("lantern"),
"adventure"===cleverapps.config.name&&t.push("booster_before_digits"),t},cleverapps.styles.LevelStartWindow={padding:50,Button:{width:300,height:100},margin:0,BottomButton:{price:{x:{align:"center"},y:{align:"center",dy:-100},height:80,offset:50}}},cleverapps.styles.HardLevelStartWindow={};var ProductPriceView=cc.Node.extend({ctor:function(e,t){this._super(),this.setAnchorPoint2(),this.options=t||{},this.product=e,this.createContent(),this.setCascadeOpacityEnabled(!0)},createContent:function(){var e,t=cleverapps.styles.ProductPriceView,i=this.getTextMsg(),s=-1;if("string"==typeof i&&(s=i.indexOf(" OK")),-1!==s){var n=new cc.Sprite(this.options.iconOK||t.icon.image);n.setScale(t.icon.scale*(this.options.iconScale||1));var o=this.text=this.createText(i.substr(0,s));if(e=new cleverapps.Layout([o,n],{direction:cleverapps.UI.HORIZONTAL,margin:t.icon.margin}),n.y=e.height/2+(this.options.small?t.icon.small.offsetY:t.icon.offsetY)+(this.options.offsetY||0),cleverapps.UI.wrap(e),
this.options.fitTo){var a,r;this.options.fitTo.width&&(a=this.options.fitTo.width/e.width),this.options.fitTo.height&&(r=this.options.fitTo.height/e.height);var l=Math.min(a||1,r||1);l<1&&e.setScale(l)}}else e=this.text=this.createText(i),this.options.fitTo&&this.text.fitTo(this.options.fitTo.width,this.options.fitTo.height);this.content=e,this.addChild(e),this.setContentSize2(e.getContentSize()),e.setPositionRound(this.width/2,this.height/2),this.options.alignment&&this.setPositionRound(this.options.alignment),this.options.bg&&(this.bg=new cc.Scale9Sprite(this.options.bg.image),this.addChild(this.bg),this.bg.setLocalZOrder(-1),this.bg.setContentSize2(this.width+2*this.options.bg.padding.x,this.height+2*this.options.bg.padding.y),this.bg.setPositionRound(this.options.bg))},getTextMsg:function(){return this.options.text||this.product.getCurrentPrice()},createText:function(e){return cleverapps.UI.generateTTFText(e,this.options.font)},setString:function(e){this.content&&(
this.content.removeFromParent(!0),delete this.content),this.product=e,this.createContent()}});cleverapps.styles.ProductPriceView={icon:{image:res.ok_icon_png,margin:14,scale:.8,offsetY:5,small:{offsetY:0}}};var ShopUserGoldView=cc.Node.extend({ctor:function(e){this._super(),this.settings=e||{},this.setLocalZOrder(22),this.setAnchorPoint2(),cc.director.getRunningScene().scene.addChild(this)},updateContent:function(){this.content&&this.content.removeFromParent(),this.createContent();var e=cleverapps.UI.getSceneSize(),t=cleverapps.styles.ShopUserGoldView.position[cleverapps.wideMode.mode].y;for(this.setPosition(e.width/2,this.height/2+t);this.width*this.scale>=e.width;)this.setScale(.95*this.getScale())},createContent:function(){var e=cleverapps.styles.ShopUserGoldView,t=[this.createBoostersBlock(),this.createGoldBlock()];e.direction===cleverapps.UI.HORIZONTAL&&t.reverse();var i=this.textNode=new cleverapps.Layout(t.filter(function(e){return void 0!==e}),{direction:e.direction,
margin:e.textNode.margin});i.setCascadeOpacityEnabled(!0);var s=[this.createPerson(),i];this.settings.mirrorPerson&&s.reverse(),this.content=new cleverapps.Layout(s.filter(function(e){return void 0!==e}),{direction:cleverapps.UI.HORIZONTAL,margin:e.margin}),this.createBg(),this.setContentSize(this.content.getContentSize()),this.addChild(this.content),this.content.setPosition(this.width/2,this.height/2)},createGoldBlock:function(){var e=cleverapps.styles.ShopUserGoldView,t=cleverapps.UI.generateTTFText("messages:YouHaveAmount",cleverapps.styles.FONTS.SHOP_USER_GOLD_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT),i=this.createItem(levels.user.gold,e.items.gold.res,e.items.gold),s=new cleverapps.Layout([t,i],{direction:cleverapps.UI.HORIZONTAL,margin:e.textNode.goldItemsMargin});return s.setCascadeOpacityEnabled(!0),s},createBoostersBlock:function(){var i=cleverapps.styles.ShopUserGoldView,s=[];[0,1,2].forEach(function(e){if(levels.user.checkAvailable(BaseBooster.AVAILABLE[e])){
var t=this.createItem(cleverapps.boostersCounter.data[e],i.items.boosters.res[e],i.items.boosters);s.push(t)}}.bind(this));var e=new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL,margin:i.textNode.boostersItemsMargin});return e.setCascadeOpacityEnabled(!0),e},createItem:function(e,t,i){var s=cleverapps.styles.ShopUserGoldView,n=cleverapps.UI.generateTTFText(cleverapps.formatAmount(e),cleverapps.styles.FONTS.SHOP_USER_GOLD_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT),o=new cc.Sprite(t);o.setScale(i.scale),o.y+=i.dy||0;var a=new cleverapps.Layout([n,o],{direction:cleverapps.UI.HORIZONTAL,margin:s.items.margin});return a.setCascadeOpacityEnabled(!0),a},createPerson:function(){var e=cleverapps.styles.ShopUserGoldView.person;if(!e.visibility||!1!==e.visibility[cleverapps.wideMode.mode]){if(e.image)var t=this.person=new cc.Sprite(res[e.image.res||e.image]);else{(t=this.person=new cc.Node).setAnchorPoint2(),t.setContentSize(e);var i=new cleverapps.Spine(e.json);i.setAnimation(0,
"animation",!0),i.setPosition(t.width/2,t.height/2),t.addChild(i)}return t.setScale(e.scale||1),t.y+=e.dy,t.setScaleX(this.settings.mirrorPerson?-t.scaleX:t.scaleX),t}},createBg:function(){var e=cleverapps.styles.ShopUserGoldView.bg;if(e)if(this.bg)this.bg.setContentSize(this.textNode.width+e.padding.x,this.textNode.height+e.padding.y),this.bg.setPositionRound(this.textNode.x+e.dx,this.textNode.y);else{var t=this.bg=cleverapps.UI.createScale9Sprite(e.image);t.setContentSize(this.textNode.width+e.padding.x,e.fixedHeight||this.textNode.height+e.padding.y),this.addChild(t,-1),t.setPositionRound(this.textNode.x+e.dx,this.textNode.y)}},showUp:function(){this.updateContent(),this.setVisible(!0),this.runShowUpAnimation()},runShowUpAnimation:function(){if(this.bg&&this.bg.setOpacity(0),this.textNode.setOpacity(0),this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){this.bg&&this.bg.runAction(new cc.FadeIn(.6)),this.textNode.runAction(new cc.FadeIn(.6))},this))),
this.person){var e=this.person.getPosition();this.person.y=1.2*-this.person.height,this.person.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.MoveTo(.5,e).easing(cc.easeBackOut())))}},onHide:function(){this.setVisible(!1)},close:function(){this.person&&this.person.runAction(new cc.ScaleTo(.2,0).easing(cc.easeBackIn())),this.bg&&this.bg.runAction(new cc.FadeOut(.4)),this.textNode.runAction(new cc.FadeOut(.4)),this.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.RemoveSelf))}});cleverapps.styles.ShopUserGoldView={margin:60,position:[{y:-20},{y:40},{y:40}],direction:cleverapps.UI.VERTICAL,textNode:{margin:10,goldItemsMargin:10,boostersItemsMargin:15},bg:{image:bundles.shop_user_gold_view.frames.shopusergold_bg_png,dx:-20,padding:{x:60,y:25}},person:{json:bundles.shop_user_gold_view.jsons.yellow_money_spine_json,scale:.85,width:250,height:250,dy:-10},items:{margin:5,gold:{res:bundles.reward_icons.frames.gold_small_png,scale:.75,dy:5},boosters:{res:[
bundles.reward_icons.frames.cellbooster_small,bundles.reward_icons.frames.linebooster_small,bundles.reward_icons.frames.colorbooster_small],scale:1,dy:5}}};var ShopWindow=Window.extend({ctor:function(e){if(this.options=e=e||{},this.tab=e.tab,this.tab===ShopWindow.TABS.COINS&&cleverapps.flags.nopayments)return!1;cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TILE_SHOP_OPEN+this.tab),this._super.apply(this,arguments)},customize:function(){if(this._super(),"match3"!==cleverapps.config.type||this.showAll&&this.isVertical()||(this.goldInfo=new ShopUserGoldView(cleverapps.styles.ShopWindow.ShopUserGoldView)),bundles.tile_shop.frames.shop_bg_png){var e=new cc.Scale9Sprite(bundles.tile_shop.frames.shop_bg_png);e.setContentSize2(this.getContentSize()),this.addChild(e),e.setLocalZOrder(-1),e.setOpacity(180),e.setPositionRound(this.width/2,this.height/2)}Lottery.addText(this)},onWindowLoaded:function(e){this.showAll=this.options.showAll;var t=cleverapps.styles.ShopWindow;if(this._super({
notCloseByTouchInShadow:!0,name:"shopwindow",content:this.createContent(this.tab),title:this.getTitle(),noBackground:t.noBackground,styles:t}),t.repeatablePattern){for(var i=new cc.Sprite(bundles.tile_shop.frames.shop_bg_markiza_png).width,s=Math.ceil(this.width/i),n=[],o=0;o<s;o++){var a=new cc.Sprite(bundles.tile_shop.frames.shop_bg_markiza_png);n.push(a)}var r=new cleverapps.Layout(n,{direction:cleverapps.UI.HORIZONTAL,margin:t.repeatablePattern.margin});r.setScale(this.width/r.width),this.addChild(r),r.setPositionRound(t.repeatablePattern),r.replaceParentSamePlace(this.window),r.setScale(1*r.scale/this.window.scale)}if(Math.random()<.1&&cleverapps.config.debugMode){console.log("Check building layout for all payer classes.");for(o=0;o<5;o++){var l=ProductSource.listProducts(ShopWindow.TABS.COINS),c=TileLayout.Layouts.compact.map(function(e){return new TileLayout(e)});LayoutAdjuster.Adjust(c,l,{}).positionTiles();var p=TileLayout.Layouts.expanded.map(function(e){
return new TileLayout(e)});LayoutAdjuster.Adjust(p,l,{}).positionTiles()}}cleverapps.audio.playSound(bundles.main.urls.window_effect)},getTitle:function(){if(!this.showAll||!this.isVertical())return{text:"messages:ShopWindow.title",font:cleverapps.styles.ShopWindow.title.font,margin:cleverapps.styles.ShopWindow.title.margin}},onHide:function(){this.goldInfo&&this.goldInfo.onHide(),this.hidden=!0},buyProduct:function(e){this.closingNow||this.hidden||e.buy(this.close.bind(this,!0))},expandShop:function(){this.closingNow||(new ShopWindow({showAll:!0,tab:ShopWindow.TABS.COINS}),this.close())},isVertical:function(){return cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL},createContent:function(e){var t=cleverapps.styles.ShopWindow,i=(this.showAll?TileLayout.Layouts.expanded:TileLayout.Layouts.compact).map(function(e){return new TileLayout(e)}),s={onClickHandler:this.buyProduct.bind(this),onMoreClickHandler:this.expandShop.bind(this)},n=ProductSource.listProducts(e)
;this.shopLayout=LayoutAdjuster.Adjust(i,n,s);var o=this.shopLayout.positionTiles(),a=new cc.Node;a.setAnchorPoint2(),a.addChild(o),!this.isVertical()&&this.showAll||o.width+2*t.wrap.paddingX>cc.director.getWinSize().width&&o.setScale(cc.director.getWinSize().width/(o.width+2*t.wrap.paddingX));var r=0;this.isVertical()||(r=t.wrap.offsetX);var l=0;this.isVertical()&&(l=t.wrap.offsetY),a.setContentSize2(o.width*o.scale+r,o.height*o.scale+l),o.setPositionRound(a.width/2,a.height/2-l/2),cleverapps.styles.ShopWindow.contentOffset<0&&(a.height-=cleverapps.styles.ShopWindow.contentOffset,o.y-=cleverapps.styles.ShopWindow.contentOffset);var c=this.scroll=new cleverapps.UI.ScrollView(a,{direction:this.isVertical()?cleverapps.UI.ScrollView.DIR_VERTICAL:cleverapps.UI.ScrollView.DIR_HORIZONTAL,clipping:!1});return c.setContentSize2(cc.director.getWinSize()),this.shopLayout.scrollToBadge(this.scroll),c},onShow:function(e){this.goldInfo&&this.goldInfo.showUp(),this.hidden=void 0,
this.shopLayout.onShow(e)},onClose:function(){cleverapps.windows.isActive()||(this.tab===ShopWindow.TABS.LIVES&&cleverapps.lives&&cleverapps.lives.isEmpty()?HelpFromFriendsWindow.showIfCan(HelpFromFriendsWindow.TYPES.addlivesvideo,function(e,t){cleverapps.lives.give(t.amount)}.bind(this)):this.tab===ShopWindow.TABS.COINS&&levels.user.gold<100&&HelpFromFriendsWindow.showIfCan(HelpFromFriendsWindow.TYPES.addcoinsvideo,function(e,t){levels.user.setGold(levels.user.gold+t.amount)}.bind(this)))},close:function(e){if(!this.closingNow){this.goldInfo&&this.goldInfo.close(),this.closingNow=!0;var t=this._super;if(!0===e)t.call(this);else{var i=cleverapps.styles.ShopWindow;if(this.closeButton instanceof BandButton&&this.closeButton.hide(),this.scrollBarBG&&this.scrollBarBG.runAction(new cc.FadeOut(.3)),this.window.titleText&&i.noBackground){var s=cc.p(this.window.titleText.x,cc.director.getWinSize().height+this.window.titleText.height/2),n=cc.p(this.window.titleText.x,
this.window.titleText.y-i.title.hideAnimation.moveDownY);this.window.titleText.runAction(new cc.Sequence(new cc.MoveTo(.15,n),new cc.MoveTo(.3,s).easing(cc.easeIn(1)))),this.titleBg&&this.titleBg.runAction(new cc.Sequence(new cc.MoveTo(.15,n),new cc.MoveTo(.3,s).easing(cc.easeIn(1))))}this.shopLayout.onClose(t.bind(this))}}}});ShopWindow.prototype.listBundles=function(){return["tile_shop","shop_user_gold_view"]},ShopWindow.TABS={COINS:0,LIVES:1},cleverapps.styles.ShopWindow=cleverapps.overrideStyles(cleverapps.styles.Window,{noWindowScale:!0,noBackground:!0,contentOffset:-30,contentPadding:30,useSceneOffset:!0,font:cleverapps.styles.FONTS.TILE_SHOP_WINDOW_TEXT,scroll:{delay:0,offset:{y:-50}},scrollBarBG:{height:24,paddingX:20,y:20},wrap:{paddingX:30,offsetX:100,offsetY:0},title:{margin:{y:-60,x:0},hideAnimation:{moveDownY:30},font:cleverapps.styles.FONTS.TILE_SHOP_WINDOW_TITLE_TEXT},rowMargin:30,tileMargin:30,rowsPadding:{x:0,y:50},mouseScrollSpeed:400},!0),cleverapps.overrideStyles(
cleverapps.styles.DECORATORS,{TILE_SHOP_BADGE_STROKE:{color:new cc.Color(100,34,22,255),size:2},TILE_BUTTON_SHADOW:{color:new cc.Color(8,82,40,180),direction:cc.size(0,-5),blur:1},TILE_SHOP_SHADOW:{color:new cc.Color(100,34,22,200),direction:cc.size(0,-3),blur:1},TILE_SHOP_STROKE:{color:new cc.Color(100,34,22,255),size:3}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{TILE_SHOP_BADGE_TEXT:{size:45,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TILE_SHOP_SHADOW,stroke:cleverapps.styles.DECORATORS.TILE_SHOP_BADGE_STROKE},COIN_TILE_BUTTON_TEXT:{size:55,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TILE_BUTTON_SHADOW},TILE_SHOP_WINDOW_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TILE_SHOP_SHADOW,stroke:cleverapps.styles.DECORATORS.TILE_SHOP_STROKE},TILE_SHOP_WINDOW_TITLE_TEXT:{size:80,color:cleverapps.styles.COLORS.WHITE,stroke:{color:new cc.color(85,1,91),size:3},shadow:{color:new cc.color(
85,1,91),direction:cc.size(0,-5),blur:1}}});var TileBadge=function(e,t){var i=t?cleverapps.styles.SmallTileBadge:cleverapps.styles.LargeTileBadge,s={bestSeller:{image:"shop_badge_bestseller_png",text:"messages:Badge.bestSeller"},save:{image:"shop_badge_bestseller_png",text:"messages:Badge.save"}},n=new cc.Sprite(bundles.tile_shop.frames[s[e].image]);if(n.setPositionRound(i),n.setLocalZOrder(2),t&&i.scale&&n.setScale(i.scale),s[e].text){var o=cleverapps.UI.generateTTFText(s[e].text,cleverapps.styles.FONTS.TILE_SHOP_BADGE_TEXT);o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.fitTo(i.text.width),o.setRotation(i.text.rotation),n.addChild(o),o.setPositionRound(n.width/2+i.text.x,n.height/2+i.text.y)}return n};cleverapps.overrideFonts(cleverapps.styles.FONTS,{TILE_SHOP_BADGE_TEXT:{size:25,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.TILE_SHOP_BADGE_STROKE}}),cleverapps.styles.SmallTileBadge={x:{align:"right",dx:30},y:{align:"top",dy:-10},text:{rotation:30,
width:125,x:5,y:10}},cleverapps.styles.LargeTileBadge={x:{align:"left",dx:-30},y:{align:"top",dy:30},text:{rotation:-30,width:125,x:0,y:5}};var TileButton=function(e,t,i){this.product=e;var s=t?cleverapps.styles.SmallTileButton:cleverapps.styles.LargeTileButton,n=s.width+s.text.padding,o=[];if(this.product.coinsProduct){var a=new cc.Sprite(bundles.reward_icons.frames.gold_small_png);a.setScale(s.icon.scale),o.push(a),n-=a.width*a.scale}var r=new ProductPriceView(this.product,{font:t?cleverapps.styles.FONTS.COIN_TILE_BUTTON_TEXT||cleverapps.styles.FONTS.BUTTON_TEXT:cleverapps.styles.FONTS.TILE_SHOP_WINDOW_BUTTON_TEXT||cleverapps.styles.FONTS.SPECIAL_TILE_BUTTON_TEXT,fitTo:{width:n},iconOK:bundles.tile_shop.frames.ok_icon_png,small:t});o.push(r);var l=new cleverapps.UI.Button({content:new cleverapps.Layout(o,{direction:cleverapps.UI.HORIZONTAL,margin:s.margin}),contentPadding:s.contentPadding,width:s.width,height:s.height,
button_png:t?bundles.tile_shop.frames.small_shop_button||bundles.buttons.frames.green_button_png:bundles.tile_shop.frames.feature_button_png||bundles.main.frames.small_green_button,button_on_png:t?bundles.tile_shop.frames.small_shop_button_on||bundles.buttons.frames.green_button_on_png:bundles.tile_shop.frames.feature_button_on_png||bundles.main.frames.small_green_button_on,onClicked:function(){i(this.product)}.bind(this)});r.y+=s.text.dy,a&&(a.y+=s.icon.dy);var c=[];void 0!==AskLivesProduct&&c.push(AskLivesProduct),void 0!==RefillLivesProduct&&c.push(RefillLivesProduct);for(var p=!0,d=0;d<c.length;d++)if(this.product instanceof c[d]){p=!1;break}p&&Lottery.addIcon(l,void 0,"gold25000"===this.product.itemId);var h=new cc.Node;return h.setAnchorPoint2(),h.setContentSize2(l.getContentSize()),h.addChild(l),l.setPositionRound(s),h};cleverapps.overrideFonts(cleverapps.styles.FONTS,{SPECIAL_TILE_BUTTON_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE,
shadow:cleverapps.styles.DECORATORS.TILE_BUTTON_SHADOW}}),cleverapps.styles.SmallTileButton={x:{align:"center"},y:{align:"center"},margin:10,width:205,height:70,text:{padding:-25,dy:-6},icon:{scale:.8,dy:0}},cleverapps.styles.LargeTileButton={x:{align:"center"},y:{align:"center",dy:-5},margin:10,width:320,height:110,text:{padding:-25,dy:-6},icon:{scale:.8,dy:0}};var TileIcon=function(e,t,i,s){this.product=e;var n=t?cleverapps.styles.SmallTileIcon:cleverapps.styles.LargeTileIcon,o=this.icon=new cc.Sprite(bundles.tile_shop.frames[this.product.icon]);if(!s)if(n.scale)o.setScale(n.scale);else if(n.height){var a=n.height/o.height;a<1&&o.setScale(a)}var r=t?{json:bundles.tile_shop.jsons.shop_sparkles_small_json}:{json:bundles.tile_shop.jsons.shop_sparkles_large_json};if(i&&(r=i),r.json){var l=new cleverapps.Spine(r.json);l.setPosition(this.icon.width/2,this.icon.height/2),this.icon.addChild(l),l.visible=!1;var c=void 0!==r.delay?r.delay:Math.random();this.icon.runAction(new cc.Sequence(
new cc.DelayTime(c),new cc.CallFunc(function(){l.visible=!0,l.setAnimation(0,"animation",!0)}.bind(this))))}var p=n[this.product.itemId]?n[this.product.itemId].wrap.dy:n.wrap.dy,d=new cc.Node;return d.setContentSize2(o.width,n.wrap.height),d.setAnchorPoint2(.5,.5),o.setAnchorPoint2(.5,0),o.setPositionRound(d.width/2,p),d.addChild(o),d};cleverapps.styles.SmallTileIcon={height:120,wrap:{height:110,dy:0}},cleverapps.styles.LargeTileIcon={scale:1,wrap:{height:270,dy:-24}};var TileRewardsBlock=function(e,t,i){this.product=e,this.options=i||{};var s=t?cleverapps.styles.SmallTileRewardsBlock:cleverapps.styles.LargeTileRewardsBlock,n=[],o=[],a="tripeaks"===cleverapps.config.name||"scramble"===cleverapps.config.name;for(var r in this.product.reward)if("boosters"===r)for(var l in this.product.reward.boosters){if(0!==(u=this.product.reward.boosters[l])){if(!(h=s.imageFont||cleverapps.styles.FONTS.TILE_SHOP_SPECIAL_OFFER_IMAGE_TEXT))throw"Required image font TILE_SHOP_SPECIAL_OFFER_IMAGE_TEXT"
;var c=cleverapps.UI.generateTTFText("x"+u,h),p=new cleverapps.Layout([new cc.Sprite(s.boosterIcons[l]),c],{direction:cleverapps.UI.HORIZONTAL,margin:s.amountMargin});p.amount=c,o.push(p),n.push(p)}}else{var d=new cc.Sprite(s[r].icon);d.setScale(s[r].scale);var h=s.imageFont||cleverapps.styles.FONTS.TILE_SHOP_SPECIAL_OFFER_IMAGE_TEXT||cleverapps.styles.FONTS.TILE_SHOP_SPECIAL_OFFER_TEXT;a&&!t&&(h=cleverapps.styles.FONTS.TILE_SHOP_HIGHLIGHTED_IMAGE_TEXT);var u=cleverapps.UI.generateTTFText(this.product.reward[r],h),v=new cleverapps.Layout([d,u],{direction:cleverapps.UI.HORIZONTAL,margin:s.amountMargin});v.amount=u,s[r].offsetY&&v.setPositionY(s[r].offsetY),n.push(v)}for(var g=[];0<n.length;){var m=2;(0===g.length&&o.length<=2&&n.length-o.length<2||a)&&(a=!(m=1));var f=n.splice(0,m),_=new cleverapps.Layout(f,{direction:cleverapps.UI.HORIZONTAL,margin:s.colMargin});g.unshift(_)}var y=new cleverapps.Layout(g,{direction:cleverapps.UI.VERTICAL,margin:s.rowMargin,y:s.offsetY}),w=new cc.Node
;w.setAnchorPoint2(),s.noBg||this.options.noBg||(w=new cc.Scale9Sprite(t?bundles.tile_shop.frames.tile_stripe_png:bundles.tile_shop.frames.tile_best_stripe_png)),w.setContentSize2(s),w.setLocalZOrder(s.zOrder),w.addChild(y),y.setPositionRound(w.width/2,w.height/2);var b=s.height/y.height;return b<1&&2<g.length&&y.setScale(.85*b),w};cleverapps.overrideFonts(cleverapps.styles.FONTS,{TILE_SHOP_OFFER_TEXT:{prefix:"digits#timer_digit_",scale:.7,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{TILE_SHOP_SPECIAL_OFFER_TEXT:{prefix:"digits#timer_digit_",scale:1.2,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.SmallTileRewardsBlock={rowMargin:10,colMargin:10,width:210,height:80,amountMargin:5,offsetY:0,zOrder:0,gold:{icon:bundles.reward_icons.frames.gold_small_png,scale:1},unlimitedLives:{scale:.5},stars:{scale:.4},imageFont:cleverapps.styles.FONTS.TILE_SHOP_SPECIAL_OFFER_IMAGE_TEXT},cleverapps.styles.LargeTileRewardsBlock={width:486,
height:162,rowMargin:10,colMargin:10,amountMargin:5,offsetY:35,zOrder:0,gold:{icon:bundles.reward_icons.frames.gold_small_png,scale:1},unlimitedLives:{scale:.5},stars:{scale:.4},imageFont:cleverapps.styles.FONTS.TILE_SHOP_SPECIAL_OFFER_IMAGE_TEXT};var CoinsProductTile=cc.Node.extend({ctor:function(e,t){this._super(),this.options=t||{},this.product=e,this.small=t.small;var i=this.createTile();this.addChild(i),this.setAnchorPoint2(),this.setContentSize2(i.width*i.scaleX,i.height*i.scaleY),i.setPositionRound(this.width/2,this.height/2),this.options.onClicked&&cleverapps.UI.onClick(this,function(){this.options.onClicked(this.product)}.bind(this),{swallowTouches:!1,ignoreOnTouchMoved:!0})},createTile:function(){var e=this.options.styles?this.options.styles:this.small?cleverapps.styles.CoinsProductSmallTile:cleverapps.styles.CoinsProductLargeTile,t=[];this.options.noButton||t.push(new TileButton(this.product,this.small,this.options.onClicked));var i=new TileRewardsBlock(this.product,
this.small,{noBg:this.options.rewardsBlockNoBg}),s=new TileIcon(this.product,this.small);e.order===CoinsProductTile.ORDER.REWARD_CENTER?t.push(i,s):t.push(s,i);var n=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL,margin:e.margin}),o=new cc.Scale9Sprite(this.small?bundles.tile_shop.frames.shop_tile_bg_png:bundles.tile_shop.frames.feature_tile_bg_png);if(o.setContentSize2(e),e.stitches&&new StitchesComponent(o,e.stitches),e.innerBg){var a=new cc.Scale9Sprite(e.innerBg.image);a.setContentSize2(o.width-2*e.innerBg.padding.x,o.height-2*e.innerBg.padding.y),o.addChild(a),a.setPositionRound(e.innerBg)}return o.addChild(n),n.setPositionRound(o.width/2,o.height/2+e.offset.y),this.product.badge&&o.addChild(new TileBadge(this.product.badge,this.small)),o.setScale(e.scale[cleverapps.wideMode.mode]),o},isSmall:function(){return this.small}});CoinsProductTile.ORDER={REWARD_CENTER:0,REWARD_TOP:1},cleverapps.styles.CoinsProductSmallTile={width:240,height:350,margin:15,
order:CoinsProductTile.ORDER.REWARD_CENTER,offset:{y:0},scale:[1,1,1],ok_lottery:{icon:{x:{align:"right",dx:50},y:{align:"top",dy:50}}}},cleverapps.styles.CoinsProductLargeTile={width:444,height:747,order:CoinsProductTile.ORDER.REWARD_CENTER,offset:{y:0},scale:[1,1,1],ok_lottery:{icon:{x:{align:"right",dx:50},y:{align:"top",dy:50}}}};var PackProductTile=cc.Node.extend({ctor:function(e,t){this._super(),this.options=t||{},this.product=e,this.small=!1;var i=this.createTile();this.addChild(i),this.setAnchorPoint2(),this.setContentSize2(i.width*i.scaleX,i.height*i.scaleY),i.setPositionRound(this.width/2,this.height/2),this.options.onClicked&&cleverapps.UI.onClick(this,function(){this.options.onClicked(this.product)}.bind(this),{swallowTouches:!1,ignoreOnTouchMoved:!0})},createTile:function(){var e=cleverapps.styles.PackProductTile,t=[];this.options.noButton||t.push(new TileButton(this.product,this.small,this.options.onClicked)),t.push(new TileRewardsBlock(this.product,this.small)),
e.title&&!this.options.noTitle&&t.push(this.createTitle()),t.push(new TileIcon(this.product,this.small));var i=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL,margin:e.margin}),s=new cc.Scale9Sprite(e.tileBg||bundles.tile_shop.frames.shop_tile_bg_png);if(s.setContentSize2(this.options.size||e),e.stitches&&new StitchesComponent(s,e.stitches),e.innerBg){var n=new cc.Scale9Sprite(e.innerBg.image);n.setContentSize2(s.width-2*e.innerBg.padding.x,s.height-2*e.innerBg.padding.y),s.addChild(n),n.setPositionRound(e.innerBg)}return s.addChild(i),i.setPositionRound(s.width/2,s.height/2+e.offset.y),this.product.badge&&s.addChild(new TileBadge(this.product.badge,this.small)),s.setScale(e.scale[cleverapps.wideMode.mode]),s},createTitle:function(){var e=cleverapps.styles.PackProductTile.title,t=cleverapps.UI.generateTTFText(this.product.title,cleverapps.styles.FONTS.TILE_SHOP_WINDOW_PACK_TITLE||cleverapps.styles.FONTS.SMALL_WHITE_TEXT),i=new cc.Scale9Sprite(
this.product.titleBg||bundles.tile_shop.frames.red_stripe_png);return e.size&&i.setContentSize2(e.size),i.addChild(t),t.setPositionRound(i.width/2+e.x,i.height/2+e.y),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),i.setLocalZOrder(1),t.fitTo(i.width-(e.paddingX||0)),i},isSmall:function(){return!1}});cleverapps.styles.PackProductTile={offset:{y:-20},scale:[1,1.2,1.2],width:340,height:600,margin:10,title:{x:0,y:0}};var LivesProductTile=cc.Node.extend({ctor:function(e,t){this._super(),this.options=t||{},this.product=e,this.small=!0;var i=this.createTile();this.addChild(i),this.setAnchorPoint2(),this.setContentSize2(i.width*i.scaleX,i.height*i.scaleY),i.setPositionRound(this.width/2,this.height/2),this.options.onClicked&&cleverapps.UI.onClick(this,function(){this.options.onClicked(this.product)}.bind(this),{swallowTouches:!1,ignoreOnTouchMoved:!0})},isSmall:function(){return this.small},createTile:function(){
var e=cleverapps.styles.LivesProductTile,t=[new TileButton(this.product,this.small,this.options.onClicked),this.createTitle(),new TileIcon(this.product,this.small,this.product.animation?{json:bundles.tile_shop.jsons.shop_lives_animations_json,delay:0}:{},!0)],i=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL,margin:e.margin}),s=new cc.Scale9Sprite(e.tileBg||bundles.tile_shop.frames.shop_tile_bg_png);if(s.setContentSize2(e),e.innerBg){var n=new cc.Scale9Sprite(e.innerBg.image);n.setContentSize2(s.width-2*e.innerBg.padding.x,s.height-2*e.innerBg.padding.y),s.addChild(n),n.setPositionRound(e.innerBg)}return s.addChild(i),i.setPositionRound(s.width/2,s.height/2+e.offset.y),s.setScale(e.scale[cleverapps.wideMode.mode]),s},createTitle:function(){var e=cleverapps.styles.LivesProductTile.title,t=cleverapps.UI.generateTTFText(this.product.title,cleverapps.styles.FONTS.SMALL_WHITE_SHOP_TEXT||cleverapps.styles.FONTS.SMALL_WHITE_TEXT),i=new cc.Node;return i.setAnchorPoint2(),!1!==e.bg&&(
i=new cc.Scale9Sprite(e.bg||bundles.tile_shop.frames.red_stripe_png)),e.size&&i.setContentSize2(e.size),i.addChild(t),t.setPositionRound(i.width/2+e.x,i.height/2+e.y),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),i.setLocalZOrder(e.zOrder||1),t.fitTo(i.width-(e.paddingX||0)),i}});cleverapps.styles.LivesProductTile={width:340,height:400,margin:10,colMargin:30,scale:[1,1,1],button:{width:225,height:75},offset:{y:0},icon:{wrap:{height:150,dy:-15}},title:{x:0,y:5}};var MoreTile=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2();var t=this.createTile(e);this.addChild(t),this.setContentSize2(t.width,t.height),t.setPositionRound(this.width/2,this.height/2)},createTile:function(e){var t=cleverapps.styles.MoreTile,i=cleverapps.UI.generateTTFText("messages:ShopWindow.showMore",cleverapps.styles.FONTS.TILE_SHOP_WINDOW_TEXT);i.setDimensions(t.text.width,0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.fitTo(
void 0,t.text.height);var s=new cc.Sprite(bundles.tile_shop.frames.more_button_png);cleverapps.UI.applyHover(s);var n=new cleverapps.Layout([s,i],{direction:cleverapps.UI.VERTICAL,margin:t.margin}),o=new cc.Scale9Sprite(bundles.tile_shop.frames.shop_tile_bg_png);return o.setContentSize2(t),o.addChild(n),n.setPositionRound(o.width/2,o.height/2+t.offset.y),o.setScale(t.scale[cleverapps.wideMode.mode]),t.stitches&&new StitchesComponent(o,t.stitches),cleverapps.UI.onClick(o,e.onClicked),o}});cleverapps.styles.MoreTile={offset:{y:0},text:{width:150,height:200},scale:[1,1,1],width:240,height:350,margin:20};var LotteryIcon=cc.Sprite.extend({ctor:function(e,t,i){this._super();var s,n=this.styles=cleverapps.styles.LotteryIcon,o=cleverapps.eventManager.getFeatureEvent("lottery"),a=-1!==["mobile_ok","web_ok"].indexOf(cleverapps.User.calcSource())&&!1!==o.options.okLottery,r=a&&o.options.lottery10k&&i,l=-1!==["mobile_vk","web_vk"].indexOf(cleverapps.User.calcSource())&&o.options.vkSaleDay
;a?n=cleverapps.overrideStyles(n,cleverapps.styles.OkLotteryIcon,!0):l&&(n=this.styles=cleverapps.overrideStyles(n,cleverapps.styles.VkLotteryIcon,!0)),l?(s=bundles.lottery.frames.vk_lottery,n=cleverapps.overrideStyles(n,cleverapps.styles.VkLotteryIcon,!0)):a?(s=r?bundles.lottery.frames.ok_lottery_10k:bundles.lottery.frames.ok_lottery,n=cleverapps.overrideStyles(n,cleverapps.styles.OkLotteryIcon,!0)):s=bundles.lottery.frames["lottery_"+cleverapps.settings.language]||bundles.lottery.frames.lottery_en,this._super(s),e.addChild(this),t=t||"bottom",this.setScale(n.positions[t].scale||n.scale||1),this.baseScale=this.scale,this.setPositionRound(n.positions[t]),n.positions[t].preserveX&&(this.preservedX=this.x)}});cleverapps.styles.VkLotteryIcon={positions:{icon:{x:{align:"center",dx:-65},y:{align:"bottom",dy:-40},preserveX:!0},subscription:{x:{align:"left",dx:-10},y:{align:"bottom",dy:-40}}}},cleverapps.styles.OkLotteryIcon={},cleverapps.styles.LotteryIcon={positions:{bottom:{x:{
align:"center",dx:0},y:{align:"bottom",dy:-70}},top:{x:{align:"center",dx:0},y:{align:"top",dy:55}},icon:{x:{align:"center",dx:0},y:{align:"bottom",dy:-20}},icon_top:{x:{align:"center",dx:0},y:{align:"top",dy:0}},subscription:{x:{align:"center",dx:0},y:{align:"top",dy:40}},bottom_right:{x:{align:"right",dx:30},y:{align:"bottom",dy:-70}}}};var Lottery={isActive:function(){return cleverapps.eventManager.isActive("lottery")&&!cleverapps.flags.nopayments},addIcon:function(e,t,i){this.isActive()&&(e.lotteryIcon=new LotteryIcon(e,t,i)).runAction(new cc.RepeatForever(new cc.Sequence(new cc.DelayTime(3),new cc.RotateTo(.2,10),new cc.RotateTo(.2,-10),new cc.RotateTo(.2,10),new cc.RotateTo(.2,-10),new cc.RotateTo(.2,0))))},addText:function(e){if(this.isActive()){var t=cleverapps.styles.Lottery,i="messages:Lottery.info",s=cleverapps.eventManager.getFeatureEvent("lottery");-1!==["mobile_vk","web_vk"].indexOf(cleverapps.User.calcSource())&&s.options.vkSaleDay&&(i="messages:Lottery.infoSaleDay")
;var n=cleverapps.UI.generateTTFText(i,t.text.font);e.addChild(n),n.setPositionRound(t.text),n.fitTo(e.width)}}};cleverapps.styles.Lottery={text:{font:cleverapps.styles.FONTS.SMALL_WHITE_TEXT,x:{align:"center"},y:{align:"bottom",dy:5}}};var ProductSource={listProducts:function(t){var e=cleverapps.paymentsHistory.classify(),i=t===ShopWindow.TABS.LIVES?ProductSource.ITEMS.Lives.filter(function(e){return"askLives"===e?-1===["huzcom","plinga","pliega"].indexOf(cleverapps.User.calcSource()):"unlimitedLives"!==e||!cleverapps.flags.nopayments}):e<=cleverapps.PaymentsHistory.PAYER_WEAK?ProductSource.ITEMS.CoinsBeginner:ProductSource.ITEMS.CoinsPayer;if(i=i.filter(function(e){return t===ShopWindow.TABS.LIVES||cleverapps.config.products[e]}).map(function(e){return Product.Create(e)}),t===ShopWindow.TABS.COINS){var s=0;i.forEach(function(e){e.price&&e.price>s&&(s=e.price)});for(var n=0;n<i.length;n++)if(i[n].price===s){i[n].badge="save";break}}var o=ProductSource.ITEMS.bestSellersByPayerClass[e]
;for(n=0;n<i.length;n++)if(-1!==o.indexOf(i[n].itemId)){i[n].badge="bestSeller";break}var a=[];return t===ShopWindow.TABS.COINS&&(a=ProductSource.ITEMS.optionalByPayerClass[e]),{products:i,optional:a}},ITEMS:{Lives:["refillLives","unlimitedLives","askLives"],CoinsBeginner:["sweetPack","jamPack","tastyPack","honeyPack","gold500","gold1800","gold3800","gold6000","gold25000"],CoinsPayer:["jamPack","tastyPack","honeyPack","epicPack","gold500","gold1800","gold3800","gold6000","gold25000"],optionalByPayerClass:[["gold25000","honeyPack","gold6000","tastyPack","gold3800"],["gold25000","honeyPack","gold6000","sweetPack","gold500"],["gold500","epicPack","gold25000","jamPack","gold1800"],["gold500","jamPack","tastyPack","gold1800","gold3800"],["gold500","jamPack","tastyPack","gold1800","gold3800"]],bestSellersByPayerClass:[["sweetPack","gold500"],["jamPack","gold1800"],["tastyPack","gold3800"],["honeyPack","gold6000"],["honeyPack","gold25000"]]}},LayoutAdjuster={Adjust:function(e,t,i){for(
var s=this.createTiles(t.products,i.onClickHandler,i.onMoreClickHandler),n=[],o=!0;!(0<(n=e.filter(function(e){return e.isEnough(s)})).length);)if(o=!1,!this.trimOptional(s.large,s.large.length-1,t.optional)&&cleverapps.config.debugMode)throw"select layout error";if(cleverapps.config.debugMode&&0===n.length)throw"select layout error";return o||s.small.push(s.more),this.trimOptional(s.small,n[0].countOfSmallTiles(),t.optional),n[0].setTiles(s),n[0]},createTiles:function(e,s,t){var i=e.map(function(e){var t=e.itemId,i={onClicked:s};return-1!==t.indexOf("Lives")?new LivesProductTile(e,i):-1!==t.indexOf("Pack")?new PackProductTile(e,i):(i.small="bestSeller"!==e.badge,new CoinsProductTile(e,i))},this);return{small:i.filter(function(e){return e.isSmall()}),large:i.filter(function(e){return!e.isSmall()}),more:new MoreTile({onClicked:t})}},trimOptional:function(e,t,i){for(var s=!1,n=0;n<i.length&&e.length>t;n++)for(var o=0;o<e.length;o++)if(e[o].product&&e[o].product.itemId===i[n]){e.splice(o,
1),s=!0;break}return s}},TileLayout=function(e){cleverapps.extend(this,e),this.amountInRowForLarge=0,this.amountInRightColumn=0,this.amountOfRightColumns=0,this.amountInBottomRow=0,this.amountOfBottomRows=0,e.map.forEach(function(e){if(0===e.indexOf("x"))this.amountOfBottomRows++,this.amountInBottomRow=e.length;else{var t=e.replace(/x/g,"");this.amountInRowForLarge=t.length,-1!==e.indexOf("x")&&this.amountInRightColumn++,this.amountOfRightColumns=e.length-t.length}},this)};TileLayout.prototype.isEnough=function(e){return!(cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&!this.vertical)&&((!this.vertical||cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL)&&(void 0===this.largeTiles||this.largeTiles===e.large.length))},TileLayout.prototype.setTiles=function(e){this.tiles=e.large.concat(e.small),this.tileSet=e},TileLayout.prototype.onShow=function(e){e=e||0;for(var t=this.tiles.length-1;0<=t;t--){var i=this.tiles[t].scale;this.tiles[t].setScale(0),this.tiles[t].runAction(
new cc.Sequence(new cc.DelayTime(e+.075*Math.ceil(.5*t)),new cc.ScaleTo(.4,i).easing(cc.easeBackOut())))}},TileLayout.prototype.onClose=function(e){for(var t=cleverapps.wait(this.tiles.length,e),i=this.tiles.length-1;0<=i;i--)this.tiles[i].runAction(new cc.Sequence(new cc.DelayTime(.075*Math.ceil(.5*i)),new cc.ScaleTo(.3,0).easing(cc.easeBackIn()),new cc.CallFunc(t.bind(this,i))))},TileLayout.prototype.scrollToBadge=function(e){var t=this.tiles.filter(function(e){return!(e instanceof MoreTile)&&e.product.badge})[0];t&&e.scrollTo(t)},TileLayout.prototype.positionTiles=function(){var e=cleverapps.styles.ShopWindow,t=[];if(2===this.amountOfRightColumns&&2===this.amountInRightColumn)t.push(new cleverapps.Layout([this.tileSet.small[2],this.tileSet.small[0]],{direction:cleverapps.UI.VERTICAL,margin:e.tileMargin})),t.push(new cleverapps.Layout([this.tileSet.small[3],this.tileSet.small[1]],{direction:cleverapps.UI.VERTICAL,margin:e.tileMargin}));else for(var i=0;i<this.amountOfRightColumns;i++
){var s=this.tileSet.small.splice(0,this.amountInRightColumn).reverse();t.push(new cleverapps.Layout(s,{direction:cleverapps.UI.VERTICAL,margin:e.tileMargin}))}var n=[];for(i=0;i<this.amountOfBottomRows;i++){s=this.tileSet.small.splice(0,this.amountInBottomRow);this.vertical&&1===this.tileSet.large.length&&s.reverse(),n.push(new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL,margin:e.tileMargin}))}0===this.tileSet.large.length&&n.reverse();var o=[];if(0<t.length)o.push(new cleverapps.Layout(this.tileSet.large.concat(t),{direction:cleverapps.UI.HORIZONTAL,margin:e.tileMargin}));else{var a=this.tileSet.large.length/this.amountInRowForLarge;for(i=0;i<a;i++)o.push(new cleverapps.Layout(this.tileSet.large.splice(0,this.amountInRowForLarge),{direction:cleverapps.UI.HORIZONTAL,margin:e.tileMargin}));o.reverse()}var r=n.concat(o);for(i=0;i<r.length;i++)r[i].setLocalZOrder(r.length-i);return new cleverapps.Layout(r,{direction:cleverapps.UI.VERTICAL,margin:e.rowMargin,
padding:e.rowsPadding})},TileLayout.prototype.countOfSmallTiles=function(){return this.amountInRightColumn*this.amountOfRightColumns+this.amountInBottomRow*this.amountOfBottomRows},TileLayout.Layouts={compact:[{largeTiles:0,vertical:!0,map:["xx","xx"]},{largeTiles:0,vertical:!1,map:["xx","xx"]},{largeTiles:1,vertical:!0,map:["Ax","Ax","xx"]},{largeTiles:1,vertical:!1,map:["Axx","Axx"]},{largeTiles:2,vertical:!0,map:["AB","AB","xxx"]},{largeTiles:2,vertical:!1,map:["ABxx","ABxx"]}],expanded:[{vertical:!0,map:["AB","AB","CD","CD","xx","xx"]},{vertical:!1,map:["ABCDxx","ABCDxx"]}]};var Tabs=cc.Node.extend({ctor:function(e,t){this._super(),this.styles=t||{};t=cleverapps.styles.Tabs;this.buttonsById={};var i=[];e.forEach(function(e){var t=this.createTab(e);this.addChild(t),i.push(t),this.buttonsById[e]=t}.bind(this));var s=cleverapps.UI.arrangeWithMargins(i,{direction:cleverapps.UI.HORIZONTAL,y:0,margin:t.margin});this.setContentSize2(s,i[0].height),this.setAnchorPoint2(1,0),
this.setLocalZOrder(t.zOrder),this.activeId=void 0,this.onSelectTab=function(e){},this.onUnSelectTab=function(e){},cleverapps.styles.WINDOW_SCALE&&this.setScale(cleverapps.styles.WINDOW_SCALE),this.customize()},customize:function(){},listIds:function(){return Object.keys(this.buttonsById)},onEnter:function(){this._super();var e=this.styles.position||cleverapps.styles.Tabs,t=cleverapps.styles.Tabs;this.setPositionRound(e),this.y=this.y-this.height,cleverapps.styles.WINDOW_SCALE&&(this.y*=cleverapps.styles.WINDOW_SCALE,this.y+=t.small_window.dy)},getActive:function(){return this.activeId},activateTab:function(e){if(-1===this.listIds().indexOf(e&&e.toString())&&(e=+this.listIds()[0]),void 0!==this.activeId)this.buttonsById[this.activeId].enable(),this.onUnSelectTab(this.activeId);else for(var t in this.buttonsById)this.buttonsById[t].enable(),this.onUnSelectTab(t);this.activeId=e,this.buttonsById[this.activeId].disable(),this.onSelectTab(e)},createTab:function(e){
var t=cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.Tabs.button,!0),this.styles[e]),i=new cc.Sprite(res[t.icon]),s=1;void 0!==t.scale&&(s=t.scale,i.setScale(s));var n=new(cleverapps.UI.Button.extend({onMouseOver:function(){this.content.setScale(1.05*s)},onMouseOut:function(){this.content.setScale(s)}}))({button_png:res[t.button_off],button_on_png:res[t.button_off],button_off_png:res[t.button_on],width:t.width||void 0,height:t.height||void 0,content:i,click_effect:res.tab_click_effect,onClicked:function(){this.activateTab(e)}.bind(this)});return i.setPositionRound(t.x,t.y),n}});cleverapps.styles.Tabs={x:{align:"right",dx:-70},y:{align:"bottom",dy:80},small_window:{dy:4},zOrder:10,margin:-30,button:{button_on:"shop_tab_on",button_off:"shop_tab_off",scale:.6,x:{align:"center"},y:{align:"center",dy:14}}};var Buttons=cc.Node.extend({ctor:function(e){this._super(),0!==(e=Buttons.filter(e)).length&&(this.buttons={},e.forEach(function(e){this.buttons[e.__instanceId]=e,
this.addChild(e)},this),this.arrange())},onEnterTransitionDidFinish:function(){this._super(),this.arrange()},arrange:function(){var e=cleverapps.styles.Buttons,t=e.margin.x,i=0;if(1<this.children.length&&this.parent){var s=this.parent.width-2*e.padding.x,n=0;this.children.forEach(function(e){n+=e.width,i=Math.max(i,e.height/2)});var o=Math.round((s-n)/(this.children.length-1));t=Math.max(t,o)}this.margin=t,cleverapps.UI.arrangeWithMargins(this.children,{direction:cleverapps.UI.HORIZONTAL,margin:t,y:i}),cleverapps.UI.wrap(this),this.setAnchorPoint2()},add:function(e){0!==Buttons.filter([e]).length&&(this.buttons[e.__instanceId]=e,this.addChild(e),this.arrange())},remove:function(t){cleverapps.styles.Buttons;(t=this.buttons[t.__instanceId])&&(t.stopAllActions(),t.runAction(new cc.Sequence(new cc.ScaleTo(.3,0),new cc.RemoveSelf)),this.children.forEach(function(e){e.x>t.x&&(e.stopAllActions(),e.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.MoveBy(.3,-t.width-this.margin,0))))}),
this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.MoveBy(.3,(t.width+this.margin)/2,0))))},onShow:function(){this.children.forEach(function(e){e.stopAllActions();var t=e.scale;e.setScale(0),e.runAction(new cc.ScaleTo(.7,t).easing(new cc.easeBackOut))})}});Buttons.filter=function(e){return e.filter(function(e){return e&&e.onMouseOver})},Buttons.choose=function(e){if(0!==(e=Buttons.filter(e)).length)return e[Math.floor(Math.random()*e.length)]},Buttons.remove=function(e){if(e.parent instanceof Buttons&&e.parent.buttons[e.__instanceId]){var t=e.parent;1<t.children.length&&t.remove(e)}else e.removeFromParent()},cleverapps.styles.Buttons={margin:{x:20},padding:{x:70}};var RewardBuyButton=cleverapps.UI.Button.extend({ctor:function(e){var t=e.type,i=e.game,s=e.config,n=e.window,o=parseInt(s);-1!==s.indexOf("x2")?o="x2":-1!==s.indexOf("x3")&&(o="x3");var a=this.type=-1!==s.indexOf(RewardBuyButton.VIDEO)?RewardBuyButton.VIDEO:RewardBuyButton.COINS,
r=RewardBuyButton.VIDEO===a,l="";a===RewardBuyButton.COINS&&(l=this.price=parseInt(s.substr(s.indexOf(RewardBuyButton.COINS)+RewardBuyButton.COINS.length)));var c=o;"x2"===o&&(c=i.rewards[t]),"x3"===o&&(c=2*i.rewards[t]);var p=cleverapps.styles.RewardBuyButton,d=o;"number"==typeof o&&(d="+"+o);var h=[];if(d){var u=this.text=cleverapps.UI.generateTTFText(d,cleverapps.styles.FONTS.GAME_REWARD_BUTTON_TEXT);h.push(u)}var v=new cc.Sprite(r?bundles.shared.frames.adicon_png:bundles.menubar.frames.coin_png);if(v.setScale(p.icon.scale),h.push(v),l){var g=cleverapps.UI.generateTTFText(l,cleverapps.styles.FONTS.GAME_REWARD_BUTTON_TEXT);h.push(g)}var m=new cleverapps.Layout(h,{direction:p.direction,margin:p.margin});v.y+=p.icon.offsetY;var f=this.createListener(function(){i.rewards[t]+=c,cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARD_BUY+"_"+t+"_"+(r?"video":"buy")),e.window&&e.window.animateReward&&e.window.animateReward(t,c),Buttons.remove(this),e.onRemove&&e.onRemove(),
cleverapps.isRumble()&&n.roundCountdown.resumeCountdown()}.bind(this));this._super({width:p.width,height:p.height,button_png:p.button_png,button_on_png:p.button_on_png,content:m,contentOffset:p.contentOffset,contentPadding:0,onClicked:this.createListener(function(){r?(cleverapps.isRumble()&&n.roundCountdown.pauseCountdown(),cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,f)):i.canPayReward(t)&&(levels.user.takeGold(l)?(cleverapps.audio.playSound(res.shop_buy_effect),f()):cleverapps.isRumble()&&n.roundCountdown.pauseCountdown())}.bind(this))}),this.scale=this.baseScale=p.scale}});RewardBuyButton.VIDEO="[=]",RewardBuyButton.COINS="@",cleverapps.styles.RewardBuyButton={width:160,height:60,scale:.9,margin:4,direction:cleverapps.UI.HORIZONTAL,button_png:res.small_green_button,button_on_png:res.small_green_button_on,icon:{scale:.5,offsetY:0}};var VictoryWindowButton=cleverapps.UI.Button.extend({ctor:function(e){var t=e.level,i=e.boatswain,s="OK",n=void 0;if(
t.episode.isDailyLevel()&&!cleverapps.dailyLevel.isStartFromPortlet())n=i.DAILY_LEVEL_BACK_TO_MAIN;else{var o=cleverapps.Plot.decideNext(t);o===Boatswain.NEXT_INTENT?(s="Next",n=i.PLAY_NEXT):o===Boatswain.REPLAY_INTENT&&(s="Replay",n=i.REPLAY)}var a=cleverapps.styles.VictoryWindowButton;this._super({width:a.width,height:a.height,text:Messages.get(s).toUpperCase(),font:cleverapps.styles.FONTS.BUTTON_TEXT,onClicked:this.createListener(function(){n&&(i.intent=n),e.onPressed()})});var r=this.width*this.getScaleX(),l=cleverapps.styles.VictoryWindowButton.titleOffset;r<l+this.text.width&&this.text.setScale(r/(l+this.text.width))}});cleverapps.styles.VictoryWindowButton={width:220,height:110,titleOffset:40};var SettingsWindow=Window.extend({onWindowLoaded:function(){var e=[];e.push({label:void 0,view:this.addSoundIcons()});var t=cleverapps.User.calcSource();"undefined"!=typeof match3&&cc.sys.os!==cc.sys.OS_IOS&&e.push({label:"messages:SettingsWindow.Effects",view:this.addEffectButton()})
;var i="tripeaks"===cleverapps.config.name;if(1<cleverapps.Settings.getAvailableLanguages().length&&e.push({label:i?"messages:Language":void 0,view:this.addLanguages()}),!cleverapps.social.isLoggedIn()&&-1===["mobile_vk","web_vk","plinga","huzcom","pliega"].indexOf(t)){var s=cleverapps.social.isInitialized()?"messages:SignIn":"messages:FBLoginOrInvite.Button.Connecting";e.push({label:i?s:void 0,view:this.createLoginButtons()})}(cleverapps.social.nativeInviteFriends||cleverapps.social.isLoggedIn()&&!cleverapps.flags.noviral)&&e.push({label:i?"messages:FBLoginOrInvite.Button.Invite":void 0,view:this.createInviteButton()}),-1===["mbga","sp_mbga","plinga","huzcom","instant","amazon","pliega"].indexOf(t)&&e.push({label:i?"messages:Help":void 0,view:this.addHelpButton()}),!Game.currentGame&&Chat.IsAvailable()&&e.push({label:i?"messages:SupportButton":void 0,view:this.addSupportButton()}),Game.currentGame&&void 0===Game.currentGame.outcome&&cleverapps.environment.isGameScene(
)&&"match3"===cleverapps.config.type&&e.push({label:void 0,view:this.addGiveUpButton()}),e.reverse();var n=cleverapps.styles.SettingsWindow,o=e.map(function(e){var t=e.view;if(e.label){if(n.Substrate)return this.singleLineWithSubstrate(t,e.label);var i=new cleverapps.UI.generateTTFText(e.label,cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return new cleverapps.Layout([t,i],{direction:cleverapps.UI.VERTICAL,margin:n.Button.topPadding})}return t},this),a=new cleverapps.Layout(o,{direction:cleverapps.UI.VERTICAL,margin:n.Button.topPadding}),r=new cleverapps.Layout([this.createUserId(),this.createResolutionId()],{margin:n.info.margin,direction:cleverapps.UI.VERTICAL}),l=new cleverapps.Layout([r,a],{margin:n.Button.topPadding,direction:cleverapps.UI.VERTICAL}),c=n.Title.empty?void 0:"messages:SettingsWindow.title";this._super({title:c,name:"settingswindow",content:l,styles:cleverapps.overrideStyles(cleverapps.styles.Window,n.window,!0)}),cleverapps.audio.playSound(res.window_effect)},
createContent:function(e,t,s){if(void 0!==e)if("object"==typeof e){var i=cleverapps.User.calcSource();e=s.icon.image[i]}else e=res[e];s=s||{};var n=cleverapps.styles.SettingsWindow,o=s.font||cleverapps.styles.FONTS.BUTTON_TEXT,a=function(e){if(e){var t=new cc.Sprite(e),i=s.Icon||{};return t.setScale(i.scale||1),t}};if(t){var r=cleverapps.UI.generateTTFText(t,o),l=new cleverapps.Layout([a(e),r].filter(function(e){return void 0!==e}),{direction:cleverapps.UI.HORIZONTAL,margin:n.Button.margin});return l.text=r,l}return a(e)},singleLineWithSubstrate:function(e,t){var i=cleverapps.styles.SettingsWindow.Substrate,s=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.BUTTON_TEXT);s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setDimensions(i.width-e.width,0),s.fitTo(0,e.height);var n=new cleverapps.Layout([s,e],{direction:cleverapps.UI.HORIZONTAL}),o=cleverapps.UI.createScale9Sprite(i.image);return o.setLocalZOrder(-1),
o.setContentSize2(i.width,i.height),o.setPosition(n.width/2-i.marginX,n.height/2-i.marginY),n.addChild(o),n},addGiveUpButton:function(){var e=cleverapps.styles.SettingsWindow,t=this.createContent(e.GiveUpButton.icon,"messages:GiveUp",e.GiveUpButton);return new cleverapps.UI.Button({button_png:res.red_button,button_on_png:res.red_button_on,content:t,onClicked:function(){this.close(),cleverapps.metha.whenFreeFocus(function(){cc.director.getRunningScene().closeAction()})}.bind(this),width:e.Button.width,height:e.Button.height})},addHelpButton:function(){var e=cleverapps.styles.SettingsWindow;return new cleverapps.UI.Button({content:this.createContent(e.HelpButton.icon,!0===e.Button.noCaption?"":"messages:Help",{font:e.Button.font}),onClicked:function(){cc.sys.openURL(cleverapps.bySource(cleverapps.config.helpURL))},width:e.Button.width,height:e.Button.height,button_png:e.HelpButton.button_png||res.blue_button_png,button_on_png:e.HelpButton.button_on_png||res.blue_button_on_png,
contentOffset:e.HelpButton.iconOffset})},addSupportButton:function(){var e=cleverapps.styles.SettingsWindow;return new cleverapps.UI.Button({content:this.createContent(e.HelpButton.icon,!0===e.Button.noCaption?"":"messages:SupportButton",{font:e.Button.font}),onClicked:function(){cleverapps.metha.distract({focus:"ChatScene",action:function(e){cleverapps.scenes.replaceScene(new ChatScene(cleverapps.chat),e)}})}.bind(this),width:e.Button.width,height:e.Button.height,button_png:e.HelpButton.button_png||res.blue_button_png,button_on_png:e.HelpButton.button_on_png||res.blue_button_on_png,contentOffset:e.HelpButton.iconOffset})},addEffectButton:function(){var e=new cleverapps.UI.StateButton({on:"messages:on",off:"messages:off",onClick:function(e){0===e?cleverapps.settings.setFpsMode(cleverapps.Settings.FPS_MODE_LOW):cleverapps.settings.setFpsMode(cleverapps.Settings.FPS_MODE_HIGH)}})
;return cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_HIGH&&cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_AUTO||e.setState(1),e},addLanguages:function(){var e=cleverapps.styles.SettingsWindow;return new cleverapps.UI.Button({content:this.createContent(e.LanguageButton.icon,!0===e.Button.noCaption?"":"messages:Language",e.LanguageButton),onClicked:function(){new LanguagesWindow,this.close()}.bind(this),width:e.Button.width,height:e.Button.height,contentOffset:e.LanguageButton.iconOffset,disabled:cleverapps.environment.isGameScene(),button_png:e.LanguageButton.button_png,button_on_png:e.LanguageButton.button_on_png,button_off_png:e.LanguageButton.button_off_png})},addSoundIcons:function(){var e=[{on:bundles.buttons_main.frames.sound_on_png,off:bundles.buttons_main.frames.sound_off_png,toggle:cleverapps.settings.toggleSound.bind(cleverapps.settings),settings:"sound",listener:"onChangeSoundListener"},{on:bundles.buttons_main.frames.music_on_png,
off:bundles.buttons_main.frames.music_off_png,toggle:cleverapps.settings.toggleMusic.bind(cleverapps.settings),settings:"music",listener:"onChangeMusicListener"}];"undefined"!=typeof match3&&(cc.sys.isNative||cc.sys.isMobile||"ios"===cleverapps.User.calcSource())&&e.push({on:bundles.buttons_main.frames.vibro_on_png,off:bundles.buttons_main.frames.vibro_off_png,toggle:cleverapps.settings.toggleVibro.bind(cleverapps.settings),settings:"vibro",listener:"onChangeVibroListener"});var s=cleverapps.styles.SettingsWindow.IconButton;return this.arrangeButtons(e,cleverapps.styles.SettingsWindow.Button,function(e,t){var i=new cleverapps.UI.Button({content:new cc.Sprite(e.on),contentOff:new cc.Sprite(e.off),width:t.width,height:s.height||t.height,contentOffset:s.contentOffset,onClicked:e.toggle});return i.setBright(cleverapps.settings[e.settings]),cleverapps.settings[e.listener]=function(){i.setBright(cleverapps.settings[e.settings])},i})},arrangeButtons:function(e,t,i){
var s=3===e.length?t.width3:2===e.length?t.width2:t.width,n=t.height2||t.height,o=e.map(function(e){return i(e,{width:s,height:n})},this);return new cleverapps.Layout(o,{direction:cleverapps.UI.HORIZONTAL,margin:t.margin,padding:{x:t.padding||0,y:0}})},createLoginButtons:function(){var s=cleverapps.social.getCodes(),i=function(e,t){var i=cleverapps.styles.SettingsWindow;return new FbButton({multiSocials:1<s.length,width:1===s.length?t.width:void 0,height:t.height,button_png:bundles.main.frames.facebook_small_png,button_on_png:bundles.main.frames.facebook_small_connected_png,login:!0,showText:!(!0===i.Button.noCaption)&&1===s.length,source:e,onSuccess:this.close.bind(this)})}.bind(this),e=cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.SettingsWindow.Button,!0),cleverapps.styles.SettingsWindow.LoginButton);1<s.length&&(e=cleverapps.overrideStyles(cleverapps.clone(e,!0),e.multiSocials));var t=this.arrangeButtons(s,e,function(e,t){return i(e,t)});if(
!cleverapps.styles.SettingsWindow.Substrate&&1<s.length){var n=new cleverapps.UI.generateTTFText("messages:SignIn",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return new cleverapps.Layout([t,n],{direction:cleverapps.UI.VERTICAL,margin:cleverapps.styles.SettingsWindow.Button.topPadding})}return t},createInviteButton:function(){var e=cleverapps.styles.SettingsWindow.Button;return new FbButton({width:e.width,height:e.height,button_png:bundles.main.frames.facebook_small_png,button_on_png:bundles.main.frames.facebook_small_connected_png,showText:!(!0===cleverapps.styles.SettingsWindow.Button.noCaption),onSuccess:this.close.bind(this)})},createUserId:function(){var e=cleverapps.user.id;e=e.replace("android_","").replace("apple_","");var t=cleverapps.UI.generateTTFText("messages:SettingsWindow.UserID.text",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,{id:e});if(30<e.length&&t.setString("ID: "+e),t.fitTo(cleverapps.styles.SettingsWindow.UserId.maxWidth),!cc.sys.isNative){cleverapps.UI.onClick(t,
function(){var e=document.createElement("textArea");e.value=cleverapps.user.id,e.style.hidden=!0,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),cleverapps.Notification.create("messages:SettingsWindow.UserID.copied")})}return t},createResolutionId:function(){return new cleverapps.UI.generateTTFText("messages:SettingsWindow.ResolutionId",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,{resolution:100*resolutionScale})}});cleverapps.styles.SettingsWindow={HelpButton:{},IconButton:{},LoginButton:{margin:40,padding:0},Button:{width:450,height:110,topPadding:20,leftPadding:0,margin:15,width2:215,width3:140},LanguageButton:{icon:"language_icon_png"},GiveUpButton:{enabled:!1},ModesSlider:{margin:0},UserId:{maxWidth:500},window:{contentOffset:-50,Border:{y:100}},Title:{empty:!1},info:{margin:5},topPadding:40,width:400,height:430};var LanguageButton=cc.Node.extend({ctor:function(e,t){this._super(),this.callback=t,this.language=e,this.setContentSize2(
cleverapps.styles.LanguagesWindow.Button),this.setAnchorPoint2(),this.addContent(),cleverapps.UI.onClick(this,this.onClicked.bind(this)),cleverapps.UI.applyHover(this)},onClicked:function(){this.isCurrentLanguage()||this.callback(this.language)},isCurrentLanguage:function(){return cleverapps.settings.language===this.language},onTouchBegan:function(){this.isCurrentLanguage()||(this.isPressed=!0,this.updateContent())},onTouchEnded:function(){this.isCurrentLanguage()||(this.isPressed=!1,this.updateContent())},addContent:function(){this.content=this.createButtonContent(),this.addChild(this.content),this.content.setPositionRound(this.width/2,this.height/2)},onMouseOver:function(){this.isCurrentLanguage()||this.setScale(1.05)},updateContent:function(){this.content.removeFromParent(!0),this.addContent()},createButtonContent:function(){var e=cleverapps.styles.LanguagesWindow.Button,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e);var i=this.bg=cleverapps.UI.createScale9Sprite(
this.isPressed||this.isCurrentLanguage()?bundles.languageswindow.frames.buttonbg_on_png:bundles.languageswindow.frames.buttonbg_png);i.setContentSize2(t.getContentSize()),i.setPosition(t.width/2,t.height/2),t.addChild(i);var s=cleverapps.styles.FONTS.LANGUAGE_TEXT;this.isCurrentLanguage()&&cleverapps.styles.FONTS.LANGUAGE_SELECTED_TEXT&&(s=cleverapps.styles.FONTS.LANGUAGE_SELECTED_TEXT);var n=cleverapps.UI.generateTTFText("messages:"+this.language,s);if(n.fitTo(t.width-2*e.padding.x),t.addChild(n),n.setPositionRound(t.width/2+e.text.offset.x,t.height/2+e.text.offset.y),this.isCurrentLanguage()){var o=new cc.Sprite(bundles.languageswindow.frames.buttoncheck_png);for(o.setPositionRound(e.check),t.addChild(o);cc.rectIntersectsRect(o.getBoundingBox(),n.getBoundingBox());)n.fitTo(.95*n.width)}return t}}),LanguagesWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.LanguagesWindow,t=cleverapps.overrideStyles(cleverapps.styles.Window,e.window,!0);this._super({
title:"messages:Language",name:"languageswindow",minHeight:e.minHeight,content:this.createContent(),styles:t}),cleverapps.audio.playSound(res.window_effect)},createContent:function(){var e=cleverapps.styles.LanguagesWindow,t=cleverapps.clone(cleverapps.Settings.getAvailableLanguages()),i=e.amountInRow[cleverapps.wideMode.mode];this.buttonsPerLanguage={};for(var s=[];0<t.length;){var n=t.splice(0,i),o=[];n.forEach(function(e){var t=new LanguageButton(e,this.buttonClicked.bind(this));o.push(t),this.buttonsPerLanguage[e]=t}.bind(this));var a=new cleverapps.Layout(o,{direction:cleverapps.UI.HORIZONTAL,margin:e.columnMargin});s.unshift(a)}var r=new cleverapps.Layout(s,{direction:cleverapps.UI.VERTICAL,margin:e.rowMargin,padding:e.padding});if(e.bg){var l=new cc.Scale9Sprite(bundles.languageswindow.frames.bg_png);return l.setContentSize2(r.width+2*e.bg.padding.x,r.height+2*e.bg.padding.y),l.addChild(r),r.setPositionRound(l.width/2,l.height/2),l}return r},buttonClicked:function(t){
var i=cleverapps.settings.language;t!==i&&cleverapps.metha.distract({focus:"LanguageChanged",action:function(e){cleverapps.settings.setLanguage(t),"board"===cleverapps.config.type&&levels.episodes.reset(),this.buttonsPerLanguage[i].updateContent(),this.buttonsPerLanguage[t].updateContent(),Messages.preload(t,function(){this.setTitle("messages:Language"),cleverapps.environment.isGameScene()?cleverapps.lives?(e(),this.close()):cleverapps.metha.wantsToPlay(e):cleverapps.metha.gotoMainScene(e)}.bind(this))}.bind(this)})},listBundles:function(){return["languageswindow"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{LANGUAGE_TEXT:{size:35,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.LanguagesWindow={Button:{width:260,height:100,padding:{x:10},text:{offset:{x:0,y:0}},check:{margin:3,x:{align:"left",dx:6},y:{align:"center",dy:0}}},window:{contentOffset:-40},columnMargin:20,rowMargin:20,padding:{x:0,y:10},amountInRow:[2,3,3]};var TutorialFinishWindow=Window.extend({
onWindowLoaded:function(){var e=cleverapps.styles.TutorialFinishWindow,t=new cc.Node;t.setAnchorPoint(.5,.5);var i=e.paddingBottom;t.setContentSize(e.width,e.height?e.height:e.paddingBottom);var s=cleverapps.UI.generateTTFText("messages:TutorialFinishWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT,{gameTitle:Messages.get(cleverapps.config.title)});s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var n=t.width+50;if(s.setDimensions(cc.size(n,0)),s.setPosition(t.width/2+e.text.x,t.height+s.height/2+e.text.y),t.addChild(s),i+=s.height+e.paddingTop,e.character){var o=new cc.Sprite(e.character.image);o.setPosition(t.width/2+e.character.x,e.character.y),t.addChild(o),i+=o.height}e.height&&(i=e.height),t.setContentSize(t.width,i),this._super({content:t,title:"messages:TutorialFinishWindow.title",name:"tutorialfinishwindow",button:{text:Messages.get("OK")},closeButton:!1}),cleverapps.audio.playSound(res.window_effect)}});cleverapps.styles.TutorialFinishWindow={width:550,paddingBottom:50,
paddingTop:20,text:{x:0,y:0}};var RateWindow=Window.extend({onWindowLoaded:function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.RATE_WINDOW);for(var i=cleverapps.styles.RateWindow,s=[],e=[],t=0;t<5;t++)e.push(t);var n=-1,o=function(e){if(e!==n){n=e;for(var t=0;t<5;t++)t<=e?s[t].turnOn():s[t].turnOff()}},a=function(e){if(4===e){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.RATE_SEND);var t=cleverapps.bySource(cleverapps.config.rate.urls);void 0===t&&(t=cleverapps.config[cleverapps.User.calcSource()]&&cleverapps.config[cleverapps.User.calcSource()].url);var i=function(){t&&cc.sys.openURL(t)};NativeReview.isAvailable()?NativeReview.requestReview(function(e){cleverapps.eventLogger.logEvent("native_review_"+e),"ok"!==e&&i()}):i()}if(cleverapps.eventLogger.logEvent(cleverapps.EVENTS["RATE_"+(e+1)]),e+1<=3){var s=cleverapps.bySource(cleverapps.config.dontLikeGameUrl);s&&cc.sys.openURL(s)}this.close()}.bind(this),r=function(e){var t=this.convertToNodeSpace(e.getLocation()),
i=cc.rect(0,0,this.width,this.height);cc.rectContainsPoint(i,t)?o(this.order):function(e){if(e===n){n=-1;for(var t=0;t<5;t++)s[t].turnOff()}}(this.order)};s=this.stars=e.map(function(e){var t=new cc.Sprite(i.starImage);return t.turnOn=function(){cleverapps.UI.convertToGrayScale(t,!0)},t.turnOff=function(){cleverapps.UI.convertToGrayScale(t)},t.turnOff(),t.order=e,cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(e){var t=this.convertTouchToNodeSpace(e);return!!cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)}.bind(t),onTouchEnded:function(e){var t=this.convertTouchToNodeSpace(e);return!!cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)&&(o(this.order),a(this.order),!0)}.bind(t)},t),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:r.bind(t)},t),t});var l=cleverapps.UI.generateTTFText("messages:RateWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT,{gameTitle:Messages.get(cleverapps.config.title)})
;l.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),l.setDimensions(i.width,0);var c=new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL}),p=new cleverapps.Layout([c,l],{direction:cleverapps.UI.VERTICAL,margin:i.margin,padding:i.padding});this._super({content:p,title:"messages:RateWindow.title",name:"ratewindow",button:{width:i.button.width,height:i.button.height,text:Messages.get("Later").toUpperCase(),onPressed:function(){this.close()}.bind(this)}}),cleverapps.audio.playSound(res.window_effect),this.addFingerTip(s[s.length-1])},addFingerTip:function(e){this.fingerTip=new FingerView,this.fingerTip.setLocalZOrder(20);var t=e.getPosition();e.parent.addChild(this.fingerTip),this.fingerTip.delay(2),this.fingerTip.fadeIn(t),this.fingerTip.press(),this.fingerTip.delay(.3),this.fingerTip.unPress(),this.fingerTip.delay(.1),this.fingerTip.press(),this.fingerTip.delay(.3),this.fingerTip.unPress(),this.fingerTip.fadeOut();var i,s=function(){this.runAction(new cc.Sequence(
new cc.DelayTime(2.2),new cc.CallFunc(function(){this.stars.forEach(function(e,t){e.runAction(new cc.Sequence(new cc.DelayTime(.25*t),new cc.CallFunc(function(){e.turnOn()})))})}.bind(this))))}.bind(this);cc.sys.isNative&&(s(),i=function(){this.stars.forEach(function(e){e.turnOff()}),s()}.bind(this)),this.fingerTip.run({looped:!0,onIterationFinish:i})},onClose:function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.RATED,!0,{raw:!0}),this.fingerTip&&this.fingerTip.removeFromParent(!0)}});RateWindow.hadRated=function(){return cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.RATED,{raw:!0})},cleverapps.styles.RateWindow={width:650,margin:40,padding:{x:15,y:70},text:{height:180},button:{width:300,height:100},starImage:res.ratewindow_on},RateWindow.prototype.listBundles=function(){return["game"]},RateWindow.AVAILABLE={level:3,episode:1};var WindowHelper={animateCollect:function(i,t,e){if(e=cleverapps.once(e||function(){}),i&&i.parent&&t.target&&t.target.parent){
i.replaceParentSamePlace(cc.director.getRunningScene());var s=function(){var e=t.target.parent.convertToWorldSpace(t.target);return t.targetDelta&&(e.x+=t.targetDelta.x,e.y+=t.targetDelta.y),e},n=s(),o=cc.p((i.x+2*n.x)/3,(i.y+2*n.y)/3+cleverapps.styles.WindowHelper.second.y),a=cc.p((i.x+o.x)/2,(i.y+o.y)/2);i.runAction(new cc.Sequence(new cc.Spawn(new cc.BezierTo(.7,[a,o,n]).easing(cc.easeInOut(1)),new cc.ScaleTo(.7,t.scale)),new cc.CallFunc(function(){e(),t.noSound||cleverapps.audio.playSound(bundles.main.urls.collect_coins_effect),!1!==t.remove&&i.parent&&i.removeFromParent(!0)}))),[.175,.35,.7*.75].forEach(function(t){i.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.CallFunc(function(){var e=s();i.runAction(new cc.MoveBy(.7-t,e.x-n.x,e.y-n.y)),n=e})))})}else e()}};cleverapps.styles.WindowHelper={second:{y:400}};var ConfirmExitWindow=Window.extend({onWindowLoaded:function(e,t,i){this.returnOnClose=t,this.onAction=e;var s=cleverapps.styles.ConfirmExitWindow,n=new cc.Node
;n.setAnchorPoint(.5,.5),n.setContentSize2(s.width,s.height);var o=cleverapps.styles.FONTS.CONFIRM_AND_EXIT_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT,a="messages:AreYouSure";cleverapps.environment.isGameScene()&&(cleverapps.lives&&(a="messages:ConfirmExitWindow.message"),i.level.episode.isBonusRound()&&(a="messages:ConfirmExitWindow.BonusRound.message"));var r,l=cleverapps.UI.generateTTFText(a,o);l.setPositionRound(n.width/2+s.text.x,s.text.y),l.setDimensions(s.text.width,0),l.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.text.height&&l.fitTo(0,s.text.height),l.setAnchorPoint2(),n.addChild(l),!1===s.breakView.upAnimation&&void 0!==BreakView&&Game.currentGame&&cleverapps.environment.isGameScene()&&BreakView.AddBreakViews(n,[l],s.breakView.y),this._super({closeByBackButton:!0,title:"messages:ConfirmExitWindow.title",name:"confirmexitwindow",content:n,buttons:this.getButtons(),closeButton:!1}),s.animation&&(s.animation.image?r=new cc.Sprite(s.animation.image):s.animation&&(
r=new cleverapps.Spine(s.animation.json,s.animation.scale)).setAnimation(0,s.animation.onScene?"lose":"sad",!0),s.animation.onScene?(r.setPositionRound(s.animation.x,cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?s.animation.y-s.animation.verticalOffset:s.animation.y),this.addChild(r)):(r.setPositionRound(n.width/2+s.animation.x,n.height/2+s.animation.y),n.addChild(r))),!0===s.breakView.upAnimation&&void 0!==BreakView&&Game.currentGame&&cleverapps.environment.isGameScene()&&BreakView.AddBreakViews(n,[r],s.breakView.y),cleverapps.audio.playSound(res.window_effect)},getButtons:function(){var e=cleverapps.styles.ConfirmExitWindow,t=new cleverapps.UI.Button({button_png:e.playButton.image,button_on_png:e.playButton.imageOn,text:Messages.get("PlayOn"),onClicked:function(){this.close()}.bind(this),width:e.button.width,height:e.button.height}),i=new cleverapps.UI.Button({button_png:e.exitButton.image?e.exitButton.image:res.red_button,
button_on_png:e.exitButton.image?e.exitButton.imageOn:res.red_button_on,text:Messages.get("Exit"),font:e.exitButton.font||cleverapps.styles.FONTS.BUTTON_TEXT,onClicked:function(){this.closeAnimationCallbacks.push(this.onAction),this.close()}.bind(this),width:e.button.width,height:e.button.height});return e.exitButton.scale&&(i.setScale(e.exitButton.scale),i.baseScale=i.scale),[i,t]},onClose:function(){this.returnOnClose&&this.returnOnClose()},listBundles:function(){return["confirmexit_window"]}});cleverapps.styles.ConfirmExitWindow={width:650,height:550,animation:{x:0,y:-10,json:bundles.confirmexit_window.jsons.sad_candy_spine_json,scale:1},text:{x:0,y:60,width:500},exitButton:{scale:.9},playButton:{},button:{width:300,height:100},breakView:{upAnimation:!0,y:0}};var NewLeagueWindow=Window.extend({onWindowLoaded:function(e){this.level=e,cleverapps.eventLogger.logEvent(cleverapps.EVENTS.NEW_LEAGUE);var t=cleverapps.styles.NewLeagueWindow;if(this.content=new cc.Node,
this.content.setAnchorPoint(.5,.5),this.content.setContentSize(t.width,t.height),this.addLeague(),this._super({title:"messages:NewLeagueWindow.Title",name:"newleaguewindow",content:this.content,closeButton:!1,buttons:this.getButtons(),shareCheckBox:this.getShareOptions()}),this.addChild(new Fireworks),cleverapps.audio.playSound(res.window_effect),t.hero){var i=new HeroView(t.hero);this.addChild(i)}},addLeague:function(){var e=cleverapps.styles.NewLeagueWindow,t=levels.user.league,i=cleverapps.UI.generateTTFText("messages:NewLeagueWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT,{league:Messages.get("League"+t)});i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setPositionRound(this.content.width/2,e.text.y),i.setDimensions(this.content.width,0),this.content.addChild(i)},getButtons:function(){var e=cleverapps.styles.NewLeagueWindow.button,t=[],i=new cleverapps.UI.Button({width:e.width,height:e.height,text:Messages.get("OK"),font:cleverapps.styles.FONTS.BUTTON_TEXT,
onClicked:this.close.bind(this)});if(t.push(i),this.level.isRegular())var s=ShareBonusButton.create({window:this,shareBonus:cleverapps.ShareBonus.SHARES.newLeague,toReplace:{leagueId:levels.user.league,leagueName:Messages.get("League"+levels.user.league)}});return s&&t.push(s),t},getShareOptions:function(){return{shareId:cleverapps.ShareBonus.SHARES.newLeague.id,toReplace:{leagueId:levels.user.league,leagueName:Messages.get("League"+levels.user.league)}}}});cleverapps.styles.NewLeagueWindow={width:550,height:500,button:{width:280,height:110,y:-50},text:{y:170},buttonsMargin:25,share:{width:280,height:110,Text:{offsetX:0,offsetY:25},RewardText:{offsetX:-15,offsetY:-15},RewardCoins:{scale:.5,offsetX:40,offsetY:-18}}};var LeadersLoading=cc.Node.extend({ctor:function(){this._super();var e=cleverapps.styles.WaitWindow,t=this.loading=new cleverapps.Spine(res.loading_json,1.5);t.setPosition(0,e.animation.y),t.setAnimation(0,"idle",!0);var i=this.loadingText=cleverapps.UI.generateTTFText(
Messages.get("Loading")||"Loading",cleverapps.styles.FONTS.WINDOW_TEXT);i.setPosition(0,e.text.y),this.addChild(t),this.addChild(i)},remove:function(){this.loading.runAction(new cc.RemoveSelf),this.loadingText.removeFromParent()}}),LeadersWindow=Window.extend({onWindowLoaded:function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEADERS_WINDOW_OPEN),this.content=new cc.Node,this.content.setAnchorPoint2(),this.content.setContentSize(cleverapps.styles.LeadersWindow.width,cleverapps.styles.LeadersWindow.height),this.generateWorldContent(),this.generateFriendsContent();var e=cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.Window,!0),cleverapps.styles.LeadersWindow.window);this._super.call(this,{name:"leaderswindow",content:this.content,title:{text:"messages:LeadersWindowTitle"},styles:e}),this.addButtons(),this.tabs.activateTab(LeadersWindow.TABS.GLOBAL),cleverapps.audio.playSound(res.window_effect)},addButtons:function(){var e=[LeadersWindow.TABS.GLOBAL]
;cleverapps.flags.nologin||e.push(LeadersWindow.TABS.FRIENDS),this.tabs=new Tabs(e,cleverapps.styles.LeadersWindow.tabs),this.window.addChild(this.tabs),this.tabs.onSelectTab=function(e){e===LeadersWindow.TABS.GLOBAL?this.selectWorld():e===LeadersWindow.TABS.FRIENDS&&this.selectFriends()}.bind(this)},addTableHead:function(e){var t=cleverapps.styles.LeadersWindow.table,i=new cc.Node;i.setContentSize2(cleverapps.styles.LeadersWindow.player.width,t.head.height),i.setAnchorPoint2(),i.setPositionRound(e.width/2,t.head.y),e.addChild(i);var s=cleverapps.UI.generateTTFText("messages:LeadersWindow.rank",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);s.setPositionRound(t.rank.x,i.height/2),i.addChild(s);var n=cleverapps.UI.generateTTFText("messages:LeadersWindow.player",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);n.setPositionRound(t.player.x,i.height/2),i.addChild(n);var o=cleverapps.UI.generateTTFText("messages:LeadersWindow.rating",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);o.setPositionRound(
t.rating.x,i.height/2),i.addChild(o)},selectWorld:function(){cleverapps.styles.LeadersWindow;this.worldContent.setVisible(!0),this.friendsContent.setVisible(!1),this.setTitle("messages:League"+this.currentLeague)},selectFriends:function(){cleverapps.styles.LeadersWindow;this.worldContent.setVisible(!1),this.friendsContent.setVisible(!0),this.setTitle("messages:FriendsTopName")},generateWorldContent:function(){var e=cleverapps.styles.LeadersWindow.worldContent;this.worldContent=new cc.Node,this.worldContent.setAnchorPoint2(),this.worldContent.setContentSize(e.width,e.height),this.worldContent.setPosition(this.content.width/2+e.left,this.content.height/2+e.top),this.content.addChild(this.worldContent),this.addTableHead(this.worldContent);var s=new LeadersLoading;s.setPosition(this.worldContent.width/2,this.worldContent.height/2),this.worldContent.addChild(s),s.setVisible(!1),s.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.CallFunc(function(){s.setVisible(!0)}))),
1<this.getAmountLeagues()&&(this.decLeagueButton=new cleverapps.UI.Button({button_png:e.arrow.image,button_on_png:e.arrow.image,onClicked:this.decLeague.bind(this),clickThrottle:1,onMouseOver:function(){this.decLeagueButton.setScale(-1.05,1.05)}.bind(this),onMouseOut:function(){this.decLeagueButton.setScale(-1,1)}.bind(this)}),this.decLeagueButton.setPosition(this.worldContent.width/2-e.arrow.x,this.worldContent.height+e.arrow.y),this.decLeagueButton.setScaleX(-1),this.decLeagueButton.setLocalZOrder(1),this.worldContent.addChild(this.decLeagueButton),this.incLeagueButton=new cleverapps.UI.Button({button_png:e.arrow.image,button_on_png:e.arrow.image,onClicked:this.incLeague.bind(this),clickThrottle:1}),this.incLeagueButton.setPosition(this.worldContent.width/2+e.arrow.x,this.worldContent.height+e.arrow.y),this.incLeagueButton.setLocalZOrder(1),this.worldContent.addChild(this.incLeagueButton)),this.currentLeague=levels.user.league,this.generateWorldHead(levels.user.league)
;var t=this.createListener(cleverapps.timeredThrottle(300,function(t){s.remove(),this.leaguesLeaders={};for(var i=0;i<t.length;i++)this.leaguesLeaders[t[i].leagueId]=JSON.parse(t[i].data),this.leaguesLeaders[t[i].leagueId].forEach(function(e){e.league=t[i].leagueId});for(i=0;i<this.getAmountLeagues();i++)this.leaguesLeaders[i]||(this.leaguesLeaders[i]=[]);this.generateWorldHead(levels.user.league),this.generateWorldLeague(levels.user.league)}.bind(this),Date.now())),i="/leaders/"+cleverapps.settings.language+"/";cleverapps.config.debugMode&&(i="https://wordsoup.labsystech.ru/wordsoup-rest"+i),cleverapps.RestClient.get(i,{},t,function(){cleverapps.Notification.create("messages:LeadersLoadFailed")})},decLeague:function(){0<this.currentLeague&&(this.currentLeague--,this.generateWorldHead(),this.generateWorldLeague(),this.updateTitle())},incLeague:function(){this.currentLeague<this.getAmountLeagues()-1&&(this.currentLeague++,this.generateWorldHead(),this.generateWorldLeague(),
this.updateTitle())},getAmountLeagues:function(){var e=1;return cleverapps.config.leagues&&(e=cleverapps.config.leagues.length),e},generateWorldHead:function(){this.decLeagueButton&&(this.decLeagueButton.visible=this.leaguesLeaders&&0<this.currentLeague),this.incLeagueButton&&(this.incLeagueButton.visible=this.leaguesLeaders&&this.currentLeague<this.getAmountLeagues()-1)},updateTitle:function(){this.window&&this.setTitle("messages:League"+this.currentLeague)},generateWorldLeague:function(){var e=this.currentLeague,t=this.leaguesLeaders[e];for(this.removePlayerFromTop(t),levels.user.league===e&&this.addPlayerToTop(t);t.length>LeadersWindow.TOP_LIMIT&&t[t.length-1].id!==levels.user.id;)t.pop();var i=function(){this.leagueTop&&(this.leagueTop.removeFromParent(),delete this.leagueTop)}.bind(this);i(),this.runAction(new cc.Sequence(new cc.DelayTime(.01),new cc.CallFunc(function(){e===this.currentLeague&&(i(),this.leagueTop=this.generateTop(t,this.worldContent),this.worldContent.addChild(
this.leagueTop))}.bind(this))))},removePlayerFromTop:function(e){for(var t=0;t<e.length;t++)if(e[t].id===levels.user.id){e.splice(t,1);break}},addPlayerToTop:function(e){e.push({id:levels.user.id,rating:levels.user.getHumanReadableNumber(),name:cleverapps.friends.getPlayer().name,avatar:cleverapps.friends.getPlayer().avatar,you:!0,league:levels.user.league}),e.sort(function(e,t){return e.rating===t.rating?e.id===levels.user.id?-1:t.id===levels.user.id?1:0:t.rating-e.rating})},generateTop:function(e,t){for(var i=[],s=0;s<e.length;s++){var n={text:e[s].name,place:s+1,id:e[s].id,avatar:{id:e[s].id,avatar:e[s].avatar},player:e[s].id===levels.user.id,amount:e[s].rating};i.push(n)}cleverapps.leadersWindowTable.resetResults("leadersWindow");var o=cleverapps.leadersWindowTable.createTableView({id:"leadersWindow",data:i,rowConstructor:cleverapps.LeadersRow,options:{styles:{width:cleverapps.styles.LeadersRow.size.width}}}),a=cleverapps.styles.LeadersWindow;return o.setPositionRound(a.table.x,
a.table.y,t),o},generateFriendsContent:function(){var e=cleverapps.styles.LeadersWindow.friendsContent;this.friendsContent=new cc.Node,this.friendsContent.setAnchorPoint2(),this.friendsContent.setContentSize(e.width,e.height),this.friendsContent.setPosition(this.content.width/2+e.left,this.content.height/2+e.top);var t=levels.progress.getLeaders();if(0<t.length){this.addPlayerToTop(t),this.addTableHead(this.friendsContent);var i=this.generateTop(t,this.friendsContent);this.friendsContent.addChild(i)}else{e=e.noFriends;var s=cleverapps.UI.generateTTFText("messages:noFriendsInLeadersText",cleverapps.styles.FONTS.WINDOW_TEXT);s.setPositionRound(this.friendsContent.width/2,this.friendsContent.height/2+e.Text.y),s.setDimensions(e.Text.width,e.Text.height),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.friendsContent.addChild(s);var n=new cleverapps.UI.Button({text:Messages.get("SettingsWindow.InviteFriends"),width:e.Button.width,height:e.Button.height,
font:cleverapps.styles.FONTS.BUTTON_TEXT,padding:e.Button.padding,onClicked:function(){cleverapps.social.inviteFriendsWindow(function(){}.bind(this))}.bind(this)});n.setPositionRound(this.friendsContent.width/2,this.friendsContent.height/2+e.Button.y),this.friendsContent.addChild(n)}this.content.addChild(this.friendsContent)}});LeadersWindow.TABS={},LeadersWindow.TABS.GLOBAL=0,LeadersWindow.TABS.FRIENDS=1,LeadersWindow.prototype.listBundles=function(){return"match3"===cleverapps.config.type?["game"]:[]},cleverapps.styles.LeadersWindow={width:524,height:770,player:{height:78,width:660,margin:20,name:{width:200,height:70},avatar:{scale:.8},place:{dy:0},rating:{dy:0}},head:{y:924},table:{x:{align:"center"},y:{align:"center"},head:{y:805,height:40},rank:{x:80},player:{x:300},rating:{x:550}},tabs:{0:{active:!0,icon:"global_icon",scale:.8},1:{active:!0,icon:"friends_icon",scale:.8}},friendsContent:{width:600,height:782,left:0,top:-100,noFriends:{Text:{y:100,width:400,height:200},Button:{
width:300,height:100,padding:{x:0},y:0}}},worldContent:{width:600,height:782,left:0,top:-100,arrow:{image:res.league_arrow_png,x:286,y:0}},window:{decors:{}}},LeadersWindow.TOP_LIMIT=100,cleverapps.Promotion=function(){cleverapps.config.debugMode&&(cleverapps.Promotion.SINCE_START="10 seconds");var e=this.load();this.createdTime=Date.now(),e?this.processed=e.processed:this.reset()},cleverapps.Promotion.prototype.reset=function(){this.processed=[],this.save()},cleverapps.Promotion.prototype.getFirstAvailable=function(){var i=cleverapps.User.calcSource(),s=void 0;return this.getPromotions().forEach(function(e,t){!s&&-1===this.processed.indexOf(e.id)&&e.sources[i]&&(s=e)},this),void 0!==s?s:0<this.processed.length?(this.processed=[],this.save(),this.getFirstAvailable()):void 0},cleverapps.Promotion.prototype.listAvailablePromotions=function(){return["differences","scramble","tripeaks","olympics","crocword","wordsoup","riddles","heroes","adventure","runes"].filter(function(e){
return e!==cleverapps.config.name&&cleverapps.projectLinks[e]})},cleverapps.Promotion.prototype.getPromotions=function(){var o={gameName:cleverapps.config.name};return this.listAvailablePromotions().map(function(e){var t="promotion_"+e+"_"+cleverapps.settings.language,i="promotion_"+e+"_"+cc.sys.LANGUAGE_ENGLISH,s={id:e,title:"messages:"+e+"PromoTitle",description:"messages:"+e+"Promo",bundleName:bundles[t]?t:i,sources:{}};for(var n in cleverapps.projectLinks[e])s.sources[n]=cleverapps.projectLinks[e][n],"facebook"===n&&(s.sources[n]+=Messages.replace("?channel=%{gameName}",o)),"android"===n&&(s.sources[n]+=Messages.replace("&utm_source=%{gameName}",o));return s})},cleverapps.Promotion.prototype.isReady=function(){return!!cleverapps.user.checkAvailable(cleverapps.Promotion.AVAILABLE)&&(!(this.createdTime+cleverapps.parseInterval(cleverapps.Promotion.SINCE_START)>=Date.now())&&void 0!==this.getFirstAvailable())},cleverapps.Promotion.prototype.setProcessed=function(e){
this.processed.push(e.id),this.save()},cleverapps.Promotion.prototype.load=function(){return cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PROMOTION)},cleverapps.Promotion.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PROMOTION,{processed:this.processed})},cleverapps.Promotion.ShowFirstAvailable=function(){var e=cleverapps.promotion.getFirstAvailable();new PromotionWindow(e)},cleverapps.Promotion.BONUS=10,cleverapps.Promotion.SINCE_START="10 seconds",cleverapps.Promotion.AVAILABLE={episode:1,level:10};var PromotionWindow=Window.extend({onWindowLoaded:function(e){this.promotion=e,cleverapps.eventLogger.logEvent("promo_show_"+this.promotion.id),cleverapps.promotion.setProcessed(this.promotion);var t=cleverapps.styles.PromotionWindow,i=new cc.Node;i.setAnchorPoint(.5,.5);var s=cleverapps.UI.generateTTFText(e.description,cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);s.setDimensions(t.text.width,0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),
i.addChild(s);var n=new cc.Sprite(bundles[e.bundleName].urls.image);i.addChild(n),cleverapps.UI.onClick(n,this.onPressed.bind(this)),cleverapps.UI.arrangeWithMargins(i.children,{margin:t.text.margin}),cleverapps.UI.wrap(i);var o=cleverapps.UI.wrapWithPadding(i,{x:0,y:t.margin});this._super({title:e.title,name:"promotionwindow",content:o,button:{width:t.Button.width,height:t.Button.height,content:this.getButtonContent(),onPressed:this.onPressed.bind(this)}}),cleverapps.audio.playSound(res.window_effect)},isRewardAvailable:function(){return!cleverapps.MobileVk.isAppropriate()},onPressed:function(){var e=cleverapps.User.calcSource(),t=this.promotion.sources[e];"instant"!==e?cc.sys.openURL(t):FBInstant.switchGameAsync(t),cleverapps.eventLogger.logEvent("promo_"+this.promotion.id),this.isRewardAvailable()&&(levels.user.setGold(levels.user.gold+cleverapps.Promotion.BONUS),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARD_RECEIVED,{amount:cleverapps.Promotion.BONUS})),this.close()},
getButtonContent:function(){var e=cleverapps.styles.PromotionWindow.Button,t=new cc.Sprite(bundles.menubar.frames.coin_png);t.setScale(e.scale),e.coinsOffsetY&&t.setPositionY(e.coinsOffsetY);var i=[];if(this.isRewardAvailable()){var s=cleverapps.UI.generateTTFText("+"+cleverapps.Promotion.BONUS,e.font),n=new cleverapps.Layout([s,t],{direction:cleverapps.UI.HORIZONTAL,margin:e.bottom.margin});i.push(n)}var o=cleverapps.UI.generateTTFText("messages:Play",e.font);i.push(o);var a=new cleverapps.Layout(i,{direction:cleverapps.UI.VERTICAL,margin:e.margin});return a.coin=t,a},listBundles:function(e){return[e.bundleName]}});cleverapps.styles.FONTS.PROMOTION_BUTTON_TEXT={size:55,color:cleverapps.styles.COLORS.WHITE},cleverapps.styles.PromotionWindow={margin:100,text:{width:620,margin:20},Button:{width:300,height:160,scale:.9,margin:0,bottom:{margin:10},font:cleverapps.styles.FONTS.PROMOTION_BUTTON_TEXT}};var Decors=function(i,s){if(s=s||{},this.styles=s,this.decors={},this.parent=i,
cleverapps.styles.Decorators){var e=Object.keys(s).filter(function(e){if(!0!==s[e])return!1;var t=cleverapps.styles.Decorators[e];if(!t)return!1;if(t.lovesBackground&&!i.withBg)return!1;if(t.fearHigh&&i.window&&.8<i.window.height*i.window.scale/cleverapps.styles.SCENE_HEIGHT)return!1;return!t.titleDecorator});this.init(e)}};Decors.prototype.add=function(e){var t=cleverapps.styles.Decorators[e];if(t){var i;switch(t.type){case Decors.TYPE_IMAGE:i=this.addImage(t);break;case Decors.TYPE_ANIMATION:i=this.addAnimation(t);break;case Decors.TYPE_SCALE9:i=this.addScale9(t)}if(i){var s=this.getPos(t);return this.getParent(t).addChild(i),i.setPositionRound(s.x,s.y),this.decors[e]=i}}},Decors.prototype.init=function(e){e.forEach(this.add,this)},Decors.prototype.initTitleDecorators=function(){var e=Object.keys(this.styles).filter(function(e){return!0===this.styles[e]&&cleverapps.styles.Decorators[e]&&cleverapps.styles.Decorators[e].titleDecorator}.bind(this));this.init(e)},
Decors.prototype.getDecorById=function(e){if(this.decors[e])return this.decors[e]},Decors.prototype.setVisible=function(e,t){var i=this.getDecorById(e);return!!i&&(t||i.stopAllActions(),i.setVisible(t),!0)},Decors.prototype.getParent=function(e){return e.titleDecorator?this.parent.titleBg:this.parent.window},Decors.prototype.addScale9=function(e){var t=cleverapps.UI.createScale9Sprite(res[e.image]||e.image);return t.setContentSize2(e.width,e.height),Array.isArray(e.scale)?t.setScale(e.scale[cleverapps.wideMode.mode]):t.setScale(e.scale),t.baseScale=t.scale,t.setLocalZOrder(e.zOrder),void 0!==e.rotation&&t.setRotation(e.rotation),t},Decors.prototype.addImage=function(e){var t=new cc.Sprite(res[e.image]||e.image),i=e.scale;return Array.isArray(i)&&(i=i[cleverapps.wideMode.mode]),"number"==typeof i?t.scale=i:(t.scaleX=i.x,t.scaleY=i.y),t.baseScale=Math.abs(t.scaleX),t.baseScaleX=t.scaleX,t.baseScaleY=t.scaleY,t.setLocalZOrder(e.zOrder),void 0!==e.rotation&&t.setRotation(e.rotation),t},
Decors.prototype.addAnimation=function(e){var t=res[e.json]||e.json,i=new cleverapps.Spine(t);e.scale&&(e.scale.x?i.setScale(e.scale.x,e.scale.y):i.setScale(e.scale));var s=void 0===e.looped||e.looped;return i.setLocalZOrder(e.zOrder),i.setVisible(!0),void 0!==e.delay?i.runAction(new cc.Sequence(new cc.DelayTime(e.delay),new cc.CallFunc(function(){i.setAnimation(0,e.animation,s)}))):i.setAnimation(0,e.animation,s),i},Decors.prototype.getPos=function(e){return e.position&&Array.isArray(e.position)?e.position[cleverapps.wideMode.mode]:cc.p(e.x,e.y)},Decors.prototype.updateAll=function(){for(var e in this.decors){var t=this.decors[e],i=cleverapps.styles.Decorators[e],s=this.getPos(i);t.setPositionRound(s.x,s.y)}},Decors.TYPE_IMAGE=0,Decors.TYPE_ANIMATION=1,Decors.TYPE_SCALE9=2;var RulesWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.overrideStyles(cleverapps.styles.RulesWindow,e.styles,!0),i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(t.animation.width,
t.animation.height);var s=new cleverapps.Spine(t.animation.json);s.setAnimation(0,t.animation.name,!0),s.setScale(t.animation.scale),s.setPositionRound(i.width/2+t.animation.x,i.height/2+t.animation.y),i.addChild(s);var n=t.font||cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,o=cleverapps.UI.generateTTFText(t.prefix+"text3",n);o.setDimensions(t.subText.width,0),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.addChild(o),o.setPositionRound(t.subText.left.x,t.subText.left.y);var a=cleverapps.UI.generateTTFText(t.prefix+"text4",n);a.setDimensions(t.subText.width,0),a.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.addChild(a),a.setPositionRound(t.subText.right.x,t.subText.right.y);var r=cleverapps.UI.generateTTFText(t.prefix+"text1",n);r.setDimensions(t.text.width,0),r.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.addChild(r),r.setPositionRound(t.subText.bottom.x,t.subText.bottom.y);var l=cleverapps.UI.generateTTFText(t.prefix+"text2",
cleverapps.styles.FONTS.RULES_WINDOW_TEXT||t.text.font);l.setDimensions(t.text.width,0),l.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),l.fitTo(void 0,t.text.height),l.setAnchorPoint2();var c=this.content=new cc.Node;c.addChild(l),c.addChild(i),cleverapps.UI.arrangeWithMargins(c.children,{margin:t.margin,y:t.paddingY}),cleverapps.UI.wrap(c),c.setAnchorPoint2(),this._super({title:t.prefix+"Title",name:e.name,content:c,button:{width:t.button.width,height:t.button.height,text:e.buttonText||Messages.get("OK"),onPressed:this.onPressed.bind(this)}})},onPressed:function(){this.close()},listBundles:function(e){return e&&e.bundles||[]}});cleverapps.styles.RulesWindow={width:600,height:800,margin:30,textMargin:30,paddingY:40,animation:{scale:.95,width:600,height:670,y:-85,x:0,name:"animation"},subText:{width:190,left:{x:{align:"left",dx:20},y:{align:"right",dy:-180}},right:{x:{align:"right",dx:55},y:{align:"right",dy:-220}},bottom:{x:{align:"center",dx:0},y:{align:"left",dy:0}}},text:{
width:640,height:300,font:cleverapps.styles.FONTS.WINDOW_TEXT},button:{width:250,height:100}};var BoostersSaleWindow=Window.extend({onWindowLoaded:function(e){this.mission=e,this.mission.logic.onRewardListener=this.createListener(this.giveReward.bind(this)),this._super({content:this.getContent(),title:{text:"messages:BoostersSaleWindow.title",font:cleverapps.styles.FONTS.BOOSTERS_SALE_WINDOW_TITLE_TEXT},name:"boosterssalewindow",windowBg:bundles.boosters_sale.frames.window_bg_png,styles:cleverapps.overrideStyles(cleverapps.styles.Window,this.getStyles().window,!0)}),this.addBadge(),this.addBalloons(),this.addRibbonTitle(),this.addProgressBar(),this.addRepeatablePattern(),this.addDescriptionText(),this.addHeroAnimation(),this.text.width>this.window.width&&this.text.setScale(this.window.width/this.text.width),cleverapps.audio.playSound(bundles.main.urls.sale_window_effect)},getStyles:function(){return cleverapps.styles.BoostersSaleWindow},createWinStreakBar:function(){
var e=cleverapps.styles.BoostersSaleWindow.progressBar,t=cleverapps.UI.createScale9Sprite(bundles.boosters_sale.frames.boosterssale_streak_bar_bg);t.setLocalZOrder(1),e.width&&t.setContentSize2(e.width,t.height);var i=this.winStreakBar=new ScaledProgressBar(bundles.boosters_sale.frames.boosterssale_streak_bar,e.bar.insets);if(i.setDimension(e.bar.width||t.width,e.bar.height||t.height),i.setAnchorPoint2(),i.setPosition(e.bar.x,e.bar.y),t.addChild(i),i.setLocalZOrder(e.bar.zOrder),e.bar.lines){var s=new cc.Sprite(bundles.boosters_sale.frames.boosterssale_streak_bar_line);s.setAnchorPoint2(),s.setPosition(t.width/2,t.height/2),t.addChild(s)}return t},updateBoughtAmountText:function(){this.boughtAmountText&&this.boughtAmountText.setString(this.mission.result+"/5")},addProgressBar:function(){var e=this.getStyles();this.progressBarText=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.progressBarText",
cleverapps.styles.FONTS.BOOSTERS_SALE_PROGRESS_BAR_TEXT||cleverapps.styles.FONTS.WHITE_TEXT),this.progressBarText.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.progressBarText.setDimensions(e.progressBar.text.width,0),this.progressBarText.fitTo(0,e.progressBar.text.height);var t=this.createWinStreakBar();this.winStreakBar.setPercentage(20*this.mission.result);var i=this.prizeNode=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(e.progressBar.prize),i.setScale(e.progressBar.prize.scale);var s=this.prizeAnimation=new cleverapps.Spine(e.progressBar.prize.animation.json);s.setAnimation(0,"green_idle_closed",!0),i.addChild(s),s.setPositionRound(e.progressBar.prize),cleverapps.tooltipManager.create(i,{rewards:this.mission.prize,text:Messages.get("TreasureSearch.prizeTooltip"),size:e.tooltip.size,position:e.tooltip});var n=new cleverapps.Layout([t,this.progressBarText],{direction:cleverapps.UI.VERTICAL,margin:e.progressBar.textMargin});if(e.progressBar.amount){
var o=this.boughtAmountText=cleverapps.UI.generateTTFText(this.mission.result+"/5",cleverapps.styles.FONTS.BOOSTERS_SALE_PROGRESS_BAR_AMOUNT_TEXT||cleverapps.styles.FONTS.WHITE_TEXT);t.addChild(o),o.setPositionRound(e.progressBar.amount)}var a=new cleverapps.Layout([n,i],{direction:cleverapps.UI.HORIZONTAL,margin:e.progressBar.prizeMargin});this.progressBarLayout=a,this.window.addChild(a);var r=e.progressBar.insideWindow?1:-1;a.setPositionRound({x:{align:"center",dx:e.progressBar.dx},y:{align:"bottom",dy:r*(a.height/2+e.progressBar.marginY)}}),e.progressBar.scale&&a.setScale(e.progressBar.scale[cleverapps.wideMode.mode])},addRibbonTitle:function(){var e=this.getStyles().title;if(e.ribbonTitle){var t=cleverapps.UI.createScale9Sprite(bundles.main.frames.ribbon,cleverapps.UI.Scale9Rect.TwoPixelXY);this.window.addChild(t),t.setAnchorPoint2();var i=e.ribbonTitle.width;this.window.titleText.width+2*e.ribbonTitle.offsetX>i&&(i=this.window.titleText.width+2*e.ribbonTitle.offsetX),
t.setContentSize2(i,e.ribbonTitle.height),t.setPositionRound(this.window.titleText.x,this.window.titleText.y+e.ribbonTitle.y),t.setLocalZOrder(this.window.titleText.getLocalZOrder()-1)}},addBadge:function(){var e=this.getStyles().badge;if(e){var t=new cc.Sprite(bundles.boosters_sale.frames.badge_png),i=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.badge.text",cleverapps.styles.FONTS.TILE_SHOP_BADGE_TEXT),s=cleverapps.UI.generateTTFText("90%",cleverapps.styles.FONTS.TILE_SHOP_BADGE_TEXT);t.setScale(e.scale),s.setScale(1.2);var n=new cleverapps.Layout([s,i],{direction:cleverapps.UI.VERTICAL,margin:e.margin});n.setRotation(e.rotation),t.addChild(n),n.setPositionRound(t.width/2,t.height/2),this.window.addChild(t),t.setPositionRound(e),t.setLocalZOrder(10)}},addBalloons:function(){this.getStyles().balloons.forEach(function(e){var t=new cleverapps.Spine(bundles.boosters_sale.jsons.balloon_json);t.setScaleX(e.scale),t.setAnimation(0,"animation",!0),this.window.addChild(t),
t.setPositionRound(this.window.width/2+e.x,this.window.height+e.y),t.setLocalZOrder(-1)}.bind(this))},addRepeatablePattern:function(){},addDescriptionText:function(){var e=cleverapps.styles.BoostersSaleWindow,t=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.descriptionText",cleverapps.styles.FONTS.BOOSTERS_SALE_DESCRIPTION_TEXT||cleverapps.styles.FONTS.WHITE_TEXT,{purchasesCount:BoostersSaleWindow.PURCHASES_TO_PRIZE});t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setDimensions(e.progressBar.descriptionText.width[cleverapps.wideMode.mode]*resolutionScale,0),t.fitTo(void 0,e.progressBar.descriptionText.height),e.progressBar.insideWindow?this.window.addChild(t):this.progressBarLayout.addChild(t),t.setPositionRound({x:{align:"center"},y:{align:"bottom",dy:-t.height/2-e.progressBar.descriptionText.marginY}})},addHeroAnimation:function(){var e=cleverapps.styles.BoostersSaleWindow;if(e.heroAnimation){var t="idle";"tripeaks"===cleverapps.config.name&&(t="starterpack_800")
;var i=new cleverapps.Spine(bundles.main.jsons.hero_json);i.setAnimation(0,t,!0),i.setPositionRound(e.heroAnimation.position[cleverapps.wideMode.mode]),i.setScale(e.heroAnimation.scale[cleverapps.wideMode.mode]),this.addChild(i)}},calcOldPrice:function(e){return cleverapps.payments.calcLoadedPrice?cleverapps.payments.calcLoadedPrice(e):Product.CURRENCY+" "+e},createIconsLayout:function(e){for(var t=bundles.boosters_sale.frames[e.icon]||bundles.reward_icons.frames[e.icon]||bundles.tile_shop.frames[e.icon]||res[e.icon],i=this.getStyles(),s=[],n=0;n<5;n++){var o=new cc.Node;o.setAnchorPoint2(),o.setContentSize2(i.icons);var a=new cc.Sprite(t);o.addChild(a),a.setRotation(i.icons.rotation),a.setScale(Math.min(o.width/a.width,o.height/a.height)),a.setLocalZOrder(-n),a.setPositionRound(o.width/2,o.height/2),s.push(o)}return new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL,margin:i.icons.margins[cleverapps.wideMode.mode].margin})},getContent:function(){var y=this.getStyles(),w=[]
;this.mission.logic.listProducts(this.mission).forEach(function(e){var t,i=new Product(e),s=this.createIconsLayout(i);if(-1!==["cellPack2","linePack3","colorPack4"].indexOf(e)){var n;(n=new cc.Node).setAnchorPoint2();var o=s.width/10,a=s.height/3;n.setContentSize2(s.width+o,s.height+a/3);var r=this.createIconsLayout(i);s.setPositionRound(n.width/2+o/2,n.height/2+a/2),r.setPositionRound(n.width/2-o/2,n.height/2-a/2),n.addChild(s),n.addChild(r)}else n=s;y.icons.bg?(t=new cc.Scale9Sprite(y.icons.bg),y.icons.bgColor&&t.setColor(y.icons.bgColor)):(t=new cc.Node).setAnchorPoint2(),t.setContentSize2(n.width+2*y.icons.padding.x,n.height+2*y.icons.padding.y),t.addChild(n);var l=y.icons.offset;y.icons.offsetByType[this.mission.type]&&(l=y.icons.offsetByType[this.mission.type]),n.setPositionRound(t.width/2+l.x,t.height/2+l.y);var c=cleverapps.UI.generateTTFText(i.label,cleverapps.styles.FONTS.BOOSTERS_SALE_AMOUNT_TEXT);if(y.labelBg){var p=new cc.Scale9Sprite(
bundles.boosters_sale.frames.label_bg_png);p.setContentSize2(c.width+2*y.labelBg.padding.x,c.height+2*y.labelBg.padding.y),p.addChild(c),t.addChild(p),c.setPositionRound(p.width/2,p.height/2+y.labelBg.text.dy),p.setPositionRound(y.label)}else t.addChild(c),c.setPositionRound(y.label);var d=cleverapps.UI.generateTTFText(Messages.get("BoostersSaleWindow.oldPrice"),cleverapps.styles.FONTS.BOOSTERS_SALE_PRICE_TEXT);d.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),d.fitTo(y.oldPriceText.width);var h=cleverapps.UI.generateTTFText(this.calcOldPrice(i.oldPrice),cleverapps.styles.FONTS.BOOSTERS_SALE_TEXT);h.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),h.fitTo(y.oldPriceText.price.width);var u=new cleverapps.Layout([d,h],{direction:cleverapps.UI.HORIZONTAL,margin:y.oldPriceText.margin});d.setPositionRound({y:{align:"bottom"},x:d.x});var v=new cleverapps.UI.Button({content:new ProductPriceView(i,{
font:cleverapps.styles.FONTS.BOOSTERS_SALE_WINDOW_BUTTON_TEXT||cleverapps.styles.FONTS.BUTTON_TEXT}),onClicked:function(){this.mission.completed||i.buy(function(){this.mission.update(1),this.winStreakBar.setPercentage(20*this.mission.result),this.updateBoughtAmountText()}.bind(this))}.bind(this),width:y.button.width,height:y.button.height,button_on_png:res.small_green_button_on,button_png:res.small_green_button});Lottery.addIcon(v);var g=new cleverapps.Layout([v,u],{direction:cleverapps.UI.VERTICAL,margin:y.button.margin,y:y.button.y}),m=new cleverapps.Layout([t,g],{direction:cleverapps.UI.HORIZONTAL,margin:y.colMargin,padding:y.row.padding[cleverapps.wideMode.mode]}),f=new cc.Scale9Sprite(bundles.boosters_sale.frames.row_bg_png||y.row.bg);if(f.setContentSize2(m.getContentSize()),y.row.innerBg){var _=new cc.Scale9Sprite(y.row.innerBg.image);_.setContentSize2(f.width-2*y.row.innerBg.padding.x,f.height-2*y.row.innerBg.padding.y),f.addChild(_),_.setPositionRound(f.width/2,f.height/2)}
f.addChild(m),m.setPositionRound(f.width/2,f.height/2),w.push(f)}.bind(this));var t=0;w.forEach(function(e){t=Math.max(t,e.getContentSize().width)}),w.forEach(function(e){e.setContentSize2(t,e.getContentSize().height)});var e=this.createText(),i=new cleverapps.Layout(w,{direction:cleverapps.UI.VERTICAL,margin:y.rowMargin});return new cleverapps.Layout([i,e],{direction:cleverapps.UI.VERTICAL,margin:y.margin})},openRewardWindow:function(){new RewardWindow({reward:this.mission.logic.reward})},giveReward:function(){this.winStreakBar.animatedChange(20),this.updateBoughtAmountText(),this.prizeAnimation.setCompleteListener(this.close.bind(this)),this.prizeAnimation.setAnimation(0,"green_open",!1),this.prizeNode.setLocalZOrder(20),this.prizeNode.replaceParentSamePlace(this);var e=this.prizeNode.getPosition(),t=cc.p(this.width/2,this.height/2),i=cc.p((e.x+t.x)/2,2*(t.y-e.y));this.prizeNode.runAction(new cc.BezierTo(.5,[e,i,t]))},onClose:function(){
this.mission.logic.reward&&this.openRewardWindow()},createText:function(){var e=this.getStyles(),t=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.textTop",cleverapps.styles.FONTS.BOOSTERS_SALE_TOP_TEXT);t.setDimensions(e.textTop.width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var i=[];if(Messages.has("messages:BoostersSaleWindow.textLeft."+this.mission.type)){var s=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.textLeft."+this.mission.type,cleverapps.styles.FONTS.BOOSTERS_SALE_TOP_TEXT);i.push(s)}var n=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.textMiddle."+this.mission.type,cleverapps.styles.FONTS.BOOSTERS_SALE_TOP_RED_TEXT);i.push(n);var o=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.textRight."+this.mission.type,cleverapps.styles.FONTS.BOOSTERS_SALE_TOP_TEXT);i.push(o);var a=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:e.text.bottomMargin});return this.text=new cleverapps.Layout([a,t],{
direction:cleverapps.UI.VERTICAL,margin:e.text.margin})}});BoostersSaleWindow.prototype.listBundles=function(){return["boosters_sale","reward_icons","tile_shop"]},BoostersSaleWindow.PURCHASES_TO_PRIZE=5,cleverapps.overrideFonts(cleverapps.styles.FONTS,{BOOSTERS_SALE_TEXT:{size:45,color:cleverapps.styles.COLORS.BOOSTERS_SALE_TEXT_COLOR},BOOSTERS_SALE_TOP_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE},BOOSTERS_SALE_TOP_RED_TEXT:{size:50,color:cleverapps.styles.COLORS.COLOR_RED},BOOSTERS_SALE_PRICE_TEXT:{size:45,color:cleverapps.styles.COLORS.BOOSTERS_SALE_TEXT_COLOR},BOOSTERS_SALE_AMOUNT_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.BoostersSaleWindow={progressBar:{bar:{x:0,y:0,zOrder:0,interval:67,lines:!0},dx:0,marginY:-21,prizeMargin:-40,textMargin:30,text:{width:400,height:50},prize:{width:100,height:100,x:50,y:30,scale:1.5,animation:{json:bundles.boosters_sale.jsons.prize_json}},descriptionText:{width:[390,600,600],height:90,marginY:50}},tooltip:{
rewards:{x:{align:"center",dx:-20},y:{align:"top",dy:60}},size:{width:220,height:100}},button:{width:240,height:90,margin:10,y:0},title:{ribbonTitle:{width:620,height:120,y:-10,offsetX:40,scaleY:1.3}},icons:{x:-15,width:120,height:120,rotation:0,bg:bundles.boosters_sale.frames.product_bg_png,bgColor:cleverapps.styles.COLORS.COLOR_VERYLIGHTBROWN,margins:[{margin:-80},{margin:-50},{margin:-50}],offset:{x:0,y:0},offsetByType:{12:{x:0,y:20}},padding:{x:5,y:25}},label:{x:{align:"right",dx:-5},y:{align:"bottom",dy:5}},amount:{margin:-30},text:{margin:10,bottomMargin:8},textTop:{width:700},oldPriceText:{width:255,margin:8,price:{width:135}},badge:{x:{align:"left",dx:5},y:{align:"top",dy:100},rotation:-20,margin:-10,scale:1},row:{bg:bundles.boosters_sale.frames.row_bg_png,padding:[{x:20,y:30},{x:30,y:30},{x:30,y:30}]},rowMargin:20,colMargin:20,margin:10,balloons:[{y:-165,x:-250,scale:-1},{y:-165,x:250,scale:1}],window:{contentOffset:-30,noBackground:{keepSize:!0},bgOffset:{y:20,x:0}}}
;var FavoriteSaleWindow=Window.extend({onWindowLoaded:function(e){this.mission=e;var t=this.getStyles();this._super({content:this.getContent(),title:this.getTitle(),name:"favoritesalewindow",button:{width:t.button.width,height:t.button.height,button_png:t.button.button_png,button_on_png:t.button.button_on_png,content:new ProductPriceView(this.mission.logic.product,{font:cleverapps.styles.FONTS.FAVORITE_SALE_WINDOW_BUTTON_TEXT||cleverapps.styles.FONTS.BUTTON_TEXT}),onPressed:this.buyProduct.bind(this)},styles:cleverapps.overrideStyles(cleverapps.styles.Window,this.getStyles().window,!0)}),this.addBottomAnimation();var i=this.window.scaleX*this.window.width/(this.content.scaleX*this.content.width+t.content.paddingX);i<1&&(this.content.setScaleX(this.content.getScaleX()*i),this.content.setScaleY(this.content.getScaleY()*i)),this.addRibbonTitle(),this.addHeroAnimation(),Lottery.addIcon(this.button),cleverapps.audio.playSound(bundles.main.urls.sale_window_effect)},addHeroAnimation:function(
){var e=cleverapps.styles.FavoriteSaleWindow;if(e.heroAnimation){var t=new cleverapps.Spine(bundles.main.jsons.hero_json);t.setAnimation(0,"idle",!0),t.setPositionRound(e.heroAnimation.position[cleverapps.wideMode.mode]),t.setScale(e.heroAnimation.scale[cleverapps.wideMode.mode]),this.addChild(t)}},addRibbonTitle:function(){var e=this.getStyles();if(e.title.ribbonTitle){var t=cleverapps.UI.createScale9Sprite(bundles.main.frames.ribbon,cleverapps.UI.Scale9Rect.TwoPixelXY);this.window.addChild(t),t.setAnchorPoint2(),t.setContentSize2(e.title.ribbonTitle),t.setPositionRound(this.window.titleText.x,this.window.titleText.y+e.title.ribbonTitle.y),t.setLocalZOrder(this.window.titleText.getLocalZOrder()-1)}},getStyles:function(){return cleverapps.styles.FavoriteSaleWindow},getTitle:function(){return{text:"messages:FavoriteSaleWindow.title",font:cleverapps.styles.FONTS.FAVORITE_SALE_WINDOW_TITLE_TEXT}},buyProduct:function(){this.mission.logic.product.buy(function(){new RewardWindow({
reward:this.mission.logic.getReward()}),this.close()}.bind(this))},createRewardsList:function(){var o=this.getStyles(),a=[],e=this.mission.logic.getReward(),t=function(e,t){var i=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.FAVORITE_SALE_WINDOW_REWARDS_TEXT),s=new cc.Sprite(o.rewards.icons[e]);s.setScale(o.rewards.iconHeight/s.height);var n=[i,s];o.rewards.reverse&&n.reverse(),a.unshift(new cleverapps.Layout(n,{margin:o.rewards.textMargin,direction:o.rewards.direction}))};for(var i in e)if("unlimitedLives"===i)t(i,Product.FormatUnlimitedLives(e[i]).title);else if("boosters"===i)for(var s in e[i])t(s,"x"+e[i][s]);else t(i,e[i]);return new cleverapps.Layout(a,{margin:o.rewards.margin,direction:cleverapps.UI.VERTICAL})},addBottomAnimation:function(){var e=this.getStyles();if(e.bottom){var t=new cleverapps.Spine(e.bottom.json);t.setAnimation(0,e.bottom.animation,!0);var i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(e.bottom),i.addChild(t),t.setPositionRound(
i.width/2+e.bottom.x,i.height/2+e.bottom.y),i.setScale(e.bottom.scale);var s=this.createInfoText(),n=new cc.Scale9Sprite(e.bottom.image);n.setContentSize(s.width+2*e.bottom.text.padding.x,s.height+2*e.bottom.text.padding.y),n.addChild(s),s.setPositionRound(n.width/2+e.bubble.offset.x,n.height/2+e.bubble.offset.y);var o=new cleverapps.Layout([i,n],{direction:cleverapps.UI.HORIZONTAL,margin:e.bottom.margin});this.window.addChild(o),o.setPositionRound(this.window.width/2+e.bottom.offset.x,-o.height/2+e.bottom.offset.y)}},createInfoText:function(){var e=this.getStyles(),t=cleverapps.UI.generateTTFText("messages:FavoriteSaleWindow.text",cleverapps.styles.FONTS.FAVORITE_SALE_WINDOW_BOTTOM_TEXT);return t.setDimensions(e.bottom.text.width,0),t.fitTo(void 0,e.bottom.text.height),t},addBadge:function(){var e=this.getStyles().badge;if(e){var t=new cc.Sprite(bundles.tile_shop.frames.shop_badge_bestseller_png),i=Messages.get("messages:FavoriteSaleWindow.badge1")+"\n"+Messages.get(
"messages:FavoriteSaleWindow.badge2");this.content.addChild(t),t.setPositionRound(e),t.setScale(e.scale[cleverapps.wideMode.mode]),t.setRotation(e.rotation),cc.sys.isMobile&&e.mobile&&(t.setRotation(e.mobile.rotation),t.setPositionRound(t.getPositionX()+e.mobile.dx,t.getPositionY()+e.mobile.dy));var s=cleverapps.UI.generateTTFText(i,cleverapps.styles.FONTS.TILE_SHOP_BADGE_TEXT);t.addChild(s),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setPositionRound(e.text),s.fitTo(e.text.width),e.text.rotation&&s.setRotation(e.text.rotation),cc.sys.isMobile&&e.mobile&&e.mobile.text&&(s.setRotation(e.mobile.text.rotation),s.setScale(e.mobile.text.scale))}},getContent:function(){var e,t=this.getStyles();this.mission.logic.isPackProduct()?(e=new PackProductTile(this.mission.logic.product,{noButton:!0,noTitle:!0,size:t.packTile.size})).setScale(t.packTile.scale):e=new CoinsProductTile(this.mission.logic.product,{noButton:!0,small:!0,rewardsBlockNoBg:t.rewardsBlockNoBg,
styles:cleverapps.overrideStyles(cleverapps.styles.CoinsProductSmallTile,{offset:{y:void 0===t.tile.offsetY?cleverapps.styles.CoinsProductSmallTile.offset.y:t.tile.offsetY}},!0)}),this.tile=e;var i=this.rewardsList=this.createRewardsList(),s=new cc.Sprite(bundles.favorite_sale.frames.plus_png);s.setScale(t.plus.scale);var n,o=this.content=new cleverapps.Layout([e,s,i],{margin:t.tilesMargin,direction:cleverapps.UI.HORIZONTAL});t.icon.light&&(t.icon.light.image?(n=new cc.Sprite(t.icon.light.image)).setScale(t.icon.light.scale):(n=new cleverapps.Spine(t.icon.light.json,t.icon.light.scale)).setAnimation(0,t.icon.light.animationName,"true"),this.content.addChild(n),n.setPositionRound(i.x+t.icon.light.offset.x,i.y+t.icon.light.offset.y),n.setLocalZOrder(-1));return this.timerLayout=this.createTimer(),o=new cleverapps.Layout([o,this.timerLayout],{direction:cleverapps.UI.VERTICAL,margin:t.margin}),this.addBadge(),o},createTimer:function(){var e=this.mission.finishTime()-Date.now()
;this.finished&&(e=0);var t=this.getStyles().timer,i={background_content:!1,font:cleverapps.styles.FONTS.FAVORITE_SALE_TIMER_TEXT||cleverapps.styles.FONTS.WHITE_TEXT},s=new cleverapps.CountDownView(new cleverapps.CountDown(e,{onFinish:function(){this.finished||(this.finished=!0,cleverapps.missionManager.remove(this.mission),this.runAsync(this.addLastChance.bind(this)))}.bind(this)}),i),n=[cleverapps.UI.generateTTFText(this.finished?"messages:FavoriteSaleWindow.lastChance":"messages:FavoriteSaleWindow.Expires",cleverapps.styles.FONTS.FAVORITE_SALE_TIMER_TEXT||cleverapps.styles.FONTS.WHITE_TEXT),s],o=new cleverapps.Layout(n,{margin:t.margin,direction:cleverapps.UI.HORIZONTAL}),a=this.timerBg=new cc.Scale9Sprite(bundles.favorite_sale.frames.timer_bg_png||bundles.main.frames.timer_bg_png);return a.setContentSize2(o.width+2*t.padding.x,o.height+2*t.padding.y),o.addChild(a),a.setLocalZOrder(-1),a.setPositionRound(o.width/2,o.height/2),o},addLastChance:function(){
var e=this.timerLayout.getPosition(),t=this.timerLayout.getParent();this.timerLayout.removeFromParent(!0),this.timerLayout=this.createTimer(),t.addChild(this.timerLayout),this.timerLayout.setPositionRound(e)},listBundles:function(){return["reward_icons","tile_shop","favorite_sale","dialogues","shop_user_gold_view"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{FAVORITE_SALE_WINDOW_BOTTOM_TEXT:{size:40,color:new cc.Color(130,70,40,255)},FAVORITE_SALE_WINDOW_REWARDS_TEXT:{size:40,color:new cc.Color(130,70,40,255)}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{FAVORITE_SALE_WINDOW_TITLE_TEXT:cleverapps.styles.FONTS.WINDOW_TITLE_TEXT}),cleverapps.styles.FavoriteSaleWindow={plus:{scale:1},tilesMargin:3,margin:20,button:{width:280,height:100},timer:{margin:15,scaleWithRewards:!0,padding:{x:10,y:5}},packTile:{scale:.9},icon:{scale:1.3,light:{json:bundles.favorite_sale.jsons.story_light_animation_json,animationName:"animation",scale:3.2,offset:{x:0,y:-20}}},bottom:{
image:res.tutorial_text_bg_png,margin:20,width:300,height:260,offset:{x:-50,y:0},x:0,y:0,scale:1,json:bundles.dialogues.jsons.default_json,animation:"animation",text:{padding:{x:30,y:15},width:350,height:250}},bubble:{offset:{x:20,y:0}},rewards:{margin:40,textMargin:2,iconHeight:90,icons:{unlimitedLives:bundles.reward_icons.frames.life_unlim,exp:bundles.reward_icons.frames.reward_exp_png,stars:bundles.reward_icons.frames.stars_png,gold:bundles.tile_shop.frames.shop_gold4_png,0:bundles.reward_icons.frames.cellbooster,1:bundles.reward_icons.frames.linebooster,2:bundles.reward_icons.frames.colorbooster,3:bundles.reward_icons.frames.coin_png,4:bundles.reward_icons.frames.joker_png,5:bundles.reward_icons.frames.coin_png,6:bundles.reward_icons.frames.coin_png,7:bundles.reward_icons.frames.coin_png,8:bundles.reward_icons.frames.hat,9:bundles.reward_icons.frames.pot,10:bundles.reward_icons.frames.magnet_small_png,11:bundles.reward_icons.frames.dice_small_png,
12:bundles.reward_icons.frames.joker_small_png,13:bundles.reward_icons.frames.highlight,14:bundles.reward_icons.frames.eye,15:bundles.reward_icons.frames.hint},direction:cleverapps.UI.HORIZONTAL},badge:{text:{width:120,height:120,x:{align:"center",dx:0},y:{align:"center",dy:0}},x:{align:"right",dx:60},y:{align:"center",dy:-220},scale:[.9,1.2,1.2],rotation:15},content:{paddingX:80},title:{},window:{bgOffset:{y:90,x:0},Border:{y:170},contentOffset:0},tile:{offsetY:void 0}},cleverapps.FBLike={prepareCode:function(e){var t=cleverapps.config.facebook.url,i=cleverapps.config.helpURL.default,s=cleverapps.config.title,
n='<div id=\'social\'>  <div class="fb-page" data-href="%{GROUP_LINK}" data-width="%{WIDTH}" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="%{GROUP_LINK}" class="fb-xfbml-parse-ignore"><a href="%{GROUP_LINK}">%{TITLE} Community</a></blockquote></div>  <br/>\n  <div class="fb-like" \n    data-href="%{LINK}" \n    data-layout="standard" \n    data-action="like" \n    data-show-faces="true">\n  </div></div>'.replace("%{LINK}",t);return n=(n=(n=(n=(n=n.replace("%{TITLE}",s)).replace("%{GROUP_LINK}",i)).replace("%{GROUP_LINK}",i)).replace("%{GROUP_LINK}",i)).replace("%{WIDTH}",e)},prepareCodeOK:function(){return'<div id=\'social\'>  <div class="fb-page" id="groupWidget"></div>  <br/>\n  <div id="likeWidget"></div></div>'},processCode:function(){"undefined"!=typeof FB&&FB.XFBML.parse(document.getElementById("social"))},onResize:function(){var e=document.getElementById("RightBg"),t="block";parseInt(e.style.width
)<260&&(t="none"),document.getElementById("social").style.display=t},processCodeOK:function(i){cleverapps.loadSdk("//connect.ok.ru/connect.js",function(){var e=cleverapps.config.web_ok.url,t=cleverapps.config.helpURL.web_ok.match(/group\/(.*)/)[1];OK.CONNECT.insertGroupWidget("groupWidget",t,"{width:"+i+", height:335}"),OK.CONNECT.insertShareWidget("likeWidget",e,"{width:"+i+",height:100,st:'oval',sz:30,ck:1}")},function(){console.log("Can't load ok sdk for widget!")},3)},isAppropriate:function(){return-1!==["facebook","web_ok"].indexOf(cleverapps.User.calcSource())},createLikeButtons:function(){if(cleverapps.FBLike.isAppropriate()&&"undefined"!=typeof document){var e=document.getElementById("RightBg");if(!e)return;var t=parseInt(e.style.width),i=t<260;t=260,(cleverapps.isLocalhost()||"web_ok"===cleverapps.User.calcSource())&&cleverapps.config.web_ok&&cleverapps.config.web_ok.url&&cleverapps.config.helpURL&&cleverapps.config.helpURL.web_ok&&(
cleverapps.FBLike.prepareCode=cleverapps.FBLike.prepareCodeOK,cleverapps.FBLike.processCode=cleverapps.FBLike.processCodeOK),e.insertAdjacentHTML("afterbegin",cleverapps.FBLike.prepareCode(t)),cleverapps.FBLike.processCode(t),i&&(document.getElementById("social").style.display="none"),cleverapps.afterResolutionChanged(cleverapps.FBLike.onResize)}}},cleverapps.NativeLinks={onResize:function(){var e=document.getElementById("LeftBg"),t="block";parseInt(e.style.width)<250&&(t="none"),document.getElementsByClassName("store-links")[0].style.display=t},createLinks:function(){if(cleverapps.NativeLinks.isAppropriate()){var s=bundles.store_links,e=["amazon","android","ios"].map(function(e){var t={android:s.urls.android_png,ios:s.urls.ios_png,amazon:s.urls.amazon_png}[e],i=cleverapps.config[e]&&cleverapps.config[e].url;if(i&&t)return{link:i,image:t}}).filter(function(e){return void 0!==e}),t=document.getElementById("LeftBg"),i=0;t&&t.style&&t.style.width&&(i=parseInt(t.style.width)),
0<document.getElementsByClassName("store-links").length||(t.insertAdjacentHTML("afterbegin",'<div class="store-links" />'),p=document.getElementsByClassName("store-links")[0],e.forEach(function(e){var t='<a target="_blank" href="%{LINK}">   <img src="%{IMAGE}"/ width=\'246px\' height=\'72px\'></a>'.replace("%{LINK}",e.link);t=t.replace("%{IMAGE}",e.image),p.insertAdjacentHTML("afterbegin",t)}),i<250&&(document.getElementsByClassName("store-links")[0].style.display="none"),cleverapps.afterResolutionChanged(cleverapps.NativeLinks.onResize))}},isAppropriate:function(){return!cc.sys.isMobile&&!cleverapps.screenshotsMode&&-1===["web_mm","mobile_mm","web_ok","mobile_ok","web_vk","mobile_vk","huzcom","plinga","pliega"].indexOf(cleverapps.User.calcSource())}};var FriendView=cc.Node.extend({ctor:function(e,t){this._super(),this.setAnchorPoint(.5,.5),"invite"===e.type&&(e.avatar=res.avatar_invite_friend);var i=cleverapps.styles.FriendView;this.setContentSize2(i.width,i.height);var s,
n=new cleverapps.UI.Avatar(e);n.setPositionRound(this.width/2,this.height-n.height/2-i.avatar.y),n.setScale(i.avatar.scale),n.baseScale=n.scale,n.setAnchorPoint2(),this.addChild(n),"invite"===e.type?((s=this.score=new cleverapps.UI.Button({button_png:res.small_blue_button,button_on_png:res.small_blue_button_on,text:Messages.get("LevelStartWindow.Button.Invite"),font:cleverapps.styles.FONTS.HIGHSCORE_INVITE_TEXT,width:i.invite.button.width,height:i.invite.button.height,onClicked:this.inviteFriend.bind(this)})).setCascadeOpacityEnabled(!0),cleverapps.UI.applyHover(n),cleverapps.UI.onClick(n,this.inviteFriend.bind(this))):(s=this.score=cleverapps.UI.generateTTFText(e.score,cleverapps.styles.FONTS.WINDOW_LIGHT_TEXT)).setAnchorPoint2(.5,.5),s.setPositionRound(this.width/2,i.score.y),this.addChild(s),t<3&&"invite"!==e.type&&(this.cup=new cc.Sprite(res["levelstart_cup_"+(t+1)]),this.cup.setLocalZOrder(1),n.addChild(this.cup),this.cup.setPositionRound(i.cup.x,i.cup.y)),setTimeout(function(){
this.showAnimation(t)}.bind(this),0)},inviteFriend:function(){cleverapps.history.add("invt",1),cleverapps.social.inviteFriends({message:Messages.get("SettingsWindow.InviteFriends.message"),title:Messages.get("SettingsWindow.InviteFriends.title"),element:this},function(e){e===cleverapps.Social.CODE_SUCCEED&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HIGHSCORE_INVITE)}.bind(this))},showAnimation:function(e){var t=.5-.1*e,i=function(e){e.scale=0,e.opacity=0,e.runAction(new cc.Sequence(new cc.DelayTime(t+6*.1),new cc.Spawn(new cc.ScaleTo(.2,1).easing(cc.easeBackOut()),new cc.FadeIn(.2))))};this.cup&&i(this.cup),i(this.score),this.scale=0,this.runAction(new cc.Sequence(new cc.DelayTime(t+.2),new cc.ScaleTo(.2,1)))}});cleverapps.styles.FriendView={avatar:{margin:{x:10},scale:.8,y:4},score:{margin:{x:120},y:150},cup:{x:{align:"right",dx:34},y:{align:"bottom",dy:-6}},invite:{button:{width:100,height:46}},width:100,height:290};var HeroView=cleverapps.Spine.extend({ctor:function(e){
var t=(e=e&&0<Object.keys(e).length?cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.HeroView,!0),e):cleverapps.styles.HeroView).vertical||{},i=e.scale||1;cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(i=t.scale||i),this._super(e.json,i);var s=e;cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&void 0!==t.x&&void 0!==t.y&&(s=t),this.setPositionRound(s);var n=e.start||e.name||e.animation,o=e.idle;n&&o?this.setAnimationAndIdleAfter(n,o):n?this.setAnimation(0,n,!1):o&&this.setAnimation(0,o,!0)},onEnter:function(){this._super(),this.visible=!1,this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){var e=this.getPosition();this.y=.5*-this.height,this.visible=!0,this.runAction(new cc.MoveTo(.5,e).easing(cc.easeBackOut()))}.bind(this))))}});cleverapps.styles.HeroView={json:bundles.main.jsons.hero_json,idle:"starterpack_800",x:600,y:410,scale:.7,vertical:{scale:.55,x:420,y:310}};var HighScoresComponent=function(e){var t=e.level,i=e.parent,
s=cleverapps.styles.HighScoresComponent;if(s&&s.active&&t.isRegular()){var n=t.episode.friendsResults&&t.episode.friendsResults.listFriendResults(t.levelNo);if(!n||0===n.length)return InviteComponent({level:t,parent:i});var o=new cc.Node;if(s.useRibbonTitle){var a=1.2*s.width,r=s.height/2.2,l=cleverapps.UI.createScale9Sprite(bundles.main.frames.ribbon,cleverapps.UI.Scale9Rect.TwoPixelXY);l.setContentSize2(a,r),l.setPositionRound(s.width/2,s.height-.45*r);var c=cleverapps.UI.createScale9Sprite(bundles.main.frames.window_bg_light_png);c.setContentSize2(s.width,s.height),c.setAnchorPoint(0,0),c.setLocalZOrder(-1),o.addChild(c),o.addChild(l)}if(o.setAnchorPoint(.5,.5),o.setContentSize2(s.width,s.height),o.setPositionRound(i.width/2,o.height/2+cleverapps.UI.getSceneOffsetY()),i.window.y+=(o.height/2+o.y)/2+s.windowY,i.addChild(o),s.Title){var p=cleverapps.UI.generateTTFText("messages:LevelStartWindow.HighScoresTitle",cleverapps.styles.FONTS.HIGHSCORE_TITLE_TEXT);p.setPositionRound(o.width/2
,o.height-p.height/2+s.Title.y),p.setAnchorPoint2(),o.addChild(p)}o.visible=!1;var d=o.getPosition();o.setPositionRound(o.x,-2*o.height),o.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.ToggleVisibility,new cc.MoveTo(.2,d)));for(var h=t.episode.friendsResults.listTop4(t.levelNo,!0);h.length<5;)h.push({type:"invite"});var u=h.map(function(e,t){var i=new FriendView(e,t);return i.setLocalZOrder(5-t),o.addChild(i),i});cleverapps.UI.arrangeWithMargins(u,{direction:cleverapps.UI.HORIZONTAL,x:s.Friend.x,y:s.Friend.y,margin:s.Friend.margin})}};cleverapps.overrideFonts(cleverapps.styles.FONTS,{HIGHSCORE_TITLE_TEXT:{size:55,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.HighScoresComponent={active:!0,useRibbonTitle:!0,position:{x:{align:"center"},y:{align:"bottom"}},windowY:-30,width:670,height:270,Friend:{x:48,y:40,margin:20},Title:{y:-12}};var HardLevelDecorationComponent=function(e){var t=e.parent,i=t.decors,s=cleverapps.styles.HardLevelDecorationComponent;if(
s.active&&i&&t.level.isHard()){Object.keys(s.off).forEach(function(e){i.setVisible(e,!1)}),Object.keys(s.on).forEach(function(e){i.add(e)});var n=i.getDecorById("hard_level_title_bg");if(n){var o=cleverapps.styles.Decorators.hard_level_title_bg;n.setContentSize2(t.window.width-o.offsetWidth,o.height)}var a=i.getDecorById("hardLevelSign");a&&(t instanceof VictoryWindow?i.setVisible("hardLevelSign",!1):(i.setVisible("hardLevelSignVictoryWindow",!1),this.runHardLevelAnimation(a)))}};HardLevelDecorationComponent.prototype.runHardLevelAnimation=function(e){var t=e.baseScale;e.setScale(.1*t),e.setVisible(!1),e.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.CallFunc(function(){e.setVisible(!0)}),new cc.ScaleTo(.5,1.1*t).easing(cc.easeBackOut()),new cc.CallFunc(function(){e.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.5,.9*t).easing(cc.easeIn(1)),new cc.ScaleTo(.5,1.1*t))))})))},cleverapps.styles.HardLevelDecorationComponent={active:!0,on:{},off:{}}
;var ScoreComponent=function(e){var t=e.level,i=e.score;if(void 0!==i||!t.isRegular()||(i=cleverapps.userresult.getScoresForLevel(t.episode.episodeNo,t.levelNo))){var s=[],n=cleverapps.UI.generateTTFText(i,cleverapps.styles.FONTS.VERY_BIG_TEXT);if(s.push(n),!e.victory){var o=cleverapps.UI.generateTTFText("messages:LevelStartWindow.YourScore",cleverapps.styles.FONTS.WINDOW_BIG_TEXT);s.push(o)}var a=new cleverapps.Spine(bundles.windows.jsons.score_animation_json||bundles.main.jsons.score_animation_json);a.setLocalZOrder(-1),a.setAnimation(0,"animation",!0);var r=new cleverapps.Layout(s,{direction:cleverapps.UI.VERTICAL});if(r.addChild(a),a.setPosition(n.x,n.y),e.victory){var l=0;n.updateTweenAction=function(e,t){++l%3==0&&n.setString(Math.round(e))},n.setScale(0),n.runAction(new cc.Sequence(new cc.DelayTime(1.4),new cc.Spawn(new cc.ScaleTo(.5,1).easing(cc.easeBackOut()),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.show_score_effect)}),new cc.CallFunc(function(
){cc.sys.isNative||n.runAction(new cc.Sequence(new cc.ActionTween(1.7,"score",0,i).easing(cc.easeCubicActionOut()),new cc.CallFunc(function(){n.setString(i),n.setAnchorPoint2()})))}))))}return r}};cleverapps.styles.ScoreComponent={enabled:!0};var StarsComponent=function(e){var t=cleverapps.styles.StarsComponent,i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(t);var s=new cleverapps.Spine(t.animation.json),n=e.stars;if(s.setAnimation(0,""+n,!1),s.setPositionRound({x:{align:"center"},y:{align:"center"}}),i.addChild(s),!e.victory)for(var o=function(e){i.runAction(new cc.Sequence(new cc.DelayTime(t.sound.duration*e),new cc.CallFunc(function(){cleverapps.audio.playSound(res["star_"+e+"_effect"])})))},a=1;a<=e.stars;a++)o(a);return i};cleverapps.styles.StarsComponent={sound:{duration:.7},animation:{json:res.levelstart_stars_json},width:560,height:220};var VictoryAnimationComponent=cc.Node.extend({ctor:function(e){
var t=e.victory?cleverapps.styles.VictoryAnimationComponent.victory:cleverapps.styles.VictoryAnimationComponent.levelstart;this._super(),this.setContentSize2(t.width,t.height),this.setAnchorPoint2();var i=this.animation=new cleverapps.Spine(t.json);if(i.setPositionRound(this.width/2,this.height/2+(t.y||0)),this.addChild(i),t.idle?(cleverapps.audio.playSound(t.sound),i.setAnimation(0,t.animation,!1),i.setCompleteListener(function(){i.setAnimation(0,t.idle,!0)})):i.setAnimation(0,t.animation,!0),e.victory&&cleverapps.styles.VictoryWindow.victoryText){var s=cleverapps.UI.generateTTFText("messages:VICTORY",cleverapps.styles.FONTS.VICTORY_TEXT);s.setPositionRound(this.width/2,this.height/2+cleverapps.styles.VictoryWindow.victoryText.y),s.setScale(.3),s.runAction(new cc.ScaleTo(.2,1)),this.addChild(s)}}});VictoryAnimationComponent.prototype.onClose=function(e){this.animation.setCompleteListener(e),this.animation.setAnimation(0,"finish",!1)},cleverapps.styles.VictoryAnimationComponent={
levelstart:{animation:"animation",json:res.victory_animation_json,width:456,height:370},victory:{json:res.victory2_spine_json,animation:"victory_start",idle:"idle",sound:res.rocket_effect,width:400,height:240}};var RewardsListComponent=cc.Node.extend({ctor:function(e,t){this._super(),this.reward=e,this.options=t||{},this.createContent()},createContent:function(){var e=cleverapps.styles.RewardsListComponent,t=this.list=this.createList();t.forEach(function(e){cleverapps.UI.wrap(e)});for(var i=[],s=0;s<t.length;){var n=new cleverapps.Layout(t.slice(s,s+3),{direction:this.options.direction||cleverapps.UI.HORIZONTAL,margin:e.margin});i.unshift(n),s+=3}this.content=new cleverapps.Layout(i,{direction:cleverapps.UI.VERTICAL,margin:e.margin}),this.addChild(this.content),this.setContentSize2(this.content),this.setAnchorPoint2(),this.content.setPositionRound(this.width/2,this.height/2)},createOneReward:function(e,t,i){if(void 0===t)return e;var s=cleverapps.styles.RewardsListComponent,
n=this.options.font||cleverapps.styles.FONTS.REWARDS_LIST_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT;return t=cleverapps.UI.generateTTFText(t,n,i),new cleverapps.Layout([t,e],{direction:cleverapps.UI.VERTICAL,margin:s.box.margin})},createList:function(){var e=cleverapps.styles.RewardsListComponent,t=this.reward,i=[];if(void 0!==t.boosters)for(var s in t.boosters)t.boosters[s]&&i.push(this.createOneReward(new cc.Sprite(e.boosters.icons[s]),"x"+t.boosters[s]));if(void 0!==t.gold&&i.push(this.createOneReward(new cc.Sprite(bundles.reward_icons.frames.gold_png),"x"+t.gold)),void 0!==t.exp&&levels.user.expAvailable()&&i.push(this.createOneReward(new cc.Sprite(bundles.reward_icons.frames.reward_exp_png),"x"+t.exp)),void 0!==t.unlimitedLives&&(t.unlimitedLives=Product.FormatUnlimitedLives(t.unlimitedLives),i.push(this.createOneReward(new cc.Sprite(bundles.reward_icons.frames.life_unlim),t.unlimitedLives.title,{amount:t.unlimitedLives.amount}))),void 0!==t.battlePass&&i.push(
this.createOneReward(new cc.Sprite(bundles.battle_pass.frames.ticket),"messages:BattlePassProduct.Title")),void 0!==t.raceKey){var n=new cc.Node;if(n.setAnchorPoint2(),n.setContentSize2(e.race.icon),cleverapps.Spine.isAnimationLoaded(bundles.race.jsons.product_icon))(d=new cleverapps.Spine(bundles.race.jsons.product_icon)).setAnimation(0,"animation",!0),d.setPositionRound(n.width/2,n.height/2),n.addChild(d);i.push(this.createOneReward(n,"messages:Race.product.title"))}(void 0!==t.lives&&i.push(this.createOneReward(new cc.Sprite(bundles.main.frames.level_failed_heart_png),"x"+t.lives)),void 0!==t.stars&&i.push(this.createOneReward(new cc.Sprite(bundles.reward_icons.frames.stars_png),"x"+t.stars)),void 0!==t.gun)&&((o=new cc.Node).setAnchorPoint2(),o.setContentSize2(e.gun.width,e.gun.height),(d=new cleverapps.Spine(e.gun.animation.json,e.gun.scale)).setContentSize2(o.getContentSize()),d.spine.setPositionRound(d.width/2+e.gun.x,d.height/2+e.gun.y),d.setAnimation(0,e.gun.animation.name,!0)
,o.addChild(d),i.push(this.createOneReward(o)));if(t.wardrobe&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_WARDROBE)){var o,a=cleverapps.styles.WardrobeWindow.person;(o=new cc.Node).setAnchorPoint2(),o.setContentSize2(e.wardrobe.width,e.wardrobe.height);var r=new cleverapps.Spine(a.json,a.scale);r.setAnimation(0,"idle",!0),o.addChild(r),i.push(this.createOneReward(o))}if(void 0!==t.herolevels&&Array.isArray(t.herolevels)&&0<t.herolevels.length){for(var l=this.options.font||cleverapps.styles.FONTS.REWARDS_LIST_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT,c=[],p=0;p<t.herolevels.length;p++){var d,h=t.herolevels[p][0].toUpperCase(),u=new cc.Node;u.setAnchorPoint2(),u.setContentSize2(e.herolevel.heroBuilding.width,e.herolevel.heroBuilding.height),(d=new cleverapps.Spine(bundles.heroes.jsons[h+"_hero_spine_json"],e.herolevel.heroBuilding.scale)).setSkin(match3.heroes.getCurrentSkin()),d.setAnimation(0,"idle",!0),u.addChild(d),d.setPositionRound(u.width/2,u.height/2)
;var v=new cleverapps.Layout([u],{direction:cleverapps.UI.VERTICAL}),g=new cc.Node;g.setContentSize2(v.getContentSize()),g.addChild(v),v.setPositionRound(g.width/2,g.height/2),g.setPositionRound({x:{align:"center"},y:{align:"center"}});var m=cleverapps.UI.createScale9Sprite(e.herolevel.levelBlock.bg);m.setContentSize2(e.herolevel.levelBlock.width,e.herolevel.levelBlock.height),m.setPositionRound(u.width/2+e.herolevel.levelBlock.x,u.height/2+e.herolevel.levelBlock.y),u.addChild(m);var f=cleverapps.UI.generateTTFText(Math.max(0,Math.min(Heroes.HEROES_MAX_LEVEL,t.herolevels[p][1])),cleverapps.styles.FONTS.WINDOW_WHITE_TEXT);f.setPositionRound(m.width/2,m.height/2),m.addChild(f),c.push(g)}var _=new cleverapps.Layout(c,{direction:cleverapps.UI.HORIZONTAL,margin:e.herolevel.marginH}),y=cleverapps.UI.generateTTFText("messages:RewardWindow.heroupgrade",l),w=new cleverapps.Layout([y,_],{direction:cleverapps.UI.VERTICAL,margin:e.herolevel.marginV});i.push(w)}return i},iterateRewards:function(e){
this.list.forEach(e)}});cleverapps.styles.RewardsListComponent={margin:30,box:{margin:10},boosters:{icons:{0:bundles.reward_icons.frames.cellbooster,1:bundles.reward_icons.frames.linebooster,2:bundles.reward_icons.frames.colorbooster,3:bundles.reward_icons.frames.hint_icon_png}},gun:{width:100,height:100,y:0,x:0,animation:{json:bundles.game.jsons.gun_animation_json,name:"idle"}},wardrobe:{width:150,height:150},race:{icon:{width:170,height:170}},herolevel:{levelBlock:{bg:res.heroes_level_bg,width:70,height:50},heroBuilding:{width:120,height:120,scale:1.5},additionalText:{x:0,y:0},marginH:90,marginV:30}};var MinigameRewardsComponent=cleverapps.Layout.extend({ctor:function(e){var t=RewardsHelper.getDisplayData(e,{itemsPrefix:"x",short:!0});if(1===cleverapps.values(t).length){var i=new RewardsListComponent(e,{direction:cleverapps.UI.VERTICAL,font:cleverapps.styles.FONTS.MINIGAME_REWARD});i.setScale(cleverapps.styles.MinigameRewardsComponent.itemSize.width/i.width),this.items=[i]
}else this.items=cleverapps.values(t).map(function(e,t){return this.createReward(e.img,e.txt,0==t)}.bind(this));this._super(this.items,{direction:cleverapps.UI.VERTICAL}),e.unlimitedLives&&(e.unlimitedLives=Product.FormatUnlimitedLives(e.unlimitedLives))},createReward:function(e,t,i){var s=cleverapps.styles.MinigameRewardsComponent,n=new cc.Node;if(n.setAnchorPoint2(),n.setContentSize2(s.itemSize),!i&&s.separator){var o=new cc.Sprite(s.separator.image);o.setAnchorPoint2(),o.setPositionRound({align:"center"},{align:"bottom"}),n.addChild(o),n.setContentSize2(s.itemSize.width,s.itemSize.height+o.height)}var a=new cc.Sprite(e);a.setAnchorPoint2(),a.setPositionRound({align:"left"},{align:"center",dy:o?o.height/2:0}),a.setScale(.8*s.iconHeight/a.height),n.addChild(a);var r=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.MINIGAME_REWARD),l=s.itemSize.width-a.width*a.scaleX-s.iconTextSpacing;return r.width>l&&r.fitTo(l),r.setAnchorPoint2(),r.setPositionRound({align:"right"},{
align:"center",dy:(o?o.height/2:0)+s.textOffsetY}),n.addChild(r),n}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{MINIGAME_REWARD:{size:40,color:cleverapps.styles.COLORS.MINIGAME_REWARD_TEXT}}),cleverapps.styles.MinigameRewardsComponent={separator:{image:bundles.windows.frames.lottery_items_dots_png},itemSize:{width:160,height:60},iconHeight:60,iconTextSpacing:20,textOffsetY:0};var InviteComponent=function(e){var t=cleverapps.FBLoginOrInvite();if(t){var i=cleverapps.styles.InviteComponent;e.parent.addChild(t),e.parent.window.y+=(t.height/2+t.y)/2+i.y}};cleverapps.styles.InviteComponent={y:-10};var RoundResultsComponent=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2();var r=cleverapps.styles.RoundResultsComponent,t=e.competition.getResults().sort(function(e,t){return e.player?-1:1}),l=!1;this.perWordTime=.05,this.maxWords=Math.max(t[0].amount,t[1].amount),this.views=t.map(function(e){var t,i=new cleverapps.UI.Avatar(e),s=e.amount,n=0;0<s&&(n=this.perWordTime*(
this.maxWords/s)),.2<n&&(n=.2);var o=new AnimatedCounterComponent({from:0,to:s,font:cleverapps.styles.FONTS.ROUND_WORDS_TEXT,time:n,onFinish:function(){cleverapps.metha.getMainObject().knockoutGame.rumble.getCurrentRound().isWinner(e.id)?this.runWinAnimation(t):this.runLoseAnimation(t)}.bind(this)});cleverapps.metha.getMainObject().knockoutGame.rumble.getCurrentRound().isWinner(e.id)||(i.setCascadeColorEnabled(!0),i.runAction(new cc.TintTo(this.perWordTime*this.maxWords,120,120,120)));var a=(t=new cleverapps.Layout([o,i],{direction:cleverapps.UI.VERTICAL,margin:r.margin})).name=cleverapps.UI.generateTTFText(GridPlayerNameView.FormatName(e.name),cleverapps.styles.FONTS.ROUND_NAME_TEXT);return a.width>r.name.width&&(l=!0),t.addChild(a),a.setPositionRound(t.width/2,t.height+r.margin+a.height/2),t.avatar=i,t.words=o,t.name=a,t.player=e,t},this),this.user=this.views[0],this.opponent=this.views[1],l&&this.views.forEach(function(e){e.name.setFont(cleverapps.styles.FONTS.ROUND_NAME_SMALL_TEXT)
,e.name.setPositionRound(e.width/2,e.height+r.margin+e.name.height/2)}),this.content=new cleverapps.Layout(this.views,{direction:cleverapps.UI.HORIZONTAL,margin:r.playersMargin}),this.setContentSize2(this.content.getContentSize()),this.addChild(this.content),this.content.setPositionRound(this.width/2,this.height/2),this.runAnimation()},runAnimation:function(){this.views.forEach(function(e){e.words.runAnimation()},this)},runWinAnimation:function(e){var t=cleverapps.styles.RoundResultsComponent.animation.user;e.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.Spawn(new cc.ScaleTo(.4,1.3).easing(cc.easeOut(2)),new cc.MoveTo(.6,cc.p(this.content.width/2,e.y+t.dy)))))},runLoseAnimation:function(e){var t=cc.director.getRunningScene().scene,i=0;0===e.player.amount&&(i=this.perWordTime*this.maxWords),e.runAction(new cc.Sequence(new cc.DelayTime(i),new cc.CallFunc(function(){e.name.setVisible(!1),e.words.setVisible(!1),e.avatar.replaceParentSamePlace(t),e.avatar.setLocalZOrder(100),
e.avatar.runAction(new cc.RepeatForever(new cc.RotateBy(1,180))),e.avatar.runAction(new cc.Sequence(new cc.MoveTo(1.2,cc.p(e.avatar.x,-e.avatar.height/2)).easing(cc.easeIn(2)),new cc.RemoveSelf)),cleverapps.audio.playSound(bundles.game.urls.tournament_player_lose_effect)}.bind(this))))}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{ROUND_WORDS_TEXT:{size:60,color:cleverapps.styles.COLORS.COLOR_BROWN},ROUND_NAME_TEXT:{size:30,color:cleverapps.styles.COLORS.COLOR_BROWN},ROUND_NAME_SMALL_TEXT:{size:25,color:cleverapps.styles.COLORS.COLOR_BROWN}}),cleverapps.styles.RoundResultsComponent={animation:{user:{dy:-30},opponent:{}},name:{width:180},margin:10,playersMargin:90};var RoundHeroComponent=cc.Node.extend({ctor:function(e){this._super(),this.options=e;var t=cleverapps.styles.RoundHeroComponent;this.setContentSize2(t.size),this.setAnchorPoint2(),e.window.addChild(this);var i=t;cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(i=t.mobile),this.setPositionRound(i),
this.setLocalZOrder(1),this.hero=new cleverapps.Spine(bundles.main.jsons.hero_json,t.animation.scale),this.addChild(this.hero),this.hero.setPositionRound(this.width/2,this.height/2),this.hero.setAnimation(0,t.animation.name,!1),this.hero.addAnimation(0,t.animation.idle,!0),this.show()},hide:function(){var e=cleverapps.styles.RoundHeroComponent;this.runAction(new cc.Sequence(new cc.MoveTo(.15,cc.p(this.x,this.y+e.moveUp.dy)).easing(cc.easeOut(2)),new cc.MoveTo(.3,cc.p(this.x,-this.height/2)).easing(cc.easeIn(3)),new cc.CallFunc(function(){this.options.window.close()}.bind(this))))},show:function(){var e=this.getPosition();this.setPositionRound(this.x,-this.height/2),this.runAction(new cc.MoveTo(.15,e))}});cleverapps.styles.RoundHeroComponent={x:300,y:200,mobile:{x:140,y:200},size:{width:200,height:500},animation:{scale:.75,name:"applause",idle:"applause"},moveUp:{dy:40}};var AnimatedCounterComponent=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2(),this.options=e,
this.options.scale=this.options.scale||1.3,this.options.onFinish=this.options.onFinish||function(){},this.options.time=this.options.time||.3;var t=this.options.to-this.options.from;this.increment=0<t?1:0===t?0:-1,this.text=cleverapps.UI.generateTTFText(this.options.from,this.options.font),this.addChild(this.text),this.setContentSize2(this.text.getContentSize()),this.text.setPositionRound(this.width/2,this.height/2),this.current=this.options.from,this.paused=!1,this.started=!1},runAnimation:function(){this.started=!0,this.current=this.options.from,this.paused||this._animateStep()},_animateStep:function(){!this.paused&&this.started&&(this.current!==this.options.to+this.increment?this.text.runAction(new cc.Sequence(new cc.ScaleTo(this.options.time,this.options.scale),new cc.CallFunc(function(){this.text.setString(this.current),this.options.sfx&&cleverapps.audio.playSound(bundles.main.urls["countdown_effect_"+this.current])}.bind(this)),new cc.ScaleTo(this.options.time,1),new cc.DelayTime(
this.options.time),new cc.CallFunc(function(){this.current+=this.increment,this._animateStep()}.bind(this)))):this.options.onFinish())},pauseCountdown:function(){this.paused||(this.paused=!0)},resumeCountdown:function(){this.paused&&(this.paused=!1,this._animateStep())}});cleverapps.styles.AnimatedCounterComponent={};var RoundCountdownComponent=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2(),this.text=cleverapps.UI.generateTTFText("messages:RoundCountdownComponent.text",cleverapps.styles.FONTS.ROUND_COUNTDOWN_TEXT),this.addChild(this.text),this.setContentSize2(this.text.getContentSize()),this.text.setPositionRound(this.width/2,this.height/2),this.text.setVisible(!1),this.countdown=new AnimatedCounterComponent({from:3,to:1,font:cleverapps.styles.FONTS.ROUND_COUNTDOWN_TIMER_TEXT,scale:1.5,sfx:!0,onFinish:function(){e()}}),this.addChild(this.countdown),this.countdown.setPositionRound(this.width/2,this.height/2),this.countdown.setVisible(!1),this.runAction(
new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(function(){this.text.setVisible(!0)}.bind(this)),new cc.DelayTime(1.5),new cc.CallFunc(function(){this.text.setVisible(!1),this.countdown.setVisible(!0),this.countdown.runAnimation()}.bind(this))))},pauseCountdown:function(){this.countdown.pauseCountdown()},resumeCountdown:function(){this.countdown.resumeCountdown()}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{ROUND_COUNTDOWN_TEXT:{size:25,color:cleverapps.styles.COLORS.COLOR_BROWN},ROUND_COUNTDOWN_TIMER_TEXT:{size:50,color:cleverapps.styles.COLORS.COLOR_BROWN}});var TreasureSearchRewardComponent=cc.Node.extend({ctor:function(e){this._super();var t=cleverapps.styles.TreasureSearchRewardComponent;this.setAnchorPoint2(),e.addChild(this),this.setPositionRound(t);var i=new cleverapps.Spine(bundles.game.jsons.shovel_json,1);this.addChild(i),i.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){i.setAnimationAndIdleAfter("open","idle")})))}})
;TreasureSearchRewardComponent.IsAvailable=function(){return-1!==["olympics"].indexOf(cleverapps.config.name)},cleverapps.styles.TreasureSearchRewardComponent={x:{align:"center",dx:140},y:{align:"center",dy:150}};var WordsListComponent=cc.Node.extend({ctor:function(e){this._super(),this.options=e,this.setAnchorPoint2();var a=cleverapps.styles.WordsListComponent,t=this.options.words.map(function(e){var t=this.options.width-2*a.word.padding.x,i=a.word.height,s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(t,i);var n=this.createWordBg(t,i);s.addChild(n),n.setPositionRound(s.width/2,s.height/2);var o=cleverapps.UI.generateTTFText(e.toUpperCase(),cleverapps.styles.FONTS.EXTRA_WINDOW_LETTER_TEXT);return s.addChild(o),o.setPositionRound(a.word.text),s}.bind(this)),i=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL,margin:a.words.margin,padding:a.words.padding}),s=new cleverapps.UI.ScrollView(i,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_LINEAR})
;s.setContentSize2(this.options.width,Math.min(this.options.height,i.height));var n=new cc.Node;if(n.setAnchorPoint2(),n.setContentSize2(s.width,this.options.height),n.addChild(s),s.setPositionRound(n.width/2,n.height-s.height/2),this.setContentSize2(n.width,n.height+2*a.topPadding),this.addChild(n),n.setPositionRound(this.width/2,this.height/2),a.bg){var o=new cc.Scale9Sprite(bundles.main.frames.light_bg_png);o.setContentSize2(this.getContentSize()),this.addChild(o),o.setLocalZOrder(-1),o.setPositionRound(this.width/2,this.height/2)}},createWordBg:function(e,t){var i=new cc.Scale9Sprite(this.getWordBgImage());if(cleverapps.styles.WordsListComponent.word.scaleYOnly){var s=t/i.height;i.width=e/s,i.setScale(s)}else i.setContentSize2(e,t);return i},getWordBgImage:function(){return"scramble"===cleverapps.config.name?Game.currentGame.board.level.isHard()?bundles.game.frames.found_word_bg_hard_png:Game.currentGame.board.level.episode.isBonusRound(
)?bundles.game.frames.found_word_bg_bonus_png:bundles.game.frames.found_word_bg_png:bundles.main.frames.row_player_png}});cleverapps.styles.WordsListComponent={mouseScrollSpeed:200,word:{height:70,padding:{x:12},text:{x:{align:"center"},y:{align:"center",dy:-5}}},words:{margin:5,padding:{x:0,y:5}},topPadding:4,bg:!0};var MedallionComponent=cc.Node.extend({ctor:function(e){this.options=e,this._super();var t=cleverapps.styles.MedallionComponent;this.setAnchorPoint2(),this.setContentSize2(t),this.setPositionRound(t.positions[cleverapps.wideMode.mode]),this.setLocalZOrder(1e6),this.backgroundAnimation=new cleverapps.Spine(bundles.game.jsons.medallion_json),this.backgroundAnimation.setAnimation(0,"idle",!0),this.backgroundAnimation.setPosition(this.width/2,this.height/2),this.addChild(this.backgroundAnimation),this.createContent(),0!==this.content.length&&(this.visible=!1,setTimeout(this.showUp.bind(this),500))},showUp:function(){this.runAction(new cc.Sequence(new cc.CallFunc(function(){
this.visible=!0,this.backgroundAnimation.setAnimationAndIdleAfter("animation","idle")}.bind(this)),new cc.MoveBy(1.1,0,-cleverapps.styles.MedallionComponent.distance).easing(cc.easeBackOut())));var i=function(){var e=this.content[this.contentIndex];if(this.contentView=e.spine,this.contentView.setVisible(!0),this.contentView.setPositionRound(this.backgroundAnimation.width/2,this.backgroundAnimation.height/2),1<e.amount){var t=cleverapps.UI.generateTTFText("x"+e.amount,cleverapps.styles.FONTS.MEDALLION_TEXT);this.contentView.addChild(t),t.setPositionRound(cleverapps.styles.MedallionComponent.textPosition)}this.backgroundAnimation.addChild(this.contentView),e.openAnimation?this.contentView.setAnimationAndIdleAfter(e.openAnimation,e.idleAnimation):this.contentView.setAnimation(0,e.idleAnimation,!0),1!==this.content.length?this.runAction(new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(function(){this.contentView.setVisible(!1),this.contentView.removeFromParent(),this.contentIndex++,
this.contentIndex===this.content.length&&(this.contentIndex=0,this.options.showOnce)?this.hide():i()}.bind(this)))):this.options.showOnce&&setTimeout(this.hide.bind(this),3e3)}.bind(this);i()},createContent:function(){this.content=[],this.contentIndex=0,Object.keys(this.options).forEach(function(e){"shovels"===e?this.content.push({spine:new cleverapps.Spine(bundles.game.jsons.shovel_json),openAnimation:"open",idleAnimation:"idle",amount:this.options[e]}):"clovers"===e?this.content.push({spine:new cleverapps.Spine(bundles.card.jsons.marks_json),idleAnimation:"gem_idle_counter"}):"stars"===e&&this.content.push({spine:new cleverapps.Spine(bundles.game.jsons.star_json),openAnimation:"open",idleAnimation:"idle",amount:this.options[e]})}.bind(this))},hide:function(){this.contentView&&(this.contentView.setVisible(!1),this.contentView.removeFromParent(),this.contentView=void 0),this.backgroundAnimation.removeFromParent(),this.backgroundAnimation=void 0,this.removeFromParent()}})
;MedallionComponent.IsAvailable=function(){return-1!==["riddles","heroes","wordsoup","crocword","tripeaks","differences"].indexOf(cleverapps.config.name)},cleverapps.overrideFonts(cleverapps.styles.FONTS,{MEDALLION_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.MedallionComponent={width:200,height:200,distance:400,positions:[{x:{align:"left",dx:20},y:{align:"top",dy:300}},{x:{align:"left",dx:160},y:{align:"top",dy:200}},{x:{align:"left",dx:200},y:{align:"top",dy:200}}],textPosition:{x:{align:"center",dx:30},y:{align:"center",dy:-45}}};var Change=function(e){this.options=e};Change.prototype.isActive=function(){return!0},Change.prototype.calculateDelta=function(){return 0},Change.prototype.createView=function(){};var ChangeView=cc.Node.extend({ctor:function(e){this.options=e,this._super(),this.setVisible(!1),this.showUp()},showUp:function(){this.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){this.setScale(0),this.setVisible(!0)}.bind(
this)),new cc.ScaleTo(.6,1).easing(cc.easeBackOut())))},animateChange:function(e){}}),LanternChange=function(e){Change.call(this,e),this.lantern=e.lantern};LanternChange.prototype=Object.create(Change.prototype),(LanternChange.prototype.constructor=LanternChange).prototype.isActive=function(){return this.lantern&&this.lantern.isActive(this.options.level)},LanternChange.prototype.calculateDelta=function(){return 1},LanternChange.prototype.createView=function(e){this.lantern.beforeShownProgress||(this.lantern.beforeShownProgress=Math.max(0,this.lantern.getCurrentStreak()-1));var t=new LanternChangeView({before:this.lantern.beforeShownProgress,after:this.lantern.getCurrentStreak()});return e.window.addChild(t),this.lantern.beforeShownProgress=this.lantern.getCurrentStreak(),t};var LanternChangeView=ChangeView.extend({ctor:function(e){this._super(e);var t=cleverapps.styles.LanternChangeView,i=this.lantern=new cleverapps.Spine(bundles.lantern.jsons.lantern_game_json);i.setAnimation(0,
"idle_"+this.options.before,!0),this.setLocalZOrder(t.zOrder),this.setAnchorPoint2(),this.setContentSize2(t),this.setScale(t.isInitialScaleZero?0:t.scale),this.addChild(i),i.setPositionRound(this.width/2,this.height/2),this.setPositionRound(cleverapps.clone(t.wideModePositions[cleverapps.wideMode.mode],!0)),this.setVisible(!0)},showUp:function(){},animateChange:function(e){var t=cleverapps.styles.LanternChangeView;this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.ScaleTo(.3,1.1*t.scale),new cc.ScaleTo(.1,t.scale),new cc.CallFunc(function(){this.options.before!==this.options.after&&this.lantern.setAnimationAndIdleAfter("charge_"+this.options.after,"idle_"+this.options.after)}.bind(this))))}});cleverapps.styles.LanternChangeView={wideModePositions:[{x:{align:"right",dx:-10},y:{align:"bottom",dy:150}},{x:{align:"right",dx:-10},y:{align:"bottom",dy:150}},{x:{align:"right",dx:-10},y:{align:"bottom",dy:150}}],zOrder:0,width:250,height:250,scale:.55};var VictoryChestChange=function(e
){Change.call(this,e)};VictoryChestChange.prototype=Object.create(Change.prototype),(VictoryChestChange.prototype.constructor=VictoryChestChange).prototype.isActive=function(){return cleverapps.styles.VictoryChestChangeView.ChestBlock&&0<this.options.stars},VictoryChestChange.prototype.calculateDelta=function(){return this.options.stars},VictoryChestChange.prototype.createView=function(e){var t=new VictoryChestChangeView({oldChestStars:this.options.oldChestStars});return e.addChild(t),t};var VictoryChestChangeView=ChangeView.extend({ctor:function(e){var t=cleverapps.styles.VictoryChestChangeView;this._super(e),this.setPositionRound(t.ChestBlock);var i=cleverapps.UI.createScale9Sprite(bundles.menubar.frames.menu_gold_bg_png);i.setAnchorPoint2(),i.setContentSize2(t.ChestBoard.width,t.ChestBoard.height),i.setPosition(t.ChestBoard.x,t.ChestBoard.y),this.addChild(i),this.chestBoard=i;var s=new cleverapps.Spine(bundles.starchest_window.jsons.star_chest_spine_json,t.Chest.scale)
;s.setPosition(t.Chest.x,t.Chest.y),s.setAnimation(0,"ready_to_open",!0),this.addChild(s),this.chest=s;var n=cleverapps.styles.FONTS.VICTORY_CHEST_TEXT,o=cleverapps.UI.generateTTFText(this.options.oldChestStars+"/"+cleverapps.StarChest.GOAL_AMOUNT,n);o.setAnchorPoint(1,.5),o.setPosition(i.width+t.ChestBoard.text.x,i.height/2+t.ChestBoard.text.y),i.addChild(o),this.chestBoardText=o},animateChange:function(e){this.runAction(new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(function(){this.runAction(new cc.Sequence(new cc.ScaleTo(.3,1.3),new cc.CallFunc(function(){cleverapps.UI.animateDelta(e,{x:this.chestBoardText.x-this.chestBoardText.width/2,y:this.chestBoardText.y,dy:cleverapps.styles.VictoryChestChangeView.ChestBoard.dy,parent:this.chestBoard}),this.chestBoardText.setString(cleverapps.starChest.stars+"/"+cleverapps.StarChest.GOAL_AMOUNT)}.bind(this)),new cc.ScaleTo(.3,1)))}.bind(this)),new cc.DelayTime(.5),new cc.CallFunc(function(){cleverapps.starChest.locked?this.runAction(
new cc.Sequence(new cc.DelayTime(.5),new cc.ScaleTo(.4,0),new cc.RemoveSelf)):(this.chest.setAnimation(0,"opening",!1),this.chest.setCompleteListener(function(){this.runAction(new cc.Sequence(new cc.ScaleTo(.5,0),new cc.RemoveSelf))}.bind(this)))}.bind(this))))}});cleverapps.styles.VictoryChestChangeView={ChestBlock:{x:{align:"center",dx:0},y:{align:"top",dy:-100}},ChestBoard:{x:55,y:5,dy:30,width:270,height:55,text:{x:-25,y:1}},Chest:{x:-55,y:0,scale:.5}};var TournamentBookChange=function(e){Change.call(this,e),this.mission=void 0};TournamentBookChange.prototype=Object.create(Change.prototype),(TournamentBookChange.prototype.constructor=TournamentBookChange).prototype.isActive=function(){return!("board"!==cleverapps.config.type||cleverapps.isKnockoutGame()||void 0===this.mission||!this.options.game.canPayReward(GameBase.REWARD_BACKGROUND_CLOVER)||MedallionComponent.IsAvailable())},TournamentBookChange.prototype.calculateDelta=function(){
return this.options.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER]},TournamentBookChange.prototype.createView=function(e){var t=new TournamentBookChangeView({place:this.options.game.tournament&&this.options.game.competition&&this.options.game.competition.calcPlace()+1,isFinished:this.mission.result+this.mission.currency>=TreasureSearch.GEMS});return e.addChild(t),t};var TournamentBookChangeView=ChangeView.extend({ctor:function(e){this._super(e);var t=cleverapps.styles.TournamentBookChangeView;this.setAnchorPoint2(),this.setContentSize2(t);var i=this.animation=new cleverapps.Spine(bundles.main.jsons.tournament_book_json,1);i.setPosition(this.width/2,this.height/2),this.addChild(i),this.setPositionRound(t)},showUp:function(){},animateChange:function(e){this.runAction(new cc.Sequence(new cc.DelayTime(1.5),new cc.CallFunc(function(){this.setVisible(!0),this.animation.setAnimation(0,"animation",!1)}.bind(this))))}});cleverapps.styles.TournamentBookChangeView={width:300,height:400,x:{
align:"center"},y:{align:"center",dy:190}};var RaffleChange=function(e){Change.call(this,e),this.mission=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_RAFFLE)};RaffleChange.prototype=Object.create(Change.prototype),(RaffleChange.prototype.constructor=RaffleChange).prototype.isActive=function(){return this.mission&&this.mission.isRunning()&&this.mission.raffle.needVictoryShow(this.options.level)},RaffleChange.prototype.calculateDelta=function(){return 1},RaffleChange.prototype.createView=function(e){var t=new RaffleChangeView;return e.window.addChild(t),t};var RaffleChangeView=ChangeView.extend({ctor:function(e){this._super(e),this.setLocalZOrder(10);var t=cleverapps.styles.RaffleChangeView;this.setAnchorPoint2(),this.setContentSize2(t);var i=this.animation=new cleverapps.Spine(bundles.raffle_victory.jsons.raffle_json);this.addChild(i),i.setPositionRound(this.width/2,this.height/2),this.setPositionRound(t.alignment),this.setVisible(!0)},showUp:function(){},
animateChange:function(){this.runAction(new cc.Sequence(new cc.DelayTime(cleverapps.styles.RaffleChangeView.delay),new cc.callFunc(this.animation.setAnimation.bind(this.animation,0,RaffleMissionLogic.getAnimationName(),!1))))}});cleverapps.styles.RaffleChangeView={width:100,height:150,delay:1,alignment:{x:{align:"center",dx:-40},y:{align:"center",dy:0}}},cleverapps.Reports={streams:{},get:function(e){return void 0===cleverapps.Reports.streams[e]&&(cleverapps.Reports.streams[e]=new cleverapps.ReportStream(e)),cleverapps.Reports.streams[e]},push:function(e,t){cleverapps.Reports.get(e).push(t)}},cleverapps.ReportStream=function(e){this.data=["REPORT: "+e.toUpperCase()]},cleverapps.ReportStream.prototype.push=function(e){this.data.push(e)},cleverapps.ReportStream.prototype.send=function(){var t=[new Date+""];this.data.forEach(function(e){t.push(e)}),cleverapps.environment&&t.push("Screen: "+cleverapps.environment.getScreen()),levels&&levels.user&&(t.push(
"Episode: "+cleverapps.environment.episodeNo),t.push("Level: "+cleverapps.environment.levelNo),t.push("User id: "+levels.user.id)),t.push("Version: "+cc.game.config.version),t.push("Source: "+cleverapps.User.calcSource()),cleverapps.config&&cleverapps.config.name&&t.push("Name: "+cleverapps.config.name),t.push(window&&window.navigator?window.navigator.userAgent:"???"),t=(t=t.join(" - ")).replace(/(?:\r\n|\r|\n)/g," - ")+" ",console.log(t),cleverapps.isLocalhost()||cleverapps.RestClient.sendRaw(cleverapps.RestClient.METHODS.POST,cleverapps.LOG_ERROR_URL,t)},cleverapps.ReportStream.send=function(e,t){var i=new cleverapps.ReportStream(e);i.push(t),i.send()},cleverapps.ReportStream.debug=cleverapps.throttle(100,function(e){var t=new cleverapps.ReportStream("DebugMessage");Array.isArray(e)||(e=[e]),e.forEach(function(e){t.push(e)}),t.send()}),cleverapps.ErrorHandler={SEND_INTERVAL:"1 hour",lastSend:0,getBaseMessage:function(){var e=[new Date+""];return cleverapps.environment&&e.push(
"Screen: "+cleverapps.environment.getScreen()),cleverapps.User.calcSource&&e.push("Source: "+cleverapps.User.calcSource()),cleverapps.config&&cleverapps.config.name&&e.push("Name: "+cleverapps.config.name),cleverapps.config&&cleverapps.config.title&&e.push("Title: "+cleverapps.config.title),cc.game.config&&cc.game.config.version&&e.push("Version: "+cc.game.config.version),levels&&levels.user&&(e.push("Episode: "+cleverapps.environment.episodeNo),e.push("Level: "+cleverapps.environment.levelNo),e.push("User id: "+levels.user.id)),cleverapps&&cleverapps.settings&&e.push("Language: "+cleverapps.settings.language),e.push(window&&window.navigator?window.navigator.userAgent:"???"),e},onerror:function(e,t,i,s,n){var o=cleverapps.ErrorHandler.getBaseMessage();return n&&n.arguments&&o.push("Arguments: "+n.arguments),n&&n.stack?(o.push("Message: "+e),o.push("Line: "+i),o.push("Column: "+s),o.push(n.stack)):(o.push("Message: "+e),o.push("URL: "+t),o.push("Line: "+i),o.push("Column: "+s),o.push(
"Error: "+JSON.stringify(n))),o=(o=o.join(" - ")).replace(/(?:\r\n|\r|\n)/g," - ")+" ",window&&window.assetsFolder&&(o=o.replace(new RegExp(window.assetsFolder,"g"),"")),cleverapps.ErrorHandler._onerror(o),!1},logError:function(e,t){var i=this.getBaseMessage();i.push("Message: "+e),t&&t.arguments&&i.push("Arguments: "+t.arguments),t&&t.stack&&i.push(t.stack),i=(i=i.join(" - ")).replace(/(?:\r\n|\r|\n)/g," - ")+" ",cleverapps.ErrorHandler._onerror(i)},_onerror:function(e){if(Date.now()-cleverapps.ErrorHandler.lastSend>=cleverapps.parseInterval(this.SEND_INTERVAL)&&(this.send(e),cleverapps.ErrorHandler.lastSend=Date.now()),cc.sys.isWebView){var t=cc.director.getTotalFrames(),i=function(){if(t===cc.director.getTotalFrames()||!cleverapps.metha)return cleverapps.eventLogger&&cleverapps.eventLogger.logEvent("webview_onerror_reload_silent"),cleverapps.ReportStream&&cleverapps.ReportStream.debug("WebView error location reload silent"),void window.location.reload();var e={
focus:"OnErrorRestartWindow",action:function(e){cleverapps.eventLogger&&cleverapps.eventLogger.logEvent("webview_onerror_reload_window"),cleverapps.ReportStream&&cleverapps.ReportStream.debug("WebView error location reload window"),new RestartWindow({contentMessage:"RestartWindow.OnError"}),cleverapps.metha.onceNoWindowsListener=e}};cleverapps.metha.isFocused()?cleverapps.metha.distract(e):cleverapps.metha.display(e)};setTimeout(function(){t===cc.director.getTotalFrames()&&(cc.game.pause(),cc.game.resume(),setTimeout(i,500))},500)}},send:function(e,t){console.log(e),cleverapps.RestClient.sendRaw(cleverapps.RestClient.METHODS.POST,cleverapps.LOG_ERROR_URL,e),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.ERROR_AMOUNT)}},window.onerror=cleverapps.ErrorHandler.onerror,cleverapps.LOG_ERROR_URL="/log/",cleverapps.DataLoader={enabled:!0,corrupted:!1,_onSavedCallbacks:[],data:{},_queue:{},haveSavedData:function(){return void 0!==cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.ID)},
save:function(e,t,i){this._queue[e]={data:t,options:i},this._runSaveTimeout()},onSaved:function(e){void 0===this._saveTimeout?e():this._onSavedCallbacks.push(e)},processSaveQueue:function(){for(var e in this._queue)this._saveProcess(e,this._queue[e].data,this._queue[e].options);this._queue={},this._saveTimeout=void 0;for(var t=0;t<this._onSavedCallbacks.length;t++)this._onSavedCallbacks[t]();this._onSavedCallbacks=[]},_runSaveTimeout:function(){void 0===this._saveTimeout&&(this._saveTimeout=setTimeout(this.processSaveQueue.bind(this),1e3))},_saveProcess:function(e,t,i){var s=(i=i||{}).limit||cleverapps.DataLoader.FIFO_LIMIT,n=i.fifoKey,o=i.raw;if(n&&!this.hasKey(e)){for(var a=this.load(n)||[];a.length>=s;)this.remove(a[0],n),a=this.load(n);a.push(e),this._saveProcess(n,a),this._saveProcess(e,t)}else{var r=o?t+"":JSON.stringify(t);if(this.data[e]=r,!this.enabled||this.corrupted)return;if(e!==cleverapps.DataLoaderTypes.CLIENT_SESSION&&(this.checkClientSession(),this.corrupted))return
;try{if(void 0!==cleverapps.DataLoader.CLIENT_SESSION&&e!==cleverapps.DataLoaderTypes.CLIENT_SESSION&&!cc.sys.localStorage.getItem(cleverapps.DataLoaderTypes.CLIENT_SESSION))throw cleverapps.eventLogger&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LOCALSTORAGE_CLEARED),1;if(r&&r.length>cleverapps.DataLoader.VALUE_LENGTH_LIMIT&&cleverapps.ErrorHandler.logError("Attempt to save huge value ("+r.length+") to localstorage key - "+e),cc.sys.localStorage.setItem(e,r),!cc.sys.isNative&&cc.sys.localStorage.getItem(e)!==r)throw e!==cleverapps.DataLoaderTypes.CLIENT_SESSION&&cleverapps.eventLogger&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LOCALSTORAGE_ERROR_SET_ITEM),2}catch(e){cc.sys.localStorage.removeItem(cleverapps.DataLoaderTypes.SESSION_SAVE_KEY),this.corrupted=!0}}},getCharValues:function(e){for(var t,i=[],s=0;s<e.str.length;s++)t=e.str.charCodeAt(s),e.encode?i.push(t<=65517?t+18:t):i.push(t<=65535?t-18:t);return i},hasKey:function(e){var t
;return this._queue[e]?t=this._queue[e].data:(this.data.hasOwnProperty(e)||(this.data[e]=cc.sys.localStorage.getItem(e)),t=this.data[e]),null!=t},checkClientSession:function(){if(void 0!==cleverapps.DataLoader.CLIENT_SESSION){var e=cc.sys.localStorage.getItem(cleverapps.DataLoaderTypes.CLIENT_SESSION);if(e!==cleverapps.DataLoader.CLIENT_SESSION&&e)return this.corrupted=!0,cleverapps.synchronizer&&cleverapps.synchronizer.clientSessionExpired(),!1}return!0},load:function(e,t){if(this._queue[e]){var i=this._queue[e].data;return i=this._queue[e].options&&this._queue[e].options.raw?i+"":i,t&&t.raw?JSON.stringify(i):i}!this.data.hasOwnProperty(e)&&this.enabled&&(this.data[e]=cc.sys.localStorage.getItem(e));var s=this.data[e];if(null!=s){if(t&&t.raw)return s;if((i=JSON.parse(s)).dataCodes){var n=this.getCharValues({str:i.dataCodes});i=JSON.parse(String.fromCharCode.apply(null,n))}return i}},remove:function(e,t){if(this._queue[e]&&delete this._queue[e],delete this.data[e],
this.enabled&&!this.corrupted&&cc.sys.localStorage.removeItem(e),t){var i=this.load(t);if(i){var s=i.indexOf(e);0<=s&&(i.splice(s,1),this.save(t,i))}}},cleanAll:function(){if(window.localStorage)for(var e in console.log("Clearing by prefix: "+cleverapps.config.prefix),this._queue={},this.data={},cc.sys.localStorage.setItem=function(){},window.localStorage)0===e.indexOf(cleverapps.config.prefix)&&-1===e.indexOf("_editor_episode_")&&-1===e.indexOf("_constant")&&(console.log("Clearing LOCALSTORAGE:"+e),cc.sys.localStorage.removeItem(e))},isEnabled:function(){if(!cc.sys.isNative)try{return window.localStorage.setItem("test","testValue"),"testValue"!==window.localStorage.getItem("test")?!1:(window.localStorage.removeItem("test"),!0)}catch(e){return!1}return!0}},cleverapps.DataLoader.FIFO_LIMIT=10,cleverapps.DataLoader.VALUE_LENGTH_LIMIT=1e7,cleverapps.DataLoader.resetClientSession=function(){cleverapps.DataLoader.CLIENT_SESSION=void 0,cleverapps.DataLoader.enabled=!0,
cleverapps.DataLoader.corrupted=!1,cc.sys.isNative||(cleverapps.DataLoader.CLIENT_SESSION=Math.floor(1e9*Math.random())+1+"",cleverapps.DataLoader._saveProcess(cleverapps.DataLoaderTypes.CLIENT_SESSION,cleverapps.DataLoader.CLIENT_SESSION,{raw:!0}),cleverapps.DataLoader.corrupted&&(cleverapps.DataLoader.enabled=!1,cleverapps.DataLoader.corrupted=!1,cleverapps.DataLoader.CLIENT_SESSION=void 0))},cleverapps.DataLoader.init=function(){var t=cleverapps.config.name+cleverapps.social.getLocalStoragePreffix();if(cleverapps.DataLoaderTypes={ID:t,HISTORY:t+"_history",CLIENT_SESSION:t+"_client_session",SETTINGS:t+"_settings",DAILY_CHEST:t+"_periodicBonus",FRIENDS:t+"_friends",INVITABLE_FRIENDS:t+"_invitable_friends",BONUS_GAME_CHEST:t+"_bonus_game_chest",TUTORIAL:t+"_tutorial",LEVEL_HINTS:t+"_level_hints",GAME_SAVE_FIFO:t+"_game_save_fifo",PAYMENTS_HISTORY:t+"_my_payments",PAYMENTS_HISTORY_5_PRICE:t+"_my_payments_5_price",SALE_MANAGER:t+"_sale_manager",SALE:t+"_sale",
SERVER_VERSION:t+"_server_version",SESSION_SAVE_KEY:t+"_session",FAKE_FACEBOOK_LOGGING_TIME:t+"_fake_facebook_logging_time",PROMOTION:t+"_promotion",LOCALIZATION_MANAGER:t+"_localization_manager",RESULT_FIFO:t+"_result_fifo",RESULTS_FIFO:t+"_results_fifo",LIVES:t+"_lives",BOOSTERS_COUNTER:t+"_boosters_counter",STAR_CHEST:t+"_star_chest",BONUS_EPISODES_PROGRESS:t+"_bonus_episodes_progress",SERVER_FLAGS:t+"_server_flags",HELP_FROM_FRIENDS:t+"_help_from_friends",FORCES:t+"_forces",FREE_BOMB_MOVES:t+"_free_bomb_moves",TEMP_GOODS:t+"_temp_goods",SORTER:t+"_sorter",FRIEND_REQUESTS:t+"_friend_requests",FAKE_REQUESTS:t+"_fake_request_time",ASKED_LIVES:t+"_asked_lives",ASKED_STARS:t+"_asked_stars",BOUNTY:t+"_bounty",PACK:t+"_pack",DAILY_TASKS:t+"_daily_tasks",BATTLE_PASS:t+"_battle_pass",WIN_STREAK:t+"_win_seria",LOCAL_PUSHES:t+"_local_pushes",TOURNAMENT_COMPETITORS:t+"_tournament_competitors",TOURNAMENT_PLAYERS:t+"_tournament_players",TOURNAMENT_RECORD:t+"_tournament_record",
PLAY_SESSION:t+"_play_session",REWARDED_ADS_MANAGER:t+"_rewarded_ads",AD_ICON:t+"_adicon",REWARDED_TOOLBAR:t+"_rewarded_toolbar",LEVEL_ATTEMPTS:t+"_level_attempts",LAST_VIEWED_FRIEND_REQUEST:t+"_last_viewed_friend_request",MISSIONS:t+"_missions",COMPETITION:t+"_competition",COMPETITION_PLAYERS:t+"_competition_players",COMPETITION_STATISTICS:t+"_competition_statistics",PLACEMENTS:t+"_placements",PIGGY_BANK:t+"_piggy_bank",SUBSCRIPTION:t+"_subscription",GUN:t+"_gun",INSTANT_SHORTCUT_CREATED:t+"_instant_shortcut_created",INSTANT_BOT_CREATED:t+"_instant_bot_created",HEROES:t+"_heroes",DAILY_CUP:t+"_daily_cup",DAILY_CUP_RULES:t+"_daily_cup_rules",MINI_GAME_RECORD:t+"_mini_game_record",INFORMATION:t+"_info",SYNC:t+"_sync",FRIDAY_SALE:t+"_friday_sale",LANTERN:t+"_lantern",FARM:t+"_clockmaker_a",HOMEFIX:t+"_home",DRAUGIEM_AUTH_DATA:t+"_draugiem_auth_data",DAILY_LEVEL:t+"_daily_level",KNOCKOUT:t+"_knockout",WEEKLY_CUP:t+"_weekly_cup",WEEKLY_CUP_TOP:t+"_weekly_cup_top",
COOKIE_JAR:t+"_cookie_jar",RATED:t+"_rated",APPLE_SOCIAL:t+"_apple_social",SIMPLE:t+"_simple",JACKPOT_LAST_APPEAR_TIME:t+"_jackpot_last_appear_time",CARD_SKINS:t+"_card_skins",ADMIN_CHART:t+"_admin_chart",BET_BONUS:t+"_bet_bonus"},cleverapps.DataLoader.resetClientSession(),"function"==typeof cc.sys.localStorage.getData)cleverapps.DataLoader.data=cc.sys.localStorage.getData();else if(!cc.sys.isNative)try{void 0!==window.localStorage&&window.localStorage&&Object.keys(window.localStorage).forEach(function(e){0===e.indexOf(t)&&(this.data[e]=cc.sys.localStorage.getItem(e))}.bind(this))}catch(e){console.warn("can't read localStorage all data",e)}},cleverapps.WebViewData=function(){},cleverapps.WebViewData.prototype.init=function(e){webkitMessage("localStorage",{action:"init"}),this.initCallback=e},cleverapps.WebViewData.prototype.onInit=function(e,t){var i=JSON.parse(e);Object.keys(i).forEach(function(t){try{i[t]=decodeURIComponent(i[t])}catch(e){console.log(
"LocalStorage key - "+t+" decode error.")}}),this.localStorageData=i,t=JSON.parse(decodeWebViewData(t)),console.log("WebViewData.init data - "+JSON.stringify(t)),this.sourceApplicationUrl=t.sourceApplicationUrl,this.deviceVersion=t.deviceVersion,this.deviceName=t.deviceName,this.advertisingId=t.advertisingId,this.langCode=t.langCode,this.appleSocialAvailable=t.appleSocial,console.log("device version "+this.deviceVersion+" device name "+this.deviceName),console.log("advertisingId "+this.advertisingId),console.log("langCode "+this.langCode),console.log("appleSocialAvailable "+this.appleSocialAvailable),this.initCallback&&(this.initCallback(),delete this.initCallback)},cleverapps.Availables={PERIODIC_BONUS:{episode:0,level:4},LEADER_BOARD:{episode:1,level:3},FRIEND_REQUESTS:{episode:0,level:6},BONUS_ROUND:{episode:0,level:10},DAILY_TASKS:{episode:2,level:13},MOVES:{episode:0,level:4},CREATE_SHORTCUT:{episode:0,level:5}},cleverapps.Settings=function(e){this.onChangeSoundListener=function(
){},this.onChangeMusicListener=function(){},this.onChangeVibroListener=function(){},this.onChangeLanguageListener=function(){},this.load(),this.updateFrameRateByFpsMode()},cleverapps.Settings.getAvailableLanguages=function(){return cleverapps.config.languages?cleverapps.config.languages:projects.default.languages},cleverapps.Settings.getDefaultLanguage=function(){var e=cleverapps.Settings.getAvailableLanguages(),t=cc.sys.language;if(t===cc.sys.LANGUAGE_DUTCH&&(t="nl"),-1===e.indexOf(t)||t===cc.sys.LANGUAGE_ENGLISH){for(var i=cleverapps.social.getDefaultLanguages(),s=0;s<i.length;s++){var n=i[s];if(-1!==e.indexOf(n))return n}return cc.sys.LANGUAGE_ENGLISH}return t},cleverapps.Settings.prototype.getSaveInfo=function(e){var t={sound:this.sound,music:this.music,vibro:this.vibro,language:this.language,fpsMode:this.fpsMode};return e&&(t.height=this.height),t},cleverapps.Settings.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SETTINGS,this.getSaveInfo(!0)),
cleverapps.synchronizer.addUpdateTask("settings")},cleverapps.Settings.prototype.loadData=function(e){void 0===e?(this.sound=!0,this.music=!0,this.vibro=!0,this.language=cleverapps.Settings.getDefaultLanguage(),this.fpsMode=cleverapps.Settings.FPS_MODE_AUTO,this.save()):(this.sound=e.sound,this.music=e.music,this.vibro=void 0===e.vibro||e.vibro,this.language=e.language,this.height=e.height,this.manualResolution=e.manualResolution,this.manualResolution&&(this.resolution=this.manualResolution),this.fpsMode=void 0===e.fpsMode?cleverapps.Settings.FPS_MODE_AUTO:e.fpsMode),void 0===this.language&&(this.language=cleverapps.Settings.getDefaultLanguage())},cleverapps.Settings.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SETTINGS);this.loadData(e)},cleverapps.Settings.prototype.toggleSound=function(){this.sound=!this.sound,this.save(),this.onChangeSoundListener()},cleverapps.Settings.prototype.toggleMusic=function(){this.music=!this.music,
cleverapps.audio.onChangeMusic(),this.save(),this.onChangeMusicListener()},cleverapps.Settings.prototype.toggleVibro=function(){this.vibro=!this.vibro,this.save(),this.onChangeVibroListener()},cleverapps.Settings.prototype.setLanguage=function(e){this.language=e,this.save(),this.onChangeLanguageListener()},cleverapps.Settings.prototype.calcHeight=function(){var e=cc.view.getFrameSize().height;return"undefined"!=typeof window&&window.screen&&window.screen.height&&(e=Math.max(e,window.screen.height)),cleverapps.Mobage.isAppropriate()&&(e=cleverapps.Mobage.HEIGHT),this.height!==e&&(this.height=e,this.save()),e},cleverapps.Settings.prototype.calcResolution=function(){if(void 0!==this.resolution&&resolutions[this.resolution])return this.resolution;var e=this.calcHeight(),t=1;cc.sys.isNative||(t=Math.min(2,window.devicePixelRatio||1));var i=e*t,s=Object.keys(resolutions),n=s.filter(function(e){return resolutions[e].mobile});0<n.length&&(cc.sys.isMobile?s=n:n.length<s.length&&(
s=cleverapps.substract(s,n))),s=s.sort(function(e,t){return resolutions[e].scale-resolutions[t].scale});for(var o=function(e){var t=e.scale*cleverapps.styles.SCENE_HEIGHT;return i<=t?t-i:100*(i-t)},a=0,r=o(resolutions[s[a]]),l=1;l<s.length;l++){var c=o(resolutions[s[l]]);c<r&&(r=c,a=l)}return this.resolution=s[a]},cleverapps.Settings.prototype.setManualResolution=function(e){this.manualResolution=e;var t=this.getSaveInfo();t.manualResolution=this.manualResolution,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SETTINGS,t),cleverapps.DataLoader.processSaveQueue(),window.location.reload()},cleverapps.Settings.prototype.updateFrameRateByFpsMode=function(){},cleverapps.Settings.prototype.setFpsMode=function(e){this.fpsMode=e,this.updateFrameRateByFpsMode(),this.save()},cleverapps.Settings.SOURCE_LOAD_LOW_THRESHOLD=3e4,cleverapps.Settings.FPS_MODE_AUTO=-1,cleverapps.Settings.FPS_MODE_LOW=0,cleverapps.Settings.FPS_MODE_HIGH=1;var Event=function(e){this.features=e.features||[],
this.options=e.options||{},this.projects=e.projects,this.networks=e.networks,this.start=this.convertTimezone(e.start),this.finish=this.convertTimezone(e.finish),this.debug=e.debug,this.toolApplicable=e.toolApplicable};Event.prototype.convertTimezone=function(e){var t=new Date(e);return new Date(t.getTime()+t.getTimezoneOffset()*cleverapps.parseInterval("1 minute"))},Event.prototype.isRunning=function(){return this.start.getTime()<=Date.now()&&Date.now()<=this.finish.getTime()},Event.prototype.getTimeLeft=function(){return this.finish.getTime()-Date.now()},Event.prototype.activate=function(){};var EventManager=function(){this.currentFeatures={},this.events=cc.loader.getRes(bundles.main.jsons.friday_schedule),this.setCurrentFeatures()};EventManager.prototype.isActive=function(e){return this.currentFeatures[e]&&this.currentFeatures[e].isRunning()},EventManager.prototype.listCurrentFeatures=function(){return Object.keys(this.currentFeatures).filter(function(e){
return this.currentFeatures[e].isRunning()},this)},EventManager.prototype.getFeatureEvent=function(e){return this.currentFeatures[e]},EventManager.prototype.isEventApplicable=function(e){return cleverapps.config.debugMode&&void 0!==e.toolApplicable?e.toolApplicable:!!e.isRunning()&&((!e.networks||-1!==e.networks.indexOf(cleverapps.User.calcSource()))&&((!e.projects||-1!==e.projects.indexOf(cleverapps.config.name))&&!(e.debug&&!cleverapps.config.debugMode)))},EventManager.prototype.setCurrentFeatures=function(){var e=this.events.map(function(e){return new Event(e)}).filter(this.isEventApplicable.bind(this));this.currentFeatures={},e.forEach(function(t){t.features.forEach(function(e){this.currentFeatures[e]=t}.bind(this)),t.activate()},this)};var CommunityManager=function(){var e=cleverapps.User.calcChannel("promo");e&&this.update(e)};CommunityManager.prototype.update=function(e){var t=function(e){this.reward=e}.bind(this);cleverapps.RestClient.post("/community/"+cleverapps.user.id+"/"+e
,{},t,function(e){console.log("failed updating community",e)})},CommunityManager.prototype.isRewardAvailable=function(){return this.reward},CommunityManager.prototype.receiveReward=function(){cleverapps.metha.display({focus:"RewardedCommunityManagerReward",action:function(e){new RewardWindow({reward:this.reward}),this.reward=void 0,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})};var Placements=function(){this.data=this.initialize(),this.sortKeys(),this.load(),cleverapps.whenAllInitialized(function(){this.run(Placements.STARTUP)}.bind(this)),cleverapps.metha.onFocusLostListenerPlacements=function(){cleverapps.environment.isGameScene()?this.run(Placements.FREE_FOCUS_GAME):cleverapps.environment.isMainScene()?this.run(Placements.FREE_FOCUS_MAIN):this.run(Placements.FREE_FOCUS_OTHER),cleverapps.metha.isFocused()||cleverapps.environment.isMethaScene()&&this.run(Placements.FREE_FOCUS_METHA)}.bind(this),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,cleverapps.throttle(1e3,
function(){this.run(Placements.ONSHOW_NO_FOCUS_CHECK),setTimeout(function(){cleverapps.metha.isFocused()?cleverapps.metha.whenFreeFocus(function(){this.run(Placements.ONSHOW)}.bind(this)):this.run(Placements.ONSHOW)}.bind(this),300)}.bind(this)))};Placements.prototype.sortKeys=function(){this.sortedKeys=Object.keys(this.data),this.sortedKeys.sort(function(e,t){return e=this.data[e],((t=this.data[t]).priority||0)-(e.priority||0)}.bind(this)),this.keysByType={}},Placements.prototype.listKeys=function(t){return this.keysByType[t]?this.keysByType[t]:this.keysByType[t]=this.sortedKeys.filter(function(e){return 0!=(this.data[e].type&t)},this)},Placements.prototype.initialize=function(){return{dailyCupReward:{type:Placements.FREE_FOCUS,filter:function(){return DailyCup.IsAvailable(DailyCup.TYPE_DAILY)&&void 0!==cleverapps.dailyCup.calcRewardPlace()&&cleverapps.environment.isDailyCupScene()},action:function(){cleverapps.dailyCup.giveReward()}},weeklyCupReward:{type:Placements.FREE_FOCUS,
filter:function(){return DailyCup.IsAvailable(DailyCup.TYPE_WEEKLY)&&void 0!==cleverapps.weeklyCup.calcRewardPlace()&&cleverapps.environment.isMainScene()},action:function(){cleverapps.weeklyCup.giveReward()}},recalculateFlags:{type:Placements.ONSHOW_OR_STARTUP|Placements.INTERMEDIATE_OR_AFTER_FINISH,action:function(){cleverapps.flags.update()}},versionCheck:{type:Placements.ONSHOW_OR_STARTUP,action:function(){cleverapps.versionChecker.check()},interval:"1 hour"},versionCheckAlert:{type:Placements.FREE_FOCUS,priority:10,filter:function(){return cleverapps.versionChecker.needUpdate()},action:function(){cleverapps.metha.display({focus:"VersionChecker.Alert",action:function(e){new NewVersionWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})}},stuckwindow:{type:Placements.FREE_FOCUS_MAIN,action:StuckWindow.displayIfNeeded,priority:0,interval:"3 day"},communityManagerReward:{type:Placements.FREE_FOCUS_MAIN,priority:9,interval:"10 minutes",filter:function(){
return cleverapps.communityManager.isRewardAvailable()},action:function(){cleverapps.communityManager.receiveReward()}},displaySceneIntro:{type:Placements.FREE_FOCUS,priority:-1e3,filter:function(){return cc.director.getRunningScene().needDisplayIntro&&!cleverapps.flags.introDisabled},action:function(){cc.director.getRunningScene()._playIntro()}},packManagerLowBalance:{type:Placements.FREE_FOCUS_MAIN,priority:3,filter:function(){return cleverapps.packManager.isAvailable()&&cleverapps.user.gold<100},action:function(){cleverapps.metha.display({focus:"showPackWindow",action:function(e){new PackWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:"5 minute"},packManager:{type:Placements.FREE_FOCUS_MAIN,priority:3,filter:function(){return cleverapps.packManager.isAvailable()&&100<=cleverapps.user.gold},action:function(){cleverapps.metha.display({focus:"showPackWindow",action:function(e){new PackWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:"3 day"},createShortcut:{
type:Placements.FREE_FOCUS,filter:function(){return Placements.needCreateShortcut},action:function(){Placements.needCreateShortcut=!1,cleverapps.social.createShortcut()},interval:"10 minutes"},addShortcut:{type:Placements.VICTORY,filter:function(){return cleverapps.social.createShortcut&&levels.user.checkAvailable(cleverapps.Availables.CREATE_SHORTCUT)},action:function(){Placements.needCreateShortcut=!0},interval:"10 minutes"},canUpgradeHeroes:{type:Placements.FREE_FOCUS_MAIN,priority:-1,filter:function(){return"undefined"!=typeof match3&&void 0!==match3.heroes&&(match3.heroes.available()&&cleverapps.forces.isShown(Forces.HEROES_AVAILABLE.id)&&match3.heroes.canUpgradeSomebody())},action:function(){cleverapps.metha.display({focus:"CanUpgradeHeroWindow",action:function(e){new CanUpgradeHeroWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:"10 minutes"},piggyBankFull:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return cleverapps.piggyBank.isActive(
)&&cleverapps.piggyBank.isFull()},action:function(){cleverapps.metha.display({focus:"PiggyBankWindow",control:"MenuBarGoldItem",action:function(e){new PiggyBankWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:"1 hour"},VKPromo:{type:Placements.ONSHOW_OR_STARTUP,filter:function(){return cleverapps.social instanceof cleverapps.VK},action:function(){cleverapps.social.isPromoAvailable("2020-12-10","2021-01-24",["tripeaks","riddles","heroes"])&&cleverapps.social.processPromo(8),cleverapps.social.isPromoAvailable("2020-12-21","2021-01-17",["tripeaks","riddles","heroes"])&&cleverapps.social.processPromo(7)}},checkCompensatePayments:{type:Placements.INTERMEDIATE,filter:function(){return cleverapps.payments.canCompensate()},action:function(){cleverapps.payments.compensate()},interval:"1 second"},showCompensation:{type:Placements.FREE_FOCUS,filter:function(){return void 0!==cleverapps.payments.compensateProductCode},action:function(){var e=new Product(
cleverapps.payments.compensateProductCode);cleverapps.payments.compensateProductCode=void 0,e.compensate()},interval:"1 second"},subscription:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return cleverapps.subscription&&cleverapps.subscription.isRewardReady()},action:function(){cleverapps.metha.display({focus:"SubscriptionWindow",action:function(e){new SubscriptionWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:"10 minute"},subscriptionOffer:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return SubscriptionIcon.IsAvailable()&&!cleverapps.subscription.isActive()&&cleverapps.subscription.canBuyTrial()},action:function(){cleverapps.metha.display({focus:"SubscriptionWindow",action:function(e){new SubscriptionWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:-1!==["mobile_ok","web_ok"].indexOf(cleverapps.User.calcSource())?"30 minutes":"3 day"},dailyCup:{type:Placements.INTERMEDIATE_OR_AFTER_FINISH|Placements.ONSHOW_OR_STARTUP,filter:function(){
return cleverapps.dailyCup&&DailyCup.IsAvailable(DailyCup.TYPE_DAILY)},action:function(){cleverapps.dailyCup.reload()}},weeklyCup:{type:Placements.INTERMEDIATE_OR_AFTER_FINISH|Placements.ONSHOW_OR_STARTUP,filter:function(){return cleverapps.weeklyCup&&DailyCup.IsAvailable(DailyCup.TYPE_WEEKLY)},action:function(){cleverapps.weeklyCup.reload()}},promotion:{type:Placements.FREE_FOCUS_MAIN,priority:-1,filter:function(){return cleverapps.promotion.isReady()},action:function(){cleverapps.metha.display({focus:"PromotionWindow",action:function(e){cleverapps.Promotion.ShowFirstAvailable(),cleverapps.metha.onceNoWindowsListener=e}})},interval:"3 days"},starChest:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return cleverapps.starChest&&!cleverapps.starChest.locked},action:function(){cleverapps.metha.display({focus:"StarChestWindow",action:function(e){new StarChestWindow,cleverapps.metha.onceNoWindowsListener=e}})}},unlimitedLivesStart:{type:Placements.ONSHOW_OR_STARTUP,filter:function(){
return cleverapps.lives},action:function(){0!==levels.user.episode||cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)||(cleverapps.tempGoods.buyGood(cleverapps.TempGoods.UNLIMITED_LIVES,cleverapps.parseInterval("3 hours")),cleverapps.lives.onBuyUnlimitedLivesListener())}},unlimitedLivesWindow:{type:Placements.FREE_FOCUS,priority:0,filter:function(){return cleverapps.lives&&(cleverapps.environment.isMainScene()||cleverapps.environment.isDailyCupScene())},action:function(){cleverapps.tempGoods.displayPromotionOnFinish()}},nativeInstall:{type:Placements.FREE_FOCUS_MAIN,priority:3,filter:function(){return"match3"===cleverapps.config.type},action:function(){cc.sys.isMobile&&!cc.sys.isNative&&-1===["mobile_ok","mobile_vk","mobile_mm","instant","sp_mbga","huzcom","plinga","pliega"].indexOf(cleverapps.User.calcSource())&&cleverapps.metha.display({focus:"NativeInstallWindow",action:function(e){new NativeInstallWindow,cleverapps.metha.onceNoWindowsListener=e}})},
interval:"5 day"},minigameNudge:{type:Placements.FREE_FOCUS_MAIN,priority:4,filter:function(){return 0<cleverapps.missionManager.getPlayableMissions().length},action:function(){for(var e=cleverapps.missionManager.getPlayableMissions(),t=0;t<e.length;t++){var i=e[t];if(i.nudgeWindow&&i.started&&(void 0===i.needShowStartWindow||i.needShowStartWindow))return void cleverapps.metha.display({focus:"NudgeWindow",action:function(e){new i.nudgeWindow(i),cleverapps.metha.onceNoWindowsListener=e}})}},interval:"10 minutes"},localstorageDisabled:{type:Placements.FREE_FOCUS_MAIN,priority:6,filter:function(){return!cleverapps.DataLoader.enabled&&!cleverapps.DataLoader.alerted},action:function(){cleverapps.DataLoader.alerted=!0,cleverapps.metha.display({focus:"LocalStorageDisabledWindow",action:function(e){new LocalStorageDisabledWindow,cleverapps.metha.onceNoWindowsListener=e}})}},sideBarForce:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return void 0!==cleverapps.sideBar.anyIconWithForceIndex(
)},action:function(){cleverapps.sideBar.showAnyForce()}},cryptexForce:{type:Placements.FREE_FOCUS_GAME,priority:5,filter:function(){return Game.currentGame&&Game.currentGame.cryptex&&Game.currentGame.cryptex.canShowForce()},action:function(){Game.currentGame.cryptex.showForce()}},cryptexOpen:{type:Placements.FREE_FOCUS_GAME,priority:5,filter:function(){return Game.currentGame&&Game.currentGame.cryptex&&Game.currentGame.cryptex.isOpen()&&(Game.currentGame.outcome!==GameBase.OUTCOME_UNKNOWN||cleverapps.flags.allowGameplayInterruption)&&!Game.currentGame.cryptex.noRewardWindow},action:function(){Game.currentGame.cryptex.displayOpen()}},cookieJarOpen:{type:Placements.FREE_FOCUS_GAME,priority:4,filter:function(){return Game.currentGame&&levels.cookieJar&&levels.cookieJar.isFull()&&(Game.currentGame.outcome!==GameBase.OUTCOME_UNKNOWN||cleverapps.flags.allowGameplayInterruption)},action:function(){levels.cookieJar.displayGiveReward()}},playChangeOutcome:{type:Placements.FREE_FOCUS_GAME,
priority:0,filter:function(){return cc.director.getRunningScene().wantAnimateChangeOutcome},action:function(){cc.director.getRunningScene().playChangeOutcome()}},gunForce:{type:Placements.FREE_FOCUS_GAME,priority:5,filter:function(){return Game.currentGame&&cleverapps.gun.isForceAvailable()},action:function(){cleverapps.gun.showForce()}},heroesUnlockTutorial:{type:Placements.FREE_FOCUS_OTHER,filter:function(){return cleverapps.environment.isHeroesScene()&&"undefined"!=typeof match3&&match3.heroes.canUnlockTutorial()},action:function(){match3.heroes.unlockTutorial()}},heroesUpgradeTutorial:{type:Placements.FREE_FOCUS_OTHER,filter:function(){return cleverapps.environment.isHeroesScene()&&"undefined"!=typeof match3&&match3.heroes.canUpgradeTutorial()&&!match3.heroes.canUnlockTutorial()},action:function(){match3.heroes.upgradeTutorial()}},homefixNewTask:{type:Placements.FREE_FOCUS_METHA,filter:function(){return cleverapps.metha.getType()==Metha.HOMEFIX&&cleverapps.home.needNewTask()},
action:function(){var e=cleverapps.home.furniture.filter(function(e){return e.readyToOpen()});cleverapps.metha.display({focus:"homefixNewTask",actions:e.map(function(t){return function(e){cleverapps.home.giveNewTask(e,t)}})})}},toolbarForce:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return cleverapps.toolbar.anyItemWithForce()},action:function(){cleverapps.toolbar.showAnyForce()}},keypadForce:{priority:-1001,type:Placements.FREE_FOCUS_GAME,filter:function(){return Game.currentGame&&Game.currentGame.keypad&&Game.currentGame.keypad.isForceAvailable()},action:function(){Game.currentGame.keypad.showForce()}},knockoutTutorial:{type:Placements.FREE_FOCUS,filter:function(){return cleverapps.isKnockoutGame()&&cleverapps.knockoutTutorial.isAvailable()},action:function(){cleverapps.metha.display({focus:"KnockoutTutorialStep"+cleverapps.knockoutTutorial.step,control:cleverapps.knockoutTutorial.control,action:function(e){cleverapps.knockoutTutorial.run(e)}})}},missionFinished:{
type:Placements.FREE_FOCUS_MAIN,priority:5,filter:function(){return cleverapps.missionManager.anyCompleted()},action:function(){cleverapps.missionManager.showCompleted()}},missionManagerProcess:{type:Placements.FREE_FOCUS_MAIN,priority:5,action:function(){cleverapps.missionManager.run()}},missionStarted:{type:Placements.FREE_FOCUS_MAIN,priority:5,filter:function(){return cleverapps.missionManager.pendingStartWindow()},action:function(){cleverapps.missionManager.showStartWindow()}},friendsCache:{type:Placements.ONSHOW_OR_STARTUP,filter:function(){return cc.sys.isNative},action:function(){cleverapps.friends.reload(),cleverapps.invitalbleFriends.reload()}},parallax:{type:Placements.ONSHOW_OR_STARTUP,action:function(){cleverapps.Parallax.refresh()}},localPushes:{type:Placements.ONSHOW_OR_STARTUP,action:function(){cleverapps.localPushes.onShow()}},syncClientSessionExpiredWindow:{type:Placements.FREE_FOCUS,priority:1e4,filter:function(){
return cleverapps.synchronizer.needClientSessionExpiredWindow()},action:function(){cleverapps.synchronizer.showClientSessionExpiredWindow()}},syncReloadWindow:{type:Placements.FREE_FOCUS,priority:10001,filter:function(){return cleverapps.synchronizer._syncIn.needShowReloadWindow()},action:function(){cleverapps.synchronizer._syncIn.showReloadWindow()}},syncSocialConnectWindow:{type:Placements.FREE_FOCUS,priority:10,filter:function(){return cleverapps.synchronizer.wantsSocialConnectWindow},action:function(){cleverapps.synchronizer.displaySocialConnectWindow()}},sync:{type:Placements.ONSHOW_NO_FOCUS_CHECK,action:function(){cleverapps.synchronizer.syncWhenReady()},interval:"30 seconds"},nativeCheckConnection:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return cc.sys.isNative&&!cleverapps.social.isLoggedIn()&&cleverapps.user.checkAvailable({episode:1,level:2})},action:function(){cleverapps.metha.display({focus:"nativeCheckConnection",action:function(e){
cleverapps.social.checkConnection(e,e)}})},interval:"7 days"},bounty:{type:Placements.ONSHOW_OR_STARTUP|Placements.INTERMEDIATE,action:function(){cleverapps.bountyManager.sendIfNeed()}},subscriptionReload:{type:Placements.ONSHOW_OR_STARTUP,filter:function(){return Subscription.IsModelAvailable()},action:function(){cleverapps.subscription.reload()}},userDAU:{type:Placements.ONSHOW_OR_STARTUP,action:function(){cleverapps.user.calcIdfa(),cleverapps.user.visited<Date.now()-cleverapps.parseInterval(cleverapps.User.ON_SHOW_CHANGE_VISITED)&&(cleverapps.user.updateVisited(),cleverapps.user.reportDAU(!0))}},battlePassPassed:{type:Placements.FREE_FOCUS_MAIN,filter:function(){if("board"===cleverapps.config.type)return!1;var e=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_BATTLEPASS);if(e){var t=e.battlePass;return t.lastShownLvl<t.currentLevel()}},action:function(){cleverapps.metha.display({focus:"BattlePassWindow",action:function(e){new BattlePassWindow(
cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_BATTLEPASS)),cleverapps.metha.onceNoWindowsListener=e}})}},wardrobeItemReceived:{type:Placements.FREE_FOCUS_MAIN,priority:8,filter:function(){var e=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_WARDROBE);return e&&e.logic.stageToShow},action:function(){var t=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_WARDROBE),i=t.logic.stageToShow;cleverapps.metha.display({focus:"WardrobeWindow",actions:[function(e){new WardrobeReceiveWindow(t,WardrobeWindow.prizes[i]),cleverapps.metha.onceNoWindowsListener=e,cleverapps.eventLogger.logEvent("receive_"+cleverapps.styles.WardrobeWindow.eventName+"_"+i),t.logic.stageToShow=void 0},function(e){t.logic.runReceiveDialogue(e)},function(e){t.logic.givePrize(i,e)},function(e){new WardrobeWindow(t),cleverapps.metha.onceNoWindowsListener=e}]})}},appleRestore:{type:Placements.FREE_FOCUS_MAIN,filter:function(){
return cc.sys.os===cc.sys.OS_IOS&&cc.sys.isNative&&cc.sys.isWebView&&cleverapps.subscription&&!cleverapps.subscription.isActive()},action:function(){cleverapps.payments.restore()},interval:"1 month"},appleBuyStoreProduct:{type:Placements.FREE_FOCUS,filter:function(){return cc.sys.os===cc.sys.OS_IOS&&cc.sys.isNative&&cc.sys.isWebView&&cleverapps.payments.storeProductName},action:function(){cleverapps.payments.buyStoreProduct()}},raceShowProgress:{type:Placements.FREE_FOCUS_OTHER,filter:function(){return cc.director.getRunningScene().needProgressShow},action:function(){cc.director.getRunningScene().showProgress()}},teaserRaffle:{type:Placements.FREE_FOCUS_MAIN,filter:function(){var e=-1!==cleverapps.eventManager.listCurrentFeatures().indexOf("raffle"),t=!cleverapps.user.checkAvailable(Missions[Mission.TYPE_RAFFLE].available);return e&&RaffleMissionLogic.IsAvailable()&&t&&1<levels.user.getHumanReadableNumber()},action:function(){cleverapps.metha.display({focus:"RaffleWindow_teaser",
action:function(e){new RaffleWindow(void 0),cleverapps.metha.onceNoWindowsListener=e}})},interval:"1 day"},animatePassLevel:{type:Placements.FREE_FOCUS_MAIN,priority:-2,filter:function(){return PlayButton.IsAvailable()&&cleverapps.playButton.passedLevel},action:function(){cleverapps.playButton.animatePassLevel()}},simpleUpdateProgress:{type:Placements.FREE_FOCUS_MAIN,priority:-2,filter:function(){return cleverapps.metha.getType()===Metha.SIMPLE&&0<cleverapps.simple.pendingsStars&&!cleverapps.simple.canMoveNext()},action:function(){cleverapps.simple.updateProgress()}},simpleMoveNext:{type:Placements.FREE_FOCUS_MAIN,priority:9,filter:function(){return cleverapps.metha.getType()===Metha.SIMPLE&&cleverapps.simple.canMoveNext()},action:function(){cleverapps.metha.display({focus:"simpleMoveNext",control:["play_button","progress_view"],actions:[function(e){PlayButton.IsAvailable()&&cleverapps.playButton.passedLevel&&cleverapps.playButton.animatePassLevel(),
0<cleverapps.simple.pendingsStars?cleverapps.simple.updateProgress(e):e()},function(e){cleverapps.simple.moveNext(e)}]})}}}},Placements.prototype.resetAllPlacements=function(){this.lastStarts={},this.save()},Placements.prototype.run=function(e){for(var t=this.listKeys(e),i=0;i<t.length;i++){var s=t[i],n=this.data[s];if(n.interval){var o=cleverapps.parseInterval(n.interval);if((this.lastStarts[s]||0)+o>Date.now())continue}if(!n.filter||n.filter()){var a=0!=(n.type&Placements.FREE_FOCUS);if(a){if(cleverapps.metha.isFocused())continue;if(-1===n.priority&&this.lastFreeFocusStart+cleverapps.parseInterval("1 minute")>Date.now())continue}if(n.action(),this.lastStarts[s]=Date.now(),a&&cleverapps.metha.isFocused()){this.lastFreeFocusStart=Date.now();break}}}this.save()},Placements.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PLACEMENTS);this.lastStarts={},e&&e.lastStarts&&(this.lastStarts=e.lastStarts)},Placements.prototype.save=function(){
cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PLACEMENTS,{lastStarts:this.lastStarts})},Placements.STARTUP=1,Placements.INTERMEDIATE=2,Placements.VICTORY=4,Placements.LOSE=16,Placements.AFTER_GAME_FINISH=32,Placements.ONSHOW=128,Placements.FREE_FOCUS_MAIN=256,Placements.FREE_FOCUS_GAME=512,Placements.FREE_FOCUS_METHA=1024,Placements.FREE_FOCUS_OTHER=2048,Placements.ONSHOW_NO_FOCUS_CHECK=4096,Placements.FREE_FOCUS=Placements.FREE_FOCUS_MAIN|Placements.FREE_FOCUS_GAME|Placements.FREE_FOCUS_OTHER,Placements.ONSHOW_OR_STARTUP=Placements.ONSHOW|Placements.STARTUP,Placements.INTERMEDIATE_OR_AFTER_FINISH=Placements.INTERMEDIATE|Placements.AFTER_GAME_FINISH;var PlaySession=function(){this.load(),this.onEndSessionListeners=[PlaySession.ViralSentReporter,PlaySession.RewardedReporter,PlaySession.DailyTasksReporter,PlaySession.HelpByAttemptsReporter,PlaySession.SettingsReporter,PlaySession.DailyCupReporter,PlaySession.MiniGameReporter,PlaySession.MissionReporter,PlaySession.RaceReporter,
PlaySession.PaymentReporter]};PlaySession.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PLAY_SESSION);e||(e={}),this.data=e},PlaySession.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PLAY_SESSION,this.data)},PlaySession.prototype.endSession=function(){this.onEndSessionListeners.forEach(function(e){e(this.data)},this),this.data={},this.save()},PlaySession.prototype.inc=function(e,t){void 0===t&&(t=1);var i=this.data[e];void 0===i&&(i=0),this.set(e,i+t)},PlaySession.prototype.set=function(e,t){this.data[e]=t,this.save()},PlaySession.prototype.notifyActive=function(){var e=this.nextSendActive||0;if(Date.now()>=e){this.nextSendActive=Date.now()+cleverapps.parseInterval(PlaySession.ACTIVE_TIME_INTERVAL);var t=cleverapps.user.getDaysSinceRegistration(),i="RETENTION_"+t;cleverapps.EVENTS[i]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.ACTIVE_TIME+"_"+t)}},PlaySession.SettingsReporter=function(e){
cleverapps.eventLogger.logEvent("resolution_"+cleverapps.settings.calcResolution()),cleverapps.settings.fpsMode===cleverapps.Settings.FPS_MODE_LOW?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FPS_LOW):cleverapps.settings.fpsMode===cleverapps.Settings.FPS_MODE_HIGH?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FPS_HIGH):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FPS_AUTO)},PlaySession.ViralSentReporter=function(e){void 0===e.viral||0===e.viral?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.VIRAL_SENT_NONE):e.viral<=3?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.VIRAL_SENT_3):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.VIRAL_SENT_REST)},PlaySession.RewardedReporter=function(e){cleverapps.whenAllInitialized(function(){RewardedAdsManager.IsEnabled()&&levels.user.checkAvailable(RewardedAdsManager.AVAILABLE)&&e[cleverapps.EVENTS.AD_READY+"_"+RewardedAdsManager.REWARDED]&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_AVAILABLE),
e[cleverapps.EVENTS.REWARDED_WATCHED]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_WATCHED))})},PlaySession.HelpByAttemptsReporter=function(e){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HELP_BY_ATTEMPTS_DAU);var t=e[cleverapps.EVENTS.HELP_BY_FIVE_ATTEMPTS];1<=t&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HELP_BY_ATTEMPTS_ONE_AND_MORE),3<=t&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HELP_BY_ATTEMPTS_THREE_AND_MORE),5<=t&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HELP_BY_ATTEMPTS_FIVE_AND_MORE)},PlaySession.DailyTasksReporter=function(e){if(levels.user.checkAvailable(cleverapps.Availables.DAILY_TASKS)){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SESSION_DAILY_TASK_AVAILABLE),e[cleverapps.EVENTS.SESSION_DAILY_TASK_OPEN_WINDOW]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SESSION_DAILY_TASK_OPEN_WINDOW);var t=e[cleverapps.EVENTS.SESSION_DAILY_TASK_FINISH];t&&(3<t&&(t=3),cleverapps.eventLogger.logEvent(
cleverapps.EVENTS.SESSION_DAILY_TASK_FINISH+"_"+t));var i=e[cleverapps.EVENTS.SESSION_DAILY_TASK_REWARD];i&&(3<i&&(i=3),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SESSION_DAILY_TASK_REWARD+"_"+i))}},PlaySession.DailyCupReporter=function(e){e[cleverapps.EVENTS.DAILY_CUP_DAU]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_CUP_DAU),e[cleverapps.EVENTS.DAILY_CUP_PLAYERS]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_CUP_PLAYERS)},PlaySession.MiniGameReporter=function(t){Object.keys(t).forEach(function(e){0===e.indexOf(cleverapps.EVENTS.MINIGAME_FINISH)&&t[e]&&cleverapps.eventLogger.logEvent(e+"_dau")})},PlaySession.MissionReporter=function(t){Object.keys(t).forEach(function(e){0===e.indexOf(cleverapps.EVENTS.MISSION_DAU)&&t[e]?cleverapps.eventLogger.logEvent(e):0===e.indexOf(cleverapps.EVENTS.MISSION_START_DAU)&&t[e]&&cleverapps.eventLogger.logEvent(e)})},PlaySession.RaceReporter=function(e){
e[cleverapps.EVENTS.RACE_LEVELS_PASSED]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.RACE_LEVELS_PASSED+"_"+e[cleverapps.EVENTS.RACE_LEVELS_PASSED]),e[cleverapps.EVENTS.RACE_LEVELS_PASSED_PREM]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.RACE_LEVELS_PASSED_PREM+"_"+e[cleverapps.EVENTS.RACE_LEVELS_PASSED_PREM])},PlaySession.PaymentReporter=function(t){[cleverapps.EVENTS.PAYMENT_OPEN,cleverapps.EVENTS.PAYMENT_FAILURE,cleverapps.EVENTS.PAYMENT_CANCEL,cleverapps.EVENTS.PAYMENT_NOT_REFRESHED,cleverapps.EVENTS.PAYMENT_NOT_INITIALIZED,cleverapps.EVENTS.PAYMENT_SUCCESS].forEach(function(e){t[e]&&cleverapps.eventLogger.logEvent(e)})},PlaySession.ACTIVE_TIME_INTERVAL="1 minute";var ExecutorPool=function(e){e=e||{},this.amount=e.amount||1e3,this.interval=e.interval||"1 second",this.events=new cleverapps.EventsQueue(this.interval),this.delay=cleverapps.parseInterval(e.delay||"0 second"),this.tasks=[],this.timeout=void 0};ExecutorPool.prototype.execute=function(e){this.tasks.push({
callback:e,event:Date.now()}),this.processFirst()},ExecutorPool.prototype.processFirst=function(){if(void 0!==this.timeout&&(clearTimeout(this.timeout),delete this.timeout),0!==this.tasks.length){var e=this.tasks[0],t=Date.now();if(e.event+100<t&&t<e.event+this.delay)this.timeout=setTimeout(this.processFirst.bind(this),t-e-this.delay);else{if(this.events.size()>=this.amount){var i=this.events.getShrinkLeftTime();if(i&&0<i&&this.events.size()>=this.amount)return void(this.timeout=setTimeout(this.processFirst.bind(this),i))}this.tasks.shift(),e.callback()!==cleverapps.NO_ACTION&&this.events.add(t),this.processFirst()}}},cleverapps.Flags=function(){this.init(),cleverapps.whenAllInitialized(function(){cleverapps.paymentsHistory.onAddPaymentListeners.flags=this.update.bind(this),cleverapps.payments.onAvailableListeners.flags=this.update.bind(this),this.initAbTestFlags()}.bind(this))},cleverapps.Flags.prototype.initAbTestFlags=function(){},cleverapps.Flags.prototype.init=function(){
var e=cleverapps.User.calcSource();this.noads=-1!==["huzcom","amazon","pliega"].indexOf(e),this.norest=-1!==["huzcom","pliega"].indexOf(e),this.noLogEvents=-1!==["huzcom","pliega"].indexOf(e),this.noviral=-1!==["huzcom","plinga","pliega"].indexOf(e),this.noshares=-1!==["android","amazon","ios","pliega"].indexOf(e),this.nologin=-1!==["huzcom","plinga","pliega"].indexOf(e),this.nocommunity=-1!==["huzcom","plinga","pliega"].indexOf(e),this.doubleRewards=-1!==["huzcom","plinga","pliega"].indexOf(e),this.reduceAds=-1!==["web_ok","mobile_ok","web_vk","mobile_vk","web_mm","mobile_mm"].indexOf(e),this.videoAdsMainMonetization=-1!==["plinga","instant"].indexOf(e),this.nofirebase=-1!==["pliega"].indexOf(e),this.noadjust=-1!==["pliega"].indexOf(e),this.nosocial=-1!==["pliega","huzcom"].indexOf(e),this.allowGameplayInterruption=!0,"olympics"===cleverapps.config.name&&(this.allowGameplayInterruption=!1)},cleverapps.Flags.prototype.reset=function(){this.init(),this.update()},
cleverapps.Flags.prototype.update=function(){this.nopayments=!cleverapps.payments.isAvailable(),(cleverapps.paymentsHistory.classify("3 month")!==cleverapps.PaymentsHistory.PAYER_NONE||cleverapps.user.getProgress()<20)&&(this.videoAdsMainMonetization||(this.noads=!0),(cc.sys.isNative||cleverapps.paymentsHistory.classify("1 month")>=cleverapps.PaymentsHistory.PAYER_WEAK||cleverapps.user.getProgress()<20)&&(this.noviral=!0,levels.friendRequests.deleteFakeRequests()));var e=cleverapps.User.calcSource();!this.noviral&&"instant"===e&&cleverapps.social.getPlatform&&"WEB"===cleverapps.social.getPlatform()&&(this.noviral=!0,levels.friendRequests.deleteFakeRequests())};var SuccessWait=function(e,t){this.task=e,this.callback=cleverapps.once(t),this.active=!0,this.timeout=void 0,this.run()};SuccessWait.prototype.run=function(){this.active&&(this.timeout=clearTimeout(this.timeout),this.task({onSuccess:this.onSuccess.bind(this),onFailure:this.onFailure.bind(this)}))},
SuccessWait.prototype.onSuccess=function(){this.callback(),this.clear()},SuccessWait.prototype.onFailure=function(e){if(cleverapps.checkStatus(e,404))return console.log("receive 404"),void this.clear();this.timeout=clearTimeout(this.timeout),this.timeout=setTimeout(this.run.bind(this),cleverapps.parseInterval("30 seconds"))},SuccessWait.prototype.cancel=SuccessWait.prototype.clear=function(){this.active=!1,this.timeout=clearTimeout(this.timeout)},cleverapps.Information=function(){this.data=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.INFORMATION),void 0===this.data&&(this.data={}),this.diff={}},cleverapps.Information.prototype.onChangeUserId=function(){this.diff=this.data,this.update()},cleverapps.Information.prototype.reportMaxTextureSize=function(){if("undefined"!=typeof gl){var e=gl.getParameter(gl.MAX_TEXTURE_SIZE);this.setKeyValue("maxTextureSize",e)}},cleverapps.Information.prototype.reportPhone=function(){var e={};if(e[cc.sys.OS_ANDROID]={
avatar:"#avatars/android_avatar.png",name:"Android"},e[cc.sys.OS_IOS]={avatar:"#avatars/ios_avatar.png",name:"iOS"},e[cc.sys.os]&&cc.sys.isNative){var t=cleverapps.social.isLoggedIn()&&"applesocial"!==cleverapps.social.getCode();this.data.avatar||t||cleverapps.info.setKeyValue("avatar",e[cc.sys.os].avatar),this.data.name||cleverapps.social.isLoggedIn()||cleverapps.info.setKeyValue("name",e[cc.sys.os].name+"_"+cleverapps.user.id.substr(-3))}"plinga"===cleverapps.User.calcSource()&&cleverapps.info.setKeyValue("avatar","#avatars/game_distribution.png")},cleverapps.Information.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.INFORMATION,this.data)},cleverapps.Information.prototype.setKeyValue=function(e,t){this.data[e]&&"resolution"===e||JSON.stringify(this.data[e])!==JSON.stringify(t)&&(this.data[e]=t,this.diff[e]=t,this.update())},cleverapps.Information.prototype.update=function(){this.save(),this._updateInner()},
cleverapps.Information.prototype._updateInner=cleverapps.accumulate(5e3,function(){console.log("Sending information: "+JSON.stringify(this.diff)),cleverapps.RestClient.post("/info/"+levels.user.id,this.diff,function(e){},function(){}),this.diff={}}),cleverapps.Information.prototype.reportUserAgent=function(){var e,t;if("object"==typeof DeviceInfoPlugin)e=DeviceInfoPlugin.getDeviceName(),t=DeviceInfoPlugin.getAndroidVersion();else if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isWebView)e=cleverapps.webViewData.deviceName,t=cleverapps.webViewData.deviceVersion;else if(cc.sys.isNative)e=cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","getDeviceName","()Ljava/lang/String;"):jsb.reflection.callStaticMethod("AppController","getDeviceName"),t=cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","getAndroidVersion","()Ljava/lang/String;"):jsb.reflection.callStaticMethod("AppController","getDeviceVersion"
);else{var i=(new UAParser).getResult(navigator.userAgent);e=i.browser.name,t=i.browser.major}this.setKeyValue("useragent",{browser:e,version:t})},cleverapps.Information.prototype.reportAppVersion=function(){this.setKeyValue("appversion",{version:cc.game.config.version,source:cleverapps.User.calcSource()})},cleverapps.Information.prototype.reportSysLanguage=function(){this.setKeyValue("syslanguage",cc.sys.language)};var ActionPlayer=function(e){this.actions=[],this.add(e)};ActionPlayer.prototype.add=function(e){Array.isArray(e)?e.forEach(function(e){this.add(e)}.bind(this)):e&&this.actions.push(e)},ActionPlayer.prototype._playNext=function(){this.index===this.actions.length||this._stopped||this.actions[this.index++](this._playNext.bind(this))},ActionPlayer.prototype.play=function(e){this.index=0,e&&this.actions.push(e),this._playNext()},ActionPlayer.prototype.stop=function(){this._stopped=!0},ActionPlayer.delay=function(t){return function(e){setTimeout(e,t)}};var Metha=function(){
this.enabled=!0,this.focus="initialize",this.controls=[],this.onceNoWindowsListener=void 0,this.controlsVisible=!0,this.lastControlsVisible={},this.onControlsListeners={},this.pendingListeners=[]};Metha.prototype.registerControl=function(e,t){if(!cleverapps.flags.controlsHideDisabled){if("object"==typeof t){var i=t;t=i.createListener(i.toggle.bind(i))}(this.onControlsListeners[e]=t)(!1,!0),this.lastControlsVisible[e]=!1,(this.controlsVisible||-1!==this.controls.indexOf(e))&&(t(!0),this.lastControlsVisible[e]=!0)}},Metha.prototype.updateControlsVisibility=function(){for(var e in this.onControlsListeners){var t=this.controlsVisible||-1!==this.controls.indexOf(e);this.lastControlsVisible[e]!==t&&(this.onControlsListeners[e](t),this.lastControlsVisible[e]=t)}},Metha.prototype.setControlsVisible=function(e){this.controlsVisible=e,this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(this.updateControlsVisibility.bind(this),100)},
Metha.prototype.debugMessage=function(e){if(cleverapps.config.debugMode)throw cc.sys.isNative&&!cc.sys.isWebView&&console.log((new Error).stack),e;var t=(new Error).stack;setTimeout(function(){throw e+" .. "+t},0)},Metha.prototype.displayWhenFreeFocus=function(e){this.isFocused()?this.whenFreeFocus(this.display.bind(this,e)):this.display(e)},Metha.prototype.whenFreeFocus=function(e){this.pendingListeners.push(e)},Metha.prototype.distract=function(e){this.isFocused()||this.debugMessage("Distract without focus! "+e.focus),this.focus!==e.focus?(this.focus=!1,this.display(e)):this.debugMessage("Distract same focus!"+e.focus)},Metha.prototype.display=function(e){if(!this.isFocused()&&(!e.filter||e.filter())){var t=e.focus;this.grabFocus(t,e);var i=e.actions||[e.action];this.compound(this.freeFocus.bind(this,t),i)}},Metha.prototype.compound=function(e,t,i,s){i=i||0,s=s||this.focus;this.focus===s&&(t.length!==i?t[i](this.compound.bind(this,e,t,i+1,s)):e())},
Metha.prototype.controlFreeFocus=function(e){Array.isArray(e)||(e=[e]),e.forEach(function(e){this.isFocused()&&this.controls.indexOf(e)<0&&(this.controls.push(e),this.onControlsListeners[e]&&this.onControlsListeners[e](!0))},this)},Metha.prototype.controlIsFocused=function(e){return!!this.isFocused()&&this.controls.indexOf(e)<0},Metha.prototype.controlGrabFocus=function(e){Array.isArray(e)||(e=[e]),e.forEach(function(e){this.isFocused()&&0<=this.controls.indexOf(e)&&(this.controls.splice(this.controls.indexOf(e),1),this.onControlsListeners[e]&&this.onControlsListeners[e](!1))},this)},Metha.prototype.trigger=function(){if(!this.isFocused()){for(;0<this.pendingListeners.length;){if(this.pendingListeners.shift()(),this.isFocused())return}this.onFocusLostListenerPlacements()}},Metha.prototype.grabFocus=function(e,t){!1!==this.focus&&this.debugMessage("Want to grab focus: "+e+" focus is already given: "+this.focus),console.log("Grab focus: "+e),this.triggerTimeout&&(clearTimeout(
this.triggerTimeout),this.triggerTimeout=void 0),this.focus=e,this.controls=[],t&&t.control&&(Array.isArray(t.control)?this.controls=t.control:this.controls=[t.control]),this.setControlsVisible(!1)},Metha.prototype.freeFocus=function(e){!1===this.focus&&this.debugMessage("Want to free focus: "+e+" focus is already free!"),this.focus===e?(console.log("Focus freed: "+this.focus),this.focus=!1,this.setControlsVisible(!0),this.triggerTimeout=setTimeout(this.trigger.bind(this),0)):console.log("Wrong focus clearing: "+this.focus+" > "+e)},Metha.prototype.isFocused=function(){return!1!==this.focus},Metha.prototype.getType=function(){switch(cleverapps.config.metha){case"farm":return Metha.FARM;case"homefix":return Metha.HOMEFIX;case"knockout":return Metha.KNOCKOUT;case"simple":return Metha.SIMPLE;case"none":return Metha.NONE}return Metha.HOSE},Metha.prototype.withSimpleMain=function(){if(-1!==["wordsoup"].indexOf(cleverapps.config.name)){var e=cleverapps.User.calcSource();if(-1!==["mobile_ok",
"mobile_vk","mobile_mm"].indexOf(e)||cleverapps.isLocalhost())return!0}return!1},Metha.prototype.gotoMainScene=function(e){var t=this.getMainScene();cleverapps.scenes.replaceScene(new t,e)},Metha.prototype.getMainScene=function(){switch(this.getType()){case Metha.FARM:case Metha.HOMEFIX:return this.withSimpleMain()?MethaSimpleMainScene:MethaScene;case Metha.KNOCKOUT:return KnockoutScene;case Metha.SIMPLE:return SimpleMainScene;case Metha.NONE:return MergeScene;default:return levels.EpisodesScene}},Metha.prototype.getMainObject=function(){switch(this.getType()){case Metha.FARM:return cleverapps.farm;case Metha.HOMEFIX:return cleverapps.home;case Metha.KNOCKOUT:return cleverapps.knockout;case Metha.SIMPLE:return cleverapps.simple;case Metha.NONE:return{};default:return levels.episodes}},Metha.prototype.wantsToPlay=function(e,t){if(cleverapps.lives&&cleverapps.lives.isEmpty())return new ShopWindow({tab:ShopWindow.TABS.LIVES}),void(cleverapps.metha.onceNoWindowsListener=e)
;this.getMainObject().wantsToPlay(e,t)},Metha.prototype.wantsToReplay=function(e,t){var i=t.level;BoostersBefore.isAvailable()?this.getMainObject().wantsToReplay&&i.building?this.getMainObject().wantsToReplay(e,t):(new LevelStartWindow(t),cleverapps.metha.onceNoWindowsListener=e):i.play(e,t)},Metha.prototype.isControlEnabled=function(e){return!this.isFocused()||0<=this.controls.indexOf(e)},Metha.HOSE=0,Metha.FARM=1,Metha.HOMEFIX=2,Metha.KNOCKOUT=3,Metha.SIMPLE=4,Metha.NONE=5,cleverapps.User=function(i){if(cleverapps.EventEmitter.call(this),this.onCantTakeGold=function(){cleverapps.flags.nopayments?cleverapps.Notification.create("messages:NotEnoughCoins"):new ShopWindow({tab:ShopWindow.TABS.COINS})},this.onCantTakeExp=function(){},this.onLeagueChangeListener=function(){},this.onChangeGoldListeners={},this.onChangeExpListeners={},i)this.initializeNewPlayer();else{var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.ID);this.loadData(e),
this.lastReportDAU=this.getDaysSinceRegistration(e.visited)}var s=cleverapps.User.calcChannel();if(s&&(-1!==["web_ok","mobile_ok"].indexOf(this.source)||cleverapps.isLocalhost())){var t=(i?"user_channel_new_":"user_channel_old_")+s;cleverapps.eventLogger.logEvent(t),this.reportChannel=cleverapps.once(function(){var e=cleverapps.getRequestParameters(location.search);e.custom_args&&(e=decodeURIComponent(e.custom_args));var t={source:this.source,channel:s,isnewuser:i,parameters:JSON.stringify(e)};cleverapps.RestClient.post("/users/playsession/"+this.id,t)}.bind(this)),i||(setTimeout(this.reportChannel.bind(this),0),this.channel=s,e.visited+cleverapps.parseInterval("7 days")<Date.now()&&(this.registered=Date.now()))}this.save(),this.reportDAU(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){this.calcIdfa(),this.visited<Date.now()-cleverapps.parseInterval(cleverapps.User.ON_SHOW_CHANGE_VISITED)&&(this.updateVisited(),this.reportDAU(!0))}.bind(this))},
cleverapps.User.prototype=Object.create(cleverapps.EventEmitter.prototype),cleverapps.User.prototype.constructor=cleverapps.User,cleverapps.User.prototype.updateVisited=function(){this.visited=Date.now(),this.save()},cleverapps.User.prototype.saveAfterIncProgressCompare=cleverapps.timeredThrottle(cleverapps.parseInterval("30 seconds"),function(){this.needSave&&this.save()},Date.now()),cleverapps.User.prototype.incProgressCompare=function(e,t){e=e||1,this.progressCompare+=e,t||(this.needSave=!0,this.saveAfterIncProgressCompare())},cleverapps.User.prototype.reportDAU=function(e){void 0!==this.lastReportDAU&&this.lastReportDAU===this.getDaysSinceRegistration()||(this.lastReportDAU=this.getDaysSinceRegistration(),cleverapps.User.reportAmountFriendsDau=function(){if(cleverapps.friends){var e=cleverapps.friends.listIds().length;5<e&&(e=5),cleverapps.eventLogger.logEvent(cleverapps.EVENTS["DAU_WFRIENDS_"+e]),cleverapps.User.reportAmountFriendsDau=void 0}},
e&&cleverapps.User.reportAmountFriendsDau(),setTimeout(function(){if(cleverapps.playSession.endSession(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAU),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAU_LANGUAGE),this.gold<=1e6&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.USER_GOLD_DAU,{amount:this.gold}),cc.sys.isNative&&cleverapps.social.isLoggedIn()){var e=cleverapps.social.getCode();cleverapps.eventLogger.logEvent(e+"_loggedin_dau")}void 0!==cleverapps.abTest.group&&cleverapps.eventLogger.logEvent("abtest_"+cleverapps.abTest.group+"_"+cleverapps.EVENTS.DAU);var t=this.getDaysSinceRegistration(),i=function(){var e="RETENTION_"+t;cleverapps.EVENTS[e]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS[e])};0<t?i():(cleverapps.User.reportRetention=function(){cleverapps.user.checkAvailable(cleverapps.User.RETENTION_0_AVAILABLE)&&(i(),cleverapps.User.reportRetention=void 0)},cleverapps.User.reportRetention())}.bind(this),0))},
cleverapps.User.prototype.getDaysSinceRegistration=function(e){return Math.floor(((e||Date.now())-this.registered)/1e3/24/60/60)},cleverapps.User.prototype.loadData=function(e){this.id=e.id,this.id||(this.id=this.generateTmpId()),this.gold=e.gold,this.registered=e.registered,this.source=e.source,this.source||(this.source=cleverapps.User.calcSource()),this.channel=e.channel,this.visited=Date.now(),this.exp=e.exp,this.league=this.calcLeague(),e.idfa1&&(this.idfa=e.idfa1),this.abtest=e.abtest,this.progressCompare=e.progressCompare||0},cleverapps.User.prototype.isBeginner=function(){return this.episode<=1},cleverapps.User.prototype.isNovice=function(){return this.episode<=3&&1<this.episode},cleverapps.User.prototype.checkAvailable=function(e){return!0},cleverapps.User.prototype.generateTmpId=function(){return"__"+Math.floor(1e15*Math.random())},cleverapps.User.prototype.haveTmpId=function(){return 2<=this.id.length&&"__"===this.id.substr(0,2)},cleverapps.User.prototype.setGold=function(e){
var t=e-this.gold;0<t&&cleverapps.history.add("gold",t),0!==t&&(this.gold=e,this.incProgressCompare(30,!0),this.save(),cleverapps.values(this.onChangeGoldListeners).forEach(function(e){e(t)}))},cleverapps.User.prototype.canTakeGold=function(e){return this.gold>=e},cleverapps.User.prototype.expAvailable=function(){return"undefined"!=typeof match3&&match3.heroes&&match3.heroes.available()},cleverapps.User.prototype.canTakeExp=function(e){return this.exp>=e},cleverapps.User.prototype.takeGold=function(e){return 0===e||(cleverapps.history.add("spent",e),this.canTakeGold(e)?(cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.SPEND_COINS,e),cleverapps.playSession.inc(cleverapps.EVENTS.SPEND_COINS,e),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SPEND_COINS,{amount:e}),this.setGold(this.gold-e),!0):(this.onCantTakeGold(e-this.gold),!1))},cleverapps.User.prototype.takeExp=function(e){return 0===e||(this.canTakeExp(e)?(this.setExp(this.exp-e),!0):(this.onCantTakeExp(e-this.exp),!1))},
cleverapps.User.prototype.getSaveInfo=function(){return{id:this.id,gold:this.gold,registered:this.registered,visited:this.visited,source:this.source,channel:this.channel,exp:this.exp,idfa1:this.idfa,abtest:this.abtest,progressCompare:this.progressCompare}},cleverapps.User.prototype.afterSync=function(){this.league=this.calcLeague()},cleverapps.User.prototype.save=function(e){(this.needSave=!1)===e&&this.afterSync(),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.ID,this.getSaveInfo()),!1!==e&&(this.incProgressCompare(3,!0),cleverapps.synchronizer.addUpdateTask("users"))},cleverapps.User.prototype.prepareSmallGoldReward=function(e){var t=cleverapps.paymentsHistory.getLastPayment();if(t&&t.time>Date.now()-cleverapps.parseInterval("3 day"))return e;var i=1;return 1e3<=this.gold?i=.2:500<=this.gold&&(i=.5),Math.ceil(e*i)},cleverapps.User.prototype.setRandomBoostersReward=function(e){if(!e.randomBoosters)return e;e.boosters={};for(var t=0;t<e.randomBoosters.amount;t++){
var i=cleverapps.Random.choose(e.randomBoosters.types);e.boosters[i]=e.boosters[i]?e.boosters[i]+1:1}return delete e.randomBoosters,e},cleverapps.User.prototype.prepareRewardByRich=function(e,t){if(!e.gold&&!e.boosters&&!e.randomBoosters)return e;e=cleverapps.clone(e,!0),e=this.setRandomBoostersReward(e);var i=cleverapps.paymentsHistory.getLastPayment();if(i&&i.time>Date.now()-cleverapps.parseInterval("1 day"))return e;var s=!1;if(e.gold){var n=!0;i&&i.time>Date.now()-cleverapps.parseInterval("3 day")&&(n=!1);var o=1;1e3<=this.gold&&n?(o=.1,s=!0):600<=this.gold?(s=!0,o=.25):300<=this.gold&&(o=.5),e.gold=Math.max(5*Math.ceil(e.gold*o/5),t||0)}if(s){var a=[];if("match3"===cleverapps.config.type&&(a=[{stars:3,exp:1},{stars:3},{stars:2,exp:1},{exp:2}]),!e.unlimitedLives&&cleverapps.lives&&(a=a.concat([{unlimitedLives:"10 minutes"},{unlimitedLives:"15 minutes"},{unlimitedLives:"30 minutes"}])),0<a.length){var r=cleverapps.Random.choose(a);for(var l in r)e[l]?e[l]+=r[l]:e[l]=r[l]}}return e},
cleverapps.User.calcPriceCoef=function(){var e=cleverapps.User.calcSource();return"mobile_vk"===e||"web_vk"===e?.2625:"mobile_ok"===e||"web_ok"===e?.25:"web_mm"===e||"mobile_mm"===e?.25:"nk"===e?.125:"fotostrana"===e?.375:1},cleverapps.User.calcSource=function(){if(cleverapps.config.source)return cleverapps.config.source;if(cc.sys.isNative){if(cc.sys.os===cc.sys.OS_ANDROID)return"android";if(cc.sys.os===cc.sys.OS_IOS)return"ios"}var e=function(e){return-1!==window.location.href.indexOf(e)};return e("dr_auth_code")?"draugiem":e("logged_user_id")?e("mob=true")?"mobile_ok":"web_ok":e("api.vk.com")?e("vkmobile=true")?"mobile_vk":"web_vk":e("nk.pl")?"nk":e("fotostrana.ru")?"fotostrana":cleverapps.config.myMailRu&&e("app_id="+cleverapps.config.myMailRu.appId)?e("view=app_mobile")?"mobile_mm":"web_mm":e("source=spmobage")?"sp_mbga":e("mbga-platform.jp")?"mbga":"facebook"},cleverapps.User.calcChannel=function(e){if(!cc.sys.isNative){if(void 0===e&&(e="channel",cleverapps.VK.isAppropriate())
)return cleverapps.User.calcChannel("hash")||cleverapps.User.calcChannel("referrer")||"";var t=cleverapps.getRequestParameters(location.search);if(t.custom_args){var i=decodeURIComponent(t.custom_args);if(0<=i.indexOf(e)){t=cleverapps.getRequestParameters("?"+i);var s=JSON.stringify(t);if(-1!==s.indexOf("channel")){var n=!cleverapps.DataLoader.haveSavedData();setTimeout(function(){var e=Date.now(),t=cleverapps.user&&cleverapps.user.registered,i=Math.floor((e-t)/1e3/60/60);cleverapps.ReportStream.debug("now - "+e+" registered - "+t+" diffHours - "+i+" isNewUser - "+n+" custom_args = "+s)},1e3)}}}if(t[e])return t[e]}return""},cleverapps.User.prototype.setChannel=function(e){this.channel!==e&&(this.channel=e,this.save())},cleverapps.User.prototype.calcIdfa=function(){if(!this.idfa){var t=cleverapps.Adversting.getIdfa();t&&(this.idfa=t,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.ID,this.getSaveInfo()),cleverapps.RestClient.post("/users/idfa/"+levels.user.id,{idfa:this.idfa},
function(e){e.campaign&&(this.setChannel(e.campaign),cleverapps.Adversting.postbackUnity(t))}.bind(this),function(){console.log("Failed updating idfa: "+this.idfa),delete this.idfa,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.ID,this.getSaveInfo())}.bind(this)))}},cleverapps.User.prototype.initializeNewPlayerGold=function(){this.gold=100},cleverapps.User.prototype.initializeNewPlayer=function(){this.initializeNewPlayerGold(),this.id=this.generateTmpId(),this.registered=Date.now(),this.visited=Date.now(),this.source=cleverapps.User.calcSource(),this.channel=cleverapps.User.calcChannel(),this.exp=0,this.league=this.calcLeague(),this.progressCompare=0},cleverapps.User.prototype.calcLeague=function(){var e=0;if(!cleverapps.config.leagues)return e;for(;e<cleverapps.config.leagues.length&&cleverapps.config.leagues[e]&&this.getHumanReadableNumber()>cleverapps.config.leagues[e];)e++;return e},cleverapps.User.prototype.setExp=function(e){if(this.exp!==e){var t=e-this.exp;this.exp=e,
this.save(),cleverapps.values(this.onChangeExpListeners).forEach(function(e){e(t)})}},cleverapps.User.ON_SHOW_CHANGE_VISITED="1 hour",cleverapps.User.RETENTION_0_AVAILABLE={level:1},cleverapps.Scenes=function(){},cleverapps.Scenes.prototype.isLoaderScene=function(){var e=cc.director.getRunningScene();return e instanceof LoaderScene||!e},cleverapps.Scenes.prototype.runScene=function(e,t){cc.director.runScene(e),t()},cleverapps.Scenes.prototype.replaceScene=function(t,e){cleverapps.metha.isFocused()||cleverapps.metha.debugMessage("Trying to replace scene without user focus! "+t.sceneName),e=e||function(){};var i=cc.director.getRunningScene();i&&i.onReplace&&i.onReplace(),cleverapps.Notification.remove(),cleverapps.metha.compound(e,[function(e){cleverapps.FixedWidthScene.canDistractChangeSize=!1,cleverapps.environment.isEditorScene()||cleverapps.environment.isAdministratorScene()||cleverapps.flags.noTransitionAnimation?e():TransitionAnimation.createTransitionAnimation(e,
cleverapps.metha.isFocused()&&0===cleverapps.metha.focus.indexOf("refreshSceneOnChangeSize"))},function(e){t instanceof SceneProxy?t.whenLoaded(e):e()},function(e){t instanceof SceneProxy&&(t=t.instance),cleverapps.scenes.runScene(t,e)},function(e){cleverapps.environment.isEditorScene()||cleverapps.environment.isAdministratorScene()||cleverapps.flags.noTransitionAnimation?e():TransitionAnimation.removeTransitionAnimation(t,function(){e(),"undefined"!=typeof ToolMenu&&(t.toolMenu=new ToolMenu,t.toolMenu.setLocalZOrder(1),t.addChild(t.toolMenu))})},function(e){cleverapps.FixedWidthScene.canDistractChangeSize=!0;var t=cleverapps.FixedWidthScene.changedOrientation;if(cleverapps.FixedWidthScene.changedOrientation||cleverapps.FixedWidthScene.changedSize){delete cleverapps.FixedWidthScene.changedOrientation,delete cleverapps.FixedWidthScene.changedSize;var i=cc.director.getRunningScene();i&&i.onChangeSize&&i.onChangeSize(t)}e()}])},cleverapps.Scenes.prototype.reset=function(){
TransitionAnimation.reset()};var TransitionAnimation=cc.Node.extend({ctor:function(){this._super(),this.setAnchorPoint2(),this.setLocalZOrder(100),this.animation=new cleverapps.Spine(bundles.transition.jsons.transition_json),this.addChild(this.animation)},animate:function(e,t,i,s){t=cleverapps.once(t||function(){}),this.animation.setCompleteListener(function(){this.runAction(new cc.Sequence(new cc.CallFunc(t),new cc.CallFunc(function(){i||this.runAction(new cc.RemoveSelf)}.bind(this))))}.bind(this));var n=function(){s?this.animation.setTimeScale(1e3):(this.animation.setTimeScale(1),cleverapps.config.debugMode&&cleverapps.keyboardController.isPressed(cc.KEY.d)&&this.animation.setTimeScale(.1)),this.animation.setAnimation(0,e,!1),"open"===e?cleverapps.audio.playSound(bundles.main.urls.transition_open_effect):cleverapps.audio.playSound(bundles.main.urls.transition_close_effect)}.bind(this),o=cleverapps.styles.TransitionAnimation;"open"===e?this.animation.runAction(new cc.Sequence(
new cc.DelayTime(o.beforeOpen.delay),new cc.CallFunc(n),new cc.DelayTime(o.open.delay),new cc.CallFunc(t))):n()}});TransitionAnimation.animate=function(e,t){(t=t||{}).parent||(t.parent=cc.director.getRunningScene());var i=t.spine?t.spine:new TransitionAnimation;return i.setPositionRound(t.parent.width/2,t.parent.height/2),i.removeFromParent(),t.parent.addChild(i,1e3),i.animate(e,t.callback,t.notRemove,t.silent),i},TransitionAnimation.hideLoading=function(){var e=TransitionAnimation.closeCurtains,t=cleverapps.styles.TransitionAnimation;if(e&&e.loading){var i=.3*(1-e.loading.scale);e.loading.runAction(new cc.Sequence(new cc.ScaleTo(i,1),new cc.DelayTime(Math.max(cleverapps.styles.TransitionAnimation.loading.hide.delay-i,0)),new cc.ScaleTo(.3,t.hide.scale),new cc.RemoveSelf)),delete e.loading}},TransitionAnimation.clearCloseCurtains=function(){TransitionAnimation.closeCurtains&&(TransitionAnimation.hideLoading(),delete TransitionAnimation.closeCurtains)},
TransitionAnimation.removeCloseCurtains=function(){TransitionAnimation.closeCurtains&&(TransitionAnimation.closeCurtains.removeFromParent(),delete TransitionAnimation.closeCurtains)},TransitionAnimation.reset=function(){this.removeCloseCurtains()},TransitionAnimation.closeCurtainsAnimation=function(e,t){var i=TransitionAnimation.animate("close",{callback:function(){cc.eventManager.removeListeners(i),e()},notRemove:!0,silent:t});return i},TransitionAnimation.createTransitionAnimation=function(n,o){var e=function(){var e=cc.director.getRunningScene();if(e){var t=cleverapps.styles.TransitionAnimation,i=TransitionAnimation.closeCurtainsAnimation(n,o);if(e.onTransitionAnimationDidStart(),TransitionAnimation.removeCloseCurtains(),TransitionAnimation.closeCurtains=i,TransitionAnimation.swallowTouches(i),t.loading){var s=cleverapps.Spine.listBundles(res.loading_json);if(!cleverapps.bundleLoader.isLoaded(s))return;i.runAction(new cc.Sequence(new cc.DelayTime(t.loading.delay),new cc.CallFunc(
function(){var e="messages:Loading";!1===t.loading.text&&(e=""),i.loading=WaitWindow.prototype.showLoading.call(i,e,{font:cleverapps.styles.FONTS.TRANSITION_LOADING_TEXT}),i.addChild(i.loading),i.loading.setPositionRound(t.loading),i.loading.setScale(0),i.loading.runAction(new cc.ScaleTo(.3,1))})))}}else n()}.bind(this);cleverapps.bundleLoader.loadBundle("transition",{onSuccess:e})},TransitionAnimation.removeTransitionAnimation=function(e,t){var i=TransitionAnimation.animate("open",{callback:function(){cc.eventManager.removeListeners(i),t()},parent:e,spine:TransitionAnimation.closeCurtains});TransitionAnimation.clearCloseCurtains(),TransitionAnimation.swallowTouches(i)},TransitionAnimation.swallowTouches=function(e){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(){return!0},onTouchEnded:function(){return!0}},e),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:function(e){
return e&&e.stopPropagation&&e.stopPropagation(),!0},onMouseScroll:function(e){return e&&e.stopPropagation&&e.stopPropagation(),!0}},e)},cleverapps.styles.TransitionAnimation={loading:{delay:.75,hide:{delay:.3},x:{align:"center"},y:{align:"center"}},open:{delay:.5},hide:{scale:0},beforeOpen:{delay:.2}},cleverapps.RestClient={getBase:function(){return cc.sys.isNative||cleverapps.isInstant()||-1!==["mbga","nk","android","plinga","huzcom","pliega"].indexOf(cleverapps.User.calcSource())?cleverapps.config.deployment:""},sendRaw:function(e,t,i){var s=cc.sys.isNative?cc.loader.getXMLHttpRequest():new XMLHttpRequest,n=cleverapps.RestClient.getBase()+t;s.open(e,n),s.timeout=1e4,s.send(i)},get:function(e,t,i,s,n){this.send(cleverapps.RestClient.METHODS.GET,e,t,i,s,n)},post:function(e,t,i,s,n){this.send(cleverapps.RestClient.METHODS.POST,e,t,i,s,n)},send:function(e,t,i,s,n,o){if(!cleverapps.flags.norest){o=o||1e4;var a=cc.sys.isNative?cc.loader.getXMLHttpRequest():new XMLHttpRequest,r=setTimeout(
function(){l.call({status:-1,statusText:"our timeout"})},o+1e3),l=function(){if(void 0!==r&&(clearTimeout(r),r=void 0),200<=this.status&&this.status<300){if(s){var e;try{e=this.responseText&&JSON.parse(this.responseText)}catch(e){throw"parse json error: path - "+t+", message - "+e.message}s(e)}}else console.log("XMLHttpRequest FAILED"),this.status&&console.log(this.status),this.statusText&&console.log(this.statusText),this.responseText&&(this.errorMessage=(this.responseText.split("\n")[0]||"").trim(),this.errorMessage&&console.log(this.errorMessage)),n&&n(this);s=function(){},n=function(){}}.bind(a);a.ontimeout=l,a.onload=l,a.onerror=l,a.onabort=l;var c=t;"http"!==c.substr(0,4)&&(c=cleverapps.RestClient.getBase()+cleverapps.config.restApiURL+t),a.open(e,c),a.timeout=o,a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Cache-Control","no-cache"),a.send(JSON.stringify(i))}},METHODS:{GET:"GET",POST:"POST"}},cleverapps.Tutorial=function(){
this.tutorialSteps=new cleverapps.TutorialSteps,this.steps=this.tutorialSteps.list(this.nextStep.bind(this)),this.onStartedListener=function(){},this.onFinishedListener=function(){}},cleverapps.Tutorial.prototype.setGame=function(e){this.game=e,this.tutorialSteps.setGame(this.game)},cleverapps.Tutorial.prototype.stop=function(){this.step=this.steps.length},cleverapps.Tutorial.prototype.start=function(){this.setStep(0),this.onStartedListener()},cleverapps.Tutorial.prototype.remindStep=function(){this.isFinished()||this.steps[this.step].call(this,this.game)},cleverapps.Tutorial.prototype.setStep=function(e){var t={step:this.step=e};if(this.isFinished())this.onFinishedListener(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TUTORIAL_COMPLETED,t),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TUTORIAL_COMPLETE);else{var i="tutorial_step_"+(e+1);cleverapps.eventLogger.logEvent(i,t),0===e&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TUTORIAL_BEGIN)}this.remindStep()},
cleverapps.Tutorial.prototype.nextStep=function(){this.isFinished()||this.setStep(this.step+1)},cleverapps.Tutorial.prototype.isFinished=function(){return this.step===this.steps.length},cleverapps.EventsLogger=function(){this.pool={names:[],data:[]}},cleverapps.EventsLogger.prototype.logEvent=function(e,t){if(!cleverapps.flags||!cleverapps.flags.noLogEvents){40<e.length&&console.log("WARN: Invalid event name: "+e+"!. It must be between 1 and 40 characters, and must be contain only alphanumerics, , - or spaces, starting with alphanumeric or _.");var i=this.getBaseParameters();if(void 0!==t&&(i=cleverapps.extend(i,t)),cleverapps.firebase){var s=cleverapps.EventsLogger.FIREBASE_RENAMES[e]||e;-1!==["earn_virtual_currency","spend_virtual_currency"].indexOf(s)&&(i.virtual_currency_name="coins",i.value=i.amount||1),cleverapps.firebase.logEvent(s,i)}cleverapps.adjust&&cleverapps.adjust.logEvent(e),cleverapps.social&&cleverapps.social.logEvent&&cleverapps.social.logEvent(e,i),
-1===cleverapps.EventsLogger.IGNORED_EVENTS.indexOf(e)&&this.addEvent(e,t)}},cleverapps.EventsLogger.prototype.addEvent=function(e,t){void 0===t&&(t={}),e===cleverapps.EVENTS.PRODUCT_BOUGHT_LANGUAGE?e=cleverapps.EVENTS.PRODUCT_BOUGHT+"_"+cleverapps.settings.language:e===cleverapps.EVENTS.DAU_LANGUAGE?e=cleverapps.EVENTS.DAU+"_"+cleverapps.settings.language:e===cleverapps.EVENTS.BOOSTERS_BOUGHT_ITEM?e=cleverapps.EVENTS.BOOSTERS_BOUGHT+"_"+t.id:e===cleverapps.EVENTS.STAR_CHEST_OPEN_ITEM?e=cleverapps.EVENTS.STAR_CHEST_OPEN+"_"+t.id:e===cleverapps.EVENTS.SHARE_ITEM&&(e=cleverapps.EVENTS.SHARE+"_"+t.id),this.pool.names.push(e),this.pool.data.push(t);var i=this.getBaseParameters();setTimeout(this.sendEvents.bind(this,i),0)},cleverapps.EventsLogger.prototype.sendEvents=function(e){if(0<this.pool.names.length){var t=this.pool.names.join(",");console.log("Sending events - "+t),(e=cleverapps.extend(e,this.getBaseParameters())).events=t,e.params=this.pool.data,cleverapps.RestClient.post(
"/events/",e,function(){},function(){console.log("Failure event - "+t)}),this.pool.names=[],this.pool.data=[]}},cleverapps.EventsLogger.prototype.getBaseParameters=function(){var e={};cleverapps.user&&cleverapps.user.id&&(e.id=cleverapps.user.id),cleverapps.environment&&(cleverapps.environment.getScreen()&&(e.screen=cleverapps.environment.getScreen()),void 0!==cleverapps.environment.levelNo&&(e.level=cleverapps.environment.levelNo),void 0!==cleverapps.environment.episodeNo&&(e.episode=cleverapps.environment.episodeNo));var t=Game.currentGame&&Game.currentGame.level;return t&&(t.content&&(e.version=t.content.version),t.hash&&(e.hash=t.hash)),cleverapps.settings&&cleverapps.settings.language&&(e.language=cleverapps.settings.language),e.source=cleverapps.User.calcSource(),levels.episodes&&(e.amountEpisodes=levels.episodes.getAmountEpisodes()),e},cleverapps.EventsLogger.FIREBASE_RENAMES={},cleverapps.EventsLogger.FIREBASE_RENAMES[cleverapps.EVENTS.REWARD_RECEIVED]="earn_virtual_currency",
cleverapps.EventsLogger.FIREBASE_RENAMES[cleverapps.EVENTS.SPEND_COINS]="spend_virtual_currency",cleverapps.EventsLogger.IGNORED_EVENTS=[cleverapps.EVENTS.ACHIEVED_LEVEL,cleverapps.EVENTS.LEVEL_UP];var History=function(){this.enabled=!0,this.data={},this.dirty={},this.sent={},this.load(),this.hasDirty()&&this.schedulePush()};if(History.prototype.hasDirty=function(){return 0<Object.keys(this.dirty).length},History.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.HISTORY);e?(this.data=e.data,this.dirty=e.dirty,cleverapps.extend(this.dirty,e.sent),this.sent={}):cleverapps.user.registered<Date.now()-6e5&&(this.enabled=!1)},History.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.HISTORY,{data:this.data,dirty:this.dirty,sent:this.sent})},History.prototype.add=function(e,t){var i=cleverapps.user.getDaysSinceRegistration();if(i>History.DAYS&&(this.enabled=!1),this.enabled){var s=this.data[i+"_"+e];this.set(e,(s||0)+t)}},
History.prototype.set=function(e,t){var i=cleverapps.user.getDaysSinceRegistration();if(i>History.DAYS&&(this.enabled=!1),this.enabled){var s=i+"_"+e;this.data[s]=t,this.dirty[s]=!0,this.save(),this.schedulePush()}},History.prototype.schedulePush=function(){if(!this.pushScheduled){this.pushScheduled=!0;var e=cleverapps.parseInterval(History.PUSH_INTERVAL)-Date.now()+(this.lastPushTime?this.lastPushTime:0);e<=0&&(e=0),setTimeout(this.push.bind(this),e)}},History.prototype.push=function(){this.lastPushTime=Date.now();var e={};for(var t in this.dirty)e[t]=this.data[t];this.sent=cleverapps.clone(this.dirty),this.dirty={},this.save(),cleverapps.RestClient.post("/history/"+cleverapps.user.id,e,function(){console.log("Success pushing history: "+JSON.stringify(Object.keys(this.sent))),this.pushScheduled=!1,this.sent={},this.save(),this.hasDirty()&&this.schedulePush()}.bind(this),function(){console.log("Failure pushing history: "+JSON.stringify(this.sent)),this.pushScheduled=!1,
cleverapps.extend(this.dirty,this.sent),this.sent={},this.save(),this.schedulePush()}.bind(this))},History.PUSH_INTERVAL="30 seconds",History.DAYS=14,"undefined"!=typeof module&&void 0===cleverapps)cleverapps={config:{},isLocalhost:function(){}};cleverapps.Random={state:0,m:2147483648,a:1103515245,c:12345,seed:function(e){if(isNaN(e)&&cleverapps.isLocalhost())throw new Error("Seed is NaN");if("number"!=typeof e)if("string"==typeof e)cleverapps.Random.state=cleverapps.Random.strToInt(e);else{var t="Expecting string as seed";if(cleverapps.config.debugMode&&cleverapps.isLocalhost())throw Error(t);console.log(t)}else cleverapps.Random.state=Math.abs(parseInt(e)||0)%cleverapps.Random.m},randomSeed:function(){cleverapps.Random.state=Math.floor(Math.random()*cleverapps.Random.m);for(var e=cleverapps.Random.state,t=[],i=0;i<100;i++){if(x=this.nextInt(),0<=t.indexOf(x))return void this.randomSeed();t.push(x)}cleverapps.Random.state=e},shuffle:function(e){for(var t=[],i=[],s=0;s<e.length;s++
)i.push(s);for(s=0;s<e.length;s++){var n=cleverapps.Random.random(i.length);t.push(e[i[n]]),i.splice(n,1)}return t},strToInt:function(e){for(var t=0,i=0;i<e.length;i++)t=(1e3*t+e.charCodeAt(i))%cleverapps.Random.m;return t},nextInt:function(){return cleverapps.Random.state=(cleverapps.Random.a*cleverapps.Random.state+cleverapps.Random.c)%cleverapps.Random.m},nextDouble:function(){return cleverapps.Random.nextInt()/cleverapps.Random.m},mathChoose:function(e){if(0!==e.length)return e[Math.floor(Math.random()*e.length)]},choose:function(e,t){if(0!==e.length)return e[cleverapps.Random.random(0,e.length-1,t)]},random:function(e,t,i){var s;void 0!==i&&(s=cleverapps.Random.state,cleverapps.Random.seed(!1!==i?i:Math.floor(1e6*Math.random()))),void 0===t&&(t=e-1,e=0);var n=t-e+1,o=cleverapps.Random.nextInt()/cleverapps.Random.m,a=e+Math.floor(o*n);return void 0!==s&&cleverapps.Random.seed(s),a}},cleverapps.Random.randomSeed(),"undefined"!=typeof module&&(module.exports=cleverapps.Random),
cleverapps.Audio=function(){this.cache={},this.disk=void 0,this.paused=!1,cc.game.onPauseListeners.audio=this.pause.bind(this),cc.game.onResumeListeners.audio=this.resume.bind(this),"undefined"!=typeof window&&(window.addEventListener("focus",function(e){cc.Audio._context&&cc.Audio._context.resume&&cc.Audio._context.resume()}),cc.sys.isNative&&window.addEventListener("blur",function(e){cc.Audio._context&&cc.Audio._context.suspend&&cc.Audio._context.suspend()}))},cleverapps.Audio.prototype.insertDisk=function(e){this.disk=processVirtualUrl(e),this.onChangeMusic()},cleverapps.Audio.prototype.eject=function(){this.disk=void 0,this.onChangeMusic()},cleverapps.Audio.prototype.pause=function(){this.paused||(this.paused=!0,this.onChangeMusic())},cleverapps.Audio.prototype.resume=function(){!cc.game.isPaused()&&this.paused&&(this.paused=!1,this.onChangeMusic())},cleverapps.Audio.prototype.onChangeMusic=function(){if(this.disk&&!this.paused&&cleverapps.settings.music&&!cc.game.isPaused()){
this.clearOutFade(),this.logSound(this.disk),cc.audioEngine.setMusicVolume(1);try{cc.audioEngine.playMusic(this.disk,!0)}catch(e){var t=typeof cc.loader.getRes(this.disk);throw cleverapps.ReportStream.debug("AUDIO "+t+" url "+this.disk),e}}else cc.audioEngine.stopMusic()},cleverapps.Audio.prototype.clearOutFade=function(){this.currentFade&&(clearInterval(this.currentFade),delete this.currentFade)},cleverapps.Audio.prototype.fadeOut=function(){if(!this.paused&&this.disk&&!this.currentFade&&(cc.sys.os!==cc.sys.OS_IOS||!cc.sys.isWebView)){var e=20,t=cc.audioEngine.getMusicVolume()/e,i=this.disk;this.clearOutFade(),this.currentFade=setInterval(function(){0===e||!cc.audioEngine._currMusic||!cc.audioEngine._currMusic.setVolume||i!==this.disk||cc.game.isPaused()||this.paused?(this.clearOutFade(),i===this.disk&&this.eject()):(e--,cc.audioEngine.setMusicVolume(Math.max(0,cc.audioEngine.getMusicVolume()-t)))}.bind(this),20)}},cleverapps.Audio.prototype.playSound=function(e,t){if((
e=processVirtualUrl(e))&&cleverapps.settings.sound&&!cc.game.isPaused()&&!this.paused){t=t||{},this.logSound(e,t);var i=this.cache[e],s=void 0!==t.throttle?t.throttle:cleverapps.Audio.THROTTLE_AUDIO;if(i){if(!cc.sys.isNative&&i.getPlaying()&&i.startPlaying+s>Date.now())return;cc.sys.isNative&&cc.audioEngine.stopEffect(i)}var n=(cc.audioEngine._audioPool[e]||[]).filter(function(e){return!e.getPlaying()})[0];return n&&cc.audioEngine.stopEffect(n),(i=cc.audioEngine.playEffect(e,t.loop))&&(t.volume&&i.setVolume(t.volume),i.startPlaying=Date.now(),this.cache[e]=i),i}},cleverapps.Audio.prototype.stopSound=function(e){cc.audioEngine.stopEffect(e)},cleverapps.Audio.THROTTLE_AUDIO=250,cleverapps.Audio.prototype.logSound=function(e,t){cleverapps.config.debugMode&&cleverapps.keyboardController.isPressed(cc.KEY.s)&&(console.log("--------------------- sound logging ----------------------"),console.log("sound file",e),t&&console.log("sound options",t),console.log(
"----------------------------------------------------------"))},cleverapps.ABTest=function(){this.group=void 0,this.setGroup(cleverapps.user.abtest)},cleverapps.ABTest.prototype.isRunning=function(e){return cleverapps.ABTest.ACTIVE_TEST&&cleverapps.ABTest.ACTIVE_TEST.name===e},cleverapps.ABTest.prototype.setGroup=function(e){this.group=void 0,cleverapps.ABTest.ACTIVE_TEST&&(-1===cleverapps.ABTest.ACTIVE_TEST.groups.indexOf(e)?cleverapps.ABTest.wantAssignGroup()&&(this.group=cleverapps.Random.mathChoose(cleverapps.ABTest.ACTIVE_TEST.groups)):this.group=e),cleverapps.user.abtest!==this.group&&(cleverapps.user.abtest=this.group,cleverapps.user.save())},cleverapps.ABTest.prototype.purchaseEvent=function(e){void 0!==this.group&&cleverapps.eventLogger.logEvent("abtest_"+this.group,{amount:e})},-1!==["tripeaks"].indexOf(cleverapps.config.name)&&cleverapps.config.debugMode&&(cleverapps.ABTest.ACTIVE_TEST={name:"betorlives",groups:["bet","lives"]},cleverapps.ABTest.wantAssignGroup=function(){
return!0});var Alarm=function(){this.on=!1,this.alarms={},this.priority=0,this.onChangeListeners={}};Alarm.prototype.isOn=function(){return 0<this.priority},Alarm.prototype.start=function(e,t){this.alarms[e]=t||1,this.onChange()},Alarm.prototype.stop=function(e){delete this.alarms[e],this.onChange()},Alarm.prototype.clear=function(){this.alarms={},this.onChange()},Alarm.prototype.onChange=function(){var e=0;for(var t in this.alarms)this.alarms[t]>e&&(e=this.alarms[t]);if(e!==this.priority)for(var t in this.priority=e,this.onChangeListeners)this.onChangeListeners[t](e)};var Mission=function(e,t){this.started=void 0,this.type=e,this.completed=!1,this.details={},this.result=0,this.onChangeResults=function(){},this.onUpdateState=function(){},cleverapps.extend(this,Missions[this.type]),this.isMinigameMission()&&(this.currency=this.getStartCurrency()),this.type===Mission.TYPE_LANTERN&&(this.result=1);var i=!t;if(i?(this.started=Date.now(),this.needShowStartWindow=!0):this.load(t),
this.competition){i&&Competition.CLEAN_SAVED(this.type);var s=Competition.optionsByMission(this);this.runningCompetition=new Competition(s),this.runningCompetition.onChangeResultsListeners.mission=this.resultsChanged.bind(this),cleverapps.friends.playerInfoChangedListeners.mission=this.userInfoChanged.bind(this),this.runningCompetition.start()}this.logic&&(this.logic=new this.logic(this)),this.isRunning()&&(this.countdown=new cleverapps.CountDown(this.finishTime()-Date.now(),{onFinish:function(){this.onUpdateState()}.bind(this),permanent:!0}))};Mission.prototype.userInfoChanged=function(e){this.runningCompetition.onUserInfoChanged(e),cleverapps.missionManager.table.resetResults(this.type),this.resultsChanged()},Mission.prototype.resultsChanged=function(){this.onChangeResults(),this.logic&&this.logic.onChangeResults&&this.logic.onChangeResults()},Mission.prototype.beforeRemove=function(){this.runningCompetition&&this.runningCompetition.stop()},Mission.prototype.load=function(e){
this.started=e.started,this.result=e.result,this.details=e.details,this.currency=e.currency},Mission.prototype.update=function(e,t){if(this.result+=e,t&&(this.details=t),this.runningCompetition&&0!==e&&this.runningCompetition.updatePlayerResult(cleverapps.user.id,this.result),this.onUpdateState(),this.onChangeResults(),cleverapps.missionManager.save(),this.logic&&this.logic.onUpdate)return this.logic.onUpdate(this);this.semaphore===Missions.SEMAPHORE_CLASSIC&&cleverapps.missionManager.dispatchEvent(Mission.EVENT_COLLECT_CLOVER,{amount:e})},Mission.prototype.receiveReward=function(){if(this.logic&&this.logic.receiveReward)return this.logic.receiveReward(this);var e=this.getPrize(),t="_lost";return e&&(t="_prize"),0===this.place&&this.runningCompetition&&(t="_first"),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MISSION_FINISH+t),e&&cleverapps.history.add("mwin",1),cleverapps.history.add("misn"+this.type,this.result),e},Mission.prototype.skipNext=function(){
return this.logic&&this.logic.skipNext&&this.logic.skipNext()},Mission.prototype.useMissionIntent=function(e){var t=this.getViewClass();cleverapps.scenes.replaceScene(new t(this),e)},Mission.prototype.updateCurrency=function(e,t){0!==e&&void 0!==this.currency&&(this.currency+=e,t&&(this.details=t),this.onUpdateState(),cleverapps.missionManager.save())},Mission.prototype.getSummary=function(){return this.runningCompetition?{place:this.runningCompetition.calcPlace(),points:this.runningCompetition.player.amount}:{place:"?",points:this.result}},Mission.prototype.getResults=function(){if(!this.runningCompetition)return[];var e=this.runningCompetition.getResults().map(function(e,t){return{id:e.id,player:e.player,text:e.name,avatar:{id:e.id,avatar:e.avatar},amount:e.amount}});return e.sort(function(e,t){return t.amount-e.amount}),e.forEach(function(e,t){e.place=t+1}),e},Mission.prototype.save=function(){return{started:this.started,type:this.type,result:this.result,currency:this.currency,
details:this.details}},Mission.prototype.getName=function(){return this.name},Mission.prototype.getWindowBundleName=function(){return this.bundle},Mission.prototype.isMinigameMission=function(){return void 0!==this.minigame},Mission.prototype.getViewClass=function(){return this.view},Mission.prototype.complete=function(){this.completed=!0},Mission.prototype.getIcon=function(){return cleverapps.skins.getSlot("missionIcon",{type:this.type})},Mission.prototype.wantsToActOnFinish=function(){return this.logic&&this.logic.wantsToActOnFinish?this.logic.wantsToActOnFinish():0!==this.result&&"?"!==this.getSummary().place},Mission.prototype.finishTime=function(){if(this.feature){var e=cleverapps.eventManager.getFeatureEvent(this.feature);return e?e.finish.getTime():Date.now()}return this.started+cleverapps.parseInterval(this.duration)},Mission.prototype.isRunning=function(){return!this.completed&&this.finishTime()>Date.now()},Mission.prototype.canPlayMinigame=function(){
return this.isMinigameMission()&&this.currency&&this.currency>=this.getMinigamePrice()},Mission.prototype.getMinigamePrice=function(){return this.minigame.price},Mission.prototype.isMinigameReadyToFinish=function(){return this.isMinigameMission()&&this.logic&&this.logic.isMinigameReadyToFinish&&this.logic.isMinigameReadyToFinish()},Mission.prototype.getStartCurrency=function(){return void 0!==this.startCurrency?this.startCurrency:this.getMinigamePrice()},Mission.prototype.getMinigameClass=function(){return this.minigame.className},Mission.prototype.getLevelReward=function(){return-1!==[Mission.TYPE_TREASURE_SEARCH].indexOf(this.type)?[1,3]:[1,1]},Mission.prototype.getPrize=function(){if(this.prize)return this.minigame?this.prize.prepareByRich?cleverapps.user.prepareRewardByRich(this.prize):this.prize:(this.place=this.getSummary().place,this.place<this.prize.length?RewardsConfig.Tournament.prepareByRich?cleverapps.user.prepareRewardByRich(this.prize[this.place]
):this.prize[this.place]:void 0)},Mission.cooldownInterval=function(e){return cleverapps.config.debugMode?"10 seconds":Missions[e].cooldown};var MissionManager=function(){this.missions=[],this.lastRemoved={},this.table=new cleverapps.Table,this.load()};MissionManager.isObsoleteMissionType=function(e){return-1===[Mission.TYPE_COMBO,Mission.TYPE_COLLECT_MARK,Mission.TYPE_BURN_NEARBY,Mission.TYPE_LETTER,Mission.TYPE_TREASURE_SEARCH,Mission.TYPE_LANTERN,Mission.TYPE_WARDROBE,Mission.TYPE_FAVORITE_SALE,Mission.TYPE_LIVES_SALE,Mission.TYPE_BOOSTERS_SALE,Mission.TYPE_COINS_SALE,Mission.TYPE_BATTLEPASS,Mission.TYPE_RACE,Mission.TYPE_RAFFLE,Mission.TYPE_STICKERS_COLLECTION].indexOf(e)},MissionManager.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.MISSIONS);if(void 0!==e&&void 0!==e.missions){var t=e.missions;this.lastRemoved=e.lastRemoved||{};var i=this.listAvailableTypes();this.missions=[],t.filter(function(e){return-1!==i.indexOf(e.type
)&&!MissionManager.isObsoleteMissionType(e.type)},this).forEach(function(e){this.add(e.type,e)},this)}},MissionManager.prototype.getPlayableMissions=function(){return this.missions.filter(function(e){return e.isRunning()&&e.canPlayMinigame()})},MissionManager.prototype.getRunningMission=function(e){for(var t=0;t<this.missions.length;t++)if(this.missions[t].isRunning()&&this.missions[t].semaphore&e)return this.missions[t]},MissionManager.prototype.skipNext=function(){return 0<this.missions.filter(function(e){return e.skipNext()}).length},MissionManager.prototype.getMissionWithIntent=function(){for(var e in this.missions){var t=this.missions[e];if(t.logic&&t.logic.hasIntent&&t.logic.hasIntent())return t}},MissionManager.prototype.dispatchEvent=function(e,t){for(var i in this.missions){var s=this.missions[i];s.logic&&s.logic.processEvent&&s.logic.processEvent(e,t||{})}},MissionManager.prototype.findByType=function(e){for(var t=0;t<this.missions.length;t++)if(this.missions[t].type===e
)return this.missions[t]},MissionManager.prototype.reset=function(e){this.missions=[],this.lastRemoved={},this.save()},MissionManager.prototype.save=function(e){var t=this.missions.map(function(e){return e.save()});cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.MISSIONS,{missions:t,lastRemoved:this.lastRemoved}),e||this.addUpdateTask()},MissionManager.prototype.sendUpdateTask=function(){Game.currentGame&&Game.currentGame.onChangeOutcomeListeners.missionsUpdate&&(Game.currentGame.onChangeOutcomeListeners.missionsUpdate=function(){}),MissionManager.sendUpdateTimeout&&(clearTimeout(MissionManager.sendUpdateTimeout),MissionManager.sendUpdateTimeout=void 0),cleverapps.synchronizer.addUpdateTask("missions")},MissionManager.prototype.addUpdateTask=cleverapps.timeredThrottle(cleverapps.parseInterval("2 seconds"),function(){Game.currentGame&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN?MissionManager.sendUpdateTimeout||cleverapps.environment.isSceneWithPreview()||(
Game.currentGame.onChangeOutcomeListeners.missionsUpdate=this.addUpdateTask.bind(this),MissionManager.sendUpdateTimeout=setTimeout(this.sendUpdateTask.bind(this),cleverapps.parseInterval("1 minute"))):this.sendUpdateTask()}),MissionManager.prototype.getInfo=function(){for(var e=[],t=0;t<this.missions.length;t++){var i=this.missions[t];i.isRunning()&&e.push({started:i.started,type:i.type,result:i.result,currency:i.currency,details:i.details})}return e},MissionManager.prototype.updateInfo=function(e,t){if(e&&e.length){this.missions=[],this.lastRemoved={};var i=this.listAvailableTypes();e.filter(function(e){return-1!==i.indexOf(e.type)&&!MissionManager.isObsoleteMissionType(e.type)}).forEach(function(e){this.add(e.type,e)},this),this.save(t)}},MissionManager.prototype.anyCompleted=function(){for(var e=0;e<this.missions.length;e++){var t=this.missions[e];if(!t.isRunning()){if(t.wantsToActOnFinish())return t;this.remove(t)}}},MissionManager.prototype.showCompleted=function(){
var s=this.anyCompleted();s&&cleverapps.metha.display({focus:"missionCompleted"+s.name,actions:[function(e){this.remove(s);var t=s.finishView;if(t){var i=new t(s);i instanceof cleverapps.FixedWidthScene||i instanceof SceneProxy?cleverapps.scenes.replaceScene(i,e):cleverapps.metha.onceNoWindowsListener=e}else e()}.bind(this),function(e){var t=s.receiveReward();t?(new RewardWindow({reward:t}),cleverapps.metha.onceNoWindowsListener=e):e()}]})},MissionManager.prototype.pendingStartWindow=function(){for(var e=0;e<this.missions.length;e++)if(this.missions[e].needShowStartWindow&&this.missions[e].startWindow)return this.missions[e]},MissionManager.prototype.showStartWindow=function(){var t=this.pendingStartWindow();t.needShowStartWindow=!1,cleverapps.metha.display({focus:"missionStartWindow_"+t.type,action:function(e){new t.startWindow(t),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},MissionManager.prototype.listAvailableTypes=function(){if(-1!==["wordheaps","spades"].indexOf(
cleverapps.config.name))return[];var e=[Mission.TYPE_FAVORITE_SALE,Mission.TYPE_RAFFLE,Mission.TYPE_BOOSTERS_SALE];return"board"===cleverapps.config.type?(e.push(Mission.TYPE_LETTER),e.push(Mission.TYPE_COINS_SALE),e.push(Mission.TYPE_RACE),e.push(Mission.TYPE_WARDROBE)):"solitaire"===cleverapps.config.type?(e.push(Mission.TYPE_LETTER),cleverapps.config.debugMode&&e.push(Mission.TYPE_COINS_SALE)):"differences"===cleverapps.config.type?e.push(Mission.TYPE_LETTER):(e.push(Mission.TYPE_COMBO),e.push(Mission.TYPE_COLLECT_MARK),e.push(Mission.TYPE_BURN_NEARBY),cleverapps.config.editorMode||e.push(Mission.TYPE_LANTERN),e.push(Mission.TYPE_BATTLEPASS)),cleverapps.lives&&e.push(Mission.TYPE_LIVES_SALE),-1!==["riddles","heroes","olympics","tripeaks","differences","scramble"].indexOf(cleverapps.config.name)&&e.push(Mission.TYPE_TREASURE_SEARCH),-1!==["wordsoup","crocword"].indexOf(cleverapps.config.name)&&e.push(Mission.TYPE_STICKERS_COLLECTION),e.filter(function(e){var t=Missions[e].feature;if(
t&&-1===cleverapps.eventManager.listCurrentFeatures().indexOf(t))return!1;if(t){var i=(Missions[e].productsCheap||[]).concat(Missions[e].productsExpensive||[]);if(cleverapps.payments.isProductsExists&&!cleverapps.payments.isProductsExists(i))return!1}var s=Missions[e].logic;return!(s&&s.IsAvailable&&!s.IsAvailable())&&cleverapps.user.checkAvailable(Missions[e].available)}.bind(this))},MissionManager.prototype.canCreateTypes=function(){var e=this.listAvailableTypes(),t=cleverapps.skins.getSlot("removeMissions");if(t&&(e=cleverapps.substract(e,t)),0===e.length)return!1;for(var i=0,s=0;s<this.missions.length;s++)i|=this.missions[s].semaphore;var n=cleverapps.competitionPlayers.getAmount();e=e.filter(function(e){if(i&Missions[e].semaphore)return!1;if(!(this.lastRemoved[e]&&this.lastRemoved[e]>Date.now()-cleverapps.parseInterval(Mission.cooldownInterval(e)))){if(!Missions[e].competition)return!0;if(n>=Missions[e].competition.amount[1])return n-=Missions[e].competition.amount[1],!0}return!1
}.bind(this));var o=0;return e.forEach(function(e){var t=Missions[e].priority||0;o<t&&(o=t)}),e.filter(function(e){return(Missions[e].priority||0)===o})},MissionManager.prototype.run=function(){var e=this.canCreateTypes();if(0<e.length){var t=cleverapps.Random.choose(e);this.add(t),this.save(),t===Mission.TYPE_TREASURE_SEARCH&&"olympics"===cleverapps.config.name&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TREASURE_SEARCH_START),cleverapps.playSession.set(cleverapps.EVENTS.MISSION_START_DAU+"_"+Missions[t].name,!0)}},MissionManager.prototype.remove=function(e){e.beforeRemove();var t=this.missions.indexOf(e);return this.table.resetResults(e.type),this.missions.splice(t,1),this.lastRemoved[e.type]=Date.now(),this.save(),cleverapps.sideBar.removeIcon(new SidebarIconModel(MissionIcon,e)),!0},MissionManager.prototype.add=function(e,t){var i=new Mission(e,t);this.missions.push(i);var s=new SidebarIconModel(MissionIcon,i);cleverapps.sideBar.addIcon(s)},cleverapps.Adversting={
idfa:void 0,getIdfa:function(){return this.idfa?this.idfa:(cc.sys.isNative&&cc.sys.isWebView&&cc.sys.os===cc.sys.OS_ANDROID?"undefined"!=typeof AdverstingPlugin&&"function"==typeof AdverstingPlugin.getIdfa&&(e=AdverstingPlugin.getIdfa()):cc.sys.isNative&&cc.sys.isWebView&&cc.sys.os===cc.sys.OS_IOS?e=cleverapps.webViewData.advertisingId:cleverapps.isLocalhost()&&(e="localhostIDFA"),this.idfa=e);var e},postbackUnity:function(e){var t=cleverapps.User.calcSource();if("amazon"===t||"android"===t){var i=cleverapps.config.android.unityGameId;"ios"===t&&(i=cleverapps.config.ios.unityGameId);var s="https://postback.unityads.unity3d.com/games/"+i+"/install?advertisingTrackingId="+e;cleverapps.RestClient.get(s,{},function(e){})}}},cleverapps.Adjust=function(){this.settings=cleverapps.config.adjust||{},this.settings.events=this.settings.events||{},this.settings&&cc.sys.isNative&&"undefined"!=typeof AdjustPlugin&&!cleverapps.flags.noadjust||cleverapps.override(this,cleverapps.FakeAdjust),
this.initialize()},cleverapps.Adjust.prototype.initialize=function(){var e=this.settings.token;AdjustPlugin.init(e,cleverapps.Adjust.ENVIRONMENT,cleverapps.Adjust.LOG_LEVEL)},cleverapps.Adjust.prototype.logPurchase=function(e,t,i){var s=this.settings.purchaseToken;AdjustPlugin.logPurchase(s,e,t,i)},cleverapps.Adjust.prototype.logEvent=function(e){var t=this.settings.events[e];t&&AdjustPlugin.logEvent(t)},cleverapps.FakeAdjust={initialize:function(){},logPurchase:function(){},logEvent:function(){}},cleverapps.Adjust.SANDBOX="sandbox",cleverapps.Adjust.PRODUCTION="production",cleverapps.Adjust.ENVIRONMENT=cleverapps.Adjust.PRODUCTION,cleverapps.Adjust.LOG_LEVEL="VERBOSE",cleverapps.FirebaseManager={run:function(){
return cc.sys.isWebView&&cc.sys.os===cc.sys.OS_IOS?cleverapps.WebViewIosFirebase:cleverapps.flags.nofirebase?cleverapps.FakeFirebase:cc.sys.isNative&&cc.sys.isWebView&&"undefined"!=typeof FirebasePlugin?cleverapps.WebViewAndroidFirebase:"undefined"!=typeof sdkbox&&sdkbox.firebase?sdkbox.firebase.Analytics:(cc.sys.isNative&&console.log("No firebase plugin found!"),cleverapps.FakeFirebase)}},cleverapps.SdkBoxFirebase={init:function(){console.log("init firebase"),sdkbox.firebase.Analytics.init(),sdkbox.firebase.Analytics.setUserID(cleverapps.user.id)},logEvent:function(e,t){sdkbox.firebase.Analytics.logEvent(e,t)},setScreenName:function(e,t){sdkbox.firebase.Analytics.setScreenName(e,t)}},cleverapps.WebViewAndroidFirebase={batch:[],sendBatch:cleverapps.accumulate(1e3,function(){var e=cleverapps.WebViewAndroidFirebase;0<e.batch.length&&(FirebasePlugin.sendBatch(JSON.stringify(e.batch)),e.batch=[])}),init:function(){this.batch.push({method:"setUserID",id:cleverapps.user.id}),this.sendBatch()
},logEvent:function(e,t){this.batch.push({method:"logEvent",name:e,data:JSON.stringify(t)}),this.sendBatch()},setScreenName:function(e,t){this.batch.push({method:"setScreenName",screen:e,scene:t}),this.sendBatch()}},cleverapps.WebViewIosFirebase={init:function(){webkitMessage("firebase",{action:"setUserID",id:cleverapps.user.id})},logEvent:function(e,t){webkitMessage("firebase",{action:"logEvent",name:e,data:JSON.stringify(t)})},setScreenName:function(e,t){webkitMessage("firebase",{action:"setScreenName",screen:e,scene:t})}},cleverapps.FakeFirebase={init:function(){},logEvent:function(){},setScreenName:function(){}},cleverapps.LocalPushes=function(){this.initSender(),this.load(),this.queue={},Messages.onInitializedListeners.localPushes=this.processQueue.bind(this)},cleverapps.LocalPushes.prototype.processQueue=function(){var e=this.queue;for(var t in e){var i=e[t];this.sendPush(t,i)}this.queue={}},cleverapps.LocalPushes.prototype.init=function(){this.onShow(),
cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,cleverapps.throttle(1e3,this.onShow.bind(this)))},cleverapps.LocalPushes.prototype.onShow=function(){this.cancelSoonPushes(),cleverapps.user.checkAvailable(cleverapps.LocalPushes.LETS_PLAY_AVAILABLE)?this.sendPush(cleverapps.LocalPushes.LETS_PLAY_CODE,cleverapps.parseInterval(cleverapps.LocalPushes.LETS_PLAY_TIMEOUT)):this.sendPush(cleverapps.LocalPushes.LETS_PLAY_CODE,cleverapps.parseInterval(cleverapps.LocalPushes.LETS_PLAY_BEGGINERS_TIMEOUT))},cleverapps.LocalPushes.prototype.initSender=function(){cc.sys.isNative&&cc.sys.isWebView&&cc.sys.os===cc.sys.OS_IOS?this.sender=cleverapps.LocalPushes.IosWebViewSender:"object"==typeof LocalPushesPlugin?this.sender=cleverapps.LocalPushes.AndroidWebViewSender:cc.sys.isNative?cc.sys.os===cc.sys.OS_ANDROID?this.sender=cleverapps.LocalPushes.AndroidSender:cc.sys.os===cc.sys.OS_IOS&&(this.sender=cleverapps.LocalPushes.IosSender):(levels.user.haveTmpId()||cleverapps.isLocalhost()||(
this.sender=cleverapps.LocalPushes.FacebookSender),[cleverapps.FakeInstant,cleverapps.FakeFacebook].forEach(function(e){cleverapps.social instanceof e&&(this.sender=void 0)},this)),this.sender||(this.sender=cleverapps.LocalPushes.FakeSender)},cleverapps.LocalPushes.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.LOCAL_PUSHES);this.data=e||{}},cleverapps.LocalPushes.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.LOCAL_PUSHES,this.data)},cleverapps.LocalPushes.prototype.sendPush=function(e,t){if(t<cleverapps.parseInterval(cleverapps.LocalPushes.TIMEOUT_THRESHOLD))this.cancelPush(e);else if(Messages.isInitialized()){var i=Date.now()+t;this.data[e]&&Math.abs(this.data[e].when-i)<Math.max(.1*t,cleverapps.parseInterval("1 minute"))||(this.data[e]={when:i},this.save(),this.sender.sendPush(e,t))}else this.queue[e]=t},cleverapps.LocalPushes.prototype.cancelPush=function(e){delete this.queue[e],this.data[e]&&(
delete this.data[e],this.save(),this.sender.cancelPush(e))},cleverapps.LocalPushes.prototype.cancelSoonPushes=function(){for(var e in this.data){this.data[e].when-Date.now()<=cleverapps.parseInterval(cleverapps.LocalPushes.TIMEOUT_THRESHOLD)&&this.cancelPush(e)}},cleverapps.LocalPushes.GetPushData=function(e,t,i){var s=t?cleverapps.LocalPushes.PUSH_FACEBOOK_MESSAGES:cleverapps.LocalPushes.PUSH_MESSAGES,n=cleverapps.LocalPushes.PUSH_TITLES,o=Messages.get(s[e]),a=Messages.get(n[e],{gameTitle:Messages.get(cleverapps.config.title)});return Array.isArray(o)||(o=[o]),Array.isArray(a)||(a=[a]),void 0===i&&(i=cleverapps.Random.random(0,o.length-1)),{text:o[i],title:a[i],index:i}},cleverapps.LocalPushes.BOUNTY_CODE=0,cleverapps.LocalPushes.PERIODIC_BONUS_CODE=1,cleverapps.LocalPushes.BONUS_ROUND_CODE=2,cleverapps.LocalPushes.LIVES_CODE=3,cleverapps.LocalPushes.MINI_GAME_CODE=4,cleverapps.LocalPushes.LETS_PLAY_CODE=5,cleverapps.LocalPushes.PUSH_TITLES={0:"LocalPushes.Bounty.Title",
1:"LocalPushes.PeriodicBonus.Title",2:"LocalPushes.BonusRound.Title",3:"LocalPushes.Lives.Title",4:"LocalPushes.MiniGame.Title",5:"LocalPushes.LetsPlay.Title"},cleverapps.LocalPushes.PUSH_MESSAGES={0:"LocalPushes.Bounty",1:"LocalPushes.PeriodicBonus",2:"LocalPushes.BonusRound",3:"LocalPushes.Lives",4:"LocalPushes.MiniGame",5:"LocalPushes.LetsPlay"},cleverapps.LocalPushes.PUSH_REFS={0:"push_bounty",1:"push_periodic_bonus",2:"push_bonus_round",3:"push_lives",4:"push_mini_game",5:"push_lets_play"},cleverapps.LocalPushes.TIMEOUT_THRESHOLD="30 minutes",cleverapps.LocalPushes.LETS_PLAY_TIMEOUT="7 days",cleverapps.LocalPushes.LETS_PLAY_BEGGINERS_TIMEOUT="1 day",cleverapps.LocalPushes.LETS_PLAY_AVAILABLE={episode:1,level:0},cleverapps.LocalPushes.FakeSender={askPermission:function(){},sendPush:function(e,t){var i=cleverapps.LocalPushes.GetPushData(e);i.text&&i.title||cleverapps.throwAsync("empty fake push - "+e)},cancelPush:function(e){}},cleverapps.LocalPushes.AndroidSender={
askPermission:function(){},sendPush:function(e,t){var i=cleverapps.LocalPushes.GetPushData(e),s=i.title,n=i.text;jsb.reflection.callStaticMethod("org/cocos2dx/javascript/notification/LocalNotificationSender","scheduleNotification","(Ljava/lang/String;Ljava/lang/String;II)V",s,n,t,e),cleverapps.LocalPushes.FacebookSender.sendPush(e,t,i.index)},cancelPush:function(e){jsb.reflection.callStaticMethod("org/cocos2dx/javascript/notification/LocalNotificationSender","cancelNotification","(I)V",e),cleverapps.LocalPushes.FacebookSender.cancelPush(e)}},cleverapps.LocalPushes.AndroidWebViewSender={askPermission:function(){},sendPush:function(e,t){var i=cleverapps.LocalPushes.GetPushData(e),s=i.title,n=i.text;if(n&&s){var o=LocalPushesPlugin.scheduleNotification(s,n,t,e);o&&cleverapps.ReportStream.debug("Android send push error "+o),cleverapps.LocalPushes.FacebookSender.sendPush(e,t,i.index)}else cleverapps.throwAsync("empty android push - "+e)},cancelPush:function(e){
LocalPushesPlugin.cancelNotification(e),cleverapps.LocalPushes.FacebookSender.cancelPush(e)}},cleverapps.LocalPushes.IosWebViewSender={askPermission:function(){webkitMessage("localPushes",{action:"askPermission"})},sendPush:function(e,t){var i=cleverapps.LocalPushes.GetPushData(e),s=i.title,n=i.text;n?(webkitMessage("localPushes",{action:"sendPush",title:s,message:n,timeout:t,code:e}),cleverapps.LocalPushes.FacebookSender.sendPush(e,t,i.index)):cleverapps.throwAsync("empty ios push - "+e)},cancelPush:function(e){webkitMessage("localPushes",{action:"cancelPush",code:e}),cleverapps.LocalPushes.FacebookSender.cancelPush(e)}},cleverapps.LocalPushes.IosSender={askPermission:function(){jsb.reflection.callStaticMethod("CleverappsPushSender","askPermission")},sendPush:function(e,t){var i=cleverapps.LocalPushes.GetPushData(e),s=jsb.reflection.callStaticMethod("CleverappsPushSender","sendPush:withCode:atTimeout:",i.text,"ios_"+e,Math.round(t/1e3));cleverapps.LocalPushes.FacebookSender.sendPush(e
,t,i.index),s&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PUSH_IOS)},cancelPush:function(e){jsb.reflection.callStaticMethod("CleverappsPushSender","cancelPush:","ios_"+e),cleverapps.LocalPushes.FacebookSender.cancelPush(e)}},cleverapps.LocalPushes.FacebookSender={askPermission:function(){},sendPush:function(e,t,i){if(!levels.user.haveTmpId()&&!cleverapps.isLocalhost()){var s=levels.user.id,n=cleverapps.User.calcSource();"mobile_mm"!==n&&"web_mm"!==n||(s="mw_"+s),"mobile_ok"!==n&&"web_ok"!==n||(s="ok_"+s),"mobile_vk"!==n&&"web_vk"!==n||(s="vk_"+s);var o="/localpushes/send/"+s+"/"+e,a=cleverapps.LocalPushes.GetPushData(e,!0,i),r={message:a.text,timeout:t};cleverapps.isInstant()&&(r.title=a.title),r.message?(console.log("Sending push - "+e,r),cleverapps.RestClient.post(o,r,function(){console.log("Success push - "+e)},function(){console.log("Failure push - "+e)})):cleverapps.throwAsync("empty facebook push - "+e)}},cancelPush:function(e){if(!levels.user.haveTmpId(
)&&!cleverapps.isLocalhost()){var t="/localpushes/cancel/"+levels.user.id+"/"+e;console.log("Sending cancel push - "+e),cleverapps.RestClient.post(t,{},function(){console.log("Success cancel push - "+e)},function(){console.log("Failure cancel push - "+e)})}}},cleverapps.LocalPushes.PUSH_FACEBOOK_MESSAGES=cleverapps.extend({},cleverapps.LocalPushes.PUSH_MESSAGES,{0:"LocalPushes.Facebook.Bounty",1:"LocalPushes.Facebook.PeriodicBonus",2:"LocalPushes.Facebook.BonusRound",3:"LocalPushes.Facebook.Lives",4:"LocalPushes.Facebook.MiniGame",5:"LocalPushes.Facebook.LetsPlay"});var NativeInvite={nativeInviteFriends:!0,inviteFriends:function(e,t){this.onInviteFriendsListener=t;var i={title:e.title,message:e.message,link:cleverapps.config.deployment+"/res/applink.html"};if(e.element&&e.element.parent){var s=e.element.parent.convertToWorldSpace(e.element.getPosition()),n=cc.view.getFrameSize();i.element={x:s.x/n.width,y:1-s.y/n.height}}
cc.sys.os===cc.sys.OS_ANDROID?MessagesPlugin.sendMessageAllVariants(JSON.stringify(i)):(i.action="sendMessageAllVariants",webkitMessage("messages",i))},onInviteFriends:function(e){this.onInviteFriendsListener&&(this.onInviteFriendsListener(e),delete this.onInviteFriendsListener)}},NativeReview={isAvailable:function(){return cc.sys.os===cc.sys.OS_ANDROID&&"undefined"!=typeof ReviewPlugin},requestReview:function(e){this.onRequestReviewListener=e,console.log("NativeReview - start"),ReviewPlugin.requestReview()},onRequestReview:function(e){console.log("NativeReview - finish, result - "+e),this.onRequestReviewListener&&(this.onRequestReviewListener(e),delete this.onRequestReviewListener)}};cleverapps.Social=function(){this.onInitializedListeners={},this.initialized=!1},cleverapps.Social.prototype.initialize=function(e){this.init(function(){this.setInitialized(!0),e()}.bind(this))},cleverapps.Social.prototype.init=function(e){e()},cleverapps.Social.prototype.isLoggedIn=function(){},
cleverapps.Social.prototype.isInitialized=function(){return!1!==this.initialized},cleverapps.Social.prototype.setInitialized=function(e){if(this.initialized=e,this.initialized){for(var t in this.onInitializedListeners){(0,this.onInitializedListeners[t])()}this.onInitializedListeners={}}},cleverapps.Social.prototype.whenInitialized=function(e,t){this.isInitialized()?t():this.onInitializedListeners[e]=t},cleverapps.Social.prototype.getLocalStoragePreffix=function(){return""},cleverapps.Social.prototype.getUserID=function(){},cleverapps.Social.prototype.getAccessToken=function(){},cleverapps.Social.prototype.login=function(e,t){},cleverapps.Social.prototype.inviteFriends=function(e,t){},cleverapps.Social.prototype.inviteFriendsShare=function(e,i){var t=cleverapps.ShareBonus.cycleShareData("share");this.shareDialog({description:e.message?e.message:Messages.get("SettingsWindow.InviteFriends.message"),name:e.title?e.title:Messages.get("SettingsWindow.InviteFriends.title"),picture:t.picture,
vk:t.vk},function(e,t){e===cleverapps.Social.CODE_SUCCEED&&cleverapps.history.add("share",1),i&&i(e,t)})},cleverapps.Social.prototype.request=function(e,t){},cleverapps.Social.prototype.shareDialog=function(e,t){},cleverapps.Social.prototype.listFriends=function(e){e(cleverapps.Social.CODE_SUCCEED,[])},cleverapps.Social.prototype.listInvitableFriends=function(e){e(cleverapps.Social.CODE_SUCCEED,[])},cleverapps.Social.prototype.aboutMe=function(e){this.aboutUser("me",e)},cleverapps.Social.prototype.aboutUser=function(e,t,i){},cleverapps.Social.prototype.deleteAllRequests=function(){},cleverapps.Social.prototype.api=function(e,t,i,s){},cleverapps.Social.isAppropriate=function(){},cleverapps.Social.prepareId=function(e){return""+e},cleverapps.Social.prototype.checkConnection=function(e,t,i){if(e=e||function(){},cleverapps.flags.nologin)e();else{if("object"==typeof t&&(i=t,t=function(){}),t=t||function(){},i=i||{},!this.isInitialized())return cleverapps.Notification.create(
"messages:SocialManager.Initialization"),void t();this.isLoggedIn()?e():cc.sys.isNative||i.withWindow?new FbConnectWindow(e,t,i):this.login(e,t)}},cleverapps.Social.prototype.sendRequest=function(n,o,a){Array.isArray(n)||(n=[n]),this.checkConnection(function(){this.request({to:n,message:Messages.get(o+".message"),title:Messages.get(o+".title")},function(e){if(e===cleverapps.Social.CODE_SUCCEED){cleverapps.history.add("rqst",n.length),levels.friendSorter.markUsed(n),cleverapps.playSession.inc("viral",n.length);var t=cleverapps.friends.listIds(),i=n.filter(function(e){return-1!==t.indexOf(e)});0<i.length&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MESSAGE_SENT_FRIEND,{amount:i.length}),0<n.length-i.length&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MESSAGE_SENT_INVITE,{amount:n.length-i.length}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MESSAGE_SENT_PREFIX+o,{amount:n.length}),a&&a()}else if(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MESSAGE_CANCEL_PREFIX+o,{
amount:n.length}),-1===cleverapps.Social.CANCEL_CODES.indexOf(e)){var s=cleverapps.EVENTS.MESSAGE_ERROR+"_"+cleverapps.User.calcSource();"number"==typeof e&&(s+="_"+e),cleverapps.eventLogger.logEvent(s)}})}.bind(this))},cleverapps.Social.prototype.inviteFriendsWindow=function(i,e){e||(e="SettingsWindow.InviteFriends"),this.checkConnection(function(){cleverapps.history.add("invt",1),this.inviteFriends({message:Messages.get(e+".message"),title:Messages.get(e+".title")},function(e,t){i&&e===cleverapps.Social.CODE_SUCCEED&&i()})}.bind(this))},cleverapps.Social.prototype.inviteRandomFriends=function(t,i){this.checkConnection(function(){var e=levels.friendSorter.listInactiveFriends().map(function(e){return e.id});0<e.length?(e.sort(function(){return Math.random()-.5}),e.length>cleverapps.Social.MAX_INVITE_RANDOM_FRIENDS&&(e=e.slice(0,cleverapps.Social.MAX_INVITE_RANDOM_FRIENDS)),this.sendRequest(e,i,t)):this.inviteFriendsWindow(t,i)}.bind(this))},
cleverapps.Social.prototype.requestFullScreen=function(e){e()},cleverapps.Social.prototype.getDefaultLanguages=function(){return[]},cleverapps.Social.prototype.getCodes=function(){return this.getCode().split("-").sort()},cleverapps.Social.prototype.getCode=function(){return cleverapps.User.calcSource()},cleverapps.Social.CODE_SUCCEED=0,cleverapps.Social.CODE_FAILED=1,cleverapps.Social.CODE_CANCELLED=2,cleverapps.Social.MAX_INVITE_RANDOM_FRIENDS=10,cleverapps.Social.CANCEL_CODES=[cleverapps.Social.CODE_CANCELLED],cleverapps.Social.ACTIVITY={LVL_PASSED:0,DAILY_TASK:1,PASSED_FRIEND:2},cleverapps.Social.ACTIVITIES_CONFIG={},cleverapps.Social.ACTIVITIES_CONFIG[cleverapps.Social.ACTIVITY.LVL_PASSED]={probability:.25,messages:[{title:"messages:Activity.PassLevel.title",body:"messages:Activity.PassLevel.body1"},{title:"messages:Activity.PassLevel.title",body:"messages:Activity.PassLevel.body2"},{title:"messages:Activity.PassLevel.title",body:"messages:Activity.PassLevel.body3"}]},
cleverapps.Social.ACTIVITIES_CONFIG[cleverapps.Social.ACTIVITY.DAILY_TASK]={probability:.5,messages:[{title:"messages:Activity.DailyTask.title",body:"messages:Activity.DailyTask.body1"},{title:"messages:Activity.DailyTask.title",body:"messages:Activity.DailyTask.body2"}]},cleverapps.Social.ACTIVITIES_CONFIG[cleverapps.Social.ACTIVITY.PASSED_FRIEND]={probability:1,messages:[{title:"messages:Activity.BeatFriend.title",body:"messages:Activity.BeatFriend.body1"}]},cleverapps.BaseFB=function(){cleverapps.Social.call(this),cleverapps.Social.CANCEL_CODES.push(cleverapps.BaseFB.FACEBOOK_CANCEL_DIALOG)},cleverapps.BaseFB.prototype=Object.create(cleverapps.Social.prototype),cleverapps.BaseFB.prototype.constructor=cleverapps.BaseFB,cleverapps.BaseFB.prototype.pagingLoading=function(i,s,n,e,o){o||(o=[]),e||(e=""),n||(n=0),n>=cleverapps.BaseFB.MAX_PAGE?s(cleverapps.Social.CODE_SUCCEED,o):this.api(i+"&limit=100"+e,function(e,t){e===cleverapps.Social.CODE_SUCCEED?(t.data&&(o=o.concat(t.data)),
t.paging&&t.paging.cursors&&t.paging.next&&t.paging.cursors.after?this.pagingLoading(i,s,n+1,"&after="+t.paging.cursors.after,o):s(cleverapps.Social.CODE_SUCCEED,o)):o.length?s(cleverapps.Social.CODE_SUCCEED,o):s(e,o)}.bind(this))},cleverapps.BaseFB.prototype.getShareDialogLink=function(e){return cleverapps.config.deployment+cleverapps.config.restApiURL+"/share/?name="+encodeURIComponent(e.name)+"&description="+encodeURIComponent(e.description)+"&picture="+encodeURIComponent(cleverapps.config.deployment+e.picture)},cleverapps.BaseFB.prototype.listFriends=function(e){this.pagingLoading("/me/friends?fields=first_name,id,picture.type(large)",e)},cleverapps.BaseFB.prototype.listInvitableFriends=function(e){e([])},cleverapps.BaseFB.prototype.aboutMe=function(e){this.aboutUser("me",e)},cleverapps.BaseFB.prototype.aboutUser=function(s,n,o){this.api("/"+s+"/?fields=currency,first_name,name,picture.type(large)",function(e,t){if(e===cleverapps.Social.CODE_SUCCEED)n(t);else if(console.log(
"Error: "+e),console.log(t),o&&o(e,t),0<=cleverapps.BaseFB.USERS_BLACK_LIST_ERROR_CODES.indexOf(e)){t.error_message;var i={code:e,data:t};cleverapps.RestClient.post("/users/blacklist/add/"+s,i,function(){console.log("Success add to black list:"+s)},function(){console.log("Failure add to black list:"+s)})}})},cleverapps.BaseFB.prototype.deleteAllRequests=function(){this.api("me/apprequests",function(e,t){if(e===cleverapps.Social.CODE_SUCCEED){if(t.data)for(var i=0;i<t.data.length;i++)console.log("START DELETE REQUEST",t.data[i].id),this.api(t.data[i].id,"delete",function(e,t){console.log("DELETE REQUEST",e,t)})}else console.log("Error: "+e),console.log(t)}.bind(this))},cleverapps.BaseFB.MAX_PAGE=20,cleverapps.BaseFB.USERS_BLACK_LIST_ERROR_CODES=[100],cleverapps.BaseFB.FACEBOOK_CANCEL_DIALOG=4201,cleverapps.BaseFB.PERMISSIONS=["public_profile","user_friends"].join(","),0<=["wordheaps","spades","mergeriddles","mergeheroes"].indexOf(cleverapps.config.name)&&(
cleverapps.BaseFB.PERMISSIONS="public_profile"),cleverapps.SelectSocial=function(e){console.log("Choosing Select Social ("+JSON.stringify(Object.keys(e))+")"),this.socials=e,cleverapps.Social.call(this)},cleverapps.SelectSocial.prototype=Object.create(cleverapps.Social.prototype),cleverapps.SelectSocial.prototype.constructor=cleverapps.SelectSocial,cleverapps.SelectSocial.prototype.onInit=function(e){if(console.log("SelectSocial.onInit - "+this.socialInitializing),this.socialInitializing){var t=this.socials[this.socialInitializing];delete this.socialInitializing,t.onInit.apply(t,arguments)}},cleverapps.SelectSocial.prototype.init=function(i){var t=function(){for(var e in this.socials){var t=this.socials[e];if(t.isLoggedIn()){cleverapps.social=t,console.log("Change social to "+e);break}}i()}.bind(this),s=Object.keys(this.socials),n=function(){if(0!==s.length){var e=this.socialInitializing=s.shift();this.socials[e].initialize(n)}else t()}.bind(this);n()},
cleverapps.SelectSocial.prototype.onLogin=function(e){if(this.socialLogining){var t=this.socials[this.socialLogining];e===cleverapps.Social.CODE_SUCCEED&&(cleverapps.social=t,console.log("Change social to "+this.socialLogining)),delete this.socialLogining,t.onLogin.apply(t,arguments)}},cleverapps.SelectSocial.prototype.login=function(e,t,i){this.socialLogining=i.source,this.socials[this.socialLogining].login(e,t)},cleverapps.SelectSocial.prototype.getCode=function(){return Object.keys(this.socials).sort().join("-")},cc.sys.isNative&&cleverapps.override(cleverapps.SelectSocial.prototype,NativeInvite);var FriendsCache=function(e){this.data={},this.player=void 0,this.lastUpdateTime=0,this.isInvitable=e,this.load(),this.onFriendsUpdatedListeners=[],this.onUserUpdatedListener=function(){},this.playerInfoChangedListeners={}};FriendsCache.prototype.getStoreKey=function(){return this.isInvitable?cleverapps.DataLoaderTypes.INVITABLE_FRIENDS:cleverapps.DataLoaderTypes.FRIENDS},
FriendsCache.prototype.reset=function(){this.data={},this.player=void 0,this.lastUpdateTime=0,this.save()},FriendsCache.prototype.load=function(){var e=cleverapps.DataLoader.load(this.getStoreKey());e&&(this.data=e.data,this.player=e.player,this.lastUpdateTime=e.when)},FriendsCache.prototype.save=function(){var e={data:this.data,player:this.player,when:this.lastUpdateTime};cleverapps.DataLoader.save(this.getStoreKey(),e)},FriendsCache.prototype.isEmpty=function(){return 0===this.lastUpdateTime||0===this.data.length},FriendsCache.prototype.haveData=function(){return 0!==this.lastUpdateTime},FriendsCache.prototype.addFriendsUpdatedListener=function(e){this.onFriendsUpdatedListeners.push(e)},FriendsCache.prototype.setData=function(e){var t=Object.keys(this.data).length;this.data={},e.forEach(function(e){this.data[e.id]={id:e.id,name:e.first_name,avatar:e.picture&&e.picture.data&&e.picture.data.url}},this);var i=Object.keys(this.data).length;this.lastUpdateTime=Date.now(),this.save(),
t<i&&this.onFriendsUpdatedListeners.forEach(function(e){e()})},FriendsCache.prototype.getPlayer=function(){return void 0!==this.player?this.player:FriendsCache.DEFAULT_PLAYER_INFO()},FriendsCache.prototype.updatePlayerInfo=function(e){var t=this.getPlayer();this.player={id:cleverapps.user.id,self:!0,name:e.first_name,avatar:e.picture&&e.picture.data&&e.picture.data.url},this.save(),t.id===this.player.id&&t.name===this.player.name&&t.avatar===this.player.avatar||(this.onUserUpdatedListener(),cleverapps.values(this.playerInfoChangedListeners).forEach(function(e){e(t.id)}.bind(this)))},FriendsCache.prototype.getById=function(e){return this.data[e]},FriendsCache.prototype.listIds=function(){return Object.keys(this.data)},FriendsCache.prototype.listFriends=function(){return cleverapps.values(this.data)},FriendsCache.prototype.inApp=function(e){return void 0!==this.data[e]},FriendsCache.prototype.reload=function(){cleverapps.social.isLoggedIn(
)?this.isInvitable?cleverapps.social.listInvitableFriends(function(e,t){void 0!==t&&this.setData(t)}.bind(this)):cleverapps.social.listFriends(function(e,t){void 0!==t&&(this.setData(t),cleverapps.User.reportAmountFriendsDau&&cleverapps.User.reportAmountFriendsDau())}.bind(this)):cleverapps.User.reportAmountFriendsDau&&cleverapps.User.reportAmountFriendsDau()},FriendsCache.RELOAD_INTERVAL=cleverapps.parseInterval("1 hour"),FriendsCache.DEFAULT_PLAYER_INFO=function(){return{id:cleverapps.user.id,self:!0,name:Messages.get("Friends.You"),avatar:res.user_avatar}},cleverapps.AndroidSocial=function(){console.log("Choosing Android Social"),cleverapps.Social.call(this),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,this.refresh.bind(this)),setInterval(this.refresh.bind(this),cleverapps.parseInterval("30 minutes"))},cleverapps.AndroidSocial.prototype=Object.create(cleverapps.Social.prototype),cleverapps.AndroidSocial.prototype.constructor=cleverapps.AndroidSocial,
cleverapps.AndroidSocial.prototype.refresh=function(){AndroidSocialPlugin.refresh()},cleverapps.AndroidSocial.prototype.isLoggedIn=function(){return AndroidSocialPlugin.isLoggedIn()},cleverapps.AndroidSocial.prototype.getUserID=function(){return"android_"+AndroidSocialPlugin.getUserID()},cleverapps.AndroidSocial.prototype.getAccessToken=function(){return AndroidSocialPlugin.getAccessToken()},cleverapps.AndroidSocial.prototype.onLogin=function(e){this.onLoginListener&&(this.onLoginListener(e),delete this.onLoginListener)},cleverapps.AndroidSocial.prototype.login=function(t,i){this.onLoginListener=function(e){e===cleverapps.Social.CODE_SUCCEED?(cleverapps.SocialManager.onLogin(),cleverapps.history.set("fblog",1),t()):(cleverapps.SocialManager.onFailedLogin(),i&&i())},AndroidSocialPlugin.login()},cleverapps.AndroidSocial.prototype.aboutMe=function(e){var t=AndroidSocialPlugin.aboutMe();t=decodeWebViewData(t),(t=JSON.parse(t))&&t.picture&&t.picture.data&&t.picture.data.url&&(
t.picture.data.url=decodeWebViewData(t.picture.data.url)),console.log("AndroidSocial.aboutMe - "+JSON.stringify(t)),e(t)},cleverapps.AndroidSocial.prototype.getCode=function(){return cleverapps.AndroidSocial.CODE},cleverapps.AndroidSocial.isAvailable=function(){return cc.sys.isNative&&"android"===cleverapps.User.calcSource()},cleverapps.override(cleverapps.AndroidSocial.prototype,NativeInvite),cleverapps.AndroidSocial.CODE="androidsocial",cleverapps.AppleSocial=function(){console.log("Choosing Apple Social"),cleverapps.Social.call(this)},cleverapps.AppleSocial.prototype=Object.create(cleverapps.Social.prototype),cleverapps.AppleSocial.prototype.constructor=cleverapps.AppleSocial,cleverapps.AppleSocial.prototype.updateNameFromServer=function(i){var e=function(e){var t=e.name||"";console.log("AppleSocial.updateNameFromServer success - "+t),this.name=t,this.save(),i()}.bind(this),t=function(e){console.log("AppleSocial.updateNameFromServer failure - "+e),i()}.bind(this);console.log(
"AppleSocial.updateNameFromServer"),cleverapps.RestClient.get("/info/name/"+this.getUserID(),{},e,t)},cleverapps.AppleSocial.prototype.prepareData=function(e,t){e=decodeWebViewData(e),e=JSON.parse(e),console.log("AppleSocial.prepareData - "+JSON.stringify(e)),this.id=e.id||"",this.token=e.token||"",e.name&&(this.name=e.name),this.save(),this.id&&!this.name?this.updateNameFromServer(t):t()},cleverapps.AppleSocial.prototype.onInit=function(e){var t=function(){this.onInitCallback&&(console.log("AppleSocial.onInit"),this.onInitCallback(),delete this.onInitCallback)}.bind(this);this.prepareData(e,t)},cleverapps.AppleSocial.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.APPLE_SOCIAL,{id:this.id,token:this.token,name:this.name})},cleverapps.AppleSocial.prototype.init=function(e){var t=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.APPLE_SOCIAL);this.onInitCallback=e,webkitMessage("appleSocial",{action:"init",data:t}),console.log(
"AppleSocial.init - "+JSON.stringify(t))},cleverapps.AppleSocial.prototype.isLoggedIn=function(){return this.getUserID()&&this.getAccessToken()},cleverapps.AppleSocial.prototype.getUserID=function(){if(this.id)return"apple_"+this.id},cleverapps.AppleSocial.prototype.getAccessToken=function(){return this.token},cleverapps.AppleSocial.prototype.onLogin=function(e,t){var i=function(){this.onLoginListener&&(console.log("AppleSocial.onLogin - "+e),this.onLoginListener(e),delete this.onLoginListener)}.bind(this);this.prepareData(t,i)},cleverapps.AppleSocial.prototype.login=function(t,i){this.onLoginListener=function(e){e===cleverapps.Social.CODE_SUCCEED?(cleverapps.SocialManager.onLogin(),cleverapps.history.set("fblog",1),t()):(cleverapps.SocialManager.onFailedLogin(),i&&i())},webkitMessage("appleSocial",{action:"login"}),console.log("AppleSocial.login")},cleverapps.AppleSocial.prototype.aboutMe=function(e){var t={id:this.getUserID(),first_name:this.name,name:this.name};console.log(
"AppleSocial.aboutMe - "+JSON.stringify(t)),e(t)},cleverapps.AppleSocial.prototype.getCode=function(){return cleverapps.AppleSocial.CODE},cleverapps.AppleSocial.isAvailable=function(){return cc.sys.isNative&&cleverapps.webViewData&&cleverapps.webViewData.appleSocialAvailable&&"ios"===cleverapps.User.calcSource()},cleverapps.override(cleverapps.AppleSocial.prototype,NativeInvite),cleverapps.AppleSocial.CODE="applesocial",cleverapps.StartFacebook=function(){plugin.extend("facebook",{name:"",version:"",_userInfo:null,_isLoggedIn:void 0,HttpMethod:{GET:"get",POST:"post",DELETE:"delete"},CODE_SUCCEED:0,AppEvent:{ACTIVATED_APP:FB.AppEvents.EventNames.ACTIVATED_APP,COMPLETED_REGISTRATION:FB.AppEvents.EventNames.COMPLETED_REGISTRATION,VIEWED_CONTENT:FB.AppEvents.EventNames.VIEWED_CONTENT,SEARCHED:FB.AppEvents.EventNames.SEARCHED,RATED:FB.AppEvents.EventNames.RATED,COMPLETED_TUTORIAL:FB.AppEvents.EventNames.COMPLETED_TUTORIAL,ADDED_TO_CART:FB.AppEvents.EventNames.ADDED_TO_CART,
ADDED_TO_WISHLIST:FB.AppEvents.EventNames.ADDED_TO_WISHLIST,INITIATED_CHECKOUT:FB.AppEvents.EventNames.INITIATED_CHECKOUT,ADDED_PAYMENT_INFO:FB.AppEvents.EventNames.ADDED_PAYMENT_INFO,PURCHASED:FB.AppEvents.EventNames.PURCHASED,ACHIEVED_LEVEL:FB.AppEvents.EventNames.ACHIEVED_LEVEL,UNLOCKED_ACHIEVEMENT:FB.AppEvents.EventNames.UNLOCKED_ACHIEVEMENT,SPENT_CREDITS:FB.AppEvents.EventNames.SPENT_CREDITS},AppEventParam:{CURRENCY:FB.AppEvents.ParameterNames.CURRENCY,REGISTRATION_METHOD:FB.AppEvents.ParameterNames.REGISTRATION_METHOD,CONTENT_TYPE:FB.AppEvents.ParameterNames.CONTENT_TYPE,CONTENT_ID:FB.AppEvents.ParameterNames.CONTENT_ID,SEARCH_STRING:FB.AppEvents.ParameterNames.SEARCH_STRING,SUCCESS:FB.AppEvents.ParameterNames.SUCCESS,MAX_RATING_VALUE:FB.AppEvents.ParameterNames.MAX_RATING_VALUE,PAYMENT_INFO_AVAILABLE:FB.AppEvents.ParameterNames.PAYMENT_INFO_AVAILABLE,NUM_ITEMS:FB.AppEvents.ParameterNames.NUM_ITEMS,LEVEL:FB.AppEvents.ParameterNames.LEVEL,
DESCRIPTION:FB.AppEvents.ParameterNames.DESCRIPTION},AppEventParamValue:{VALUE_YES:"1",VALUE_NO:"0"},_checkLoginStatus:function(t){var i=this;FB.getLoginStatus(function(e){e&&"connected"===e.status?(i._isLoggedIn=!0,i._userInfo=e.authResponse):t&&"unknown"===e.status?i.login(cleverapps.BaseFB.PERMISSIONS,function(){i._checkLoginStatus()}):(i._isLoggedIn=!1,i._userInfo={})})},ctor:function(e){this.name="facebook",this.version="1.0",this._userInfo={},this._isLoggedIn=void 0,FB&&(FB.init(e),this._checkLoginStatus(!0),plugin.FacebookAgent=this)},getInstance:function(){return this},login:function(e,i){FB.login(function(e){if(e.authResponse){this._isLoggedIn=!0,this._userInfo=e.authResponse;var t=e.authResponse.grantedScopes.split(",");"function"==typeof i&&i(0,{accessToken:e.authResponse.accessToken,permissions:t})}else this._isLoggedIn=!1,this._userInfo={},"function"==typeof i&&i(e.error_code||1,{error_message:e.error_message||"Unknown error"})}.bind(this),{scope:e,return_scopes:!0})},
isLoggedIn:function(){return this._isLoggedIn},logout:function(t){var i=this;FB.logout(function(e){e.authResponse?(i._isLoggedIn=!1,i._userInfo={},"function"==typeof t&&t(0,{isLoggedIn:!1})):"function"==typeof t&&t(e.error_code||1,{error_message:e.error_message||"Unknown error"})})},_requestPermissions:function(e,i){var t=e.join(","),s=this;FB.login(function(e){if(e.authResponse){var t=e.authResponse.grantedScopes.split(",");s._isLoggedIn=!0,s._userInfo=e.authResponse,"function"==typeof i&&i(0,{permissions:t})}else s._isLoggedIn=!1,s._userInfo={},"function"==typeof i&&i(e.error_code||1,{error_message:e.error_message||"Unknown error"})},{scope:t,return_scopes:!0})},getAccessToken:function(){return this._userInfo?this._userInfo.accessToken:null},getUserID:function(){return this._userInfo?this._userInfo.userID:null},_share:function(e,t){FB.ui({method:"share",caption:e.caption,href:e.link},function(e){e?e.post_id?"function"==typeof t&&t(0,{didComplete:!0,post_id:e.post_id}
):"function"==typeof t&&t(e.error_code||1,{error_message:e.error_message||"Unknown error"}):"function"==typeof t&&t(1,{error_message:"Unknown error"})})},dialog:function(e,t){if(e)if(this.canPresentDialog(e)){e.name=e.name||e.site,delete e.site,e.href=e.href||e.link||e.siteUrl,delete e.siteUrl,delete e.link,e.picture=e.picture||e.image||e.photo||e.imageUrl||e.imagePath,delete e.imageUrl,delete e.imagePath,delete e.photo,delete e.image,e.caption=e.title||e.caption,delete e.title,e.description=e.text||e.description,delete e.text;var i=e.dialog;if(delete e.dialog,"shareLink"===i||"feedDialog"==i)e.method="share";else if("messageLink"==i)e.method="send",e.link=e.href;else if("shareOpenGraph"==i&&(e.method="share_open_graph",e.url)){var s={};for(var n in e.preview_property_name?s[e.preview_property_name]=e.url:s.object=e.url,e)"method"!=n&&"action_type"!=n&&"action_properties"!=n&&(e[n]&&(s[n]=e[n]),delete e[n]);e.action_properties=JSON.stringify(s)}FB.ui(e,function(e){
e&&"function"==typeof t?e.post_id||e.success?t(0,{didComplete:!0,post_id:e.post_id||""}):e.error_code?t(e.error_code,{error_message:e.error_message||"Unknown error"}):t(0,e):null==e&&"function"==typeof t&&t(1,{error_message:"Unknown error"})})}else"function"==typeof t&&t(1,{error_message:"The requested dialog: "+e.dialog+" can not be presented on Web"});else"function"==typeof t&&t(1,{error_message:"No info parameter provided"})},canPresentDialog:function(e){return!(!e||!e.dialog||"shareLink"!==e.dialog&&"feedDialog"!==e.dialog&&"shareOpenGraph"!==e.dialog&&"messageLink"!==e.dialog)},api:function(e,t,i,s){"function"==typeof i&&(s=i,i={}),FB.api(e,t,i,function(e){e.error?"function"==typeof s&&s(e.error.code,{error_message:e.error.message||"Unknown error"}):"function"==typeof s&&s(0,e)})},_getPermissionList:function(s){FB.api("/me/permissions",function(e){if(e.data){for(var t=[],i=0;i<e.data.length;i++)"granted"==e.data[i].status&&t.push(e.data[i].permission);"function"==typeof s&&s(0,{
permissions:t})}else e.error||(e.error={}),"function"==typeof s&&s(e.error.code||1,{error_message:e.error.message||"Unknown error"})})},destroyInstance:function(){},canvas:{pay:function(e,t){var i={method:"pay",action:"purchaseitem",product:e.product};"subscription"===e.type&&(i.action="create_subscription"),-1!==["cancel_subscription","reactivate_subscription","change_subscription"].indexOf(e.action)&&(i.action=e.action,i.subscription_id=e.subscription_id),FB.ui(i,function(e){e.error_code?t(e.error_code||1,{error_message:e.error_message||e.error_msg||"Unknown error"}):t(0,e)})}},appRequest:function(e,t){e?(e.method="apprequests",FB.ui(e,function(e){e?e.error_code?"function"==typeof t&&t(e.error_code,{error_message:e.error_message||"Unknown error"}):"function"==typeof t&&t(0,e):"function"==typeof t&&t(1,{error_message:"Unknown error"})})):"function"==typeof t&&t(1,{error_message:"No info parameter provided"})},logEvent:function(e,t,i){null!=e&&(
void 0===t&&void 0===i?FB.AppEvents.logEvent(e,null,null):"number"==typeof t&&void 0===i?FB.AppEvents.logEvent(e,t):"object"==typeof t&&void 0===i?FB.AppEvents.logEvent(e,null,t):FB.AppEvents.logEvent(e,t,i))},activateApp:function(){FB.AppEvents.activateApp()},logPurchase:function(e,t,i){FB.AppEvents.logPurchase(e,t,i)}})},cleverapps.VK=function(){this instanceof cleverapps.MobileVk||console.log("Choosing html5-Vk"),cleverapps.Social.MAX_INVITE_RANDOM_FRIENDS=1,cleverapps.Social.call(this)},cleverapps.VK.prototype=Object.create(cleverapps.Social.prototype),cleverapps.VK.prototype.constructor=cleverapps.VK,cleverapps.VK.prototype.getLocalStoragePreffix=function(){return"_VK"},cleverapps.VK.prototype.init=function(e){var t=cleverapps.once(function(){VK.addCallback("onRequestSuccess",function(e){console.log("onRequestSuccess",e),this.listeners.onRequest(cleverapps.Social.CODE_SUCCEED,e)}.bind(this)),VK.addCallback("onRequestCancel",function(e){console.log("onRequestCancel",e),
this.listeners.onRequest(cleverapps.Social.CODE_CANCELLED,e)}.bind(this)),VK.addCallback("onRequestFail",function(e){console.log("onRequestFail",e),this.listeners.onRequest(cleverapps.Social.CODE_FAIL,e)}.bind(this)),e()}.bind(this));this.listeners={onRequest:function(){}};var i=function(e){plugin.FacebookAgent=cleverapps.FakeFacebookAgent,t(),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR)}.bind(this);cleverapps.loadSdk("//vk.com/js/api/xd_connection.js?2",function(){VK.init(t,i,cleverapps.VK.API_VERSION)},i,3)},cleverapps.VK.prototype.sendActivity=function(e,t){if(e===cleverapps.Social.ACTIVITY.LVL_PASSED){var i=void 0,s=0,n=levels.user.getHumanReadableNumber();cleverapps.VK.MISSIONS.forEach(function(e){n===e.level&&(i=e.id)}),void 0===i&&(i=1,s=t.levelNo,cleverapps.Random.mathChoose([0,1])&&void 0!==t.score&&(i=2,s=t.score));var o={user_id:this.getUserID(),activity_id:i,
value:s,v:cleverapps.VK.API_VERSION},a=[];for(var r in o)a.push(r+"="+o[r]);cleverapps.RestClient.get("/vkappevents?"+a.join("&"),{})}},cleverapps.VK.prototype.createShortcut=function(){VK.api("account.getAppPermissions",{user_id:this.getUserID()},function(e){console.log("getAppPermissions: "+e.response),0==(256&e.response)&&ControlButtonsLogic.exitFullscreen(function(){VK.callMethod("showSettingsBox",256)})})},cleverapps.VK.prototype.isLoggedIn=function(){return!0},cleverapps.VK.prototype.getUserID=function(){return cleverapps.getRequestParameters().viewer_id},cleverapps.VK.prototype.getAccessToken=function(){return"VK_"+cleverapps.getRequestParameters().auth_key},cleverapps.VK.prototype.login=function(e){e()},cleverapps.VK.prototype.inviteFriends=function(e,t){ControlButtonsLogic.exitFullscreen(function(){VK.callMethod("showInviteBox"),t(cleverapps.Social.CODE_SUCCEED)})},cleverapps.VK.prototype.requestToOne=function(e,t,i){this.listeners.onRequest=i,
ControlButtonsLogic.exitFullscreen(function(){VK.callMethod("showRequestBox",parseInt(e),t.message)})},cleverapps.VK.prototype.request=function(e,i){var s=e.to;Array.isArray(s)||(s=[s]);var n=[],o=function(t){t===s.length?i(n.length>Math.floor(s.length/2)?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED,n):this.requestToOne(s[t],e,function(e){cleverapps.config.debugMode&&cleverapps.ReportStream.debug("requestToOne - "+JSON.stringify(arguments)),e===cleverapps.Social.CODE_SUCCEED&&n.push(s[t]),o(t+1)})}.bind(this);o(0)},cleverapps.VK.prototype.shareDialog=function(e,t){if(!e.vk)throw"No vk data to share!";ControlButtonsLogic.exitFullscreen(function(){VK.api("wall.post",{message:e.description+"\n"+cleverapps.config.vk.url,attachments:[e.vk,"https://vk.com/app"+cleverapps.config.vk.appId].join(",")},function(e){e.error?t(cleverapps.Social.CODE_CANCELLED,e.error):t(cleverapps.Social.CODE_SUCCEED)})})},cleverapps.VK.prototype.processPromo=function(t){
cleverapps.eventLogger.logEvent("vk_promo_check"),VK.api("apps.promoHasActiveGift",{promo_id:t},function(e){if(cleverapps.eventLogger.logEvent("vk_promo_response"),e&&1===e.response){if(this.givePromoReward(),-1!==["4252816","74852834","559432346","9938687","4615499"].indexOf(cleverapps.user.id))return;VK.api("apps.promoUseGift",{promo_id:t})}}.bind(this))},cleverapps.VK.prototype.isPromoAvailable=function(e,t,i){return this.isInitialized()&&-1!==i.indexOf(cleverapps.config.name)&&(null===e||Date.now()>new Date(e).getTime())&&(null===t||Date.now()<new Date(t).getTime())},cleverapps.VK.prototype.givePromoReward=function(){cleverapps.metha.displayWhenFreeFocus({focus:"VKPromoRewardWindow",action:function(e){new RewardWindow({reward:cleverapps.VK.PROMO_REWARD,rewardName:"vkpromo"}),cleverapps.metha.onceNoWindowsListener=e}}),cleverapps.eventLogger.logEvent("vk_promo_reward")},cleverapps.VK.prototype.listFriendsByApp=function(i,s){VK.api("friends.getAppUsers",{},function(e){if(e.error)s(
cleverapps.Social.CODE_FAILED,[]);else if(e.response){var t=e.response.map(cleverapps.VK.prepareId);VK.api("friends.get",{extended:1,count:1e3,fields:"photo_200"},function(e){e.error?s(cleverapps.Social.CODE_FAILED,[]):s(cleverapps.Social.CODE_SUCCEED,this.prepareFriendsData(e.response&&e.response.items,t,i))}.bind(this))}else s(cleverapps.Social.CODE_FAILED,[])}.bind(this))},cleverapps.VK.prototype.prepareFriendsData=function(e,t,i){return(e||[]).filter(function(e){return void 0===e.deactivated}).map(cleverapps.VK.formatUserData).filter(function(e){return i===(-1!==t.indexOf(e.id))})},cleverapps.VK.prototype.listFriends=function(e){this.listFriendsByApp(!0,e)},cleverapps.VK.prototype.listInvitableFriends=function(e){this.listFriendsByApp(!1,e)},cleverapps.VK.prepareId=function(e){return""+e},cleverapps.VK.formatUserData=function(e){return{id:cleverapps.VK.prepareId(e.id),name:e.first_name+" "+e.last_name,first_name:e.first_name,picture:{data:{url:e.photo_200&&-1===e.photo_200.indexOf(
"camera_200.png")?e.photo_200:void 0}}}},cleverapps.VK.prototype.aboutMe=function(i){VK.api("users.get",{fields:"photo_200"},function(e){if(e&&e.response){var t=e.response[0];i(cleverapps.VK.formatUserData(t))}else console.log("Error: "+JSON.stringify(e))})},cleverapps.VK.prototype.logEvent=function(e,t){},cleverapps.VK.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_RUSSIAN]},cleverapps.VK.isAppropriate=function(){return!cc.sys.isNative&&"web_vk"===cleverapps.User.calcSource()},cleverapps.VK.PROMO_REWARD={gold:50},"match3"===cleverapps.config.type&&cleverapps.config.results?cleverapps.VK.PROMO_REWARD={unlimitedLives:"12 hours",stars:10}:"match3"===cleverapps.config.type?cleverapps.VK.PROMO_REWARD={unlimitedLives:"12 hours",gold:20}:"stacks"===cleverapps.config.subtype&&(cleverapps.VK.PROMO_REWARD={gold:100}),cleverapps.VK.DEFAULT_HEIGHT=720,cleverapps.VK.DEFAULT_WIDTH=800,cleverapps.VK.MIN_HEIGHT=480,cleverapps.VK.SCREEN_HEIGHT_RESERVED=230,
cleverapps.VK.API_VERSION="5.107",cleverapps.VK.MISSIONS=[{id:3,level:1},{id:4,level:2},{id:5,level:3},{id:6,level:4},{id:7,level:5},{id:8,level:6},{id:9,level:10},{id:10,level:20},{id:11,level:50},{id:12,level:100},{id:13,level:150},{id:14,level:200},{id:15,level:300},{id:16,level:500},{id:17,level:750},{id:18,level:1e3},{id:19,level:1500},{id:20,level:2e3}],cleverapps.MobileVk=function(){console.log("Choosing html5-VkConnect"),cc.sys.openURL=function(e){var t=document.createElement("a");t.setAttribute("target","_blank"),t.setAttribute("href",e),t.click()},cleverapps.VK.call(this)},cleverapps.MobileVk.prototype=Object.create(cleverapps.VK.prototype),cleverapps.MobileVk.prototype.constructor=cleverapps.MobileVk,cleverapps.MobileVk.getPlatfrom=function(){return cleverapps.getRequestParameters().platform},cleverapps.MobileVk.prototype.init=function(t){"4252816"===cleverapps.user.id&&cleverapps.ReportStream.debug(window.location.href);var i=function(e){
plugin.FacebookAgent=cleverapps.FakeFacebookAgent,"vkConnect"===e&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR),t()},s=function(){var e=function(e,t){e===cleverapps.Social.CODE_SUCCEED&&(this.accessToken=t.access_token,this.scope=t.scope)}.bind(this);this.subscribe("VKWebAppAccessTokenReceived","VKWebAppAccessTokenFailed",e),vkConnect.send("VKWebAppGetAuthToken",{app_id:parseInt(cleverapps.config.vk.appId),scope:"friends"})}.bind(this);cleverapps.loadSdk(cleverapps.config.staticUrl+"cleverapps/res/vk-connect.js",function(){vkConnect.isWebView()&&this.subscribe("VKWebAppInitResult","VKWebAppInitFailed",function(e){e===cleverapps.Social.CODE_SUCCEED?(t(),s()):i()}.bind(this)),vkConnect.send("VKWebAppInit",{}),vkConnect.isWebView()||(t(),s())}.bind(this),function(){i("vkConnect")})},cleverapps.MobileVk.prototype.createShortcut=function(){},cleverapps.MobileVk.prototype.aboutMe=function(i){this.subscribe("VKWebAppGetUserInfoResult","VKWebAppGetUserInfoFailed",
function(e,t){e===cleverapps.Social.CODE_SUCCEED&&i(cleverapps.VK.formatUserData(t))}),vkConnect.send("VKWebAppGetUserInfo",{})},cleverapps.MobileVk.prototype.subscribe=function(t,i,s){var n=function(e){cleverapps.config.debugMode&&cleverapps.RestClient.post("/applogs/"+cleverapps.user.id,{event:JSON.stringify(e),type:e.detail.type,error_type:e.detail.data.error_type,error_code:e.detail.data.error_data&&e.detail.data.error_data.error_code,error_reason:e.detail.data.error_data&&e.detail.data.error_data.error_reason,detailData:e.detail.data?JSON.stringify(e.detail.data):"none",accessToken:this.accessToken,scope:this.scope}),e.detail.type===t&&(s(cleverapps.Social.CODE_SUCCEED,e.detail.data),vkConnect.unsubscribe(n)),e.detail.type===i&&(s(cleverapps.Social.CODE_FAILED,e.detail.data),vkConnect.unsubscribe(n))}.bind(this);vkConnect.subscribe(n)},cleverapps.MobileVk.prototype.showLeaderBoardBox=function(e,t){this.subscribe("VKWebAppShowLeaderBoardBoxResult","VKWebAppShowLeaderBoardBoxFailed"
,t),vkConnect.send("VKWebAppShowLeaderBoardBox",{user_result:e.userResult})},cleverapps.MobileVk.prototype.showOrderBox=function(e,t){this.subscribe("VKWebAppShowOrderBoxResult","VKWebAppShowOrderBoxFailed",t),vkConnect.send("VKWebAppShowOrderBox",{type:e.type,item:e.item})},cleverapps.MobileVk.prototype.inviteFriends=function(e,t){this.subscribe("VKWebAppShowInviteBoxResult","VKWebAppShowInviteBoxFailed",t),vkConnect.send("VKWebAppShowInviteBox",{})},cleverapps.MobileVk.prototype.requestToOne=function(e,t,i){(function(){this.subscribe("VKWebAppShowRequestBoxResult","VKWebAppShowRequestBoxFailed",i),cleverapps.config.debugMode&&cleverapps.RestClient.post("/applogs/"+cleverapps.user.id,{method:"VKWebAppShowRequestBox",uid:parseInt(e),message:t.message}),vkConnect.send("VKWebAppShowRequestBox",{uid:parseInt(e),message:t.message,requestKey:"key"})}).bind(this)()},cleverapps.MobileVk.prototype.shareDialog=function(e,t){if(!e.vk)throw"No vk data to share!";this.subscribe(
"VKWebAppShowWallPostBoxResult","VKWebAppShowWallPostBoxFailed",t),vkConnect.send("VKWebAppShowWallPostBox",{message:e.description+"\n"+cleverapps.config.vk.url,attachments:e.vk+",https://vk.com/app"+cleverapps.config.vk.appId})},cleverapps.MobileVk.prototype.listInvitableFriends=function(e){e(cleverapps.Social.CODE_SUCCEED,[])},cleverapps.MobileVk.prototype.listFriendsByApp=function(n,o){var e=function(e,t){if(e===cleverapps.Social.CODE_SUCCEED)if(t&&t.response&&t.response.map){var i=t.response.map(cleverapps.VK.prepareId),s=function(e,t){e===cleverapps.Social.CODE_SUCCEED?o(cleverapps.Social.CODE_SUCCEED,this.prepareFriendsData(t.response&&t.response.items,i,n)):o(cleverapps.Social.CODE_FAILED,[])}.bind(this);this.subscribe("VKWebAppCallAPIMethodResult","VKWebAppCallAPIMethodFailed",s),vkConnect.send("VKWebAppCallAPIMethod",{method:"friends.get",params:{v:cleverapps.MobileVk.API_VERSION,access_token:this.accessToken,count:1e3,fields:"photo_200"}})}else o(cleverapps.Social.CODE_FAILED
,[]);else o(cleverapps.Social.CODE_FAILED,[])}.bind(this);this.subscribe("VKWebAppCallAPIMethodResult","VKWebAppCallAPIMethodFailed",e),vkConnect.send("VKWebAppCallAPIMethod",{method:"friends.getAppUsers",params:{v:cleverapps.MobileVk.API_VERSION,access_token:this.accessToken}})},cleverapps.MobileVk.prototype.processPromo=function(i){cleverapps.eventLogger.logEvent("vk_promo_check");var e=function(e,t){e===cleverapps.Social.CODE_SUCCEED&&(cleverapps.eventLogger.logEvent("vk_promo_response"),t&&1===t.response&&(this.givePromoReward(),vkConnect.send("VKWebAppCallAPIMethod",{method:"apps.promoUseGift",params:{v:cleverapps.MobileVk.API_VERSION,access_token:this.accessToken,promo_id:i}})))}.bind(this);this.subscribe("VKWebAppCallAPIMethodResult","VKWebAppCallAPIMethodFailed",e),vkConnect.send("VKWebAppCallAPIMethod",{method:"apps.promoHasActiveGift",params:{v:cleverapps.MobileVk.API_VERSION,access_token:this.accessToken,promo_id:i}})},cleverapps.MobileVk.isAppropriate=function(){
return!cc.sys.isNative&&"mobile_vk"===cleverapps.User.calcSource()},cleverapps.MobileVk.API_VERSION="5.107",cleverapps.OK=function(){this instanceof cleverapps.MobileOK||console.log("Choosing html5-ok"),cleverapps.Social.call(this)},cleverapps.OK.prototype=Object.create(cleverapps.Social.prototype),cleverapps.OK.prototype.constructor=cleverapps.OK,cleverapps.OK.prototype.getLocalStoragePreffix=function(){return"_OK"},cleverapps.OK.prototype.updateSize=function(){this.listeners.getPageInfo=function(e,t){var i;try{i=JSON.parse(t).innerHeight}catch(e){i=window&&window.innerHeight||document&&document.body&&document.body.clientHeight||800}var s=i-75;s<600&&(s=600),FAPI.UI.setWindowSize(760,s),cc.view.setFrameSize(cc.view.getFrameSize().width,s)}.bind(this),[0,5,10,20,60].forEach(function(e){setTimeout(FAPI.UI.getPageInfo,1e3*e)})},cleverapps.OK.prototype.init=function(e){var t=cleverapps.once(function(){window.API_callback=function(e,t,i){console.log("Received "+e,t,i),this.listeners[e]&&(
this.listeners[e].call(this,t,i),this.listeners[e]=void 0)}.bind(this),this.updateSize(),e()}.bind(this));this.listeners={};var i=function(e){"undefined"==typeof FAPI&&(FAPI=cleverapps.FakeFAPI),t(),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR)}.bind(this);cleverapps.loadSdk("//api.ok.ru/js/fapi5.js",function(){var e=FAPI.Util.getRequestParameters();FAPI.init(e.api_server,e.apiconnection,t,i)},i,3)},cleverapps.OK.prototype.isLoggedIn=function(){return FAPI!==cleverapps.FakeFAPI},cleverapps.OK.prototype.setStatus=function(e,n){console.log("setStatus",e,n),FAPI.Client.call({method:"sdk.setStatus",event:e,status:n},function(e,t,i){console.log("sdk.setStatus response",JSON.stringify(arguments));var s="set_status_"+n+"_ok";e!==cleverapps.OK.CODE_SUCCEED&&(cleverapps.ReportStream.debug("sdk.setStatus '"+n+"'error: "+JSON.stringify(i)),s="set_status_"+n+"_error"),
cleverapps.eventLogger.logEvent(s)})},cleverapps.OK.prototype.getUserID=function(){return FAPI.Util.getRequestParameters().logged_user_id},cleverapps.OK.prototype.getAccessToken=function(){return"OK_"+FAPI.Util.getRequestParameters().session_key+"_"+FAPI.Util.getRequestParameters().auth_sig},cleverapps.OK.prototype.login=function(e){e()},cleverapps.OK.prototype.inviteFriends=function(e,i){this.listeners.showInvite=function(e,t){"noUsers"===t&&cleverapps.Notification.create("messages:inviteFriends.noUsers"),e===cleverapps.OK.CODE_SUCCEED?i(cleverapps.Social.CODE_SUCCEED):i(cleverapps.Social.CODE_CANCELLED,t)},ControlButtonsLogic.exitFullscreen(function(){FAPI.UI.showInvite(e.message)})},cleverapps.OK.prototype.request=function(e,i){"object"==typeof e.to&&(e.to=e.to.join(";")),this.listeners.showNotification=function(e,t){"error"!==e||"noUsers"!==t?e===cleverapps.OK.CODE_SUCCEED?(t=t.split(","),i(cleverapps.Social.CODE_SUCCEED,t)):i(cleverapps.Social.CODE_CANCELLED,t):i(
cleverapps.Social.CODE_SUCCEED,[])},ControlButtonsLogic.exitFullscreen(function(){FAPI.UI.showNotification(e.message,"",e.to)})},cleverapps.OK.prototype.shareDialog=function(e,i){var t=cleverapps.config.deployment+e.picture;0<=t.indexOf("?")&&(t=t.substr(0,t.indexOf("?")));var s=[{type:"app",text:e.description,images:[{url:t,title:e.name}],actions:[{text:e.name,mark:e.name}]}];this.listeners.postMediatopic=function(e,t){e===cleverapps.OK.CODE_SUCCEED?i(cleverapps.Social.CODE_SUCCEED):i(cleverapps.Social.CODE_CANCELLED,t)},ControlButtonsLogic.exitFullscreen(function(){FAPI.UI.postMediatopic({media:s},!0)})},cleverapps.OK.prototype.loadFriendsPerPage=function(e,t){e=e.slice(0,1e3);for(var i=[],s=0;s<e.length;s+=100)i.push(e.slice(s,s+100));var n=i.length,o=[],a=function(e){e!==cleverapps.Social.CODE_CANCELLED&&(o=o.concat(e)),0===--n&&t(cleverapps.Social.CODE_SUCCEED,o)};i.forEach(function(e){this.aboutUser(e,a,a)}.bind(this))},cleverapps.OK.prototype.listFriends=function(n){
FAPI.Client.call({method:"friends.getAppUsers"},function(e,t,i){if(e!==cleverapps.OK.CODE_SUCCEED)return console.log("list friends error: "+i),void n(cleverapps.Social.CODE_CANCELLED);var s=t.uids;cleverapps.social.loadFriendsPerPage(s,n)})},cleverapps.OK.prototype.listInvitableFriends=function(o){FAPI.Client.call({method:"friends.get",sort_type:"PRESENT"},function(e,t,i){if(e!==cleverapps.OK.CODE_SUCCEED)return console.log("list ivitable friends error: "+i),void o(cleverapps.Social.CODE_CANCELLED);var n=t;FAPI.Client.call({method:"friends.getAppUsers"},function(e,t,i){if(e!==cleverapps.OK.CODE_SUCCEED)return console.log("list friends error: "+i),void o(cleverapps.Social.CODE_CANCELLED);var s=t.uids;cleverapps.social.loadFriendsPerPage(cleverapps.substract(n,s),o)})})},cleverapps.OK.formatUserData=function(e){return-1!==e.pic128x128.indexOf("stub_128x128.gif")&&(e.pic128x128=""),-1!==e.pic128x128.indexOf("stub/user")&&(e.pic128x128=""),{id:e.uid,name:e.first_name+" "+e.last_name,
first_name:e.first_name,picture:{data:{url:e.pic128x128}}}},cleverapps.OK.prototype.aboutUser=function(e,n,o){var a=!Array.isArray(e);a||(e=e.join(",")),FAPI.Client.call({uids:e,fields:"first_name,last_name,uid,pic128x128",method:"users.getInfo"},function(e,t,i){if(e===cleverapps.OK.CODE_SUCCEED){var s=t.map(function(e){return cleverapps.OK.formatUserData(e)});n(a?s[0]:s)}else o&&o(cleverapps.Social.CODE_CANCELLED,i)})},cleverapps.OK.prototype.aboutMe=function(e){this.aboutUser(this.getUserID(),e)},cleverapps.OK.prototype.logEvent=function(e,t){},cleverapps.OK.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_RUSSIAN]},cleverapps.OK.isAppropriate=function(){return!cc.sys.isNative&&"web_ok"===cleverapps.User.calcSource()},cleverapps.OK.CODE_SUCCEED="ok",cleverapps.FakeFAPI={UI:{getPageInfo:function(){},showInvite:function(){},showNotification:function(){},postMediatopic:function(){},setWindowSize:function(){},showPayment:function(){}},invokeUIMethod:function(){},Util:{
getRequestParameters:function(){return{}}},Client:{call:function(){}}},cleverapps.MobileOK=function(){console.log("Choosing mobile-ok"),cleverapps.OK.call(this),this.isFullScreen=!1,cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){this.isFullScreen=!1}.bind(this)),this.isInApp()&&(cleverapps.Promotion.prototype.isReady=function(){return!1})},cleverapps.MobileOK.prototype=Object.create(cleverapps.OK.prototype),cleverapps.MobileOK.prototype.constructor=cleverapps.MobileOK,cleverapps.MobileOK.prototype.updateSize=function(){},cleverapps.MobileOK.prototype.createShortcut=function(){"undefined"!=typeof OKApp&&"function"==typeof OKApp.suggestDesktopIcon&&OKApp.suggestDesktopIcon()},cleverapps.MobileOK.prototype.isInApp=function(){var e=window&&window.navigator&&window.navigator.userAgent;return!!(e&&0<=e.indexOf("OkApp"))},cleverapps.MobileOK.isAppropriate=function(){return!cc.sys.isNative&&"mobile_ok"===cleverapps.User.calcSource()},
cleverapps.MobileOK.prototype.isFullScreenAvailable=function(){return this.isInitialized()&&!this.isInApp()&&cc.sys.os===cc.sys.OS_ANDROID},cleverapps.MobileOK.prototype.requestFullScreen=function(i){i=i||function(){},this.isFullScreenAvailable()&&!this.isFullScreen?(this.listeners.requestFullscreen=cleverapps.once(function(e,t){"ok"===e?cleverapps.whenResolutionStable(function(){i(),this.isFullScreen=!0}.bind(this)):i()}.bind(this)),FAPI.invokeUIMethod("requestFullscreen")):i()},cleverapps.MyMailRu=function(){this instanceof cleverapps.MobileMyMailRu||console.log("Choosing html5-MyMailRu"),cleverapps.UI.SOCIAL_CLICK_THROTTLE=3e3,cleverapps.Social.call(this)},cleverapps.MyMailRu.prototype=Object.create(cleverapps.Social.prototype),cleverapps.MyMailRu.prototype.constructor=cleverapps.MyMailRu,cleverapps.MyMailRu.prototype.getLocalStoragePreffix=function(){return"_MM"},cleverapps.MyMailRu.prototype.init=function(t){this.listeners={friendsInvitation:function(){},friendsRequest:function(
){},streamPublish:function(){}};var i=cleverapps.once(function(){if(this instanceof cleverapps.MobileMyMailRu)this.createHeaderAndFooter(t);else{if("undefined"!=typeof window&&window.outerHeight&&window.innerHeight){var e=window.outerHeight-250;mailru.app.utils.setHeight(e),cc.view.setFrameSize(window.innerWidth,e)}mailru.events.listen(mailru.app.events.friendsInvitation,function(e){this.listeners.friendsInvitation(e)}.bind(this)),mailru.events.listen(mailru.app.events.friendsRequest,function(e){this.listeners.friendsRequest(e)}.bind(this)),mailru.events.listen(mailru.common.events.streamPublish,function(e){this.listeners.streamPublish(e)}.bind(this)),mailru.events.listen(mailru.app.events.readHash,function(e){e&&e.channel&&levels.user.setChannel(e.channel)}),mailru.app.utils.hash.read(),setTimeout(t,300)}}.bind(this)),e=function(e){"undefined"==typeof mailru&&(mailru=cleverapps.FakeMailRU),i(),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT
):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR)}.bind(this);cleverapps.loadSdk("//connect.mail.ru/js/loader.js",function(){mailru.loader.require("api",function(){mailru.app.init(cleverapps.config.myMailRu.privateKey),i()})},e,3)},cleverapps.MyMailRu.prototype.getRequestParameters=function(){var e={},t=window.location.search;if(t)for(var i=(t=t.substr(1)).split("&"),s=0;s<i.length;s++){var n=i[s].split("="),o=n[0],a=n[1];a=decodeURIComponent(a.replace(/\+/g," ")),e[o]=a}return e},cleverapps.MyMailRu.prototype.isLoggedIn=function(){return!0},cleverapps.MyMailRu.prototype.getUserID=function(){return this.getRequestParameters().vid},cleverapps.MyMailRu.prototype.getAccessToken=function(){var e=[],t=this.getRequestParameters();for(var i in t)"sig"!==i&&e.push(i);e.sort();for(var s="",n=0;n<e.length;n++)s+=e[n]+"="+t[e[n]];return"MM_"+t.sig+"_"+s},cleverapps.MyMailRu.prototype.login=function(e){e()},cleverapps.MyMailRu.prototype.inviteFriends=function(e,t){
this.listeners.friendsInvitation=function(e){"opened"!==e.status&&t(e.data&&e.data.length?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)},ControlButtonsLogic.exitFullscreen(function(){mailru.app.friends.invite({text:e.message})})},cleverapps.MyMailRu.prototype.request=function(e,t){this.listeners.friendsRequest=function(e){"opened"!==e.status&&(e.data&&e.data.length?t(cleverapps.Social.CODE_SUCCEED,e.data):t(cleverapps.Social.CODE_CANCELLED))},ControlButtonsLogic.exitFullscreen(function(){mailru.app.friends.request({text:e.message,image_url:cleverapps.config.deployment+cleverapps.ShareBonus.cycleShareData("share").picture,friends:e.to})})},cleverapps.MyMailRu.prototype.shareDialog=function(e,t){this.listeners.streamPublish=function(e){"opened"!==e.status&&("publishSuccess"===e.status?t(cleverapps.Social.CODE_SUCCEED):(console.log(e.status),t(cleverapps.Social.CODE_CANCELLED)))};var i={title:e.name,text:e.description,img_url:cleverapps.config.deployment+e.picture}
;ControlButtonsLogic.exitFullscreen(function(){mailru.common.stream.post(i)})},cleverapps.MyMailRu.prototype.listFriends=function(s){mailru.common.friends.getAppUsers(function(e){for(var t=[],i=0;i<e.length;i++)t.push(cleverapps.MyMailRu.formatUserData(e[i]));s(cleverapps.Social.CODE_SUCCEED,t)},!0)},cleverapps.MyMailRu.prototype.listInvitableFriends=function(s){mailru.common.friends.getExtended(function(e){for(var t=[],i=0;i<e.length;i++)e[i].app_installed||t.push(cleverapps.MyMailRu.formatUserData(e[i]));s(cleverapps.Social.CODE_SUCCEED,t)})},cleverapps.MyMailRu.formatUserData=function(e){return{id:e.uid,name:e.first_name+" "+e.last_name,first_name:e.first_name,picture:{data:{url:e.pic_128}}}},cleverapps.MyMailRu.prototype.aboutUser=function(e,i,s){var n=!Array.isArray(e);mailru.common.users.getInfo(function(e){if(e.error)s&&s(cleverapps.Social.CODE_FAILED,e.error);else{e&&"function"==typeof e.map||cleverapps.ReportStream.debug("MailRU aboutUser response - "+JSON.stringify(e))
;var t=e.map(function(e){return cleverapps.MyMailRu.formatUserData(e)});i(n?t[0]:t)}},e)},cleverapps.MyMailRu.prototype.aboutMe=function(e){this.aboutUser(this.getUserID(),e)},cleverapps.MyMailRu.prototype.logEvent=function(e,t){},cleverapps.MyMailRu.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_RUSSIAN]},cleverapps.MyMailRu.isAppropriate=function(){return!cc.sys.isNative&&"web_mm"===cleverapps.User.calcSource()},cleverapps.FakeMailRU={events:{listen:function(){}},app:{friends:{invite:function(){},request:function(){}},utils:{setHeight:function(){},hash:{read:function(){}}},events:{},init:function(){}},common:{stream:{post:function(){}},friends:{getAppUsers:function(){},getExtended:function(){}},users:{getInfo:function(){}},events:{}},loader:{require:function(){}}},cleverapps.MobileMyMailRu=function(){console.log("Choosing mobile-MyMailRu"),cleverapps.MyMailRu.call(this)},cleverapps.MobileMyMailRu.prototype=Object.create(cleverapps.MyMailRu.prototype),
cleverapps.MobileMyMailRu.prototype.constructor=cleverapps.MobileMyMailRu,cleverapps.MobileMyMailRu.prototype.createHeaderAndFooter=function(s){var e=this.getRequestParameters();mailru.callhf=function(e){var t=document.createElement("div");t.innerHTML=e.header,document.body.insertBefore(t,document.body.firstChild);var i=document.createElement("div");i.style.position="absolute",i.style.top=window.innerHeight-27+"px",i.style.left="0px",i.style.height="27px",i.style.width="100%",i.style.zIndex="-1",i.innerHTML=e.footer,document.body.appendChild(i),cleverapps.canvasTop="43px",cleverapps.decCanvasHeight=70,cleverapps.setupDesignResolution(),s()};var t={method:"mobile.getCanvas",app_id:e.app_id,cb:"mailru.callhf",session_key:e.session_key,mobile_spec:e.mobile_spec};t=mailru.utils.sign(t),mailru.utils.apiOverJSONP(t,"https://appsmail.ru/platform/api")},cleverapps.MobileMyMailRu.prototype.inviteFriends=function(e,t){cleverapps.Notification.create("messages:mobileNotAvailable"),t(
cleverapps.Social.CODE_CANCELLED)},cleverapps.MobileMyMailRu.prototype.request=function(e,t){cleverapps.Notification.create("messages:mobileNotAvailable"),t(cleverapps.Social.CODE_CANCELLED)},cleverapps.MobileMyMailRu.prototype.shareDialog=function(e,t){cleverapps.Notification.create("messages:mobileNotAvailable"),t(cleverapps.Social.CODE_CANCELLED)},cleverapps.MobileMyMailRu.isAppropriate=function(){return!cc.sys.isNative&&"mobile_mm"===cleverapps.User.calcSource()},cleverapps.Mobage=function(){this instanceof cleverapps.SPMobage||console.log("Choosing html5-mobage"),cleverapps.Social.call(this),this.increaseViralBonuses()},cleverapps.Mobage.prototype=Object.create(cleverapps.Social.prototype),cleverapps.Mobage.prototype.constructor=cleverapps.Mobage,cleverapps.Mobage.prototype.increaseViralBonuses=function(){HelpFromFriendsWindow.TYPES.addmoves.amount=5,BountyManager.PRIZES.forEach(function(e){e.amount*=2})},cleverapps.Mobage.prototype.getLocalStoragePreffix=function(){return"_mbga"}
,cleverapps.Mobage.HEIGHT=860,cleverapps.Mobage.prototype.init=function(s){cleverapps.once(function(){gadgets.window.adjustHeight(cleverapps.Mobage.HEIGHT);var e=opensocial.newDataRequest();e.add(e.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER),"viewer"),e.send(function(e){if(e.hadError());else{var t=e.get("viewer");if(t.hadError());else{var i=t.getData();this.user=cleverapps.Mobage.formatUserData(i),console.log(this.user),s()}}}.bind(this))}.bind(this))()},cleverapps.Mobage.prototype.isLoggedIn=function(){return!0},cleverapps.Mobage.prototype.getUserID=function(){return this.user.id},cleverapps.Mobage.prototype.getAccessToken=function(){return"mbga"},cleverapps.Mobage.prototype.login=function(e){e()},cleverapps.Mobage.prototype.sendActivity=function(e,t){var i=cleverapps.Social.ACTIVITIES_CONFIG[e];if(i.probability>Math.random()){var s=cleverapps.Random.mathChoose(i.messages),n={};n[opensocial.Activity.Field.TITLE]=Messages.get(s.title),
n[opensocial.Activity.Field.BODY]=Messages.get(s.body,t);var o=opensocial.newActivity(n);opensocial.requestCreateActivity(o,opensocial.CreateActivityPriority.LOW,function(e){e.hadError()})}},cleverapps.Mobage.prototype.inviteFriends=function(e,t){var i={};i[opensocial.Message.Field.TITLE]=e.title;var s=opensocial.newMessage(e.message,i);ControlButtonsLogic.exitFullscreen(function(){opensocial.requestShareApp("VIEWER_FRIENDS",s,function(e){e.hadError()?t(cleverapps.Social.CODE_CANCELLED,e):t(cleverapps.Social.CODE_SUCCEED)})})},cleverapps.Mobage.prototype.requestToOne=function(e,t,i){var s={};s[opensocial.Message.Field.TITLE]=t.title;var n=t.message,o=opensocial.newMessage(n,s),a=e;ControlButtonsLogic.exitFullscreen(function(){opensocial.requestSendMessage(a,o,function(e){if(e.hadError())i(cleverapps.Social.CODE_CANCELLED);else{var t=e.getData();t.recipientIds&&0<t.recipientIds.length?i(cleverapps.Social.CODE_SUCCEED):i(cleverapps.Social.CODE_CANCELLED)}})})},
cleverapps.Mobage.prototype.request=function(e,i){var s=e.to;Array.isArray(s)||(s=[s]);var n=[],o=function(t){t===s.length?i(0<n.length?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED,n):this.requestToOne(s[t],e,function(e){e===cleverapps.Social.CODE_SUCCEED&&n.push(s[t]),setTimeout(function(){o(t+1)},500)})}.bind(this);o(0)},cleverapps.Mobage.prototype.shareDialog=function(e,i){var t=cleverapps.config.deployment+e.picture;0<=t.indexOf("?")&&(t=t.substr(0,t.indexOf("?")));var s=opensocial.newMediaItem("image/jpg",t);s.setField(opensocial.MediaItem.Field.TYPE,opensocial.MediaItem.Type.IMAGE);var n={};n[mbga.Diary.Field.TITLE]=e.name,n[mbga.Diary.Field.CONTENT]=e.description,n[mbga.Diary.Field.MEDIA_ITEMS]=[s];var o=mbga.newCreateDiary(n);ControlButtonsLogic.exitFullscreen(function(){mbga.requestCreateDiary(o,function(e){if(e.hadError())i(cleverapps.Social.CODE_FAILED,e);else{var t=e.getData().getEntryURL();console.log(t),i(
t?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)}})})},cleverapps.Mobage.prototype.listFriendsByApp=function(i,s){var e={};e[opensocial.DataRequest.PeopleRequestFields.MAX]=1e3,e[opensocial.DataRequest.PeopleRequestFields.PROFILE_DETAILS]=[opensocial.Person.Field.HAS_APP];var t={};t[opensocial.IdSpec.Field.USER_ID]=opensocial.IdSpec.PersonId.VIEWER,t[opensocial.IdSpec.Field.GROUP_ID]=opensocial.IdSpec.GroupId.FRIENDS;var n=opensocial.newIdSpec(t),o=opensocial.newDataRequest();o.add(o.newFetchPeopleRequest(n,e),"friends"),o.send(function(e){if(e.hadError())s(cleverapps.Social.CODE_FAILED);else{var t=e.get("friends").getData().asArray();t=t.filter(function(e){return e.getField(opensocial.Person.Field.HAS_APP)===i}),s(cleverapps.Social.CODE_SUCCEED,t.map(cleverapps.Mobage.formatUserData))}})},cleverapps.Mobage.prototype.listFriends=function(e){this.listFriendsByApp(!0,e)},cleverapps.Mobage.prototype.listInvitableFriends=function(e){this.listFriendsByApp(!1,e)},
cleverapps.Mobage.formatUserData=function(e){return{id:e.getId(),name:e.getDisplayName(),first_name:e.getDisplayName(),picture:{data:{url:cleverapps.Mobage.proxyAvatar(e.getField(opensocial.Person.Field.THUMBNAIL_URL))}}}},cleverapps.Mobage.proxyAvatar=function(e){return cleverapps.config.deployment.replace("https","http")+"/proxy"+e.match(/.*profile(.*)/)[1]},cleverapps.Mobage.prototype.aboutMe=function(e){e(this.user)},cleverapps.Mobage.prototype.logEvent=function(e,t){},cleverapps.Mobage.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_JAPANESE]},cleverapps.Mobage.isAppropriate=function(){return!cc.sys.isNative&&"mbga"===cleverapps.User.calcSource()},cleverapps.Mobage.CODE_SUCCEED="ok",cleverapps.SPMobage=function(){console.log("Choosing sp-mobage"),cleverapps.Mobage.call(this),this.clientData=cleverapps.SPMobage.CLIEND_DATA;var e=cleverapps.config.deployment.replace("https","http");this.clientData.redirectUrl=e+"/publish/html5"+(
cleverapps.config.debugMode?"-staging":"")+"/index.html"},cleverapps.SPMobage.prototype=Object.create(cleverapps.Mobage.prototype),cleverapps.SPMobage.prototype.constructor=cleverapps.SPMobage,cleverapps.SPMobage.prototype.getLocalStoragePreffix=function(){return"_sp_mbga"},cleverapps.SPMobage.prototype.needTokenRefresh=function(){return!this.clientData.token||!this.clientData.token.expireTime||this.clientData.token.expireTime<=Date.now()},cleverapps.SPMobage.prototype.checkAccessToken=function(s){s=s||function(){};var e=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i+"="+e[i]);cleverapps.RestClient.get(e.path+"?"+t.join("&"),{},function(e){this.clientData.token.accessToken=e.accessToken,this.clientData.token.refreshToken=e.refreshToken,this.clientData.token.expireTime=Date.now()+1e3*e.expiresIn,s()}.bind(this))}.bind(this),t={redirect_uri:this.clientData.redirectUrl};this.clientData.token?this.needTokenRefresh()?(t.path="/spmbgatoken/refresh",
t.refresh_token=this.clientData.token.refreshToken,e(t)):s():(this.clientData.token={},t.path="/spmbgatoken/get",t.code=this.clientData.code,e(t))},cleverapps.SPMobage.prototype.init=function(t){this.loggedIn=!1,this.checkInProcess=!1;var e=function(){AddSPMobageFooter(),this.checkLoginStatus(t),setInterval(this.checkLoginStatus.bind(this),cleverapps.parseInterval(cleverapps.SPMobage.CHECK_STATUS_INTERVAL))}.bind(this),i=function(e){"undefined"==typeof mobage&&(mobage=cleverapps.FakeSPMobage),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR),t()}.bind(this),s=cleverapps.config.debugMode?cleverapps.SPMobage.MOBAGE_API.SANDBOX:cleverapps.SPMobage.MOBAGE_API.PRODUCTION;cleverapps.loadSdk(s,function(){},i,3),document.addEventListener("mobageReady",function(){try{mobage.init({clientId:this.clientData.clientId,redirectUri:this.clientData.redirectUrl}),e()}catch(e){console.log(
"Mobage init fail",e),i()}}.bind(this))},cleverapps.SPMobage.prototype.getPlayerInfo=function(i){mobage.api.people.get({userId:"@me",groupId:"@self",fields:["id","displayName","thumbnailUrl"]},function(e,t){e?console.log("Failed requesting user info",e):this.user=cleverapps.SPMobage.formatUserData(t),i()}.bind(this))},cleverapps.SPMobage.prototype.login=function(t,i){if(this.isLoggedIn())t();else{cleverapps.metha.display({focus:"SPMobageLogin",action:function(e){var t=new WaitWindow,i=t.createListener(t.close.bind(t,[!0]));setTimeout(i,4e3);var s=mobage.event.subscribe("modal.afterOpen",function(){i(),mobage.event.unsubscribe(s)});cleverapps.metha.onceNoWindowsListener=e}});var s=function(e){this.loggedIn=!0,this.clientData.code=e.response.code,this.getPlayerInfo(function(){cleverapps.SocialManager.onLogin(),t()}),this.checkAccessToken()}.bind(this);mobage.oauth.connect({state:this.clientData.state},function(e,t){e?(i&&i(),console.log("Authorization failed:",e)):s(t)}.bind(this))}},
cleverapps.SPMobage.prototype.checkLoginStatus=function(i){if(i=i||function(){},!this.checkInProcess){this.checkInProcess=!0;try{mobage.oauth.getConnectedStatus({state:this.clientData.state},function(e,t){this.checkInProcess=!1,t?(this.clientData.code=t.response.code,this.loggedIn=!0,this.getPlayerInfo(i)):(this.loggedIn=!1,i())}.bind(this))}catch(e){this.checkInProcess=!1,console.log("Get connect status error",e),i()}}},cleverapps.SPMobage.prototype.isLoggedIn=function(){return this.loggedIn},cleverapps.SPMobage.formatUserData=function(e){return{id:e.id,name:e.displayName,first_name:e.displayName,picture:{data:{url:cleverapps.SPMobage.proxyAvatar(e.thumbnailUrl)}}}},cleverapps.SPMobage.proxyAvatar=function(e){return cleverapps.config.deployment.replace("https","http")+"/proxy/sp"+e.match(/.*img_u(.*)/)[1]},cleverapps.SPMobage.prototype.listFriendsByApp=function(s,n){mobage.api.people.get({userId:"@me",groupId:"@friends",fields:["id","displayName","thumbnailUrl","hasApp"]},function(e,t
){if(e)console.log("Failed fetching friends",e),n(cleverapps.Social.CODE_FAILED);else{var i=t.entry;i=i.filter(function(e){return e.hasApp===s}),n(cleverapps.Social.CODE_SUCCEED,i.map(cleverapps.SPMobage.formatUserData))}})},cleverapps.SPMobage.prototype.inviteFriends=function(e,i){mobage.ui.open("invitation",{},function(e,t){e?i(cleverapps.Social.CODE_CANCELLED,e):"mobage"===t.response.result.channel&&i(cleverapps.Social.CODE_SUCCEED)})},cleverapps.SPMobage.prototype.request=function(e,t){t(cleverapps.Social.CODE_SUCCEED)},cleverapps.SPMobage.prototype.shareDialog=function(e,t){t(cleverapps.Social.CODE_SUCCEED)},cleverapps.SPMobage.prototype.sendActivity=function(e,t){},cleverapps.SPMobage.isAppropriate=function(){return!cc.sys.isNative&&"sp_mbga"===cleverapps.User.calcSource()},cleverapps.SPMobage.MOBAGE_API={SANDBOX:"https://cdn-sb-connect.mobage.jp/jssdk/mobage-jssdk-client.3.9.0.min.js",PRODUCTION:"https://cdn-connect.mobage.jp/jssdk/mobage-jssdk-client.2.15.1.min.js"},
cleverapps.SPMobage.CLIEND_DATA={clientId:cleverapps.config.sp_mbga&&cleverapps.config.sp_mbga.url,state:"mobage-connect_"+Math.random().toString(36).slice(-16),code:null},cleverapps.SPMobage.CHECK_STATUS_INTERVAL="10 minutes",cleverapps.FakeSPMobage={ui:{open:function(){},show:function(){}},event:{subscribe:function(){},unsubscribe:function(){}},oauth:{connect:function(){},getConnectedStatus:function(){}},api:{people:{get:function(){}}}};var AddSPMobageFooter=function(){var e=document.createElement("div");e.style.position="absolute",e.style.top=window.innerHeight-27+"px",e.style.height="27px",e.style.width="100%",e.style.background="#e3e3e3",e.style.display="table",e.innerHTML=AddSPMobageFooter.getContentHtml(),document.body.appendChild(e),cleverapps.decCanvasHeight=27,cleverapps.setupDesignResolution()};AddSPMobageFooter.getContentHtml=function(){
var e="style='display: table-cell;\nwidth: 25%;\ntext-align: center;\nvertical-align: middle;\nborder-right: 1px solid #5f5f5f;\nfont-size: 80%;\ncolor: #5f5f5f;\nline-height: normal;\nfont-weight: bold;'";return"<div "+e+" onclick='mobage.ui.show(\"portal\", {});'>Mobage</div><div "+e+" onclick='mobage.ui.show(\"inquiry\", {});'></div><div "+e+" onclick='mobage.ui.open(\"client_configuration\", {}, function() {});'></div><div "+e+" onclick='mobage.ui.show(\"commercial_transaction\");'></div>"},cleverapps.Html5=function(){console.log("Choosing html5-facebook"),cleverapps.BaseFB.call(this)},cleverapps.Html5.prototype=Object.create(cleverapps.BaseFB.prototype),cleverapps.Html5.prototype.constructor=cleverapps.Html5,cleverapps.Html5.prototype.init=function(e){var t,i,s=cleverapps.once(function(){setTimeout(e,500),void 0!==i&&(clearInterval(i),i=void 0),void 0!==t&&(clearTimeout(t),t=void 0),cleverapps.social.deleteAllRequests()}),n=function(e){
plugin.FacebookAgent&&plugin.FacebookAgent.getInstance()&&void 0!==plugin.FacebookAgent.getInstance()._isLoggedIn?s():(plugin.FacebookAgent=cleverapps.FakeFacebookAgent,s(),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR))}.bind(this);cleverapps.loadSdk("//connect.facebook.net/en_US/sdk.js",function(){t=setTimeout(function(){n("timeout")},9e4)},n,3),window.fbAsyncInit=function(){plugin.FacebookAgent||(cleverapps.StartFacebook(),i=setInterval(function(){plugin.FacebookAgent&&plugin.FacebookAgent.getInstance()&&void 0!==plugin.FacebookAgent.getInstance()._isLoggedIn&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FACEBOOK_INITED),s())},50))}},cleverapps.Html5.prototype.isLoggedIn=function(){return this.initialized&&plugin.FacebookAgent.getInstance().isLoggedIn()},cleverapps.Html5.prototype.getUserID=function(){return plugin.FacebookAgent.getInstance().getUserID()},
cleverapps.Html5.prototype.getAccessToken=function(){return plugin.FacebookAgent.getInstance().getAccessToken()},cleverapps.Html5.prototype.login=function(t,i){if(!this.isInitialized())return cleverapps.Notification.create("messages:SocialManager.Initialization"),void(i&&i());ControlButtonsLogic.exitFullscreen(function(){plugin.FacebookAgent.getInstance().login(cleverapps.BaseFB.PERMISSIONS,function(e){e===cleverapps.Social.CODE_SUCCEED?(cleverapps.SocialManager.onLogin(),t()):(cleverapps.SocialManager.onFailedLogin(),i&&i())})})},cleverapps.Html5.prototype.inviteFriends=function(e,t){this.request(e,t)},cleverapps.Html5.prototype.request=function(e,t){delete e.element,"object"==typeof e.to&&(e.to=e.to.join(",")),ControlButtonsLogic.exitFullscreen(function(){plugin.FacebookAgent.getInstance().appRequest(e,t)})},cleverapps.Html5.prototype.shareDialog=function(e,t){var i=this.getShareDialogLink(e);console.log("share link",i);var s={dialog:"feedDialog",link:i,caption:Messages.get(
cleverapps.config.title)};ControlButtonsLogic.exitFullscreen(function(){plugin.FacebookAgent.getInstance().dialog(s,t)})},cleverapps.Html5.prototype.api=function(e,t,i,s){if("function"==typeof(i=i||{})&&(s=i,i={}),!this.isLoggedIn())return console.log("Not logged in!"),void(s&&s(cleverapps.Social.CODE_CANCELLED));void 0===t?(t=plugin.FacebookAgent.HttpMethod.GET,s=function(){}):"function"==typeof t&&(s=t,t=plugin.FacebookAgent.HttpMethod.GET),plugin.FacebookAgent.getInstance().api(e,t,i,s)},cleverapps.Html5.prototype.logEvent=function(e,t){plugin.FacebookAgent&&plugin.FacebookAgent.getInstance()&&plugin.FacebookAgent.getInstance().logEvent(e,0,t)},cleverapps.Html5.isAppropriate=function(){return!cc.sys.isNative},cleverapps.FakeFacebookAgent={getInstance:function(){return this},isLoggedIn:function(){return!1},logEvent:function(){},login:function(e,t){t(cleverapps.Social.CODE_FAILED)},getAccessToken:function(){},dialog:function(e,t){t(cleverapps.Social.CODE_FAILED)},appRequest:function(e
,t){t(cleverapps.Social.CODE_FAILED)},api:function(e,t,i,s){"function"==typeof i&&(s=i,i={}),s(cleverapps.Social.CODE_FAILED)},HttpMethod:{GET:"get"}},cleverapps.Instant=function(){console.log("Choosing Instant-facebook"),cleverapps.Social.call(this),SelectFriendWindow.MAX_SELECTED=1},cleverapps.Instant.prototype=Object.create(cleverapps.Social.prototype),cleverapps.Instant.prototype.constructor=cleverapps.Instant,cleverapps.Instant.Adapt=function(){cc.sys.isMobile||(cleverapps.Promotion.prototype.isReady=function(){return!1}),FBInstant.onPause(function(){cleverapps.eventLogger.logEvent("instant_pause")}),cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){cleverapps.eventLogger.logEvent("instant_hide")})},cleverapps.Instant.LoadSdk=function(e){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","//connect.facebook.net/en_US/fbinstant.6.3.js"),t.onload=function(){console.log("Loaded FBInstant sdk"),e()},t.onerror=function(){
console.log("Failed initialize sdk")},document.body.appendChild(t)},cleverapps.Instant.prototype.createShortcut=function(){cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.INSTANT_BOT_CREATED)?cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.INSTANT_SHORTCUT_CREATED)||this._createShortcut():this._createBot()},cleverapps.Instant.prototype._createBot=function(){FBInstant.player.canSubscribeBotAsync().then(function(e){e&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_BOT_SHOW),FBInstant.player.subscribeBotAsync().then(function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_BOT),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.INSTANT_BOT_CREATED,1)}))})},cleverapps.Instant.prototype._createShortcut=function(){FBInstant.canCreateShortcutAsync().then(function(e){e&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_SHORTCUT_SHOW),FBInstant.createShortcutAsync().then(function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_SHORTCUT)
,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.INSTANT_SHORTCUT_CREATED,1)}))})},cleverapps.Instant.prototype._update=function(i,s){var e=i.image||cleverapps.ShareBonus.cycleShareData("share").picture;this.getBase64Image(e,function(e,t){e?(console.log(e),s(cleverapps.Social.CODE_FAILED)):(s(cleverapps.Social.CODE_SUCCEED),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_UPDATE),FBInstant.updateAsync({action:"CUSTOM",image:t,text:{default:i.message},template:i.template,strategy:"IMMEDIATE",notification:"PUSH"}))})},cleverapps.Instant.prototype.init=function(e){cleverapps.Instant.LoadSdk(function(){FBInstant.initializeAsync().then(function(){cleverapps.Instant.Adapt(),InstantLoaderScene.whenLoaded(function(){FBInstant.startGameAsync().then(e)})}.bind(this))}.bind(this))},cleverapps.Instant.prototype.logEvent=function(e,t){"undefined"!=typeof FBInstant&&FBInstant.logEvent(e,1,t)},cleverapps.Instant.prototype.isLoggedIn=function(){return!0},
cleverapps.Instant.prototype.getUserID=function(){return FBInstant.player.getID()},cleverapps.Instant.prototype.inviteFriends=function(e,t){t=this.waitWindowCallback(t),FBInstant.context.chooseAsync({filters:["NEW_PLAYERS_ONLY"],minSize:2,maxSize:2}).then(function(){this._update({template:"invite",message:e.message},t)}.bind(this)).catch(function(){t(cleverapps.Social.CODE_FAILED)})},cleverapps.Instant.prototype.request=function(t,i){i=this.waitWindowCallback(i),FBInstant.context.createAsync(t.to[0]).then(function(){this._update({template:"request",message:t.message},i)}.bind(this)).catch(function(e){console.log("send request to "+t.to[0]+" failed",e),-1===["SAME_CONTEXT","INVALID_PARAM"].indexOf(e.code)?i(cleverapps.Social.CODE_FAILED):i(cleverapps.Social.CODE_SUCCEED)})},cleverapps.Instant.prototype.shareDialog=function(i,s){s=this.waitWindowCallback(s),this.getBase64Image(i.picture,function(e,t){e?(console.log(e),s(cleverapps.Social.CODE_FAILED)):FBInstant.shareAsync({
intent:"SHARE",image:t,text:i.description}).then(function(){s(cleverapps.Social.CODE_SUCCEED)}).catch(function(){s(cleverapps.Social.CODE_FAILED)})})},cleverapps.Instant.prototype.waitWindowCallback=function(e){var t=new WaitWindow;return cleverapps.metha.display({focus:"waitWindowCallback",action:function(e){cleverapps.metha.onceNoWindowsListener=e}}),function(){t.close(),e.apply(this,arguments)}},cleverapps.Instant.prototype.getBase64Image=function(i,s){0===(i=i.replace(".jpg",".txt").replace(".png","txt")).indexOf("/")&&(i=i.substr(1)),cc.loader.load(i,function(e,t){i=t&&Array.isArray(t)&&0<t.length?t[0]:void 0,s(e,i)})},cleverapps.Instant.prototype.listFriends=function(i){FBInstant.player.getConnectedPlayersAsync().then(function(e){var t=e.map(function(e){return{id:e.getID(),first_name:e.getName(),picture:{data:{url:e.getPhoto()}}}});i(cleverapps.Social.CODE_SUCCEED,t)}).catch(function(){i(cleverapps.Social.CODE_FAILED)})},cleverapps.Instant.prototype.listInvitableFriends=function(
e){e(cleverapps.Social.CODE_SUCCEED,[])},cleverapps.Instant.prototype.aboutMe=function(e){e({currency:{user_currency:"USD"},name:FBInstant.player.getName(),first_name:FBInstant.player.getName(),picture:{data:{url:FBInstant.player.getPhoto()}}})},cleverapps.Instant.prototype.getAccessToken=function(){return"instant"},cleverapps.Instant.prototype.getPlatform=function(){return FBInstant.getPlatform()},cleverapps.Instant.isAppropriate=function(){return cleverapps.isInstant()},cleverapps.FakeInstant=function(){console.log("Choosing FakeInstant-facebook"),this.__mockState={initialized:!1},cleverapps.Instant.call(this)},cleverapps.FakeInstant.prototype=Object.create(cleverapps.Instant.prototype),cleverapps.FakeInstant.prototype.constructor=cleverapps.FakeInstant,cleverapps.FakeInstant.prototype.init=function(e){cleverapps.config.restApiURL=cleverapps.config.fakeRestApiURL,cleverapps.Instant.LoadSdk=function(e){e()},FBInstant={initializeAsync:function(){return new Promise(function(e,t){
var i=document.createElement("link");i.href="cleverapps/res/css/mock.css",i.rel="stylesheet",i.type="text/css",document.head.appendChild(i),Utils.log("initializeAsync"),e()})},startGameAsync:function(){return new Promise(function(e,t){Utils.log("startGameAsync","Showing game start dialog"),Utils.createAlert({message:"Game has finished loading. <br /> Play now?",cta:"Play!"},function(){cleverapps.social.__mockState.initialized=!0,e()})})},setLoadingProgress:function(i){return new Promise(function(e,t){Utils.log("progress",i,"%"),e()})},getSupportedAPIs:function(){var e=[];for(var t in FBInstant)e.push(t);for(var t in FBInstant.player)e.push("player."+t);for(var t in FBInstant.context)e.push("context."+t);return e}},cleverapps.Instant.LoadSdk(function(){FBInstant.initializeAsync().then(function(){console.log("FBInstant.initializeAsync()"),InstantLoaderScene.whenLoaded(function(){FBInstant.startGameAsync().then(e)})}.bind(this))}.bind(this))},
cleverapps.FakeInstant.prototype.logEvent=function(e,t){return Utils.log("logEvent",e,1,t),null},cleverapps.FakeInstant.prototype.isLoggedIn=function(){return!0},cleverapps.FakeInstant.prototype.getUserID=function(){return Utils.returnUserData(123456789)},cleverapps.FakeInstant.prototype.inviteFriends=function(e,t){Utils.shareAsync({intent:"INVITE",image:DEFAULT_INVITE_PICTURE,text:e.message}).then(function(){t(cleverapps.Social.CODE_SUCCEED)})},cleverapps.FakeInstant.prototype.request=function(e,t){Utils.shareAsync({intent:"REQUEST",image:e.picture,text:e.message}).then(function(){t()})},cleverapps.FakeInstant.prototype.shareDialog=function(e,t){Utils.shareAsync({intent:"SHARE",image:e.picture,text:e.description}).then(function(){t()})},cleverapps.FakeInstant.prototype.listFriends=function(t){new Promise(function(e,t){var i=[];cleverapps.social.__mockState.initialized?i=[{getID:function(){return 42},getName:function(){return"Friend 1"},getPhoto:function(){
return"cleverapps/res/img/mock/friend1-f27202440f.png"}},{getID:function(){return 43},getName:function(){return"Friend 2"},getPhoto:function(){return"cleverapps/res/img/mock/friend2-607bb2c069.png"}},{getID:function(){return 44},getName:function(){return"Friend 3"},getPhoto:function(){return"cleverapps/res/img/mock/friend3-5d09776058.png"}}]:Utils.log("getConnectedPlayersAsync","Connected players data is not available before startGameAsync resolves"),Utils.log("getConnectedPlayersAsync","players: ",i),e(i)}).then(function(e){t(cleverapps.Social.CODE_SUCCEED,e.map(function(e){return{id:e.getID(),name:e.getName(),first_name:e.getName(),picture:{data:{url:e.getPhoto()}}}}))})},cleverapps.FakeInstant.prototype.listInvitableFriends=function(e){return[]},cleverapps.FakeInstant.prototype.aboutMe=function(e){e({currency:{user_currency:"USD"},name:Utils.returnUserData("Player 1"),first_name:Utils.returnUserData("Player 1"),picture:{data:{url:Utils.returnUserData(
"cleverapps/res/img/mock/profile-2f8a5e0f94.jpg")}}})};var Utils={shareAsync:function(i){var s="Share Intent: "+i.intent;return s+="<br />",s+="Share text: "+i.text,s+="<br />",s+="Share payload: "+JSON.stringify(i.data),new Promise(function(e,t){Utils.createAlert({title:"Shared content",message:s,image:i.image,cta:"Close"},e)})},createAlert:function(e,t){var i=document.createElement("div");i.className="mockDialog";var s=document.createElement("h3");if(s.innerHTML="(FBFakeInstant Mock)",s.innerHTML+=" "+(e.title||""),i.appendChild(s),e.message){var n=document.createElement("p");n.innerHTML=e.message,i.appendChild(n)}if(e.image){var o=document.createElement("img");o.src=e.image,i.appendChild(o)}var a=document.createElement("input");a.type="button",a.value=e.cta||"Close",i.appendChild(a),a.onclick=function(){document.body.removeChild(i),t()},document.body.appendChild(i)},log:function(){args=[],args.push("[FBFakeInstant Mock]:");for(var e=0;e<arguments.length;e++)args.push(arguments[e])
;console.log.apply(console,args)},getQueryString:function(){var n={};return location.search&&location.search.substr(1).split("&").forEach(function(e){var t=e.split("="),i=t[0],s=t[1]&&decodeURIComponent(t[1]);(n[i]=n[i]||[]).push(s)}),n},returnAndLog:function(e){return caller=Utils.returnAndLog.caller,caller?Utils.log(caller.name,e):Utils.log(e),e},returnUserData:function(e){return cleverapps.social.__mockState.initialized?Utils.returnAndLog(e):(Utils.log("User Data is not available until startGameAsync has resolved"),null)},getFromLocalStorage:function(n,o){return new Promise(function(e,t){var i=localStorage.getItem(n),s={};i&&(i=JSON.parse(i),o.forEach(function(e){"undefined"!==i[e]&&(s[e]=i[e])})),Utils.log(s),e(s)})},writeToLocalStorage:function(i,s){return new Promise(function(e,t){Utils.log(JSON.stringify(s)),localStorage.setItem(i,JSON.stringify(s)),e()})}};cleverapps.FakeInstant.isAppropriate=function(){
return!cc.sys.isNative&&"instant"===cc.game.config.source&&cleverapps.isLocalhost()},cleverapps.FakeFacebook=function(){cleverapps.BaseFB.call(this)},cleverapps.FakeFacebook.prototype=Object.create(cleverapps.BaseFB.prototype),cleverapps.FakeFacebook.prototype.constructor=cleverapps.FakeFacebook,cleverapps.FakeFacebook.prototype.init=function(e){cleverapps.config.restApiURL=cleverapps.config.fakeRestApiURL,this.DIALOG_CANCELLED=2,this.loggedIn=!1,this.token=void 0,setTimeout(function(){this.isExpired()||(this.token="123",this.loggedIn=!0),e()}.bind(this),1e3)},cleverapps.FakeFacebook.prototype.isExpired=function(){var e=cc.sys.localStorage.getItem(cleverapps.DataLoaderTypes.FAKE_FACEBOOK_LOGGING_TIME);return null===e||parseInt(e)+cleverapps.FakeFacebook.FAKE_SESSION_TIMEOUT<Date.now()},cleverapps.FakeFacebook.prototype.logEvent=function(e,t){},cleverapps.FakeFacebook.prototype.isLoggedIn=function(){return this.loggedIn&&!this.isExpired()},
cleverapps.FakeFacebook.prototype.getUserID=function(){return"1"},cleverapps.FakeFacebook.prototype.getAccessToken=function(){return this.isExpired()?void 0:this.token},cleverapps.FakeFacebook.prototype.login=function(e,t){confirm("Do you want to log in?")?(cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.FAKE_FACEBOOK_LOGGING_TIME,Date.now()),this.token="123",this.loggedIn=!0,cleverapps.SocialManager.onLogin(),(e=e||function(){})()):(cc.sys.localStorage.removeItem(cleverapps.DataLoaderTypes.FAKE_FACEBOOK_LOGGING_TIME),cleverapps.SocialManager.onFailedLogin(),t&&t())},cleverapps.FakeFacebook.prototype.inviteFriends=function(e,t){this.request(e,t)},cleverapps.FakeFacebook.prototype.request=function(e,t){delete e.element,t=t||function(){},confirm("Do you to post "+JSON.stringify(e)+"?")?t(cleverapps.Social.CODE_SUCCEED,{to:["__333"]}):t(cleverapps.Social.DIALOG_CANCELLED,"FakeFB")},cleverapps.FakeFacebook.prototype.shareDialog=function(e,t){confirm("Do you to post "+JSON.stringify(e
)+"?")?t(cleverapps.Social.CODE_SUCCEED,"FakeFB"):t(cleverapps.Social.DIALOG_CANCELLED,"FakeFB")},cleverapps.FakeFacebook.prototype.listFriends=function(e){setTimeout(function(){e(cleverapps.Social.CODE_SUCCEED,[{id:"111",name:"Friend 111",first_name:"Friend1",picture:{data:{url:"https://graph.facebook.com/41803173/picture?height=200&width=200"}}},{id:"222",name:"Friend 222",first_name:"Friend2",picture:{data:{url:"https://graph.facebook.com/692982514/picture?height=200&width=200"}}}])},500)},cleverapps.FakeFacebook.prototype.listInvitableFriends=function(e){setTimeout(function(){e(cleverapps.Social.CODE_SUCCEED,[{id:"__333",name:"Invitable1",first_name:"Invitable1",picture:{data:{url:"https://graph.facebook.com/100028444590540/picture?height=200&width=200"}}},{id:"__444",name:"Invitable2",first_name:"Invitable2",picture:{data:{url:"https://graph.facebook.com/100001008129789/picture?height=200&width=200"}}},{id:"__555",name:"Invitable3",first_name:"Invitable3",picture:{data:{
url:"https://graph.facebook.com/100011706990070/picture?height=200&width=200"}}},{id:"__666",name:"Invitable4",first_name:"Invitable4",picture:{data:{url:"https://graph.facebook.com/100001575006940/picture?height=200&width=200"}}},{id:"__777",name:"Invitable5",first_name:"Invitable5",picture:{data:{url:"https://graph.facebook.com/100000318466656/picture?height=200&width=200"}}}])},500)},cleverapps.FakeFacebook.prototype.api=function(e,t){switch(e){case"/me/?fields=is_eligible_promo":FB={ui:function(e,t){t({status:"completed"})}},t(cleverapps.Social.CODE_SUCCEED,{is_eligible_promo:1})}},cleverapps.FakeFacebook.prototype.aboutMe=function(e){setTimeout(function(){e({currency:{user_currency:"USD"},name:"FakeFB User",first_name:"FakeFB",picture:{data:{url:"https://graph.facebook.com/100001828353521/picture?height=200&width=200"}}})},500)},cleverapps.FakeFacebook.isAppropriate=function(){return!cc.sys.isNative&&cleverapps.isLocalhost()},
cleverapps.FakeFacebook.FAKE_SESSION_TIMEOUT=cleverapps.parseInterval("10 minutes"),cleverapps.MobileFacebook=function(){this.constructor===cleverapps.MobileFacebook&&console.log("Choosing mobile-facebook (sdkbox)"),this.apiJobs=[],this.apiProcessing=!1,cleverapps.BaseFB.call(this)},cleverapps.MobileFacebook.prototype=Object.create(cleverapps.BaseFB.prototype),cleverapps.MobileFacebook.prototype.constructor=cleverapps.MobileFacebook,cleverapps.MobileFacebook.prototype.init=function(e){sdkbox.PluginFacebook.init(),this.listeners={},sdkbox.PluginFacebook.setListener({onLogin:cleverapps.whenShow(this.onLogin.bind(this)),onFetchFriends:cleverapps.whenShow(this.onFetchFriends.bind(this)),onAPI:cleverapps.whenShow(this.onApi.bind(this)),onRequestInvitableFriends:cleverapps.whenShow(this.onRequestInvitableFriends.bind(this)),onInviteFriendsWithInviteIdsResult:cleverapps.whenShow(this.onInviteFriendsWithInviteIdsResult.bind(this)),onInviteFriendsResult:cleverapps.whenShow(
this.onInviteFriendsResult.bind(this)),onSharedSuccess:cleverapps.whenShow(this.onShared.bind(this,cleverapps.Social.CODE_SUCCEED)),onSharedFailed:cleverapps.whenShow(function(e){this.onShared(cleverapps.Social.CODE_FAILED,e)}.bind(this)),onSharedCancel:cleverapps.whenShow(this.onShared.bind(this,cleverapps.Social.CODE_CANCELLED))}),e&&e(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){this.deleteAllRequests()}.bind(this)),this.deleteAllRequests()},cleverapps.MobileFacebook.prototype.onShared=function(e,t){cc.sys.os===cc.sys.OS_IOS&&2===e&&(e=cleverapps.Social.CODE_SUCCEED),e===cleverapps.Social.CODE_FAILED&&cleverapps.Notification.create("messages:ShareError"),this.listeners.onShared&&(this.listeners.onShared(e),delete this.listeners.onShared)},cleverapps.MobileFacebook.prototype.onLogin=function(e){this.listeners.onLogin&&(this.listeners.onLogin(e),delete this.listeners.onLogin)},cleverapps.MobileFacebook.prototype.onApi=function(e,t){this.listeners.onApi&&(
t=decodeWebViewData(t),this.listeners.onApi(cleverapps.Social.CODE_SUCCEED,JSON.parse(t)),delete this.listeners.onApi),this.apiProcessing=!1,this.processApi()},cleverapps.MobileFacebook.prototype.onFetchFriends=function(e,t){if(this.listeners.onFetchFriends){if(e){t=decodeWebViewData(t);var i=JSON.parse(t);cc.sys.os===cc.sys.OS_IOS&&(i=i.data),this.listeners.onFetchFriends(cleverapps.Social.CODE_SUCCEED,i)}else this.listeners.onFetchFriends(cleverapps.Social.CODE_FAILED,t);delete this.listeners.onFetchFriends}},cleverapps.MobileFacebook.prototype.onInviteFriendsWithInviteIdsResult=function(e,t){this.listeners.onInviteFriendsWithInviteIdsResult&&(this.listeners.onInviteFriendsWithInviteIdsResult(e,t),delete this.listeners.onInviteFriendsWithInviteIdsResult)},cleverapps.MobileFacebook.prototype.onRequestInvitableFriends=function(e){if(this.listeners.onRequestInvitableFriends){var t=decodeWebViewData(e.data);this.listeners.onRequestInvitableFriends(t),
delete this.listeners.onRequestInvitableFriends}},cleverapps.MobileFacebook.prototype.onInviteFriendsResult=function(e,t){cleverapps.config.debugMode&&console.log("ON onInviteFriendsResult"),this.listeners.onInviteFriendsResult&&(this.listeners.onInviteFriendsResult(e,t),delete this.listeners.onInviteFriendsResult)},cleverapps.MobileFacebook.prototype.isLoggedIn=function(){return sdkbox.PluginFacebook.isLoggedIn()},cleverapps.MobileFacebook.prototype.getUserID=function(){return sdkbox.PluginFacebook.getUserID()},cleverapps.MobileFacebook.prototype.getAccessToken=function(){return sdkbox.PluginFacebook.getAccessToken()},cleverapps.MobileFacebook.prototype.login=function(t,i){this.listeners.onLogin=function(e){e===cleverapps.Social.CODE_SUCCEED?(cleverapps.SocialManager.onLogin(),cleverapps.history.set("fblog",1),t()):(cleverapps.SocialManager.onFailedLogin(),i&&i())},sdkbox.PluginFacebook.login(cleverapps.BaseFB.PERMISSIONS)},
cleverapps.MobileFacebook.prototype.inviteFriendsShare=function(e,t){cleverapps.Social.prototype.inviteFriendsShare.call(this,e,t)},cleverapps.MobileFacebook.prototype.request=function(e,t){t&&t(cleverapps.Social.CODE_SUCCEED)},cleverapps.MobileFacebook.prototype.getShareDialogData=function(e){return{type:"link",link:this.getShareDialogLink(e),title:e.name,text:e.description,image:cleverapps.config.deployment+e.picture}},cleverapps.MobileFacebook.prototype.shareDialog=function(e,t){this.listeners.onShared=t,sdkbox.PluginFacebook.dialog(this.getShareDialogData(e))},cleverapps.MobileFacebook.prototype.api=function(e,t,i,s){if("function"==typeof(i=i||{})&&(s=i,i={}),!this.isLoggedIn())return console.log("Not logged in!"),void(s&&s(cleverapps.Social.CODE_CANCELLED));void 0===t?(t="GET",s=function(){}):"function"==typeof t&&(s=t,t="GET"),this.addApiJob(e,t,i,s),this.processApi()},cleverapps.MobileFacebook.prototype.addApiJob=function(e,t,i,s){this.apiJobs.push({apiMethod:e,httpMethod:t,
params:i,callback:s})},cleverapps.MobileFacebook.prototype.processApi=function(){if(!this.apiProcessing&&0!==this.apiJobs.length){this.apiProcessing=!0;var e=this.apiJobs.shift();this.listeners.onApi=e.callback,sdkbox.PluginFacebook.api(e.apiMethod,e.httpMethod,e.params,"api")}},cleverapps.MobileFacebook.prototype.getCode=function(){return"facebook"},cleverapps.MobileFacebook.isAppropriate=function(){return cc.sys.isNative},cleverapps.override(cleverapps.MobileFacebook.prototype,NativeInvite),cleverapps.MobileFacebook.APPINVITES_SDKBOX_ERROR="Unrecognized 'com.facebook.platform.protocol.PROTOCOL_ACTION' extra: 'com.facebook.platform.action.request.APPINVITES_DIALOG'.",cleverapps.AndroidWebViewFacebook=function(){console.log("Choosing android-facebook (webview)"),"undefined"==typeof sdkbox&&(sdkbox={}),sdkbox.PluginFacebook=FacebookPlugin,cleverapps.override(sdkbox.PluginFacebook,{setListener:function(){},init:function(){}}),cleverapps.MobileFacebook.call(this)},
cleverapps.AndroidWebViewFacebook.prototype=Object.create(cleverapps.MobileFacebook.prototype),cleverapps.AndroidWebViewFacebook.prototype.constructor=cleverapps.AndroidWebViewFacebook,cleverapps.AndroidWebViewFacebook.prototype.init=function(e){cleverapps.MobileFacebook.prototype.init.apply(this,arguments)},cleverapps.AndroidWebViewFacebook.prototype.shareDialog=function(e,t){this.listeners.onShared=t,sdkbox.PluginFacebook.dialog(JSON.stringify(this.getShareDialogData(e)))},cleverapps.AndroidWebViewFacebook.prototype.request=function(e,t){this.listeners.onRequest=t,sdkbox.PluginFacebook.inviteFriendsWithInviteIds(e.to?JSON.stringify(e.to):null,e.title,e.message)},cleverapps.AndroidWebViewFacebook.prototype.inviteFriendsShare=function(e,t){cleverapps.Social.prototype.inviteFriendsShare.call(this,e,t)},cleverapps.AndroidWebViewFacebook.prototype.onRequest=function(e){this.listeners.onRequest&&(this.listeners.onRequest(e),delete this.listeners.onRequest)},
cleverapps.AndroidWebViewFacebook.prototype.addApiJob=function(e,t,i,s){cleverapps.MobileFacebook.prototype.addApiJob.call(this,e,t,JSON.stringify(i),s)},cleverapps.iOSWebViewFacebook=function(){console.log("Choosing ios-facebook (webview)"),"undefined"==typeof sdkbox&&(sdkbox={}),sdkbox.PluginFacebook={},cleverapps.override(sdkbox.PluginFacebook,{init:function(){webkitMessage("facebook",{action:"init"})},logPurchase:function(e,t){console.log("logPurchase success "+e+" "+t),webkitMessage("facebook",{action:"logPurchase",amount:e,currency:t})},dialog:function(e){webkitMessage("facebook",{action:"dialog",jsonInfo:JSON.parse(e)})},login:function(e){webkitMessage("facebook",{action:"login",permissions:e})},logout:function(){webkitMessage("facebook",{action:"logout"})},setListener:function(){},isLoggedIn:function(){return console.log("isLoggedIn check"),void 0!==this.tokenString&&0<this.tokenString.length}.bind(this),getAccessToken:function(){return this.tokenString}.bind(this),
getPermissionList:function(){return this.permissionList}.bind(this),getUserID:function(){return this.userID}.bind(this),getAppId:function(){return this.appId}.bind(this),getSDKVersion:function(){return this.sdkVersion}.bind(this),api:function(e,t,i,s){webkitMessage("facebook",{action:"api",path:e,method:t,paramsJson:JSON.parse(i),tag:s})},inviteFriendsWithInviteIds:function(e,t,i){webkitMessage("facebook",{action:"inviteFriendsWithInviteIds",inviteIdsJson:JSON.parse(e),title:t,text:i})},enableDebug:function(e){webkitMessage("facebook",{action:"enableDebug",enable:e})}}),cleverapps.MobileFacebook.call(this)},cleverapps.iOSWebViewFacebook.prototype=Object.create(cleverapps.MobileFacebook.prototype),cleverapps.iOSWebViewFacebook.prototype.constructor=cleverapps.iOSWebViewFacebook,cleverapps.iOSWebViewFacebook.prototype.init=function(e){this.onInitListener=e,cleverapps.MobileFacebook.prototype.init.apply(this)},cleverapps.iOSWebViewFacebook.prototype.onInit=function(e){console.log(
"Init callback called: "+JSON.stringify(e)),this.tokenString=e.tokenString,this.permissionList=e.permissionList,this.userID=e.userID,this.sdkVersion=e.sdkVersion,this.onInitListener&&(this.onInitListener(),delete this.onInitListener)},cleverapps.iOSWebViewFacebook.prototype.onLogin=function(e,t){console.log("Login callback called: ",t),this.tokenString=t.tokenString,this.permissionList=t.permissionList,this.userID=t.userID,this.sdkVersion=t.sdkVersion,this.tokenString&&cleverapps.MobileFacebook.prototype.onLogin.call(this,cleverapps.Social.CODE_SUCCEED,"success")},cleverapps.iOSWebViewFacebook.prototype.shareDialog=function(e,t){this.listeners.onShared=t,sdkbox.PluginFacebook.dialog(JSON.stringify(this.getShareDialogData(e)))},cleverapps.iOSWebViewFacebook.prototype.request=function(e,t){this.listeners.onRequest=t,sdkbox.PluginFacebook.inviteFriendsWithInviteIds(e.to?JSON.stringify(e.to):null,e.title,e.message)},cleverapps.iOSWebViewFacebook.prototype.inviteFriendsShare=function(e,t){
cleverapps.Social.prototype.inviteFriendsShare.call(this,e,t)},cleverapps.iOSWebViewFacebook.prototype.onRequest=function(e){this.listeners.onRequest&&(this.listeners.onRequest(e),delete this.listeners.onRequest)},cleverapps.iOSWebViewFacebook.prototype.addApiJob=function(e,t,i,s){cleverapps.MobileFacebook.prototype.addApiJob.call(this,e,t,JSON.stringify(i),s)},cleverapps.SocialManager={create:function(){if(cleverapps.flags.nosocial)return new cleverapps.NoSocial;var e=cleverapps.User.calcSource();if(cc.sys.isNative)return cleverapps.AndroidSocial.isAvailable()?new cleverapps.SelectSocial({facebook:new cleverapps.AndroidWebViewFacebook,androidsocial:new cleverapps.AndroidSocial}):cc.sys.os===cc.sys.OS_IOS&&cleverapps.AppleSocial.isAvailable()?new cleverapps.SelectSocial({facebook:new cleverapps.iOSWebViewFacebook,applesocial:new cleverapps.AppleSocial}):cc.sys.os===cc.sys.OS_ANDROID?new cleverapps.AndroidWebViewFacebook:new cleverapps.iOSWebViewFacebook;var t=cleverapps.isLocalhost(
)&&-1!==["instant","facebook"].indexOf(e)?{instant:cleverapps.FakeInstant,default:cleverapps.FakeFacebook}:{plinga:cleverapps.Plinga,instant:cleverapps.Instant,mobile_ok:cleverapps.MobileOK,web_ok:cleverapps.OK,mobile_mm:cleverapps.MobileMyMailRu,web_mm:cleverapps.MyMailRu,mobile_vk:cleverapps.MobileVk,web_vk:cleverapps.VK,sp_mbga:cleverapps.SPMobage,mbga:cleverapps.Mobage,nk:cleverapps.NK,draugiem:cleverapps.Draugiem,fotostrana:cleverapps.FotoStrana,default:cleverapps.Html5};return new(t[e]||t.default)},onFailedLogin:function(){cleverapps.Notification.create("messages:SocialManager.FailedLogging")},onLogin:function(){if(levels.user.haveTmpId()){var t=levels.user.id,e=cleverapps.social.getUserID();cleverapps.RestClient.post("/users/off/"+t,{newId:e},function(e){console.log("Success marked off: "+t+", response "+JSON.stringify(e)),e&&e.signUp&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SIGN_UP,{method:cleverapps.social.getCode()})},function(){console.log("Failed marking off: "+t)
}),levels.user.setId(e),cleverapps.synchronizer.reset(),cleverapps.info.onChangeUserId()}else levels.user.id!==cleverapps.social.getUserID()&&(console.log("second login!"),cc.sys.isNative?levels.user.setId(cleverapps.social.getUserID()):(cleverapps.DataLoader.cleanAll(),window.location.reload()));cleverapps.DataLoader.processSaveQueue(),cleverapps.social.deleteAllRequests(),cleverapps.synchronizer.syncWhenReady(),cleverapps.whenAllInitialized(this.onLoginRefreshes.bind(this))},onLoginRefreshes:function(){-1===["mobile_vk","web_vk","plinga"].indexOf(cleverapps.User.calcSource())&&cleverapps.Notification.create("messages:SocialManager.Connected"),cleverapps.social.aboutMe(this.onLoadUserInfo.bind(this)),cleverapps.localPushes.initSender(),cleverapps.user.calcIdfa(),cleverapps.friends.reload(),cleverapps.invitalbleFriends.reload()},onLoadUserInfo:function(i){if(cleverapps.friends.updatePlayerInfo(i),i.currency&&i.currency.user_currency){var e=i.currency.user_currency,t={USD:"$",EUR:"",
GBP:""};t[e]&&(Product.CURRENCY=t[e],Product.CURRENCY_CODE=e)}if(i.first_name&&setTimeout(function(){var e=void 0,t=cleverapps.friends.getPlayer();t.avatar&&t.avatar!==FriendsCache.DEFAULT_PLAYER_INFO().avatar&&((e=new cleverapps.UI.Avatar(t)).width&&e.height||(e=void 0)),cleverapps.Notification.create("messages:SocialManager.Welcome",{toReplace:{userName:i.first_name},image:e})},1e3),i.name){var s=i.name.substr(0,50);cleverapps.info.setKeyValue("name",s)}i.picture&&i.picture.data&&i.picture.data.url&&cleverapps.info.setKeyValue("avatar",i.picture.data.url),cleverapps.periodicBonus&&cleverapps.periodicBonus.refreshItems()}},cleverapps.NK=function(){console.log("Choosing html5-nk"),cleverapps.Social.call(this)},cleverapps.NK.prototype=Object.create(cleverapps.Social.prototype),cleverapps.NK.prototype.constructor=cleverapps.NK,cleverapps.NK.prototype.getLocalStoragePreffix=function(){return"_NK"},cleverapps.NK.prototype.init=function(s){cleverapps.once(function(){NKOverrideRest()
;var e=opensocial.newDataRequest();e.add(e.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER),"request_id"),e.send(function(e){if(e.hadError());else{var t=e.get("request_id");if(t.hadError());else{var i=t.getData();this.user=cleverapps.NK.formatUserData(i),console.log(this.user),s()}}}.bind(this))}.bind(this))()},cleverapps.NK.prototype.isLoggedIn=function(){return!0},cleverapps.NK.prototype.getUserID=function(){return this.user.id},cleverapps.NK.prototype.getAccessToken=function(){return"NK"},cleverapps.NK.prototype.login=function(e){e()},cleverapps.NK.prototype.inviteFriends=function(e,t){ControlButtonsLogic.exitFullscreen(function(){nk.requestInviteFriends(e.message,{},function(e){e.hadError()?t(cleverapps.Social.CODE_CANCELLED,e):t(cleverapps.Social.CODE_SUCCEED)})})},cleverapps.NK.prototype.listFriendsByApp=function(e,i){var t=opensocial.newDataRequest();t.add(t.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER),"request_id");var s=opensocial.newIdSpec({
userId:"VIEWER",groupId:"FRIENDS"});t.add(t.newFetchPeopleRequest(s,{max:1e3}),"another_id"),t.send(function(e){if(e.hadError())i(cleverapps.Social.CODE_FAILED);else{var t=e.get("another_id").getData().asArray();i(cleverapps.Social.CODE_SUCCEED,t.map(cleverapps.NK.formatUserData))}})},cleverapps.NK.formatUserData=function(e){return{id:cleverapps.Social.prepareId(e.getId()),name:e.getDisplayName(),first_name:e.getDisplayName(),picture:{data:{url:e.getField(opensocial.Person.Field.THUMBNAIL_URL)}}}},cleverapps.NK.prototype.aboutMe=function(e){e(this.user)},cleverapps.NK.prototype.requestToOne=function(e,t,i){var s={title:t.title,type:"notification"},n=opensocial.newMessage(t.message,s);ControlButtonsLogic.exitFullscreen(function(){opensocial.requestSendMessage([e],n,function(e){e.hadError()?(console.log("error",e),i(cleverapps.Social.CODE_FAILED)):(console.log("ok",e),i(cleverapps.Social.CODE_SUCCEED))})})},cleverapps.NK.prototype.request=function(e,i){var s=e.to;Array.isArray(s)||(s=[s]
);var n=[],o=function(t){t===s.length?i(0<n.length?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED,n):this.requestToOne(s[t],e,function(e){e===cleverapps.Social.CODE_SUCCEED&&n.push(s[t]),setTimeout(function(){o(t+1)},500)})}.bind(this);o(0)},cleverapps.NK.prototype.shareDialog=function(e,t){var i=cleverapps.config.deployment+e.picture;0<=i.indexOf("?")&&(i=i.substr(0,i.indexOf("?")));var s=opensocial.newMediaItem("image",i);s.setField(opensocial.MediaItem.Field.TYPE,opensocial.MediaItem.Type.IMAGE);var n={};n[opensocial.Activity.Field.TITLE]=e.name,n[opensocial.Activity.Field.MEDIA_ITEMS]=[s];var o=opensocial.newActivity(n);ControlButtonsLogic.exitFullscreen(function(){opensocial.requestCreateActivity(o,opensocial.CreateActivityPriority.HIGH,function(e){e.hadError()?(console.log("Share failed",e),t(cleverapps.Social.CODE_FAILED,e)):(console.log("Share ok"),t(cleverapps.Social.CODE_SUCCEED))})})},cleverapps.NK.prototype.joinGroup=function(i){var t=function(t){
var e=opensocial.newDataRequest();e.add(nk.groups.newIsUserInAppGroupRequest(),"isInGroup"),e.send(function(e){e.hadError()?i(cleverapps.Social.CODE_FAILED):e.get("isInGroup").getData()?i(cleverapps.Social.CODE_SUCCEED):t?t():i(cleverapps.Social.CODE_FAILED)})},e=function(){nk.groups.requestAddUserToAppGroup(function(e){e.hadError()&&i(cleverapps.Social.CODE_FAILED),t()})};ControlButtonsLogic.exitFullscreen(function(){t(e)})},cleverapps.NK.prototype.listFriends=function(e){this.listFriendsByApp(!0,e)},cleverapps.NK.prototype.listInvitableFriends=function(e){e(cleverapps.Social.CODE_SUCCEED,[])},cleverapps.NK.isAppropriate=function(){return!cc.sys.isNative&&"nk"===cleverapps.User.calcSource()},cleverapps.NK.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_POLISH]},cleverapps.FotoStrana=function(){console.log("Choosing fotostrana"),cleverapps.Social.call(this)},cleverapps.FotoStrana.prototype=Object.create(cleverapps.Social.prototype),
cleverapps.FotoStrana.prototype.constructor=cleverapps.FotoStrana,cleverapps.FotoStrana.prototype.getLocalStoragePreffix=function(){return"_FS"},cleverapps.FotoStrana.prototype.init=function(e){var t=cleverapps.once(function(){e()}.bind(this)),i=function(e){t(),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR)}.bind(this);cleverapps.loadSdk(cleverapps.getRequestParameters().fsapi,function(){window.FSClient=new fsapi(cleverapps.config.fotostrana.appId,cleverapps.config.fotostrana.privateKey),FSClient.init(function(){console.log("API Error!")}),t()}.bind(this),i,3)},cleverapps.FotoStrana.prototype.isLoggedIn=function(){return!0},cleverapps.FotoStrana.prototype.fromSocialUserId=function(e){return"FS_"+e},cleverapps.FotoStrana.prototype.toSocialUserId=function(e){return e.substr(3)},cleverapps.FotoStrana.prototype.getUserID=function(){return this.fromSocialUserId(
cleverapps.getRequestParameters().viewerId)},cleverapps.FotoStrana.prototype.getAccessToken=function(){return"FS_"+cleverapps.getRequestParameters().authKey},cleverapps.FotoStrana.prototype.login=function(e){e()},cleverapps.FotoStrana.prototype.inviteFriends=function(e,t){ControlButtonsLogic.exitFullscreen(function(){FSClient.event("invite",function(e){t(e.send?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)})})},cleverapps.FotoStrana.prototype.request=function(e,t){"object"!=typeof e.to&&(e.to=[e.to]);var i=[];e.to.forEach(function(e){i.push(this.toSocialUserId(e))}.bind(this)),ControlButtonsLogic.exitFullscreen(function(){FSClient.event("sendMessageAndInvite",function(e){t(e.messSent||e.invSent?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)},{message:e.message,customIds:i.join(",")})})},cleverapps.FotoStrana.prototype.shareDialog=function(e,t){var i=cleverapps.config.deployment+e.picture;0<=i.indexOf("?")&&(i=i.substr(0,i.indexOf("?"))),
ControlButtonsLogic.exitFullscreen(function(){FSClient.event("postUserEventOnWall",function(e){t("success"===e.result?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)},{title:e.title,text:e.description,imgUrl:i})})},cleverapps.FotoStrana.prototype.loadUsersData=function(e,s){e&&e.length?FSClient.api("User.getProfiles",{userIds:e.join(","),fields:"user_name, user_lastname, photo_small"},function(e){var t=[];if(e.response){for(var i in e.response)t.push(this.formatUserData(e.response[i]));s(cleverapps.Social.CODE_SUCCEED,t)}else s(cleverapps.Social.CODE_FAILED,t)}.bind(this)):s(cleverapps.Social.CODE_CANCELLED,[])},cleverapps.FotoStrana.prototype.listFriends=function(t){FSClient.api("User.getAppFriends",{appId:cleverapps.config.fotostrana.appId,limit:500},function(e){this.loadUsersData(e.response,t)}.bind(this))},cleverapps.FotoStrana.prototype.listInvitableFriends=function(i){FSClient.api("User.getFriends",{limit:200},function(e){if(e.response&&e.response.length){
var t=e.response;FSClient.api("User.getAppFriends",{appId:cleverapps.config.fotostrana.appId,limit:500},function(e){e.response&&e.response.length&&(t=cleverapps.substract(t,e.response)),this.loadUsersData(t,i)}.bind(this))}}.bind(this))},cleverapps.FotoStrana.prototype.formatUserData=function(e){return{id:this.fromSocialUserId(e.user_id),name:e.user_name+" "+e.user_lastname,first_name:e.user_name,picture:{data:{url:e.photo_small}}}},cleverapps.FotoStrana.prototype.aboutMe=function(i){this.loadUsersData([this.toSocialUserId(this.getUserID())],function(e,t){e===cleverapps.Social.CODE_SUCCEED&&t.length&&i(t[0])})},cleverapps.FotoStrana.prototype.logEvent=function(e,t){},cleverapps.FotoStrana.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_RUSSIAN]},cleverapps.FotoStrana.isAppropriate=function(){return!cc.sys.isNative&&"fotostrana"===cleverapps.User.calcSource()},cleverapps.Plinga=function(){console.log("Choosing Plinga"),cleverapps.Social.call(this),
this.eventListener=function(){},(cleverapps.isLocalhost()||cleverapps.isStagingHost())&&cleverapps.extend(this,cleverapps.FakePlinga)},cleverapps.Plinga.prototype=Object.create(cleverapps.Social.prototype),cleverapps.Plinga.prototype.constructor=cleverapps.Plinga,cleverapps.Plinga.prototype.init=function(e){window.GD_OPTIONS={gameId:cleverapps.config.plinga.appId,onEvent:function(e){switch(console.log("plinga event",JSON.stringify(e)),e.name){case"SDK_GAME_START":cc.director.resume();break;case"SDK_GAME_PAUSE":cc.director.pause()}this.eventListener(e)}.bind(this)};cleverapps.loadSdk("//html5.api.gamedistribution.com/main.min.js",e,function(){cleverapps.eventLogger.logEvent("plinga_init_error"),e()})},cleverapps.Plinga.isAppropriate=function(){return!cc.sys.isNative&&"plinga"===cleverapps.User.calcSource()},cleverapps.Plinga.prototype.getLocalStoragePreffix=function(){return"_plinga"},cleverapps.FakePlinga={init:function(e){e()}},cleverapps.NoSocial=function(){console.log(
"Choosing without Social"),cleverapps.Social.call(this)},cleverapps.NoSocial.prototype=Object.create(cleverapps.Social.prototype),cleverapps.NoSocial.prototype.constructor=cleverapps.NoSocial,cleverapps.NoSocial.prototype.init=function(e){e()},cleverapps.NoSocial.isAppropriate=function(){return cleverapps.flags.nosocial},cleverapps.NoSocial.prototype.getLocalStoragePreffix=function(){return"_nosocial"};var NKOverrideRest=function(){var d=cleverapps.RestClient.send;cleverapps.RestClient.send=function(e,t,i,s,n,o){if(-1!==t.indexOf("newsync"))return a=cleverapps.RestClient.getBase()+cleverapps.config.restApiURL+t,r=i,l=s,c=n,(p={})[gadgets.io.RequestParameters.METHOD]=gadgets.io.MethodType.POST,p[gadgets.io.RequestParameters.AUTHORIZATION]=gadgets.io.AuthorizationType.SIGNED,p[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.JSON,p[gadgets.io.RequestParameters.POST_DATA]=JSON.stringify(r),p[gadgets.io.RequestParameters.HEADERS]={"Content-Type":"application/json"},
void gadgets.io.makeRequest(a,function(e){if(e.text){var t=gadgets.json.parse(e.text);void 0!==t.error?c(t.error):l(t)}else c(e)},p);var a,r,l,c,p;d(e,t,i,s,n,o)}};if(cleverapps.Draugiem=function(){console.log("Choosing html5-draugiem"),cleverapps.Social.call(this)},cleverapps.Draugiem.prototype=Object.create(cleverapps.Social.prototype),cleverapps.Draugiem.prototype.constructor=cleverapps.Draugiem,cleverapps.Draugiem.prototype.getLocalStoragePreffix=function(){return"_draugiem"},cleverapps.Draugiem.prototype.api=function(e,t,i){t.action=e,this.accessToken&&(t.apikey=this.accessToken),cleverapps.RestClient.post("/draugiem",t,function(e){e.error?(console.log("Error response: ",e),i(cleverapps.Social.CODE_FAILED,e)):(console.log("Success api response: ",e),i(cleverapps.Social.CODE_SUCCEED,e))})},cleverapps.Draugiem.prototype.init=function(n){cleverapps.loadSdk("//draugiem.lv/applications/external/draugiem.js",function(){
draugiem_callback_url=cleverapps.config.deployment+"/cleverapps/res/callback-e75ca99e40-e75ca99e40.html",draugiem_domain="www.draugiem.lv";var s=cleverapps.getRequestParameters().dr_auth_code,e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.DRAUGIEM_AUTH_DATA);e&&e.code===s?(this.accessToken=e.token,this.api("userdata",{},function(e,t){this.user=cleverapps.Draugiem.formatUserData(cleverapps.values(t.users)[0]),n()}.bind(this))):this.api("authorize",{code:s},function(e,t){if(t&&!t.error&&t.apikey)this.accessToken=t.apikey,this.user=cleverapps.Draugiem.formatUserData(t.users[t.uid]),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.DRAUGIEM_AUTH_DATA,{code:s,token:this.accessToken});else{var i=JSON.stringify({arguments:arguments,auth_code:s});cleverapps.ReportStream.debug("draugiem authorize empty result "+i),this.user={}}n()}.bind(this))}.bind(this),function(){console.log("Failed to load draugiem.js api")},3)},cleverapps.Draugiem.prototype.isLoggedIn=function(){return!0},
cleverapps.Draugiem.prototype.getUserID=function(){return this.user.id},cleverapps.Draugiem.prototype.getAccessToken=function(){return"DRG_"+this.accessToken},cleverapps.Draugiem.prototype.login=function(e){e()},cleverapps.Draugiem.prototype.sendActivity=function(e,t){if(!(this.lastActivitySent&&Date.now()-this.lastActivitySent<cleverapps.parseInterval("1 day"))){var i=cleverapps.Social.ACTIVITIES_CONFIG[e];if(i.probability>Math.random()){var s=cleverapps.Random.mathChoose(i.messages),n={prefix:Messages.get(s.title),text:Messages.get(s.body,t),link:cleverapps.config.deployment};cleverapps.social.api("add_activity",n,function(e,t){t&&"OK"===t.status&&(this.lastActivitySent=Date.now())}.bind(this))}}},cleverapps.Draugiem.prototype.inviteFriends=function(e,t){draugiemSendInvite(e.message,"",function(e){t(e?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)})},cleverapps.Draugiem.prototype.requestToOne=function(i,s,n){ControlButtonsLogic.exitFullscreen(function(){
var e=cleverapps.config.draugiem.url,t=s.message+"\n"+e;draugiemSendMessage(i,s.title,t,function(e){n(e?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_FAILED)})})},cleverapps.Draugiem.prototype.request=function(e,i){var s=e.to;Array.isArray(s)||(s=[s]);var n=[],o=function(t){t===s.length?i(0<n.length?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED,n):this.requestToOne(s[t],e,function(e){e===cleverapps.Social.CODE_SUCCEED&&n.push(s[t]),setTimeout(function(){o(t+1)},500)})}.bind(this);o(0)},cleverapps.Draugiem.prototype.shareDialog=function(t,i){ControlButtonsLogic.exitFullscreen(function(){var e=cleverapps.config.draugiem.url;draugiemSay(t.name,e,Messages.get("PlayNow"),t.description,function(e){i(e?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_FAILED)})})},cleverapps.Draugiem.prototype.listFriendsByApp=function(e,t){},cleverapps.Draugiem.prototype.listFriends=function(s){this.api("app_friends",{},function(e,t){if(e===cleverapps.Social.CODE_SUCCEED){
var i=[];0<t.total&&(i=cleverapps.values(t.users).map(cleverapps.Draugiem.formatUserData)),s(cleverapps.Social.CODE_SUCCEED,i)}else s(cleverapps.Social.CODE_FAILED)}.bind(this))},cleverapps.Draugiem.prototype.listInvitableFriends=function(e){e()},cleverapps.Draugiem.formatUserData=function(e){return{id:""+e.uid,name:e.surname+" "+e.name,first_name:e.name,picture:{data:{url:e.img}}}},cleverapps.Draugiem.prototype.aboutMe=function(e){e(this.user)},cleverapps.Draugiem.prototype.logEvent=function(e,t){},cleverapps.Draugiem.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_LATVIAN,cc.sys.LANGUAGE_RUSSIAN]},cleverapps.Draugiem.isAppropriate=function(){return!cc.sys.isNative&&"draugiem"===cleverapps.User.calcSource()},cc.sys.LANGUAGE_LATVIAN="lv",cleverapps.Payments=function(){this.oncePaymentFinished=void 0},cleverapps.Payments.prototype.onPaymentFinished=function(){if(this.oncePaymentFinished){var e=this.oncePaymentFinished;delete this.oncePaymentFinished,e()}},
cleverapps.Payments.prototype.isProductsExists=function(e){return e.length===e.filter(function(e){return this.isProductExists(e)}.bind(this)).length},cleverapps.Payments.prototype.isProductExists=function(e){return cleverapps.config.products[e]},cleverapps.CompensatePayments=function(){cleverapps.Payments.call(this),this.compensateProductCode=void 0},cleverapps.CompensatePayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.CompensatePayments.prototype.constructor=cleverapps.CompensatePayments,cleverapps.CompensatePayments.prototype.getMobile=function(){return 0},cleverapps.CompensatePayments.prototype.getBasePath=function(){return""},cleverapps.CompensatePayments.prototype.canCompensate=function(){return!1},cleverapps.CompensatePayments.prototype.stopCheckPayments=function(){this.checkPaymentTimeout&&(clearTimeout(this.checkPaymentTimeout),this.checkPaymentTimeout=void 0)},cleverapps.CompensatePayments.prototype.runCheckPayments=function(){var e=[].concat(
cleverapps.CompensatePayments.CHECK_TIMEOUTS),t=function(){this.stopCheckPayments(),e.length<cleverapps.CompensatePayments.CHECK_TIMEOUTS.length&&this.checkPayment(),0<e.length&&(this.checkPaymentTimeout=setTimeout(t,cleverapps.parseInterval(e.shift())))}.bind(this);t()},cleverapps.CompensatePayments.prototype.callPaymentCallback=function(e){this.stopCheckPayments(),this.paymentCallback&&(this.paymentCallback(cleverapps.Social.CODE_SUCCEED,e),this.paymentCallback=void 0)},cleverapps.CompensatePayments.prototype.checkPayment=function(){var e="/"+this.getBasePath()+"/check/"+this.getMobile()+"/"+levels.user.id;"subscription"===this.productType&&(e="/"+this.getBasePath()+"/checksubscription/"+levels.user.id);var t=function(e){"ok"===e&&this.callPaymentCallback()}.bind(this);cleverapps.RestClient.get(e,{},t)},cleverapps.CompensatePayments.prototype.compensate=function(){if(!this.checkPaymentTimeout){var e="/"+this.getBasePath()+"/compensate/"+levels.user.id;cleverapps.RestClient.get(e,{},
function(e){"none"!==e&&(this.compensateProductCode=e)}.bind(this))}},cleverapps.CompensatePayments.prototype.validateByPath=function(t,e){if(!cleverapps.config.debugMode||!cleverapps.Tool.compensateCheck){t=cleverapps.once(t||function(){});var i=[].concat(cleverapps.CompensatePayments.VALIDATE_TIMEOUTS),s=void 0,n=function(){cleverapps.RestClient.get(e,{},function(e){"ok"===e&&(t(),clearTimeout(s))}),0<i.length&&(s=setTimeout(n,cleverapps.parseInterval(i.shift())))};n()}},cleverapps.CompensatePayments.prototype.open=function(e,t){},cleverapps.CompensatePayments.prototype.isAvailable=function(){return!0},cleverapps.CompensatePayments.prototype.logPurchase=function(e){},cleverapps.CompensatePayments.prototype.compensateValidate=function(e){this.getBasePath()?this.validateByPath(e,"/"+this.getBasePath()+"/compensatevalidate/"+levels.user.id):e()},cleverapps.CompensatePayments.prototype.validate=function(e,t){this.getBasePath()?this.validateByPath(t,"/"+this.getBasePath(
)+"/validate/"+this.getMobile()+"/"+levels.user.id):t()},cleverapps.CompensatePayments.prototype.setPaymentChecked=function(){this.getBasePath()&&this.validateByPath(function(){},"/"+this.getBasePath()+"/check/"+this.getMobile()+"/"+levels.user.id)},cleverapps.CompensatePayments.CHECK_TIMEOUTS=["1 second","1 second","3 seconds","5 seconds","5 seconds","5 seconds","10 seconds","10 seconds","20 seconds","20 seconds","20 seconds","20 seconds","1 minute","1 minute","3 minutes","5 minutes","5 minutes"],cleverapps.CompensatePayments.VALIDATE_TIMEOUTS=["5 seconds","10 seconds","15 seconds","30 seconds","30 seconds","30 seconds","1 minute","1 minute","1 minute","5 minutes","5 minutes","5 minutes"],cleverapps.FakePayments=function(){cleverapps.Payments.call(this)},cleverapps.FakePayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.FakePayments.prototype.constructor=cleverapps.FakePayments,cleverapps.FakePayments.prototype.open=function(e,t){setTimeout(function(){confirm(
Messages.get("FakePayments.Buying")+" "+e.title+" for "+e.price)?setTimeout(function(){t(cleverapps.Social.CODE_SUCCEED)},cleverapps.FakePayments.PROCESS_TIMEOUT):setTimeout(function(){console.log(Messages.get("FakePayments.Cancelled")),t(cleverapps.Social.CODE_CANCELLED)},cleverapps.FakePayments.PROCESS_TIMEOUT)},1e3)},cleverapps.FakePayments.prototype.isAvailable=function(){return!0},cleverapps.FakePayments.isAppropriate=function(){return!!cleverapps.isLocalhost()},cleverapps.FakePayments.prototype.validate=function(e,t){t&&t()},cleverapps.FakePayments.prototype.logPurchase=function(e){},cleverapps.FakePayments.prototype.restore=function(e){setTimeout(function(){e&&e(!0)},1e3)},cleverapps.FakePayments.PROCESS_TIMEOUT=0,cleverapps.InstantPayments=function(){this.ready=!1,cleverapps.social.whenInitialized("instantpayments",function(){var e=FBInstant.getSupportedAPIs();console.log("Searching payments.purchaseAsync",e),-1!==e.indexOf("payments.purchaseAsync")&&(console.log(
"Found payments.purchaseAsync support!"),FBInstant.payments.onReady(function(){console.log("Payments ready!"),this.ready=!0,cleverapps.flags.update(),cleverapps.values(this.onAvailableListeners).forEach(cleverapps.callFunc)}.bind(this)))}.bind(this)),this.onAvailableListeners={}},cleverapps.InstantPayments.prototype.open=function(e,t){this.isAvailable()?FBInstant.payments.purchaseAsync({productID:e.id.instant}).then(function(e){console.log(e),t(cleverapps.Social.CODE_SUCCEED)}):t(cleverapps.Social.CODE_FAILED,e,"messages:InstantPayments.NotAvailable")},cleverapps.InstantPayments.prototype.isAvailable=function(){return-1!==["1832499670188919","1887333567973110","1920167364724450","2076714912381045","2585442014807608"].indexOf(cleverapps.user.id)||cc.sys.os!==cc.sys.OS_IOS&&this.ready},cleverapps.InstantPayments.isAppropriate=function(){return cleverapps.isInstant()},cleverapps.InstantPayments.prototype.validate=function(e,t){t&&t()},
cleverapps.InstantPayments.prototype.logPurchase=function(e){},cleverapps.MobagePayments=function(){for(var e in cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=cleverapps.MobagePayments.calcLoadedPrice(t.price)}},cleverapps.MobagePayments.prototype.calcLoadedPrice=function(e){return cleverapps.MobagePayments.calcLoadedPrice(e)},cleverapps.MobagePayments.calcLoadedPrice=function(e){var t=100;return-1!==cleverapps.MobagePayments.TESTER_IDS.indexOf(cleverapps.user.id)&&(t=1),cleverapps.formatAmount(Math.ceil(e*t))+" MC"},cleverapps.MobagePayments.prototype.getSKU=function(e){var t=0;for(var i in cleverapps.PaymentsManager.PRODUCTS)if(t++,i===e.itemId)return t},cleverapps.MobagePayments.prototype.open=function(e,i){var t={};t[opensocial.BillingItem.Field.SKU_ID]=this.getSKU(e),t[opensocial.BillingItem.Field.PRICE]=parseInt(e.loadedPrice.replace(" ","")),t[opensocial.BillingItem.Field.COUNT]=1,t[mbga.BillingItem.Field.NAME]=e.description,
t[mbga.BillingItem.Field.IMAGE_URL]=cleverapps.config.deployment.replace("https","http")+e.image;var s=opensocial.newBillingItem(t),n={};n[opensocial.Payment.Field.ITEMS]=[s],n[opensocial.Payment.Field.AMOUNT]=t[opensocial.BillingItem.Field.PRICE]*t[opensocial.BillingItem.Field.COUNT];var o=opensocial.newPayment(n);ControlButtonsLogic.exitFullscreen(function(){opensocial.requestPayment(o,function(e){if(e.hadError())i(cleverapps.Social.CODE_FAILED,e);else{var t=e.getData();i(cleverapps.Social.CODE_SUCCEED,t)}})})},cleverapps.MobagePayments.prototype.isAvailable=function(){return!0},cleverapps.MobagePayments.isAppropriate=function(){return cleverapps.Mobage.isAppropriate()},cleverapps.MobagePayments.prototype.validate=function(e,t){t&&t()},cleverapps.MobagePayments.prototype.logPurchase=function(e){},cleverapps.MobagePayments.TESTER_IDS=["mbga.jp:155776208"],cleverapps.VKPayments=function(){for(var e in cleverapps.config.products){var t=cleverapps.config.products[e]
;t.loadedPrice=this.calcLoadedPrice(t.price)}this.paymentHandler=function(e){},cleverapps.social.whenInitialized("vkpayments",this.init.bind(this))},cleverapps.VKPayments.prototype.calcLoadedPrice=function(e){return Math.round(21*e)+" "},cleverapps.VKPayments.prototype.init=function(){VK.addCallback("onOrderSuccess",function(e){this.paymentHandler(cleverapps.Social.CODE_SUCCEED,e)}.bind(this)),VK.addCallback("onOrderCancel",function(){this.paymentHandler(cleverapps.Social.CODE_CANCELLED)}.bind(this)),VK.addCallback("onOrderFail",function(e){this.paymentHandler(cleverapps.Social.CODE_FAILED,e)}.bind(this))},cleverapps.VKPayments.prototype.open=function(e,i){this.paymentHandler=function(e,t){e===cleverapps.Social.CODE_FAILED?(console.log(t),i(cleverapps.Social.CODE_FAILED,t)):e===cleverapps.Social.CODE_SUCCEED&&i(cleverapps.Social.CODE_SUCCEED,t)};var t={type:"item",item:e.itemId};ControlButtonsLogic.exitFullscreen(function(){VK.callMethod("showOrderBox",t)})},
cleverapps.VKPayments.prototype.isAvailable=function(){return!0},cleverapps.VKPayments.isAppropriate=function(){return cleverapps.VK.isAppropriate()},cleverapps.VKPayments.prototype.validate=function(e,t){cleverapps.RestClient.post("/vkpayments/check/",{orderId:e},function(e){"ok"===e&&t&&t()})},cleverapps.VKPayments.prototype.logPurchase=function(e){},cleverapps.MobileVkPayments=function(){for(var e in cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}},cleverapps.MobileVkPayments.prototype.calcLoadedPrice=function(e){return Math.round(21*e)+" "},cleverapps.MobileVkPayments.prototype.open=function(e,t){this.isAvailable()?cleverapps.social.showOrderBox({type:"item",item:e.itemId},function(e){e===cleverapps.Social.CODE_SUCCEED&&t(cleverapps.Social.CODE_SUCCEED)}):t(cleverapps.Social.CODE_FAILED,e,"messages:InstantPayments.NotAvailable")},cleverapps.MobileVkPayments.prototype.isAvailable=function(){
return"html5_ios"!==cleverapps.MobileVk.getPlatfrom()},cleverapps.MobileVkPayments.isAppropriate=function(){return cleverapps.MobileVk.isAppropriate()},cleverapps.MobileVkPayments.prototype.validate=function(e,t){cleverapps.RestClient.post("/vkpayments/mobile/",{userId:cleverapps.user.id},function(e){"ok"===e&&t&&t()})},cleverapps.MobileVkPayments.prototype.logPurchase=function(e){},cleverapps.MyMailRuPayments=function(){for(var e in cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}cleverapps.social.whenInitialized("mymailrupayments",this.init.bind(this))},cleverapps.MyMailRuPayments.prototype.init=function(){this instanceof cleverapps.MobileMyMailRuPayments||(this.listeners={status:function(){},income:function(){}},mailru.events.listen(mailru.app.events.paymentDialogStatus,function(e){this.listeners.status(e)}.bind(this)),mailru.events.listen(mailru.app.events.incomingPayment,function(e){this.listeners.income(e)}.bind(this)))}
,cleverapps.MyMailRuPayments.prototype.calcLoadedPrice=function(e){return Math.floor(20*e)+" "},cleverapps.MyMailRuPayments.prototype.checkPayment=function(t){cleverapps.RestClient.get("/mmrupayments/check/"+levels.user.id,{},function(e){"ok"===e&&t()})},cleverapps.MyMailRuPayments.prototype.processPayment=function(){cleverapps.RestClient.get("/mmrupayments/close/"+levels.user.id,{},function(){})},cleverapps.MyMailRuPayments.prototype.open=function(e,t){this.listeners.status=function(e){console.log("PAYMENT DIALOG",e)},this.listeners.income=function(e){console.log("INCOM",e),"success"===e.status?(t(cleverapps.Social.CODE_SUCCEED),this.processPayment()):t(cleverapps.Social.CODE_CANCELLED)}.bind(this),ControlButtonsLogic.exitFullscreen(function(){mailru.app.payments.showDialog({service_id:e.id.mymailru,service_name:e.title,mailiki_price:parseInt(e.loadedPrice)})})},cleverapps.MyMailRuPayments.prototype.isAvailable=function(){return!0},
cleverapps.MyMailRuPayments.isAppropriate=function(){return cleverapps.MyMailRu.isAppropriate()},cleverapps.MyMailRuPayments.prototype.validate=function(e,t){t&&t()},cleverapps.MyMailRuPayments.prototype.logPurchase=function(e){},cleverapps.MobileMyMailRuPayments=function(){cleverapps.MyMailRuPayments.call(this)},cleverapps.MobileMyMailRuPayments.prototype=Object.create(cleverapps.MyMailRuPayments.prototype),cleverapps.MobileMyMailRuPayments.prototype.constructor=cleverapps.MobileMyMailRuPayments,cleverapps.MobileMyMailRuPayments.prototype.runChecker=function(e){var t,i=0,s=function(){"16111471373067017624"===cleverapps.user.id&&cleverapps.ReportStream.send("mmdebug","close popup "+JSON.stringify((new Error).stack)),cleverapps.MobileMyMailRu.widgetWindow&&(cleverapps.MobileMyMailRu.widgetWindow.close(),cleverapps.MobileMyMailRu.widgetWindow=void 0),clearInterval(t)};t=setInterval(function(){3600<++i&&("16111471373067017624"===cleverapps.user.id&&cleverapps.ReportStream.send("mmdebug",
"close popup uid"),s());try{cleverapps.MobileMyMailRu.widgetWindow.location&&cleverapps.MobileMyMailRu.widgetWindow.location.href&&0<=cleverapps.MobileMyMailRu.widgetWindow.location.href.indexOf("vid=")&&("16111471373067017624"===cleverapps.user.id&&cleverapps.ReportStream.send("mmdebug","close by href "+cleverapps.MobileMyMailRu.widgetWindow.location.href),s(),i=0)}catch(e){}i%3==0&&this.checkPayment(function(){this.processPayment(),e(cleverapps.Social.CODE_SUCCEED),e=function(){},s()}.bind(this))}.bind(this),500)},cleverapps.MobileMyMailRuPayments.prototype.open=function(e,t){this.processPayment();var i=cleverapps.social.getRequestParameters(),s={appid:cleverapps.config.myMailRu.appId,session_key:i.session_key,service_id:e.id.mymailru,service_name:e.title,mailiki_price:parseInt(e.loadedPrice),mob:1},n=[];for(var o in s)if(s.hasOwnProperty(o))if("service_name"===o){var a=o+"="+s[o].split("").map(function(e){return e.match(/[-]/i)?e:encodeURIComponent(e)}).join("");n.push(a)
}else n.push(o+"="+encodeURIComponent(s[o]));n="http://m.my.mail.ru/cgi-bin/app/paymentm?"+n.join("&"),cleverapps.MobileMyMailRu.widgetWindow=window.open(n),this.runChecker(t),"16111471373067017624"===cleverapps.user.id&&(cleverapps.ReportStream.send("mmdebug","open mobile payment "+n),cleverapps.ReportStream.send("mmdebug","is window null - "+!cleverapps.MobileMyMailRu.widgetWindow))},cleverapps.MobileMyMailRuPayments.isAppropriate=function(){return"16111471373067017624"===cleverapps.user.id&&cleverapps.ReportStream.send("mmdebug","source"+cleverapps.User.calcSource()),cleverapps.MobileMyMailRu.isAppropriate()},cleverapps.OKPayments=function(){for(var e in cleverapps.CompensatePayments.call(this),cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}},cleverapps.OKPayments.prototype=Object.create(cleverapps.CompensatePayments.prototype),cleverapps.OKPayments.prototype.constructor=cleverapps.OKPayments,
cleverapps.OKPayments.prototype.calcLoadedPrice=function(e){var t=-1!==["580731438762","577203420866","585959187481","576593702177","8593874","573573968467","578403383621"].indexOf(cleverapps.user.id),i=Math.floor(20*e)+" OK";return cleverapps.config.debugMode&&t&&(i=Math.max(1,Math.round(e/3))+" OK"),i},cleverapps.OKPayments.prototype.open=function(e,t){FAPI!==cleverapps.FakeFAPI?"subscription"!==e.type?(this.paymentCallback=t,this.productType=e.type,this.runCheckPayments(),cleverapps.social.listeners.showPayment=function(e){e===cleverapps.OK.CODE_SUCCEED&&(this.checkPayment(),this.callPaymentCallback())}.bind(this),ControlButtonsLogic.exitFullscreen(function(){FAPI.UI.showPayment(e.description,e.title,e.itemId,parseInt(e.loadedPrice),null,JSON.stringify({type:this.getMobile()?"mobile":"social"}),"ok","true")}.bind(this))):this.openSubscription(e,t):t(cleverapps.Social.CODE_CANCELLED)},cleverapps.OKPayments.prototype.getBasePath=function(){return"okpayments"},
cleverapps.OKPayments.prototype.canCompensate=function(){return!0},cleverapps.OKPayments.prototype.openSubscription=function(e,t){this.paymentCallback=t,this.productType=e.type,this.runCheckPayments(),ControlButtonsLogic.exitFullscreen(function(){FAPI.invokeUIMethod("showPaymentSubscription",e.id.ok,parseInt(e.loadedPrice))})},cleverapps.OKPayments.prototype.isAvailable=function(){return!0},cleverapps.OKPayments.isAppropriate=function(){return cleverapps.OK.isAppropriate()},cleverapps.OKPayments.prototype.logPurchase=function(e){},cleverapps.MobileOKPayments=function(){cleverapps.OKPayments.call(this)},cleverapps.MobileOKPayments.prototype=Object.create(cleverapps.OKPayments.prototype),cleverapps.MobileOKPayments.prototype.constructor=cleverapps.MobileOKPayments,cleverapps.MobileOKPayments.prototype.getMobile=function(){return 1},cleverapps.MobileOKPayments.isAppropriate=function(){return cleverapps.MobileOK.isAppropriate()},cleverapps.NoPayments=function(){
cleverapps.CompensatePayments.call(this)},cleverapps.NoPayments.prototype=Object.create(cleverapps.CompensatePayments.prototype),cleverapps.NoPayments.prototype.constructor=cleverapps.NoPayments,cleverapps.NoPayments.isAppropriate=function(){return-1!==["huzcom","plinga","pliega"].indexOf(cleverapps.User.calcSource())},cleverapps.NoPayments.prototype.isAvailable=function(){return!1},cleverapps.SPMobagePayments=function(){for(var e in cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=cleverapps.MobagePayments.calcLoadedPrice(t.price)}},cleverapps.SPMobagePayments.calcLoadedPrice=function(e){return cleverapps.MobagePayments.calcLoadedPrice(e)},cleverapps.SPMobagePayments.prototype.getSKU=function(e){var t=0;for(var i in cleverapps.PaymentsManager.PRODUCTS)if(t++,i===e.itemId)return t},cleverapps.SPMobagePayments.prototype.open=function(e,s){cleverapps.metha.display({focus:"SPMobagePaymentsOpen",action:function(e){var t=new WaitWindow,i=t.createListener(
t.close.bind(t,[!0]));setTimeout(i,4e3);var s=mobage.event.subscribe("modal.afterOpen",function(){i(),mobage.event.unsubscribe(s)});cleverapps.metha.onceNoWindowsListener=e}});var t=function(i){mobage.ui.open("payment",{transactionId:i.transactionId,orderId:i.orderId},function(e,t){e?(this.reportPaymentResult(i,e),mobage.bank.clearPaymentBacklog(i.transactionId),s(cleverapps.Social.CODE_FAILED,t)):(this.reportPaymentResult(i),s(cleverapps.Social.CODE_SUCCEED,t))}.bind(this))}.bind(this);this.createTransaction(e,t)},cleverapps.SPMobagePayments.prototype.createTransaction=function(s,n){var e=function(){var e={userId:levels.user.id.substring(levels.user.id.indexOf(":")+1),id:this.getSKU(s),name:s.title,price:parseInt(s.loadedPrice.replace("MC","").replace(" ","")),description:"ja"===cleverapps.settings.language?s.description:s.description.substring(0,s.description.lastIndexOf("!")),imageUrl:cleverapps.config.deployment.replace("https","http")+s.image,
accessToken:cleverapps.social.clientData.token.accessToken},t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i+"="+e[i]);cleverapps.RestClient.get("/spmbgapayments?"+t.join("&"),{},function(e){n(e)}.bind(this))}.bind(this);cleverapps.social.checkAccessToken(e)},cleverapps.SPMobagePayments.prototype.reportPaymentResult=function(e,t){var i={orderId:e.orderId,transactionId:e.transactionId};t&&(i.error=!0);var s=[];for(var n in i)i.hasOwnProperty(n)&&s.push(n+"="+i[n]);cleverapps.RestClient.post("/spmbgapayments/old?"+s.join("&"),{},function(e){e&&e.transactionId&&mobage.bank.clearPaymentBacklog(e.transactionId)}.bind(this))},cleverapps.SPMobagePayments.prototype.isAvailable=function(){return!0},cleverapps.SPMobagePayments.isAppropriate=function(){return cleverapps.SPMobage.isAppropriate()},cleverapps.SPMobagePayments.prototype.validate=function(e,t){t&&t()},cleverapps.SPMobagePayments.prototype.logPurchase=function(e){},cleverapps.FacebookPayments=function(){
cleverapps.CompensatePayments.call(this),cleverapps.CompensatePayments.CHECK_TIMEOUTS=["5 second","5 second","5 seconds","5 seconds","10 seconds","10 seconds"],cleverapps.CompensatePayments.VALIDATE_TIMEOUTS=["1 second","1 second","1 second","1 second","1 second","3 seconds","5 seconds","5 seconds","5 seconds","10 seconds","15 seconds","30 seconds","30 seconds","30 seconds"]},cleverapps.FacebookPayments.prototype=Object.create(cleverapps.CompensatePayments.prototype),cleverapps.FacebookPayments.prototype.constructor=cleverapps.FacebookPayments,cleverapps.FacebookPayments.UserCanceled=1383010,cleverapps.FacebookPayments.SuccessStatuses=["completed","active"],cleverapps.FacebookPayments.prototype.getBasePath=function(){return"fbpayments"},cleverapps.FacebookPayments.prototype.canCompensate=function(){return!0},cleverapps.FacebookPayments.prototype.open=function(i,s){var n=cleverapps.once(s),o=cleverapps.once(s);s=function(e,t){cleverapps.Social.CODE_SUCCEED===e?n(e,t):o(e,t)},
this.paymentCallback=s,this.productType=i.type;var e={product:i.id.facebook,type:i.type};"subscription"===i.type?e.action="create_subscription":this.runCheckPayments(),ControlButtonsLogic.exitFullscreen(function(){plugin.FacebookAgent.getInstance().canvas.pay(e,function(e,t){e===cleverapps.FacebookPayments.UserCanceled?(console.log("Payment "+i.itemId+" error "+t.error_message),s(cleverapps.Social.CODE_CANCELLED,t)):t&&-1===cleverapps.FacebookPayments.SuccessStatuses.indexOf(t.status)?(console.log("Payment "+i.itemId+" status: ",t.status),s(cleverapps.Social.CODE_CANCELLED,t)):(this.setPaymentChecked(),this.callPaymentCallback(t))}.bind(this))}.bind(this))},cleverapps.FacebookPayments.prototype.reactivateSubscription=function(e,t){t=t||function(){},plugin.FacebookAgent.getInstance().canvas.pay({action:"reactivate_subscription",subscription_id:e},function(e){e===cleverapps.FacebookPayments.UserCanceled&&(e=cleverapps.Social.CODE_CANCELLED),t(e)})},
cleverapps.FacebookPayments.prototype.cancelSubscription=function(e,t){t=t||function(){},plugin.FacebookAgent.getInstance().canvas.pay({action:"cancel_subscription",subscription_id:e},function(e){e===cleverapps.FacebookPayments.UserCanceled&&(e=cleverapps.Social.CODE_CANCELLED),t(e)})},cleverapps.FacebookPayments.prototype.isAvailable=function(){return!0},cleverapps.FacebookPayments.isAppropriate=function(){return!cc.sys.isNative},cleverapps.FacebookPayments.prototype.logPurchase=function(e){},cleverapps.FotoStranaPayments=function(){for(var e in cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}},cleverapps.FotoStranaPayments.prototype.calcLoadedPrice=function(e){return(e+" ").replace(".",",")},cleverapps.FotoStranaPayments.prototype.open=function(e,t){var i=["FS_113127743","FS_76785158","FS_113139157","FS_113139202"].indexOf(cleverapps.user.id)?1:0;t=cleverapps.once(t),FSClient.event("buyItemCallback",function(e){t(
"success"===e.result?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)},{itemId:e.id.mymailru,name:e.description,forwardData:e.itemId,picUrl:cleverapps.config.deployment+e.image.replace("fbproducts","fsproducts"),priceFmCents:Math.floor(100*e.price),isDebug:i})},cleverapps.FotoStranaPayments.prototype.isAvailable=function(){return!0},cleverapps.FotoStranaPayments.prototype.validate=function(e,t){t&&t()},cleverapps.FotoStranaPayments.isAppropriate=function(){return cleverapps.FotoStrana.isAppropriate()},cleverapps.FotoStranaPayments.prototype.logPurchase=function(e){},cleverapps.IAPWebViewPayments=function(){cleverapps.Payments.call(this),cc.sys.os===cc.sys.OS_IOS&&(PurchasesPlugin=cleverapps.IOSWebViewPurchasesPluginAdapter),PurchasesPlugin.init(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,this.checkInitialized.bind(this)),setInterval(this.checkInitialized.bind(this),cleverapps.parseInterval("2 minutes")),this.startTime=Date.now(),
this.purchaseCallback=function(){}},cleverapps.IAPWebViewPayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.IAPWebViewPayments.prototype.constructor=cleverapps.IAPWebViewPayments,cleverapps.IAPWebViewPayments.prototype.checkInitialized=cleverapps.timeredThrottle(1e3,function(){this.initialized?this.refreshed?this.refreshedSubscriptions?this.refreshedSubscriptionsTokens?this.requestedStoreProduct||this.requestStoreProduct():this.refreshSubscriptionsTokens():PurchasesPlugin.refresh("subscription"):PurchasesPlugin.refresh("consumable"):PurchasesPlugin.init()}),cleverapps.IAPWebViewPayments.prototype.requestStoreProduct=function(){PurchasesPlugin.requestStoreProduct&&PurchasesPlugin.requestStoreProduct(),console.log("IAPWebViewPayments.requestStoreProduct"),this.requestedStoreProduct=!0},cleverapps.IAPWebViewPayments.prototype.onRequestStoreProduct=function(e){this.storeProductName=e,console.log("IAPWebViewPayments.onRequestStoreProduct - "+e),this.checkInitialized(
),this.buyStoreProduct()},cleverapps.IAPWebViewPayments.prototype.buyStoreProduct=function(){if(this.storeProductName&&!cleverapps.metha.isFocused()){var t=this.findProductByName(this.storeProductName);delete this.storeProductName,t&&cleverapps.metha.display({focus:"buyStoreProduct",action:function(e){cleverapps.payments.oncePaymentFinished=e,(t=new Product(t.key)).buy()}})}},cleverapps.IAPWebViewPayments.prototype.refreshSubscriptionsTokens=function(){if(void 0!==PurchasesPlugin.getSubscriptionsTokens&&cleverapps.subscription){var e=decodeWebViewData(PurchasesPlugin.getSubscriptionsTokens());if(e.error)return void console.log("IAPWebViewPayments.refreshSubscriptionsTokens error "+e.error);cleverapps.subscription.addPurchaseTokens(e)}this.refreshedSubscriptionsTokens=!0,this.checkInitialized()},cleverapps.IAPWebViewPayments.prototype.addSubscriptionTokens=function(e,t){Array.isArray(e)||(e=[e]);var s=cleverapps.User.calcSource();if(-1!==["android","ios"].indexOf(s
)&&cleverapps.subscription){var i=e.map(function(e){var t=this.findProductByName(e.name);if(t&&"subscription"===t.type){var i={name:e.name};return"android"===s?(i.purchaseToken=e.receipt.purchaseToken,i.packageName=e.receipt.packageName,i.productId=e.receipt.productId):(i.purchaseToken=e.receipt,i.packageName=e.packageName,i.productId=e.productId),i}}.bind(this)).filter(function(e){return e});0<i.length&&cleverapps.subscription.addPurchaseTokens(i,t)}},cleverapps.IAPWebViewPayments.prototype.onRestoreSuccess=function(e){e=decodeWebViewData(e),console.log("IAPWebViewPayments.onRestoreSuccess"+e.length,e),e=JSON.parse(e),this.restoreCallback&&(this.restoreCallback(cleverapps.Social.CODE_SUCCEED),delete this.restoreCallback),this.addSubscriptionTokens(e,!0)},cleverapps.IAPWebViewPayments.prototype.onPurchaseSuccess=function(e){cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_SUCCESS,!0),e=decodeWebViewData(e),console.log("IAPWebViewPayments.onPurchaseSuccess",e),e=JSON.parse(e),
this.addSubscriptionTokens(e),this.purchaseCallback(cleverapps.Social.CODE_SUCCEED,e)},cleverapps.IAPWebViewPayments.prototype.logError=function(t,i){if(console.log("IAPWebViewPayments."+t,i),i){var e=function(e){cleverapps.throwAsync(t+" "+e+" "+i)};-1!==i.indexOf("client is null or not ready")?e(0):"service timeout"===i?e(1):"feature not support"===i?e(2):"service disconnected"===i?e(3):"user canceled"===i?e(4):"service unavailable"===i?e(5):"billing unavailable"===i?e(6):"item unavailable"===i?e(7):"developer error"===i?e(8):"item already owned"===i?e(9):"item not owned"===i?e(10):-1!==i.indexOf("cant find product:")?e(11):-1!==i.indexOf("cant find sku details:")?e(12):e("transaction failed"===i?13:"network unreachable"===i?14:"unknown error"===i?15:"client is not allowed to issue the request"===i?16:"purchase identifier was invalid"===i?17:"this device is not allowed to make the payment"===i?18:19)}},cleverapps.IAPWebViewPayments.prototype.onPurchaseFailure=function(e){
cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_FAILURE,!0),this.logError("onPurchaseFailure",decodeWebViewData(e)),this.purchaseCallback(cleverapps.Social.CODE_FAILED)},cleverapps.IAPWebViewPayments.prototype.onRestoreFailure=function(e){this.restoreCallback&&(this.restoreCallback(cleverapps.Social.CODE_FAILED),delete this.restoreCallback),console.log("IAPWebViewPayments.onRestoreFailure",decodeWebViewData(e))},cleverapps.IAPWebViewPayments.prototype.onPurchaseCancelled=function(){cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_CANCEL,!0),console.log("IAPWebViewPayments.onPurchaseCancelled"),this.purchaseCallback(cleverapps.Social.CODE_CANCELLED)},cleverapps.IAPWebViewPayments.prototype.onInitialized=function(e,t){e?(this.initialized=!0,this.checkInitialized()):(this.onInitializedError=decodeWebViewData(t),console.log("IAPWebViewPayments.onInitialized",this.onInitializedError),this.initialized=!1)},cleverapps.IAPWebViewPayments.prototype.onProductRequestSuccess=function(e,t
){t=decodeWebViewData(t),console.log("IAPWebViewPayments.onProductRequestSuccess "+e,t),t=JSON.parse(t);for(var i=0;i<t.length;i++){var s=this.findProductByName(t[i].name);void 0!==s&&(s.loadedPrice=t[i].price,s.loadedCurrencyCode=t[i].price_currency_code,s.loadedPriceAmount=t[i].price_amount_micros/1e6,this.loadedCurrencyCode||(this.loadedCurrencyCode=s.loadedCurrencyCode),console.log("iapwebviewpayments product "+t[i].productId+" "+s.loadedPrice+" "+s.loadedCurrencyCode+" "+s.loadedPriceAmount))}"consumable"===e?this.refreshed=!0:"subscription"===e&&(this.refreshedSubscriptions=!0),this.checkInitialized()},cleverapps.IAPWebViewPayments.prototype.isProductExists=function(e){var t=cleverapps.config.products[e];return t&&t.loadedPrice},cleverapps.IAPWebViewPayments.prototype.findProductByName=function(e){for(var t in cleverapps.config.products){var i=cleverapps.config.products[t];if((cc.sys.os===cc.sys.OS_IOS?i.id.ios:i.id.android)===e)return i}},
cleverapps.IAPWebViewPayments.prototype.restore=function(e){e=e||function(){},PurchasesPlugin.restore&&this.initialized?(this.restoreCallback=e,PurchasesPlugin.restore()):e(!1)},cleverapps.IAPWebViewPayments.prototype.open=function(e,i){cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_OPEN,!0),i=i||function(){};var t=Math.floor((Date.now()-this.startTime)/1e3);if(!this.initialized)return this.logError("onInitialized "+t+"s",this.onInitializedError),cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_NOT_INITIALIZED,!0),void i(cleverapps.Social.CODE_FAILED);if(!this.refreshed||"subscription"===e.type&&!this.refreshedSubscriptions)return this.logError("onProductRequestError "+t+"s debugMessage - "+this.onProductRequestErrorMessage,this.onProductRequestError),cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_NOT_REFRESHED,!0),void i(cleverapps.Social.CODE_FAILED);this.purchaseCallback=function(e,t){i.apply(this,arguments)}.bind(this)
;var s=cc.sys.os===cc.sys.OS_IOS?e.id.ios:e.id.android;PurchasesPlugin.hasProductByName(s)||cleverapps.ErrorHandler.logError("Product '"+s+"' not configured correctly (please check sdkbox_config.json)");var n=this.findProductByName(s);void 0===n||n.loadedPrice||cleverapps.ReportStream.debug("Product '"+s+"' has not loaded price"),PurchasesPlugin.purchase(s)},cleverapps.IAPWebViewPayments.prototype.onProductRequestFailure=function(e,t,i){this.onProductRequestError=decodeWebViewData(t),this.onProductRequestErrorMessage=decodeWebViewData(i)||"",console.log("IAPWebViewPayments.onProductRequestFailure "+e,this.onProductRequestError,this.onProductRequestErrorMessage)},cleverapps.IAPWebViewPayments.prototype.isAvailable=function(){return!0},cleverapps.IAPWebViewPayments.prototype.validate=function(e,t){if(t=t||function(){},-1!==["android","ios"].indexOf(cleverapps.User.calcSource())){var i={userid:cleverapps.user.id};cc.sys.os===cc.sys.OS_IOS?(i.receipt=e.receipt,i.productId=e.productId,
i.packageName=e.packageName,i.platform="apple",e.noDetails&&cleverapps.ReportStream.debug("IAPWEBVIEW noDetails "+JSON.stringify(e))):cc.sys.os===cc.sys.OS_ANDROID&&(i.receipt=e.receipt.purchaseToken,i.packageName=e.receipt.packageName,i.productId=e.receipt.productId,i.platform="google");var s=this.findProductByName(e.name);i.type=s&&s.type;var n={amount:s&&s.price?Math.round(s.price):1};cleverapps.RestClient.post("/purchasevalidator/validate/",i,function(e){console.log("Success purchase validate - "+JSON.stringify(e)),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PURCHASE_VALIDATE_SUCCESS,n),t()},function(){console.log("Failure purchase validate"),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PURCHASE_VALIDATE_FAILURE,n)})}else t()},cleverapps.IAPWebViewPayments.prototype.logPurchase=function(e){var t=e.orderId||e.receipt.orderId,i=this.findProductByName(e.name),s=i?i.price:0,n="USD";e.price_amount_micros&&e.price_currency_code?(s=e.price_amount_micros/1e6,
n=e.price_currency_code):i.loadedPriceAmount&&i.loadedCurrencyCode&&(s=i.loadedPriceAmount,n=i.loadedCurrencyCode),cc.sys.os===cc.sys.OS_IOS?webkitMessage("facebook",{action:"logPurchase",amount:s,currency:n}):FacebookPlugin.logPurchase(s,n),cleverapps.adjust.logPurchase(t,s,n)},cleverapps.IAPWebViewPayments.prototype.calcLoadedPrice=function(e){var t=cleverapps.EXCHANGE_RATES[this.loadedCurrencyCode];if(t){var i=Product.CURRENCY_CODE===this.loadedCurrencyCode?Product.CURRENCY:this.loadedCurrencyCode;return Math.floor(e*t)+".00 "+i}return Product.CURRENCY+" "+e},cleverapps.IAPWebViewPayments.isAppropriate=function(){return cc.sys.isNative&&cc.sys.isWebView&&("undefined"!=typeof PurchasesPlugin||cc.sys.os===cc.sys.OS_IOS)},cleverapps.IOSWebViewPurchasesPluginAdapter={init:function(){console.log("IOSWebViewPurchasesPluginAdapter init"),webkitMessage("purchase",{action:"init"})},refresh:function(e){console.log("IOSWebViewPurchasesPluginAdapter refresh"),webkitMessage("purchase",{
action:"refresh",type:e})},hasProductByName:function(e){return!0},purchase:function(e){webkitMessage("purchase",{action:"purchase",productName:e})},restore:function(e){webkitMessage("purchase",{action:"restore"})},requestStoreProduct:function(){webkitMessage("purchase",{action:"requestStoreProduct"})}},void 0===cleverapps)cleverapps={config:{source:void 0}};if(void 0===config)var config={debugMode:void 0};cleverapps.PaymentsManager={init:function(){var t=cleverapps.clone(cleverapps.PaymentsManager.PRODUCTS,!0);cleverapps.override(t,cleverapps.config.products||{}),Object.keys(t).forEach(function(e){!1===t[e]&&delete t[e]}),cleverapps.config.products=t;var e=null;return cleverapps.NoPayments.isAppropriate()?e=new cleverapps.NoPayments:cleverapps.IAPWebViewPayments.isAppropriate()?e=new cleverapps.IAPWebViewPayments:cleverapps.FakePayments.isAppropriate()?e=new cleverapps.FakePayments:cleverapps.InstantPayments.isAppropriate(
)?e=new cleverapps.InstantPayments:cleverapps.MobileOKPayments.isAppropriate()?e=new cleverapps.MobileOKPayments:cleverapps.SPMobagePayments.isAppropriate()?e=new cleverapps.SPMobagePayments:cleverapps.OKPayments.isAppropriate()?e=new cleverapps.OKPayments:cleverapps.MobileMyMailRuPayments.isAppropriate()?e=new cleverapps.MobileMyMailRuPayments:cleverapps.MyMailRuPayments.isAppropriate()?e=new cleverapps.MyMailRuPayments:cleverapps.MobileVkPayments.isAppropriate()?e=new cleverapps.MobileVkPayments:cleverapps.VKPayments.isAppropriate()?e=new cleverapps.VKPayments:cleverapps.MobagePayments.isAppropriate()?e=new cleverapps.MobagePayments:cleverapps.FotoStrana.isAppropriate()?e=new cleverapps.FotoStranaPayments:cleverapps.NK.isAppropriate()?e=new cleverapps.NKPayments:cleverapps.Draugiem.isAppropriate()?e=new cleverapps.DraugiemPayments:cleverapps.FacebookPayments.isAppropriate()&&(e=new cleverapps.FacebookPayments),e.onAvailableListeners=e.onAvailableListeners||{},
e.canCompensate=e.canCompensate||function(){},e}},cleverapps.PaymentsManager.PRODUCTS={buyExp10:{id:{facebook:"buyexp10.html",android:"buyexp10",ios:"buyexp10",instant:"buyexp10",mymailru:1},title:"messages:Shop.BuyExp10.Title",description:"messages:Shop.BuyExp10.Description",boughtMessage:"messages:Shop.BuyExp10.BoughtMessage",image:"/res/fbproducts/buyexp10.png",price:9.99,reward:{exp:10}},buyExp150:{id:{facebook:"buyexp150.html",android:"buyexp150",ios:"buyexp150",instant:"buyexp150",mymailru:2},title:"messages:Shop.BuyExp150.Title",description:"messages:Shop.BuyExp150.Description",boughtMessage:"messages:Shop.BuyExp150.BoughtMessage",image:"/res/fbproducts/buyexp150.png",price:99.99,reward:{exp:150}},addMoves1:{id:{facebook:"addmoves1.html",android:"addmoves1",ios:"addmoves1",instant:"addmoves1",mymailru:8},title:"messages:Shop.AddMoves1.Title",description:"messages:Shop.AddMoves1.Description",boughtMessage:"messages:Shop.AddMoves.BoughtMessage",
image:"/res/fbproducts/addmoves.png",price:.99,moves:5,bonus:1,compensateReward:{gold:200}},addMoves2:{id:{facebook:"addmoves2.html",android:"addmoves2",ios:"addmoves2",instant:"addmoves2",mymailru:9},title:"messages:Shop.AddMoves2.Title",description:"messages:Shop.AddMoves2.Description",boughtMessage:"messages:Shop.AddMoves.BoughtMessage",image:"/res/fbproducts/addmoves.png",price:1.99,moves:10,bonus:1,compensateReward:{gold:400}},addMoves3:{id:{facebook:"addmoves3.html",android:"addmoves3",ios:"addmoves3",instant:"addmoves3",mymailru:10},title:"messages:Shop.AddMoves3.Title",description:"messages:Shop.AddMoves3.Description",boughtMessage:"messages:Shop.AddMoves.BoughtMessage",image:"/res/fbproducts/addmoves.png",price:2.99,moves:15,bonus:1,compensateReward:{gold:600}},addMoves5:{id:{facebook:"addmoves5.html",android:"addmoves5",ios:"addmoves5",instant:"addmoves5",mymailru:11},title:"messages:Shop.AddMoves5.Title",description:"messages:Shop.AddMoves5.Description",
boughtMessage:"messages:Shop.AddMoves.BoughtMessage",image:"/res/fbproducts/addmoves.png",price:4.99,moves:15,bonus:2,compensateReward:{gold:1e3}},piggybank500:{id:{facebook:"piggybank500.html",android:"piggybank500",ios:"piggybank500",instant:"piggybank500",mymailru:12},title:"messages:Shop.PiggyBank1.Title",description:"messages:Shop.PiggyBank1.Description",image:"/res/fbproducts/piggy_bank.png?v=1",price:2.99,reward:{gold:500}},piggybank1800:{id:{facebook:"piggybank1800.html",android:"piggybank1800",ios:"piggybank1800",instant:"piggybank1800",mymailru:13},title:"messages:Shop.PiggyBank2.Title",description:"messages:Shop.PiggyBank2.Description",image:"/res/fbproducts/piggy_bank.png?v=1",price:9.99,reward:{gold:1800}},piggybank6000:{id:{facebook:"piggybank6000.html",android:"piggybank6000",ios:"piggybank6000",instant:"piggybank6000",mymailru:14},title:"messages:Shop.PiggyBank3.Title",description:"messages:Shop.PiggyBank3.Description",image:"/res/fbproducts/piggy_bank.png?v=1",
price:29.99,reward:{gold:6e3}},piggybank25000:{id:{facebook:"piggybank25000.html",android:"piggybank25000",ios:"piggybank25000",instant:"piggybank25000",mymailru:15},title:"messages:Shop.PiggyBank4.Title",description:"messages:Shop.PiggyBank4.Description",image:"/res/fbproducts/piggy_bank.png?v=1",price:99.99,reward:{gold:25e3}},gunShot:{id:{facebook:"gunshot.html",android:"gunshot",ios:"gunshot",instant:"gunshot",mymailru:16},title:"messages:Shop.GunShot.Title",description:"messages:Shop.GunShot.Description",boughtMessage:"messages:Shop.GunShot.BoughtMessage",image:"/res/fbproducts/gunshot.png?v=5",price:1.99,reward:{gun:1},compensateReward:{gold:400}},addMoves:{id:{facebook:"addmoves.html",android:"addmoves",ios:"addmoves",instant:"addmoves",mymailru:20},title:"messages:Shop.AddMoves.Title",description:"messages:Shop.AddMoves.Description",boughtMessage:"messages:Shop.AddMoves.BoughtMessage",image:"/res/fbproducts/addmoves0.png",price:.99,compensateReward:{gold:200}},gold500:{id:{
facebook:"500gold.html",android:"500gold",ios:"500gold",instant:"500gold",mymailru:21},title:"messages:Shop.Gold500.Title",description:"messages:Shop.Gold500.Description",image:"/res/fbproducts/gold2_200.png?v=2",price:2.99,reward:{gold:500},icon:"shop_gold2_png"},gold1800:{id:{facebook:"1800gold.html",android:"1800gold",ios:"1800gold",instant:"1800gold",mymailru:22},title:"messages:Shop.Gold1800.Title",description:"messages:Shop.Gold1800.Description",image:"/res/fbproducts/gold3_200.png?v=1",price:9.99,oldPrice:1.99,label:1800,reward:{gold:1800},icon:"shop_gold3_png"},gold3800:{id:{facebook:"3800gold.html",android:"3800gold",ios:"3800gold",instant:"3800gold",mymailru:39},title:"messages:Shop.Gold3800.Title",description:"messages:Shop.Gold3800.Description",image:"/res/fbproducts/heap_gold.png?v=1",price:19.99,reward:{gold:3800},icon:"heap_gold_png"},gold6000:{id:{facebook:"6000gold.html",android:"6000gold",ios:"6000gold",instant:"6000gold",mymailru:23},
title:"messages:Shop.Gold6000.Title",description:"messages:Shop.Gold6000.Description",image:"/res/fbproducts/gold4_200.png?v=1",price:29.99,oldPrice:5.99,label:6e3,reward:{gold:6e3},icon:"shop_gold4_png"},gold25000:{id:{facebook:"25000gold.html",android:"25000gold",ios:"25000gold",instant:"25000gold",mymailru:24},title:"messages:Shop.Gold25000.Title",description:"messages:Shop.Gold25000.Description",image:"/res/fbproducts/gold5_200.png?v=1",price:99.99,reward:{gold:25e3},icon:"shop_gold5_png"},starterPack0:{id:{facebook:"starterpack0.html",android:"starterpack0",ios:"starterpack0",instant:"starterpack0",mymailru:25},title:"messages:StarterPack0.Title",description:"messages:StarterPack0.Description",boughtMessage:"messages:StarterPack.Bought",boughtMessageParams:{title:"messages:StarterPack0.Title"},image:"/res/fbproducts/starter_pack0.png?v=1",price:.99},starterPack:{id:{facebook:"starterpack.html",android:"starterpack",ios:"starterpack",instant:"starterpack",mymailru:26},
title:"messages:StarterPack1.Title",description:"messages:StarterPack1.Description",boughtMessage:"messages:StarterPack.Bought",boughtMessageParams:{title:"messages:StarterPack1.Title"},image:"/res/fbproducts/starter_pack.png?v=1",price:4.99},starterPack2:{id:{facebook:"starterpack2.html",android:"starterpack2",ios:"starterpack2",instant:"starterpack2",mymailru:27},title:"messages:StarterPack2.Title",description:"messages:StarterPack2.Description",boughtMessage:"messages:StarterPack.Bought",boughtMessageParams:{title:"messages:StarterPack2.Title"},image:"/res/fbproducts/starter_pack2.png?v=1",price:29.99},subsWeek:{id:{facebook:"subsweek.html",android:"subsweek",ios:"subsweek",ok:"subsweek",mymailru:31},title:"messages:Shop.SubsWeek.Title",description:"messages:Shop.SubsWeek.Description",boughtMessage:"messages:Shop.SubsWeek.BoughtMessage",image:"/res/fbproducts/premium.png",price:9.99,trial:"1 day",period:"2 weeks",type:"subscription",projects:["riddles","heroes","wordsoup","crocword"
,"olympics","tripeaks","scramble"]},subsMonth:{id:{facebook:"subsmonth.html",android:"subsmonth",ios:"subsmonth",ok:"subsmonth",mymailru:32},title:"messages:Shop.SubsMonth.Title",description:"messages:Shop.SubsMonth.Description",boughtMessage:"messages:Shop.SubsMonth.BoughtMessage",image:"/res/fbproducts/premium.png",price:14.99,period:"1 month",type:"subscription",projects:["riddles","heroes","wordsoup","crocword","olympics","tripeaks","scramble"]},subsWeekTest:{id:{facebook:"subsweektest.html",android:"subsweektest",ios:"subsweektest",ok:"subsweektest",mymailru:33},title:"messages:Shop.SubsWeek.Title",description:"messages:Shop.SubsWeek.Description",boughtMessage:"messages:Shop.SubsWeek.BoughtMessage",image:"/res/fbproducts/premium.png",price:.05,trial:"1 day",period:"2 weeks",type:"subscription",projects:["riddles","heroes","wordsoup","crocword"]},subsMonthTest:{id:{facebook:"subsmonthtest.html",android:"subsmonthtest",ios:"subsmonthtest",ok:"subsmonthtest",mymailru:34},
title:"messages:Shop.SubsMonth.Title",description:"messages:Shop.SubsMonth.Description",boughtMessage:"messages:Shop.SubsMonth.BoughtMessage",image:"/res/fbproducts/premium.png",price:.1,period:"1 month",type:"subscription",projects:["riddles","heroes","wordsoup","crocword"]},cellPack05:{id:{facebook:"cellpack05.html",android:"cellpack05",ios:"cellpack05",instant:"cellpack05",mymailru:46},title:"messages:TileShop.cellPack05.Title",description:"messages:TileShop.cellPack05.Description",image:"/res/fbproducts/cell_pack_200.png",boughtMessage:"messages:Shop.cellPack05.boughtMessage",price:.49,oldPrice:4.99,reward:{boosters:{0:5}},icon:"cellbooster_png",label:5},linePack074:{id:{facebook:"linepack074.html",android:"linepack074",ios:"linepack074",instant:"linepack074",mymailru:47},title:"messages:TileShop.linePack074.Title",description:"messages:TileShop.linePack074.Description",image:"/res/fbproducts/line_pack_200.png",boughtMessage:"messages:Shop.linePack074.boughtMessage",price:.74,
oldPrice:7.49,reward:{boosters:{1:5}},icon:"linebooster_png",label:5},colorPack10:{id:{facebook:"colorpack10.html",android:"colorpack10",ios:"colorpack10",instant:"colorpack10",mymailru:48},title:"messages:TileShop.colorPack10.Title",description:"messages:TileShop.colorPack10.Description",image:"/res/fbproducts/color_pack_200.png",boughtMessage:"messages:Shop.colorPack10.boughtMessage",price:.99,oldPrice:9.99,reward:{boosters:{2:5}},icon:"colorbooster_png",label:5},cellPack2:{id:{facebook:"cellpack2.html",android:"cellpack2",ios:"cellpack2",instant:"cellpack2",mymailru:49},title:"messages:TileShop.cellPack10.Title",description:"messages:TileShop.cellPack10.Description",image:"/res/fbproducts/cell_pack_200.png",boughtMessage:"messages:Shop.cellPack10.boughtMessage",price:1.99,oldPrice:19.99,reward:{boosters:{0:10}},icon:"cellbooster_png",label:10},linePack3:{id:{facebook:"linepack3.html",android:"linepack3",ios:"linepack3",instant:"linepack3",mymailru:50},
title:"messages:TileShop.linePack15.Title",description:"messages:TileShop.linePack15.Description",image:"/res/fbproducts/line_pack_200.png",boughtMessage:"messages:Shop.linePack15.boughtMessage",price:2.99,oldPrice:29.99,reward:{boosters:{1:10}},icon:"linebooster_png",label:10},colorPack4:{id:{facebook:"colorpack4.html",android:"colorpack4",ios:"colorpack4",instant:"colorpack4",mymailru:51},title:"messages:TileShop.colorPack20.Title",description:"messages:TileShop.colorPack20.Description",image:"/res/fbproducts/color_pack_200.png",boughtMessage:"messages:Shop.colorPack20.boughtMessage",price:3.99,oldPrice:39.99,reward:{boosters:{2:10}},icon:"colorbooster_png",label:10},unlimitedLives05:{id:{facebook:"unlimitedlives05.html",android:"unlimitedlives05",ios:"unlimitedlives05",instant:"unlimitedlives05",mymailru:52},title:"messages:UnlimitedLives.Title",description:"messages:TileShop.unlimitedLives05.Description",image:"/res/fbproducts/unlimitedlives.png",
boughtMessage:"messages:UnlimitedLivesBought",price:.49,oldPrice:2.99,reward:{unlimitedLives:"3 days"},icon:"life_unlim",label:"messages:UnlimitedLives.3 day"},lives074:{id:{facebook:"lives074.html",android:"lives074",ios:"lives074",instant:"lives074",mymailru:53},title:"messages:TileShop.lives074.Title",description:"messages:TileShop.lives074.Description",image:"/res/fbproducts/lives.png",boughtMessage:"messages:Shop.lives074.boughtMessage",price:.74,oldPrice:7.49,reward:{lives:50},icon:"level_failed_heart_png",label:50},exp1:{id:{facebook:"exp1.html",android:"exp1",ios:"exp1",instant:"exp1",mymailru:54},title:"messages:TileShop.exp1.Title",description:"messages:TileShop.exp1.Description",image:"/res/fbproducts/buyexp150.png",boughtMessage:"messages:Shop.exp1.boughtMessage",price:.99,oldPrice:19.99,reward:{exp:25},icon:"exp_png",label:25},unlimitedLives2:{id:{facebook:"unlimitedlives2.html",android:"unlimitedlives2",ios:"unlimitedlives2",instant:"unlimitedlives2",mymailru:55},
title:"messages:UnlimitedLives.Title",description:"messages:TileShop.unlimitedLives2.Description",image:"/res/fbproducts/unlimitedlives.png",boughtMessage:"messages:UnlimitedLivesBought",price:1.99,oldPrice:4.99,reward:{unlimitedLives:"5 days"},icon:"life_unlim",label:"messages:UnlimitedLives.5 day"},lives3:{id:{facebook:"lives3.html",android:"lives3",ios:"lives3",instant:"lives3",mymailru:56},title:"messages:TileShop.lives3.Title",description:"messages:TileShop.lives3.Description",image:"/res/fbproducts/lives.png",boughtMessage:"messages:Shop.lives3.boughtMessage",price:2.99,oldPrice:29.99,reward:{lives:100},icon:"level_failed_heart_png",label:100},exp4:{id:{facebook:"exp4.html",android:"exp4",ios:"exp4",instant:"exp4",mymailru:57},title:"messages:TileShop.exp4.Title",description:"messages:TileShop.exp4.Description",image:"/res/fbproducts/buyexp150.png",boughtMessage:"messages:Shop.exp4.boughtMessage",price:3.99,oldPrice:39.99,reward:{exp:50},icon:"exp_png",label:50},battlepass:{id:{
facebook:"battlepass.html",android:"battlepass",ios:"battlepass",instant:"battlepass",mymailru:58},title:"messages:BattlePassProduct.Title",description:"messages:BattlePassProduct.Description",image:"/res/fbproducts/battle_pass_200.png",boughtMessage:"messages:BattlePassBought",price:19.99,reward:{battlePass:1},compensateReward:{gold:4e3}},raceKey:{id:{facebook:"racekey.html",android:"racekey",ios:"racekey",instant:"racekey",mymailru:61},title:"messages:Race.product.title",description:"messages:Race.product.description",image:"/res/fbproducts/baloon_key_200.png",boughtMessage:"messages:Race.product.bought",price:19.99,oldPrice:40,reward:{raceKey:1},compensateReward:{gold:4e3}},gold500sale:{id:{facebook:"500goldsale.html",android:"500goldsale",ios:"500goldsale",instant:"500goldsale",mymailru:65},title:"messages:Shop.Gold500.Title",description:"messages:Shop.Gold500.Description",image:"/res/fbproducts/gold2_200.png",price:.99,oldPrice:2.99,label:500,reward:{gold:500},
icon:"shop_gold2_png"},gold1800sale:{id:{facebook:"1800goldsale.html",android:"1800goldsale",ios:"1800goldsale",instant:"1800goldsale",mymailru:59},title:"messages:Shop.Gold1800.Title",description:"messages:Shop.Gold1800.Description",image:"/res/fbproducts/gold3_200.png",price:2.99,oldPrice:9.99,label:1800,reward:{gold:1800},icon:"shop_gold3_png"},gold6000sale:{id:{facebook:"6000goldsale.html",android:"6000goldsale",ios:"6000goldsale",instant:"6000goldsale",mymailru:60},title:"messages:Shop.Gold6000.Title",description:"messages:Shop.Gold6000.Description",image:"/res/fbproducts/gold4_200.png",price:5.99,oldPrice:29.99,label:6e3,reward:{gold:6e3},icon:"shop_gold4_png"},unlimitedLives:{id:{facebook:"unlimitedlives.html",android:"unlimitedlives",ios:"unlimitedlives",instant:"unlimitedlives",mymailru:64},title:"messages:UnlimitedLives.Title",description:"messages:UnlimitedLives.Description",boughtMessage:"messages:UnlimitedLivesBought",image:"/res/fbproducts/unlimitedlives.png",price:2.99,
reward:{unlimitedLives:"3 days"},icon:"unlimitedLives_png",animation:"animation"},gold1:{id:{facebook:"gold1.html",android:"gold1",ios:"gold1",instant:"gold1",mymailru:62},title:"messages:TileShop.gold1.Title",description:"messages:TileShop.gold1.Description",image:"/res/fbproducts/gold2_200.png",boughtMessage:"messages:Shop.gold1.boughtMessage",price:.99,oldPrice:9.99,reward:{gold:1e3},icon:"boosters_sale_coin_png",label:"1000"},gold4:{id:{facebook:"gold4.html",android:"gold4",ios:"gold4",instant:"gold4",mymailru:63},title:"messages:TileShop.gold4.Title",description:"messages:TileShop.gold4.Description",image:"/res/fbproducts/gold4_200.png",boughtMessage:"messages:Shop.gold4.boughtMessage",price:3.99,oldPrice:39.99,reward:{gold:5e3},icon:"boosters_sale_coin_png",label:"5000"}},cleverapps.PaymentsManager.SCRAMBLE_PRODUCTS={highlightPack1:{id:{facebook:"highlightpack1.html",android:"highlightpack1",ios:"highlightpack1",instant:"highlightpack1",mymailru:66},
title:"messages:TileShop.highlightPack1.Title",description:"messages:TileShop.highlightPack1.Description",image:"/res/fbproducts/highlight_booster_200.png",boughtMessage:"messages:Shop.highlightPack1.boughtMessage",price:.99,oldPrice:1.99,reward:{boosters:{13:10}},icon:"highlight",label:"x10"},eyePack2:{id:{facebook:"eyepack2.html",android:"eyepack2",ios:"eyepack2",instant:"eyepack2",mymailru:67},title:"messages:TileShop.eyePack2.Title",description:"messages:TileShop.eyePack2.Description",image:"/res/fbproducts/eye_booster_200.png",boughtMessage:"messages:Shop.eyePack2.boughtMessage",price:1.99,oldPrice:4.99,reward:{boosters:{14:10}},icon:"eye",label:"x10"},hintBoosterBeforePack3:{id:{facebook:"hintboosterbeforepack3.html",android:"hintboosterbeforepack3",ios:"hintboosterbeforepack3",instant:"hintboosterbeforepack3",mymailru:68},title:"messages:TileShop.hintBoosterBeforePack3.Title",description:"messages:TileShop.hintBoosterBeforePack3.Description",
image:"/res/fbproducts/hint_booster_before_200.png",boughtMessage:"messages:Shop.hintBoosterBeforePack3.boughtMessage",price:2.99,oldPrice:6.99,reward:{boosters:{15:10}},icon:"bonus_hint_sale_png",label:"x10"}},cleverapps.PaymentsManager.PACK_PRODUCTS={sweetPack:{id:{facebook:"sweetpack.html",android:"sweetpack",ios:"sweetpack",instant:"sweetpack",mymailru:35},title:"messages:TileShop.sweetPack.Title",description:"messages:TileShop.sweetPack.Description",image:"/res/fbproducts/sweet_pack_200.png",boughtMessage:"messages:Shop.sweetPack.boughtMessage",price:5.99,reward:{gold:500,boosters:{0:1,1:1}},icon:"sweet_pack_png"},jamPack:{id:{facebook:"jampack.html",android:"jampack",ios:"jampack",instant:"jampack",mymailru:36},title:"messages:TileShop.jamPack.Title",description:"messages:TileShop.jamPack.Description",image:"/res/fbproducts/jam_pack_200.png",boughtMessage:"messages:Shop.jamPack.boughtMessage",price:12.99,reward:{gold:1800,boosters:{0:1,1:1,2:1}},icon:"jam_pack_png"},tastyPack:{
id:{facebook:"tastypack.html",android:"tastypack",ios:"tastypack",instant:"tastypack",mymailru:40},title:"messages:TileShop.tastyPack.Title",description:"messages:TileShop.tastyPack.Description",image:"/res/fbproducts/tasty_pack_200.png?v=1",boughtMessage:"messages:Shop.tastyPack.boughtMessage",price:25.99,reward:{gold:3800,boosters:{0:3,1:3,2:3}},icon:"tasty_pack_png"},honeyPack:{id:{facebook:"honeypack.html",android:"honeypack",ios:"honeypack",instant:"honeypack",mymailru:37},title:"messages:TileShop.honeyPack.Title",description:"messages:TileShop.honeyPack.Description",image:"/res/fbproducts/honey_pack_200.png?v=1",boughtMessage:"messages:Shop.honeyPack.boughtMessage",price:39.99,reward:{gold:6e3,boosters:{0:5,1:5,2:5}},icon:"honey_pack_png"},epicPack:{id:{facebook:"epicpack.html",android:"epicpack",ios:"epicpack",instant:"epicpack",mymailru:38},title:"messages:TileShop.epicPack.Title",description:"messages:TileShop.epicPack.Description",
image:"/res/fbproducts/epic_pack_200.png?v=1",boughtMessage:"messages:Shop.epicPack.boughtMessage",price:129.99,reward:{gold:25e3,boosters:{0:20,1:20,2:20}},icon:"epic_pack_png"}};var customizeProducts=function(){var e=cleverapps.extend||Object.assign;for(var t in"match3"!==cleverapps.config.type&&"differences"!==cleverapps.config.type||e(cleverapps.PaymentsManager.PRODUCTS,cleverapps.PaymentsManager.PACK_PRODUCTS),"differences"===cleverapps.config.type&&(cleverapps.PaymentsManager.PRODUCTS.sweetPack.reward.boosters={8:2,9:2},cleverapps.PaymentsManager.PRODUCTS.jamPack.reward.boosters={8:3,9:3},cleverapps.PaymentsManager.PRODUCTS.tastyPack.reward.boosters={8:5,9:5},cleverapps.PaymentsManager.PRODUCTS.honeyPack.reward.boosters={8:7,9:7},cleverapps.PaymentsManager.PRODUCTS.epicPack.reward.boosters={8:30,9:30}),"solitaire"===cleverapps.config.type&&"spades"!==cleverapps.config.name&&(e(cleverapps.PaymentsManager.PRODUCTS,cleverapps.PaymentsManager.PACK_PRODUCTS),
cleverapps.PaymentsManager.PRODUCTS.addMoves1.price=1.49,cleverapps.PaymentsManager.PRODUCTS.sweetPack.reward.boosters={10:2,11:2,12:2},cleverapps.PaymentsManager.PRODUCTS.jamPack.reward.boosters={10:3,11:3,12:3},cleverapps.PaymentsManager.PRODUCTS.tastyPack.reward.boosters={10:5,11:5,12:5},cleverapps.PaymentsManager.PRODUCTS.honeyPack.reward.boosters={10:7,11:7,12:7},cleverapps.PaymentsManager.PRODUCTS.epicPack.reward.boosters={10:30,11:30,12:30}),"match3"===cleverapps.config.type&&(cleverapps.PaymentsManager.PRODUCTS.sweetPack.reward.boosters={5:1,6:1,7:1},cleverapps.PaymentsManager.PRODUCTS.jamPack.reward.boosters={5:2,6:2,7:2},cleverapps.PaymentsManager.PRODUCTS.tastyPack.reward.boosters={0:3,1:3,5:3,6:3,7:3},cleverapps.PaymentsManager.PRODUCTS.honeyPack.reward.boosters={0:5,1:5,5:5,6:5,7:5},cleverapps.PaymentsManager.PRODUCTS.epicPack.reward.boosters={0:18,1:18,5:18,6:18,7:18}),"ios"===cleverapps.config.source&&(cleverapps.PaymentsManager.PRODUCTS.gold25000.price=99.99),
"ios"===cleverapps.config.source&&cleverapps.PaymentsManager.PRODUCTS.epicPack&&(cleverapps.PaymentsManager.PRODUCTS.epicPack.price=99.99),-1!==["instant","ios"].indexOf(cleverapps.config.source)&&(cleverapps.PaymentsManager.PRODUCTS.cellPack05.price=.99,cleverapps.PaymentsManager.PRODUCTS.cellPack05.oldPrice=9.99,cleverapps.PaymentsManager.PRODUCTS.linePack074.price=1.99,cleverapps.PaymentsManager.PRODUCTS.linePack074.oldPrice=19.99,cleverapps.PaymentsManager.PRODUCTS.colorPack10.price=2.99,cleverapps.PaymentsManager.PRODUCTS.colorPack10.oldPrice=29.99,cleverapps.PaymentsManager.PRODUCTS.lives074.price=1.99,cleverapps.PaymentsManager.PRODUCTS.lives074.oldPrice=19.99,cleverapps.PaymentsManager.PRODUCTS.unlimitedLives05.price=.99,cleverapps.PaymentsManager.PRODUCTS.unlimitedLives05.oldPrice=9.99),-1!==["android","ios"].indexOf(cleverapps.config.source)&&(cleverapps.PaymentsManager.PRODUCTS.subsWeek.price=4.99,cleverapps.PaymentsManager.PRODUCTS.subsWeek.trial="3 days",
cleverapps.PaymentsManager.PRODUCTS.subsWeek.period="1 week",cleverapps.PaymentsManager.PRODUCTS.subsWeek.title="messages:Shop.SubsWeek.ThreeDays.Title",cleverapps.PaymentsManager.PRODUCTS.subsWeek.description="messages:Shop.SubsWeek.ThreeDays.Description"),"olympics"===cleverapps.config.name&&(cleverapps.PaymentsManager.PRODUCTS.lives3.icon="boosters_sale_energy_png",cleverapps.PaymentsManager.PRODUCTS.lives074.icon="boosters_sale_energy_png"),"scramble"===cleverapps.config.name&&(e(cleverapps.PaymentsManager.PRODUCTS,cleverapps.PaymentsManager.PACK_PRODUCTS),e(cleverapps.PaymentsManager.PRODUCTS,cleverapps.PaymentsManager.SCRAMBLE_PRODUCTS),cleverapps.PaymentsManager.PRODUCTS.sweetPack.reward.boosters={13:2,14:2,15:2},cleverapps.PaymentsManager.PRODUCTS.jamPack.reward.boosters={13:3,14:3,15:3},cleverapps.PaymentsManager.PRODUCTS.tastyPack.reward.boosters={13:5,14:5,15:5},cleverapps.PaymentsManager.PRODUCTS.honeyPack.reward.boosters={13:7,14:7,15:7},
cleverapps.PaymentsManager.PRODUCTS.epicPack.reward.boosters={13:30,14:30,15:30}),cleverapps.PaymentsManager.PRODUCTS)cleverapps.PaymentsManager.PRODUCTS[t].key=t};"undefined"!=typeof exports?module.exports={getProducts:function(e){return Object.assign(cleverapps.config,e),customizeProducts(),cleverapps.PaymentsManager.PRODUCTS}}:customizeProducts(),cleverapps.PaymentsHistory=function(){this.load(),this.onAddPaymentListeners={}},cleverapps.PaymentsHistory.prototype.addPayment=function(e){var t={price:e.price,productId:e.id,textPrice:e.getCurrentPrice(),time:Date.now()};if(this.payments.push(t),this.save(),cleverapps.serverFlags.setFlag(cleverapps.ServerFlags.PAYER),cleverapps.abTest){var i=Math.round(e.price*cleverapps.User.calcPriceCoef()*100)/100;cleverapps.abTest.purchaseEvent(i)}var s=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CLASSIC);if(s){var n=s.getName();cleverapps.eventLogger.logEvent("mission_"+n,{amount:Math.round(e.price*cleverapps.User.calcPriceCoef(
)*100)/100})}cleverapps.values(this.onAddPaymentListeners).forEach(cleverapps.callFunc)},cleverapps.PaymentsHistory.prototype.isPayer=function(){return 0<this.payments.length||cleverapps.serverFlags.hasFlag(cleverapps.ServerFlags.PAYER)},cleverapps.PaymentsHistory.prototype.getLastPayment=function(){return 0<this.payments.length?this.payments[this.payments.length-1]:void 0},cleverapps.PaymentsHistory.prototype.calcFavoriteProduct=function(e){var i={},t={},s=e.filter(function(e){return cleverapps.config.products[e]});s.forEach(function(e){t[cleverapps.config.products[e].price]=e,i[e]=0}),this.payments.forEach(function(e){t[e.price]&&i[t[e.price]]++});var n=void 0,o=0;return s.forEach(function(e){var t=cleverapps.config.products[e].price;2<=i[e]&&o<t&&(n=e,o=t)}),n},cleverapps.PaymentsHistory.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PAYMENTS_HISTORY);e||(e={payments:[]}),Array.isArray(e)&&(e={payments:e}),this.payments=e.payments},
cleverapps.PaymentsHistory.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PAYMENTS_HISTORY,{payments:this.payments})},cleverapps.PaymentsHistory.PAYER_NONE=0,cleverapps.PaymentsHistory.PAYER_WEAK=1,cleverapps.PaymentsHistory.PAYER_NORMAL=2,cleverapps.PaymentsHistory.PAYER_WHALE=3,cleverapps.PaymentsHistory.PAYER_BIGWHALE=4,cleverapps.PaymentsHistory.BRACKETS=[2.99,9.99,29.99,99.99],cleverapps.PaymentsHistory.prototype.classify=function(e){void 0===e&&(e="1 month");for(var t=0,i=this.payments.length-1;0<=i;i--){var s=this.payments[i];if(s.time+cleverapps.parseInterval(e)<Date.now())break;t+=s.price}for(var n=0;n<cleverapps.PaymentsHistory.BRACKETS.length&&!(t<cleverapps.PaymentsHistory.BRACKETS[n]+.001);n++);return n},cleverapps.NKPayments=function(){for(var e in cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}},cleverapps.NKPayments.prototype.calcLoadedPrice=function(e){return Math.floor(10*e
)+"EGB"},cleverapps.NKPayments.prototype.open=function(e,i){var t={};t[opensocial.Payment.Field.AMOUNT]=parseInt(e.loadedPrice),t[opensocial.Payment.Field.MESSAGE]=e.description;var s=opensocial.newPayment(t);ControlButtonsLogic.exitFullscreen(function(){opensocial.requestPayment(s,function(e){if(e.hadError())i(cleverapps.Social.CODE_FAILED,e);else{var t=e.getData();i(cleverapps.Social.CODE_SUCCEED,t)}})})},cleverapps.NKPayments.prototype.isAvailable=function(){return!0},cleverapps.NKPayments.isAppropriate=function(){return cleverapps.NK.isAppropriate()},cleverapps.NKPayments.prototype.validate=function(e,t){t&&t()},cleverapps.NKPayments.prototype.logPurchase=function(e){},cleverapps.DraugiemPayments=function(){for(var e in cleverapps.Payments.call(this),cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}this.paymentTesters=["5531190","5531196","5531268"]},cleverapps.DraugiemPayments.prototype=Object.create(
cleverapps.Payments.prototype),cleverapps.DraugiemPayments.prototype.constructor=cleverapps.DraugiemPayments,cleverapps.DraugiemPayments.prototype.calcLoadedPrice=function(e){return e+" "},cleverapps.DraugiemPayments.prototype.stopCheckPayments=function(){this.checkPaymentInterval&&(clearInterval(this.checkPaymentInterval),this.checkPaymentInterval=void 0)},cleverapps.DraugiemPayments.prototype.runCheckPayments=function(){this.stopCheckPayments();var e=Date.now();this.checkPaymentInterval=setInterval(function(){this.checkPayment(),Date.now()-e>cleverapps.parseInterval("3 minutes")&&this.onFailedPayment()}.bind(this),1e3)},cleverapps.DraugiemPayments.prototype.onFailedPayment=function(){this.stopCheckPayments(),this.paymentCallback&&(this.paymentCallback=void 0)},cleverapps.DraugiemPayments.prototype.onSuccessPayment=function(){this.stopCheckPayments(),this.paymentCallback&&(this.paymentCallback(cleverapps.Social.CODE_SUCCEED),this.paymentCallback=void 0)},
cleverapps.DraugiemPayments.prototype.checkPayment=function(){console.log("ask transaction status: "+this.paymentId),cleverapps.social.api("transactions/check",{id:this.paymentId},function(e,t){void 0!==t&&(console.log("status: ",t.status),"FAILED"===t.status?this.onFailedPayment():"OK"===t.status&&this.onSuccessPayment())}.bind(this))},cleverapps.DraugiemPayments.prototype.isProductExists=function(e){return cleverapps.config.products[e]&&DraugiemProducts[e]},cleverapps.DraugiemPayments.prototype.open=function(i,s){if(!DraugiemProducts[i.key])return s(cleverapps.Social.CODE_FAILED),void setTimeout(function(){throw console.log(i),"Draugiem payment configuration error for "+i.key},0);var e={price:Math.round(100*parseFloat(i.loadedPrice)),service:DraugiemProducts[i.key]};-1!==this.paymentTesters.indexOf(cleverapps.social.getUserID())&&(e.price=1),cleverapps.social.api("transactions/create",e,function(e,t){console.log(DraugiemProducts[i.key],e,t),e===cleverapps.Social.CODE_SUCCEED?(
this.paymentId=t.transaction.id,this.paymentCallback=s,draugiemWindowOpen(t.transaction.link,350,400,function(){this.runCheckPayments()}.bind(this))):(console.log(DraugiemProducts[i.key],i,i.key),s(cleverapps.Social.CODE_FAILED))}.bind(this))},cleverapps.DraugiemPayments.prototype.isAvailable=function(){return!0},cleverapps.DraugiemPayments.isAppropriate=function(){return cleverapps.Draugiem.isAppropriate()},cleverapps.DraugiemPayments.prototype.validate=function(e,t){t&&t()},cleverapps.DraugiemPayments.prototype.logPurchase=function(e){};var CustomSyncers={extractors:{users:function(){var e=cleverapps.user;if(e){var t={id:e.id,gold:e.gold,registered:e.registered,visited:e.visited,source:e.source,channel:e.channel,abtest:e.abtest,progressCompare:e.progressCompare,progress:e.progress};return void 0!==e.level&&(t.level=e.level),void 0!==e.episode&&(t.episode=e.episode),void 0!==e.exp&&(t.exp=e.exp),t}},bonuses:function(){if(cleverapps.periodicBonus)return{
event:cleverapps.periodicBonus.when}},bonusgames:function(){if(cleverapps.bonusRoundChest)return{event:cleverapps.bonusRoundChest.when}},games:function(){if(cleverapps.GameSyncer)return cleverapps.GameSyncer.getInfo()},settings:function(){if(cleverapps.settings)return cleverapps.settings.getSaveInfo()},serverflags:function(){if(cleverapps.serverFlags)return cleverapps.serverFlags.getInfo()},tempgoods:function(){if(cleverapps.tempGoods)return cleverapps.tempGoods.getInfo()},lives:function(){if(cleverapps.lives)return cleverapps.lives.getInfo()},boosters:function(){if(cleverapps.boostersCounter)return cleverapps.boostersCounter.data},starchests:function(){if(cleverapps.starChest)return{stars:cleverapps.starChest.stars}},packs:function(){if(cleverapps.packManager)return{used:cleverapps.packManager.used}},dailytasks:function(){if(cleverapps.dailyTasks)return cleverapps.dailyTasks.getInfo()},missions:function(){if(cleverapps.missionManager)return cleverapps.missionManager.getInfo()},
piggybank:function(){if(cleverapps.piggyBank)return cleverapps.piggyBank.getInfo()},gun:function(){if(cleverapps.gun)return cleverapps.gun.getInfo()},heroes:function(){if("undefined"!=typeof match3&&match3&&match3.heroes)return match3.heroes.getInfo()},subscription:function(){if(cleverapps.subscription)return cleverapps.subscription.getInfo()},userdailycup:function(){if(cleverapps.dailyCup)return cleverapps.dailyCup.getInfo()},userweeklycup:function(){if(cleverapps.weeklyCup)return cleverapps.weeklyCup.getInfo()},forces:function(){if(cleverapps.forces)return cleverapps.forces.getInfo()},metha:function(){if(cleverapps.metha.getType()!==Metha.HOSE&&cleverapps.metha.getMainObject().getInfo)return cleverapps.metha.getMainObject().getInfo()},cookiejar:function(){if(levels&&levels.cookieJar)return levels.cookieJar.getCounterValue()},competitionstatistics:function(){if(cleverapps.competitionStatistics)return cleverapps.competitionStatistics.getInfo()},cardskins:function(){if(
cleverapps.cardSkins)return cleverapps.cardSkins.getInfo()}},importerData:{users:function(e){var t=cleverapps.user;if(t){for(var i in e)t[i]=e[i];t.save(!1),cleverapps.abTest&&cleverapps.abTest.setGroup(t.abtest),levels.episodes.reset(),levels.episodes.setCurrentEpisode(cleverapps.user.episode)}},bonuses:function(e){if(cleverapps.periodicBonus){var t=cleverapps.periodicBonus;e.event<t.when||e.event>Date.now()+t.interval||(t.locked=!0,t.setWhenUnlock(e.event),t.save(!1),t.changeLockedListener())}},bonusgames:function(e){if(cleverapps.bonusRoundChest){var t=cleverapps.bonusRoundChest;e.event<t.when||e.event>Date.now()+t.interval||(t.locked=!0,t.setWhenUnlock(e.event),t.save(!1),t.changeLockedListener())}},games:function(e){cleverapps.GameSyncer&&cleverapps.GameSyncer.saveInfo(e)},settings:function(){},boosters:function(e){cleverapps.boostersCounter&&(cleverapps.boostersCounter.data=e,cleverapps.boostersCounter.addInitAmount(!0),cleverapps.boostersCounter.save(!1))},serverflags:function(e
){cleverapps.serverFlags&&cleverapps.serverFlags.updateInfo(e,!0)},friendrequests:function(e){levels&&levels.friendRequests&&levels.friendRequests.onload(e)},tempgoods:function(e){cleverapps.tempGoods&&cleverapps.tempGoods.updateInfo(e,!0)},lives:function(e){cleverapps.lives&&cleverapps.lives.updateInfo(e,!0)},missions:function(e){cleverapps.missionManager&&cleverapps.missionManager.updateInfo(e,!0)},piggybank:function(e){cleverapps.piggyBank&&cleverapps.piggyBank.updateInfo(e,!0)},starchests:function(e){cleverapps.starChest&&(cleverapps.starChest.locked=!0,cleverapps.starChest.setStars(e.stars),cleverapps.starChest.save(!1),cleverapps.starChest.changeLockedListener())},packs:function(e){cleverapps.packManager&&(cleverapps.packManager.used=e.used,cleverapps.packManager.save(!1))},dailytasks:function(e){cleverapps.dailyTasks&&(cleverapps.dailyTasks.load(e),cleverapps.dailyTasks.save(!1))},gun:function(e){cleverapps.gun&&cleverapps.gun.updateInfo(e,!0)},heroes:function(e){
"undefined"!=typeof match3&&match3&&match3.heroes&&match3.heroes.updateInfo(e,!0)},subscription:function(e){cleverapps.subscription&&cleverapps.subscription.updateInfo(e,!0)},userdailycup:function(e){cleverapps.dailyCup&&cleverapps.dailyCup.updateInfo(e,!0)},userweeklycup:function(e){cleverapps.weeklyCup&&cleverapps.weeklyCup.updateInfo(e,!0)},forces:function(e){cleverapps.forces&&cleverapps.forces.updateInfo(e,!0)},metha:function(e){cleverapps.metha.getType()!==Metha.HOSE&&cleverapps.metha.getMainObject().updateInfo&&cleverapps.metha.getMainObject().updateInfo(e)},cookiejar:function(e){levels&&levels.cookieJar&&levels.cookieJar.updateValue(e,!0)},competitionstatistics:function(e){cleverapps.competitionStatistics&&cleverapps.competitionStatistics.updateInfo(e,!0)},cardskins:function(e){cleverapps.cardSkins&&cleverapps.cardSkins.updateInfo(e,!0)}}};if(cleverapps.Synchronizer=function(){this._session="a";var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SESSION_SAVE_KEY,{raw:!0
});null!=e&&(this._session=e),this._syncIn=new cleverapps.SyncIn,this._syncOut=new cleverapps.SyncOut,this._syncInProgress=!1,this._needResync=!1,this._syncId=0,this._clientSessionExpired=!1,this.synced=!1,cleverapps.DataLoader.checkClientSession()||this.clientSessionExpired()},cleverapps.Synchronizer.prototype._startCheckInterval=function(){if(!this._checkIntervalRunned){this._checkIntervalRunned=!0;var e=0;return setInterval(function(){this.synced&&e%15!=0||this.syncWhenReady(),e++}.bind(this),6e4),!0}return!1},cleverapps.Synchronizer.prototype.needClientSessionExpiredWindow=function(){return this._clientSessionExpired},cleverapps.Synchronizer.prototype.showClientSessionExpiredWindow=function(){cleverapps.metha.display({focus:"clientSessionExpired",action:function(){new RestartWindow({title:"ClientSessionExpired.title",contentMessage:"ClientSessionExpired.message"})}})},cleverapps.Synchronizer.prototype.clientSessionExpired=function(){this._clientSessionExpired||(this.synced=!1,
this._clientSessionExpired=!0,cleverapps.allInitialized&&(cleverapps.metha.isFocused()||this.showClientSessionExpiredWindow()))},cleverapps.Synchronizer.prototype.reset=function(){this.synced=!1,this._loadedSession=void 0,this._loadedSync=void 0,this._session="a",this._syncInProgress=!1,this._needResync=!1,cc.sys.localStorage.removeItem(cleverapps.DataLoaderTypes.SESSION_SAVE_KEY),this._syncOut.reset()},cleverapps.Synchronizer.prototype.syncWhenReady=function(){cleverapps.DataLoader.checkClientSession(),this._syncInProgress?this._needResync=!0:this._sync()},cleverapps.Synchronizer.prototype.addUpdateTask=function(e){cleverapps.flags.norest||("users"!==e&&cleverapps.user.incProgressCompare(),this._syncOut.addUpdateTask(e))},cleverapps.Synchronizer.prototype.on=function(){this._clientSessionExpired||(void 0!==this._loadedSession&&(this._session=this._loadedSession,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SESSION_SAVE_KEY,this._session,{raw:!0}),
cleverapps.DataLoader.processSaveQueue()),this._loadedSession=void 0,this._loadedSync=void 0,this.synced=!0,this._syncOut.run(),this._onSyncLoaded(),this.onceSyncCompletedListener&&(this.onceSyncCompletedListener(),this.onceSyncCompletedListener=void 0),this._needResync&&(this._needResync=!1,this.syncWhenReady()))},cleverapps.Synchronizer.prototype._getPath=function(e){return"/"+e+"/"+cleverapps.user.id+"/"+this._session},cleverapps.Synchronizer.prototype._syncCallback=function(e){var t=this._syncId;return function(){this._syncId!==t||this._clientSessionExpired||e.apply(this,arguments)}.bind(this)},cleverapps.Synchronizer.prototype._sync=function(){if(!this._syncInProgress&&!this._clientSessionExpired){var t=this._startCheckInterval();this._syncId++,this._syncInProgress=!0;var i=this.synced;this.synced=!1;var s=cleverapps.social.getAccessToken()||"undefined",e=this._getPath("newsync")+"/"+s,n={episode:levels.user.episode,level:levels.user.level,progress:levels.user.progress,
progressCompare:cleverapps.user.progressCompare,localStorageEnabled:cleverapps.DataLoader.enabled,localStorageCorrupted:cleverapps.DataLoader.corrupted},o=this._syncCallback(function(e){this._syncInProgress=!1,this._loadedSession=e.key,this._loadedSync=e.sync,void 0!==this._loadedSession?this._loadedSync?this._syncIn.process():this._syncOut.process():this.on()}).bind(this),a=this._syncCallback(function(e){if(this._syncInProgress=!1,e&&403===e.status){if("undefined"===s&&cleverapps.social.getAccessToken())return void this.syncWhenReady();cleverapps.social.isLoggedIn()||(this.wantsSocialConnectWindow=!0,this.displaySocialConnectWindow())}else(t||i)&&setTimeout(function(){cleverapps.Notification.create("messages:Synchronizer.ErrorSavingProgress")},t?2500:0);this._onSyncLoaded()}).bind(this);cleverapps.RestClient.post(e,n,o,a)}},cleverapps.Synchronizer.prototype.displaySocialConnectWindow=function(){cleverapps.metha.display({focus:"SynchronizerCheckConnection",actions:[function(e){
cleverapps.social.checkConnection(function(){e(),this.syncWhenReady()}.bind(this),e,{withWindow:!0,errorMessage:"messages:FbConnectWindow.TryAgain"})}.bind(this),function(e){this.wantsSocialConnectWindow=!1,e()}.bind(this)]})},cleverapps.Synchronizer.prototype._onSyncLoaded=function(){this._onceFirstSyncCompletedListener&&(this._onceFirstSyncCompletedListener(),this._onceFirstSyncCompletedListener=void 0)},cleverapps.Synchronizer.SESSION_EXPIRED=99,cleverapps.SyncIn=function(){},cleverapps.SyncIn.prototype.executeSync=function(e){for(var t in cleverapps.synchronizer._clientSessionExpired&&(cleverapps.DataLoader.resetClientSession(),cleverapps.synchronizer._clientSessionExpired=!1),cleverapps.synchronizer._syncOut.reset(),cleverapps.sideBar.reset(),e){var i=e[t],s=CustomSyncers.importerData[t];s?s(i):console.log("No importer for "+t)}cleverapps.DataLoader.processSaveQueue()},cleverapps.SyncIn.prototype.sceneRefresh=function(){cleverapps.flags.reset(),levels&&(levels.reset(),
cleverapps.windows.reset(),cleverapps.scenes.reset(),cleverapps.isKnockoutGame()&&cleverapps.metha.getMainObject().knockoutGame.stopRumble(),cleverapps.metha.distract({focus:"afterReloadWindow",action:function(e){cleverapps.metha.gotoMainScene(e)}}))},cleverapps.SyncIn.prototype.needShowReloadWindow=function(){return cleverapps.synchronizer._loadedSync},cleverapps.SyncIn.prototype.showReloadWindow=function(){cleverapps.metha.display({focus:"ReloadWindow",action:function(e){Game.currentGame&&Game.currentGame.stop(),new ReloadWindow(function(){this.needShowReloadWindow()?(this.executeSync(cleverapps.synchronizer._loadedSync),cleverapps.synchronizer.on(),this.sceneRefresh()):e()}.bind(this))}.bind(this)})},cleverapps.SyncIn.prototype.process=function(){cleverapps.scenes.isLoaderScene()&&!cleverapps.allInitialized?(this.executeSync(cleverapps.synchronizer._loadedSync),cleverapps.synchronizer.on()):cleverapps.metha.isFocused()||this.showReloadWindow()},cleverapps.SyncOut=function(){
this.task={},this.currentTask={},this.onTasksEmptyListener=function(){},this.inProgress=!1,this.sendNextUpdate=cleverapps.accumulate(cleverapps.SyncOut.ACCUMULATE_TIMEOUT,this._sendUpdateInner.bind(this)),(cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SYNC)||[]).forEach(function(e){CustomSyncers.extractors[e]&&(this.task[e]=!0)},this)},cleverapps.SyncOut.prototype.run=function(){this.sendNextUpdate()},cleverapps.SyncOut.prototype.save=function(){var e=cleverapps.extend(this.currentTask,this.task);cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SYNC,Object.keys(e))},cleverapps.SyncOut.prototype.reset=function(){this.task={},this.currentTask={},this.save()},cleverapps.SyncOut.prototype.nextTask=function(){this.currentTask=this.task,this.task={}},cleverapps.SyncOut.prototype.addUpdateTask=function(e){CustomSyncers.extractors[e]&&!this.task[e]&&(this.task[e]=!0,this.save(),cleverapps.synchronizer.synced&&cleverapps.allInitialized&&this.sendNextUpdate())},
cleverapps.SyncOut.prototype.onSuccess=function(e){if(this.inProgress=!1,cleverapps.synchronizer.synced){if(e.error&&e.error===cleverapps.Synchronizer.SESSION_EXPIRED)return console.log("onUpdate: session needs renewal"),cleverapps.synchronizer.reset(),void cleverapps.synchronizer.syncWhenReady();0===e&&console.log("error saving object"),this.currentTask={},this.save(),this.sendNextUpdate()}},cleverapps.SyncOut.prototype.onFailure=function(e){this.inProgress=!1,cleverapps.synchronizer.synced&&(console.log("Failure: ",e),this.task=cleverapps.extend(this.currentTask,this.task),this.currentTask={},setTimeout(this.sendNextUpdate.bind(this),cleverapps.SyncOut.RETRY_TIMEOUT))},cleverapps.SyncOut.prototype._sendUpdateInner=function(){cleverapps.DataLoader.onSaved(function(){if(!this.inProgress&&cleverapps.synchronizer.synced&&(cleverapps.DataLoader.checkClientSession(),!cleverapps.synchronizer._clientSessionExpired))if(this.nextTask(),0!==Object.keys(this.currentTask).length){var e={};for(
var t in this.currentTask){var i=CustomSyncers.extractors[t]();e[t]=i}this.inProgress=!0,console.log("Sending update ",e),cleverapps.RestClient.post(cleverapps.synchronizer._getPath("sync"),e,this.onSuccess.bind(this),this.onFailure.bind(this))}else this.onTasksEmptyListener()}.bind(this))},cleverapps.SyncOut.prototype.process=function(){for(var e in CustomSyncers.extractors)CustomSyncers.extractors[e]&&!this.task[e]&&(this.task[e]=!0);cleverapps.synchronizer.on()},cleverapps.SyncOut.RETRY_TIMEOUT=6e4,cleverapps.SyncOut.ACCUMULATE_TIMEOUT=2e3,RewardsConfig={Packs:[],Tournament:{},DailyCup:{}},"board"!==cleverapps.config.type&&"spades"!==cleverapps.config.name||(RewardsConfig={Tournament:{prepareByRich:!0,places:[{gold:300},{gold:250},{gold:200},{gold:100},{gold:50}]},Sale:{gold:500},TreasureSearch:{prepareByRich:!0,gold:100},StickersCollection:{prepareByRich:!0,gold:100},DailyTask:{prepareByRich:!0,low:[{gold:80}],mid:[{gold:120}],hard:[{gold:160}]},DailyCup:{places:[{gold:400},{
gold:250},{gold:150},{gold:50},{gold:50},{gold:50},{gold:50},{gold:50},{gold:50},{gold:50}]},Packs:[{gold:800},{gold:2600},{gold:17e3}],Subscription:{gold:600},MiniGame:[{gold:50},{gold:100}],MiniGameNovice:[{gold:50}],Favorite:{gold1800:{gold:300},gold3800:{gold:600},gold6000:{gold:1200},gold25000:{gold:5e3}}}),"match3"===cleverapps.config.type)var RewardsConfig={MiniGame:[{gold:50},{boosters:{5:1},gold:50},{boosters:{5:1}},{gold:50},{boosters:{6:1}},{boosters:{6:1},gold:50},{gold:50},{boosters:{7:1}},{boosters:{7:1},gold:50}],MiniGameBeginner:[{unlimitedLives:"30 minutes"}],MiniGameNovice:[{gold:50}],Tournament:{prepareByRich:!0,places:[{boosters:{5:2,6:2,7:2},unlimitedLives:"12 hours"},{boosters:{6:1,7:1},unlimitedLives:"6 hour"},{boosters:{5:1,6:1},unlimitedLives:"1 hour"},{boosters:{6:1},unlimitedLives:"45 minutes",exp:5},{boosters:{5:1},unlimitedLives:"30 minutes",exp:3}]},Sale:{boosters:{0:1,1:1,2:1}},DailyTask:{prepareByRich:!0,low:[{boosters:{5:1}},{gold:50},{stars:3}],mid:[{
boosters:{0:1},gold:50,exp:1},{boosters:{1:1},exp:1},{stars:4,gold:50,exp:1}],hard:[{boosters:{2:1},gold:50,exp:3},{boosters:{0:1,1:1},gold:50,exp:3},{boosters:{0:1,1:1,2:1},exp:3}]},TreasureSearch:{prepareByRich:!0,unlimitedLives:"12 hours",stars:10,exp:20},DailyCup:{places:[{unlimitedLives:"1 day",boosters:{5:5,6:5,7:5}},{unlimitedLives:"6 hours",boosters:{5:4,6:4,7:4}},{unlimitedLives:"3 hours",boosters:{5:3,6:3,7:3}},{unlimitedLives:"2 hour",boosters:{5:1,6:1,7:1}},{boosters:{5:1,6:1},unlimitedLives:"2 hour"},{boosters:{5:1,6:1},unlimitedLives:"2 hour"},{boosters:{5:1,6:1},unlimitedLives:"2 hour"},{boosters:{5:1},unlimitedLives:"1 hour"},{boosters:{5:1},unlimitedLives:"1 hour"},{boosters:{5:1},unlimitedLives:"1 hour"}]},Packs:[{boosters:{0:1,1:1,2:1},gold:300,unlimitedLives:"1 day"},{boosters:{2:3},gold:1800,unlimitedLives:"3 day"},{boosters:{0:9,1:9,2:9},gold:12e3,unlimitedLives:"9 day"}],Subscription:{gold:300,exp:1,unlimitedLives:"2 hours",randomBoosters:{types:[0,1,2],amount:3}
},Favorite:{sweetPack:{unlimitedLives:"12 hours",exp:3,stars:2},jamPack:{unlimitedLives:"1 day",exp:5,stars:4},tastyPack:{unlimitedLives:"2 days",exp:15,stars:6},honeyPack:{unlimitedLives:"3 days",exp:20,stars:8},epicPack:{unlimitedLives:"5 days",exp:40,stars:12},gold1800:{unlimitedLives:"1 day",exp:5,stars:4},gold3800:{unlimitedLives:"2 day",exp:15,stars:6},gold6000:{unlimitedLives:"3 day",exp:20,stars:8},gold25000:{unlimitedLives:"5 day",exp:40,stars:10}}};-1!==["tripeaks"].indexOf(cleverapps.config.name)&&(RewardsConfig={Sale:{gold:500},MiniGame:[{gold:50,randomBoosters:{types:[10,11,12],amount:1}},{gold:50,randomBoosters:{types:[10,11,12],amount:2}},{randomBoosters:{types:[10,11,12],amount:1}},{randomBoosters:{types:[10,11,12],amount:2}}],MiniGameBeginner:[{gold:50},{gold:100}],MiniGameNovice:[{gold:50,randomBoosters:{types:[10,11,12],amount:1}}],TreasureSearch:{unlimitedLives:"12 hours",boosters:{10:1,11:1,12:1}},Tournament:{prepareByRich:!0,places:[{boosters:{10:2,11:2,12:2},
unlimitedLives:"3 hours"},{boosters:{11:2,12:2},unlimitedLives:"1 hour"},{boosters:{10:1,11:1,12:1},unlimitedLives:"30 minutes"},{boosters:{11:1,12:1},unlimitedLives:"15 minutes"},{boosters:{10:1,11:1},unlimitedLives:"15 minutes"}]},DailyTask:{low:[{unlimitedLives:"15 minutes"}],mid:[{boosters:{11:1},gold:80}],hard:[{boosters:{12:2},gold:160,unlimitedLives:"15 minutes"}]},DailyCup:{places:[{unlimitedLives:"1 day",boosters:{10:5,11:5,12:5}},{unlimitedLives:"6 hours",boosters:{10:4,11:4,12:4}},{unlimitedLives:"3 hours",boosters:{10:3,11:3,12:3}},{unlimitedLives:"1 hour",boosters:{10:2,11:2,12:2}},{unlimitedLives:"30 minutes",boosters:{10:1,11:1,12:1}},{unlimitedLives:"30 minutes",boosters:{10:1,11:1,12:1}},{unlimitedLives:"30 minutes",boosters:{10:1,11:1,12:1}},{unlimitedLives:"15 minutes",boosters:{10:1,11:1,12:1}},{unlimitedLives:"15 minutes",boosters:{10:1,11:1,12:1}},{unlimitedLives:"15 minutes",boosters:{10:1,11:1,12:1}}]},Packs:[{boosters:{0:0,1:0,2:0,10:2,11:2,12:2},gold:200,
unlimitedLives:void 0},{boosters:{0:0,1:0,2:0,10:6,11:6,12:6},gold:800},{boosters:{0:0,1:0,2:0,10:30,11:30,12:30},gold:8e3}],Subscription:{gold:250,unlimitedLives:"3 hours",boosters:{10:2,11:2,12:2}},Favorite:{gold1800:{unlimitedLives:"1 day",gold:150},gold3800:{unlimitedLives:"2 day",gold:300},gold6000:{unlimitedLives:"3 day",gold:600},gold25000:{unlimitedLives:"5 day",gold:2500},sweetPack:{unlimitedLives:"30 minutes",boosters:{10:1,11:1,12:1}},jamPack:{gold:250,boosters:{10:1,11:1,12:1},unlimitedLives:"2 hours"},tastyPack:{gold:550,boosters:{10:2,11:2,12:2},unlimitedLives:"6 hours"},honeyPack:{gold:750,boosters:{10:3,11:3,12:3},unlimitedLives:"12 hours"},epicPack:{gold:5e3,boosters:{10:6,11:6,12:6},unlimitedLives:"1 day"}}}),"differences"===cleverapps.config.type&&(RewardsConfig={Tournament:{prepareByRich:!0,places:[{boosters:{8:3,9:3},unlimitedLives:"3 hours"},{boosters:{8:2,9:2},unlimitedLives:"1 hour"},{boosters:{8:1,9:1},unlimitedLives:"30 minutes"},{boosters:{8:1},
unlimitedLives:"15 minutes"},{boosters:{9:1},unlimitedLives:"15 minutes"}]},Sale:{boosters:{8:1,9:1}},DailyTask:{low:[{unlimitedLives:"15 minutes"}],mid:[{gold:80,boosters:{8:1}}],hard:[{gold:160,unlimitedLives:"15 minutes",boosters:{8:1,9:1}}]},MiniGame:[{gold:50,randomBoosters:{types:[8,9],amount:1}},{gold:100}],MiniGameBeginner:[{gold:50,randomBoosters:{types:[8,9],amount:1}},{gold:100}],MiniGameNovice:[{gold:50,randomBoosters:{types:[8,9],amount:1}}],TreasureSearch:{unlimitedLives:"12 hours",boosters:{8:1,9:2}},DailyCup:{places:[{unlimitedLives:"1 day",boosters:{2:1}},{unlimitedLives:"6 hours",boosters:{1:1}},{unlimitedLives:"3 hours",boosters:{0:1}},{unlimitedLives:"1 hour"},{unlimitedLives:"30 minutes"},{unlimitedLives:"30 minutes"},{unlimitedLives:"30 minutes"},{unlimitedLives:"15 minutes"},{unlimitedLives:"15 minutes"},{unlimitedLives:"15 minutes"}]},Packs:[{boosters:{0:0,1:0,2:0,8:2,9:2},gold:200},{boosters:{0:0,1:0,2:0,8:6,9:6},gold:800},{boosters:{0:0,1:0,2:0,8:30,9:30},
gold:8e3}],Subscription:{unlimitedLives:"3 hours",gold:250,boosters:{8:3,9:3}},WeeklyCup:{places:[{gold:3e3},{gold:2e3},{gold:1e3},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200}]}}),"olympics"===cleverapps.config.name&&(RewardsConfig.Subscription={gold:600,unlimitedLives:"3 hours"},RewardsConfig.TreasureSearch={unlimitedLives:"12 hours"},RewardsConfig.WeeklyCup={places:[{gold:3e3},{gold:2e3},{gold:1e3},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200}]},RewardsConfig.Favorite={gold1800:{unlimitedLives:"1 day",gold:150},gold3800:{unlimitedLives:"2 day",gold:300},gold6000:{unlimitedLives:"3 day",gold:600},gold25000:{unlimitedLives:"5 day",gold:2500}}),"scramble"===cleverapps.config.name&&(RewardsConfig.Tournament={prepareByRich:!0,places:[{boosters:{13:2,14:2,15:2}},{boosters:{14:2,15:2}},{boosters:{13:1,14:1,15:1}},{boosters:{14:1,15:1}},{boosters:{13:1,14:1}}]},RewardsConfig.Packs=[{boosters:{13:2,14:2,15:2},gold:200},{boosters:{
13:6,14:6,15:6},gold:800},{boosters:{13:30,14:30,15:30},gold:8e3}],RewardsConfig.DailyTask={low:[{boosters:{13:1}}],mid:[{boosters:{14:1},gold:80}],hard:[{boosters:{15:2},gold:160}]},RewardsConfig.DailyCup={places:[{boosters:{13:5,14:5,15:5},gold:300},{boosters:{13:4,14:4,15:4},gold:200},{boosters:{13:3,14:3,15:3},gold:100},{boosters:{13:2,14:2,15:2},gold:50},{boosters:{13:1,14:1,15:1},gold:50},{boosters:{13:1,14:1,15:1},gold:50},{boosters:{13:1,14:1,15:1},gold:50},{boosters:{13:1,14:1,15:1}},{boosters:{13:1,14:1,15:1}},{boosters:{13:1,14:1,15:1}}]},RewardsConfig.MiniGame=[{gold:50,randomBoosters:{types:[14,15],amount:1}},{gold:50,randomBoosters:{types:[14,15],amount:2}},{randomBoosters:{types:[14,15],amount:1}},{randomBoosters:{types:[14,15],amount:2}}],RewardsConfig.MiniGameBeginner=[{gold:50},{gold:100}],RewardsConfig.MiniGameNovice=[{gold:50,randomBoosters:{types:[13,14,15],amount:1}}],RewardsConfig.Subscription={gold:250,boosters:{13:2,14:2,15:2}},
RewardsConfig.Favorite.sweetPack={boosters:{13:1,14:1,15:1}},RewardsConfig.Favorite.jamPack={gold:250,boosters:{13:1,14:1,15:1}},RewardsConfig.Favorite.tastyPack={gold:550,boosters:{13:2,14:2,15:2}},RewardsConfig.Favorite.honeyPack={gold:750,boosters:{13:3,14:3,15:3}},RewardsConfig.Favorite.epicPack={gold:5e3,boosters:{13:6,14:6,15:6}},RewardsConfig.TreasureSearch={gold:100,boosters:{13:1,14:1,15:1}}),-1!==["heroes","runes","riddles","adventure"].indexOf(cleverapps.config.name)&&(RewardsConfig.Packs=[{boosters:{5:1,6:1,7:1},gold:500,unlimitedLives:"1 day"},{boosters:{5:2,6:2,7:2},gold:1800,unlimitedLives:"3 day"},{boosters:{5:14,6:14,7:14},gold:12e3,unlimitedLives:"9 day"}]);var RewardsHelper={iconByRewardName:function(e){return RewardsHelper.ICONS[e]},textByRewardName:function(e,t,i){var s=""+t;return"unlimitedLives"===e?s=Messages.get(Product.FormatUnlimitedLives(t,i.short).title):-1===["stars","exp","gold"].indexOf(e)&&isNaN(parseInt(e))||(s=(i.itemsPrefix||"")+s),s},
getDisplayData:function(e,t){t=t||{};var i={};for(var s in e)if("boosters"===s)for(var n in e.boosters)i["booster_"+n]={img:RewardsHelper.iconByRewardName(n),txt:RewardsHelper.textByRewardName(n,e.boosters[n],t)};else i[s]={img:RewardsHelper.iconByRewardName(s),txt:RewardsHelper.textByRewardName(s,e[s],t)};return i}};RewardsHelper.ICONS={unlimitedLives:bundles.reward_icons.frames.life_unlim_small,gold:bundles.reward_icons.frames.gold_small_png,stars:bundles.reward_icons.frames.stars_png,exp:bundles.reward_icons.frames.reward_exp_png,0:bundles.reward_icons.frames.cellbooster,1:bundles.reward_icons.frames.linebooster,2:bundles.reward_icons.frames.colorbooster,3:bundles.reward_icons.frames.gold_small_png,4:bundles.reward_icons.frames.joker_png,5:bundles.reward_icons.frames.heroes_png,6:bundles.reward_icons.frames.moves_png,7:bundles.reward_icons.frames.multicolor_png,8:bundles.reward_icons.frames.hat,9:bundles.reward_icons.frames.pot,10:bundles.reward_icons.frames.magnet_small_png,
11:bundles.reward_icons.frames.dice_small_png,12:bundles.reward_icons.frames.joker_small_png,13:bundles.reward_icons.frames.highlight,14:bundles.reward_icons.frames.eye,15:bundles.reward_icons.frames.hint};var RewardedAdsManager=function(){RewardedAdsManager.IsEnabled()&&(cc.sys.isNative&&(RewardedAdsManager.AVAILABLE={episode:1,level:5}),"undefined"==typeof sdkbox&&(sdkbox={}),PlingaAds.isAppropriate()?sdkbox.PluginSdkboxAds=new PlingaAds:WebViewAds.isAppropriate()?sdkbox.PluginSdkboxAds=new WebViewAds:OKAppAds.isAppropriate()?sdkbox.PluginSdkboxAds=new OKAppAds:OKAds.isAppropriate()?sdkbox.PluginSdkboxAds=new OKAds:VKAds.isAppropriate()?sdkbox.PluginSdkboxAds=new VKAds:cleverapps.Instant.isAppropriate()?sdkbox.PluginSdkboxAds=new InstantAds:VideoAds.isAppropriate()&&(sdkbox.PluginSdkboxAds=new VideoAds),this.onLoadedListeners={},this.onStartPlayListeners={},this.onEndPlayListeners={},this.onRewardListeners={},this.load(),sdkbox.PluginSdkboxAds.setListener({onAdAction:function(e,t,i){
switch(console.log("RewardedAdsManager onAdAction "+JSON.stringify(arguments)),i){case RewardedAdsManager.AD_ACTION_TYPE.LOADED:cleverapps.eventLogger.logEvent(cleverapps.EVENTS.AD_READY+"_"+t),cleverapps.playSession.set(cleverapps.EVENTS.AD_READY+"_"+t,!0),this.runListeners(this.onLoadedListeners,t);break;case RewardedAdsManager.AD_ACTION_TYPE.LOAD_FAILED:setTimeout(this.cacheNextAd.bind(this,t),cleverapps.parseInterval(RewardedAdsManager.NEXT_AD_ERROR_DELAY));break;case RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED:case RewardedAdsManager.AD_ACTION_TYPE.REWARD_STARTED:cleverapps.audio.pause(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.AD_START+"_"+t),t===RewardedAdsManager.INTERSTITIAL&&cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.WATCH_ADS),this.runListeners(this.onStartPlayListeners,t);break;case RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED:case RewardedAdsManager.AD_ACTION_TYPE.AD_CANCELED:case RewardedAdsManager.AD_ACTION_TYPE.REWARD_ENDED:
case RewardedAdsManager.AD_ACTION_TYPE.REWARD_CANCELED:cleverapps.audio.resume(),setTimeout(this.cacheNextAd.bind(this,t),cleverapps.parseInterval(RewardedAdsManager.NEXT_AD_DELAY)),this.runListeners(this.onEndPlayListeners,t)}}.bind(this),onRewardAction:function(e,t,i,s){console.log("RewardedAdsManager onRewardAction "+JSON.stringify(arguments)),cleverapps.history.add("video",1),RewardedAdsManager.rewardTime=Date.now(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.AD_FINISH+"_"+t),cleverapps.user.channel&&cleverapps.eventLogger.logEvent("ad_r_"+cleverapps.user.channel),cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.WATCH_ADS),setTimeout(function(){this.runListeners(this.onRewardListeners,t)}.bind(this),0),cleverapps.playSession.inc(cleverapps.EVENTS.REWARDED_WATCHED),this.data.reward[t]=Date.now(),this.save()}.bind(this)}),this.cacheQueue={},setInterval(this.checkCacheQueue.bind(this),cleverapps.parseInterval("1 minute")))};RewardedAdsManager.prototype.init=function(){
RewardedAdsManager.IsEnabled()&&sdkbox.PluginSdkboxAds&&sdkbox.PluginSdkboxAds.init(function(){RewardedAdsManager.ACTIVE_ADS.forEach(this.cacheNextAd.bind(this))}.bind(this))},RewardedAdsManager.prototype.checkCacheQueue=function(){var e=this.cacheQueue;this.cacheQueue={},Object.keys(e).forEach(function(e){this.cacheNextAd(e)}.bind(this))},RewardedAdsManager.prototype.cacheNextAd=function(e){e=e||RewardedAdsManager.REWARDED,this.canCache(e)?(console.log("RewardedAdsManager caching "+e),sdkbox.PluginSdkboxAds.cache(RewardedAdsManager.ADMOB,e)):this.cacheQueue[e]=!0},RewardedAdsManager.prototype.isAvailable=function(e){return e=e||RewardedAdsManager.REWARDED,levels.user.checkAvailable(RewardedAdsManager.AVAILABLE)&&RewardedAdsManager.IsEnabled()&&sdkbox.PluginSdkboxAds.isAvailable(e)},RewardedAdsManager.prototype.play=function(e,t){this.isAvailable(e)?("function"==typeof t&&(this.onRewardListeners[e]=t),e=e||RewardedAdsManager.REWARDED,sdkbox.PluginSdkboxAds.playAd("AdMob",e)
):cleverapps.Notification.create("messages:AdsUnavailable")},RewardedAdsManager.prototype.canCache=function(e){return e=e||RewardedAdsManager.REWARDED,!(!RewardedAdsManager.IsEnabled()||-1===RewardedAdsManager.ACTIVE_ADS.indexOf(e)||!levels.user.checkAvailable(RewardedAdsManager.AVAILABLE))&&(e===RewardedAdsManager.REWARDED||!cleverapps.paymentsHistory.isPayer()&&(!((this.data.reward[RewardedAdsManager.REWARDED]||0)+cleverapps.parseInterval(RewardedAdsManager.INTERSTITIAL_REWARD_INTERVAL)>Date.now())&&(!((this.data.reward[RewardedAdsManager.INTERSTITIAL]||0)+cleverapps.parseInterval(RewardedAdsManager.INTERSTITIAL_INTERVAL)>Date.now())&&0<RewardedAdsManager.INTERSTITIAL_PROB[Math.min(levels.user.episode,RewardedAdsManager.INTERSTITIAL_PROB.length-1)])))},RewardedAdsManager.prototype.showInterstitial=function(){if(this.isAvailable(RewardedAdsManager.INTERSTITIAL)&&this.canCache(RewardedAdsManager.INTERSTITIAL)){var e=RewardedAdsManager.INTERSTITIAL_PROB[Math.min(levels.user.episode,
RewardedAdsManager.INTERSTITIAL_PROB.length-1)];Math.random()<e&&(this.play(RewardedAdsManager.INTERSTITIAL),this.data.reward[RewardedAdsManager.INTERSTITIAL]=Date.now(),this.save())}},RewardedAdsManager.prototype.runListeners=function(e,t){for(var i in e)0===i.indexOf(t)&&e[i]()},RewardedAdsManager.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.REWARDED_ADS_MANAGER);e||(e={}),e.reward||(e.reward={}),this.data=e},RewardedAdsManager.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.REWARDED_ADS_MANAGER,this.data)},RewardedAdsManager.ADMOB="AdMob",RewardedAdsManager.REWARDED="rewarded",RewardedAdsManager.INTERSTITIAL="interstitial",RewardedAdsManager.ACTIVE_ADS=[RewardedAdsManager.REWARDED,RewardedAdsManager.INTERSTITIAL],RewardedAdsManager.NEXT_AD_DELAY="10 seconds",RewardedAdsManager.NEXT_AD_ERROR_DELAY="3 minutes",RewardedAdsManager.AVAILABLE={episode:0,level:10},RewardedAdsManager.INTERSTITIAL_PROB=[0,0,.3,.3,.5,.5,
.7,1],RewardedAdsManager.INTERSTITIAL_REWARD_INTERVAL="3 day",RewardedAdsManager.INTERSTITIAL_INTERVAL="10 minutes",RewardedAdsManager.AD_ACTION_TYPE={LOADED:0,LOAD_FAILED:1,CLICKED:2,REWARD_STARTED:3,REWARD_ENDED:4,REWARD_CANCELED:5,AD_STARTED:6,AD_CANCELED:7,AD_ENDED:8,ADACTIONTYPE_UNKNOWN:9},RewardedAdsManager.IsEnabled=function(){var e=cleverapps.User.calcSource();if(-1===["huzcom","pliega"].indexOf(e)&&(!cleverapps.flags||!cleverapps.flags.noads||cleverapps.config.debugMode))return cc.sys.isNative||cleverapps.isLocalhost()||-1!==["web_ok","mobile_ok","web_vk","mobile_vk","plinga","instant"].indexOf(e)};var AdIcon=cleverapps.UI.Button.extend({ctor:function(e){this.rewardedHintAd=e;var t=cleverapps.styles.AdIcon,i=new cc.Node;i.setAnchorPoint2();var s=new cc.Sprite(bundles.game.frames.video);i.addChild(s),s.setScale2(t.icon.scale||1),s.setPositionRound(t.icon),this._super({content:i,button_png:t.button.button_png,button_on_png:t.button.button_on_png,
button_off_png:t.button.button_off_png,width:t.width[cleverapps.wideMode.mode]*resolutionScale||t.width,height:t.height[cleverapps.wideMode.mode]*resolutionScale||t.height,onClicked:this.rewardedHintAd.onClick.bind(this.rewardedHintAd)}),this.setLocalZOrder(t.zOrder),this.baseScale=cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?t.phone.scale:1,this.setScale(this.baseScale);var n=cleverapps.UI.getSceneSize();this.setPositionRound(t.x[cleverapps.wideMode.mode],t.y[cleverapps.wideMode.mode],n),cleverapps.UI.makeHideable(this,t.hideDirection&&t.hideDirection[cleverapps.wideMode.mode]),"differences"!==cleverapps.config.name&&cleverapps.metha.registerControl("rewardedHintAd",function(e){e?this.show():this.hide()}.bind(this)),this.rewardedHintAd.enabled||this.disable(),this.rewardedHintAd.on("disable",this.createListener(this.disable.bind(this))),this.rewardedHintAd.on("enable",this.createListener(this.enable.bind(this)))}});cleverapps.styles.AdIcon={zOrder:0,phone:{scale:.7},icon:{
x:{align:"center"},y:{align:"center"}},button:{button_png:bundles.game.frames.hint_button_png,button_on_png:bundles.game.frames.hint_on_button_png},x:[{align:"right",dx:-10},{align:"right",dx:-10},{align:"right",dx:-10}],y:[{align:"bottom",dy:420},{align:"bottom",dy:360},{align:"bottom",dy:360}],width:180,height:110};var FlyingHint=cc.Node.extend({ctor:function(e){this._super(),cleverapps.config.debugMode&&(FlyingHint.TIMEOUT=30),this.setAnchorPoint2(),this.rewardedHintAd=e;var t=cleverapps.styles.FlyingHint;this.setContentSize2(t),this.animation=new cleverapps.Spine(bundles.game.jsons.flying_hint_json),this.animation.setSkin("normal"),this.addChild(this.animation),this.animation.setPositionRound(t.animation),this.setVisible(!1),cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(this.setScale(t.mobile.scale),this.baseScale=this.scale),this.onMouseOver=function(){this.animation.setSkin("hover")}.bind(this),this.onMouseOut=function(){this.animation.setSkin("normal")}.bind(this),
cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,this.rewardedHintAd.onClick.bind(this.rewardedHintAd)),this.setLocalZOrder(10),cleverapps.metha.registerControl("rewardedHintAd",function(e){this.enabled&&this.setVisible(e)}.bind(this)),this.enable(),this.rewardedHintAd.on("disable",this.createListener(this.disable.bind(this))),this.rewardedHintAd.on("enable",this.createListener(this.enable.bind(this))),this.rewardedHintAd.on("activate",this.createListener(this.disappear.bind(this)))},disappear:function(){this.stopAllActions(),this.enabled=!1,this.animation.setAnimation(0,"application",!1),this.animation.setCompleteListener(function(){this.setVisible(!1)}.bind(this))},runMoveAnimation:function(){var e=cc.director.getRunningScene().scene,t=cleverapps.styles.FlyingHint;this.setPositionRound(e.width/2,e.height/2+t.yOffset),this._runMoveAnimation(1,0)},_runMoveAnimation:function(e,t){if(t>FlyingHint.TOTAL_FLY_TIMEOUT)return this.disappear(),void this.runAction(new cc.Sequence(
new cc.DelayTime(1),new cc.Hide,new cc.DelayTime(FlyingHint.TIMEOUT),new cc.CallFunc(function(){this.enable()}.bind(this))));var i,s=cc.director.getRunningScene().scene,n=cleverapps.styles.FlyingHint,o=cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?n.mobile.xBorderOffset:n.xBorderOffset;0<e?(i=cc.p(s.width-o,this.y),this.animation.setScaleX(1)):(i=cc.p(o,this.y),this.animation.setScaleX(-1));var a=cleverapps.styles.FlyingHint.speed,r=cc.pDistance(this.getPosition(),i)/a,l=Math.round(r/7),c=new cc.MoveBy(r,cc.p(i.x-this.getPosition().x,0));if(0<l){for(var p=[],d=r/l/2,h=0;h<l;h++)p.push(new cc.MoveBy(d/2,cc.p(0,cleverapps.styles.FlyingHint.animation.dy/2))),p.push(new cc.MoveBy(d,cc.p(0,-cleverapps.styles.FlyingHint.animation.dy))),p.push(new cc.MoveBy(d/2,cc.p(0,cleverapps.styles.FlyingHint.animation.dy/2)));c=new cc.Spawn(c,new cc.Sequence(p))}this.runAction(new cc.Sequence(c,new cc.CallFunc(function(){this._runMoveAnimation(-e,t+r)}.bind(this))))},enable:function(){
this.rewardedHintAd.enabled&&(this.enabled=!0,this.stopAllActions(),this.setVisible(!cleverapps.metha.isFocused()),this.animation.setAnimationAndIdleAfter("appearance","idle"),this.runMoveAnimation())},disable:function(){this.enabled=!1,this.stopAllActions(),this.setVisible(!1)}});FlyingHint.IsAvailable=function(){return!cleverapps.flags.flyingHintsDisabled&&("stacks"===cleverapps.config.subtype||-1!==["olympics","crocword","wordsoup"].indexOf(cleverapps.config.name))},FlyingHint.TOTAL_FLY_TIMEOUT=45,FlyingHint.TIMEOUT=300,cleverapps.styles.FlyingHint={width:200,height:200,mobile:{xBorderOffset:160,scale:.8},animation:{x:{align:"center"},y:{align:"center",dy:-30},dy:60},yOffset:375,xBorderOffset:300,speed:80};var RewardedHintAd=function(e,t){cleverapps.EventEmitter.call(this),cleverapps.flags.reduceAds&&(RewardedHintAd.INTERVAL="20 minutes"),cleverapps.flags.videoAdsMainMonetization&&(RewardedHintAd.INTERVAL="5 minutes"),cleverapps.config.debugMode&&(
RewardedHintAd.INTERVAL="30 seconds",RewardedHintAd.START_PLAY_INTERVAL="30 seconds",RewardedHintAd.CHECK_INTERVAL="1 seconds"),FlyingHint.IsAvailable()&&(RewardedHintAd.GAME_START_DELAY="10 seconds"),this.game=e,this.onReward=t,this.game.counter.registerStage(1001,function(){this.ready&&this.enable()}.bind(this)),RewardedHintAd.IsAvailable()&&setTimeout(this.checkIfReady.bind(this),cleverapps.parseInterval(RewardedHintAd.GAME_START_DELAY)),RewardedAdsManager.IsEnabled()&&(cleverapps.rewardedAdsManager.onStartPlayListeners[RewardedAdsManager.REWARDED+"_adicon"]=this.startPlay.bind(this),"ios"===cleverapps.User.calcSource()&&(cleverapps.rewardedAdsManager.onEndPlayListeners[RewardedAdsManager.REWARDED+"_adicon"]=this.startPlay.bind(this)))};RewardedHintAd.prototype=Object.create(cleverapps.EventEmitter.prototype),(RewardedHintAd.prototype.constructor=RewardedHintAd).prototype.onClick=function(){this.enabled&&(this.trigger("activate"),FlyingHint.IsAvailable(
)?this.game.counter.setTimeout(function(){this.playAds()}.bind(this),1e3):this.playAds())},RewardedHintAd.prototype.playAds=function(){RewardedAdsManager.IsEnabled()?cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,this.reward.bind(this)):(this.startPlay(),this.reward())},RewardedHintAd.prototype.checkIfReady=function(){Game.currentGame===this.game&&(this.isReady()?(this.ready=!0,FlyingHint.IsAvailable()&&this.game.counter.isActive()||this.enable()):setTimeout(this.checkIfReady.bind(this),cleverapps.parseInterval(RewardedHintAd.CHECK_INTERVAL)))},RewardedHintAd.prototype.isReady=function(){return(cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.AD_ICON,{raw:!0})||0)<Date.now()&&(RewardedHintAd.debugHint||cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED))},RewardedHintAd.prototype.enable=function(){this.enabled||FlyingHint.IsAvailable()&&cleverapps.metha.isFocused()||(this.enabled=!0,this.trigger("enable"))},
RewardedHintAd.prototype.disable=function(){this.enabled&&(this.enabled=!1,this.trigger("disable"))},RewardedHintAd.prototype.reward=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.AD_ICON,Date.now()+cleverapps.parseInterval(RewardedHintAd.INTERVAL),{raw:!0}),this.onReward(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_HINT)},RewardedHintAd.prototype.startPlay=function(){this.enabled&&(cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.AD_ICON,Date.now()+cleverapps.parseInterval(RewardedHintAd.START_PLAY_INTERVAL),{raw:!0}),this.ready=!1,this.disable(),this.checkIfReady())},RewardedHintAd.IsAvailable=function(){return RewardedAdsManager.IsEnabled()&&levels.user.checkAvailable(RewardedAdsManager.AVAILABLE)&&cleverapps.paymentsHistory.classify()<=cleverapps.PaymentsHistory.PAYER_NORMAL},RewardedHintAd.INTERVAL="10 minutes",RewardedHintAd.START_PLAY_INTERVAL="1 minute",RewardedHintAd.CHECK_INTERVAL="30 seconds",RewardedHintAd.GAME_START_DELAY="0 seconds"
;var AdsPlugin=function(){};AdsPlugin.prototype.init=function(e){e()};var VideoAds=function(){this.loading={},this.cached={},AdsPlugin.call(this),this.listener={onAdAction:function(e,t,i){},onRewardAction:function(e,t,i,s){}}};VideoAds.prototype=Object.create(AdsPlugin.prototype),(VideoAds.prototype.constructor=VideoAds).isAppropriate=function(){return cleverapps.isLocalhost()},VideoAds.prototype.setListener=function(e){this.listener=e},VideoAds.prototype.cache=function(e,t){this.loading[t]?console.log("Loading in progress, skipping request"):(this.loading[t]=!0,setTimeout(function(){delete this.loading[t],this.cached[t]=!0,this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.LOADED)}.bind(this),3e3))},VideoAds.prototype.isAvailable=function(e){return this.cached[e]},VideoAds.prototype.playAd=function(e,t){if(this.cached[t]){this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED);var i=cc.director.getRunningScene(),s=i.width,n=i.height
;this.overlay=new cc.LayerColor(new cc.Color(200,200,255,255),s,n),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(){return!0}},this.overlay),i.addChild(this.overlay);var o={font:cleverapps.styles.FONTS.BUTTON_TEXT,width:300*resolutionScale,height:100*resolutionScale,padding:20,onClicked:function(){this.stop(t)}.bind(this),text:"Skip ad"},a=new cleverapps.UI.Button(o);a.setPositionRound(this.overlay.width/2,200),a.disable(),this.waitForReward=setTimeout(function(){t===RewardedAdsManager.REWARDED&&this.listener.onRewardAction(e,t,"gold",1),this.stop(t)}.bind(this),3e3),delete this.cached[t],a.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(function(){a.enable()}))),this.overlay.addChild(a)}else console.log("Show: No video cached!")},VideoAds.prototype.stop=function(e){this.overlay&&(clearTimeout(this.waitForReward),this.listener.onAdAction("AdMob",e,RewardedAdsManager.AD_ACTION_TYPE.AD_CANCELED),
delete this.cached[e],this.overlay.isRunningSafe()&&this.overlay.removeFromParent(!0))};var OKAds=function(){this.cached=void 0,AdsPlugin.call(this),this.listener={onAdAction:function(e,t,i){},onRewardAction:function(e,t,i,s){}},RewardedAdsManager.ACTIVE_ADS=[RewardedAdsManager.REWARDED]};OKAds.prototype=Object.create(AdsPlugin.prototype),(OKAds.prototype.constructor=OKAds).isAppropriate=function(){return cleverapps.OK.isAppropriate()||cleverapps.MobileOK.isAppropriate()},OKAds.prototype.setListener=function(e){this.listener=e},OKAds.prototype.cache=function(t,i){if(!this.cached){this.cached=void 0;var e=function(e){e===cleverapps.OK.CODE_SUCCEED?(this.cached=!0,console.log("Loaded OK ad video"),this.listener.onAdAction(t,i,RewardedAdsManager.AD_ACTION_TYPE.LOADED)):(console.log("Error loading OK ad video!!!"),this.listener.onAdAction(t,i,RewardedAdsManager.AD_ACTION_TYPE.LOAD_FAILED))}.bind(this);cleverapps.social.listeners.prepareMidroll=e,cleverapps.social.whenInitialized(
"okAdsCache",function(){FAPI.invokeUIMethod("prepareMidroll")})}},OKAds.prototype.isAvailable=function(e){return RewardedAdsManager.REWARDED===e&&this.cached},OKAds.prototype.playAd=function(i,s){this.cached?(this.cached=void 0,this.listener.onAdAction(i,s,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED),cleverapps.social.listeners.showMidroll=function(e,t){e===cleverapps.OK.CODE_SUCCEED?(this.listener.onRewardAction(i,s),console.log("Successfully watched video")):console.log("Cancelled viewing video!!"),this.listener.onAdAction(i,s,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED)}.bind(this),ControlButtonsLogic.exitFullscreen(function(){FAPI.invokeUIMethod("showMidroll")})):console.log("Show OK: No video cached")};var OKAppAds=function(){this.cached={},this.inited=!1,AdsPlugin.call(this),this.listener={onAdAction:function(e,t,i){},onRewardAction:function(e,t,i,s){}},this.debug=function(e){if(-1!==["576593702177","580731438762","577203420866","585959187481","564566964211"].indexOf(
cleverapps.user.id)){var t=new cleverapps.ReportStream("MobileOKAppAds");t.push("message "+e),t.send()}},RewardedAdsManager.ACTIVE_ADS=[RewardedAdsManager.REWARDED,RewardedAdsManager.INTERSTITIAL]};OKAppAds.prototype=Object.create(AdsPlugin.prototype),(OKAppAds.prototype.constructor=OKAppAds).isAppropriate=function(){return cleverapps.MobileOK.isAppropriate()&&cleverapps.isOkApp()},OKAppAds.prototype.init=function(e){cleverapps.whenAllInitialized(function(){this.isInitialized()&&FAPI.UI.isNativeAdSupported()&&(this.inited=!0,e())}.bind(this))},OKAppAds.prototype.setListener=function(e){this.listener=e},OKAppAds.prototype.windowApiCallbackRewarded=function(e,t){this.debug("window.API_callback "+e+" "+JSON.stringify(t)),"no_ads"===t||"error"===e?this.listener.onAdAction(RewardedAdsManager.ADMOB,RewardedAdsManager.REWARDED,RewardedAdsManager.AD_ACTION_TYPE.LOAD_FAILED):"ad_prepared"===t?(this.cached[RewardedAdsManager.REWARDED]=!0,this.listener.onAdAction(RewardedAdsManager.ADMOB,
RewardedAdsManager.REWARDED,RewardedAdsManager.AD_ACTION_TYPE.LOADED)):"ad_shown"===t&&(this.listener.onAdAction(RewardedAdsManager.ADMOB,RewardedAdsManager.REWARDED,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED),this.listener.onRewardAction(RewardedAdsManager.ADMOB,RewardedAdsManager.REWARDED))},OKAppAds.prototype.windowApiCallbackInterstitial=function(e,t){this.debug("window.API_callback "+e+" "+JSON.stringify(t)),"no_ads"===t||"error"===e?this.listener.onAdAction(RewardedAdsManager.ADMOB,RewardedAdsManager.INTERSTITIAL,RewardedAdsManager.AD_ACTION_TYPE.LOAD_FAILED):"ready"===t&&this.listener.onAdAction(RewardedAdsManager.ADMOB,RewardedAdsManager.INTERSTITIAL,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED),this.cache(RewardedAdsManager.ADMOB,RewardedAdsManager.INTERSTITIAL)},OKAppAds.prototype.cache=function(e,t){this.inited&&(RewardedAdsManager.REWARDED===t?(FAPI.UI.requestManualAd(),cleverapps.social.listeners.requestManualAd=this.windowApiCallbackRewarded.bind(this)
):RewardedAdsManager.INTERSTITIAL===t&&(this.cached[RewardedAdsManager.INTERSTITIAL]=!0))},OKAppAds.prototype.isAvailable=function(e){return this.cached[e]},OKAppAds.prototype.isInitialized=function(){return"undefined"!=typeof FAPI&&FAPI.UI.isNativeAdSupported&&FAPI.UI.showAd&&FAPI.UI.showLoadedAd},OKAppAds.prototype.playAd=function(e,t){this.inited&&this.cached[t]&&(this.cached[t]=void 0,t===RewardedAdsManager.REWARDED?(FAPI.UI.showLoadedAd(),cleverapps.social.listeners.showLoadedAd=this.windowApiCallbackRewarded.bind(this)):t===RewardedAdsManager.INTERSTITIAL&&(FAPI.UI.showAd(),cleverapps.social.listeners.showAd=this.windowApiCallbackInterstitial.bind(this)),this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED))};var PlingaAds=function(){this.inited=!1,(cleverapps.isLocalhost()||cleverapps.isStagingHost())&&cleverapps.extend(this,FakePlingaAds),AdsPlugin.call(this),this.cached={},this.playing=void 0,this.reward=!1,this.listener={onAdAction:function(e,t,i){},
onRewardAction:function(e,t,i,s){}},RewardedAdsManager.AVAILABLE={episode:0,level:0},RewardedAdsManager.INTERSTITIAL_PROB=[1],RewardedAdsManager.INTERSTITIAL_REWARD_INTERVAL="0 seconds"};PlingaAds.prototype=Object.create(AdsPlugin.prototype),(PlingaAds.prototype.constructor=PlingaAds).isAppropriate=function(){return cleverapps.social instanceof cleverapps.Plinga},PlingaAds.prototype.init=function(e){cleverapps.social.whenInitialized("plingaads",function(){cleverapps.social.eventListener=this.onEvent.bind(this),cleverapps.whenAllInitialized(function(){console.log("plinga social inited - cache ads"),this.inited=!0,e()}.bind(this))}.bind(this))},PlingaAds.prototype.onEvent=function(e){switch(e.name){case"STARTED":this.listener.onAdAction(RewardedAdsManager.ADMOB,this.playing,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED);break;case"ALL_ADS_COMPLETED":this.playing===RewardedAdsManager.REWARDED&&this.listener.onRewardAction(RewardedAdsManager.ADMOB,RewardedAdsManager.REWARDED),this.reward=!1
,this.listener.onAdAction(RewardedAdsManager.ADMOB,this.playing,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED),this.playing=void 0}},PlingaAds.prototype.setListener=function(e){this.listener=e},PlingaAds.prototype.cache=function(e,t){this.inited&&(this.cached[t]?console.log("Already have "+t):"undefined"!==gdsdk&&"undefined"!==gdsdk.preloadAd&&gdsdk.preloadAd(t).then(function(e){console.log("Plinga ads: have ads!",t,e),this.cached[t]=!0}.bind(this)).catch(function(e){console.log("Plinga ads: NO ads!",e)}))},PlingaAds.prototype.isAvailable=function(e){return this.inited&&this.cached[e]},PlingaAds.prototype.playAd=function(t,i){this.cached[i]?"undefined"!==gdsdk&&"undefined"!==gdsdk.showAd&&gdsdk.showAd(i).then(function(e){this.cached[i]=!1,this.playing=i,this.reward=!1,this.listener.onAdAction(t,i,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED)}.bind(this)).catch(function(e){console.log("Plinga showAd error:",e)}):console.log("No ads for: "+i)};var FakePlingaAds={onEvent:function(e){},
cache:function(e,t){},isAvailable:function(e){return!1},playAd:function(e,t){}},VKAds=function(){this.inited=!1,this.adman={},AdsPlugin.call(this),this.listener={onAdAction:function(e,t,i){},onRewardAction:function(e,t,i,s){}}};VKAds.prototype=Object.create(AdsPlugin.prototype),(VKAds.prototype.constructor=VKAds).isAppropriate=function(){return cleverapps.VK.isAppropriate()||cleverapps.MobileVk.isAppropriate()},VKAds.prototype.init=function(e){var t=["//ad.mail.ru/static/admanhtml/rbadman-html5.min.js","//vk.com/js/api/adman_init.js","//js.appscentrum.com/scr/preroll.js"],i=function(){"undefined"!=typeof admanInit&&(this.inited=!0,console.log("Adman loaded"),e())}.bind(this),s=t.length,n=function(){0===--s&&i()};t.forEach(function(e){cleverapps.loadSdk(e,n,function(){console.log("Failed loading vk ads dependencies")},3)})},VKAds.prototype.setListener=function(e){this.listener=e},VKAds.prototype.cache=function(e,t){this.inited&&(this.adman[t]?console.log("Already have "+t):admanInit({
user_id:cleverapps.social.getUserID(),app_id:cleverapps.config.vk.appId,type:t===RewardedAdsManager.REWARDED?"rewarded":"preloader"},function(e){console.log("Vk ads: have ads!"),this.adman[t]=e,console.log(e)}.bind(this),function(){console.log("Vk ads: NO ads!")}))},VKAds.prototype.isAvailable=function(e){return this.inited&&void 0!==this.adman[e]&&RewardedAdsManager.REWARDED===e},VKAds.prototype.playAd=function(e,t){if(this.adman[t]){var i=this.adman[t];this.adman[t]=void 0,this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED);var s=function(){this.listener.onRewardAction(e,t),this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED),s=function(){}}.bind(this),n=function(){this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.AD_CANCELED),n=function(){}}.bind(this);i.onCompleted(s),i.onClicked(s),i.onSkipped(n),i.start("preroll")}else console.log("No ads for: "+t)};var InstantAds=function(){this.supported=!0,AdsPlugin.call(this),
console.log("Choose InstantAds"),cleverapps.social.whenInitialized("instantads",function(){-1===FBInstant.getSupportedAPIs().indexOf("getRewardedVideoAsync")?(console.log("FBInstant getRewardedVideoAsync is not supported!"),this.supported=!1):console.log("Found support for FBInstant getRewardedVideoAsync")}.bind(this)),this.cached={},this.loaded={},this.listener={onAdAction:function(e,t,i){},onRewardAction:function(e,t,i,s){}}};InstantAds.prototype=Object.create(AdsPlugin.prototype),(InstantAds.prototype.constructor=InstantAds).prototype.setListener=function(e){this.listener=e},InstantAds.prototype.cache=function(e,t){if(this.supported&&cleverapps.config.instantAds){var i=cleverapps.config.instantAds[t];if(i)this.cached[t]=void 0,(t===RewardedAdsManager.REWARDED?FBInstant.getRewardedVideoAsync:FBInstant.getInterstitialAdAsync).call(FBInstant,i).then(function(e){return this.cached[t]=e,this.loaded[t]=!1,console.log("Loaded instant ad config: "+t),e.loadAsync()}.bind(this)).then(
function(){this.loaded[t]=!0,console.log("Loaded instant ad video: "+t),this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.LOADED)}.bind(this))}},InstantAds.prototype.isAvailable=function(e){return!!this.supported&&this.loaded[e]},InstantAds.prototype.playAd=function(t,i){this.supported&&(this.cached[i]?(this.listener.onAdAction(t,i,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED),this.loaded[i]=!1,this.cached[i].showAsync().then(function(){this.listener.onAdAction(t,i,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED),i===RewardedAdsManager.REWARDED&&this.listener.onRewardAction(t,i)}.bind(this)).catch(function(e){console.error(e.message),this.listener.onAdAction(t,i,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED)}.bind(this))):console.log("Show: No video cached: "+i))};var WebViewAds=function(){this.available={},cc.sys.os===cc.sys.OS_IOS&&(AdMobPlugin=new cleverapps.IOSWebViewAdMobPluginAdapter,this.inited=!1),AdsPlugin.call(this),this.listener={onAdAction:function(e,t,i){},
onRewardAction:function(e,t,i,s){}}};WebViewAds.prototype=Object.create(AdsPlugin.prototype),(WebViewAds.prototype.constructor=WebViewAds).prototype.init=function(e){cc.sys.os===cc.sys.OS_IOS?(this.onInitCallback=e,AdMobPlugin.init()):e()},WebViewAds.prototype.onInit=function(){if(this.inited=!0,this.onInitCallback){var e=this.onInitCallback;delete this.onInitCallback,e()}},WebViewAds.prototype.setListener=function(e){this.listener=e},WebViewAds.prototype.cache=function(e,t){!1!==this.inited&&AdMobPlugin.cache(t)},WebViewAds.prototype.onAdLoaded=function(e){this.listener.onAdAction(RewardedAdsManager.ADMOB,e,RewardedAdsManager.AD_ACTION_TYPE.LOADED)},WebViewAds.prototype.onAdClosed=function(e){this.listener.onAdAction(e,e,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED)},WebViewAds.prototype.onAdFailedToLoad=function(e){this.listener.onAdAction(RewardedAdsManager.ADMOB,e,RewardedAdsManager.AD_ACTION_TYPE.LOAD_FAILED)},WebViewAds.prototype.onAdLeftApplication=function(e){},
WebViewAds.prototype.onAdOpened=function(e){this.listener.onAdAction(RewardedAdsManager.ADMOB,e,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED)},WebViewAds.prototype.onReward=function(e,t,i){this.listener.onRewardAction(RewardedAdsManager.ADMOB,e,i,!0)},WebViewAds.prototype.onAdOpened=function(e){this.listener.onAdAction(RewardedAdsManager.ADMOB,e,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED)},WebViewAds.prototype.isAvailable=function(e){return this.available[e]},WebViewAds.prototype.playAd=function(e,t){AdMobPlugin.show(t)},WebViewAds.isAppropriate=function(){return cc.sys.isNative&&cc.sys.isWebView&&("undefined"!=typeof AdMobPlugin||cc.sys.os===cc.sys.OS_IOS)},cleverapps.IOSWebViewAdMobPluginAdapter=function(){},cleverapps.IOSWebViewAdMobPluginAdapter.prototype.init=function(){console.log("IOSWebViewAdMobPluginAdapter init"),webkitMessage("adMob",{action:"init"})},cleverapps.IOSWebViewAdMobPluginAdapter.prototype.cache=function(e){console.log("IOSWebViewAdMobPluginAdapter cache"),
webkitMessage("adMob",{action:"cache",name:e})},cleverapps.IOSWebViewAdMobPluginAdapter.prototype.show=function(e){console.log("IOSWebViewAdMobPluginAdapter show"),webkitMessage("adMob",{action:"show",name:e})};var BountyManager=function(){this.when=void 0,this.prizes=[],cleverapps.config.debugMode&&(BountyManager.POPUP_INTERVAL="10 minutes"),this.load(),cleverapps.friends.addFriendsUpdatedListener(this.onFriendsUpdated.bind(this))};BountyManager.openWindow=function(e){new BountyWindow(e)},BountyManager.prototype.onFriendsUpdated=function(){cleverapps.social instanceof cleverapps.MobileVk&&(this.prizes=this.prizes.filter(function(e){return e.friends=e.friends.filter(function(e){return cleverapps.friends.inApp(e.id)}),0<e.friends.length&&(void 0===e.minFriendsNo||e.friends.length>=e.minFriendsNo)}),this.save(this.when))},BountyManager.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.BOUNTY);e?(this.when=e.when,this.prizes=e.prizes||[],
this.when>Date.now()&&this.save()):this.save(-1)},BountyManager.prototype.save=function(e){this.when=e||Date.now(),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.BOUNTY,{when:this.when,prizes:this.prizes})},BountyManager.prototype.collect=function(e,t){t&&t.removeAllChildren(),e.type!==BountyManager.TYPE_STAR?e.type===BountyManager.TYPE_LIFE&&cleverapps.lives?WindowHelper.animateCollect(t,{scale:.8,target:cleverapps.styles.MenuBar.LivesItem.target},function(){cleverapps.lives.setAmount(cleverapps.lives.amount+e.amount)}):WindowHelper.animateCollect(t,{scale:.8,target:cleverapps.styles.MenuBar.GoldItem.target},function(){levels.user.setGold(levels.user.gold+e.amount)}):WindowHelper.animateCollect(t,{scale:.8,target:cleverapps.styles.MenuBar.StarChestItem.target},function(){cleverapps.starChest.addStars(e.amount),cleverapps.starChest.locked||cleverapps.metha.display({focus:"BountyManagerStarChestWindow",action:function(e){new StarChestWindow,
cleverapps.metha.onceNoWindowsListener=e}})})},BountyManager.prototype.isActive=function(){return!cleverapps.flags.noviral},BountyManager.prototype.needRefresh=function(){return Date.now()-this.when>=cleverapps.parseInterval(BountyManager.POPUP_INTERVAL)},BountyManager.prototype.refreshPrizes=function(){if(!this.needRefresh())return!1;var e=levels.friendSorter.listActiveFriends();cleverapps.Random.shuffle(e);var t=levels.friendSorter.listInactiveFriends();cleverapps.Random.shuffle(t);var n=e.concat(t).map(function(e){if(e&&e.id)return{id:e.id,avatar:e.avatar}});return this.prizes=[],BountyManager.PRIZES.forEach(function(e,t){(e=cleverapps.clone(e,!0)).id=t;var i=n;if(!(!e.minFriendsNo&&e.friendsNo>i.length||e.minFriendsNo>i.length||!cleverapps.lives&&e.type===BountyManager.TYPE_LIFE||!cleverapps.config.results&&e.type===BountyManager.TYPE_STAR)&&BountyManager.ACTIVE_TYPES[e.type]){var s=e.friendsNo;s>i.length&&(s=i.length),e.friends=i.splice(0,s),this.prizes.push(e)}}.bind(this)),
this.save(),cleverapps.localPushes.sendPush(cleverapps.LocalPushes.BOUNTY_CODE,cleverapps.parseInterval(BountyManager.POPUP_INTERVAL)),!0},BountyManager.prototype.sendIfNeed=function(){if(this.isActive()&&0!==cleverapps.friends.listFriends().length){var e=this.refreshPrizes();if(!(this.prizes.length<1)){var t=levels.friendRequests.notProcessed.filter(function(e){return e.from===levels.FriendRequest.SYSTEM_ID&&e.type===levels.FriendRequest.TYPE_BOUNTY_READY});0<t.length?e&&(t.forEach(function(e){levels.friendRequests.processById(e.id)}),this.createRequest()):this.createRequest()}}},BountyManager.prototype.createRequest=function(){levels.friendRequests.notProcessed.push(levels.FriendRequest.createFriendRequest({id:"__"+Math.floor(1e15*Math.random()),from:levels.FriendRequest.SYSTEM_ID,type:levels.FriendRequest.TYPE_BOUNTY_READY,fake:!0})),levels.friendRequests.save(),levels.friendRequests.onNewListener()},BountyManager.prototype.listPrizes=function(){return this.prizes},
BountyManager.prototype.removePrize=function(e){for(var t=0;t<this.prizes.length;t++)if(this.prizes[t].id===e.id){this.prizes.splice(t,1),this.save();break}},BountyManager.POPUP_INTERVAL="12 hour",BountyManager.TYPE_LIFE=0,BountyManager.TYPE_STAR=1,BountyManager.TYPE_GOLD_1=2,BountyManager.TYPE_GOLD_2=3,BountyManager.ACTIVE_TYPES={},BountyManager.ACTIVE_TYPES[BountyManager.TYPE_LIFE]=!0,BountyManager.ACTIVE_TYPES[BountyManager.TYPE_STAR]=!0,BountyManager.ACTIVE_TYPES[BountyManager.TYPE_GOLD_1]=!0,BountyManager.ACTIVE_TYPES[BountyManager.TYPE_GOLD_2]=!0,BountyManager.PRIZES=[{type:BountyManager.TYPE_GOLD_1,amount:5,friendsNo:1},{type:BountyManager.TYPE_STAR,amount:1,friendsNo:2,minFriendsNo:1},{type:BountyManager.TYPE_GOLD_2,amount:10,friendsNo:3,minFriendsNo:1},{type:BountyManager.TYPE_LIFE,amount:1,friendsNo:4,minFriendsNo:1},{type:BountyManager.TYPE_GOLD_2,amount:15,friendsNo:5,minFriendsNo:3},{type:BountyManager.TYPE_STAR,amount:1,friendsNo:10,minFriendsNo:3},{
type:BountyManager.TYPE_GOLD_2,amount:15,friendsNo:10,minFriendsNo:4},{type:BountyManager.TYPE_GOLD_2,amount:10,friendsNo:10,minFriendsNo:5}];var BountyItemView=cc.Node.extend({ctor:function(e){this._super(),this.prize=e,this.onAcceptListener=function(){};var n=cleverapps.styles.BountyItemView,t=cleverapps.UI.createScale9Sprite(n.Background.image),i=n.Background.width;cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL&&(i+=n.wide.Background.x),t.setContentSize2(i,n.Background.height),this.simpleBg=t,this.setAnchorPoint(.5,.5),this.setContentSize(t.getContentSize()),t.setPosition(this.width/2,this.height/2),this.addChild(t);var s=this.content=new cc.Node;s.setAnchorPoint2(),s.setPosition(cleverapps.styles.BountyItemView.icon.x,this.height/2),this.addChild(s);var o=cleverapps.styles.BountyItemView.ICONS[e.type],a=new cc.Sprite(o);a.setScale(cleverapps.styles.BountyItemView.icon.scale);var r=a.getContentSize();s.setContentSize(r.width*a.scale,r.height*a.scale),s.addChild(a),
a.setPositionRound(s.width/2,s.height/2),this.image=a,e.amount&&this.addAmountToIcon(e.amount);var l=n.avatars.width;cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL&&(l+=n.wide.avatars.width);var c=n.avatar.x,p=e.friends.length;10<p&&(p=10),l<p*c&&(c=l/p),e.friends.forEach(function(e,t){if(!(p<t)){var i=e.id;if("string"==typeof e&&(i=e,e=void 0),e=e||cleverapps.friends.getById(i)||cleverapps.invitalbleFriends.getById(i)){var s=new cleverapps.UI.Avatar(e);s.setPosition(s.width/2+n.avatars.x+t*c,this.height/2+n.avatar.y),this.addChild(s),s.setScale(.8)}}},this);var d=this.getButton(e);this.addChild(d),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,this.onAcceptListener.bind(this))},addAmountToIcon:function(e){var t=cleverapps.styles.BountyItemView,i=cleverapps.UI.generateTTFText("+"+e,t.amount.font,{});i.setPosition(this.content.width/2+t.amount.x,this.content.height/2+t.amount.y),this.content.addChild(i)},onMouseOver:function(){
var e=cleverapps.styles.BountyItemView.Background;e.imageOn?this.simpleBg.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(e.imageOn)):this.simpleBg.setColor(cleverapps.styles.COLORS.COLOR_VERYLIGHTBROWN)},onMouseOut:function(){var e=cleverapps.styles.BountyItemView.Background;e.imageOn?this.simpleBg.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(e.image)):this.simpleBg.setColor(cleverapps.styles.COLORS.WHITE)},getButton:function(e){var t=cleverapps.styles.BountyItemView.Button,i=new cc.Node;i.setPosition(t.width/2,t.height/2);var s=cleverapps.UI.generateTTFText("messages:Collect",t.font);s.fitTo(.9*t.width),s.setPosition(0,t.text.y),i.addChild(s);var n={onClicked:function(){this.onAcceptListener()}.bind(this),width:t.width,height:t.height,content:i,button_png:t.button_png,button_on_png:t.button_on_png},o=new cleverapps.UI.Button(n);return o.setPositionRound(this.width-o.width/2+cleverapps.styles.BountyItemView.Button.x,this.height/2),o},animateBuy:function(){
cleverapps.styles.MenuBar.LivesItem.target&&WindowHelper.animateCollect(this.content,{scale:.3,target:cleverapps.styles.MenuBar.LivesItem.target})}});cleverapps.styles.BountyItemView={ICONS:{},Background:{scale9:!0,width:680,height:100,image:bundles.main.frames.bounty_item_bg},wide:{Background:{x:100},avatars:{width:80}},icon:{scale:1,x:50},amount:{x:60,y:-20,font:cleverapps.styles.FONTS.WINDOW_SMALL_TEXT},avatars:{x:170,width:240},avatar:{x:100,y:-3},Button:{width:160,height:70,x:-15,button_png:res.small_green_button,button_on_png:res.small_green_button_on,font:cleverapps.styles.FONTS.BUTTON_SMALL_TEXT,text:{y:0}}},cleverapps.styles.BountyItemView.ICONS[BountyManager.TYPE_GOLD_1]=bundles.main.frames.coin_png,cleverapps.styles.BountyItemView.ICONS[BountyManager.TYPE_GOLD_2]=bundles.main.frames.coin_png,cleverapps.styles.BountyItemView.ICONS[BountyManager.TYPE_LIFE]=bundles.main.frames.accept_life_icon,
cleverapps.styles.BountyItemView.ICONS[BountyManager.TYPE_STAR]=bundles.main.frames.accept_star_icon;var BountyWindow=Window.extend({onWindowLoaded:function(n){var e=cleverapps.styles.BountyWindow,t=new cc.Node;t.setAnchorPoint(.5,.5),this.content=t,this.onSocialRequestResponse=this.createListener(function(e,t){t.onAcceptListener=function(){},cleverapps.bountyManager.collect(e,t.image),t.runAction(new cc.Sequence(new cc.ScaleTo(.3,0),new cc.RemoveSelf,new cc.CallFunc(function(){this.bountyViews.splice(this.bountyViews.indexOf(t),1),this.moveToPosition()},this)))});var i=cleverapps.throttle(cleverapps.UI.SOCIAL_CLICK_THROTTLE,function(e,t){var i="bountyGold";e.type===BountyManager.TYPE_STAR&&(i="bountyStar"),e.type===BountyManager.TYPE_LIFE&&(i="bountyLife");var s=e.friends.map(function(e){return e&&e.id?e.id:e});cleverapps.social.sendRequest(s,i,function(){this.onSocialRequestResponse(e,t)}.bind(this)),cleverapps.bountyManager.removePrize(e),n.remove()}.bind(this))
;cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOUNTY_OPENED),this.bountyViews=cleverapps.bountyManager.listPrizes().map(function(e){var t=new BountyItemView(e);return t.onAcceptListener=function(){i(e,t)},this.content.addChild(t),t}.bind(this));var s=this.bountyViews.map(function(e){return e});s.reverse();var o=cleverapps.UI.arrangeWithMargins(s,{y:e.items.y,margin:e.item.y,direction:cleverapps.UI.VERTICAL,x:Math.round(e.width/2)});if(this.total=o,t.setContentSize2(e.width,o+e.height),0===s.length)this.generateNoFriendsContent();else{var a=cleverapps.UI.generateTTFText("messages:BountyWindow.Text",cleverapps.styles.FONTS.WINDOW_TEXT);a.setPositionRound(t.width/2,o+e.text.y),t.addChild(a)}this._super({name:"bountywindow",title:"messages:BountyWindow.Title",content:t}),cleverapps.audio.playSound(bundles.game.urls.perfect_effect)},moveToPosition:function(){if(0!==this.bountyViews.length){var e=this.bountyViews.map(function(e){return e});e.reverse()
;var t=cleverapps.styles.BountyWindow,i=cleverapps.UI.arrangeWithMargins(e,{y:t.items.y,margin:t.item.y,direction:cleverapps.UI.VERTICAL,x:Math.round(t.width/2),iterator:function(){}});cleverapps.UI.arrangeWithMargins(e,{y:t.items.y+(this.total-i),margin:t.item.y,direction:cleverapps.UI.VERTICAL,x:Math.round(t.width/2),iterator:function(e,t,i){e.stopAllActions(),e.runAction(new cc.MoveTo(.5,t,i))}})}else this.close()},generateNoFriendsContent:function(){var e=cleverapps.styles.BountyWindow.noFriends;this.content.setContentSize(e.width,e.height);var t=cleverapps.UI.generateTTFText("messages:BountyWindow.noFriendsText",cleverapps.styles.FONTS.WINDOW_TEXT);t.setPositionRound(this.content.width/2,e.Text.y),t.setDimensions(e.Text.width,e.Text.height),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.content.addChild(t);var i=new cleverapps.UI.Button({text:Messages.get("SettingsWindow.InviteFriends"),width:e.Button.width,height:e.Button.height,font:cleverapps.styles.FONTS.BUTTON_TEXT,
onClicked:function(){cleverapps.social.inviteFriendsWindow(function(){this.close()}.bind(this))}.bind(this)});i.setPositionRound(this.content.width/2,e.Button.y),this.content.addChild(i)}});cleverapps.styles.BountyWindow={width:690,height:150,noFriends:{width:690,height:500,Text:{y:250,width:550,height:200},Button:{width:450,height:120,y:0}},text:{y:60},items:{y:-20},item:{y:10},animation:{x:300,y:200}};var PiggyBank=function(){cleverapps.config.debugMode&&(PiggyBank.LIFETIME="10 minutes",PiggyBank.INTERMISSION="2 day"),this.active=void 0,this.when=void 0,this.level=void 0,this.amount=0,this.load(),this.onStopListener=function(){},this.onFullListener=function(){}};PiggyBank.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PIGGY_BANK);void 0===e&&(e={active:!1,when:void 0,level:0,amount:0}),this.active=e.active,this.when=e.when,this.level=e.level,this.amount=e.amount,this.updateState()},PiggyBank.prototype.getInfo=function(){return{
active:this.active,when:this.when,level:this.level,amount:this.amount}},PiggyBank.prototype.updateInfo=function(e,t){this.active=e.active,this.when=e.when,this.level=e.level,this.amount=e.amount,this.save(t)},PiggyBank.prototype.getLeftTime=function(){return cleverapps.parseInterval(PiggyBank.LIFETIME)-(Date.now()-this.when)},PiggyBank.prototype.getProduct=function(){return new Product(["piggybank500","piggybank1800","piggybank6000","piggybank25000"][this.level])},PiggyBank.prototype.buy=function(e){var t=this.getProduct();t.reward.gold=this.amount;var i=function(){cleverapps.history.add("piggy",1),this.stop(),e()}.bind(this);t.piggyBankLevel=this.level,t.buy(i)},PiggyBank.prototype.updateState=function(){var e=!1;this.active&&this.when+cleverapps.parseInterval(PiggyBank.LIFETIME)<Date.now()&&(this.active=!1,this.when=this.when+cleverapps.parseInterval(PiggyBank.LIFETIME),e=!0,this.logStop()),this.active||(void 0===this.when||this.when+cleverapps.parseInterval(PiggyBank.INTERMISSION
)<Date.now())&&(this.start(),e=!1),e&&this.save(),this.timer&&(this.timer.clear(),delete this.timer),this.timer=new cleverapps.LongTimeout(function(){this.onStopListener()}.bind(this),this.getLeftTime())},PiggyBank.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PIGGY_BANK,{active:this.active,when:this.when,level:this.level,amount:this.amount}),e||cleverapps.synchronizer.addUpdateTask("piggybank")},PiggyBank.prototype.getBaseAmount=function(){return this.getProduct().reward.gold},PiggyBank.prototype.getAddAmount=function(){return(this.getMaxAmount()-this.getBaseAmount())/PiggyBank.WINS_TO_FULFILL},PiggyBank.prototype.getMaxAmount=function(){return Math.round(this.getBaseAmount()*PiggyBank.MAX_COEF/PiggyBank.WINS_TO_FULFILL)*PiggyBank.WINS_TO_FULFILL},PiggyBank.prototype.isFull=function(){return this.amount>=this.getMaxAmount()},PiggyBank.prototype.addGold=function(e){this.isFull()||(this.amount+=e,this.save(),this.isFull()&&this.onFullListener())},
PiggyBank.MAX_COEF=1.4,PiggyBank.prototype.start=function(){this.active=!0,this.when=Date.now(),this.level=cleverapps.paymentsHistory.classify(),this.level===cleverapps.PaymentsHistory.PAYER_BIGWHALE&&(this.level=cleverapps.PaymentsHistory.PAYER_WHALE);var e=this.getProduct();this.amount=e.reward.gold,this.save()},PiggyBank.prototype.logStop=function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PIGGY_BANK+"_stop"),this.isFull()&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PIGGY_BANK+"_stop_full")},PiggyBank.prototype.stop=function(){this.logStop(),this.active=!1,this.when=Date.now(),this.save(),this.onStopListener()},PiggyBank.prototype.isActive=function(){return!!levels.user.checkAvailable(PiggyBank.AVAILABLE)&&(!cleverapps.flags.nopayments&&(this.updateState(),this.active))},PiggyBank.AVAILABLE={episode:1,level:12},PiggyBank.WINS_TO_FULFILL=10,PiggyBank.LIFETIME="3 days",PiggyBank.INTERMISSION="3 days";var PiggyBankVictoryAnimation=cleverapps.Spine.extend({ctor:function(
){var e=cleverapps.styles.PiggyBankVictoryAnimation;this._super(bundles.piggybank_window.jsons.piggy_bank_window_json,e.scale),this.setAnimation(0,"piggy_victory",!0)}});cleverapps.styles.PiggyBankVictoryAnimation={scale:1};var PiggyBankWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.piggyBank.getLeftTime();if(!(e<=0)){var t=cleverapps.styles.PiggyBankWindow,i=new cc.Node;i.setContentSize2(t.animation.width,t.animation.height),i.setAnchorPoint2();var s=new cleverapps.Spine(t.animation.json);s.setAnimation(0,cleverapps.piggyBank.isFull()?"piggy_full":"piggy_bank",!0),s.setPositionRound(i.width/2,i.height/2+t.animation.y),i.addChild(s);var n=new cc.Node,o=cleverapps.UI.generateTTFText("messages:Balance",cleverapps.styles.FONTS.WINDOW_TEXT);o.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.setDimensions(0,t.text.height),n.addChild(o);var a=cleverapps.UI.createScale9Sprite(t.timer.bg);a.setContentSize2(t.amount.width,t.amount.height);var r=new cc.Node,l=new cc.Sprite(
bundles.menubar.frames.coin_png);l.setFlippedX(t.amount.coin.flip),l.setScale(t.amount.coin.scale),r.addChild(l);var c=cleverapps.UI.generateTTFText(cleverapps.formatAmount(cleverapps.piggyBank.amount),cleverapps.styles.FONTS.PIGGY_BANK_AMOUNT_TEXT,{});r.addChild(c),cleverapps.UI.arrangeWithMargins(r.children,{direction:cleverapps.UI.HORIZONTAL,margin:t.amount.margin}),cleverapps.UI.wrap(r),c.y+=t.amount.y,r.setAnchorPoint2(),r.setPositionRound(a.width/2,a.height/2),a.addChild(r),n.addChild(a),cleverapps.UI.arrangeWithMargins(n.children,{direction:cleverapps.UI.HORIZONTAL,margin:t.timer.margin.x}),cleverapps.UI.wrap(n),n.setAnchorPoint2();var p=cleverapps.piggyBank.getProduct(),d=cleverapps.UI.generateTTFText("messages:PiggyBankWindow.text2",cleverapps.styles.FONTS.WINDOW_TEXT);d.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),d.setDimensions(0,t.text.height);var h=cleverapps.UI.createScale9Sprite(t.timer.bg);h.setContentSize2(t.timer.width,t.timer.height);var u={background_content:h,
font:cleverapps.styles.FONTS.WHITE_TEXT,timerPosition:t.timer},v=new cleverapps.CountDownView(new cleverapps.CountDown(e,{onFinish:function(){this.close()}.bind(this)}),u),g=new cc.Node;g.addChild(d),g.addChild(v),cleverapps.UI.arrangeWithMargins(g.children,{direction:cleverapps.UI.HORIZONTAL,margin:t.timer.margin.x}),cleverapps.UI.wrap(g),g.setAnchorPoint2();var m=cleverapps.piggyBank.isFull()?"messages:PiggyBankWindow.text1.Full":"messages:PiggyBankWindow.text1",f=cleverapps.UI.generateTTFText(m,cleverapps.styles.FONTS.WINDOW_TEXT,{price:p.getCurrentPrice()});f.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),f.setDimensions(t.text.width,0);var _=new cc.Node;_.setContentSize2(0,t.amount.margin);var y=new cc.Node;y.addChild(f),y.addChild(_),y.addChild(n),y.addChild(i),i.setLocalZOrder(1),y.addChild(g),cleverapps.UI.arrangeWithMargins(y.children,{direction:cleverapps.UI.VERTICAL,margin:t.margin}),cleverapps.UI.wrap(y),y.setAnchorPoint2(),y=cleverapps.UI.wrapWithPadding(y,{x:0,
y:t.padding.y});var w=t.button;w.text=Messages.get("GetIt"),w.font=cleverapps.styles.FONTS.PIGGY_BANK_BUTTON_TEXT,w.onPressed=function(){cleverapps.piggyBank.buy(this.close.bind(this))}.bind(this);var b=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.PiggyBankWindow,!0);this._super({name:"piggybankwindow",title:cleverapps.piggyBank.isFull()?"messages:PiggyBankWindow.Title.Full":"messages:PiggyBankWindow.Title",content:y,button:w,help:function(){new PiggyBankRulesWindow},styles:b}),cleverapps.audio.playSound(bundles.main.urls.piggybank_window_effect||res.shop_buy_effect),Lottery.addIcon(this.button),Lottery.addText(this)}}});PiggyBankWindow.prototype.listBundles=function(){return["piggybank_window"]},cleverapps.styles.PiggyBankWindow={margin:20,padding:{y:60},animation:{width:600,height:450,y:-90,json:bundles.piggybank_window.jsons.piggy_bank_window_json},amount:{width:260,height:64,margin:10,y:0,coin:{flip:!0,scale:1}},text:{width:640,height:150},button:{width:300,
height:100},timer:{width:220,height:50,bg:res.timer_bg_png,margin:{x:30},x:0,y:0}};var PiggyBankIcon=SideBarIcon.extend({ctor:function(e){var t={leftTime:cleverapps.piggyBank.getLeftTime()},i=cleverapps.overrideStyles(cleverapps.styles.SideBarIcon,cleverapps.styles.PiggyBankIcon,!0);this._super(e,i,t)},onEnter:function(){this._super(),cleverapps.piggyBank.isFull()&&this.turnOnAttention(),cleverapps.piggyBank.onFullListener=this.createListener(this.turnOnAttention.bind(this)),cleverapps.piggyBank.onStopListener=this.createListener(this.removeFromSideBar.bind(this))},onPressed:function(){this._super(),cleverapps.audio.playSound(bundles.main.urls.icon_click_effect),cleverapps.metha.display({focus:"PiggyBankWindow",control:"MenuBarGoldItem",action:function(e){new PiggyBankWindow,cleverapps.metha.onceNoWindowsListener=e}})}});PiggyBankIcon.IsAvailable=function(){return cleverapps.piggyBank.isActive()},cleverapps.styles.PiggyBankIcon={animation:bundles.sidebar.jsons.piggybank_icon_json}
;var PiggyBankRulesWindow=RulesWindow.extend({onWindowLoaded:function(){this._super({name:"piggybankwindow",styles:cleverapps.styles.PiggyBankRulesWindow})}});PiggyBankRulesWindow.prototype.listBundles=function(){return["piggybank_window"]},cleverapps.styles.PiggyBankRulesWindow={font:cleverapps.styles.FONTS.PIGGY_BANK_WINDOW_SMALL_TEXT,prefix:"messages:PiggyBankRulesWindow.",animation:{json:bundles.piggybank_window.jsons.piggy_bank_window_json,name:"piggy_help"}};var PackManager=function(e){cleverapps.config.debugMode&&(PackManager.NEXT_STAGE_INTERVAL="10 seconds"),e?(this.whenBuy=-1,this.used=0,this.save()):this.load(),this.onBuyPackListener=function(){}};PackManager.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PACK);this.whenBuy=e&&e.whenBuy&&e.whenBuy<Date.now()?e.whenBuy:-1,this.used=e&&e.used?e.used:0},PackManager.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PACK,{whenBuy:this.whenBuy,used:this.used}),
!1!==e&&cleverapps.synchronizer.addUpdateTask("packs")},PackManager.prototype.get=function(){var e=PackManager.PACKS[PackManager.PACK_NAME];return e=(e=Array.isArray(e)?e:[e]).filter(function(e){return!1!==e.active}),(e=this.used<e.length?e[this.used]:void 0)&&(e.stage=this.used,e.id=PackManager.PACK_NAME),e},PackManager.prototype.onBuyPack=function(){this.used++,this.whenBuy=Date.now(),this.save(),cleverapps.history.add("pack",1),this.onBuyPackListener()},PackManager.prototype.isAvailable=function(){var e=this.get();if(!e)return!1;if(cleverapps.flags.nopayments)return!1;if(!e.active&&!cleverapps.config.debugMode)return!1;if(e.available){var t=e.available;if(!levels.user.checkAvailable(t))return!1}return!(Date.now()<this.whenBuy+cleverapps.parseInterval(PackManager.NEXT_STAGE_INTERVAL))},PackManager.PACK_NAME="starterPack",PackManager.NEXT_STAGE_INTERVAL="1 day",PackManager.PACKS={starterPack:[{product:"starterPack0",title:"messages:StarterPack0.Title",animation:"animation1",
bundle:"starter_pack",banner:"starter_pack_banner_png",icon:"starter_pack_0_icon_png",description:"messages:StarterPack0.Description",reward:RewardsConfig.Packs[0],active:!0,available:{episode:1,level:5}},{product:"starterPack",title:"messages:StarterPack1.Title",animation:"animation2",bundle:"starter_pack",banner:"starter_pack_banner_png",icon:"starter_pack_1_icon_png",description:"messages:StarterPack1.Description",reward:RewardsConfig.Packs[1],active:!0,available:{episode:2,level:5}},{product:"starterPack2",title:"messages:StarterPack2.Title",animation:"animation3",bundle:"starter_pack",banner:"starter_pack_banner_png",icon:"starter_pack_2_icon_png",description:"messages:StarterPack2.Description",reward:RewardsConfig.Packs[2],active:!0,available:{episode:3,level:5}}]},PackManager.PACKS.starterPack.forEach(function(e){cleverapps.PaymentsManager.PRODUCTS[e.product].reward=e.reward});var PackWindow=Window.extend({onWindowLoaded:function(e){e=e||{};var t=cleverapps.packManager.get()
;this.pack=t;var i=cleverapps.styles.PackWindow,s=i.button;this.setButtonContent(s),s.onPressed=function(){this.buyPackProduct()}.bind(this);var n=this.generateContent(t),o=cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.Window,!0),cleverapps.styles.PackWindow);if(this._super({name:"packwindow",title:i.title?{text:t.title,margin:{x:0,y:i.title.margin.y},font:i.title.font||cleverapps.styles.FONTS.WINDOW_TITLE_TEXT}:"",content:n,button:s,windowBg:e.windowBg,styles:o}),i.repeatablePattern)for(var a=this.window.width/3,r=a/i.repeatablePattern.elementWidth,l=0;l<3;l++){var c=cleverapps.UI.createSprite(i.repeatablePattern.image);c.setScale(r),c.setAnchorPoint2(0,.5),c.setPositionRound(l*a,this.window.height+i.repeatablePattern.offsetY*r),this.window.addChild(c)}if(i.heroAnimation){var p=new cleverapps.Spine(bundles.main.jsons.hero_json);p.setAnimation(0,i.heroAnimation.animation,!0),p.setScale(i.heroAnimation.scale[cleverapps.wideMode.mode]),p.setPositionRound(
i.heroAnimation.position),this.addChild(p)}cleverapps.audio.playSound(res.window_effect),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PACKWINDOW_OPENED),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PACKWINDOW_OPENED+"_"+this.pack.id+(0===this.pack.stage?"":"_"+this.pack.stage)),Lottery.addIcon(this.button),Lottery.addText(this)},setButtonContent:function(e){var t=new Product(this.pack.product);e.content=this.generateButtonText(t)},generateButtonText:function(e){return new ProductPriceView(e,{font:cleverapps.styles.PackWindow.button.font,fitTo:{width:cleverapps.styles.PackWindow.BottomButton.width}})},onShow:function(){cleverapps.audio.playSound(bundles.main.urls.open_window_effect)},generateContent:function(e){var t=bundles[e.bundle],i=cleverapps.styles.PackWindow,s=this.content=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(i);var n=new cleverapps.Spine(t.jsons.pack_json);return e.introAnimation?(n.setAnimation(0,e.introAnimation,!1),n.addAnimation(0,e.animation,!0,
e.introDelay||0)):n.setAnimation(0,e.animation,!0),i.animationPosition?n.setPositionRound(i.animationPosition):n.setPosition(s.width/2,s.height/2),s.addChild(n),s},buyPackProduct:function(){new Product(this.pack.product).buy(function(){this.close(),cleverapps.packManager.onBuyPack()}.bind(this))},customize:function(){if(!cleverapps.styles.PackWindow.title){var e=cleverapps.styles.PackWindow.Title,t=[];Messages.get(this.pack.title).split(" ").forEach(function(e){t.push(cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.TILE_SHOP_WINDOW_TITLE_TEXT))});var i=new cleverapps.Layout(t.reverse(),{direction:cleverapps.UI.VERTICAL,margin:e.margin});this.window.addChild(i),i.setPositionRound(this.window.width/2,this.window.height+e.offsetY)}}});PackWindow.prototype.listBundles=function(){return[cleverapps.packManager.get().bundle]},cleverapps.styles.PackWindow={width:440,height:745,noAds:!1,noBackground:!0,title:void 0,margin:20,y:60,content:{height:{dy:0}},text:{margin:{width:10}},
description:{y:0},Title:{margin:-30,offsetY:145},BottomButton:{bottomPadding:40,width:260},button:{width:300,height:100,price:{margin:{x:10,y:0}},x:0,y:50,font:cleverapps.styles.FONTS.BUTTON_TEXT},window:{Title:{zIndex:1}}};var PackIcon=SideBarIcon.extend({ctor:function(e){this.pack=cleverapps.packManager.get();var t=cleverapps.overrideStyles(cleverapps.styles.SideBarIcon,cleverapps.styles.PackIcon,!0);t.animation&&"object"==typeof t.animation&&(t.animation=t.animation[this.pack.stage]),this._super(e,t,{title:cleverapps.styles.PackIcon.title}),Lottery.addIcon(this.container,"icon")},onEnter:function(){this._super(),cleverapps.packManager.onBuyPackListener=this.createListener(this.removeFromSideBar.bind(this))},onPressed:function(){this._super(),cleverapps.metha.display({focus:"PackWindow",action:function(e){new PackWindow,cleverapps.metha.onceNoWindowsListener=e}})}});PackIcon.IsAvailable=function(){return cleverapps.packManager.isAvailable()},cleverapps.styles.PackIcon={animation:{
0:bundles.sidebar.jsons.pack_icon_json,1:bundles.sidebar.jsons.pack1_icon_json,2:bundles.sidebar.jsons.pack2_icon_json}},cleverapps.ShareBonus=function(e){if(this.id=e.id,this.storageKey=cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_"+e.id,this.bonus=e.bonus,this.interval=cleverapps.parseInterval(e.interval),this.type=e.type,this.initStorageKey(e.startAvailable),e.isRewardedVideo&&cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)){var t=this.storageKey;this.storageKey+="_video",this.initStorageKey(e.startAvailable),this.isReady()?(this.type=cleverapps.ShareBonus.VIDEO,cleverapps.flags.reduceAds&&(this.bonus=cleverapps.ShareBonus.BONUS_REDUCED)):this.storageKey=t}cleverapps.ShareBonus.IsRewardAvailable()||this.type===cleverapps.ShareBonus.VIDEO||(this.bonus=0),this.takeBonusListener=function(){}},cleverapps.ShareBonus.prototype.initStorageKey=function(e){void 0===cleverapps.DataLoader.load(this.storageKey)&&cleverapps.DataLoader.save(
this.storageKey,e?0:Date.now())},cleverapps.ShareBonus.prototype.markTaken=function(){cleverapps.DataLoader.save(this.storageKey,Date.now())},cleverapps.ShareBonus.prototype.createShareCallback=function(t,i){return function(e){e===cleverapps.Social.CODE_SUCCEED?(i!==cleverapps.ShareBonus.REQUEST&&i!==cleverapps.ShareBonus.DIALOG||(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SHARE),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SHARE_ITEM,{id:this.id})),this.bonus&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARD_RECEIVED,{amount:this.bonus}),this.markTaken(),this.bonus&&(levels.user.setGold(levels.user.gold+this.bonus),this.takeBonusListener()),t()):console.log(Messages.get("ShareBonus.ShareFailed")+e)}.bind(this)},cleverapps.ShareBonus.cycleShareData=function(e,t){t=cleverapps.extend({},t||{},{gameTitle:Messages.get(cleverapps.config.title),gameName:cleverapps.config.name});var i=cc.loader.getRes(res.share_json)[e],s=cleverapps.DataLoader.load(
cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_"+e+"ShareId");void 0===s?s=Math.floor(3*Math.random()):s++,cleverapps.DataLoader.save(cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_"+e+"ShareId",s);var n=i[cleverapps.settings.language]||i[cc.sys.LANGUAGE_ENGLISH],o={};n&&(o.picture=n[s%n.length]),i.vk&&(o.vk=i.vk[s%i.vk.length]);var a=i.texts[s%i.texts.length];for(var r in a){var l=a[r];"to"===r?o[r]=Messages.replace(l,t):"string"==typeof l&&0===l.indexOf("messages:")&&(l=Messages.replace(l,t),o[r]=Messages.get(l,t))}return o},cleverapps.ShareBonus.prototype.request=function(t,i){cleverapps.social.checkConnection(function(){var e=cleverapps.ShareBonus.cycleShareData(this.id,i);cleverapps.social.request(e,this.createShareCallback(function(){cleverapps.history.add("rqst",1),t()},cleverapps.ShareBonus.REQUEST))}.bind(this))},cleverapps.ShareBonus.prototype.shareDialog=function(t,i){cleverapps.social.checkConnection(function(){
var e=cleverapps.ShareBonus.cycleShareData(this.id,i);cleverapps.social.shareDialog(e,this.createShareCallback(function(){cleverapps.history.add("share",1),t()},cleverapps.ShareBonus.DIALOG))}.bind(this))},cleverapps.ShareBonus.prototype.rewardedVideo=function(e){if(cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)){var t=this.createShareCallback(e,cleverapps.ShareBonus.VIDEO);cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,function(){t(cleverapps.Social.CODE_SUCCEED),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_SHARE)})}else cleverapps.Notification.create("messages:AdsUnavailable")},cleverapps.ShareBonus.prototype.takeBonus=function(e,t){switch(this.type){case cleverapps.ShareBonus.DIALOG:this.shareDialog(e,t);break;case cleverapps.ShareBonus.VIDEO:this.rewardedVideo(e);break;default:this.request(e,t)}},cleverapps.ShareBonus.prototype.isReady=function(){return parseInt(cc.sys.localStorage.getItem(this.storageKey)
)+this.interval<=Date.now()},cleverapps.ShareBonus.IsRewardAvailable=function(){if(cleverapps.flags.noviral||cleverapps.flags.noshares)return!1;var e=cleverapps.User.calcSource();return-1===["instant","mobile_vk"].indexOf(e)&&("mobile_ok"===e||"web_ok"===e||cleverapps.user.checkAvailable(cleverapps.ShareBonus.REWARD_AVAILABLE))},cleverapps.ShareBonus.DIALOG="dialog",cleverapps.ShareBonus.REQUEST="request",cleverapps.ShareBonus.VIDEO="video",cleverapps.ShareBonus.SHARES={victory:{bonus:20,interval:"20 minutes",type:cleverapps.ShareBonus.DIALOG,isRewardedVideo:!0},finishEpisode:{bonus:30,interval:"1 hour",type:cleverapps.ShareBonus.DIALOG,isRewardedVideo:!0,startAvailable:!0},beatFriend:{bonus:10,interval:"1 minute",type:cleverapps.ShareBonus.REQUEST,startAvailable:!0},champion:{bonus:20,interval:"1 hour",type:cleverapps.ShareBonus.DIALOG,isRewardedVideo:!0},newLeague:{bonus:50,interval:"1 hour",type:cleverapps.ShareBonus.DIALOG,isRewardedVideo:!0,startAvailable:!0},dailyCup:{bonus:20,
interval:"20 minutes",type:cleverapps.ShareBonus.DIALOG,isRewardedVideo:!0}},Object.keys(cleverapps.ShareBonus.SHARES).forEach(function(e){cleverapps.ShareBonus.SHARES[e].id=e}),cleverapps.ShareBonus.BONUS_REDUCED=10,cleverapps.ShareBonus.REWARD_AVAILABLE={episode:2,level:1};var ShareBonusButton=BonusButton.extend({ctor:function(e){var t=this.shareBonus=new cleverapps.ShareBonus(e.shareBonus),i=e.callback||function(){},s=t.type===cleverapps.ShareBonus.VIDEO?"messages:WatchAd":"messages:Share",n={score:e.score};e.level&&(n.levelNo=e.level.getHumanReadableNumber()),e.toReplace&&cleverapps.override(n,e.toReplace),this._super({reward:t.bonus,text:s,onClick:function(){t.takeBonus(this.createListener(function(){Buttons.remove(this),e.window&&e.window.addReward&&e.window.addReward(t.bonus)?i():this.animateCollectCoin(i)}.bind(this)),n)}})}});ShareBonusButton.create=function(e){var t=new cleverapps.ShareBonus(e.shareBonus);if(
!cleverapps.flags.noviral&&!cleverapps.flags.noshares&&cleverapps.social.isLoggedIn()&&t.isReady())return new ShareBonusButton(e)},cleverapps.styles.ShareBonusButton={width:280,height:110};var ShareCheckBox=cleverapps.UI.CheckBox.extend({ctor:function(e,t){this.window=t,this.shareOptions=e,this._super({onChange:this.onChange.bind(this),label:{text:"messages:Share",font:this.window.withBg?cleverapps.styles.FONTS.WINDOW_TEXT:cleverapps.styles.FONTS.WHITE_TEXT,clickable:!0},styles:cleverapps.styles.ShareCheckBox}),this.updateState()},onChange:function(e){ShareCheckBox.UNCHECKED[this.window.name]=!e},shareDialog:function(t){cleverapps.social.checkConnection(function(){var e=cleverapps.ShareBonus.cycleShareData(t.shareId,t.toReplace);cleverapps.social.shareDialog(e,function(e){e===cleverapps.Social.CODE_SUCCEED?(cleverapps.history.add("share",1),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SHARE),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SHARE_ITEM,{id:t.shareId})):console.log(
Messages.get("ShareBonus.ShareFailed")+e)}.bind(this))}.bind(this))},updateState:function(){this.checkBox.setSelected(this.isWindowChecked())},onWindowClose:function(){this.isWindowChecked()&&this.shareDialog(this.shareOptions)},isWindowChecked:function(){return!ShareCheckBox.UNCHECKED[this.window.name]}});ShareCheckBox.UNCHECKED={},cleverapps.styles.ShareCheckBox={margin:15,padding:{x:0,y:0},checkImage:res.select_friend_checkbox_selected,bgImage:res.select_friend_checkbox};var Messages={dictionary:void 0,onInitializedListeners:{},isInitialized:function(){return this.dictionary},get:function(e,t){if(!Messages.dictionary)return"";"string"==typeof e&&0===e.indexOf("messages:")&&(e=e.substring("messages:".length));var i=cleverapps.skins.getSlot("localization");i[e]&&(e=i[e]);var s=Messages.dictionary[e];if(void 0===s)return console.log("WARN: langugage_"+cleverapps.settings.language),console.log("Cant find TEXT string by code: "+e),console.log((new Error).stack),"";if(Array.isArray(s)
)for(var n=0;n<s.length;n++)s[n]=Messages.replace(s[n],t);else s=Messages.replace(s,t);return s},has:function(e){return!!Messages.dictionary&&("string"==typeof e&&0===e.indexOf("messages:")&&(e=e.substring("messages:".length)),Messages.dictionary[e])},replace:function(e,t){if(void 0===t&&(t={}),"string"==typeof e&&-1!==e.indexOf("%{facebook}")){var i=cleverapps.social.getCode();"mobile_ok"!==i&&"web_ok"!==i||(i="ok"),"mobile_vk"!==i&&"web_vk"!==i||(i="vk"),"mbga"!==i&&"sp_mbga"!==i||(i="mbga"),"nk"===i&&(i="nk"),Messages.dictionary[i]||(i="facebook"),t.facebook=Messages.get(i)}if("string"==typeof e)for(var s in t){var n=t[s];"string"==typeof n&&0===n.indexOf("messages:")&&(n=Messages.get(n)),e=(e=e.replace("%{"+s+"}",n)).replace("%{"+s+"}",n)}return e},getLocalized:function(e,t){if("string"==typeof e)return 0===e.indexOf("messages:")&&(e=Messages.get(e.substring("messages:".length))),e=Messages.replace(e,t);if("object"==typeof e&&0<cleverapps.intersect(Object.keys(e),
cleverapps.Settings.getAvailableLanguages()).length)return e=void 0!==e[cleverapps.settings.language]?e[cleverapps.settings.language]:e[cc.sys.LANGUAGE_ENGLISH],Messages.getLocalized(e,t);if("object"!=typeof e)return e;for(var i in e=cleverapps.clone(e))e[i]=Messages.getLocalized(e[i],t);return e},preload:function(t,i){cleverapps.bundleLoader.loadBundle("language_"+t,{onSuccess:function(e){Messages.dictionary={},[e.jsons.common_json,e.jsons.lang_json,e.jsons.skin_json,e.jsons.project_json,e.jsons.farm_json,e.jsons.solitaire_json].forEach(function(e){e&&cleverapps.extend(Messages.dictionary,cc.loader.getRes(e))}),cleverapps.bundleLoader.deleteBundle("language_"+t),cleverapps.values(Messages.onInitializedListeners).forEach(cleverapps.callFunc),i()},blocked:!0})}};cleverapps.LocalizationManager={run:function(){(void 0===cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.LOCALIZATION_MANAGER)&&this.hasInconsistentLanguage()||this.hasFirstInitLanguageWindow()
)&&this.displayLanguageWindow()},hasInconsistentLanguage:function(){var e=cleverapps.settings.language,t=cleverapps.Settings.getAvailableLanguages(),i=cleverapps.Settings.getDefaultLanguage();return e!==i&&0<=t.indexOf(i)},hasFirstInitLanguageWindow:function(){return 0===levels.user.episode&&0===levels.user.level&&"plinga"===cleverapps.User.calcSource()&&"riddles"===cleverapps.config.name},displayLanguageWindow:function(){cleverapps.metha.displayWhenFreeFocus({focus:"displayInconsistentLanguage",action:function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.LOCALIZATION_MANAGER,1),new LanguagesWindow,cleverapps.metha.onceNoWindowsListener=e}})}},cleverapps.TempGoods=function(){this.load()},cleverapps.TempGoods.prototype.buyGood=function(e,t){this.checkGoodBuyed(e)?this.currentGooods[e].actionTime+=t:this.currentGooods[e]={buyTime:Date.now(),actionTime:t,fpShowed:0},this.save()},cleverapps.TempGoods.prototype.reset=function(){this.currentGooods={},this.save()},
cleverapps.TempGoods.prototype.resetGood=function(e){this.currentGooods[e]&&(delete this.currentGooods[e],this.save())},cleverapps.TempGoods.prototype.goodLeftTime=function(e){if(void 0===this.currentGooods[e])return 0;var t=this.currentGooods[e].buyTime+this.currentGooods[e].actionTime-Date.now();return t<=0?0:t},cleverapps.TempGoods.prototype.checkGoodBuyed=function(e){return 0<this.goodLeftTime(e)},cleverapps.TempGoods.prototype.displayPromotionOnFinish=function(){if(!cleverapps.flags.nopayments)for(var e in this.currentGooods)if(!this.currentGooods[e].fpShowed&&0===this.goodLeftTime(e))return void this.showPromotion(e)},cleverapps.TempGoods.prototype.showPromotion=function(t){cleverapps.metha.display({focus:"TempGoodFinishWindow",action:function(e){this.currentGooods[t].fpShowed=1,this.save(),new TempGoodFinishWindow(t),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},cleverapps.TempGoods.prototype.getInfo=function(){return this.currentGooods},
cleverapps.TempGoods.prototype.updateInfo=function(e,t){this.currentGooods=e,this.save(t)},cleverapps.TempGoods.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.TEMP_GOODS);this.currentGooods=void 0!==e?e:{}},cleverapps.TempGoods.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.TEMP_GOODS,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("tempgoods")},cleverapps.TempGoods.UNLIMITED_LIVES=1;var TempGoodFinishWindow=Window.extend({onWindowLoaded:function(e){this.goodType=parseInt(e);var t=cleverapps.styles.TempGoodFinishWindow,i=new cc.Node;if(i.setContentSize(t.width,t.height),i.setAnchorPoint(.5,.5),t.animation.json){var s=new cleverapps.Spine(t.animation.json);i.addChild(s),s.setAnimation(0,"no_life",!0),s.setPosition(cleverapps.styles.TempGoodFinishWindow.sad_icon.x,cleverapps.styles.TempGoodFinishWindow.sad_icon.y)}var n=cleverapps.UI.generateTTFText("messages:TempGoodsFinishWindow.unlimitedLivesText",
cleverapps.styles.FONTS.WINDOW_TEXT);if(i.addChild(n),n.setDimensions(cleverapps.styles.TempGoodFinishWindow.text.width,0),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setPosition(cleverapps.styles.TempGoodFinishWindow.text.x,cleverapps.styles.TempGoodFinishWindow.text.y),t.goodIcon){var o=new cc.Sprite(bundles.reward_icons.frames.life_unlim);i.addChild(o),o.setPosition(cleverapps.styles.TempGoodFinishWindow.good_icon.x,cleverapps.styles.TempGoodFinishWindow.good_icon.y)}var a=cleverapps.overrideStyles(cleverapps.styles.Window,t.window,!0);this._super({content:i,title:"messages:TempGoodsFinishWindow.title",name:"tempgoodsfinishwindow",styles:a,button:{content:this.getButtonContent(),width:cleverapps.styles.TempGoodFinishWindow.button.width,height:cleverapps.styles.TempGoodFinishWindow.button.height,onPressed:this.onBuy.bind(this)}}),Lottery.addIcon(this.button),t.hero&&(this.hero=new cleverapps.Spine(t.hero.json,1),this.hero.setAnimation(0,t.hero.animation,!0),
this.hero.setPositionRound(t.hero),this.addChild(this.hero)),cleverapps.audio.playSound(bundles.game.urls.lose_effect)},onBuy:function(){if(this.goodType===cleverapps.TempGoods.UNLIMITED_LIVES){var e=new Product("unlimitedLives"),t=function(){this.close()}.bind(this);e.buy(t)}},getButtonContent:function(){if(this.goodType===cleverapps.TempGoods.UNLIMITED_LIVES)return new ProductPriceView(new Product("unlimitedLives"),{font:cleverapps.styles.FONTS.BUTTON_TEXT});var e=new cc.Node;return e.setAnchorPoint(.5,.5),e},listBundles:function(){return cleverapps.Spine.listBundles([cleverapps.styles.TempGoodFinishWindow.animation.json,cleverapps.styles.TempGoodFinishWindow.hero&&cleverapps.styles.TempGoodFinishWindow.hero.json])}});cleverapps.styles.TempGoodFinishWindow={width:650,height:400,goodIcon:!0,sad_icon:{x:100,y:190},good_icon:{x:170,y:110},text:{x:450,y:190,width:400},button:{width:300,height:100},window:{},animation:{json:bundles.starchest_window.jsons.starchest_life_jelly_spine_json}},
function(n,d){"use strict";var h="function",e="undefined",t="model",i="name",s="type",o="vendor",a="version",r="architecture",l="console",c="mobile",p="tablet",u="smarttv",v="wearable",g={extend:function(e,t){var i={};for(var s in e)t[s]&&t[s].length%2==0?i[s]=t[s].concat(e[s]):i[s]=e[s];return i},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:d},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},m={rgx:function(e,t){for(var i,s,n,o,a,r,l=0;l<t.length&&!a;){var c=t[l],p=t[l+1];for(i=s=0;i<c.length&&!a;)if(a=c[i++].exec(e))for(n=0;n<p.length;n++)r=a[++s],"object"==typeof(o=p[n])&&0<o.length?2==o.length?typeof o[1]==h?this[o[0]]=o[1].call(this,r):this[o[0]]=o[1]:3==o.length?typeof o[1]!==h||o[1].exec&&o[1].test?this[o[0]]=r?r.replace(o[1],o[2]):d:this[o[0]]=r?o[1].call(this,r,o[2]
):d:4==o.length&&(this[o[0]]=r?o[3].call(this,r.replace(o[1],o[2])):d):this[o]=r||d;l+=2}},str:function(e,t){for(var i in t)if("object"==typeof t[i]&&0<t[i].length){for(var s=0;s<t[i].length;s++)if(g.has(t[i][s],e))return"?"===i?d:i}else if(g.has(t[i],e))return"?"===i?d:i;return e}},f={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},_={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[i,a],[/(opios)[\/\s]+([\w\.]+)/i],[[i,"Opera Mini"],a],[/\s(opr)\/([\w\.]+)/i],[[i,"Opera"],a],[/(kindle)\/([\w\.]+)/i,
/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser)\/([\w\.-]+)/i],[i,a],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[i,"IE"],a],[/(edge)\/((\d+)?[\w\.]+)/i],[i,a],[/(yabrowser)\/([\w\.]+)/i],[[i,"Yandex"],a],[/(puffin)\/([\w\.]+)/i],[[i,"Puffin"],a],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[i,"UCBrowser"],a],[/(comodo_dragon)\/([\w\.]+)/i],[[i,/_/g," "],a],[/(micromessenger)\/([\w\.]+)/i],[[i,"WeChat"],a],[/(QQ)\/([\d\.]+)/i],[i,a],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[i,a],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[a,[i,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[a,[i,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[a,[i,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[i,/(.+)/,"$1 WebView"],a],[
/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[i,/(.+(?:g|us))(.+)/,"$1 $2"],a],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[a,[i,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[i,a],[/(dolfin)\/([\w\.]+)/i],[[i,"Dolphin"],a],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[i,"Chrome"],a],[/(coast)\/([\w\.]+)/i],[[i,"Opera Coast"],a],[/fxios\/([\w\.-]+)/i],[a,[i,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[a,[i,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[a,i],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[i,"GSA"],a],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[i,[a,m.str,f.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[i,a],[/(navigator|netscape)\/([\w\.-]+)/i],[[i,"Netscape"],a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,
/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[i,a]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[r,"amd64"]],[/(ia32(?=;))/i],[[r,g.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[r,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[r,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[r,/ower/,"",g.lowerize]],[/(sun4\w)[;\)]/i],[[r,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[r,g.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[t,o,[s,p]],[/applecoremedia\/[\w\.]+ \((ipad)/],[t,[o,"Apple"],[s,p]],[/(apple\s{0,1}tv)/i],[[t,"Apple TV"],[o,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,
/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[o,t,[s,p]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[t,[o,"Amazon"],[s,p]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[t,m.str,f.device.amazon.model],[o,"Amazon"],[s,c]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[t,o,[s,c]],[/\((ip[honed|\s\w*]+);/i],[t,[o,"Apple"],[s,c]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[o,t,[s,c]],[/\(bb10;\s(\w+)/i],[t,[o,"BlackBerry"],[s,c]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[t,[o,"Asus"],[s,p]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[o,"Sony"],[t,"Xperia Tablet"],[s,p]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[t,[o,"Sony"],[s,c]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[o,t,[s,l]],[/android.+;\s(shield)\sbuild/i],[t,[o,"Nvidia"],[s,l]],[
/(playstation\s[34portablevi]+)/i],[t,[o,"Sony"],[s,l]],[/(sprint\s(\w+))/i],[[o,m.str,f.device.sprint.vendor],[t,m.str,f.device.sprint.model],[s,c]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[o,t,[s,p]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[o,[t,/_/g," "],[s,c]],[/(nexus\s9)/i],[t,[o,"HTC"],[s,p]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[t,[o,"Huawei"],[s,c]],[/(microsoft);\s(lumia[\s\w]+)/i],[o,t,[s,c]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[t,[o,"Microsoft"],[s,l]],[/(kin\.[onetw]{3})/i],[[t,/\./g," "],[o,"Microsoft"],[s,c]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[t,[o,"Motorola"],[s,c]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[t,[o,"Motorola"],[s,p]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[o,g.trim],[t,g.trim],[s,u]],[/hbbtv.+maple;(\d+)/i],[[t,/^/,
"SmartTV"],[o,"Samsung"],[s,u]],[/\(dtv[\);].+(aquos)/i],[t,[o,"Sharp"],[s,u]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[o,"Samsung"],t,[s,p]],[/smart-tv.+(samsung)/i],[o,[s,u],t],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[o,"Samsung"],t,[s,c]],[/sie-(\w+)*/i],[t,[o,"Siemens"],[s,c]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[o,"Nokia"],t,[s,c]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[t,[o,"Acer"],[s,p]],[/android.+([vl]k\-?\d{3})\s+build/i],[t,[o,"LG"],[s,p]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[o,"LG"],t,[s,p]],[/(lg) netcast\.tv/i],[o,t,[s,u]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[t,[o,"LG"],[s,c]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[t,[o,"Lenovo"],[s,p]],[/linux;.+((jolla));/i],[o,t,[s,c]],[/((pebble))app\/[\d\.]+\s/i],[o,t,[s,v]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[o,t,[s,c]
],[/crkey/i],[[t,"Chromecast"],[o,"Google"]],[/android.+;\s(glass)\s\d/i],[t,[o,"Google"],[s,v]],[/android.+;\s(pixel c)\s/i],[t,[o,"Google"],[s,p]],[/android.+;\s(pixel xl|pixel)\s/i],[t,[o,"Google"],[s,c]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[t,/_/g," "],[o,"Xiaomi"],[s,c]],[/android.+(mi[\s\-_]*(?:pad)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[t,/_/g," "],[o,"Xiaomi"],[s,p]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[t,[o,"Meizu"],[s,p]],[/android.+a000(1)\s+build/i],[t,[o,"OnePlus"],[s,c]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[t,[o,"RCA"],[s,p]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[t,[o,"Dell"],[s,p]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[t,[o,"Verizon"],[s,p]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[o,"Barnes & Noble"],t,[s,p]],[
/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[t,[o,"NuVision"],[s,p]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[o,"ZTE"],t,[s,p]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[t,[o,"Swiss"],[s,c]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[t,[o,"Swiss"],[s,p]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[t,[o,"Zeki"],[s,p]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[o,"Dragon Touch"],t,[s,p]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[t,[o,"Insignia"],[s,p]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[t,[o,"NextBook"],[s,p]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[o,"Voice"],t,[s,c]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[o,"LvTel"],t,[s,c]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[t,[o,"Envizen"],[s,p]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[o,t,[s,p]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[t,[o,"MachSpeed"],[s,
p]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[o,t,[s,p]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[t,[o,"Rotor"],[s,p]],[/android.+(KS(.+))\s+build/i],[t,[o,"Amazon"],[s,p]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[o,t,[s,p]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[s,g.lowerize],o,t],[/(android.+)[;\/].+build/i],[t,[o,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[a,[i,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[i,a],[/rv\:([\w\.]+).*(gecko)/i],[a,i]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[i,a],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[i,[a,m.str,f.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[i,"Windows"],[a,m.str,f.os.windows.version]],[/\((bb)(10);/i],[[i,"BlackBerry"],a],[
/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[i,a],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[i,"Symbian"],a],[/\((series40);/i],[i],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[i,"Firefox OS"],a],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[i,a],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[i,"Chromium OS"],a],[/(sunos)\s?([\w\.]+\d)*/i],[[i,"Solaris"],a],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[i,a],[/(haiku)\s(\w+)/i],[i,a],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[a,/_/g,"."],[i,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[
[i,"Mac OS"],[a,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[i,a]]},y=function(e,t){if("object"==typeof e&&(t=e,e=d),!(this instanceof y))return new y(e,t).getResult();var i=e||(n&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:""),s=t?g.extend(_,t):_;return this.getBrowser=function(){var e={name:d,version:d};return m.rgx.call(e,i,s.browser),e.major=g.major(e.version),e},this.getCPU=function(){var e={architecture:d};return m.rgx.call(e,i,s.cpu),e},this.getDevice=function(){var e={vendor:d,model:d,type:d};return m.rgx.call(e,i,s.device),e},this.getEngine=function(){var e={name:d,version:d};return m.rgx.call(e,i,s.engine),e},this.getOS=function(){var e={name:d,version:d};return m.rgx.call(e,i,s.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),
cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this};y.VERSION="0.7.17",y.BROWSER={NAME:i,MAJOR:"major",VERSION:a},y.CPU={ARCHITECTURE:r},y.DEVICE={MODEL:t,VENDOR:o,TYPE:s,CONSOLE:l,MOBILE:c,SMARTTV:u,TABLET:p,WEARABLE:v,EMBEDDED:"embedded"},y.ENGINE={NAME:i,VERSION:a},y.OS={NAME:i,VERSION:a},typeof exports!==e?(typeof module!==e&&module.exports&&(exports=module.exports=y),exports.UAParser=y):typeof define===h&&define.amd?define(function(){return y}):n&&(n.UAParser=y);var w=n&&(n.jQuery||n.Zepto);if(typeof w!==e){var b=new y;w.ua=b.getResult(),w.ua.get=function(){return b.getUA()},w.ua.set=function(e){b.setUA(e);var t=b.getResult();for(var i in t)w.ua[i]=t[i]}}}("object"==typeof window?window:this),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.SuperGif=t()}(this,function(){var r=function(e){return e.reduce(function(e,t){return 2*e+t},0)},l=function(e){for(var t=[],i=7;0<=i;i--
)t.push(!!(e&1<<i));return t},se=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],i=0;i<e;i++)t.push(this.readByte());return t},this.read=function(e){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},ne=function(n,o){o||(o={});var s=function(e){for(var t=[],i=0;i<e;i++)t.push(n.readBytes(3));return t},a=function(){var e,t;for(t="";e=n.readByte(),t+=n.read(e),0!==e;);return t},t=function(e){e.leftPos=n.readUnsigned(),e.topPos=n.readUnsigned(),e.width=n.readUnsigned(),e.height=n.readUnsigned();var t=l(n.readByte());e.lctFlag=t.shift(),e.interlaced=t.shift(),e.sorted=t.shift(),e.reserved=t.splice(0,2),e.lctSize=r(t.splice(0,3)),e.lctFlag&&(e.lct=s(
1<<e.lctSize+1)),e.lzwMinCodeSize=n.readByte();var i=a();e.pixels=function(t,s){for(var e,i,n=0,o=function(e){for(var t=0,i=0;i<e;i++)s.charCodeAt(n>>3)&1<<(7&n)&&(t|=1<<i),n++;return t},a=[],r=1<<t,l=r+1,c=t+1,p=[],d=function(){p=[],c=t+1;for(var e=0;e<r;e++)p[e]=[e];p[r]=[],p[l]=null};;)if(i=e,(e=o(c))!==r){if(e===l)break;if(e<p.length)i!==r&&p.push(p[i].concat(p[e][0]));else{if(e!==p.length)throw new Error("Invalid LZW code.");p.push(p[i].concat(p[i][0]))}a.push.apply(a,p[e]),p.length===1<<c&&c<12&&c++}else d();return a}(e.lzwMinCodeSize,i),e.interlaced&&(e.pixels=function(e,t){for(var i,s,n,o=new Array(e.length),a=e.length/t,r=[0,4,2,1],l=[8,8,4,2],c=0,p=0;p<4;p++)for(var d=r[p];d<a;d+=l[p])i=d,s=c,n=e.slice(s*t,(s+1)*t),o.splice.apply(o,[i*t,t].concat(n)),c++;return o}(e.pixels,e.width)),o.img&&o.img(e)},i=function(){var e={};switch(e.sentinel=n.readByte(),String.fromCharCode(e.sentinel)){case"!":e.type="ext",function(e){var t,i;switch(e.label=n.readByte(),e.label){case 249:
e.extType="gce",function(e){n.readByte();var t=l(n.readByte());e.reserved=t.splice(0,3),e.disposalMethod=r(t.splice(0,3)),e.userInput=t.shift(),e.transparencyGiven=t.shift(),e.delayTime=n.readUnsigned(),e.transparencyIndex=n.readByte(),e.terminator=n.readByte(),o.gce&&o.gce(e)}(e);break;case 254:e.extType="com",(i=e).comment=a(),o.com&&o.com(i);break;case 1:e.extType="pte",s=e,n.readByte(),s.ptHeader=n.readBytes(12),s.ptData=a(),o.pte&&o.pte(s);break;case 255:e.extType="app",function(e){var t,i;switch(n.readByte(),e.identifier=n.read(8),e.authCode=n.read(3),e.identifier){case"NETSCAPE":i=e,n.readByte(),i.unknown=n.readByte(),i.iterations=n.readUnsigned(),i.terminator=n.readByte(),o.app&&o.app.NETSCAPE&&o.app.NETSCAPE(i);break;default:(t=e).appData=a(),o.app&&o.app[t.identifier]&&o.app[t.identifier](t)}}(e);break;default:e.extType="unknown",(t=e).data=a(),o.unknown&&o.unknown(t)}var s}(e);break;case",":e.type="img",t(e);break;case";":e.type="eof",o.eof&&o.eof(e);break;default:
throw new Error("Unknown block: 0x"+e.sentinel.toString(16))}"eof"!==e.type&&setTimeout(i,0)};!function(){var e={};if(e.sig=n.read(3),e.ver=n.read(3),"GIF"!==e.sig)throw new Error("Not a GIF file.");e.width=n.readUnsigned(),e.height=n.readUnsigned();var t=l(n.readByte());e.gctFlag=t.shift(),e.colorRes=r(t.splice(0,3)),e.sorted=t.shift(),e.gctSize=r(t.splice(0,3)),e.bgColor=n.readByte(),e.pixelAspectRatio=n.readByte(),e.gctFlag&&(e.gct=s(1<<e.gctSize+1)),o.hdr&&o.hdr(e)}(),setTimeout(i,0)};return function(e){var s,n,r={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var t in e)r[t]=e[t];r.vp_w&&r.vp_h&&(r.is_vp=!0);var i=null,o=!1,a=null,l=null,c=null,p=null,d=null,h=null,u=null,v=!0,g=!1,m=[],f=[],_=[],y=r.gif;if(!y){var w=new Image;w.crossOrigin="Anonymous",w.src="",y=w}void 0===r.auto_play&&(r.auto_play=!y.getAttribute("rel:auto_play")||"1"==y.getAttribute("rel:auto_play"));var b,S,T,C,E,A,I,L,O,R,P,B,M=r.hasOwnProperty("on_end")?r.on_end:null,x=r.hasOwnProperty("loop_delay"
)?r.loop_delay:0,N=r.hasOwnProperty("loop_mode")?r.loop_mode:"auto",D=!r.hasOwnProperty("draw_while_loading")||r.draw_while_loading,k=!!D&&(!r.hasOwnProperty("show_progress_bar")||r.show_progress_bar),F=r.hasOwnProperty("progressbar_height")?r.progressbar_height:25,V=r.hasOwnProperty("progressbar_background_color")?r.progressbar_background_color:"rgba(255,255,255,0.4)",G=r.hasOwnProperty("progressbar_foreground_color")?r.progressbar_foreground_color:"rgba(255,0,22,.8)",U=function(){d=c,h=c=l=a=null},W=function(){try{ne(s,J)}catch(e){z("parse")}},j=function(e,t){O.width=e*$(),O.height=t*$(),P.style.minWidth=e*$()+"px",B.width=e,B.height=t,B.style.width=e+"px",B.style.height=t+"px",B.getContext("2d").setTransform(1,0,0,1,0,0)},H=function(e,t,i){if(i&&k){var s,n,o,a=F;r.is_vp?g?(n=(r.vp_t+r.vp_h-a)/$(),a/=$(),s=r.vp_l/$()+e/t*(r.vp_w/$()),o=O.width/$()):(n=r.vp_t+r.vp_h-a,a=a,s=r.vp_l+e/t*r.vp_w,o=O.width):(n=(O.height-a)/(g?$():1),s=e/t*O.width/(g?$():1),o=O.width/(g?$():1),a/=g?$():1),
R.fillStyle=V,R.fillRect(s,n,o-s,a),R.fillStyle=G,R.fillRect(0,n,s,a)}},z=function(e){i=e,n={width:y.width,height:y.height},m=[],f=[]},Y=function(){if(h){m.push({data:h.getImageData(0,0,n.width,n.height),delay:l}),_.push({x:0,y:0});var e=new Image;e.addEventListener("load",function(){f.push(e)},!1),e.src=h.canvas.toDataURL()}},X=(C=-1,E=0,A=function(e){C+=e,L()},b=!1,S=function(){null!==M&&M(y),E++,!1!==N||E<0?T():v=b=!1},T=function(){if(b=v){A(1);var e=10*m[C].delay;e||(e=100),0==(C+1+m.length)%m.length?(e+=x,setTimeout(S,e)):setTimeout(T,e)}},L=function(){var e;(C=parseInt(C,10))>m.length-1&&(C=0),C<0&&(C=0),e=_[C],B.getContext("2d").putImageData(m[C].data,e.x,e.y),R.globalCompositeOperation="copy",R.drawImage(B,0,0)},{init:function(){i||(r.c_w&&r.c_h||R.scale($(),$()),r.auto_play?I():(C=0,L()))},step:I=function(){b||setTimeout(T,0)},play:function(){v=!0,I()},pause:function(){v=!1},getFrames:function(){return f},playing:v,move_relative:A,current_frame:function(){return C},
length:function(){return m.length},move_to:function(e){C=e,L()}}),K=function(e){H(s.pos,s.data.length,e)},q=function(){},Z=function(t,i){return function(e){t(e),K(i)}},J={hdr:Z(function(e){j((n=e).width,n.height)}),gce:Z(function(e){Y(),U(),a=e.transparencyGiven?e.transparencyIndex:null,l=e.delayTime,c=e.disposalMethod}),com:Z(q),app:{NETSCAPE:Z(q)},img:Z(function(e){h||(h=B.getContext("2d"));var t=m.length,i=e.lctFlag?e.lct:n.gct;0<t&&(3===d?null!==p?h.putImageData(m[p].data,0,0):h.clearRect(u.leftPos,u.topPos,u.width,u.height):p=t-1,2===d&&h.clearRect(u.leftPos,u.topPos,u.width,u.height));var s=h.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach(function(e,t){e!==a&&(s.data[4*t+0]=i[e][0],s.data[4*t+1]=i[e][1],s.data[4*t+2]=i[e][2],s.data[4*t+3]=255)}),h.putImageData(s,e.leftPos,e.topPos),g||(R.scale($(),$()),g=!0),D&&(R.drawImage(B,0,0),D=r.auto_play),u=e},!0),eof:function(e){Y(),K(!1),r.c_w&&r.c_h||(O.width=n.width*$(),O.height=n.height*$()),X.init(),o=!1,te&&te(y)
}},Q=function(){var e=y.parentNode;e||(e=document.createElement("div")).appendChild(y);var t=document.createElement("div");O=document.createElement("canvas"),R=O.getContext("2d"),P=document.createElement("div"),B=document.createElement("canvas"),t.width=O.width=y.width,t.height=O.height=y.height,P.style.minWidth=y.width+"px",t.className="jsgif",P.className="jsgif_toolbar",t.appendChild(O),t.appendChild(P),e.insertBefore(t,y),e.removeChild(y),r.c_w&&r.c_h&&j(r.c_w,r.c_h),ee=!0},$=function(){return r.max_width&&n&&n.width>r.max_width?r.max_width/n.width:1},ee=!1,te=!1,ie=function(e){return!(o||(te=e||!1,o=!0,m=[],f=[],U(),u=h=d=p=null))};return{play:X.play,pause:X.pause,getFrames:X.getFrames,move_relative:X.move_relative,move_to:X.move_to,get_playing:function(){return v},get_canvas:function(){return O},get_canvas_scale:function(){return $()},get_loading:function(){return o},get_auto_play:function(){return r.auto_play},get_length:function(){return X.length()},get_current_frame:function(){
return X.current_frame()},load_url:function(e,t){if(ie(t)){var i=new XMLHttpRequest;i.open("GET",e,!0),"overrideMimeType"in i?i.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in i?i.responseType="arraybuffer":i.setRequestHeader("Accept-Charset","x-user-defined"),i.onloadstart=function(){ee||Q()},i.onload=function(e){200!=this.status&&z("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var t=this.response;0<t.toString().indexOf("ArrayBuffer")&&(t=new Uint8Array(t)),s=new se(t),setTimeout(W,0)},i.onprogress=function(e){e.lengthComputable&&H(e.loaded,e.total,!0)},i.onerror=function(){z("xhr")},i.send()}},load:function(e){this.load_url(y.getAttribute("rel:animated_src")||y.src,e)},load_raw:function(e,t){ie(t)&&(ee||Q(),s=new se(e),setTimeout(W,0))},set_frame_offset:function(e,t){_[e]?(void 0!==t.x&&(_[e].x=t.x),void 0!==t.y&&(_[e].y=t.y)):_[e]=t}}}}),function(){function s(e,t){
var i=this instanceof s?this:n;return i.reset(t),"string"==typeof e&&0<e.length&&i.hash(e),i!==this?i:void 0}var n;s.prototype.hash=function(e){var t,i,s,n,o;switch(o=e.length,this.len+=o,i=this.k1,s=0,this.rem){case 0:i^=s<o?65535&e.charCodeAt(s++):0;case 1:i^=s<o?(65535&e.charCodeAt(s++))<<8:0;case 2:i^=s<o?(65535&e.charCodeAt(s++))<<16:0;case 3:i^=s<o?(255&e.charCodeAt(s))<<24:0,i^=s<o?(65280&e.charCodeAt(s++))>>8:0}if(this.rem=3&o+this.rem,0<(o-=this.rem)){for(t=this.h1;t=4294967295&5*(t=(t^=i=4294967295&13715*(i=(i=4294967295&11601*i+3432906752*(65535&i))<<15|i>>>17)+461832192*(65535&i))<<13|t>>>19)+3864292196,!(o<=s);)i=65535&e.charCodeAt(s++)^(65535&e.charCodeAt(s++))<<8^(65535&e.charCodeAt(s++))<<16,i^=(255&(n=e.charCodeAt(s++)))<<24^(65280&n)>>8;switch(i=0,this.rem){case 3:i^=(65535&e.charCodeAt(s+2))<<16;case 2:i^=(65535&e.charCodeAt(s+1))<<8;case 1:i^=65535&e.charCodeAt(s)}this.h1=t}return this.k1=i,this},s.prototype.result=function(){var e,t;return e=this.k1,t=this.h1,
0<e&&(t^=e=4294967295&13715*(e=(e=4294967295&11601*e+3432906752*(65535&e))<<15|e>>>17)+461832192*(65535&e)),t^=this.len,t=4294967295&51819*(t^=t>>>16)+2246770688*(65535&t),t=4294967295&44597*(t^=t>>>13)+3266445312*(65535&t),(t^=t>>>16)>>>0},s.prototype.reset=function(e){return this.h1="number"==typeof e?e:0,this.rem=this.k1=this.len=0,this},n=new s,"undefined"!=typeof module?module.exports=s:this.MurmurHash3=s}();var RecursiveHasher=function(t,i,s){if("object"==typeof t){if(void 0===s&&(s=new MurmurHash3,i=cleverapps.createSet(i)),Array.isArray(t)){s.hash(""+t.length);for(var e=0;e<t.length;e++)RecursiveHasher(t[e],i,s)}else{Object.keys(t).sort().forEach(function(e){!i[e]&&t[e]&&(s.hash(e),RecursiveHasher(t[e],i,s))})}return s.result()}"number"==typeof t?s.hash(""+t):s.hash(t)};cleverapps.BoostersCounter=function(e){e?this.initialize():this.load(),this.onChangeListener=function(){},this.onChangeListeners={}},cleverapps.BoostersCounter.prototype.initialize=function(){this.data={},
this.addInitAmount()},cleverapps.BoostersCounter.prototype.addInitAmount=function(e){var t=[void 0!==CellBooster?CellBooster.ID:void 0,void 0!==LineBooster?LineBooster.ID:void 0,void 0!==ColorBooster?ColorBooster.ID:void 0,"undefined"!=typeof HintBooster?HintBooster.ID:void 0];"match3"===cleverapps.config.type&&(t=t.concat([BoostersBefore.TYPE_COMBO,BoostersBefore.TYPE_MOVES,BoostersBefore.TYPE_MULTICOLOR])),"solitaire"===cleverapps.config.type&&(t=t.concat([BoostersBefore.TYPE_MAGNET,BoostersBefore.TYPE_DICE,BoostersBefore.TYPE_TWO_JOKERS]));var i=!1;t.forEach(function(e){void 0!==e&&void 0===this.data[e]&&(this.data[e]=cleverapps.BoostersCounter.INIT_AMOUNT,i=!0)},this),i&&!e&&this.save()},cleverapps.BoostersCounter.prototype.totalAmount=function(){var e=0;for(var t in this.data)e+=this.data[t];return e},cleverapps.BoostersCounter.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.BOOSTERS_COUNTER);this.data=e||{},this.addInitAmount()},
cleverapps.BoostersCounter.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.BOOSTERS_COUNTER,this.data),!1!==e&&cleverapps.synchronizer.addUpdateTask("boosters")},cleverapps.BoostersCounter.prototype.getAmount=function(e){return this.data[e]?this.data[e]:0},cleverapps.BoostersCounter.prototype.canUse=function(e){return 0<this.getAmount(e)},cleverapps.BoostersCounter.prototype.use=function(e){this.canUse(e)&&(this.data[e]=this.data[e]-1,this.save(),BoostersBeforeConfig[e]||cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.USE_BOOSTER,{booster:e}),("undefined"!=typeof HintBooster&&e===HintBooster.ID||"undefined"!=typeof DiscoverBooster&&e===DiscoverBooster.ID)&&cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.USE_HINTS),this.runChangeListeners(e))},cleverapps.BoostersCounter.prototype.add=function(e,t){t=t||1,this.setAmount(e,this.getAmount(e)+t)},cleverapps.BoostersCounter.prototype.setAmount=function(e,t){this.getAmount(e)!==t&&(this.data[e]=t
,this.save(),this.runChangeListeners(e))},cleverapps.BoostersCounter.prototype.runChangeListeners=function(e){this.onChangeListener(e),cleverapps.values(this.onChangeListeners).forEach(function(e){e()})},cleverapps.BoostersCounter.INIT_AMOUNT=2;var BoosterAmountView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint(.5,.5),this.setCascadeOpacityEnabled(!0);var t=cleverapps.styles.BoosterAmountView;this.bg=bundles.game.frames.booster_amount_bg_png?new cc.Sprite(bundles.game.frames.booster_amount_bg_png):new cc.Sprite,this.bg.setScale(t.background.scale),this.bg.setAnchorPoint2(),this.addChild(this.bg),this.amount=cleverapps.UI.generateTTFText("",cleverapps.styles.FONTS.BOOSTER_AMOUNT_TEXT),this.addChild(this.amount),this.booster=e,this.setAmount(e.getAmount())},setAmount:function(e){0<e?(this.visible=!0,this.bg.setVisible(!0),this.amount.setVisible(!0),this.amount.setString(e),this.amount.fitTo(this.bg.width*this.bg.scale*.85)):(this.visible=!1,this.bg.setVisible(!1),
this.amount.setVisible(!1)),this.setContentSize2(Math.max(this.bg.width*this.bg.scale,this.amount.width*this.amount.scale),Math.max(this.bg.height*this.bg.scale,this.amount.height*this.amount.scale)),this.amount.setPositionRound(this.width/2,this.height/2+cleverapps.styles.BoosterAmountView.amount.offsetY),this.bg.setPositionRound(this.width/2,this.height/2)}});cleverapps.styles.BoosterAmountView={background:{scale:1},amount:{offsetY:0}};var Gun=function(){this.onShowUpListener=function(){},this.onShowForceListener=function(){},this.onAnimateListener=function(){},this.onAttackListener=function(){},this.onShowListener=function(){},this.onHideListener=function(){},this.onMouseOverListener=function(){},this.onMouseOutListener=function(){},this.load(),this.state=Gun.STATE_CREATE,this.showTime=void 0};Gun.prototype.onClick=function(){cleverapps.forces.isRunningForce()&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GUN_SHOT_FORCE),cleverapps.forces.closeRunningForce()),-1===[
Gun.STATE_BOMBING,Gun.STATE_HIDDEN].indexOf(this.state)&&(!this.showTime||this.showTime<Date.now()-300)&&cleverapps.metha.display({focus:"GunExecute",control:this.getControls(),action:this.execute.bind(this)})},Gun.prototype.showForce=function(){cleverapps.metha.display({focus:"GunForce",control:this.getControls(),actions:[function(e){setTimeout(e,500)},function(e){this.onShowForceListener(),this.setAmount(1),cleverapps.forces.onceForceClosed=e}.bind(this)]})},Gun.prototype.getControls=function(){return["gun"]},Gun.prototype.showUp=function(){this.isAvailable()&&this.state!==Gun.STATE_SHOW_UP&&(this.onShowUpListener(),this.state=Gun.STATE_SHOW_UP)},Gun.prototype.isForceAvailable=function(){return!(!Game.currentGame||this.state!==Gun.STATE_SHOW_UP)&&(!(Game.currentGame.tutorial&&!Game.currentGame.tutorial.finished)&&(Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN&&!cleverapps.forces.isShown(Forces.GUN.id)))},Gun.prototype.animate=function(e,t){this.onAnimateListener(e,t)},
Gun.prototype.onMouseOver=function(){this.state!==Gun.STATE_HIDDEN&&this.onMouseOverListener()},Gun.prototype.onMouseOut=function(){this.state!==Gun.STATE_HIDDEN&&this.onMouseOutListener()},Gun.prototype.attack=function(){this.onAttackListener(),this.state=Gun.STATE_BOMBING},Gun.prototype.hide=function(){this.onHideListener()},Gun.prototype.show=function(){this.onShowListener(),this.showTime=Date.now()},Gun.prototype.resetState=function(){this.state=Gun.STATE_CREATE},Gun.prototype.execute=function(e){if(Game.currentGame&&("board"!==cleverapps.config.type||Game.currentGame.board))if(0<this.amount)this.onExecute(e);else{e();var t=this.getProduct(),i=Game.currentGame;t.buy(cleverapps.once(function(){cleverapps.metha.displayWhenFreeFocus({focus:"GunExecute",control:this.getControls(),action:function(e){Game.currentGame===i&&void 0===Game.currentGame.outcome?this.onExecute(e):e()}.bind(this)})}.bind(this)),this.getControls())}else e()},Gun.prototype.onExecute=function(e){console.log(
"Override me!")},Gun.prototype.setAmount=function(e){e<0&&(e=0),this.amount=e},Gun.prototype.getAmount=function(){return this.amount?this.amount:0},Gun.prototype.addAmount=function(e){var t=this.getAmount();this.setAmount(t+e),this.save()},Gun.prototype.getProduct=function(){return new Product("gunShot")},Gun.prototype.getInfo=function(){return{amount:this.getAmount()}},Gun.prototype.updateInfo=function(e,t){this.amount=e.amount,this.save(t)},Gun.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.GUN,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("gun")},Gun.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.GUN);this.amount=e&&e.amount?e.amount:0,this.amount<0&&(this.amount=0)},Gun.prototype.reset=function(){this.amount=0,this.save()},Gun.prototype.isAvailable=function(){return!cleverapps.flags.nopayments&&((!cleverapps.config.debugMode||!cleverapps.screenshotsMode)&&cleverapps.user.checkAvailable(Gun.AVAILABLE
))},Gun.AVAILABLE={episode:1,level:8,wordheaps:{disabled:!0},spades:{disabled:!0}},Gun.STATE_SHOW_UP=0,Gun.STATE_BOMBING=1,Gun.STATE_WIN_ANIMATION=2,Gun.STATE_CREATE=3,Gun.STATE_HIDDEN=4;var GunView=cc.Node.extend({ctor:function(e,t){this._super(),this.gun=e,this.gameScene=t,e.onShowUpListener=this.createListener(this.showUp.bind(this)),e.onShowForceListener=this.createListener(this.showForce.bind(this)),e.onAnimateListener=this.createListener(this.animate.bind(this)),e.onAttackListener=this.createListener(this.attack.bind(this)),e.onHideListener=this.createListener(this.hide.bind(this)),e.onShowListener=this.createListener(this.show.bind(this)),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,e.onClick.bind(e));var i=cleverapps.styles.GunView,s=i.scale[cleverapps.wideMode.mode],n=i.size[cleverapps.wideMode.mode]||i.size;this.animation=new cleverapps.Spine(i.json,s),this.addChild(this.animation),this.setContentSize(n),this.setPositionRound(i.position),
this.basePosition=this.getPosition(),this.setLocalZOrder(19),i.animation.wideModePosition?this.animation.setPositionRound(i.animation.wideModePosition[cleverapps.wideMode.mode]):this.animation.setPositionRound(i.animation),t.gunView=this,t.scene.addChild(this),i.useSceneDelta&&(this.y-=cleverapps.UI.getSceneOffsetY(),this.basePosition.y-=cleverapps.UI.getSceneOffsetY()),this.amount=new GunAmountView(this.gun),this.amount.setPositionRound(i.amount.position),this.addChild(this.amount),this.price=new GunPriceView(this.gun,this),this.price.setPositionRound(i.price.position),this.addChild(this.price),this.gun.resetState(),this.visible=!1,cleverapps.flags.introDisabled&&"match3"!==cleverapps.config.type&&(this.visible=!0,this.animation.setAnimation(0,"idle",!0))},showUp:function(){this.amount&&this.amount.showUp(),this.price&&this.price.showUp();var e=cleverapps.styles.GunView.startAnimation;this.animation.setAnimation(0,e,!1),this.animation.setCompleteListener(function(){
this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,"idle",!0)}.bind(this)),setTimeout(function(){cleverapps.audio.playSound(cleverapps.styles.GunView.showUpSound)},1e3*cleverapps.styles.GunView.showUp.delay),this.setVisible(!0)},attack:function(){cleverapps.audio.playSound(bundles.game.urls.game_start_effect||res.gun_bombing_effect);var e=cleverapps.styles.GunView;this.amount&&this.amount.hide(),this.price&&this.price.hide();var t=e.actionAnimation;"board"!==cleverapps.config.type||cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL||cleverapps.styles.GunView.disableMobileSpecialAnimation||(t=e.mobileActionAnimation);var i=void 0;cleverapps.styles.GunView.animation.actionPosition&&(i=this.animation.getPosition(),this.animation.setPositionRound(cleverapps.styles.GunView.animation.actionPosition)),this.animation.setAnimation(0,t,!1),this.animation.setCompleteListener(function(){i&&this.animation.setPositionRound(i),this.animation.setCompleteListener(
function(){}),this.animation.setAnimation(0,"idle",!0),"scramble"===cleverapps.config.name&&(this.animation.setPositionRound(this.animation.x,this.animation.positionY-this.height),this.show()),this.amount&&this.amount.showUp(),this.price&&this.price.showUp()}.bind(this))},animate:function(e){console.log("Animating gun for: ",e)},showForce:function(){this.amount&&this.amount.setVisible(!1),this.price&&this.price.setVisible(!1),cleverapps.forces.create(this,Forces.GUN)},hide:function(){this.amount&&this.amount.hide(),this.price&&this.price.hide(),this.setVisible(!1)},show:function(){this.gun.state!==Gun.STATE_BOMBING&&(this.amount&&this.amount.show(),this.price&&this.price.show()),this.visible=!0}});cleverapps.styles.GunView={showUpSound:bundles.game.urls.gun_show_up_effect,json:bundles.game.jsons.gun_animation_json,startAnimation:"start",actionAnimation:"bombing",mobileActionAnimation:"bombing_mobile",position:[{x:50,y:{align:"top",dy:-140}},{x:60,y:{align:"top",dy:-140}},{x:60,y:{
align:"top",dy:-140}}],scale:[1,1,1],animation:{x:{align:"center",dx:-90},y:{align:"center",dy:-90}},amount:{position:[{x:118,y:76},{x:108,y:86},{x:108,y:86}]},price:{position:[{x:20,y:-16},{x:0,y:-16},{x:0,y:-16}]},size:{width:100,height:150},showUp:{delay:1},hideMovesView:!0,touchDy:6};var GunAmountView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint(.5,.5),this.setCascadeOpacityEnabled(!0);var t=cleverapps.styles.GunAmountView;t.background&&(t.background.scale9?(this.bg=new cc.Scale9Sprite(bundles.game.frames.booster_amount_bg_png),this.bg.setContentSize2(t.background.scale9)):(this.bg=new cc.Sprite(t.background.image),this.bg.setScale(t.background.scale)),this.addChild(this.bg)),this.amount=cleverapps.UI.generateTTFText("",cleverapps.styles.FONTS.GUN_AMOUNT_TEXT),this.addChild(this.amount),this.gun=e,this.updateAmount(),this.baseScale=t.scale||this.getScale(),this.setScale(this.baseScale),this.setVisible(!1)},updateAmount:function(e){return void 0===e&&(
e=this.gun.getAmount()),e&&this.amount.setString(e),e},showUp:function(){this.updateAmount()&&(this.stopAllActions(),this.setScale(0),this.setVisible(!0),this.runAction(new cc.Sequence(new cc.DelayTime(cleverapps.styles.GunAmountView.delay),new cc.ScaleTo(.2,this.baseScale))))},executeAnimation:function(e){this.runAction(new cc.Sequence(new cc.ScaleTo(.25,this.baseScale+.25*this.baseScale),new cc.CallFunc(function(){this.updateAmount(this.gun.getAmount())}.bind(this)),new cc.DelayTime(.25),new cc.ScaleTo(.25,0),new cc.CallFunc(function(){this.setVisible(!1),e()}.bind(this))))},hide:function(){this.isVisible()&&(this.stopAllActions(),this.runAction(new cc.Sequence(new cc.ScaleTo(.2,0),new cc.CallFunc(function(){this.setVisible(!1)}.bind(this)))))},show:function(){!this.isVisible()&&this.updateAmount()&&(this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.ScaleTo(.2,this.baseScale),new cc.CallFunc(function(){this.setVisible(!0)}.bind(this)))))}})
;cleverapps.overrideFonts(cleverapps.styles.FONTS,{GUN_AMOUNT_TEXT:{prefix:"white_digit_"}}),cleverapps.styles.GunAmountView={delay:1.5,scale:.6,background:{image:res.gun_amount_bg_png,scale:2}};var GunHoverAnimation=function(e){var t=cleverapps.styles.GunView.hoverAnimation;this.animation=new cleverapps.Spine(t.json,1),this.animation.setPosition(e.width/2+t.offsetX,e.height/2+t.offsetY),e.addChild(this.animation,-1)};GunHoverAnimation.prototype.on=function(){this.isOn||(this.animation.visible=!0,this.isOn=!0,this.animation.setAnimation(0,"on",!1),this.animation.addAnimation(0,"idle",!0),this.animation.setCompleteListener(function(){}))},GunHoverAnimation.prototype.off=function(){this.isOn&&!this.locked&&(this.isOn=!1,this.animation.setAnimation(0,"off",!1),this.animation.setCompleteListener(function(){this.animation.visible=!1}.bind(this)))},GunHoverAnimation.prototype.lock=function(){this.locked=!0},GunHoverAnimation.prototype.unlock=function(){this.locked=!1},
GunHoverAnimation.prototype.forceOff=function(){this.unlock(),this.off()};var GunPriceView=cc.Node.extend({ctor:function(e,t){this._super(),this.gun=e;var i=cleverapps.styles.GunPriceView;this.baseScale=i.scale||this.getScale(),this.setScale(this.baseScale);var s={font:cleverapps.styles.FONTS.GUN_PRICE_TEXT,iconScale:i.icon.scale,offsetY:i.icon.offsetY,alignment:i.price&&i.price.alignment};if(i.fitTo?s.fitTo=i.fitTo:s.fitTo={width:.9*t.width},this.price=new ProductPriceView(this.gun.getProduct(),s),this.price.setLocalZOrder(1),this.addChild(this.price),this.setContentSize2(this.price.getContentSize()),i.background&&(this.bg=cleverapps.UI.createSprite({image:bundles.game.frames.gun_price_bg_png||bundles.buttons_main.frames.small_green_button,scale9:i.background.scale9,width:this.price.width+2*i.background.padding.x,height:Math.max(this.price.height+2*i.background.padding.y,i.background.minHeight)}),this.addChild(this.bg)),cleverapps.social instanceof cleverapps.OK&&i.label){
var n=cleverapps.UI.generateTTFText(Messages.get("Take"),cleverapps.styles.FONTS.GUN_PRICE_BUY_TEXT||cleverapps.styles.FONTS.GUN_PRICE_TEXT);cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&i.label.mobileScale&&n.setScale(i.label.mobileScale),this.price.addChild(n);var o=i.label.offset.y;Array.isArray(o)&&(o=o[cleverapps.wideMode.mode]*resolutionScale),n.setPositionRound(this.width/2,this.height/2+o)}this.bg&&(this.setContentSize2(this.bg.getContentSize()),this.bg.setPositionRound(this.width/2,this.height/2)),this.price.setPositionRound(this.width/2,this.height/2),this.setAnchorPoint2(),this.setCascadeOpacityEnabled(!0),this.setVisible(!1),i.hover&&cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,e.onClick.bind(e))},getProduct:function(){return this.gun.getProduct()},updatePriceString:function(){this.price.setString(this.getProduct())},showUp:function(){if(!this.gun.getAmount()){var e=cleverapps.styles.GunPriceView;this.setScale(0),this.opacity=255,this.setVisible(!0),
this.price.setString(this.getProduct()),this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(e.showUp.delay),new cc.ScaleTo(.2,this.baseScale)))}},hide:function(){this.isVisible()&&(this.stopAllActions(),this.inHide=!0,this.runAction(new cc.Sequence(new cc.FadeOut(.3),new cc.CallFunc(function(){this.inHide=!1,this.opacity=255,this.setVisible(!1)}.bind(this)))))},show:function(){this.gun.getAmount()||(this.inHide&&(this.stopAllActions(),this.opacity=255,this.scale=this.baseScale,this.visible=!0),this.isVisible()||(this.stopAllActions(),this.opacity=0,this.scale=this.baseScale,this.visible=!0,this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.FadeIn(.3)))))}});cleverapps.styles.GunPriceView={showUp:{delay:1.5},scale:.6,background:{padding:{x:32,y:4},minHeight:70,scale9:cleverapps.UI.Scale9Rect.TwoPixelXY},icon:{scale:.8},amount:{scale:1}};var TournamentPlayerView=cc.Node.extend({ctor:function(e,t){this._super(),this.player=e,this.competition=t,
this.game=Game.currentGame;var i=cleverapps.styles.TournamentPlayerView;this.setContentSize2(i.width,i.height),this.setAnchorPoint2(.5,.5),this.setScale(i.scale[cleverapps.wideMode.mode]),this.baseScale=this.scale,this.colorNode=new cc.Node,this.colorNode.setContentSize2(this.getContentSize()),this.colorNode.setAnchorPoint2(.5,.5),this.colorNode.setCascadeColorEnabled(!0),this.colorNode.setPositionRound(this.width/2,this.height/2),this.addChild(this.colorNode),this.createBackground();var s=this.avatar=new cleverapps.UI.Avatar(e.avatar);s.setCascadeColorEnabled(!1),this.colorNode.addChild(s),s.setScale(i.avatar.scale),s.setLocalZOrder(-1),s.setPositionRound(i.avatar.x,i.avatar.y),this.createName(),this.addAmount(),this.processPlaceAnimation(),this.prevAmount=this.player.amount,this.setCascadeColorEnabled(!0),cleverapps.config.debugMode&&cleverapps.UI.onClick(this,function(){Game.currentGame&&Game.currentGame.discoverDebug(this.player)}.bind(this)),
this.competition.onChangeResultsListeners["player_"+this.player.id]=this.createListener(this.onChangeResults.bind(this)),this.player.id===cleverapps.user.id&&(this.competition.onChangeResultsListeners.processPlaceAnimation=this.createListener(this.processPlaceAnimation.bind(this)))},createName:function(){var e=cleverapps.styles.TournamentPlayerView,t=this.player.name;t||(cleverapps.throwAsync("No player name "+JSON.stringify(this.player)),t="Player_"+this.player.id.substr(-3)),0<t.indexOf(" ")&&(t=t.substring(0,t.indexOf(" ")));var i=cleverapps.UI.createSprite(e.name.bg);this.colorNode.addChild(i),i.setPositionRound(e.name.bg),e.name.bg.playerColor&&this.player.self&&i.setColor(e.name.bg.playerColor),this.name=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.PLAYER_NAME_TEXT),this.name.fitTo(i.width-2*e.name.padding.x),i.addChild(this.name),this.name.setPositionRound(e.name)},addAmount:function(){var e=cleverapps.styles.TournamentPlayerView.amount,t=new cc.Sprite(
this.player.id===cleverapps.user.id?bundles.game.frames.tournament_mark_1_png:bundles.game.frames.tournament_mark_0_png);t.setPosition(t.width/2,t.height/2);var i=this.score=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(t.getContentSize()),i.addChild(t),i.setCascadeColorEnabled(!0);var s=this.amountText=cleverapps.UI.generateTTFText(this.player.amount+"",cleverapps.styles.FONTS[this.player.id===cleverapps.user.id?"PLAYER_SCORE":"BOT_SCORE"]);i.addChild(s),s.setPositionRound(e.text),this.colorNode.addChild(i),i.setPositionRound(e)},createBackground:function(){var e,t=cleverapps.styles.TournamentPlayerView.background;t&&(!1===t.scale9?((e=new cc.Sprite(t.image)).setScaleX(this.width/e.width),e.setScaleY(this.height/e.height)):(e=cleverapps.UI.createScale9Sprite(t.image,t.scale9)).setContentSize2(this.width,this.height),e.setPosition(this.width/2,this.height/2),this.colorNode.addChild(e),e.setLocalZOrder(-1),this.player.self?e.setColor(cleverapps.styles.COLORS.PLAYER_BG_COLOR
):e.setColor(cleverapps.styles.COLORS.COMPETITOR_BG_COLOR||cleverapps.styles.COLORS.WHITE))},onChangeResults:function(e){e===this.player.id&&(this.score.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.4,1.4).easing(cc.easeOut(3)),new cc.Sequence(new cc.RotateTo(.15,15),new cc.RotateTo(.15,-15),new cc.RotateTo(.1,0))),new cc.ScaleTo(.15,1))),this.amountText.setString(this.player.amount+""))},processPlaceAnimation:function(e){if(this.player.id===cleverapps.user.id&&!(this.competition.calcPlace()<3||this.competition.getFinishedOpponents().length===this.competition.results.length-1||this.placeAnimationProcessing)){var t=cleverapps.styles.COLORS.PLAYER_ALARM_COLOR,i=cleverapps.styles.COLORS.WHITE;this.placeAnimationProcessing=!0,this.colorNode.runAction(new cc.Sequence(new cc.TintTo(.5,t.r,t.g,t.b),new cc.TintTo(.5,i.r,i.g,i.b),new cc.CallFunc(function(){this.placeAnimationProcessing=!1,this.processPlaceAnimation()}.bind(this)))),this.framePulsation||(
this.framePulsation=new cc.Sprite(res.avatar_frame_red_png),this.avatar.addChild(this.framePulsation),this.framePulsation.setPositionRound(this.avatar.width/2,this.avatar.height/2),this.framePulsation.setLocalZOrder(-1),this.framePulsation.setColor(cc.color.RED),this.framePulsation.setContentSize2(this.avatar.width,this.avatar.height)),this.framePulsation.runAction(new cc.Sequence(new cc.ScaleTo(.5,1.2),new cc.ScaleTo(.5,1)))}},animateReorder:function(e){if(!(Math.abs(this.y-e.y)<1&&this.player.amount===this.prevAmount)||this.reorderAnimationRunning){var t=e.y>this.y||this.player.amount>this.prevAmount;this.prevAmount=this.player.amount,this.reorderAnimationRunning=!0,this.stopAllActions(),this.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.2,this.baseScale*(t?1.2:.9)),new cc.MoveTo(.35,e).easing(cc.easeIn(1)),new cc.Sequence(new cc.CallFunc(function(){this.rotation=0}.bind(this)),new cc.DelayTime(.08),new cc.RotateBy(.108,e.y>this.y?20:0).easing(cc.easeInOut(.5)),
new cc.RotateBy(.135,e.y>this.y?-30:0),new cc.RotateBy(.027,e.y>this.y?10:0)),new cc.Sequence(new cc.DelayTime(.3),new cc.ScaleTo(.2,this.baseScale))),new cc.CallFunc(function(){this.reorderAnimationRunning=!1}.bind(this))))}},animateResult:function(e){var t=cleverapps.styles.TournamentPlayerView;cleverapps.UI.animateDelta(e,{parent:this,font:cleverapps.styles.FONTS.PLAYER_VIEW_DELTA_TEXT,x:this.width/2+t.delta.x,y:this.height/2+t.delta.y})}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{PLAYER_SCORE:{size:25,color:cleverapps.styles.COLORS.BLACK},BOT_SCORE:{size:25,color:cleverapps.styles.COLORS.BLACK},PLAYER_VIEW_DELTA_TEXT:{size:25,color:cleverapps.styles.COLORS.BLACK}}),cleverapps.styles.TournamentPlayerView={background:{image:res.tournament_bg_png,scale9:cleverapps.UI.Scale9Rect.TwoPixelXY},width:145,height:140,scale:[1,1,1],avatar:{x:{align:"center"},y:{align:"center",dy:10},scale:1},amount:{x:{align:"right"},y:{align:"bottom"},text:{x:{align:"center"},y:{align:"center"}}},
name:{x:{align:"center"},y:{align:"center"},padding:{x:17},bg:{image:bundles.menubar.frames.menu_gold_bg_png,width:100,height:40,x:{align:"center"},y:{align:"bottom"}}},delta:{x:55,y:0}};var TournamentPlayersView=cc.Node.extend({ctor:function(t){this._super(),this.competition=t,this.players=t.results,this.competition.calcPlace(),this.views=this.players.map(function(e){return new TournamentPlayerView(e,t)}.bind(this));var e=cleverapps.styles.TournamentPlayersView,i=new cleverapps.Layout(this.views,{direction:cleverapps.UI.VERTICAL,margin:e.margin});this.setContentSize2(i.width,i.height),this.addChild(i),i.setPositionRound(this.width/2+e.content.offset.x,this.height/2+e.content.offset.y),this.setPositionRound(e.x,e.y[cleverapps.wideMode.mode],cleverapps.UI.getSceneSize()),this.positions={},this.views.forEach(function(e,t){this.positions[t]=e.getPosition()}.bind(this)),this.createBg(),this.setLocalZOrder(1),t.onChangeResultsListeners.tournamentPlayers=cleverapps.whenShow(
this.createListener(cleverapps.timeredThrottle(10,this.onChangeResults.bind(this)))),this.onChangeResults(),Game.currentGame.afterOnChangeOutcomeListeners.tournamentPlayerViews=this.createListener(this.afterOnChangeOutcome.bind(this))},afterOnChangeOutcome:function(){var e=-cleverapps.UI.getSceneSize().width/2*.025;this.runAction(new cc.MoveBy(1,e,0).easing(cc.easeInOut(1.5)))},createBg:function(){var e=cleverapps.styles.TournamentPlayersView.bg;if(e){var t=new cc.Scale9Sprite(e.image);this.addChild(t),t.setLocalZOrder(-1);var i=1.3*(this.width+e.padding.x),s=this.height+2*e.padding.y;e.rotate90?(t.setContentSize2(s,i),t.setRotation(90)):t.setContentSize2(i,s),t.setPositionRound(this.width+e.padding.x-i/2,this.height/2)}},onChangeResults:function(e){this.competition.calcPlace(),this.views.sort(function(e,t){var i=this.competition.results.indexOf(e.player);return this.competition.results.indexOf(t.player)-i}.bind(this)),this.views.forEach(function(e,t){e.setLocalZOrder(t+1),
e.animateReorder(this.positions[t])}.bind(this))},animateResults:function(t){this.views.forEach(function(e){e.player.player&&e.animateResult(t)})}});cleverapps.styles.TournamentPlayersView={align:"left",x:130,y:[620,620,620],margin:10,bg:{image:res.tournament_bg_png,padding:{x:15,y:20}},content:{offset:{x:0,y:0}}};var ExpInfoWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.ExpInfoWindow,t=this.generateContent();this._super({title:"messages:ExpInfoWindow.Title",name:"expinfowindow",content:t}),t.y-=e.topBottom,Lottery.addText(this)},generateProductOption:function(e,t){var i=cleverapps.styles.ExpInfoWindow,s=new Product(e),n=cleverapps.UI.generateTTFText(s.reward.exp,cleverapps.styles.FONTS.BUTTON_TEXT),o=new cc.Sprite(bundles.menubar.frames.exp_png),a=new cleverapps.Layout([n,o],{direction:cleverapps.UI.HORIZONTAL,margin:i.button.amountMargin}),r=new cleverapps.UI.Button({content:a,onClicked:function(){s.buy(function(){this.close()}.bind(this))}.bind(this),
width:i.button.width,height:i.button.height});Lottery.addIcon(r);var l=new ProductPriceView(s,{font:cleverapps.styles.FONTS.ADDMOVES_PRICE}),c=new cc.Sprite(t);return new cleverapps.Layout([r,l,c],{direction:cleverapps.UI.VERTICAL})},generateContent:function(){var e=cleverapps.styles.ExpInfoWindow,t=cleverapps.UI.generateTTFText("messages:ExpInfoWindow.Message",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);t.setDimensions(e.width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var i=cleverapps.UI.generateTTFText("messages:ExpInfoWindow.BuyMessage",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);i.setDimensions(e.width,0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var s=new cleverapps.Layout([this.generateProductOption("buyExp10",bundles.exp_window.frames.small_exp_box),this.generateProductOption("buyExp150",bundles.exp_window.frames.exp_box)],{direction:cleverapps.UI.HORIZONTAL,margin:e.button.margin,align:cleverapps.UI.ALIGN_START});return new cleverapps.Layout([s,i,t],{
direction:cleverapps.UI.VERTICAL,margin:e.margin})},listBundles:function(){return["exp_window"]}});cleverapps.styles.ExpInfoWindow={width:600,margin:30,topBottom:70,exp:{width:400,height:200},button:{amountMargin:10,amountIcon:{scale:.7},margin:50,width:300,height:100}};var Chat=function(){this.messages=[],cleverapps.EventEmitter.call(this),this.editingMode=!1};Chat.prototype=Object.create(cleverapps.EventEmitter.prototype),(Chat.prototype.constructor=Chat).IsAvailable=function(){return cleverapps.config.debugMode||-1!==["4252816","74852834","559432346","9938687","4615499","106714030906203","2163863963762618","1936516949830655","1954928231322860","2121926457956369","2243799605769053","2070368963112119","1952730654875951","1954096948072655"].indexOf(cleverapps.user.id)},Chat.prototype.load=function(s){cleverapps.RestClient.get("/chat/messages/"+cleverapps.user.id,{},function(e){var t=e.map(ChatMessage.fromData);this.messages=[];var i=void 0;t.forEach(function(e){var t=new Date(
e.postDate).toLocaleDateString(cleverapps.settings.language,{year:"numeric",month:"long",day:"numeric"});t!==i&&(i=t,this.messages.push(ChatMessage.createServiceMessage(t))),this.messages.push(e)}.bind(this)),this.trigger("messagesUpdated"),s&&s()}.bind(this),this.printConnectionError.bind(this))},Chat.prototype.postMessage=function(e,t){cleverapps.RestClient.post("/chat/message",{message:e,userid:cleverapps.user.id,isresponse:0},function(e){e?this.load(t):t()}.bind(this),this.printConnectionError.bind(this))},Chat.prototype.printConnectionError=function(){this.messages.push(ChatMessage.createServiceMessage(Messages.get("RestartWindow.AnErrorOccured"),"error_"+(new Date).toLocaleTimeString())),this.trigger("messagesUpdated")};var ChatMessage=function(){};ChatMessage.fromData=function(e){var t=new ChatMessage;return t.id=e.id,t.userId=e.userId,t.postDate=e.postDate,t.message=e.message,t.isResponse=e.isResponse,t.type=ChatMessage.MESSAGE_TYPE.CHAT,t},
ChatMessage.createServiceMessage=function(e,t){var i=new ChatMessage;return i.id=t||"service_"+e,i.message=e,i.type=ChatMessage.MESSAGE_TYPE.SERVICE,i},ChatMessage.MESSAGE_TYPE={CHAT:0,SERVICE:1};var ChatHeader=cc.Scale9Sprite.extend({ctor:function(e){this._super(bundles.chat.frames.panelup),this.setAnchorPoint2();var t=this.titleText=cleverapps.UI.generateTTFText(Messages.get("messages:ChatTitle"),cleverapps.styles.FONTS.CHAT_HEADER_TEXT);this.addChild(t);var i=this.backButton=new cleverapps.UI.Button({noBg:!0,content:new cc.Sprite(bundles.chat.frames.icon_back),onClicked:function(){setTimeout(function(){cc.director.getRunningScene().closeAction()}.bind(this),cc.sys.isMobile&&e.editingMode?500:100)}.bind(this),width:cleverapps.styles.ChatHeader.back.width,height:cleverapps.styles.ChatHeader.back.height});this.addChild(i),this.onChangeSize()},onChangeSize:function(){var e=cleverapps.styles.ChatHeader;this.setContentSize2(cc.director.getWinSize().width,e.height),this.setPositionRound(e)
,this.titleText.setPositionRound(this.width/2+e.text.offset.x,this.height/2+e.text.offset.y),this.titleText.fitTo(.8*cc.director.getWinSize().width,e.height),this.backButton.setPositionRound(e.back)}});cleverapps.styles.ChatHeader={height:130,x:{align:"center"},y:{align:"top"},back:{x:{align:"left"},y:{align:"center"},width:90,height:110},text:{offset:{x:13,y:-10}}},cleverapps.overrideFonts(cleverapps.styles.FONTS,{CHAT_HEADER_TEXT:{size:50,color:cleverapps.styles.COLORS.BLACK}});var ChatInput=cc.Scale9Sprite.extend({ctor:function(e){this._super(bundles.chat.frames.paneldown);var t=cleverapps.styles.ChatInput;this.chat=e,this.setAnchorPoint2();var i=this.sendButton=new cleverapps.UI.Button({noBg:!0,content:new cc.Sprite(bundles.chat.frames.panel_on),contentOff:new cc.Sprite(bundles.chat.frames.panel_off),onClicked:this.send.bind(this),width:t.sendButton.width,height:t.sendButton.height,fitTo:!1});i.disable(),this.addChild(i),this.charsCountText=cleverapps.UI.generateTTFText("0/500",
cleverapps.styles.FONTS.CHAT_CHARS_COUNT_TEXT,void 0,ChatScene.FONT_NAME),this.charsCountText.setVisible(!1),this.charsCountText.setDimensions(t.charsCount.width,0),this.charsCountText.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.addChild(this.charsCountText);var s=this.textAreaBg=cleverapps.UI.createScale9Sprite(bundles.chat.frames.textbox);this.addChild(s);var n=this.text=new cc.EditBox(cc.size(s.width-t.textPadding.x,s.height-t.textPadding.y));n.setDelegate(this),n.stayOnTop(!0),n.setTouchEnabled(),n.setMaxLength(500),n.setFontColor(cleverapps.styles.FONTS.CHAT_INPUT_FIELD_TEXT.color),this.textAreaBg.addChild(this.text),this.onChangeSize()},onChangeSize:function(){var e=cleverapps.styles.ChatInput;this.setContentSize2(cc.director.getWinSize().width,e.height),this.setPositionRound(e),this.textAreaBg.setContentSize(this.width-e.textArea.rightMargin,e.textArea.height),this.textAreaBg.setPositionRound(e.textArea),this.sendButton.setContentSize(e.sendButton),
this.sendButton.setPositionRound(e.sendButton),this.text.setContentSize(this.textAreaBg.width-e.textPadding.x,this.textAreaBg.height-e.textPadding.y),this.text.setPositionRound(this.textAreaBg.width/2,this.textAreaBg.height/2),this.charsCountText.setPositionRound(e.charsCount)},send:function(){var e=this.getMessageText();0<e.length&&this.chat.postMessage(e,function(){this.text.setString(""),this.sendButton.disable(),this.charsCountText.setVisible(!1)}.bind(this))},editBoxTextChanged:function(e,t){0<this.getMessageText(t).length?this.sendButton.enable():this.sendButton.disable(),this.text.setFont(ChatScene.FONT_NAME,cleverapps.styles.FONTS.CHAT_INPUT_FIELD_TEXT.size),400<=this.text.getString().length?(this.charsCountText.setVisible(!0),this.charsCountText.setString(this.text.getString().length+"/500"),this.charsCountText.setFont(450<=this.text.getString().length?cleverapps.styles.FONTS.CHAT_CHARS_COUNT_RED_TEXT:cleverapps.styles.FONTS.CHAT_CHARS_COUNT_TEXT)
):this.charsCountText.setVisible(!1)},editBoxReturn:function(){setTimeout(this.send.bind(this),0)},getMessageText:function(e){return(e=e||this.text.getString()).trim().replace(/(?:\r\n|\r|\n)/g,"").replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g,"")},editBoxEditingDidBegin:function(){this.chat.editingMode=!0},editBoxEditingDidEnd:function(){this.chat.editingMode=!1}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{CHAT_INPUT_FIELD_TEXT:{size:40,color:cleverapps.styles.COLORS.BLACK},CHAT_CHARS_COUNT_TEXT:{size:22,color:cleverapps.styles.COLORS.COLOR_VERY_DARK_GRAY},CHAT_CHARS_COUNT_RED_TEXT:{size:22,color:new cc.Color(243,60,60,255)}}),cleverapps.styles.ChatInput={height:212,x:{align:"center"},y:{align:"bottom"},sendButton:{x:{align:"right"},y:{align:"center"},width:110,height:200},charsCount:{x:{align:"right",dx:-12},y:{align:"bottom",dy:25},width:90},textArea:{height:200,rightMargin:130,x:{align:"left",
dx:20},y:{align:"center",dy:-6}},textPadding:{x:40,y:12}};var ChatMessageView=cc.Node.extend({ctor:function(e){this._super(),this.chatMessage=e,this.setAnchorPoint2(0,.5);var t=this.messageText=cleverapps.UI.generateTTFText(this.chatMessage.message,cleverapps.styles.FONTS.CHAT_MESSAGE_TEXT,void 0,ChatScene.FONT_NAME);t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT);var i=new Date(e.postDate).toLocaleTimeString(cleverapps.settings.language,{hour12:!1,hour:"2-digit",minute:"2-digit"}),s=this.messageTimeText=cleverapps.UI.generateTTFText(i,cleverapps.styles.FONTS.CHAT_MESSAGE_TIME_TEXT,void 0,ChatScene.FONT_NAME);s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_RIGHT);var n=this.bg=cleverapps.UI.createScale9Sprite(this.chatMessage.isResponse?bundles.chat.frames.dialog_box_white:bundles.chat.frames.dialog_box_green);this.addChild(n,-1),n.addChild(t),n.addChild(s),this.onChangeSize()},onChangeSize:function(){var e=cleverapps.styles.ChatMessageView,t=.7*cc.director.getWinSize().width
;t>e.maxWidth?t=e.maxWidth:t<e.minWidth&&(t=e.minWidth),this.messageText.setDimensions(t,0),this.setContentSize2(cc.director.getWinSize().width,this.messageText._getHeight()+2*e.text.padding),this.bg.setContentSize(t+2*e.text.padding,this.height),this.bg.setPositionRound(this.chatMessage.isResponse?e.responseBg:e.questionBg),this.messageText.setPositionRound(this.bg.width/2+(this.chatMessage.isResponse?e.text.responceOffsetX:0),this.bg.height/2+e.text.offsetY),this.messageTimeText.setDimensions(e.time.width,e.time.height),this.messageTimeText.setPositionRound(e.time)}});cleverapps.styles.ChatMessageView={minWidth:500,maxWidth:1100,text:{padding:30,responceOffsetX:5,offsetY:2},time:{width:300,height:24,x:{align:"right",dx:-34},y:{align:"bottom",dy:16}},responseBg:{x:{align:"left",dx:-4},y:{align:"center"}},questionBg:{x:{align:"right",dx:-30},y:{align:"center"}}},cleverapps.overrideFonts(cleverapps.styles.FONTS,{CHAT_MESSAGE_TEXT:{size:40,color:cleverapps.styles.COLORS.BLACK},
CHAT_MESSAGE_TIME_TEXT:{size:26,color:new cc.Color(138,138,138,255)}});var ServiceMessageView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2(0,.5),this.messageText=cleverapps.UI.generateTTFText(e.message,cleverapps.styles.FONTS.SERVICE_MESSAGE_TEXT,void 0,ChatScene.FONT_NAME),this.messageText.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.addChild(this.messageText),this.onChangeSize()},onChangeSize:function(){this.messageText.setDimensions(cc.director.getWinSize().width,0),this.setContentSize2(cc.director.getWinSize().width,this.messageText._getHeight()),this.messageText.setPositionRound(this.width/2,this.height/2)}});cleverapps.styles.ServiceMessageView={},cleverapps.overrideFonts(cleverapps.styles.FONTS,{SERVICE_MESSAGE_TEXT:{size:30,color:new cc.Color(83,97,106,255)}});var ChatView=cc.Node.extend({ctor:function(e){this.chat=e,this.messageViews={},this._super(),this.setAnchorPoint2();var t=this.container=new cc.Node;t.setAnchorPoint2(),
this.scroll=new cleverapps.UI.ScrollView(t,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_FULLCHECK}),this.scroll.setAnchorPoint2(0,0),this.scroll.setPositionRound(0,0),this.addChild(this.scroll),this.onChangeSize(),this.chat.on("messagesUpdated",this.updateMessages.bind(this))},updateMessages:function(){this.chat.messages.forEach(function(e){if(!this.messageViews[e.id]){var t=e.type===ChatMessage.MESSAGE_TYPE.SERVICE?new ServiceMessageView(e):new ChatMessageView(e);this.container.addChild(t),this.messageViews[e.id]=t}}.bind(this));var e=cleverapps.UI.arrangeWithMargins(this.container.getChildren(),{direction:cleverapps.UI.VERTICAL,margin:cleverapps.styles.ChatView.margin,direction:cleverapps.UI.TOP_TO_BOTTOM});e<this.scroll.height&&(e=this.scroll.height),this.container.setContentSize2(cc.director.getWinSize().width,e),this.scroll.updateInnerContent(),this.scroll.scrollToPercent(0)},onChangeSize:function(){var e=cleverapps.styles.ChatView,t=cc.director.getWinSize(
).height-cleverapps.styles.ChatHeader.height-cleverapps.styles.ChatInput.height+e.extraHeight;this.scroll.setContentSize2(cc.director.getWinSize().width,t),this.setContentSize2(this.scroll.getContentSize()),this.setPositionRound(e),this.chat.messages.forEach(function(e){this.messageViews[e.id]&&this.messageViews[e.id].onChangeSize()}.bind(this)),this.updateMessages()}});cleverapps.styles.ChatView={x:{align:"center"},y:{align:"top",dy:-127},margin:4,scrollBarPosition:{x:4,y:14},extraHeight:8};var ChatScene=cleverapps.FixedWidthScene.extend({ctor:function(e){this._super(cleverapps.Environment.SCENE_CHAT),this.windowsContainer=!0,this.chat=e;var t=new ChatHeader(this.chat);this.addChild(t);var i=new ChatView(this.chat);this.addChild(i);var s=new ChatInput(this.chat);this.addChild(s),this.onChangeSizeListeners.chatChangeSize=function(){t.onChangeSize(),i.onChangeSize(),s.onChangeSize()}.bind(this),cleverapps.placements.run(Placements.INTERMEDIATE),this.chat.load()},
getBackgroundStyles:function(){return{pattern:bundles.chat.urls.window_bg}}});ChatScene.BUNDLES=["chat"],ChatScene.FONT_NAME="Rubik";var Toolbar=function(){this.items=[],this.freezed=!1,this.enabled=!1,this.onUpdateItemsListener=function(){},this.onAddItemListener=function(e){},this.onRemoveItemListener=function(e){},this.onEnableListener=function(){},this.addItem(new FriendRequestsToolbarItem),this.addItem(new PeriodicBonusToolbarItem),this.addItem(new DailyTasksToolbarItem),this.addItem(new LeaderBoardToolbarItem),RewardedAdsManager.IsEnabled()&&this.addItem(new RewardedVideoToolbarItem),cleverapps.bet&&this.addItem(new BetBonusToolbarItem),this.updateItems()};Toolbar.prototype.anyItemWithForce=function(){for(var e=0;e<this.items.length;e++){var t=this.items[e].force;if(t&&this.items[e].isVisible()&&!cleverapps.forces.isShown(t.id))return this.items[e]}},Toolbar.prototype.showAnyForce=function(){var t=this.anyItemWithForce();cleverapps.metha.display({focus:"toolbarItemForce",
control:"toolbar",actions:[function(e){setTimeout(e,500)},function(e){this.onForceItem(),t.showForce(t.force),cleverapps.forces.onceForceClosed=e}.bind(this)]})},Toolbar.prototype.addItem=function(e){void 0===this.getItem(e.type)&&(this.items.push(e),this.items.sort(function(e,t){return e.type-t.type}),this.onAddItemListener(e),this.update())},Toolbar.prototype.hasVisibleItems=function(){return 0<this.items.filter(function(e){return e.isVisible()}).length},Toolbar.prototype.removeItem=function(e){0<=this.items.indexOf(e)&&(this.items.splice(this.items.indexOf(e),1),this.onRemoveItemListener(e)),this.update()},Toolbar.prototype.getItem=function(e){for(var t=0;t<this.items.length;++t)if(this.items[t].type===e)return this.items[t]},Toolbar.prototype.updateItems=function(e){this.freezed||(this.onUpdateItemsListener(e),this.update())},Toolbar.prototype.freezeUpdates=function(){this.freezed=!0},Toolbar.prototype.unfreezeUpdates=function(){this.freezed=!1,this.updateItems()},
Toolbar.prototype.update=function(){this.hasVisibleItems()?this.enable():this.disable()},Toolbar.prototype.enable=function(){this.enabled||(this.enabled=!0,this.onEnableListener(this.enabled))},Toolbar.prototype.disable=function(){this.enabled&&(this.enabled=!1,this.onEnableListener(this.enabled))};var ToolbarItem=function(e){cleverapps.extend(this,e),this.enabled=!1,this.marked=!1,this.onChangeStateListener=function(){},this.showForce=function(){}};ToolbarItem.prototype.isVisible=function(){return this.enabled},ToolbarItem.prototype.onClick=function(){this.unmark()},ToolbarItem.prototype.enable=function(){this.enabled||(this.enabled=!0,this.onChangeStateListener(),cleverapps.toolbar&&cleverapps.toolbar.updateItems())},ToolbarItem.prototype.disable=function(){this.enabled&&(this.unmark(),this.enabled=!1,this.onChangeStateListener(),cleverapps.toolbar&&cleverapps.toolbar.updateItems())},ToolbarItem.prototype.mark=function(){this.marked||(this.marked=!0,this.onChangeStateListener())},
ToolbarItem.prototype.unmark=function(){this.marked&&(this.marked=!1,this.onChangeStateListener())},ToolbarItem.FRIEND_REQUESTS={type:0,icon:res.toolbar_mail_icon_png},ToolbarItem.BONUS_GAME={type:1,icon:res.toolbar_bonusround_icon_png,grayscaleDisabled:!0,force:Forces.BONUS_ROUND_FORCE},ToolbarItem.PERIODIC_BONUS={type:2,icon:res.toolbar_dailybonus_icon_png,countdown:!0,grayscaleDisabled:!0,force:Forces.PERIODIC_BONUS_FORCE},ToolbarItem.LEADER_BOARD={type:3,icon:res.toolbar_leader_board_icon_png},ToolbarItem.DAILY_TASKS={type:4,icon:res.toolbar_daily_tasks_icon_png,countdown:!0,force:Forces.DAILY_TASKS_FORCE},ToolbarItem.REWARDED_VIDEO={type:5,icon:res.toolbar_rewarded_video_icon_png},ToolbarItem.BET_BONUS={type:6,icon:res.toolbar_bet_icon_png,grayscaleDisabled:!0};var BetBonusToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.BET_BONUS),this.countdown=cleverapps.bet.countdown,cleverapps.bet.changeLockedListener=this.changeLocked.bind(this),this.onRewardListener=function(){},
this.changeLocked()};BetBonusToolbarItem.prototype=Object.create(ToolbarItem.prototype),(BetBonusToolbarItem.prototype.constructor=BetBonusToolbarItem).prototype.isVisible=function(){return void 0!==cleverapps.bet},BetBonusToolbarItem.prototype.unlock=function(){this.mark()},BetBonusToolbarItem.prototype.changeLocked=function(){cleverapps.bet.locked?this.disable():(this.enable(),this.mark())},BetBonusToolbarItem.prototype.onClick=function(){cleverapps.bet.locked?cleverapps.Notification.create("messages:BetBonus.ClosedText",{image:new cc.Sprite(this.icon)}):(this.unmark(),this.onRewardListener(),cleverapps.bet.giveBonus())};var BonusRoundToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.BONUS_GAME),cleverapps.bonusRoundChest.changeLockedListener=this.changeLocked.bind(this),this.changeLocked()};BonusRoundToolbarItem.prototype=Object.create(ToolbarItem.prototype),(BonusRoundToolbarItem.prototype.constructor=BonusRoundToolbarItem).prototype.isVisible=function(){return(
void 0===typeof match3||!cleverapps.environment.isGameScene())&&(!!cleverapps.bonusRoundChest.isActive()&&this.enabled)},BonusRoundToolbarItem.prototype.changeLocked=function(){cleverapps.bonusRoundChest.locked?this.disable():(this.enable(),this.mark())},BonusRoundToolbarItem.prototype.onClick=function(){cleverapps.bonusRoundChest.locked?cleverapps.Notification.create("messages:BonusRound.ClosedText"):(this.unmark(),cleverapps.metha.display({focus:"BonusRoundWindow",action:function(e){cleverapps.bonusRoundChest.open(e)}}))};var PeriodicBonusToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.PERIODIC_BONUS),this.countdown=cleverapps.periodicBonus.countdown,cleverapps.periodicBonus.changeLockedListener=this.changeLocked.bind(this),this.changeLocked()};PeriodicBonusToolbarItem.prototype=Object.create(ToolbarItem.prototype),(PeriodicBonusToolbarItem.prototype.constructor=PeriodicBonusToolbarItem).prototype.isVisible=function(){return levels.user.checkAvailable(
cleverapps.MiniGame.AVAILABLE)},PeriodicBonusToolbarItem.prototype.unlock=function(){this.mark()},PeriodicBonusToolbarItem.prototype.changeLocked=function(){cleverapps.periodicBonus.locked?this.disable():(this.enable(),this.mark())},PeriodicBonusToolbarItem.prototype.onClick=function(){cleverapps.periodicBonus.locked?cleverapps.Notification.create(cleverapps.periodicBonus.closedText,{image:new cc.Sprite(this.icon)}):(this.unmark(),cleverapps.metha.display({focus:"MiniGameWindowFromToolbar",action:function(e){cleverapps.periodicBonus.openWindow(e)}}))};var FriendRequestsToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.FRIEND_REQUESTS),this.lastNotProceedId=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.LAST_VIEWED_FRIEND_REQUEST,{raw:!0}),levels.friendRequests.onNewListener=function(){this.mark(),cleverapps.toolbar.updateItems()}.bind(this),levels.friendRequests.onChangeListener=function(){levels.friendRequests.existNotProcessed()||(this.unmark(),
cleverapps.toolbar.updateItems(!0))}.bind(this),this.enable(),this.mark()};FriendRequestsToolbarItem.prototype=Object.create(ToolbarItem.prototype),(FriendRequestsToolbarItem.prototype.constructor=FriendRequestsToolbarItem).prototype.mark=function(){if(0!==cleverapps.friends.listFriends().concat(cleverapps.invitalbleFriends.listFriends()).length){var e=levels.friendRequests.lastNotProcessedId();!1!==e&&e!==this.lastNotProceedId&&ToolbarItem.prototype.mark.apply(this)}},FriendRequestsToolbarItem.prototype.isVisible=function(){return levels.friendRequests.existNotProcessed()},FriendRequestsToolbarItem.prototype.onClick=function(){this.lastNotProceedId=levels.friendRequests.lastNotProcessedId(),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.LAST_VIEWED_FRIEND_REQUEST,this.lastNotProceedId,{raw:!0}),this.unmark(),cleverapps.metha.display({focus:"FriendRequestsWindow",control:["MenuBarGoldItem","MenuBarLivesItem","MenuBarStarChestItem"],action:function(e){new FriendRequestsWindow,
cleverapps.metha.onceNoWindowsListener=e}})};var LeaderBoardToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.LEADER_BOARD),this.enable()};LeaderBoardToolbarItem.prototype=Object.create(ToolbarItem.prototype),LeaderBoardToolbarItem.prototype.constructor=FriendRequestsToolbarItem,LeaderBoardToolbarItem.prototype.onClick=function(){cleverapps.social instanceof cleverapps.MobileVk?cleverapps.social.showLeaderBoardBox({userResult:levels.user.getHumanReadableNumber()},function(){}):cleverapps.metha.display({focus:"LeadersWindow",action:function(e){new LeadersWindow,cleverapps.metha.onceNoWindowsListener=e}})},LeaderBoardToolbarItem.prototype.isVisible=function(){return!cleverapps.flags.norest&&ToolbarItem.prototype.isVisible.call(this)&&levels.user.checkAvailable(cleverapps.Availables.LEADER_BOARD)};var RewardedVideoToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.REWARDED_VIDEO),cleverapps.config.debugMode&&(RewardedVideoToolbarItem.INTERVAL="20 seconds",
RewardedVideoToolbarItem.START_PLAY_INTERVAL="10 seconds",RewardedVideoToolbarItem.CHECK_INTERVAL="10 seconds"),this.isAvailable()?this.enable():this.disable(),this.checkAvailable=setInterval(function(){!this.enabled&&this.isAvailable()&&this.enable()}.bind(this),cleverapps.parseInterval(RewardedVideoToolbarItem.CHECK_INTERVAL)),cleverapps.rewardedAdsManager.onStartPlayListeners[RewardedAdsManager.REWARDED+"_toolbar"]=this.startPlay.bind(this),cleverapps.rewardedAdsManager.onEndPlayListeners[RewardedAdsManager.REWARDED+"_toolbar"]=this.startPlay.bind(this)};RewardedVideoToolbarItem.prototype=Object.create(ToolbarItem.prototype),(RewardedVideoToolbarItem.prototype.constructor=RewardedVideoToolbarItem).prototype.enable=function(){this.enabled||(ToolbarItem.prototype.enable.apply(this),this.mark())},RewardedVideoToolbarItem.prototype.onClick=function(){this.isAvailable()&&cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,this.reward.bind(this))},
RewardedVideoToolbarItem.prototype.isVisible=function(){return ToolbarItem.prototype.isVisible.call(this)&&levels.user.checkAvailable(RewardedAdsManager.AVAILABLE)&&cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)},RewardedVideoToolbarItem.prototype.isAvailable=function(){return(cc.sys.localStorage.getItem(cleverapps.DataLoaderTypes.REWARDED_TOOLBAR)||0)<Date.now()&&levels.user.checkAvailable(RewardedAdsManager.AVAILABLE)&&cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)},RewardedVideoToolbarItem.prototype.startPlay=function(){this.disabled||(cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.REWARDED_TOOLBAR,Date.now()+cleverapps.parseInterval(RewardedVideoToolbarItem.START_PLAY_INTERVAL)),this.disable())},RewardedVideoToolbarItem.prototype.reward=function(){cleverapps.metha.displayWhenFreeFocus({focus:"RewardedAdToolbarReward",action:function(e){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_TOOLBAR_WINDOW_SHOW),
new RewardWindow({reward:{gold:RewardedVideoToolbarItem.REWARD.gold},callback:function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_TOOLBAR_WINDOW_CLOSE)}}),cleverapps.metha.onceNoWindowsListener=e}}),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.REWARDED_TOOLBAR,Date.now()+cleverapps.parseInterval(RewardedVideoToolbarItem.INTERVAL)),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_TOOLBAR)},RewardedVideoToolbarItem.REWARD={gold:10},RewardedVideoToolbarItem.INTERVAL="5 minutes",RewardedVideoToolbarItem.START_PLAY_INTERVAL="1 minute",RewardedVideoToolbarItem.CHECK_INTERVAL="30 seconds";var DailyTasksToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.DAILY_TASKS),this.countdown=new cleverapps.CountDown(cleverapps.dailyTasks.getTimeLeft()),this.enable(),cleverapps.dailyTasks.onChangeStateListener=this.onChangeState.bind(this),this.onChangeState()};DailyTasksToolbarItem.prototype=Object.create(ToolbarItem.prototype),(
DailyTasksToolbarItem.prototype.constructor=DailyTasksToolbarItem).prototype.onChangeState=function(){0<cleverapps.dailyTasks.getNotCollectedTasks().length||!cleverapps.dailyTasks.isRunning()?this.mark():this.unmark(),this.countdown.resetTimeLeft(cleverapps.dailyTasks.getTimeLeft()),this.countdown.nextSecond(Date.now())},DailyTasksToolbarItem.prototype.isVisible=function(){return levels.user.checkAvailable(cleverapps.Availables.DAILY_TASKS)},DailyTasksToolbarItem.prototype.onClick=function(){cleverapps.metha.display({focus:"DailyTasksWindow",action:function(e){new DailyTasksWindow,cleverapps.metha.onceNoWindowsListener=e}})};var ToolbarView=cc.Node.extend({ctor:function(e){this._super(),this.toolbar=cleverapps.toolbar,this.toolbar.update();var t=cleverapps.styles.ToolbarView;this.setAnchorPoint2(),this.height=t.bg.height,this.createBg(),this.itemsViews=[],this.toolbar.items.forEach(function(e){var t=new ToolbarItemView(e);this.itemsViews.push(t),this.addChild(t)}.bind(this)),
this.setPositionRound(t.position),this.deltaY=cleverapps.UI.getSceneOffsetY(),this.alignment=cleverapps.clone(this.alignment,!0),this.alignment.y.dy-=this.deltaY,e.addChild(this),this.hidePosition=cc.p(this.x,this.y-2*this.height),cleverapps.UI.makeHideable(this,cleverapps.UI.VERTICAL)},createBg:function(){bundles.toolbar.frames.toolbar_bg_png?this.bg=new cc.Scale9Sprite(bundles.toolbar.frames.toolbar_bg_png):(this.bg=new cc.Node,this.bg.setAnchorPoint2()),this.addChild(this.bg),this.bg.height=this.height,this.bg.setPositionRound(this.width/2,this.height/2)},onEnter:function(){this._super(),this.toolbar.onAddItemListener=this.createListener(this.addItem.bind(this)),this.toolbar.onRemoveItemListener=this.createListener(this.removeItem.bind(this)),this.toolbar.onUpdateItemsListener=this.createListener(this.updateItems.bind(this)),this.toolbar.onEnableListener=this.createListener(this.updateEnabled.bind(this)),this.toolbar.onForceItem=this.createListener(this.onForceItem.bind(this)),
this.updateItems(!0),this.hide(!0),this.updateEnabled(this.toolbar.enabled),cleverapps.metha.registerControl("toolbar",this.createListener(function(e){this.stopAllActions(),e?this.toolbar.enabled&&this.show():this.hide()}.bind(this)))},onForceItem:function(){this.show(!0)},addItem:function(e){var t=new(e.getViewClass())(e);this.addChild(t),this.itemsViews.push(t),this.itemsViews.sort(function(e,t){return e.toolbarItem.type-t.toolbarItem.type}),this.updateItems()},removeItem:function(t){var e=this.itemsViews.filter(function(e){return e.toolbarItem===t});e&&(this.itemsViews.splice(this.itemsViews.indexOf(e),1),e.removeFromParent(),this.updateItems())},updateItems:function(s){var e=cleverapps.styles.ToolbarView,n=[],o=[],a=[],r=0;this.itemsViews.forEach(function(e){var t=e.visible;t&&r++;var i=e.toolbarItem.isVisible();i!==t&&(o.push(e),i?e.setVisible(!0):s?e.setVisible(!1):(a.push(e),e.stopAllActions(),e.runAction(new cc.Sequence(new cc.ScaleTo(.3,0),new cc.CallFunc(function(){
e.setVisible(!1),e.setScale(1)}))))),i&&n.push(e)}.bind(this));var l=(n.length-1)*e.margin;n.forEach(function(e){e.baseScaleX=1,l+=e.width});var t=0;0<n.length&&(t=cleverapps.UI.arrangeWithMargins(n,{direction:cleverapps.UI.HORIZONTAL,margin:e.margin,y:this.height/2+e.items.dy,iterator:function(e,t,i){t-=l/2,s?(e.scale=1,e.setPositionRound(t,i)):(-1!==o.indexOf(e)&&(e.scale=0,e.setPositionRound(t,i)),e.stopAllActions(),e.runAction(new cc.Spawn(new cc.ScaleTo(.6,1).easing(new cc.easeBackOut(.05)),new cc.MoveTo(.6,cc.p(t,i)))))}})),this.updateBg(t,r,n.length,s)},updateBg:function(e,t,i,s){this.bg.stopAllActions(),s||t<i?this._updateBg(e):this.bg.runAction(new cc.Sequence(new cc.DelayTime(.6),new cc.CallFunc(this._updateBg.bind(this,e))))},_updateBg:function(e){var t=cleverapps.styles.ToolbarView;this.bg.width=e+2*t.margin+2*t.bg.padding,this.bg.setPositionRound(this.width/2,this.height/2),this.setScale(this.bg.width>cc.director.getWinSize().width?cc.director.getWinSize(
).width/this.bg.width:1),this.decors&&(this.decors.forEach(function(e){e.removeFromParent()}),delete this.decors),this.decors=SceneDecors.add(this.bg,cleverapps.skins.getSlot("toolbarDecors"))},updateEnabled:function(e){this.stopAllActions(),e&&0===cleverapps.windows.list.length?(this.hide(!0),this.show()):this.hide()}});cleverapps.styles.ToolbarView={position:{x:{align:"center",dx:0},y:{align:"bottom",dy:0}},bg:{height:115,padding:0},hover:{margin:6},items:{dy:0},margin:30};var ToolbarItemCountdownView=cleverapps.CountDownView.extend({ctor:function(e){var t=cleverapps.overrideStyles(cleverapps.styles.ToolbarItemView.countdownView,{font:cleverapps.styles.FONTS.TOOLBAR_ITEM_TIMER_TEXT},!0);if(t.scale9){var i=new cc.Scale9Sprite(t.background_image);i.setContentSize2(t.bg.width,t.bg.height),t.background_content=i}this._super(e,t)},refresh:function(){this._super(),this.visible=0<this.countDown.getTimeLeft()},whatToDoOnStop:function(){this.countDown.onSecond=function(){}}}),
ToolbarItemView=cc.Node.extend({ctor:function(e){this._super(),this.toolbarItem=e;var t=cleverapps.styles.ToolbarItemView;this.shakeTimeout=new cc.Node,this.addChild(this.shakeTimeout),this.hideTimeout=new cc.Node,this.addChild(this.hideTimeout);var i=new cc.Sprite(this.toolbarItem.icon);i.setAnchorPoint2(),this.addChild(i),this.icon=i,this.setContentSize2(this.icon.getContentSize()),this.setAnchorPoint2(),this.icon.setPositionRound(t.icon);var s=new cc.Sprite(t.mark.icon);s.setAnchorPoint2(),this.addChild(s),s.setPositionRound(t.mark),(this.mark=s).runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.3,1.1),new cc.ScaleTo(.3,1)))),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,function(){cleverapps.audio.playSound(bundles.main.urls.icon_click_effect),cleverapps.forces.isRunningForce()&&(this.toolbarItem.countdown&&this.addTimerView(),cleverapps.forces.closeRunningForce()),this.toolbarItem.onClick()}.bind(this)),this.toolbarItem.countdown&&this.addTimerView()},
showForce:function(e){cleverapps.forces.create(this,e)},addTimerView:function(){this.timerView&&(this.timerView.removeFromParent(),delete this.timerView);var e=cleverapps.styles.ToolbarItemView.timer,t=new ToolbarItemCountdownView(this.toolbarItem.countdown);t.setPosition(this.width/2+e.offsetX,this.height/2+e.offsetY),t.setScale(e.scale),this.addChild(t),this.timerView=t},onEnter:function(){this._super(),this.toolbarItem.onChangeStateListener=this.createListener(this.onChangeState.bind(this)),this.toolbarItem.onRewardListener=this.createListener(this.onReward.bind(this)),this.toolbarItem.showForce=this.createListener(this.showForce.bind(this)),this.onChangeState()},grayscale:function(){this.icon.setColor(this.toolbarItem.enabled?cleverapps.styles.COLORS.GRAY_SCALE_RESTORE_COLOR:cleverapps.styles.COLORS.GRAY_SCALE_COLOR),this.toolbarItem.countdown&&(this.timerView.setVisible(!this.toolbarItem.enabled),this.timerView.refresh())},onChangeState:function(){if(
this.toolbarItem.grayscaleDisabled&&this.grayscale(),this.mark.setVisible(this.toolbarItem.marked),this.toolbarItem.marked){var e=Math.floor(8*Math.random())+8;this.shake(e)}},onReward:function(){var e=new CoinsRewardView(cleverapps.styles.ToolbarItemView.reward);this.addChild(e),e.setPositionRound(this.width/2,this.height),e.collectCoins(cleverapps.Bet.REGEN_AMOUNT)},shake:function(e){if(this.toolbarItem.marked&&!this.shakeRunned){this.shakeRunned=!0;var t=function(){this.toolbarItem.marked&&this.parent.visible&&(cleverapps.audio.playSound(bundles.main.urls.icon_jump_effect),this.runAction(new cc.Sequence(new cc.ScaleTo(.5,1.2,.8),new cc.Spawn(new cc.ScaleTo(.2,1,1),new cc.MoveBy(.2,0,150)),new cc.MoveBy(.2,0,-150),new cc.MoveBy(.1,0,30),new cc.MoveBy(.1,0,-30),new cc.CallFunc(function(){this.shakeRunned=!1,this.shake(Math.floor(8*Math.random())+8)}.bind(this)))))}.bind(this);this.shakeTimeout.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.CallFunc(t)))}},onMouseOver:function(){
this.toolbarItem.enabled&&this.setScale(1.05*this.baseScale||1.05)}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{TOOLBAR_ITEM_TIMER_TEXT:{prefix:"digits#timer_digit_",scale:.8,size:40,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.ToolbarItemView={timer:{offsetY:-10,offsetX:0,scale:.6},icon:{x:{align:"center"},y:{align:"center"}},mark:{icon:res.toolbar_attention_icon_png,x:{align:"center",dx:-30},y:{align:"center",dy:30}},countdownView:{background_image:res.timer_bg_png,timerPosition:{x:0,y:0}},reward:{randomOffset:!0,sparkAnimation:!1,text:{scale:.6},coins:[{radiusX:60,radiusY:60,count:8,scale:1},{radiusX:40,radiusY:40,count:4,scale:1.3}]}},cleverapps.FBLoginOrInvite=function(){if(cleverapps.social.isInitialized()&&!cleverapps.flags.nologin){var e=!1;if((cleverapps.social.isLoggedIn()||cleverapps.social.nativeInviteFriends)&&(e=!0),!e||!cleverapps.flags.noviral){var t=cleverapps.styles.FBLoginOrInvite,i=new cc.Node;i.setAnchorPoint2();var s=i.createListener(function(
){var e=cleverapps.social.isLoggedIn()?cleverapps.EVENTS.FBLOGINORINVITE_INVITE:cleverapps.EVENTS.FBLOGINORINVITE_LOGIN;cleverapps.eventLogger.logEvent(e),i.removeFromParent(!0)}),n=new FbButton({showIcon:!1,onSuccess:s});i.setContentSize2(n.getContentSize());var o=cleverapps.UI.getSceneSize();if(i.setPosition(o.width/2,n.height/2+cleverapps.UI.getSceneOffsetY()+t.y),i.addChild(n),n.setPositionRound(i.width/2,i.height/2),n.onMouseOver=function(){},n.onMouseOut=function(){},t.images.avatars){var a=new cleverapps.UI.Avatar({avatar:res.default_avatar,frame:bundles.avatar.frames.avatar_frame2});a.setScale(t.images.avatars.scale),a.setPositionRound(t.images.avatars.right.x,t.images.avatars.right.y,i.getContentSize()),a.setRotation(t.images.avatars.right.rotation),i.addChild(a);var r=new cleverapps.UI.Avatar({avatar:res.default_avatar,frame:bundles.avatar.frames.avatar_frame2});r.setScale(t.images.avatars.scale),r.setPositionRound(t.images.avatars.left.x,t.images.avatars.left.y,
i.getContentSize()),r.setRotation(t.images.avatars.left.rotation),i.addChild(r)}var l=cleverapps.UI.generateTTFText(e?"messages:FBLoginOrInvite.invite":"messages:FBLoginOrInvite.login",cleverapps.styles.FONTS.FBLOGINORINVITE_TEXT);return l.setPosition(i.width/2,i.height+t.text.offset),l.fitTo(t.text.width),i.addChild(l),i.setScale(0),i.runAction(new cc.Sequence(new cc.ScaleTo(.5,1).easing(new cc.easeBackOut),new cc.CallFunc(function(){cleverapps.UI.applyHover(i)}))),l.setOpacity(0),l.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.FadeIn(.5))),i.setLocalZOrder(5),i}}},cleverapps.styles.FBLoginOrInvite={y:4,x:0,images:{avatars:{scale:.7,left:{x:{align:"left",dx:-70},y:{align:"center"},rotation:-7},right:{x:{align:"left",dx:-40},y:{align:"center",dy:5},rotation:13}}},text:{offset:26,width:700}},cleverapps.Row=cc.Scale9Sprite.extend({getStyles:function(){return cleverapps.styles.Row},getMaxTextLength:function(){return 12},ctor:function(e){var t=this.getStyles();e.player&&(
this.player=!0),this.notInTop=e.notInTop,this.clickableArea=e.clickableArea;var i=new cc.Sprite(e.player?t.you_bg:t.bg);this._super(i.getSpriteFrame()),this.setContentSize2(t.size),this.updatePlace(e.place,!0);var s=new cleverapps.UI.Avatar(e.avatar);s.setPosition(t.avatar.position.x,t.avatar.position.y+this.height/2),s.setScale(t.avatar.scale),this.addChild(s);var n=e.text||"";if(n||"string"!=typeof e.id||(n="Player_"+e.id.substr(-3)),n.length>this.getMaxTextLength()){var o=(n=n.replace(/^[\s]+/,"")).lastIndexOf(" ",this.getMaxTextLength());o<=0&&(o=this.getMaxTextLength()),n=n.substr(0,o)}var a=cleverapps.UI.generateTTFText(n,e.player?cleverapps.styles.FONTS.ROW_PLAYER_TEXT||t.text.playerFont:cleverapps.styles.FONTS.ROW_TEXT||t.text.font);t.text.width&&a.fitTo(t.text.width),a.setPosition(t.text.x,t.text.y+this.height/2),this.addChild(a),this.generateData(e)},updateParams:function(e){this.notInTop=e.notInTop},generateDataBg:function(e){var t,i=this.getStyles();if(i.data.bg){
var s=e.player&&i.data.bgYou?i.data.bgYou:i.data.bg;t=new cc.Scale9Sprite(new cc.Sprite(s).getSpriteFrame())}else(t=new cc.Node).setAnchorPoint2();return this.addChild(t),t.setContentSize2(i.data.size),t.setPosition(i.data.position.x,i.data.position.y+this.height/2),t},generateDataContent:function(e,t){var i=this.getStyles();if(i.data.icon){var s=i.data.icon;t.dataIcon&&(s=t.dataIcon),s=s instanceof cc.SpriteFrame?s:res[s]?res[s]:s,(s=new cc.Sprite(s)).setPosition(i.data.iconPosition.x,i.data.iconPosition.y+e.height/2),s.setScale(i.data.scale),s.setRotation(i.data.rotation),e.addChild(s)}this.dataAmount=cleverapps.UI.generateTTFText("",cleverapps.styles.FONTS.ROW_DATA_TEXT||i.data.amount.font),this.dataAmount.setPosition(i.data.amount.x,e.height/2+i.data.amount.y),e.addChild(this.dataAmount),this.updateAmount(t.amount,!0)},generateData:function(e){var t=this.generateDataBg(e);this.getTooltipText()&&cleverapps.tooltipManager.create(t,{text:this.getTooltipText(),
position:cleverapps.styles.UI.Tooltip.LOCATION.below,clickableArea:this.clickableArea}),this.generateDataContent(t,e)},getTooltipText:function(){return""},updatePlace:function(e,t){this.currentPlace!==e&&(this.currentPlace=e,this.refreshPlace(this.currentPlace,t),this.refreshReward(this.currentPlace,t))},updateAmount:function(e,t){this.currentAmount!==e&&(this.currentAmount=e,this.dataAmount.setString(this.currentAmount),t||(this.dataAmount.stopAllActions(),this.dataAmount.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.5),new cc.ScaleTo(.2,1)))))},refreshReward:function(e){var t=this.getStyles();t.reward&&(this.reward&&this.reward.removeFromParent(!0),this.reward=this.generatePrizeBanner(e),this.reward&&(this.reward.setPosition(t.reward.x,t.reward.y+this.height/2),this.addChild(this.reward)))},refreshPlace:function(e){var t=this.getStyles();this.place&&this.place.removeFromParent(!0),this.place=this.generatePlaceBadge(e),this.place.setPosition(t.place.x,
this.place.y+t.place.y+this.height/2),this.addChild(this.place)},generatePlaceBadge:function(e){var t=this.getStyles(),i=this.player?t.place.playerFont:t.place.font;if(!(t=t.placeBadges)||e>t.icons.length)return this.generatePlaceText(e,i);var s=new cc.Sprite(t.icons[e-1]);return s.setPositionRound(t.x,t.y),s},generatePlaceText:function(e,t){var i=e;return this.notInTop&&(i="-"),cleverapps.UI.generateTTFText(i,t)},generatePrizeBanner:function(e){var t=this.getStyles();if(t.prizes&&!(e>(t=t.prizes).length)){t=t[e-1];var i=new cc.Node;if(t.banner){var s=new cc.Sprite(t.banner);i.addChild(s)}if(t.icon){var n=new cc.Sprite(cleverapps.bet?t.iconBet:t.icon);n.setScale(t.scale),i.addChild(n),n.setPosition(0,t.y);var o=Messages.get("PrizeTooltip");this.currentPlace&&this.currentPlace<=5&&(o=Messages.get("Cup"+this.currentPlace+"PlaceTooltip"));var a=new cc.Node;a.setContentSize2(n.getContentSize()),a.setAnchorPoint2(),i.addChild(a),cleverapps.tooltipManager.create(a,{rewards:this.getRewards(),
text:o,position:cleverapps.styles.UI.Tooltip.LOCATION.above,clickableArea:this.clickableArea})}return i}},getRewards:function(){}}),cleverapps.styles.Row={bg:res.row_player_png,you_bg:res.row_you_png,size:{width:680,height:70},placeBadges:{x:0,y:8,icons:[bundles.main.frames.levelstart_cup_1,bundles.main.frames.levelstart_cup_2,bundles.main.frames.levelstart_cup_3]},place:{x:56,y:-4,font:cleverapps.styles.FONTS.TEXT,playerFont:cleverapps.styles.FONTS.WHITE_TEXT},avatar:{scale:.5,position:{x:150,y:0}},text:{x:290,y:-4,font:cleverapps.styles.FONTS.SMALL_TEXT,playerFont:cleverapps.styles.FONTS.SMALL_WHITE_TEXT,width:200},reward:{x:464,y:-4},prizes:[{banner:res.red_banner_png,icon:bundles.menubar.frames.star_chest_icon_png,scale:.85,y:6},{banner:res.blue_banner_png,icon:bundles.menubar.frames.star_chest_icon_png,scale:.8,y:6},{banner:res.green_banner_png,icon:bundles.menubar.frames.star_chest_icon_png,scale:.75,y:6},{icon:bundles.menubar.frames.star_chest_icon_png,scale:.7,y:6},{
icon:bundles.menubar.frames.star_chest_icon_png,scale:.7,y:6}],data:{size:{width:140,height:60},bg:res.light_bg_png,icon:"missionIcon",scale:.5,rotation:-10,iconPosition:{x:32,y:0},position:{x:604,y:0},amount:{x:100,y:-4,font:cleverapps.styles.FONTS.WHITE_TEXT}}},cleverapps.LeadersRow=cleverapps.Row.extend({getStyles:function(){return cleverapps.styles.LeadersRow},getMaxTextLength:function(){return 16}}),cleverapps.styles.LeadersRow={bg:bundles.main.frames.row_player_png,you_bg:bundles.main.frames.row_you_png,size:{width:680,height:70},badgeY:8,place:{x:56,y:-4,font:cleverapps.styles.FONTS.TEXT,playerFont:cleverapps.styles.FONTS.WHITE_TEXT},placeBadges:{x:0,y:8,icons:[bundles.main.frames.levelstart_cup_1,bundles.main.frames.levelstart_cup_2,bundles.main.frames.levelstart_cup_3]},avatar:{scale:.5,position:{x:150,y:0}},text:{x:360,y:-4,font:cleverapps.styles.FONTS.SMALL_TEXT,playerFont:cleverapps.styles.FONTS.SMALL_WHITE_TEXT,width:280},data:{size:{width:140,height:60},
bg:bundles.main.frames.light_bg_png,position:{x:604,y:0},amount:{x:70,y:-4,font:cleverapps.styles.FONTS.WHITE_TEXT}}},cleverapps.MissionRow=cleverapps.Row.extend({getRewards:function(){var e=cleverapps.clone(RewardsConfig.Tournament.places[this.currentPlace-1],!0);return RewardsConfig.Tournament.prepareByRich&&(e=cleverapps.user.prepareRewardByRich(e)),e},getTooltipText:function(){return Messages.get("ResultTooltip")}}),cleverapps.DailyCupRow=cleverapps.Row.extend({getStyles:function(){return cleverapps.styles.DailyCupRow},getRewards:function(){return cleverapps.dailyCup.data.rewards[this.currentPlace-1]},getTooltipText:function(){return Messages.get("ResultTooltip")}}),cleverapps.styles.DailyCupRow=cleverapps.overrideStyles(cleverapps.styles.Row,{data:{icon:bundles.main.frames.stars_star,scale:.4,rotation:0}},!0),function(){cleverapps.styles.DailyCupRow.prizes=[];for(var e=[.85,.8,.7],t=[res.red_banner_png,res.blue_banner_png,res.green_banner_png],i=0;i<3;i++
)cleverapps.styles.DailyCupRow.prizes[i]={banner:t[i],icon:bundles.menubar.frames.star_chest_icon_png,iconBet:bundles.menubar.frames.star_chest_icon_png,scale:e[i],y:6};for(i=3;i<10;i++)cleverapps.styles.DailyCupRow.prizes[i]={icon:bundles.menubar.frames.life_unlim_png,iconBet:bundles.menubar.frames.coin_png,scale:.7,y:6}}(),cleverapps.DailyCupLeadersRow=cleverapps.Row.extend({getStyles:function(){return cleverapps.styles.DailyCupLeadersRow},generateMedalAmount:function(e,t){var i=this.getStyles();i=i.medal;var s=new cc.Node;s.setAnchorPoint2();var n=i.places[e-1],o=new cc.Sprite(n.icon.image);n.icon.scale&&o.setScale(n.icon.scale),s.addChild(o);var a=cleverapps.UI.generateTTFText(t,i.font);a.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.addChild(a);var r=n.width-o.width*o.scale-i.iconMargin;return 3!==e&&(r+=i.margin),a.fitTo(r),cleverapps.UI.arrangeWithMargins(s.getChildren(),{direction:cleverapps.UI.HORIZONTAL,margin:i.iconMargin}),cleverapps.UI.wrap(s),s.setContentSize2(n.width,
s.height),s},generateDataContent:function(e,t){var i=this.getStyles();i=i.medal;var s=new cc.Node;s.setAnchorPoint2(),s.addChild(this.generateMedalAmount(1,t.firstPlace)),s.addChild(this.generateMedalAmount(2,t.secondPlace)),s.addChild(this.generateMedalAmount(3,t.thirdPlace)),cleverapps.UI.arrangeWithMargins(s.getChildren(),{direction:cleverapps.UI.HORIZONTAL,margin:i.margin}),cleverapps.UI.wrap(s),s.setPositionRound(e.width/2,e.height/2),e.addChild(s)}}),cleverapps.styles.DailyCupLeadersRow=cleverapps.overrideStyles(cleverapps.styles.Row,{prizes:[],placeBadges:void 0,medal:{places:[{icon:{image:res.levelstart_cup_1,scale:.5},width:98},{icon:{image:res.levelstart_cup_2,scale:.5},width:86},{icon:{image:res.levelstart_cup_3,scale:.5},width:86}],font:cleverapps.styles.FONTS.SMALL_WHITE_TEXT,iconMargin:2,margin:16},place:{x:36},avatar:{position:{x:96}},text:{x:240},data:{size:{width:320,height:60},position:{x:514,y:0}}},!0),cleverapps.Table=function(){this.results={}},
cleverapps.Table.prototype.updateResults=function(e,t){this.results[e]=[];for(var i=0;i<t.length;i++)this.results[e].push(cleverapps.clone(t[i]))},cleverapps.Table.prototype.resetResults=function(e){this.results[e]=void 0},cleverapps.Table.prototype.getResults=function(e){return this.results[e]},cleverapps.Table.prototype.createTableView=function(e){var t=new cleverapps.TableView(e.data,this.results[e.id],e.rowConstructor,e.dataIcon,e.options);return this.updateResults(e.id,e.data),t},cleverapps.TableView=cc.Node.extend({setupRowPosition:function(e,t,i){var s=function(){e.view.currentPlace===e.data.place&&e.data.place>this.amountRows?(e.view.removeFromParent(),delete this.rows[e.data.id]):this.scroll&&this.setRowVisibility(e),i&&i()}.bind(this);t=this.amountRows-t;var n=cc.p(this.styles.innerPadding,this.styles.innerPadding+(this.styles.margin+e.view.height)*t+e.view.height/2);e.view.setLocalZOrder(t),i&&(this.isVisiblePosition(e.view.y,e.view.height)||this.isVisiblePosition(n.y,
e.view.height))?e.view.runAction(new cc.Sequence(new cc.MoveTo(.2,n),new cc.CallFunc(s))):(e.view.setPositionRound(n),s())},isVisiblePosition:function(e,t){return e-=this.scroll.innerContent.height/2,-this.scroll.innerContent.y-this.scroll.height/2-t/2<=e&&e<=-this.scroll.innerContent.y+this.scroll.height/2+t/2},finishAnimation:function(){this.inSwapAnimation--,0===this.inSwapAnimation&&this.swapIfNeed()},startAnimation:function(e){e||(e=1),this.inSwapAnimation+=e},swapPairIfNeed:function(e,t){var i=e.view.currentPlace,s=t.view.currentPlace;this.startAnimation(2),e.view.updatePlace(s),t.view.updatePlace(i),this.setupRowPosition(e,s,this.finishAnimation.bind(this)),this.setupRowPosition(t,i,this.finishAnimation.bind(this))},findRowWithPlace:function(e){for(var t in this.rows)if(this.rows[t].view.currentPlace===e)return this.rows[t];return!1},swapIfNeed:function(){if(0===this.inSwapAnimation){var e,t,i=this.amountRows+2;for(t in this.rows
)this.rows[t].view.currentPlace>this.rows[t].data.place&&this.rows[t].data.place<i&&(i=this.rows[t].data.place,e=this.rows[t]);for(t in e&&this.swapPairIfNeed(this.findRowWithPlace(e.view.currentPlace-1),e),this.rows)this.rows[t].data.place<=i&&this.rows[t].view.updateAmount(this.rows[t].data.amount)}},setRowVisibility:function(e){e&&e.view&&e.view.setVisible(this.isVisiblePosition(e.view.y,e.view.height))},setRowsVisibility:function(){for(var e in this.rows)this.setRowVisibility(this.rows[e])},cloneResults:function(e){var t,i=[];for(t=0;t<e.length;t++)i.push(cleverapps.clone(e[t]));return i},updateResults:function(e){if(this.amountRows!==e.length)return!1;var t,i=this.cloneResults(e),s=this.amountRows+1;for(t in this.rows)this.rows[t].data.place=s;for(t=0;t<i.length;t++)if(this.rows[i[t].id])this.rows[i[t].id].data=i[t],this.rows[i[t].id].view.updateParams(i[t]);else{this.dataIcon&&(i[t].dataIcon=this.dataIcon);var n=cleverapps.clone(i[t]);n.place=s,this.rows[i[t].id]={
view:new this.rowConstructor(n),data:i[t]},this.rows[i[t].id].view.setAnchorPoint2(0,.5),this.node.addChild(this.rows[i[t].id].view),this.setupRowPosition(this.rows[i[t].id],n.place)}return this.swapIfNeed(),!0},findPlayerView:function(){for(var e in this.rows)if(this.rows[e].data.player)return this.rows[e].view},ctor:function(e,t,i,s,n){var o;for(n=n||{},this.rows={},this.amountRows=0,this.inSwapAnimation=0,this.startAnimation(),t&&e.length!==t.length&&(t=void 0),e=this.cloneResults(e),t||(t=e),t=this.cloneResults(t),i||(i=cleverapps.Row),this.rowConstructor=i,this.dataIcon=s,o=0;o<t.length;o++)this.dataIcon&&(t[o].dataIcon=this.dataIcon),(t[o].clickableArea=this).rows[t[o].id]={view:new this.rowConstructor(t[o]),data:t[o]},this.amountRows++;var a=cleverapps.styles.TableView;n.styles&&(a=cleverapps.overrideStyles(a,n.styles,!0)),this.styles=a,this._super(),this.setAnchorPoint2();var r=this.node=new cc.Node;r.setAnchorPoint2();var l=this.styles.width,c=0;for(o in this.rows
)this.rows[o].view.setAnchorPoint2(0,.5),r.addChild(this.rows[o].view),l=this.rows[o].view.width,c=this.rows[o].view.height,this.setupRowPosition(this.rows[o],this.rows[o].data.place);c=this.amountRows*c+(this.amountRows-1)*a.margin+2*a.innerPadding,r.setContentSize2(l+2*a.innerPadding,c);var p=0,d=a.height+2*a.innerPadding;c<=d&&(p=d-c),this.scroll=new cleverapps.UI.ScrollView(r,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_NONE,containerMovedListener:this.createListener(this.setRowsVisibility.bind(this))}),this.scroll.setContentSize2(r.width,0===p?d:c+1),0===p&&this.scroll.scrollTo(this.findPlayerView()),this.scroll.setAnchorPoint2(0,0),this.scroll.setPosition(a.padding,a.padding+p),this.setContentSize2(this.scroll.width+2*a.padding,d+2*a.padding),this.addChild(this.scroll),a.bg&&(this.bg=new cc.Scale9Sprite(a.bg),this.addChild(this.bg),this.bg.setContentSize2(this.getContentSize()),this.bg.setPositionRound(this.width/2,this.height/2),this.bg.setLocalZOrder(-1)),
this.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.CallFunc(this.finishAnimation.bind(this)))),this.updateResults(e),this.setRowsVisibility()}}),cleverapps.styles.TableView={bg:res.light_bg_png,width:500,height:732,margin:4,padding:6,innerPadding:6,scrollBarPosition:{x:12,y:14}};var DialogueView=cc.Node.extend({ctor:function(e,t){(this._super(),this.dialogue=e,this.options=t||{},this.options.button=this.options.button||{},this.persons={},this.dialogue.on("changedStage",this.createListener(this.onChangeStage.bind(this))),this.dialogue.on("showUp",this.createListener(this.showUp.bind(this))),this.dialogue.on("beforeClose",this.createListener(this.close.bind(this))),this.dialogue.on("finishTyping",this.createListener(this.byLetterAnimationFinish.bind(this))),this.setAnchorPoint2(),this.setLocalZOrder(20),this.createBg(),this.options.autoPosition||this.options.forcePosition)&&((this.options.parent||cc.director.getRunningScene().scene).addChild(this),this.calcPosition())
;this.inner=this.options.inner||this.y>cleverapps.UI.getSceneSize().height/2,this.addControls(),this.options.overlay&&!1!==this.options.shadow&&this.addShadow(),cleverapps.audio.playSound(bundles.game.urls.dialogue_effect)},getStyles:function(){return this.options.styles||cleverapps.styles.DialogueView},addShadow:function(){var e=cleverapps.styles.ShadowView;this.shadow=cleverapps.UI.addShadowLayer(),this.shadow.setScale(2),this.shadow.setLocalZOrder(-2),this.shadow.runAction(new cc.FadeTo(e.duration,e.opacity)),this.addChild(this.shadow)},addControls:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:void 0===this.options.swallowTouches||this.options.swallowTouches,onTouchBegan:function(e){var t=this.convertTouchToNodeSpace(e);return!(!this.options.overlay&&!cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t))&&(this.dialogue.screenClicked(),!0)}.bind(this)},this)},createBg:function(){var e=this.getStyles().bg;this.bg=new cc.Node,
this.bg.setAnchorPoint2();var t=cleverapps.UI.getSceneSize().width-2*e.widthOffset;this.bg.setContentSize2(t,e.height),this.setContentSize2(this.bg.getContentSize()),this.bg.image=this.getBgImage(e),this.bg.addChild(this.bg.image),this.bg.image.setPositionRound(this.bg.width/2,this.bg.height/2),this.addChild(this.bg),this.bg.setPositionRound(this.width/2,this.height/2+e.offsetY)},getBgImage:function(e){if(e.pattern){for(var t=cleverapps.UI.getSceneSize(),i=cleverapps.UI.createScale9Sprite(bundles.dialogues.frames.bg_png).width,s=[],n=0;n<Math.ceil(t.width/i);n++){var o=cleverapps.UI.createScale9Sprite(bundles.dialogues.frames.bg_png);o.setContentSize(o.width,this.bg.height),s.push(o)}return new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL})}var a=new cc.Scale9Sprite(bundles.dialogues.frames.bg_png);return a.setContentSize2(this.bg.width+e.imageSurplusWidth,this.bg.height),a},getHideDirection:function(){return this.targetPos.y>cleverapps.UI.getSceneSize().height/2?1:-1},
loadBundles:function(e){var t=cleverapps.unique(this.dialogue.bundles).filter(function(e){return bundles[e]});if(0!==t.length){var i=new WaitWindow,s=function(){i&&(i.close(),i=void 0)},n=this.createListener(function(){s(),e()}.bind(this)),o=this.createListener(function(){s(),new RestartWindow}.bind(this));cleverapps.bundleLoader.loadBundles(t,{onSuccess:n,onFailure:o})}else e()},showUp:function(){var e=this.getStyles(),t=cleverapps.UI.getSceneSize(),i=this.options.delay||0,s=this.targetPos=this.getPosition();s.y>t.height/2?this.startPos=cc.p(s.x,t.height+this.height/2+e.showUp.y):this.startPos=cc.p(s.x,-this.height/2-e.showUp.y),this.setPositionRound(this.startPos);var n=function(){this.updatePerson(),this.runAction(new cc.Sequence(new cc.DelayTime(i),new cc.MoveTo(.25,cc.p(s.x,s.y-this.getHideDirection()*e.showUp.offset)),new cc.MoveTo(.15,s),new cc.CallFunc(function(){this.dialogue.finishShowUp()}.bind(this))))}.bind(this);this.loadBundles(n)},byLetterAnimationFinish:function(){
this.text&&this.text.byLetterAnimationFinish()},close:function(){if(this.byLetterAnimationFinish(),this.stopAllActions(),this.dialogue.options.showUp?this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.MoveTo(.15,cc.p(this.x,this.y-this.getHideDirection()*this.getStyles().showUp.offset)),new cc.MoveTo(.15,this.startPos),new cc.CallFunc(this.dialogue.finishClose.bind(this.dialogue)),new cc.RemoveSelf)):(this.removeFromParent(!0),this.dialogue.finishClose()),this.shadow){this.shadow.stopAllActions();var e=cleverapps.styles.ShadowView;this.shadow.runAction(new cc.FadeTo(e.duration,0))}},updatePerson:function(){var e=this.getStyles(),t=this.dialogue.stageData.person;void 0===t&&(t=e.persons.default),this.updatePersonAnimation(0,t),this.updatePersonTitle(t.styles&&t.styles.title),this.inner||this.updatePersonAnimation(1,this.dialogue.stageData.person2||!1)},onChangeStage:function(){var e=this.getStyles(),t=this.dialogue.stageData.person;void 0===t&&(t=e.persons.default),
this.updatePerson(),this.updateButton(t.position),this.updateText(t.position),this.runByLetterAnimation()},onClicked:function(){this.dialogue.buttonClicked()},updatePersonTitle:function(e){var t=this.getStyles();this.personTitle&&(this.personTitle.isRunningSafe()&&this.personTitle.removeFromParent(),delete this.personTitle);var i=this.persons[0];if(i&&e){this.personTitle=new cc.Sprite(t.personTitle.image);var s=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.DIALOGUE_PERSON_TITLE_TEXT);s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.personTitle.addChild(s),s.fitTo(this.personTitle.width-2*t.personTitle.text.padding.x),s.setPositionRound(this.personTitle.width/2,this.personTitle.height/2+t.personTitle.text.offset.y),t.personTitle.attachToDialogue?(this.personTitle.setAnchorPoint(0,1),this.addChild(this.personTitle),this.personTitle.setPositionRound(t.personTitle.x,t.personTitle.y),this.personTitle.setScale(i.getScale())):(i.addChild(this.personTitle),
this.personTitle.setPositionRound(i.width/2,t.personTitle.y)),i.scaleX<0&&this.personTitle.setScaleX(-this.personTitle.getScaleX())}},updateButton:function(e){if(!this.options.button.noButton){var t=this.getStyles().button;this.button||(this.button=new cleverapps.UI.Button({width:t.width,height:t.height,button_png:t.button_png,button_on_png:t.button_png_on,text:this.options.button.text||Messages.get("Next"),font:cleverapps.styles.FONTS.BUTTON_SMALL_TEXT,onClicked:this.onClicked.bind(this),noThrottle:!0,padding:t.padding}),this.bg.addChild(this.button)),this.dialogue.stage===this.dialogue.data.length-1&&this.button.text.setString(this.options.button.textLast||Messages.get("OK")),"right"===e&&this.inner?this.button.setPositionRound(this.button.width/2+t.offset.x,this.button.height/2+t.offset.y):this.button.setPositionRound(this.bg.width-(this.button.width/2+t.offset.x),this.button.height/2+t.offset.y),this.button.setVisible(!0)}},updateText:function(e){var t=this.getStyles().text
;this.text?this.text.setString(this.dialogue.stageData.text):(this.text=cleverapps.UI.generateTTFText(this.dialogue.stageData.text,this.getStyles().font||cleverapps.styles.FONTS.FORCE_MESSAGE_TEXT),this.bg.addChild(this.text));var i,s,n=this.persons[0],o=t.padding.x,a=t.padding.y;cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(void 0!==t.padding.mobileX&&(o=t.padding.mobileX),void 0!==t.padding.mobileY&&(a=t.padding.mobileY)),"right"===e?(i=t.padding.fromWallX,s=(n&&this.inner?n.x-n.width/2*Math.abs(n.scaleX):this.bg.width)-o):(s=this.bg.width-t.padding.fromWallX,i=(n&&this.inner?n.x+n.width/2*Math.abs(n.scaleX):0)+o);var r=this.bg.height-a,l=(this.button?this.button.y+this.button.height/2:0)+a;this.text.setDimensions(s-i,0),this.text.setHorizontalAlignment(t.alignment),this.text.fitTo(void 0,r-l),this.text.setAnchorPoint2(.5,1),this.text.setPositionRound((i+s)/2,r)},runByLetterAnimation:function(){this.text.byLetterAnimation({delay:this.dialogue.getTypingDelay(),
speed:this.dialogue.getTypingSpeed()})},updatePersonAnimation:function(e,t){if(!1!==t){var i=this.getStyles(),s=this.persons[e],n=s&&s.personAnimation;if(!s||s.styles!==t.styles){this.removePerson(e),(s=new cc.Node).styles=t.styles,s.setAnchorPoint2(),s.setLocalZOrder(1),s.setContentSize2(t.styles.width,t.styles.height),n=t.styles.json?new cleverapps.Spine(t.styles.json):new cc.Sprite(t.styles.image),s.addChild(n),n.setPositionRound(s.width/2,s.height/2),this.bg.addChild(s),cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?s.setScale(t.styles.mobileScale||i.person.mobileScale):s.setScale(t.styles.scale||i.person.scale),(this.persons[e]=s).personAnimation=n,t.styles.json?n.setAnimation(0,t.animation,!0):n.setSpriteFrame(t.styles.image);var o=t.styles.offsetX,a=t.styles.offsetY;cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(void 0!==t.styles.mobileOffsetX&&(o=t.styles.mobileOffsetX),void 0!==t.styles.mobileOffsetY&&(a=t.styles.mobileOffsetY)),
"left"===t.position?s.setPositionRound(s.width/2*s.scale+o,this.bg.height/2+a):(s.setPositionRound(this.bg.width-(s.width/2*Math.abs(s.scaleX)+o),this.bg.height/2+a),0<s.scaleX&&s.setScaleX(-s.scaleX)),this.inner?s.setScale(s.scaleX*i.person.innerScale,s.scaleY*i.person.innerScale):(s.setLocalZOrder(-1),s.y=this.bg.height+s.height/2*s.scaleY),1===e&&s.setScale(s.scaleX*i.person2.scale,s.scaleY*i.person2.scale)}}else this.removePerson(e)},removePerson:function(e){this.persons[e]&&(this.persons[e].removeFromParent(),delete this.persons[e])},calcPosition:function(){var e=this.getStyles(),t=cleverapps.UI.getSceneSize(),i=cc.p(t.width/2,t.height-this.height/2-e.positions.top.y),s=cc.p(t.width/2,t.height-this.height/2-e.positions.topLower.y),n=cc.p(t.width/2,this.height/2+e.positions.bottom.y);if(this.options.forcePosition)this.options.forcePosition===Dialogue.POSITIONS.TOP?this.setPositionRound(i):this.options.forcePosition===Dialogue.POSITIONS.TOP_LOWER?this.setPositionRound(s
):this.options.forcePosition===Dialogue.POSITIONS.BOTTOM&&this.setPositionRound(n);else{if(this.options.rects){for(var o=[n,i],a=0;a<o.length;a++){this.setPositionRound(o[a]);for(var r=!1,l=0;l<this.options.rects.length;l++)if(this.intersectsWithRect(this.options.rects[l])){r=!0;break}if(!r)return}var c=cc.view.getFrameSize(),p="Could not position force message, message text: "+this.dialogue.stageData.text+", screen size: "+c.width+" by "+c.height;cleverapps.ErrorHandler.logError(p)}this.setPositionRound(n)}},intersectsWithRect:function(e){var t=this.getGlobalBoundingBox();this.targetPos&&(t.x-=this.x-this.targetPos.x,t.y-=this.y-this.targetPos.y);var i=cc.rectIntersection(t,e);return 0<i.width&&0<i.height},intersectsWithNode:function(e){return this.intersectsWithRect(e.getGlobalBoundingBox())}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{DIALOGUE_PERSON_TITLE_TEXT:{color:cleverapps.styles.COLORS.WHITE,size:35}}),cleverapps.styles.DialogueView={bg:{height:280,widthOffset:0,
offsetY:0,imageSurplusWidth:0},person:{mobileScale:.9,scale:1.3,innerScale:.75},person2:{scale:.8},personTitle:{image:bundles.dialogues.frames.dialogue_name,y:25,text:{padding:{x:5},offset:{y:-3}},attachToDialogue:!1},persons:{default:{animation:"animation",position:"left",styles:{json:bundles.dialogues.jsons.default_json,width:350,height:300,offsetX:25,offsetY:0}}},button:{padding:{x:10},offset:{x:30,y:30},width:160,height:60,button_png:res.small_green_button,button_png_on:res.small_green_button_on},text:{alignment:cc.TEXT_ALIGNMENT_LEFT,padding:{fromWallX:30,x:30,y:30}},positions:{topLower:{y:200},top:{y:100},bottom:{y:20}},showUp:{y:100,offset:75}};var ProlongationWindow=Window.extend({onWindowLoaded:function(e,t){if(!Game.currentGame)return!1;this.prolongation=e,this.price=e.getCoinsPrice(),this.moves=e.getAmountByCoins(),this.giveUpAlert=e.getGiveUpAlert(),0<this.price&&this.prolongation.addProlongation(),this.onCancel=t;var i=this.content=new cc.Node;i.setLocalZOrder(2),
i.setAnchorPoint(.5,.5);var s=cleverapps.styles.ProlongationWindow,n=s.width,o=this.prolongation.countOfGoals&&this.prolongation.countOfGoals();if(o){var a=3===o&&cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL;n=s.wider.width}i.setContentSize2(n,s.height);var r=cleverapps.UI.generateTTFText("messages:ProlongationWindow.addMoves",cleverapps.styles.FONTS.ADD_MOVES_QUESTION_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT);i.addChild(r),r.setPositionRound(s.question),o&&this.createGoalsViews(o<3||a),this.prolongation.on("addMoves",this.createListener(this.onAddMoves.bind(this)));var l=cleverapps.once(function(e){void 0===e.delay&&(e.delay=s.addMoves.delay),this.prolongation.addMoves(e)}.bind(this)),c=function(){this.giveUpAlert.onTakeMoves(),levels.user.takeGold(this.price)&&(l({moves:this.moves,goldUsed:!0,price:this.price}),c=function(){})}.bind(this);this.coinProlongButton=new CoinProlongButton(this.moves,this.price,cleverapps.styles.FONTS.ADDMOVES_PRICE,c);var p=[
this.coinProlongButton];this.price&&!cleverapps.flags.nopayments&&(this.productProlongButton=new ProductProlongButton(this.prolongation.getProduct(),l),p.push(this.productProlongButton)),this.price&&void 0!==BreakView&&BreakView.AddBreakViews(i,this.viewsLayout?[this.viewsLayout]:[r],cleverapps.styles.ProlongationWindow.breakView.y);var d=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.ProlongationWindow,!0);this._super({title:Messages.get("ProlongationWindow.title"),name:"prolongationwindow",content:i,buttons:p,styles:d,closeButton:0<this.price,notCloseByTouchInShadow:!0}),this.closeButton&&(this.closeButton.settings.onClicked=this.giveUp.bind(this)),cleverapps.audio.playSound(bundles.game.urls.lose_effect);var h=cleverapps.windows.list.filter(function(e){return"confirmexitwindow"===e.name});0!==h.length&&h[0]&&h[0].close(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MOVES_SHOW),this.scheduleUpdate(),s.hero&&(this.hero=new cleverapps.Spine(s.hero.json,1),
this.hero.setAnimation(0,s.hero.animation,!0),this.hero.setPositionRound(s.hero),this.addChild(this.hero))},giveUp:function(){this.giveUpAlert.canShow()?this.giveUpAlertShow():(this.close(),this.onCancel())},giveUpAlertShow:function(){var e=cleverapps.styles.ProlongationWindow.alert,t=new GiveUpAlertView(this.giveUpAlert,e);this.addChild(t)},onShow:function(){this.goldInfo&&this.goldInfo.showUp(),this.productProlongButton&&this.productProlongButton.startAnimate(),this.coinProlongButton&&this.coinProlongButton.startAnimate()},onHide:function(){this.productProlongButton&&this.productProlongButton.stopAnimate(),this.coinProlongButton&&this.coinProlongButton.stopAnimate(),this.goldInfo&&this.goldInfo.onHide()},onClose:function(){this.goldInfo&&this.goldInfo.close(),this.finger&&this.finger.removeFromParent(!0),this.onCancel()},onAddMoves:function(e){this.onCancel=function(){},this.onAddMovesAnimation&&this.onAddMovesAnimation(e.moves),this.hint&&this.hint.close(),this.close()},
listBundles:function(){return["prolongation_window"]}});cleverapps.styles.ProlongationWindow={y:294,width:720,height:270,wider:{width:780},addMoves:{delay:700},question:{x:{align:"center"},y:200},buttons:{x:70,phone:50},breakView:{y:50},goals:{scale:!1},alert:{}};var Prolongation=function(e){cleverapps.EventEmitter.call(this),this.game=e,this.counter=0,this.free=!1};Prolongation.prototype=Object.create(cleverapps.EventEmitter.prototype),(Prolongation.prototype.constructor=Prolongation).prototype.getCoinsPrice=function(){return this.free?0:0===this.counter&&(this.isWhale()||500<levels.user.gold)?250:cleverapps.config.prices.prolongations[this.counter]},Prolongation.prototype.updateFree=function(e){this.free=e},Prolongation.prototype.getAmountByCoins=function(){var e=5;return!this.free&&0===this.counter&&(this.isWhale()||500<levels.user.gold)&&(e=10),e},Prolongation.prototype.isWhale=function(){return cleverapps.paymentsHistory.classify(
)===cleverapps.PaymentsHistory.PAYER_BIGWHALE||cleverapps.paymentsHistory.classify()===cleverapps.PaymentsHistory.PAYER_WHALE},Prolongation.prototype.addProlongation=function(){this.counter++,this.counter>=cleverapps.config.prices.prolongations.length&&(this.counter=cleverapps.config.prices.prolongations.length-1)},Prolongation.prototype.getProduct=function(){var e=Prolongation.PRODUCTS[0];switch(cleverapps.paymentsHistory.classify()){case cleverapps.PaymentsHistory.PAYER_NORMAL:e=Prolongation.PRODUCTS[1];break;case cleverapps.PaymentsHistory.PAYER_WHALE:e=Prolongation.PRODUCTS[2];break;case cleverapps.PaymentsHistory.PAYER_BIGWHALE:e=Prolongation.PRODUCTS[3]}return new Product(e)},Prolongation.prototype.getGiveUpAlert=function(){var e=this.game.gameMission,t=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN)&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN).logic.lantern,i=this.game.getPercentOfCompletion(),
s=this.game.rewards[GameBase.REWARD_GOLD],n=void 0;return this.game.collectedBoosterCell?n=Prolongation.GIVE_UP_TYPES.BOOSTER:t&&t.isActive(this.game.level)&&0<t.getCurrentStreak()?n=Prolongation.GIVE_UP_TYPES.LANTERN:e&&e.isRunning()&&0<this.game.rewards.clover?n=Prolongation.GIVE_UP_TYPES.MISSION:s&&s>this.game.basicGoldReward?n=Prolongation.GIVE_UP_TYPES.GOLD_COLLECTED:.85<=i&&(n=Prolongation.GIVE_UP_TYPES.NEARLY),new GiveUpAlert(n)},Prolongation.prototype.addMoves=function(t){if(t.goldUsed&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HINT_USED,{amount:t.price}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MOVES_BOUGHT+"_"+t.price)),cleverapps.history.add("moves",t.moves),this.trigger("addMoves",t),Game.currentGame){var i=Game.currentGame;i.hand&&i.hand.extra.hide(),i.counter.setTimeout(function(){if(i.hand?i.hand.addExtra(t.moves,t.bonus):i.setMoves(t.moves),i.score&&i.score.addBuyMoves(),t.bonus&&"match3"===cleverapps.config.type)for(var e=0;e<t.bonus;e++
)i.field.addRandomMulticolor()},t.delay||700)}},Prolongation.GIVE_UP_TYPES={BOOSTER:0,LANTERN:1,MISSION:2,GOLD_COLLECTED:3,NEARLY:4},Prolongation.PRODUCTS=["addMoves1","addMoves2","addMoves3","addMoves5"];var GiveUpAlert=function(e){cleverapps.EventEmitter.call(this),this.type=e,this.viewExists=!1};GiveUpAlert.prototype=Object.create(cleverapps.EventEmitter.prototype),(GiveUpAlert.prototype.constructor=GiveUpAlert).prototype.getMessage=function(){switch(this.type){case Prolongation.GIVE_UP_TYPES.BOOSTER:return"messages:AddMovesWindow.boosterGiveUp";case Prolongation.GIVE_UP_TYPES.MISSION:return"messages:AddMovesWindow.missionGiveUp."+Game.currentGame.gameMission.getName();case Prolongation.GIVE_UP_TYPES.LANTERN:return"messages:AddMovesWindow.lanternGiveUp";case Prolongation.GIVE_UP_TYPES.GOLD_COLLECTED:return"messages:AddMovesWindow.goldCollectedGiveUp";case Prolongation.GIVE_UP_TYPES.NEARLY:return"messages:AddMovesWindow.nearlyDoneGiveUp"}return""},
GiveUpAlert.prototype.onTakeMoves=function(){this.viewExists&&!this.takeMovesLogged&&(this.takeMovesLogged=!0,this.type===Prolongation.GIVE_UP_TYPES.NEARLY?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GIVEUP_CHANGE_NEARLY):void 0!==this.type&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GIVEUP_CHANGE))},GiveUpAlert.prototype.canShow=function(){return void 0!==this.type&&!this.viewExists&&Game.currentGame&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN},GiveUpAlert.prototype.onShow=function(){this.viewExists||(this.viewExists=!0,this.type===Prolongation.GIVE_UP_TYPES.NEARLY?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GIVEUP_ATTENTION_NEARLY):this.type===Prolongation.GIVE_UP_TYPES.MISSION?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GIVEUP_MISSION):void 0!==this.type&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GIVEUP_ATTENTION))};var GiveUpAlertView=cc.Node.extend({ctor:function(e,t){this._super(),this.giveUpAlert=e,this.giveUpAlert.onShow()
;var i=cleverapps.styles.GiveUpAlertView,s=cleverapps.UI.createScale9Sprite(i.bg.image);s.setContentSize2(t.size),s.setLocalZOrder(-1),this.setContentSize2(s.width,s.height),this.setAnchorPoint2(),s.setPositionRound(this.width/2,this.height/2),this.addChild(s),this.setCascadeOpacityEnabled(!0),this.setPositionRound(t.position);var n=cleverapps.UI.generateTTFText(e.getMessage(),cleverapps.styles.FONTS.LEVEL_TUTORIAL_TEXT);n.setCascadeOpacityEnabled(!0),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setDimensions(this.width+i.text.padding[cleverapps.wideMode.mode].x,0),n.fitTo(void 0,this.height),n.setPositionRound(i.text),this.addChild(n),this.showUp(),cleverapps.audio.playSound(bundles.game.urls.bubble_effect)},showUp:function(){this.setOpacity(0),this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.FadeIn(.2),new cc.CallFunc(function(){var e=this.getScale();this.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(
.5,1.05*e),new cc.ScaleTo(.5,e))))}.bind(this))))}});cleverapps.styles.GiveUpAlertView={bg:{image:bundles.main.frames.speak_bg_png},text:{x:{align:"center",dx:30},y:{align:"center",dy:0},padding:[{x:-50},{x:-50},{x:-50}]}};var ProductProlongButton=cleverapps.UI.Button.extend({ctor:function(e,t){var i=cleverapps.styles.ProductProlongButton;this.product=e,this._super({content:this.getButtonContent(),onClicked:function(){this.product.buy(function(){t({moves:e.moves,bonus:e.bonus})})}.bind(this),width:i.width,height:i.height}),this.baseScale=i.scale,this.setScale(this.baseScale);var s=new ProductPriceView(this.product,{font:cleverapps.styles.FONTS.ADDMOVES_PRICE,iconScale:i.okPrice.scale,offsetY:i.okPrice.offsetY});s.setPositionRound(this.width/2,i.price.y),this.addChild(s),Lottery.addIcon(this)},startAnimate:function(){this.setScale(0),this.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.ScaleTo(.5,this.baseScale).easing(cc.easeBackOut())))},stopAnimate:function(){
this.stopAllActions(),this.setScale(this.baseScale)},getButtonContent:function(){var e=new cc.Node;e.setAnchorPoint(.5,.5);var t=cleverapps.styles.ProductProlongButton.content,i=cleverapps.UI.generateTTFText(this.product.moves,cleverapps.styles.FONTS.BUTTON_TEXT);e.addChild(i);var s=new cc.Sprite(bundles.game.frames.game_moves_icon);if(s.setScale(t.moves.scale),s.setPositionRound(t.moves),e.addChild(s),this.product.bonus){var n=cleverapps.UI.generateTTFText("+",cleverapps.styles.FONTS.BUTTON_TEXT);e.addChild(cleverapps.UI.wrapWithPadding(n,t.plus));var o=new cc.Node;o.setAnchorPoint2(.5,.5);for(var a=0;a<this.product.bonus;a++){var r=new cc.Sprite(t.bonus.image);r.setScale(t.bonus.scale),o.addChild(r)}cleverapps.UI.arrangeWithMargins(o.children,{margin:t.bonus.margin,direction:cleverapps.UI.HORIZONTAL}),cleverapps.UI.wrap(o),e.addChild(o),o.setPositionRound(t.bonus)}return cleverapps.UI.arrangeWithMargins(e.children,{margin:t.x,direction:cleverapps.UI.HORIZONTAL}),cleverapps.UI.wrap(e)
,e.setAnchorPoint2(),e}});cleverapps.styles.ProductProlongButton={width:350,height:100,scale:1,price:{y:120},content:{x:0,bonus:{image:bundles.game.frames.cell_multicolor,scale:.5,margin:0,x:0,y:0},moves:{scale:1,x:0,y:0},plus:{x:15,y:0}},okPrice:{scale:.6,offsetY:0}};var CoinProlongButton=cleverapps.UI.Button.extend({ctor:function(e,t,i,s){var n=cleverapps.styles.CoinProlongButton;this.amount=e,this.price=t,this.font=i,this._super({content:this.getButtonContent(),width:n.width,height:n.height,onClicked:s}),this.baseScale=n.scale,this.addChild(this.getPriceContent())},startAnimate:function(){cleverapps.UI.removeHover(this),this.setScale(0),this.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.ScaleTo(.5,cleverapps.styles.CoinProlongButton.scale).easing(cc.easeBackOut()),new cc.CallFunc(function(){cleverapps.UI.applyHover(this)}.bind(this))))},stopAnimate:function(){this.stopAllActions(),this.setScale(cleverapps.styles.CoinProlongButton.scale)},getButtonContent:function(){
var e=cleverapps.styles.CoinProlongButton,t=new cc.Node;t.setAnchorPoint(.5,.5);var i=cleverapps.UI.generateTTFText(this.amount,cleverapps.styles.FONTS.BUTTON_TEXT);t.addChild(i);var s=new cc.Sprite(bundles.game.frames.game_moves_icon);return s.setScale(e.content.moves.scale),s.setPositionRound(e.content.moves),t.addChild(s),cleverapps.UI.arrangeWithMargins(t.children,{direction:cleverapps.UI.HORIZONTAL}),cleverapps.UI.wrap(t),t.setAnchorPoint2(),t},getPriceContent:function(){var e=new cc.Node;e.setAnchorPoint(.5,.5);var t=cleverapps.styles.CoinProlongButton,i=new cc.Sprite(bundles.menubar.frames.coin_png);i.setScale(t.content.coin.scale),e.addChild(i);var s=cleverapps.UI.generateTTFText(0===this.price?"messages:FREE":this.price,this.font);return s.setDimensions(0,t.height),s.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.addChild(s),cleverapps.UI.arrangeWithMargins(e.children,{margin:t.content.x,direction:cleverapps.UI.HORIZONTAL}),cleverapps.UI.wrap(e),e.setPositionRound(
this.width/2,t.content.coin.y),e}});cleverapps.styles.CoinProlongButton={width:300,height:100,content:{x:10,coin:{scale:.6,y:130},moves:{scale:1,x:0,y:0}},scale:.9};var RewardElementView=cc.Node.extend({ctor:function(e,t,i){this._super(),this.game=e.game;var s=cleverapps.styles.UI.RewardElementView;if(this.setLocalZOrder(s.zIndex),s.background){var n=s.background[cleverapps.wideMode.mode];this.bg=cleverapps.UI.createSprite(n),n.x&&this.bg.setPositionRound(n),this.addChild(this.bg),cleverapps.styles.COLORS.HARD&&this.game.level.isHard()&&this.bg.setColor(cleverapps.styles.COLORS.HARD)}if(this.icon=i.icon,this.icon.baseScale=s.image.scale,this.icon.setScale(this.icon.baseScale),s[i.name]&&s[i.name].icon?this.icon.setPositionRound(s[i.name].icon.x,s[i.name].icon.y):this.icon.setPositionRound(s.icon.x,s.icon.y),this.addChild(this.icon),this.text=cleverapps.UI.generateTTFText(this.getText(this.game.rewards[i.reward]||0),cleverapps.styles.FONTS.REWARD_ELEMENT_TEXT),
s[i.name]&&s[i.name].color&&this.text.setColor(s[i.name].color),s.amountBg){var o=new cc.Sprite(s.amountBg.image);this.addChild(o),o.setPositionRound(s.text.x,s.text.y)}this.text.baseScale=s.text.scale,this.text.setScale(this.text.baseScale),this.text.setPositionRound(s.text.x,s.text.y),this.addChild(this.text);var a=s.scale[cleverapps.wideMode.mode];this.setScale(a),this.setContentSize2(s.width,s.height),t.addChild(this);var r=s;if(r[i.name]&&r[i.name].position&&(r=r[i.name].position),r.positions)r=r.positions,Array.isArray(r)&&(r=r[cleverapps.wideMode.mode]),Array.isArray(r)&&(r=r[this.game.goals.amountGoals-1]),this.setPositionRound(r.x,r.y);else{var l=r.margin[cleverapps.wideMode.mode],c=cleverapps.UI.getSceneSize(),p="right"===l.align?c.width:"center"===l.align?c.width/2:0;this.setPositionRound(p+l.x,l.y)}var d=new cc.Node;t.addChild(d),d.setPositionRound(this.x+s.targetPosition.offset.x,this.y),d.registerTarget(cleverapps.styles.UI.RewardElementView,i.targetName),-1!==["board",
"solitaire","differences"].indexOf(cleverapps.config.type)&&(cleverapps.UI.makeHideable(this,cleverapps.UI.HORIZONTAL),cleverapps.metha.registerControl(i.control,function(e){cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&e||this.toggle(e)}.bind(this)),cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(e.groupToggler.addToGroup(this,this.getGroupName()),this.hide()))},getText:function(e){return e+""},getGroupName:function(){return"rewardElements"}});RewardElementView.rotateAnimation=function(e,t){e.text.setString(e.getText(t)),0===e.icon.getRotation()&&e.icon.runAction(new cc.Sequence(new cc.Spawn(new cc.Sequence(new cc.ScaleTo(.2,1.2*e.icon.baseScale),new cc.ScaleTo(.2,e.icon.baseScale)),new cc.RotateBy(.4,360)),new cc.CallFunc(function(){e.icon.setRotation(0)}))),e.text.stopAllActions(),e.text.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.5*e.text.baseScale),new cc.ScaleTo(.2,e.text.baseScale)))},RewardElementView.growAnimation=function(e,t){e.icon.stopAllActions(),
e.icon.setScale(e.icon.baseScale),e.icon.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.3*e.icon.baseScale),new cc.ScaleTo(.15,e.icon.baseScale)));var i=e.text.baseScale;e.text.stopAllActions(),e.text.setScale(i),e.text.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.8*i),new cc.CallFunc(function(){e.text.setString(e.getText(t))}),new cc.ScaleTo(.15,i)))},cleverapps.overrideStyles(cleverapps.styles.FONTS,{REWARD_ELEMENT_TEXT:{prefix:"booster_digit_",size:40,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.UI.RewardElementView={zIndex:0,image:{scale:1.4},text:{scale:1,y:0,x:0},icon:{x:0,y:0},amountBg:!1,scale:[.6,1,.7],width:100,height:100,margin:[{x:40,y:40},{x:-124,y:100,align:"right"},{x:340,y:58}],TulpanTournament:{icon:{x:0,y:26}},targetPosition:{offset:{x:0}}};var RewardGoldView=RewardElementView.extend({ctor:function(e,t){var i,s=e.game;i=cleverapps.styles.UI.RewardElementView.missionIconAnimated?new CoinMarkView(new Mark("coin"),{counter:!0}):new cc.Sprite(
bundles.menubar.frames.coin_png),this._super(e,t,{name:"gold",targetName:"rewardGoldViewTarget",icon:i,reward:GameBase.REWARD_GOLD,control:"rewardElementGold"}),s.onGoldRewardAdded=function(){this.hide&&cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&!cleverapps.styles.UI.RewardElementView.chest?e.groupToggler.show(this,this.getGroupName(),this.runCollectAnimation.bind(this)):this.runCollectAnimation()}.bind(this),cleverapps.tooltipManager.create(this.bg||this.icon,{text:"messages:RewardGoldTooltip",position:cleverapps.styles.UI.Tooltip.LOCATION.below,hideHandler:this.hideHandler})},runCollectAnimation:function(){RewardElementView.growAnimation(this,this.game.rewards[GameBase.REWARD_GOLD]),cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect)}});cleverapps.UI.GroupToggler=function(e){this.game=e,this.groups={}},cleverapps.UI.GroupToggler.prototype.addToGroup=function(e,t){this.groups[t]||(this.groups[t]=[]),this.groups[t].push(e)},
cleverapps.UI.GroupToggler.prototype.show=function(e,t,i){for(var s=0;s<this.groups[t].length;s++)this.groups[t][s]!==e&&this.groups[t][s].hide();e.showForDuration(i)};var MissionIcon=SideBarIcon.extend({ctor:function(e,t){this.mission=t;var i=cleverapps.styles.SideBarIcon,s={leftTime:this.getTimeLeft(),title:this.getTitleText()};i.animation=cleverapps.skins.getSlot("missionSidebarJson",{type:t.type}),i.hasDirection=this.hasDirection(),this._super(e,i,s),this.mission.onUpdateState=this.createListener(this.updateState.bind(this)),this.updateState(),-1!==[Mission.TYPE_FAVORITE_SALE,Mission.TYPE_COINS_SALE].indexOf(this.mission.type)&&-1!==["crocword"].indexOf(cleverapps.config.name)&&Lottery.addIcon(this.container,"icon")},onPressed:function(){this._super(),cleverapps.audio.playSound(bundles.main.urls.icon_click_effect),cleverapps.metha.display({focus:"MissionIconClicked",action:function(e){var t=new(this.mission.getViewClass())(this.mission)
;t instanceof cleverapps.FixedWidthScene||t instanceof SceneProxy?cleverapps.scenes.replaceScene(t,e):cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},hasDirection:function(){if(-1!==["wordsoup","crocword"].indexOf(cleverapps.config.name)&&this.mission.type===Mission.TYPE_FAVORITE_SALE)return!0},getTitleText:function(){},getTimeLeft:function(){return this.mission.finishTime()-Date.now()},finish:function(){this.hideTimer()},updateState:function(){this.mission.isRunning()?(this.runTimer(this.getTimeLeft()),this.mission.isMinigameMission()&&(this.mission.canPlayMinigame()?this.turnOnAttention():this.turnOffAttention())):this.finish()}});cleverapps.styles.MissionIcon={};var MissionWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.styles.MissionWindow;this.mission=e,this.content=new cc.Node,this.content.setContentSize(t.width,t.height),this.content.setAnchorPoint(.5,.5),this.onStart();var i={width:t.button.width,height:t.button.height,text:Messages.get("Play"
).toUpperCase(),font:cleverapps.styles.FONTS.MISSION_BUTTON_TEXT,button_png:bundles.buttons_main.frames.mission_play_button,button_on_png:bundles.buttons_main.frames.mission_play_button_on,contentOffset:t.button.contentOffset,hasPrice:void 0!==cleverapps.bet,onPressed:function(){this.close(),cleverapps.metha.distract({focus:"MissionPlayButtonPressed",action:function(e){cleverapps.metha.wantsToPlay(e,{mission:!0})}})}.bind(this)};this.wasFinished&&(i=cleverapps.extend(i,{text:Messages.get(this.prize?"ClaimPrize.Button.text":"OK"),onPressed:this.close.bind(this)}));var s={title:{text:"messages:Missions."+e.getName()+".Title",font:cleverapps.styles.FONTS.MISSION_WINDOW_TITLE_TEXT||t.titleFont},name:" missionwindow",content:this.content,styles:cleverapps.overrideStyles(cleverapps.styles.Window,t.window,!0),button:i};this.wasFinished?e.finishView===MissionWindow&&(e.finishView=!1):s.help=function(){new MissionRulesWindow(e)},this._super(s)},onStart:function(){
this.contentLayout&&this.contentLayout.removeFromParent(),this.wasFinished=!this.mission.isRunning(),this.wasFinished&&(this.prize=this.mission.getPrize());var e=cleverapps.styles.MissionWindow,t=cleverapps.missionManager.table.createTableView({id:this.mission.type,data:this.mission.getResults(),dataIcon:this.mission.getIcon(),options:e.tableHeight,rowConstructor:cleverapps.MissionRow});t.setScale(e.table.scale);var i=[cleverapps.UI.generateTTFText(this.mission.isRunning()?"messages:Missions.windowRunning":"messages:Missions.windowFinished",cleverapps.styles.FONTS.MISSION_WINDOW_STATUS_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT)],s={font:cleverapps.styles.FONTS.MISSION_WINDOW_TIMER_TEXT||e.timer.font};if(e.timer.bg){var n=cleverapps.UI.createScale9Sprite(e.timer.bg.image);n.setContentSize2(e.timer.bg),s.background_content=n}if(this.mission.isRunning()){var o=new cleverapps.CountDownView(new cleverapps.CountDown(this.mission.countdown.getTimeLeft(),{onFinish:function(){
this.onFinishedSound&&"function"==typeof this.onFinishedSound&&this.onFinishedSound(!0),this.close()}.bind(this)}),s);o.setScale(e.timer.scale),i.push(o)}i.reverse();var a=new cleverapps.Layout(i,{}),r=new cc.Node;r.setContentSize(e.width,e.textAndTimerHeight),r.setAnchorPoint(.5,.5),r.setLocalZOrder(-1),r.addChild(a),a.setPositionRound({align:"center"},{align:"center"});var l=[r],c=bundles[this.mission.getWindowBundleName()],p=new cc.Scale9Sprite(new cc.Sprite(cleverapps.styles.TableView.bg).getSpriteFrame());if(p.setContentSize2(t.width,e.animation.animationHeight),e.autoScrollText){var d;this.wasFinished&&(d=this.prize?"Win":"Lose");var h=e.text[this.mission.getName()]||"messages:Missions.CommonText";d&&(h="messages:Missions."+this.mission.getName()+".AnimationMainText"+d);var u=["messages:Missions."+this.mission.getName()+".AnimationMainTextInfo0","messages:Missions."+this.mission.getName()+".AnimationMainTextInfo1",h].filter(Messages.has),
v=e.animation.animationWidth+e.contentObjectsMargin/2;this.autoScrollText=new AutoScrollText(u,{styles:{width:Math.max(e.contentObjectsMargin,t.width-v)-2*e.autoScrollText.offset.x,height:p.height-2*e.autoScrollText.offset.y,font:cleverapps.styles.FONTS.MISSIONS_TEXT,padding:e.autoScrollText.padding}}),p.addChild(this.autoScrollText),this.autoScrollText.setPositionRound(v+(p.width-v)/2,p.height/2);var g=new cc.Node;g.setContentSize2(e.animation.animationWidth,e.animation.animationHeight),g.setAnchorPoint(0,0),g.setLocalZOrder(1);var m=new cleverapps.Spine(c.jsons.json);m.setAnimation(0,"finish",!0),m.setPosition(g.width/2,g.height/2),g.addChild(m),p.addChild(g),l.push(p)}if(l.push(t),l.reverse(),this.contentLayout=new cleverapps.Layout(l,{margin:e.contentObjectsMargin,padding:{x:0,y:1.5*e.contentObjectsMargin}}),this.content.addChild(this.contentLayout),this.contentLayout.setPositionRound(e.contentLayout),this.mission.onChangeResults=this.createListener(function(){
var e=this.mission.getResults();t.updateResults(e),cleverapps.missionManager.table.updateResults(this.mission.type,e)}.bind(this)),e.titleAnimation&&bundles[this.mission.getWindowBundleName()].jsons.mission_window_json){var f=new cleverapps.Spine(bundles[this.mission.getWindowBundleName()].jsons.mission_window_json);f.setAnimation(0,"animation",!0),this.content.addChild(f),f.setPositionRound(e.titleAnimation)}if(e.heroTitleAnimation){var _=new cleverapps.Spine(bundles.hero.jsons.hero_json,e.heroTitleAnimation.scale);_.setAnimation(0,"idle",!0),this.content.addChild(_),_.setPositionRound(e.heroTitleAnimation)}},onFinishedSound:function(e){e&&this.mission&&!this.mission.finishTimeSoundPlayed&&cleverapps.windows.currentWindow()===this&&(this.mission.finishTimeSoundPlayed=!0,cleverapps.audio.playSound(res.mission_finish_effect))},onShow:function(){this.onFinishedSound&&"function"==typeof this.onFinishedSound&&this.onFinishedSound(this.wasFinished),this.autoScrollText&&(
this.autoScrollText.setTextByIndex(0),this.autoScrollText.reinitTimer()),cleverapps.audio.playSound(bundles.main.urls.window_effect)}});MissionWindow.prototype.listBundles=function(e){var t=[],i=e.getWindowBundleName();return i&&t.push(i),t.push("game"),t},cleverapps.styles.MissionWindow={width:700,height:940,textAndTimerHeight:90,titleFont:cleverapps.styles.FONTS.WINDOW_TITLE_TEXT,timer:{font:cleverapps.styles.FONTS.TEXT,scale:.8},button:{width:260,height:100,contentOffset:{y:0}},window:{Border:{x:36}},tableHeight:{styles:{height:449}},contentObjectsMargin:20,animation:{animationWidth:250,animationHeight:247},autoScrollText:{padding:{x:0,y:40},offset:{x:20,y:40}},table:{scale:1},contentLayout:{x:{align:"center"},y:{align:"top"}},text:{}};var MissionRulesWindow=RulesWindow.extend({onWindowLoaded:function(e){this.bundle=bundles[e.getWindowBundleName()];var t=cleverapps.styles.MissionRulesWindow;t.prefix="messages:MissionRulesWindow."+e.getName()+".",
t.animation.json=cleverapps.skins.getSlot("missionRulesWindow",{bundle:this.bundle,type:e.type}),t.animation.json=t.animation.json||this.bundle.jsons.rules_json,t.animation.name="animation",this._super({name:"missionruleswindow",styles:t})},listBundles:function(e){var t=this._super(e);return t.push(e.getWindowBundleName()),t}});cleverapps.styles.MissionRulesWindow={margin:0,animation:{height:730,y:-110},subText:{width:240,left:{x:{align:"left",dx:0},y:{align:"top",dy:-250}},right:{x:{align:"right",dx:10},y:{align:"top",dy:-250}},bottom:{x:{align:"center",dx:15},y:{align:"bottom",dy:70}}}};var MissionAnimationView=cc.Node.extend({ctor:function(e){this._super(),this.usePool=!0;var t=this.clover=new cc.Sprite(this.getIcon(e));t.setScale(cleverapps.styles.MissionAnimationView.scale),this.addChild(t),this.setLocalZOrder(100),this.setCascadeOpacityEnabled(!0),this.initialize(e)},initialize:function(e){var t=this.getFieldAlgorithm();e.victory&&(t=this.getVictoryAlgorithm()),t(this,e)},
reuse:function(e){this.initialize(e)},remove:function(){this.usePool?cc.pool.putInPool(this):this.unuse()},unuse:function(){this.removeFromParent()}}),MissionAnimationGoldView=MissionAnimationView.extend({getIcon:function(){return bundles.menubar.frames.coin_png},getFieldAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm},getVictoryAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm}}),MissionAnimationCloverView=MissionAnimationView.extend({getIcon:function(){return bundles.game.frames.fly_clover_png},getFieldAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm},getVictoryAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm}}),MissionAnimationRoseView=MissionAnimationView.extend({getIcon:function(e){return e.icon?e.icon:cleverapps.skins.getSlot("missionMarkIcon",{type:Mission.TYPE_COLLECT_MARK})},getFieldAlgorithm:function(){return MissionAnimationView.flyToAlgorithm},getVictoryAlgorithm:function(){
return MissionAnimationView.SimpleFlyAlgorithm},reuse:function(e){this._super(e),this.clover.setSpriteFrame(this.getIcon(e))}}),MissionAnimationTulpanView=MissionAnimationView.extend({getIcon:function(){return cleverapps.skins.getSlot("missionIcon",{type:Mission.TYPE_BURN_NEARBY})},getFieldAlgorithm:function(){return MissionAnimationView.flyToAlgorithm},getVictoryAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm}}),MissionAnimationLetterView=MissionAnimationView.extend({ctor:function(e){cc.Node.prototype.ctor.call(this);var t=this.clover=this.getIcon(e.id);t.setScale(cleverapps.styles.MissionAnimationView.scale),this.addChild(t),this.setLocalZOrder(100),this.setCascadeOpacityEnabled(!0),this.initialize(e)},reuse:function(e){this.clover.setSpriteFrame(this.getSpriteFrame(e.id))},getIcon:function(e){return new cc.Sprite(this.getSpriteFrame(e))},getSpriteFrame:function(e){var t=e%Missions[Mission.TYPE_LETTER].STAR_TYPES_AMOUNT;return cleverapps.skins.getSlot(
"missionStar",{type:t})},getFieldAlgorithm:function(){return MissionAnimationView.flyToAlgorithm},getVictoryAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm}});MissionAnimationView.flyToAlgorithm=function(e,t){var i=cleverapps.styles.MissionAnimationView,s=i.upY,n=t.beginPos,o=t.targetPos;e.setPosition(n),n.y+=s,e.setScale(t.beginScale),e.setOpacity(255);var a=cc.p(o.x,o.y+i.flyTo.second.y),r=[cc.p((n.x+a.x)/2,(n.y+a.y)/2+i.flyTo.first.y),a,o],l=Math.abs(o.x-n.x),c=Math.abs(o.y-n.y)+i.flyTo.first.y+i.flyTo.second.y,p=Math.sqrt(l*l+c*c);p/=i.flySpeed,t.targetScale||(t.targetScale=t.beginScale),t.finalScale||(t.finalScale=t.targetScale),e.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.3,t.targetScale),new cc.MoveBy(.3,cc.p(0,s))),new cc.Spawn(new cc.ScaleTo(p,t.finalScale),new cc.BezierTo(p,r).easing(cc.easeIn(1))),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.cell_collect_effect,{throttle:20}),e.remove(),t.callback&&t.callback()})))},
MissionAnimationView.SimpleFlyAlgorithm=function(e,t){var i=t.beginPos;e.setPosition(i),e.setScale(0),e.setOpacity(255);var s=cleverapps.styles.MissionAnimationView.bezierLength,n=Math.random()*s;n<s/2&&(n-=s);var o=cc.p(i.x+n,i.y-2*s),a=cc.p(o.x,o.y+s),r=[cc.p(i.x,i.y+s*(1.5+.5*Math.random())),a,o],l=.2;3<l*t.amount&&(l=3/t.amount),e.runAction(new cc.Sequence(new cc.DelayTime(t.id*l),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.boom_effect,{throttle:20})}),new cc.Spawn(new cc.ScaleTo(.3,.8),new cc.BezierTo(2,r),new cc.RotateBy(2,n<0?-360:360),new cc.Sequence(new cc.DelayTime(1.5),new cc.FadeOut(.5))),new cc.CallFunc(function(){e.remove()})))},MissionAnimationCloverView.factory=function(e){return cc.pool.hasObject(MissionAnimationCloverView)?cc.pool.getFromPool(MissionAnimationCloverView,e):new MissionAnimationCloverView(e)},MissionAnimationRoseView.factory=function(e){return cc.pool.hasObject(MissionAnimationRoseView)?cc.pool.getFromPool(
MissionAnimationRoseView,e):new MissionAnimationRoseView(e)},MissionAnimationTulpanView.factory=function(e){return cc.pool.hasObject(MissionAnimationTulpanView)?cc.pool.getFromPool(MissionAnimationTulpanView,e):new MissionAnimationTulpanView(e)},MissionAnimationLetterView.factory=function(e){return cc.pool.hasObject(MissionAnimationLetterView)?cc.pool.getFromPool(MissionAnimationLetterView,e):new MissionAnimationLetterView(e)},MissionAnimationGoldView.factory=function(e){return cc.pool.hasObject(MissionAnimationGoldView)?cc.pool.getFromPool(MissionAnimationGoldView,e):new MissionAnimationGoldView(e)},MissionAnimationView.show=function(e,t,i){i.amount||(i.amount=1);for(var s=0;s<i.amount;s++)switch(i.id=s,e){case"gold":t.addChild(MissionAnimationGoldView.factory(i));break;case Mission.TYPE_COMBO:t.addChild(MissionAnimationCloverView.factory(i));break;case Mission.TYPE_COLLECT_MARK:t.addChild(MissionAnimationRoseView.factory(i));break;case Mission.TYPE_BURN_NEARBY:t.addChild(
MissionAnimationTulpanView.factory(i));break;case Mission.TYPE_LETTER:t.addChild(MissionAnimationLetterView.factory(i))}},cleverapps.styles.MissionAnimationView={bezierLength:250,flySpeed:1500,upY:100,flyTo:{first:{y:300},second:{y:300}},scale:1};var CloversView=RewardElementView.extend({getAddedAnimation:function(e){switch(e){case Mission.TYPE_COMBO:return RewardElementView.rotateAnimation;case Mission.TYPE_COLLECT_MARK:case Mission.TYPE_BURN_NEARBY:case Mission.TYPE_LETTER:return RewardElementView.growAnimation}},runAddedAnimation:function(){var e=this.getAddedAnimation(this.game.gameMission.type);e&&e(this,this.game.rewards[GameBase.REWARD_CLOVER]),cleverapps.audio.playSound(bundles.game.urls.tournament_element_collected)},ctor:function(e,t){var i,s=e.game,n=s.gameMission,o=cleverapps.styles.UI.RewardElementView;i=o.missionIconAnimated?new MissionMarkView(new Mark("mission"),{counter:!0}):new cc.Sprite(s.gameMission.getIcon()),this._super(e,t,{name:n.getName(),
targetName:"cloversViewTarget",icon:i,reward:GameBase.REWARD_CLOVER,control:"rewardElementClover"}),cleverapps.tooltipManager.create(this.bg||this.icon,{text:"messages:CloversTooltip",position:"runes"===cleverapps.config.name?cleverapps.styles.UI.Tooltip.LOCATION.above:cleverapps.styles.UI.Tooltip.LOCATION.below,hideHandler:this.hideHandler}),s.onCloverAdded=function(){this.hide&&cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?e.groupToggler.show(this,this.getGroupName(),this.runAddedAnimation.bind(this)):this.runAddedAnimation()}.bind(this),o.hideOnStart&&(this.visible=!1)}}),MainScene=cleverapps.FixedWidthScene.extend({ctor:function(){this._super(cleverapps.Environment.SCENE_MAIN),this.addToolbar(),this.addSideBar(),cleverapps.environment.levelNo=levels.user.level,cleverapps.environment.episodeNo=levels.user.episode,cleverapps.placements.run(Placements.INTERMEDIATE)},getRefreshSceneActionOnChangeSize:function(){return function(e){cleverapps.metha.gotoMainScene(e)}},
closeAction:function(){cleverapps.administrator?AdministratorScene.open():cc.sys.os!==cc.sys.OS_ANDROID||!cc.sys.isNative&&"android"!==cleverapps.User.calcSource()||cleverapps.metha.display({focus:"ConfirmExitWindow",action:function(e){new ConfirmExitWindow(function(){"undefined"!=typeof AppActivityPlugin?AppActivityPlugin.closeApplication():cc.director.end()},function(){}),cleverapps.metha.onceNoWindowsListener=e}})},addSideBar:function(){var e=new SideBarView;e.setPositionRound(this.scene.width/2,this.scene.height/2),e.setLocalZOrder(1),this.scene.addChild(e)},addToolbar:function(){(this.downToolBar=new ToolbarView(this.scene)).setLocalZOrder(1)}}),MethaHelper={start:function(e,t,i){i=i||{};var s=MethaHelper.getCurrentLevel(t);0===s.episodeNo&&0===s.levelNo||!LevelStartWindow.isAvailable(s.episode.episodeNo,s.levelNo)||i.playNext&&!BoostersBefore.isAvailable()?s.play(e):cleverapps.metha.compound(e,[function(e){i.playNext&&BoostersBefore.isAvailable()?cleverapps.Plot.GameLeave(e,i):e(
)},function(e){t?(cleverapps.metha.controlFreeFocus("MenuBarGoldItem"),new BuildingStartWindow({building:t,level:s})):new LevelStartWindow({level:s}),cleverapps.metha.onceNoWindowsListener=e}])},getCurrentLevel:function(e){var t=void 0;cleverapps.metha.getType()===Metha.FARM?(t=e.label,cleverapps.playButton.disableIncLevel(),(void 0===t||t.episodeNo>=levels.episodes.getAmountEpisodes())&&(t=cleverapps.farm.chooseNextLevel(e)),e.label!==t&&(e.label=t,cleverapps.farm.save()),cleverapps.playButton.enableIncLevel()):t=cleverapps.user.getCurrentLevel(),cleverapps.isKnockoutGame()&&cleverapps.user.incLevel();var i=new Episode(t.episodeNo,t.levelNo).getLevel();return cleverapps.metha.getType()===Metha.FARM&&(i.building=e),i},prepare:function(){MethaHelper.prepareCharacters(),cleverapps.config.debugMode&&cleverapps.metha.getType()===Metha.FARM&&MethaHelper.validateDialogues(),cleverapps.metha.getType()===Metha.FARM&&MethaHelper.validateQuestItems()},prepareCharacters:function(){
var i=cleverapps.styles.WorldMap,e=0;cleverapps.styles.WorldMap.persons.person0&&(e=1);var t=function(e,t){i.persons[e]=i.persons[e]||cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{styles:{json:t.jsons[e],title:"messages:"+e}},!0)};if(cleverapps.metha.getType()===Metha.HOMEFIX){var s=bundles.homefix_windows;if(!s)return;for(var n=e;n<100;n++){var o="person"+n;if(!s.jsons[o])break;t(o,s)}}else if(cleverapps.metha.getType()===Metha.FARM)for(n=e;n<100;n++){if(!bundles[o="person"+n])break;t(o,bundles[o])}},validateQuestItems:function(){MethaHelper.readConfig().questItems.forEach(function(e,t){if(!bundles.farm_windows.frames["item"+t])throw"No questItem resource - "+e})},readConfig:function(){return cleverapps.metha.getType()===Metha.FARM?cleverapps.farm.readConfig():cleverapps.metha.getType()===Metha.HOMEFIX?cleverapps.home.readConfig():void 0},validateDialogues:function(){cleverapps.values(this.readConfig().dialogues).forEach(function(e){e.forEach(function(e){
if("string"==typeof e.person&&!cleverapps.styles.WorldMap.persons[e.person])throw"No person: "+e.person})})},allIsComplete:function(e){cleverapps.metha.compound(e,[function(e){var t=MethaHelper.createDialogue("Final");t.on("afterClose",e),new DialogueView(t,{autoPosition:!0,overlay:!0}),t.run()},function(e){new AllDoneWindow,cleverapps.metha.onceNoWindowsListener=e}])},createDialogue:function(e){var t=this.readConfig().dialogues[e];if(t){var i=[],s=[];return t.forEach(function(e){var t={text:"messages:"+e.text,person:{animation:e.animation||cleverapps.styles.WorldMap.personsAnimation,position:e.position||"left",styles:cleverapps.styles.WorldMap.persons[e.person].styles}};e.person2&&(t.person2={animation:e.person2.animation||cleverapps.styles.WorldMap.personsAnimation,position:e.person2.position||"left",styles:cleverapps.styles.WorldMap.persons[e.person2.person].styles}),s.push(t),cleverapps.metha.getType()===Metha.FARM&&i.push(e.person)}),new Dialogue(s,{autoClose:!0,showUp:!0,
bundles:i})}}},options={ctor:function(){var e;switch(this._super(cleverapps.Environment.SCENE_METHA),cleverapps.metha.getType()){case Metha.FARM:e=cleverapps.farm;break;case Metha.HOMEFIX:e=cleverapps.home}switch(this.map=new WorldMap(e),this.map.setPositionRound(this.scene.width/2,this.scene.height/2),this.map.setLocalZOrder(-1),this.scene.addChild(this.map),this.addPlayButton(),cleverapps.metha.getType()){case Metha.FARM:this.controller=new FarmController(this.map);break;case Metha.HOMEFIX:this.controller=new HomeController(this.map),this.addTasksIcon(),this.map.animateNewTask=this.createListener(this.animateNewTask.bind(this)),this.createFinger()}-1!==[Metha.FARM,Metha.HOMEFIX].indexOf(cleverapps.metha.getType())&&this.runAction(new cc.RepeatForever(new cc.Sequence(new cc.DelayTime(5),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.main.urls.city_loop_effect)}),new cc.DelayTime(5))))},getRefreshSceneActionOnChangeSize:function(){return function(e){
cleverapps.metha.withSimpleMain()?cleverapps.scenes.replaceScene(new NoMainMethaScene,e):cleverapps.metha.gotoMainScene(e)}},onExit:function(){this._super(),this.controller.clear()},addPlayButton:function(){this.playButton=new PlayButtonView({isSmall:"wordsoup"===cleverapps.config.name,hard:"heroes"!==cleverapps.config.name}),this.scene.addChild(this.playButton)},addTasksIcon:function(){this.tasksIcon=new HomeTasksIcon(this.scene),this.scene.addChild(this.tasksIcon)},setFinger:function(){var e=cleverapps.home.getFurnitureToUpgrade()?this.tasksIcon.hideHandler.originalPosition:this.playButton.hideHandler.originalPosition;this.finger.setPositionRound(e)},createFinger:function(){var e=this.finger=new FingerView({control:"homefix_finger"});this.scene.addChild(e,1),cleverapps.styles.MethaScene.finger.scale&&e.setScale(cleverapps.styles.MethaScene.finger.scale),e.standardLoop(),cleverapps.metha.registerControl("finger_position_update",this.tasksIcon.createListener(function(){this.setFinger()
}.bind(this)))},animateNewTask:function(e){var t=new NewTaskAnimation(e,this);this.scene.addChild(t),t.setPositionRound(cleverapps.styles.MethaScene.newTask)},displayIntro:function(e){this.controller.displayIntro(e)},getBackgroundStyles:function(){}},MethaScene=MainScene.extend(options),NoMainMethaScene=cleverapps.FixedWidthScene.extend(options);MethaScene.BUNDLES=NoMainMethaScene.BUNDLES=function(){var e=["homefix","world_map","dialogues","main"];switch(cleverapps.metha.getType()){case Metha.FARM:e.push("farm_windows");break;case Metha.HOMEFIX:e.push("homefix_windows")}for(var t=0;bundles["metha_top_layer_"+t];t++)e.push("metha_top_layer_"+t);for(var i=0;bundles["metha_bottom_layer_"+i];i++)e.push("metha_bottom_layer_"+i);return e},cleverapps.styles.MethaScene={newTask:{x:{align:"right",dx:-50},y:{align:"top",dy:-50}}};var MethaSimpleMainScene=MainScene.extend({ctor:function(){this._super(),this.addPersons(),this.addPlayButton()},addPersons:function(){
var e=cleverapps.styles.MethaSimpleMainScene.persons;if(e)for(var t in e){var i=e[t],s=new cleverapps.Spine(i.json);s.setAnimation(0,"animation",!0),s.setPositionRound(i),this.scene.addChild(s)}},getBackgroundStyles:function(){return cleverapps.styles.MethaSimpleMainScene.background},addPlayButton:function(){var e=new PlayButtonView({styles:cleverapps.styles.MethaSimpleMainScene.PlayButton});this.scene.addChild(e),e.addFingerTip()}});MethaSimpleMainScene.BUNDLES=["metha_simple_main","main"],cleverapps.styles.MethaSimpleMainScene={PlayButton:{width:300,height:100,x:{align:"center"},y:{align:"bottom",dy:150},text:{paddingX:20},button:{button_png:bundles.buttons.frames.green_button_png,button_on_png:bundles.buttons.frames.green_button_on_png,x:{align:"center"},y:{align:"center"}}},background:{background:bundles.metha_simple_main.urls.background}};var PlayButtonView=cc.Node.extend({ctor:function(e){if(this._super(),this.options=e||{},
this.styles=this.options.styles?this.options.styles:cleverapps.styles.PlayButtonView,this.isSmall=this.options.isSmall,this.setAnchorPoint2(),this.setContentSize2(this.styles),this.setPositionRound(this.calcPosition()),cleverapps.UI.makeHideable(this,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("play_button",this),cleverapps.playButton.on("update",this.update.bind(this),this),cleverapps.playButton.on("animatePassLevel",this.animatePassLevel.bind(this),this),this.update(),cleverapps.bet){var t=new CoinsPriceView(cleverapps.Bet.REGEN_AMOUNT,{bg:bundles.main.frames.price_substrate_png});t.setPositionRound(this.styles.price),this.addChild(t)}},update:function(){this.isHardLvl=cleverapps.playButton.currentLevel.isHard(),cleverapps.playButton.passedLevel&&cleverapps.playButton.previousLevel&&(this.isHardLvl=cleverapps.playButton.previousLevel.isHard()),this.createButton(),this.createAnimation(),this.styles.button||(cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,
function(){cleverapps.playButton.onClick()}))},calcPosition:function(){var e=this.styles;return e.noToolBarPosition&&cleverapps.metha.withSimpleMain()&&(e=e.noToolBarPosition),e=e.positions?e.positions[cleverapps.wideMode.mode]:e,(e=cc.p(cleverapps.clone(e.x),cleverapps.clone(e.y))).y.dy-=cleverapps.UI.getSceneOffsetY(),e},animatePassLevel:function(){var e=this.scale;if(this.button&&this.button.stopAllActions(),this.stopAllActions(),this.show(!0),!this.isSmall){var t=new cleverapps.Spine(bundles.main.jsons.play_button_transition_json);this.addChild(t),t.setPositionRound(this.width/2,this.height/2),t.runAction(new cc.Sequence(new cc.DelayTime(.6),new cc.CallFunc(function(){t.setAnimation(0,"animation",!1),t.setCompleteListenerRemove()})))}this.runAction(new cc.Sequence(new cc.DelayTime(1.1),new cc.ScaleTo(.15,1.3*e),new cc.CallFunc(function(){this.isHardLvl=cleverapps.playButton.currentLevel.isHard(),this.text.setFontSize(this.getFont().size),this.text.setString(this.getTextMsg()),
this.text.fitTo(this.styles.width-2*this.styles.text.paddingX),this.animation?this.animation.setAnimation(0,this.isHardLvl&&this.styles.animation.customHard?"hard":"animation",!0):(this.button.setBackgroundImage(this.getButtonImg().button_png),this.button.setBackgroundImagePressed(this.getButtonImg().button_on_png)),cleverapps.audio.playSound(bundles.main.urls.play_button_effect)}.bind(this)),new cc.ScaleTo(.2,e),new cc.CallFunc(function(){this.onPassLevelAnimationFinished()}.bind(this))))},onPassLevelAnimationFinished:function(){},addFingerTip:function(){var e=new FingerView({control:"playbutton_finger"});e.setLocalZOrder(14),this.getParent().fingerTip=e,this.getParent().addChild(e),e.setPositionRound(this.hideHandler.originalPosition),e.delay(5),e.fadeIn(new cc.p(0,0)),e.press(),e.delay(.3),e.unPress(),e.delay(.1),e.press(),e.delay(.3),e.unPress(),e.fadeOut(),e.run({looped:!0})},createAnimation:function(){if(this.styles.animation){this.animation&&this.animation.removeFromParent()
;var e=this.animation=new cleverapps.Spine(bundles.main.jsons.play_button_json);e.setAnimation(0,this.isHardLvl&&this.styles.animation.customHard?"hard":"animation",!0),this.addChild(e),e.setPositionRound(this.width/2,this.height/2),this.styles.button||(this.text=this.createText(),this.text.setPositionRound(this.width/2,this.height/2),this.addChild(this.text))}},createButton:function(){if(this.styles.button){this.button&&this.button.removeFromParent(),this.text=this.createText();var e={width:this.styles.width,height:this.styles.height,contentOffset:this.styles.button.contentOffset,content:this.text,fitTo:!1,onClicked:function(){cleverapps.playButton.onClick()}};cleverapps.extend(e,this.getButtonImg());var t=this.button=new cleverapps.UI.Button(e);this.addChild(t),t.setPositionRound(this.styles.button)}},getButtonImg:function(){var e=this.styles.button;return this.isHardLvl&&e.hardLvl&&(e=e.hardLvl),{button_png:e.button_png||bundles.buttons.frames.window_button_png,
button_on_png:e.button_on_png||bundles.buttons.frames.window_button_on_png}},getTextMsg:function(){var e=cleverapps.playButton.getLevelNo(),t="messages:PlayButton.text";return this.isHardLvl&&!1!==this.options.hard&&(t="messages:message.hardLevel"),this.isSmall&&(t=e),Messages.getLocalized(t,{levelNo:e})},getFont:function(){return this.isSmall?cleverapps.styles.FONTS.SMALL_PLAY_BUTTON_TEXT:cleverapps.styles.FONTS.PLAY_BUTTON_TEXT},createText:function(){var e=cleverapps.UI.generateTTFText(this.getTextMsg(),this.getFont());return e.fitTo(this.styles.width-2*this.styles.text.paddingX),e}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{PLAY_BUTTON_TEXT:{size:70,color:cleverapps.styles.COLORS.WHITE},SMALL_PLAY_BUTTON_TEXT:{}}),cleverapps.styles.PlayButtonView={width:300,height:100,x:{align:"center"},y:{align:"bottom",dy:150},text:{paddingX:30},button:{x:{align:"center"},y:{align:"center"}},price:{x:{align:"center"},y:{align:"center",dy:-84}}};var PlayButton=function(){
cleverapps.EventEmitter.call(this),cleverapps.user.on("incLevel",this.onIncLevel.bind(this)),this.update()};PlayButton.prototype=Object.create(cleverapps.EventEmitter.prototype),(PlayButton.prototype.constructor=PlayButton).prototype.onIncLevel=function(){this.incLevelDisabled||(this.passedLevel=!0,this.update())},PlayButton.prototype.enableIncLevel=function(){delete this.incLevelDisabled},PlayButton.prototype.disableIncLevel=function(){this.incLevelDisabled=!0},PlayButton.prototype.getLevelNo=function(){var e=cleverapps.user.getVirtualLevel();this.passedLevel&&e--;var t=cleverapps.metha.getMainObject();return t.takenLevelsAmount&&(e-=t.takenLevelsAmount()),e},PlayButton.prototype.update=function(){if(PlayButton.IsAvailable()){var e=cleverapps.user.getCurrentLevel();this.currentLevel&&this.currentLevel.episodeNo===e.episodeNo&&this.currentLevel.levelNo===e.levelNo||(this.currentLevel&&(this.previousLevel=this.currentLevel),this.currentLevel=new Episode(e).getLevel(),this.trigger(
"update"))}},PlayButton.prototype.onClick=function(){cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce(),cleverapps.metha.display({focus:"PlayButton_scene",action:function(e){cleverapps.metha.wantsToPlay(e)}})},PlayButton.prototype.animatePassLevel=function(){this.passedLevel=!1,this.trigger("animatePassLevel")},PlayButton.IsAvailable=function(){return"riddles"!==cleverapps.config.name};var AllDoneWindow=Window.extend({onWindowLoaded:function(){this._super({title:"messages:AllDoneWindow.title",name:"alldonewindow",content:this.getContent(),button:{width:cleverapps.styles.AllDoneWindow.button.width,height:cleverapps.styles.AllDoneWindow.button.height,text:Messages.get("Play"),onPressed:function(){this.close(),cleverapps.metha.distract({focus:"PlayButton",action:function(e){cleverapps.metha.wantsToPlay(e)}.bind(this)})}.bind(this)}})},getContent:function(){return new cleverapps.Layout([this.getText(),this.getAnimation()],{direction:cleverapps.UI.VERTICAL,
margin:cleverapps.styles.AllDoneWindow.margin,y:cleverapps.styles.AllDoneWindow.paddingY})},getText:function(){var e=cleverapps.UI.generateTTFText("messages:AllDoneWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT);return e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.setDimensions(cleverapps.styles.AllDoneWindow.text.width,0),e},getAnimation:function(){var e=cleverapps.styles.AllDoneWindow.animation,t=new cleverapps.Spine(e.json);return t.setAnimation(0,e.animationName,!0),t},listBundles:function(){return["episode_coming_soon"]}});cleverapps.styles.AllDoneWindow={margin:20,paddingY:50,text:{width:550},button:{width:300,height:100},animation:{animationName:"animation",json:bundles.episode_coming_soon.jsons.spine_0_json}};var WorldMap=MapScrollView.extend({ctor:function(e){this._super();var t,i,s=cc.director.getWinSize();if(this.setContentSize2(s),this.setAnchorPoint2(),i={width:(t=cc.loader.getRes(bundles.world_map.jsons.mapData)).map.width*resolutionScale,
height:t.map.height*resolutionScale},this.setContainerSize(i),bundles.world_map.urls.map){var n=new cc.Sprite(bundles.world_map.urls.map);n.setScale(i.width/n.width),n.setPositionRound(this.innerWidth/2,this.innerHeight/2),this.container.addChild(n)}this.addBgs(t),this.buildingViews={},this.setZoom(cleverapps.styles.WorldMap.zoom.unfocused),this.onEnterStart=function(){},this.animateNewTask=function(){}},addBgs:function(e){for(var t=0;t<=30;t++){var i;if(cleverapps.metha.getType()===Metha.FARM?i=bundles.metha_top_layer_0.jsons["map_json"+t]:cleverapps.metha.getType()===Metha.HOMEFIX&&(i=bundles.world_map.jsons["map_json"+t]||bundles.world_map_nodither.jsons["map_json"+t]),i){var s=new cleverapps.Spine(i,1);if(s.setAnimation(0,"animation",!0),e["map_json"+t]){var n=e["map_json"+t],o=new cc.Node;o.setAnchorPoint2(),o.setContentSize2(n.width*resolutionScale,n.height*resolutionScale),s.setPosition(o.width/2,o.height/2),o.addChild(s),o.setPosition(this.innerWidth/2+n.x*resolutionScale,
this.innerHeight/2+n.y*resolutionScale),this.container.addChild(o,n.zOrder)}else s.setPosition(this.innerWidth/2,this.innerHeight/2),this.container.addChild(s)}}},highlight:function(e){e.addHighlight()},unhighlight:function(e){e.removeHighlight()},onEnter:function(){this._super(),cleverapps.config.debugMode&&cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyPressed:function(e){if(e===cc.KEY.b&&!this.bordered)for(var t in this.bordered=!0,this.buildingViews)this.buildingViews[t].debugBorder()}.bind(this),onKeyReleased:function(e){if(e===cc.KEY.b)for(var t in this.bordered=!1,this.buildingViews)this.buildingViews[t].cleanupBorder()}.bind(this)},this),this.onEnterStart()},availableScrollPosition:function(e){var t=this.getContainerSize(),i=t.width-this.width,s=t.height-this.height;return 0<e.x?e.x=0:e.x<-i&&(e.x=-i),0<e.y?e.y=0:e.y<-s&&(e.y=-s),e},scrollTo:function(e,t,i){if(e){t||cleverapps.metha.isFocused()||(console.log("Scroll:",e),cleverapps.metha.debugMessage(
"Trying to scroll without user focus!"));var s=cleverapps.metha.focus,n=this.buildingViews[e.name].getPosition(),o={x:this.width/2-n.x,y:this.height/2-n.y};if(o=this.availableScrollPosition(o),t)this.setContainerPosition({x:o.x,y:o.y}),i&&i();else{var a=this.getContainerPosition();a.x-=o.x,a.y-=o.y;var r=Math.sqrt(a.x*a.x+a.y*a.y)/1300;r=Math.min(.7,Math.max(.3,r)),this.container.stopAllActions(),this.container.runAction(new cc.Spawn(new cc.MoveTo(r,o.x,o.y).easing(new cc.easeInOut(2.5)),new cc.Repeat(new cc.Sequence(new cc.DelayTime(.025),new cc.CallFunc(this.updateChildren.bind(this))),Math.ceil(r/.025)))),this.runAction(new cc.Sequence(new cc.DelayTime(.45*r||.5),new cc.CallFunc(function(){cleverapps.metha.isFocused()&&cleverapps.metha.focus===s||(console.log("Scroll:",e,s,cleverapps.metha.focus),cleverapps.metha.debugMessage("Trying to scroll without user focus!")),i&&i()}.bind(this))))}}},showBuildings:function(s){var i=[];s.forEach(function(e,t){e.isComplete(
)&&e.throwaway||i.push(t)}),i.sort(function(e,t){return s[t].y-s[e].y}.bind(this)),i.forEach(function(e){var t=s[e],i=new BuildingView(t,this);this.buildingViews[t.name]=i,this.container.addChild(i)},this)},removeBuilding:function(e){var t=this.buildingViews[e.name];t&&(t.runAction(new cc.RemoveSelf),delete this.buildingViews[e.name])},removeTarget:function(){this.finger&&(this.finger.removeFromParent(),delete this.finger)},addTarget:function(e){this.removeTarget();var t=this.finger=new FingerView({control:"world_map_finger"});t.needToHide=function(){return cleverapps.metha.isFocused()},t.setLocalZOrder(3e3),this.container.addChild(t),t.fadeIn({x:0,y:0}),t.delay(.1),t.press(),t.delay(.1),t.unPress(),t.delay(.1),t.press(),t.delay(.1),t.unPress(),t.fadeOut(),t.delay(1),t.run({looped:!0});var i=this.buildingViews[e.name].getPosition();t.setPositionRound(i)},findClickedBuilding:function(e){var t;for(var i in this.buildingViews){var s=this.buildingViews[i];s.building.canTouch()&&((
!t||t.getLocalZOrder()<=s.getLocalZOrder())&&cc.rectContainsPoint(cc.rect(0,0,s.width,s.height),s.convertTouchToNodeSpace(e))&&(t=s))}return t},onTouchBegan:function(e){if(this._super(e))return this.clickedBuilding=this.findClickedBuilding(e),!0},onTouchMoved:function(e){this._super(e),cc.pLength(cc.pSub(e.getStartLocation(),e.getPreviousLocation()))>cleverapps.styles.UI.onClick.ignoreOnTouchMovedThreshold&&delete this.clickedBuilding},onTouchEnded:function(e){this._super(e),this.clickedBuilding&&!this.pinchZooming&&(this.scrollHandler.stopAutoScroll(),this.clickedBuilding.building.onClick()),delete this.clickedBuilding}});cleverapps.styles.WorldMap={personsAnimation:"animation",persons:{},zoom:{base:1,unfocused:.7,minScale:.5}};var BaseGame=function(){cleverapps.EventEmitter.call(this),this.running=!0,this.paused=!1};BaseGame.prototype=Object.create(cleverapps.EventEmitter.prototype),(BaseGame.prototype.constructor=BaseGame).prototype.pause=function(){this.paused=!0},
BaseGame.prototype.resume=function(){this.paused=!1},BaseGame.prototype.getName=function(){return""},BaseGame.prototype.finish=function(e){e=e||{},this.running&&(this.running=!1,this.trigger("finish",e),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MINIGAME_FINISH+"_"+this.getName()),cleverapps.playSession.set(cleverapps.EVENTS.MINIGAME_FINISH+"_"+this.getName(),!0))};var FakeControls=function(i,e){[{time:700,event:"setMoves",options:[10]},{time:1e3,event:"open",options:[0,1,0,200]},{time:2e3,event:"open",options:[0,2,1,10]},{time:3e3,event:"open",options:[3,3,"bomb"]},{time:3e3,event:"finish"}].forEach(function(t){setTimeout(function(){var e=i[t.event];e||console.log(t.event),e.apply(i,t.options)}.bind(this),t.time)},this)},MissionGame=function(e){this.mission=e,BaseGame.call(this)};MissionGame.prototype=Object.create(BaseGame.prototype),(MissionGame.prototype.constructor=MissionGame).prototype.finish=function(){this.running&&0<this.reward&&this.mission.update(this.reward),
BaseGame.prototype.finish.apply(this,arguments)};var TreasureSearchWindow=Window.extend({onWindowLoaded:function(e){this.bundle=bundles[e.getWindowBundleName()],this.game=new TreasureSearch(e),this.game.on("open",this.open.bind(this)),this.game.on("prize",this.prize.bind(this)),this.game.on("finish",this.finish.bind(this)),this.generateContent();var t=cleverapps.styles.TreasureSearchWindow,i={title:"messages:TreasureSearchWindow.Title",name:"treasuresearchwindow",content:this.content,closeButton:t.closeButton,styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.TreasureSearchWindow.window,!0),help:this.onClickHelp.bind(this)};t.button&&(i.button={width:t.button.width,text:Messages.get(t.button.text),onPressed:this.close.bind(this)}),this._super(i),this.controls(),e.isRunning()&&(this.timer=new cleverapps.CountDown(e.countdown.getTimeLeft(),{onFinish:function(){this.close()}.bind(this)})),this.game.isFinished()&&this.game.finish({silent:!0}),
e.needShowStartWindow=!1,cleverapps.audio.playSound(bundles.main.urls.treasure_search_effect)},onExit:function(){this._super(),this.timer&&this.timer.stop()},controls:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchEnded:this.onTouchEnded.bind(this)},this.fieldNode),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:this.onMouseMove.bind(this)},this.fieldNode)},calculateIndex:function(e){var t=this.fieldNode.convertTouchToNodeSpace(e),i=cc.rect(0,0,this.fieldNode.width,this.fieldNode.height);if(cc.rectContainsPoint(i,t)){var s=cleverapps.styles.TreasureSearchWindow.game.cell,n=Math.floor(t.x/s.width),o=Math.floor(t.y/s.height);return{row:Math.max(Math.min(o,TreasureSearch.HEIGHT-1),0),col:Math.max(Math.min(n,TreasureSearch.WIDTH-1),0)}}},onTouchBegan:function(e){return!(!this.game.running||this.game.paused)&&void 0!==this.calculateIndex(e)},onTouchEnded:function(e){if(
this.game.running&&!this.game.paused){var t=this.calculateIndex(e);t&&this.onFieldClick(t.col,t.row)}},getPositionInContent:function(e){return this.content.convertToNodeSpace(e.getParent().convertToWorldSpace(e.getPosition()))},processPointer:function(){var e=this.field[this.index.row][this.index.col];this.pointer||this.createPointer(e),this.pointer.setPositionRound(this.getPositionInContent(e)),this.pointer.setVisible(!0),this.pointer.updateState(e)},createPointer:function(e){var t=cleverapps.styles.TreasureSearchWindow;if(t.pointerJson){this.pointer=new cc.Node,this.pointer.setAnchorPoint2(),this.pointer.setContentSize2(e.cover.getContentSize());var i=new cleverapps.Spine(t.pointerJson);this.pointer.addChild(i),i.setPositionRound(this.pointer.width/2,this.pointer.height/2),this.pointer.updateState=function(){i.setAnimation(0,"animation",!1),cleverapps.audio.playSound(this.bundle.urls.shot_sfx)}.bind(this)}else{this.pointer=new cc.Sprite(e.cover.getSpriteFrame()),
this.pointer.setScale(this.fieldNode.scale);var s=new cc.Sprite(this.bundle.frames.cross);s.setPosition(this.pointer.width/2,this.pointer.height/2),this.pointer.addChild(s);var n=new cc.Sprite(this.bundle.frames.hover_bottom);n.setPosition(this.pointer.width/2,this.pointer.height/2),this.pointer.addChild(n,-1),n.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.7,1.04),new cc.ScaleTo(.8,.95).easing(cc.easeInOut(1))))),this.pointer.updateState=function(e){this.pointer.setSpriteFrame(e.cover.getSpriteFrame())}.bind(this)}this.pointer.setLocalZOrder(21),this.content.addChild(this.pointer)},onMouseMove:function(e){if(this.game.running&&!this.game.paused){var t=this.calculateIndex(e);t&&this.game.hasElement(t.col,t.row)?void 0!==this.index&&100*t.row+t.col===100*this.index.row+this.index.col||(this.index=t,this.processPointer()):(this.pointer&&this.pointer.setVisible(!1),this.index=void 0)}},generateContent:function(){var e=cleverapps.styles.TreasureSearchWindow.content,
t=this.createGame(),i=this.text=cleverapps.UI.generateTTFText("messages:TreasureSearchWindow.text",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);if(i.setDimensions(t.width*e.text.widthMultiplier[cleverapps.wideMode.mode],0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.content=new cleverapps.Layout([i,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:e.padding}),e.successAnimation){var s=this.succesAnimation=new cleverapps.Spine(this.bundle.jsons.chest),n=this.content.convertToNodeSpace(this.fieldNode.getParent().convertToWorldSpace(this.fieldNode.getPosition()));s.setPosition(n),s.setVisible(!1),s.setLocalZOrder(22),this.content.addChild(s)}},createGame:function(){var e=cleverapps.styles.TreasureSearchWindow,t=this.fieldNode=this.createField(),i=this.infoNode=this.createGameInfo();return new cleverapps.Layout([t,i],{direction:cleverapps.UI.VERTICAL,margin:e.game.margin})},createField:function(){this.field=[];for(var e=0;e<TreasureSearch.HEIGHT;e++){for(var t=[],
i=0;i<TreasureSearch.WIDTH;i++){var s=this.createCell();t.push(s),this.game.hasElement(i,e)?this.createActiveCellContent(i,e,s):this.createOpenedCellContent(i,e,s,!0)}this.field.push(t)}var n=this.field.map(function(e){return new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL})}),o=this.fieldNode=new cleverapps.Layout(n,{direction:cleverapps.UI.VERTICAL});if(this.bundle.frames.map){var a=new cc.Sprite(this.bundle.frames.map);a.setPosition(o.width/2,o.height/2),a.setLocalZOrder(-1),o.addChild(a),o.setScale(cleverapps.styles.TreasureSearchWindow.game.field.scale[cleverapps.wideMode.mode])}return o},createCell:function(){var e=new cc.Node;return e.setAnchorPoint2(),e.setContentSize2(cleverapps.styles.TreasureSearchWindow.game.cell),e},createActiveCellContent:function(e,t,i){var s=i.cover=new cc.Sprite(this.bundle.frames["cover_"+(TreasureSearch.WIDTH*t+e)]);s.setPosition(i.width/2,i.height/2),i.addChild(s)},createOpenedCellContent:function(e,t,i,s){if(this.game.gemWasThere(e,t)){
var n=new cc.Sprite(this.bundle.frames.cross);n.setPosition(i.width/2,i.height/2),i.addChild(n),s||(n.setScale(0),n.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.ScaleTo(.4,1).easing(cc.easeBackOut()))))}},onFieldClick:function(e,t){this.game.mission.currency>=this.game.mission.getMinigamePrice()?this.game.hasElement(e,t)&&(this.game.open(e,t),cleverapps.audio.playSound(bundles.main.urls.treasure_search_open_effect)):(this.field[t][e].setScale(1),new TellWindow({type:"notEnoughElements",text:"messages:TreasureSearchWindow.Currency.Text",title:"messages:TreasureSearchWindow.Currency.Title",buttonText:Messages.get("Play"),onPressed:function(){this.close(),cleverapps.metha.distract({focus:"TreasurePlayButtonPressed",action:function(e){cleverapps.metha.wantsToPlay(e,{mission:!0})}})}.bind(this)}))},onClickHelp:function(){var e=cleverapps.styles.TreasureSearchWindow.rulesWindow;e.animation.json=bundles.treasuresearch.jsons.help,new RulesWindow({name:"ruleswindow",styles:e})},
createGameInfo:function(){var e=cleverapps.styles.TreasureSearchWindow.game.infoNode,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.chest),this.chest=new cleverapps.Spine(this.bundle.jsons.chest),this.chest.setAnimation(0,"idle_"+this.game.mission.result,!0),t.addChild(this.chest),this.chest.setPositionRound(t.width/2,t.height/2+e.chest.offsetY);var i=new cc.Node;i.setAnchorPoint2(),i.setPositionRound(t.width/2,t.height/2),i.setContentSize2(e.tooltip),t.addChild(i),cleverapps.tooltipManager.create(i,{rewards:this.game.getReward(),text:Messages.get("TreasureSearch.prizeTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.above});var s=this.amountText=cleverapps.UI.generateTTFText(this.game.mission.currency,cleverapps.styles.FONTS.SHOVEL_FONT);s.setPositionRound(e.shovelCount),t.addChild(s);var n=new cc.Sprite(this.bundle.frames.shovel);return n.setPositionRound(e.shovel),t.addChild(n),cleverapps.tooltipManager.create(n,{text:Messages.get("ShovelsTooltip"),
position:cleverapps.styles.UI.Tooltip.LOCATION.below}),t},open:function(e){this.game.paused=!0;var t=this.field[e.row][e.col];this.pointer&&this.pointer.setVisible(!1),t.runAction(new cc.Sequence(new cc.CallFunc(function(){var e=this.clouds=new cleverapps.Spine(this.bundle.jsons.clouds);e.setLocalZOrder(21),this.content.addChild(e),e.setCompleteListener(function(){this.game.paused=!1,e.runAction(new cc.RemoveSelf)}.bind(this)),e.setAnimation(0,"animation",!1),e.setPosition(this.getPositionInContent(t))}.bind(this)),new cc.DelayTime(.05),new cc.CallFunc(function(){t.cover&&t.cover.setVisible(!1)}))),this.amountText.setString(this.game.mission.currency)},prize:function(e){var t=this.field[e.row][e.col];this.createOpenedCellContent(e.col,e.row,t),this.runAction(new cc.Spawn(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){this.succesAnimation&&(this.succesAnimation.setCompleteListener(function(){this.succesAnimation.setCompleteListener(function(){}),
this.succesAnimation.setVisible(!1)}.bind(this)),this.succesAnimation.setAnimation(0,cleverapps.styles.TreasureSearchWindow.content.successAnimation,!1),this.succesAnimation.setVisible(!0)),cleverapps.audio.playSound(bundles.main.urls.treasure_search_found_effect)}.bind(this))),new cc.Sequence(new cc.DelayTime(1.65),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.main.urls.treasure_search_part_effect),this.chest.setAnimation(0,"animation_"+this.game.mission.result,!1),this.chest.addAnimation(0,"idle_"+this.game.mission.result,!0)}.bind(this)),new cc.DelayTime(1.5),new cc.CallFunc(function(){this.game.isFinished()&&cleverapps.audio.playSound(bundles.main.urls.treasure_search_prize_effect)}.bind(this)))))},finish:function(e){this.runAction(new cc.Sequence(new cc.DelayTime(e&&e.silent?.1:3.6),new cc.CallFunc(function(){this.close()}.bind(this))))},onClose:function(){this.game.checkIfComplete()}});TreasureSearchWindow.prototype.listBundles=function(){return["treasuresearch"]}
,cleverapps.styles.FONTS.SHOVEL_FONT={prefix:"digits#timer_digit_",scale:.8,color:cleverapps.styles.COLORS.WHITE},cleverapps.styles.TreasureSearchWindow={content:{margin:10,padding:{x:0,y:45},text:{widthMultiplier:[.8,.9,.9]},successAnimation:"key"},game:{margin:0,cell:{width:116,height:96},field:{scale:[1.2,1.15,1.15]},infoNode:{shovelCount:{x:{align:"center",dx:285},y:{align:"center",dy:12}},shovel:{x:{align:"center",dx:240},y:{align:"center",dy:26}},chest:{width:570,height:285,offsetY:0},tooltip:{width:300,height:180}}},rulesWindow:{prefix:"messages:TreasureSearchWindow.Help.",bundles:["treasuresearch"],animation:{height:630,y:-145},subText:{width:220,left:{x:{align:"left",dx:0},y:{align:"top",dy:-245}},right:{x:{align:"right",dx:10},y:{align:"top",dy:-245}}}},window:{contentOffset:-30,Title:{bg:{adjustToText:{width:50}}},Border:{y:50}}};var TreasureSearch=function(e){MissionGame.call(this,e),this.width=TreasureSearch.WIDTH,this.height=TreasureSearch.HEIGHT,
this.field=e.details&&e.details.field,this.field||this.createField()};TreasureSearch.prototype=Object.create(MissionGame.prototype),(TreasureSearch.prototype.constructor=TreasureSearch).prototype.createField=function(){for(var e=[];e.length<TreasureSearch.GEMS;){var t=cleverapps.Random.random(0,19);-1===e.indexOf(t)&&e.push(t)}this.field=[];for(var i=0;i<TreasureSearch.HEIGHT;i++){this.field[i]=[];for(var s=0;s<TreasureSearch.WIDTH;s++){var n=TreasureSearch.ELEMENT_EMPTY;-1!==e.indexOf(i*TreasureSearch.WIDTH+s)&&(n=TreasureSearch.ELEMENT_GEM),this.field[i][s]=n}}this.mission.details={field:this.field}},TreasureSearch.prototype.open=function(e,t){if(this.hasElement(e,t)){var i=this.field[t][e];this.field[t][e]=TreasureSearch.ELEMENT_GEM===i?TreasureSearch.ELEMENT_FOUND:TreasureSearch.ELEMENT_OPENED,this.mission.updateCurrency(-this.mission.getMinigamePrice(),{field:this.field});var s={row:t,col:e};this.trigger("open",s),TreasureSearch.ELEMENT_GEM===i&&(this.mission.update(1),
this.trigger("prize",{row:t,col:e,score:this.mission.result})),this.isFinished()&&this.finish()}},TreasureSearch.prototype.checkIfComplete=function(){this.isFinished()&&this.mission.isRunning()&&(this.mission.complete(),-1!==["olympics","tripeaks"].indexOf(cleverapps.config.name)&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TREASURE_SEARCH_FINISH),new RewardWindow({reward:this.getReward(),mission:this.mission}))},TreasureSearch.prototype.getReward=function(){return this.mission.getPrize()},TreasureSearch.prototype.hasElement=function(e,t){return this.field[t]&&void 0!==this.field[t][e]&&this.field[t][e]!==TreasureSearch.ELEMENT_OPENED&&!this.gemWasThere(e,t)},TreasureSearch.prototype.gemWasThere=function(e,t){return this.field[t]&&void 0!==this.field[t][e]&&this.field[t][e]===TreasureSearch.ELEMENT_FOUND},TreasureSearch.prototype.isFinished=function(){if(this.mission.result>=TreasureSearch.GEMS)return!0;if(this.field){for(var e=0,t=0,i=0;i<TreasureSearch.WIDTH;i++)for(
var s=0;s<TreasureSearch.HEIGHT;s++)this.hasElement(i,s)&&e++,this.gemWasThere(i,s)&&t++;return 0===e||t>=TreasureSearch.GEMS}return!1},TreasureSearch.WIDTH=5,TreasureSearch.HEIGHT=4,TreasureSearch.GEMS=4,TreasureSearch.ELEMENT_EMPTY="e",TreasureSearch.ELEMENT_OPENED="o",TreasureSearch.ELEMENT_FOUND="f",TreasureSearch.ELEMENT_GEM="g",TreasureSearch.ALL_ELEMENT_VALUES=[TreasureSearch.ELEMENT_EMPTY,TreasureSearch.ELEMENT_OPENED,TreasureSearch.ELEMENT_FOUND,TreasureSearch.ELEMENT_GEM];var StickersCollectionWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.styles.StickersCollectionWindow;this.game=new StickersCollection(e),this.generateContent();var i={title:"messages:StickersCollectionWindow.Title",name:"stickerscollectionwindow",content:this.content,closeButton:t.closeButton,notCloseByTouchInShadow:!0,styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.StickersCollectionWindow.window,!0),help:this.onClickHelp.bind(this)};t.button&&(i.button={
width:t.button.width,text:Messages.get(t.button.text),onPressed:this.close.bind(this)}),this._super(i),e.isRunning()&&(this.timer=new cleverapps.CountDown(e.countdown.getTimeLeft(),{onFinish:function(){this.close()}.bind(this)})),this.game.isFinished()&&this.game.finish({silent:!0}),e.needShowStartWindow=!1,cleverapps.audio.playSound(bundles.main.urls.stickers_collection_effect)},onExit:function(){this._super(),this.timer&&this.timer.stop()},onClose:function(){this.game.checkIfComplete()},onClickHelp:function(){new MissionRulesWindow(this.game.mission)},generateContent:function(){var e=cleverapps.styles.StickersCollectionWindow,t=this.createBook(),i=cleverapps.UI.generateTTFText("messages:StickersCollectionWindow.text",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setDimensions(e.book.width,0);var s=e.progressBar,n=cleverapps.UI.generateTTFText("messages:MissionRulesWindow.StickersCollection.leftToPrize",
cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setDimensions(s.size.width,0);var o=Math.min(this.game.mission.result,StickersCollection.GEMS),a=new ScaledProgressBar(bundles.stickers_collection.frames.progress_bar);a.setPercentage(o/StickersCollection.GEMS*100),a.setDimension(s.size.width-10,s.size.height-10),a.setPositionRound({align:"left",dx:5},{align:"center"});var r=cleverapps.UI.generateTTFText(o+"/"+StickersCollection.GEMS,s.font);r.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),r.setPositionRound({align:"center"},{align:"center"});var l=new cleverapps.Spine(s.gift.json);l.setSkin(s.gift.skin),l.setAnimation(0,"animation",!0),l.setPositionRound({align:"right",dx:l.width+s.gift.offsetX},{align:"center",dy:s.gift.offsetY}),l.setScale(s.gift.scale),cleverapps.tooltipManager.create(l,{rewards:this.game.getReward(),text:Messages.get("StickersCollectionWindow.prizeTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.above,
size:e.tooltipSize});var c=cleverapps.UI.createScale9Sprite(bundles.stickers_collection.frames.progress_bar_bg);c.setContentSize2(s.size),c.addChild(a),c.addChild(r),c.addChild(l);var p=new cleverapps.Layout([c,n],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:{x:0,y:2*e.margin}});this.content=new cleverapps.Layout([p,i,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin}),this.content.setLocalZOrder(2)},createBook:function(){var e=cleverapps.styles.StickersCollectionWindow,t=new cleverapps.Spine(bundles.stickers_collection.jsons.book,1);t.setAnimation(0,"animation",!1),t.addAnimation(0,"idle",!0),t.setPositionRound({align:"center"},{align:"center"});var i=this.bookNode=new cc.Node;if(i.setAnchorPoint2(),i.setContentSize2(e.book),i.addChild(t),bundles.stickers_collection.jsons.light){var s=new cleverapps.Spine(bundles.stickers_collection.jsons.light,1);s.setAnimation(0,"animation",!1),s.setPositionRound({align:"center"},{align:"center"}),i.addChild(s)}return this.game.open(
),i},listBundles:function(){return["stickers_collection"]}});cleverapps.styles.StickersCollectionWindow={window:{maxTitleSize:{scale:.65}},progressBar:{size:{width:410,height:52},gift:{json:bundles.windows.jsons.present_json,skin:"blue",scale:.9,offsetX:-60,offsetY:25},font:cleverapps.styles.FONTS.TREASURE_SEARCH_PROGRESS_BAR_TEXT},margin:20,book:{width:600,height:400},closeButton:!1,button:{width:160,text:"OK"},tooltipSize:{width:200,height:100}};var StickersCollection=function(e){MissionGame.call(this,e)};StickersCollection.prototype=Object.create(MissionGame.prototype),(StickersCollection.prototype.constructor=StickersCollection).prototype.open=function(){var e=this.mission.currency;this.mission.updateCurrency(-e),this.mission.update(e),this.isFinished()&&this.finish()},StickersCollection.prototype.checkIfComplete=function(){this.isFinished()&&this.mission.isRunning()&&(this.mission.complete(),new RewardWindow({reward:this.getReward(),mission:this.mission}))},
StickersCollection.prototype.isFinished=function(){return this.mission.result>=StickersCollection.GEMS},StickersCollection.prototype.getReward=function(){return this.mission.getPrize()},StickersCollection.GEMS=25,StickersCollection.GEMS_BY_PLACE={1:5,2:3,3:1};var StickersCollectionLogic=function(e){this.mission=e};StickersCollectionLogic.prototype.isMinigameReadyToFinish=function(){return this.mission.result+this.mission.currency>=StickersCollection.GEMS};var TellWindow=Window.extend({onWindowLoaded:function(e){this.params=e,this.createContent(),e={content:this.content,name:this.getName(),title:this.params.title,button:{width:cleverapps.styles.TellWindow.button.width,text:this.params.buttonText||Messages.get("OK"),onPressed:function(){this.close(),this.params.onPressed&&this.params.onPressed()}.bind(this)}},cleverapps.styles.TellWindow.window&&(e.styles=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.TellWindow.window,!0)),cleverapps.audio.playSound(
bundles.main.urls.window_effect),this._super(e)},getName:function(){return"tellwindow"},createContent:function(){var e=cleverapps.styles.TellWindow,t=this.createText(),i=[t];if(e.hero){var s=new HeroView(e.hero);s.setLocalZOrder(1),this.addChild(s)}else{var n=new StoryTeller;n.setLocalZOrder(1),n.setScale(e.char.scale[cleverapps.wideMode.mode]),i.unshift(n)}if(this.content=new cleverapps.Layout(i,{direction:cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?cleverapps.UI.VERTICAL:cleverapps.UI.HORIZONTAL,margin:e.margin[cleverapps.wideMode.mode]*resolutionScale,padding:{x:0,y:e.padding.y[cleverapps.wideMode.mode]*resolutionScale}}),n){if(cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL){var o=n.height-t.height;0<o&&(t.y+=o/4)}n.y+=e.char.dy}},createText:function(){var e=cleverapps.styles.TellWindow;e.types&&e.types[this.params.type]&&(e=cleverapps.overrideStyles(e,e.types[this.params.type],!0));var t=cleverapps.UI.generateTTFText(this.params.text,
cleverapps.styles.FONTS.WINDOW_TEXT);return t.setDimensions(e.text.width[cleverapps.wideMode.mode]*resolutionScale,0),t.setHorizontalAlignment(e.horizontalAlignment),t.fitTo(void 0,e.text.height[cleverapps.wideMode.mode]*resolutionScale),t},listBundles:function(){return StoryTeller.listBundles()}});cleverapps.styles.TellWindow={width:660,height:350,margin:[40,50,50],horizontalAlignment:cc.TEXT_ALIGNMENT_CENTER,padding:{y:[50,10,10]},char:{scale:[1,1,1],dy:0},text:{width:[600,450,450],height:[270,300,300]},button:{width:260}};var FriendRequestsWindow=Window.extend({onWindowLoaded:function(){var e=new cc.Node;e.setAnchorPoint2(),this.content=e,this.createViews(),this._super({name:"friendrequestswindow",content:e,noBackground:!0,onClose:function(){cleverapps.toolbar.updateItems()}});var t=cleverapps.FBLoginOrInvite();t&&this.addChild(t),cleverapps.audio.playSound(res.window_effect)},createViews:function(){var e=cleverapps.styles.FriendRequestsWindow;this.requestsViews=[],
this.requestsIds=[],this.pendingViews=[],this.pendingIds=[];for(var t=[],i=0;i<levels.friendRequests.notProcessed.length;i++){var s=this.createRequestView(levels.friendRequests.notProcessed[i]);s&&t.push(s)}(t=t.sort(function(e,t){var i=[levels.FriendRequest.TYPE_ADMIN_GIFTS,levels.FriendRequest.TYPE_ADMIN_SET_PROGRESS];return-1!==i.indexOf(e.model.type)&&-1===i.indexOf(t.model.type)?-1:-1!==i.indexOf(t.model.type)?1:0})).forEach(function(e){this.requestsViews.length<FriendRequestsWindow.MAX_SHOW_REQUESTS?(this.content.addChild(e),this.requestsViews.push(e),this.requestsIds.push(e.model.getId())):(this.content.addChild(e),e.setVisible(!1),this.pendingViews.push(e),this.pendingIds.push(e.model.getId()))},this);var n=cleverapps.UI.arrangeWithMargins(this.requestsViews.slice().reverse(),{direction:cleverapps.UI.VERTICAL,margin:e.margin,x:e.width/2,y:e.y});this.content.setContentSize2(e.width,n)},createRequestView:function(e){var o=e.getId(),t=e.getView();if(t)return new t(e,this,function(
){var e=this.getRequestIdViewOrder(o),t=this.requestsViews[0].getPosition();if(!1!==e){for(var i=e-1;0<=i;--i)this.requestsViews[i].isRunningSafe()&&this.requestsViews[i].runAction(new cc.MoveTo(this.getMoveTime(),this.requestsViews[i+1].getPosition()));this.requestsIds.splice(e,1),this.requestsViews.splice(e,1)}if(0===this.requestsViews.length&&0===this.pendingViews.length)this.close();else if(0<this.pendingViews.length){var s=this.pendingViews[0],n=this.pendingIds[0];this.pendingViews.splice(0,1),this.pendingIds.splice(0,1),this.requestsViews.splice(0,0,s),this.requestsIds.splice(0,0,n),s.setVisible(!0),s.setScale(0),s.setPosition(t),s.runAction(new cc.ScaleTo(this.getMoveTime(),1))}}.bind(this))},getRequestIdViewOrder:function(e){for(var t=0;t<this.requestsIds.length;t++)if(this.requestsIds[t]===e)return t;return!1},getMoveTime:function(){return.3}});FriendRequestsWindow.MAX_SHOW_REQUESTS=4,cleverapps.styles.FriendRequestsWindow={width:400,margin:15,y:0}
;var RewardWindow=Window.extend({onWindowLoaded:function(e){this.options=e=e||{},this.reward=e.reward,cleverapps.flags.doubleRewards&&(this.reward=cleverapps.doubleReward(this.reward)),this.styles=cleverapps.styles.RewardWindow,e.styles&&(this.styles=cleverapps.overrideStyles(this.styles,e.styles,!0)),void 0===e.animation&&(e.animation=this.styles.animation.json),this.createContent(),this._super({title:e.title||"messages:RewardWindow.title",name:e.name||"rewardwindow",content:this.content,minWidth:e.minWidth||this.styles.minWidth,minHeight:e.minHeight||this.styles.minHeight,button:{text:Messages.get(e.buttonText||"ClaimPrize.Button.text"),width:this.styles.button.width,height:this.styles.button.height,onPressed:this.onPressed.bind(this)},buttons:this.getButtons(),shareCheckBox:this.getShareOptions(),noBackground:e.noBackground,closeButton:!1});var t=this.rewardsList.width*this.rewardsList.scale;t>this.window.width&&this.rewardsList.setScale(this.rewardsList.scale*this.window.width/t),
this.runRewardsListAnimation()},getShareOptions:function(){var e=this.options.rewardName;return!1!==e&&{shareId:"reward",toReplace:{rewardName:Messages.get("RewardWindow."+(e||"default"))}}},createText:function(){var e=this.text=cleverapps.UI.generateTTFText(this.options.text,cleverapps.styles.FONTS.REWARD_WINDOW_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT),t=this.options.textWidth||cleverapps.styles.RewardWindow.textWidth;return void 0!==t&&e.setDimensions(t,0),e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e},addAnimation:function(){var e=this.options.animation;if(e){var t=e.json?e.json:e,i=new cleverapps.Spine(t);return i.setAnimation(0,"animation",!0),i.setPositionRound(this.rewardsList.width/2,this.rewardsList.height/2+this.styles.animation.y),i.setLocalZOrder(-1),this.rewardsList.addChild(i),i}},runRewardsListAnimation:function(){this.rewardsList.iterateRewards(this.rewardItemAnimation.bind(this))},getContentItems:function(){var e=[]
;return this.rewardsList=this.createRewardsList(),e.push(this.rewardsList),this.options.text&&(this.text=this.createText(),e.push(this.text)),e},rewardItemAnimation:function(e){e.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.3),new cc.ScaleTo(.2,1)))},createContent:function(){return this.content=new cleverapps.Layout(this.getContentItems(),{direction:cleverapps.UI.VERTICAL,margin:this.styles.margin,padding:this.styles.rewards.padding}),this.animation=this.addAnimation(),this.content},onShow:function(){this._super(),this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){this.visible&&cleverapps.audio.playSound(bundles.main.urls.reward_window_effect)}.bind(this)))),this.animation&&(this.animation.scale=0,this.animation.runAction(new cc.ScaleTo(.5,1)))},createRewardsList:function(){return new RewardsListComponent(this.reward)},onReceiveReward:function(){},doubleReward:function(){this.reward=cleverapps.doubleReward(this.reward);var e=this.rewardsList.parent,
t=this.rewardsList.getPosition();this.rewardsList.removeFromParent(!0),this.rewardsList=this.createRewardsList(),this.rewardsList.setPosition(t),e.addChild(this.rewardsList)},receiveReward:function(){this.reward&&(this.onReceiveReward(),cleverapps.Chest.prototype._receiveReward(this.reward),this.reward=[])},onClose:function(){this.receiveReward(),cleverapps.starChest&&!cleverapps.starChest.locked&&new StarChestWindow,this.options.callback&&this.options.callback()},onPressed:function(){this.close()},selectDoubleStrategy:function(){var e=[];if(cleverapps.social.isLoggedIn()&&(cleverapps.flags.noviral||e.push(RewardWindow.DOUBLE_INVITE),cleverapps.flags.noviral||cleverapps.flags.noshares||e.push(RewardWindow.DOUBLE_SHARE)),cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)&&(e.push(RewardWindow.DOUBLE_AD),e.push(RewardWindow.DOUBLE_AD)),0<e.length)return e[Math.floor(Math.random()*e.length)]},getButtons:function(){return[]},getDoubleButton:function(){if(
!levels.user.isBeginner());},getDoubleRewardButtonContent:function(e,t){var i=cleverapps.styles.RewardWindow;this.options&&this.options.styles&&(i=cleverapps.overrideStyles(i,this.options.styles,!0));var s=new cc.Node,n=new cc.Sprite(e);n.setAnchorPoint2(),n.setScale(t),s.addChild(n);var o=cleverapps.UI.generateTTFText("messages:PeriodicBonus.DoubleRewardButton.Text",cleverapps.styles.FONTS.BUTTON_TEXT);return s.addChild(o),s.setContentSize2(n.width*n.scale+i.doubleButton.margin+o.width,n.height),n.setPositionRound(i.doubleButton.icon),o.setPositionRound(i.doubleButton.text),s},doubleRewardByInvite:function(i){var e={message:Messages.get("SettingsWindow.InviteFriends.message"),title:Messages.get("SettingsWindow.InviteFriends.title"),element:this.doubleButton},t=this.createListener(function(e,t){e===cleverapps.Social.CODE_SUCCEED&&(Buttons.remove(this.doubleButton),this.doubleReward(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_BONUS_DOUBLE+"_"+i))}.bind(this))
;i===RewardWindow.DOUBLE_INVITE?(cleverapps.history.add("invt",1),cleverapps.social.inviteFriends(e,t)):cleverapps.social.inviteFriendsShare(e,t)},doubleRewardByAd:function(){cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)?(Buttons.remove(this.doubleButton),cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,function(){cleverapps.playSession.inc(cleverapps.EVENTS.REWARDED_DAILY_BONUS),this.doubleReward(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_BONUS_DOUBLE+"_"+RewardWindow.DOUBLE_AD)}.bind(this))):cleverapps.Notification.create("messages:AdsUnavailable")},listBundles:function(e){var t=[];return(e&&e.reward||{}).herolevels&&t.push("heroes"),t.push("reward_icons"),t}});RewardWindow.DOUBLE_SHARE=0,RewardWindow.DOUBLE_INVITE=1,RewardWindow.DOUBLE_AD=2,RewardWindow.NO_PAYMENTS_MODIFIER=2,cleverapps.styles.RewardWindow={margin:30,animation:{y:0,json:res.reward_spine_json},minWidth:600,minHeight:700,text:{x:0,y:150},rewards:{padding:{x:100,
y:50}},button:{width:250,height:100},buttons:{margin:30},doubleButton:{margin:10,width:300,height:100,padding:{x:20,y:0},icon:{scale:.8,x:{align:"left",dx:3},y:{align:"center",dy:3}},text:{x:{align:"right"},y:{align:"center"}}}};var UserStatus=function(){cleverapps.EventEmitter.call(this),cleverapps.environment.isSceneWithPreview()?this.timeouts=[]:this.timeouts=[new UserStatusTimeout(cleverapps.parseInterval("10 seconds"),function(e,t){this.trigger("inactive_very_short",t)}.bind(this)),new UserStatusTimeout(cleverapps.parseInterval("20 seconds"),function(e,t){this.trigger("inactive_short",t)}.bind(this)),new UserStatusTimeout(cleverapps.parseInterval("60 seconds"),function(e,t){this.trigger("inactive_long",t)}.bind(this))]};UserStatus.prototype=Object.create(cleverapps.EventEmitter.prototype),(UserStatus.prototype.constructor=UserStatus).prototype.clear=function(){this.timeouts.forEach(function(e){e.clear()})},UserStatus.prototype.reportUserAction=function(){this.trigger("active"),
this.timeouts.forEach(function(e){e.reset()})};var UserStatusTimeout=function(e,t){this.time=e,this.callback=t,this.reset()};UserStatusTimeout.prototype.reset=function(){this.clear(),this.hintTimeout=new cleverapps.LongTimeout(function(){this.callback(),this.reset()}.bind(this),this.time)},UserStatusTimeout.prototype.clear=function(){this.hintTimeout&&(this.hintTimeout.clear(),delete this.hintTimeout)};var Counter=function(){this.value=0,this.onceZero=void 0,this.afterRunStages=void 0,this.stages=[],this.off=!1,this.onStageActivatedListener=function(){}};Counter.prototype.registerStage=function(t,e){for(var i=0;i<this.stages.length;i++)if(this.stages[i].handler===e)return;cleverapps.config.debugMode&&0<this.stages.filter(function(e){return e.priority===t}).length&&alert("Multiple stages with same priority: "+t),this.stages.push({priority:t,handler:e}),this.stages.sort(function(e,t){return e.priority-t.priority})},Counter.prototype.runStages=function(){if(0===this.value&&!this.off)for(
var e=0;e<this.stages.length;e++)if(this.stages[e].handler(),this.isActive())return void this.onStageActivatedListener()},Counter.prototype.turnOff=function(){this.off=!0},Counter.prototype.isActive=function(){return 0<this.value},Counter.prototype.trigger=function(){this.runStages()},Counter.prototype.inc=function(){this.value++},Counter.prototype.dec=function(){if(this.value--,0===this.value&&!this.off){if(this.onceZero){var e=this.onceZero;this.onceZero=void 0,e()}0!==this.value||this.off||this.runStages(),this.afterRunStages&&(this.afterRunStages(),this.afterRunStages=void 0)}},Counter.prototype.setTimeout=function(e,t){return this.inc(),setTimeout(function(){this.off||(e(),this.dec())}.bind(this),t)};var GameBase=function(e,t){cleverapps.EventEmitter.call(this),Game.currentGame=this,cleverapps.user.incProgressCompare(),this.levelContent=e.content,this.level=e,this.options=t||{},this.timer=new GameTimer,this.counter=new Counter,this.boostersBefore=this.options.boostersBefore,
this.levelWithCoins=!e.isRegular()||e.isCurrentLevel()||cleverapps.user.isPassedAll()&&cleverapps.metha.getType()===Metha.SIMPLE&&cleverapps.user.checkAvailable(GameBase.LEVEL_WITH_COINS_AVAILABLE),this.onStopListeners={},cleverapps.Combo&&cleverapps.Combo.isAvailable()&&(this.combo=new cleverapps.Combo(this));var i=cleverapps.userresult.getStarsForLevel(this.level.episodeNo,this.level.levelNo);if(this.level.isRegular()&&(this.level.isNew()||cleverapps.config.results&&3!==i)){var s=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CLASSIC);s&&(this.gameMission=s)}if(this.level.isRegular()&&this.level.isNew()){var n=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_BACKGROUND);n&&(this.backgroundMission=n)}if(this.userStatus=new UserStatus,this.rewards={},void 0!==this.gameMission&&this.gameMission.isRunning()&&(this.rewards[GameBase.REWARD_CLOVER]=0),this.backgroundMission&&this.backgroundMission.isRunning()){var o=this.backgroundMission.getLevelReward()
;this.rewards[GameBase.REWARD_BACKGROUND_CLOVER]=this.level.isHard()?o[1]:o[0]}cleverapps.piggyBank&&cleverapps.piggyBank.isActive()&&!cleverapps.piggyBank.isFull()&&(this.rewards[GameBase.REWARD_PIGGY_BANK]=cleverapps.piggyBank.getAddAmount()),this.level.isRegular()&&this.level.isNew()&&levels.user.expAvailable()&&(this.rewards[GameBase.REWARD_EXP]=this.level.isHard()?GameBase.HARD_LEVEL_EXP_PRIZE:GameBase.EXP_PRIZE),-1!==["board","solitaire","differences"].indexOf(cleverapps.config.type)&&(this.level.isCurrentLevel()||this.level.episode.isDailyCup()||this.level.episode.isDailyLevel()||cleverapps.config.editorMode)&&(this.basicGoldReward=this.level.isHard()?30:10,this.rewards[GameBase.REWARD_GOLD]=this.basicGoldReward),this.level.episode.isBonusRound()&&(this.rewards[GameBase.REWARD_GOLD]=cleverapps.BonusRoundChest.REWARD),this.levelWithTutorial&&this.levelWithTutorial()?cleverapps.Random.seed(this.level.getHumanReadableNumber()-1):cleverapps.Random.randomSeed(),
this.onCloverAdded=function(){},this.onGoldRewardAdded=function(){},this.onGameMessage=function(){},this.outcome=GameBase.OUTCOME_UNKNOWN,this.onChangeOutcomeListeners={},this.afterOnChangeOutcomeListeners={},cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN)&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN).logic.lantern.isActive(this.level)&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN).logic.lantern.onStart(),this.boostersBefore&&this.boostersBefore.onStart(),cleverapps.competitionStatistics.onGameStarted(this)};GameBase.prototype=Object.create(cleverapps.EventEmitter.prototype),(GameBase.prototype.constructor=GameBase).prototype.getDailyCupStars=function(){return 1},GameBase.prototype.initPool=function(){},GameBase.prototype.stop=function(){for(var e in this.counter.turnOff(),this.userStatus.clear(),this.combo&&this.combo.stop(),this.stopped=!0,this.onStopListeners)this.onStopListeners[e]()},
GameBase.prototype.afterChangeOutcome=function(){},GameBase.prototype.setOutcome=function(e){this.outcome===GameBase.OUTCOME_UNKNOWN&&(this.outcome=e,this.runOutcomeListeners())},GameBase.prototype.runOutcomeListeners=function(){cleverapps.values(this.onChangeOutcomeListeners).forEach(function(e){e(this.outcome)}.bind(this)),cleverapps.values(this.afterOnChangeOutcomeListeners).forEach(function(e){e(this.outcome)}.bind(this)),this.afterChangeOutcome()},GameBase.prototype.win=function(){cleverapps.user.incProgressCompare(300),this.setOutcome(GameBase.OUTCOME_VICTORY)},GameBase.prototype.lose=function(){cleverapps.user.incProgressCompare(10),this.setOutcome(GameBase.OUTCOME_LOST)},GameBase.prototype.giveUp=function(){cleverapps.user.incProgressCompare(10),this.boostersBefore&&this.boostersBefore.onGiveUp(),this.setOutcome(GameBase.OUTCOME_GAVEUP)},GameBase.prototype.showUp=function(e){e()},GameBase.EXP_PRIZE=1,GameBase.HARD_LEVEL_EXP_PRIZE=3,GameBase.REWARD_CLOVER="clover",
GameBase.REWARD_BACKGROUND_CLOVER="background_clover",GameBase.REWARD_PIGGY_BANK="piggyBank",GameBase.REWARD_EXP="exp",GameBase.REWARD_GOLD="gold",GameBase.REWARD_BOOSTER="booster",GameBase.OUTCOME_UNKNOWN=void 0,GameBase.OUTCOME_VICTORY=1,GameBase.OUTCOME_LOST=2,GameBase.OUTCOME_GAVEUP=3,GameBase.prototype.stillNoPenalty=function(){return!cleverapps.isRumble()&&(this.outcome===GameBase.OUTCOME_UNKNOWN&&(!this.level.episode.isBonusRound()&&("board"===cleverapps.config.type||("solitaire"===cleverapps.config.type?this.table.beginCards===this.table.countOfCardsToPlay():!(!this.originalMoves||-1!==this.originalMoves)||this.beginMoves===this.moves))))},GameBase.prototype.canPayReward=function(e){switch(e){case GameBase.REWARD_CLOVER:return void 0!==this.gameMission&&this.gameMission.isRunning();case GameBase.REWARD_BACKGROUND_CLOVER:return void 0!==this.backgroundMission&&this.backgroundMission.isRunning();case GameBase.REWARD_PIGGY_BANK:return cleverapps.piggyBank.isActive()
;case GameBase.REWARD_EXP:case GameBase.REWARD_GOLD:case GameBase.REWARD_BOOSTER:return!0}},GameBase.prototype.payReward=function(e,t){if(this.canPayReward(e)&&t)switch(e){case GameBase.REWARD_CLOVER:this.gameMission.update(t);break;case GameBase.REWARD_BACKGROUND_CLOVER:this.backgroundMission.updateCurrency(t);break;case GameBase.REWARD_PIGGY_BANK:cleverapps.piggyBank.addGold(t);break;case GameBase.REWARD_EXP:levels.user.setExp(levels.user.exp+t);break;case GameBase.REWARD_GOLD:levels.user.setGold(levels.user.gold+t);break;case GameBase.REWARD_BOOSTER:cleverapps.boostersCounter.add(this.collectedBoosterCell.type,t)}},GameBase.prototype.getMissionType=function(){if(this.gameMission)return this.gameMission.type},GameBase.prototype.addClover=function(e,t,i){this.getMissionType()===e&&(this.rewards[GameBase.REWARD_CLOVER]=(this.rewards[GameBase.REWARD_CLOVER]||0)+t,i||this.onCloverAdded())},GameBase.prototype.addGoldReward=function(e,t){this.rewards[GameBase.REWARD_GOLD]=(
this.rewards[GameBase.REWARD_GOLD]||0)+e,t||this.onGoldRewardAdded()},GameBase.LEVEL_WITH_COINS_AVAILABLE={episode:0,level:7};var GameSceneBase=cleverapps.FixedWidthScene.extend({ctor:function(e,t){if(cleverapps.config.editorMode&&cleverapps.environment.setScene(cleverapps.Environment.SCENE_GAME),this.game=e,this.level=t,this._super(cleverapps.Environment.SCENE_GAME),levels.cookieJar&&levels.cookieJar.shouldBeVisible()&&levels.cookieJar.setVisible(),this.game.competition&&cleverapps.isKnockoutGame()){var i=this.playersView=new KnockoutPlayersView(this.game.competition,cleverapps.metha.getMainObject().knockoutGame.rumble.getCurrentRound());this.scene.addChild(i)}if(e.combo){var s=new ComboView(e.combo,this.scene);this.scene.addChild(s),e.onChangeOutcomeListeners.comboResetAnimations=e.combo.reset.bind(e.combo)}if("match3"===cleverapps.config.type&&(this.infoPanel=new InfoPanel,this.scene.addChild(this.infoPanel),this.controlsPanel=new ControlsPanel,this.scene.addChild(this.controlsPanel
)),cleverapps.config.debugMode&&!cleverapps.screenshotsMode){var n=this.levelLabel=cleverapps.UI.generateTTFText(this.level.getHumanReadableNumber(),cleverapps.styles.FONTS.MENUBAR_TEXT);n.setLocalZOrder(100),n.setPositionRound(cleverapps.styles.GameScene.debugLevelNo),this.scene.addChild(n)}e.afterOnChangeOutcomeListeners.gameScene=this.createListener(this.animateChangeOutcome.bind(this)),this.initSceneBg(),cleverapps.history.add("newg",1),e.onChangeOutcomeListeners.misc=this.createListener(function(){cleverapps.audio.fadeOut(),cleverapps.gun&&cleverapps.gun.hide(),this.level.isPassed=this.game.outcome===GameBase.OUTCOME_VICTORY}.bind(this)),cleverapps.exclamation.setGame(this.game),this.boatswain=new Boatswain(t),this.actions=[],this.game.churnActivated=cleverapps.once(function(){this.game.level.isRegular()&&levels.user.isUniqueStart(this.game.level.episodeNo,this.game.level.levelNo,this.level.content.version)&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.UNIQUE_START,{
hash:this.level.hash})}.bind(this)),cleverapps.environment.levelNo=t.levelNo,cleverapps.environment.episodeNo=t.episodeNo,this.prepareConfirmExit(),cc.pool.drainAllPools(),this.game.initPool(),cleverapps.lives&&cleverapps.lives.amount>cleverapps.Lives.MAX_REGEN_AMOUNT&&(this.game.moreThenMaxRegenLife=!0),this.takeLifeOrBet(!0),this.customize(),this.groupToggler=new cleverapps.UI.GroupToggler,this.game.rewardGoldView&&(this.rewardGoldView=new RewardGoldView(this,this.infoPanel||this.scene)),this.game.gameMission&&(this.cloversView=new CloversView(this,this.infoPanel||this.scene)),this.level.isRegular()&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_START,{hash:this.level.hash}),void 0!==cleverapps.abTest.group&&cleverapps.eventLogger.logEvent("abtest_"+cleverapps.abTest.group+"_"+cleverapps.EVENTS.LEVEL_START),cleverapps.gun.isAvailable()&&(this.gunView=new GunView(cleverapps.gun,this)),this.game.tournament&&(this.playersView=new TournamentPlayersView(this.game.competition),
this.scene.addChild(this.playersView));var o=new GameMessageView(e);this.scene.addChild(o);var a=cleverapps.exclamation.createView();this.scene.addChild(a,20),a.setPositionRound(this.width/2,this.height/2)},calcHash:function(){return RecursiveHasher(this.level.content,["episodeNo","levelNo","version","hard","paint","extra","gold"])},introControls:function(){return"panel_info"},_playIntro:function(){this.needDisplayIntro=!1,cleverapps.metha.display({focus:"GameScene.intro",control:this.introControls(),actions:[this.animateSceneBg.bind(this),function(e){this.onChangeSize(),e()}.bind(this),this.displayIntro.bind(this),this.displayDailyLevelWindow.bind(this)]})},initSceneBg:function(){if(!cleverapps.flags.introDisabled){var e=cleverapps.styles.GameScene.startAnimation.scale;this.bgScaleMargin=e;var t=this.background.getScaleX()*e,i=this.background.getScaleY()*e;this.background.setScale(t,i),this.scene.setScale(1/e)}},animateSceneBg:function(e){var t=this.bgScaleMargin||1
;this.game.outcome===GameBase.OUTCOME_UNKNOWN?this.scene.runAction(new cc.ScaleTo(.8,1)):this.scene.runAction(new cc.ScaleTo(.8,1/t)),setTimeout(e,800)},displayIntro:function(e){this.game.showUp(function(){this.game.level.isRegular()&&levels.FPS.run(this.game.level.episodeNo,this.game.level.levelNo),e()}.bind(this))},displayDailyLevelWindow:function(e){this.level.episode.isDailyLevel()?DailyLevelWindow.shown||-1===["olympics","crocword","tripeaks"].indexOf(cleverapps.config.name)?e():(new DailyLevelWindow,DailyLevelWindow.shown=!0,cleverapps.metha.onceNoWindowsListener=e):e()},prepareConfirmExit:function(){this.confirmWindow=void 0,this.game.onChangeOutcomeListeners.confirmexit=function(e){void 0!==this.confirmWindow&&this.confirmWindow.close()}.bind(this)},closeAction:function(){this.backToEditorOrAdmin()||this.game&&void 0===this.confirmWindow&&this.game.outcome===GameBase.OUTCOME_UNKNOWN&&(cleverapps.metha.isFocused()||(this.game.stillNoPenalty()?this.game.giveUp(
):cleverapps.metha.display({focus:"GameSceneCloseAction",action:function(e){this.confirmWindow=new ConfirmExitWindow(function(){this.game.lose()}.bind(this),function(){this.confirmWindow=void 0}.bind(this),this.game),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})))},customize:function(){},takeLifeOrBet:function(e){if(cleverapps.lives&&!cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)){if(this.level.episode.isDailyCup()&&!cleverapps.dailyCup.cupWithLives())return;cleverapps.lives.take(e)}cleverapps.bet&&cleverapps.bet.take(e)},giveLife:function(){if(cleverapps.lives&&!cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)){if(this.level.episode.isDailyCup()&&!cleverapps.dailyCup.cupWithLives())return;(this.game.moreThenMaxRegenLife||cleverapps.lives.amount<cleverapps.Lives.MAX_REGEN_AMOUNT)&&cleverapps.lives.give()}},calcAddedStars:function(e){if(this.level.episode.isRegular()&&cleverapps.user.isPassedAll(
)||this.level.episode.isDailyCup())return e;if(!this.level.isRegular())return 0;var t=cleverapps.userresult.getStarsForLevel(this.level.episodeNo,this.level.levelNo);return t<=e?e-t:0},beforeWin:function(){cleverapps.placements.run(Placements.AFTER_GAME_FINISH);var e=this.game.outcome;this.giveLife(),this.controlsPanel&&this.controlsPanel.hide(),this.level.isRegular()&&cleverapps.metha.getMainObject().gamePlayed(e,this.game);var t=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN)&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN).logic.lantern;if(e===GameBase.OUTCOME_GAVEUP)t&&t.isActive(this.level)&&t.restoreSavedStreak();else if(e===GameBase.OUTCOME_VICTORY){if(this.game.timer&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_PASSED_TIME,{hash:this.level.hash,passedTime:this.game.timer.getTime()}),this.level.isRegular()&&this.level.isNew()&&(cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.PASS_LEVELS_IN_ROW),
cleverapps.missionManager.dispatchEvent(Mission.EVENT_PASS_LEVELS_IN_ROW)),t&&t.isActive(this.level)&&t.onWin(),cleverapps.placements.run(Placements.VICTORY),cleverapps.history.add("win",1),this.level.isRegular()){void 0!==this.game.leftMoves&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_LEFT_MOVES,{hash:this.level.hash,leftMoves:this.game.leftMoves});var i=!0;"board"===cleverapps.config.type&&this.game.timer&&(i=this.game.timer.getTime()<=cleverapps.parseInterval("5 minutes")),i&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_FINISH,{hash:this.level.hash}),this.level.isNew()&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.UNIQUE_FINISH,{hash:this.level.hash}),void 0!==cleverapps.abTest.group&&cleverapps.eventLogger.logEvent("abtest_"+cleverapps.abTest.group+"_"+cleverapps.EVENTS.LEVEL_FINISH)}var s=this.level.isCurrentLevel();this.boatswain.level=this.level=cleverapps.extend(cleverapps.clone(this.level),{isCurrentLevel:function(){return s}}),
this.oldLeague=levels.user.league,this.level.isCurrentLevel()&&cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.PASS_LEVEL),this.level.episode.isDailyLevel()&&cleverapps.dailyLevel.onWin(this.level)}else e===GameBase.OUTCOME_LOST&&(cleverapps.dailyTasks.setProgress(cleverapps.DailyTask.PASS_LEVELS_IN_ROW,0),cleverapps.missionManager.dispatchEvent(Mission.EVENT_PASS_LEVELS_IN_ROW,{amount:0}),t&&t.isActive(this.level)&&t.onLose(),this.takeLifeOrBet(),cleverapps.placements.run(Placements.LOSE),cleverapps.history.add("lose",1))},showProperWindow:function(e){if(!cleverapps.flags.victoryWindowDisabled)if(this.game.outcome!==GameBase.OUTCOME_GAVEUP){var t={level:this.level,game:this.game,boatswain:this.boatswain};this.level.episode.isBonusRound()?new BonusRoundWindow(this.game):this.game.outcome===GameBase.OUTCOME_LOST?cleverapps.lives?new LoseWindow(function(t){cleverapps.isRumble()||(this.boatswain.intent=function(e){this.boatswain.REPLAY(e,t)}.bind(this))}.bind(this),this.game):e(
):new VictoryWindow(t),cleverapps.metha.onceNoWindowsListener=e}else e()},waitWinLoseAnimations:function(e){e()},fireworksAnimation:function(e){cleverapps.isKnockoutGame()||this.game.outcome!==GameBase.OUTCOME_VICTORY||this.scene.addChild(new Fireworks),e()},purgeOldGame:function(e){Game.currentGame=void 0,this.game=void 0,"undefined"!=typeof VictoryLoseAnimations&&VictoryLoseAnimations.clear(),e()},saveFinalResults:function(e){if(!this.game){var t="game empty ";Game.currentGame&&Game.currentGame.level&&(t+=" level - "+Game.currentGame.level.levelNo+", episode - "+Game.currentGame.level.episodeNo),cleverapps.ReportStream.debug(t)}this.game.outcome===GameBase.OUTCOME_VICTORY&&(void 0!==Match3&&this.game instanceof Match3&&this.level.isRegular()&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_STARS,{hash:this.level.hash,stars:this.stars}),this.level.episode.isDailyCup()&&this.saveDailyCupProgress()),e()},saveDailyCupProgress:function(){cleverapps.dailyCup.addAmount(
this.game.getDailyCupStars()),cleverapps.playSession.set(cleverapps.EVENTS.DAILY_CUP_PLAYERS,!0)},playChangeOutcome:function(){cleverapps.metha.display({focus:"ChangeOutcome",control:this.introControls(),filter:function(){return this.wantAnimateChangeOutcome}.bind(this),action:function(e){this.wantAnimateChangeOutcome=!1,cleverapps.metha.compound(e,this.actions)}.bind(this)})},backToEditorOrAdmin:function(e){return cleverapps.config.editorMode?(this.game&&this.game.stop(),e&&e(),this.level.edit(),!0):!!cleverapps.config.adminMode&&(this.game&&this.game.stop(),e&&e(),AdministratorScene.open(),!0)},animateChangeOutcome:function(e){this.wantAnimateChangeOutcome=!0,cleverapps.config.debugMode&&console.log("OUTCOME: "+e),this.beforeWin(),cleverapps.isKnockoutGame()||e===GameBase.OUTCOME_VICTORY&&this.level.isCurrentLevel()&&levels.user.incLevel(),this.actions.push(this.waitWinLoseAnimations.bind(this)),this.actions.push(this.fireworksAnimation.bind(this)),this.actions.push(
this.saveFinalResults.bind(this)),this.actions.push(this.animateSceneBg.bind(this)),this.actions.push(this.showProperWindow.bind(this)),e===GameBase.OUTCOME_VICTORY?this.afterWin():this.actions.push(this.purgeOldGame.bind(this)),this.actions.push(function(){cleverapps.metha.distract({focus:"boatswain",action:function(e){this.backToEditorOrAdmin(e)||this.boatswain.intent(e)}.bind(this)})}.bind(this)),cleverapps.metha.display({focus:"empty",action:function(e){e()}})},afterWin:function(){if(this.actions.push(function(e){for(var t in this.game.rewards)this.game.payReward(t,this.game.rewards[t]);e()}.bind(this)),this.actions.push(this.purgeOldGame.bind(this)),this.level.isRegular()&&levels.user.checkAvailable(BeatFriendWindow.AVAILABLE)&&this.level.isNew()){var t=this.level.players.filter(function(e){return cleverapps.friends.getById(e)});0<t.length&&this.actions.push(function(e){new BeatFriendWindow(t[0],this.level),cleverapps.metha.onceNoWindowsListener=e}.bind(this))}
cc.sys.isNative&&!cleverapps.flags.norest&&levels.user.checkAvailable(RateWindow.AVAILABLE)&&!RateWindow.hadRated()&&this.actions.push(function(e){new RateWindow,cleverapps.metha.onceNoWindowsListener=e}),this.oldLeague===levels.user.league||cleverapps.flags.norest||(this.actions.push(function(e){new NewLeagueWindow(this.level),cleverapps.metha.onceNoWindowsListener=e}.bind(this)),this.actions.push(function(e){new LeadersWindow,cleverapps.metha.onceNoWindowsListener=e}));var i=this.game.backgroundMission;if(i&&i.isMinigameReadyToFinish()&&this.actions.push(function(e){new i.nudgeWindow(i),cleverapps.metha.onceNoWindowsListener=e}),cleverapps.missionManager.dispatchEvent(Mission.EVENT_LEVEL_FINISH,{level:this.level}),cleverapps.config.results&&this.level.isRegular()&&levels.user.checkAvailable(ChampionWindow.AVAILABLE)&&this.level.isChampion()&&(cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.LEVEL_CHAMPION),this.actions.push(function(e){new ChampionWindow(this.level),
cleverapps.metha.onceNoWindowsListener=e}.bind(this))),"undefined"!=typeof match3&&!1!==match3.heroes.readyToOpen()){var s=match3.heroes.readyToOpen();match3.heroes.setLevel(s,1),this.actions.push(function(e){cleverapps.Plot.onFirstHeroesOpen(e,{color:s})})}this.actions.push(function(e){cleverapps.starChest&&!cleverapps.starChest.locked?(new StarChestWindow,cleverapps.metha.onceNoWindowsListener=e):e()})},onChangeSize:function(e){this._super(e),this.game&&this.game.combo&&this.game.combo.onChangeSize&&this.game.combo.onChangeSize()},getBackgroundStyles:function(){var e=GameSceneBase.ChooseStyling(this.level);return e.background=bundles[e.bundle].urls.background,cleverapps.skins.getSlot("gameSceneBg")||e},getAudioStyles:function(){var e=GameSceneBase.ChooseStyling(this.level);return{res:cleverapps.skins.getSlot("gameAudio")||e.music,delay:cleverapps.styles.GameScene.sound.delay}}});GameSceneBase.ChooseStyling=function(e){if(bundles[e.episode.bundleId()]&&bundles[e.episode.bundleId(
)].urls.background)return{bundle:e.episode.bundleId()};var t=cleverapps.styles.GameScene.STYLING,i=t.regular[e.getHumanReadableNumber()%t.regular.length];return e.episode.isBonusRound()?i=t.bonus:(e.isHard()||cleverapps.isRumble()&&cleverapps.metha.getMainObject().knockoutGame.rumble.getCurrentRound().isLast())&&(i=t.hard),-1!==["wordheaps","spades","mergeriddles","mergeheroes"].indexOf(cleverapps.config.name)&&(i.bundle="simple_background_"+cleverapps.simple.getCurrent()),i},GameSceneBase.BUNDLES=function(e,t){var i=["game","heroes","dialogues"];if(t&&(i=i.concat(t.content.bundles||[t.content.bundleName]||[])).push(GameSceneBase.ChooseStyling(t).bundle),e&&cleverapps.config.rpg)for(var s in e.enemies){var n=e.enemies[s];i.push("enemy"+n)}return bundles.exclamations&&i.push("exclamations"),bundles["letters_"+cleverapps.settings.language]&&i.push("letters_"+cleverapps.settings.language),i},cleverapps.styles.GameScene={actor:void 0,startAnimation:{scale:1.05},sound:{delay:1},
debugLevelNo:{x:{align:"right",dx:-100},y:{align:"bottom",dy:100}}},cleverapps.styles.GameScene.STYLING={bonus:{bundle:"game_background_bonus",music:bundles.game.urls.background_music_game,pattern:-1!==["wordsoup"].indexOf(cleverapps.config.name)},hard:{bundle:"game_background_hard",animation:bundles.game.jsons.game_bg_clouds_json,skin:"gameBackground_hard",music:bundles.game.urls.background_music_hard,pattern:-1!==["differences","olympics","wordsoup"].indexOf(cleverapps.config.name)},regular:[{bundle:"game_background",animation:bundles.game.jsons.game_bg_clouds_json,skin:"gameBackground",music:bundles.game.urls.background_music_game,pattern:-1!==["differences","olympics","wordsoup"].indexOf(cleverapps.config.name)}]},function(){if("crocword"===cleverapps.config.name)cleverapps.styles.GameScene.STYLING.regular[0].bundle="loading_scene_backgrounds";else for(var e=cleverapps.styles.GameScene.STYLING.regular[0],t=2;bundles["game_background_"+t];t++
)cleverapps.styles.GameScene.STYLING.regular.push({bundle:"game_background_"+t,skin:"gameBackground"+t,music:e.music,animation:e.animation,pattern:e.pattern})}();var GameMessageView=cc.Node.extend({ctor:function(e){this._super(),(this.game=e).onGameMessage=this.createListener(this.show.bind(this)),this.setLocalZOrder(100)},show:function(e,t,i){if(cleverapps.flags.gameMessagesDisabled)e();else{var s=cc.director.getRunningScene().scene,n=this.createBg();this.addChild(n);var o=this.createText(t);if(n.addChild(o),o.fitTo(.9*n.width),i){var a=this.createTitle(i);n.addChild(a)}var r=cc.p(s.width/2,s.height+n.height/2+cleverapps.UI.getSceneOffsetY()),l=cc.p(s.width/2,s.height/2),c=cc.p(s.width/2,-n.height/2-cleverapps.UI.getSceneOffsetY());n.setPositionRound(r),n.setVisible(!1),n.runAction(new cc.Sequence(new cc.DelayTime(this.getDelayTime()),new cc.CallFunc(function(){n.setVisible(!0)}),new cc.MoveTo(.5,l).easing(cc.easeBackOut(1)),new cc.DelayTime(1.2),new cc.MoveTo(.5,c).easing(
cc.easeBackIn(1)),new cc.RemoveSelf,new cc.CallFunc(e)))}},getBackgroundImage:function(){var e=bundles.gamemessage.frames.gamemessage_bg_png;return cleverapps.isRumble()&&cleverapps.metha.getMainObject().knockoutGame.rumble.getCurrentRound().isLast()&&(e=bundles.gamemessage.frames.gamemessage_bg_2_png),"stacks"===cleverapps.config.subtype&&this.game.level.isHard()&&(e=bundles.gamemessage.frames.gamemessage_bg_2_png),e},createText:function(e){e=Messages.has(e)?Messages.get(e):e;var t=cleverapps.styles.FONTS.GAME_MESSAGE_TEXT;"stacks"===cleverapps.config.subtype&&this.game.level.isHard()&&(t=cleverapps.styles.FONTS.GAME_MESSAGE_HARD_TEXT);var i=cleverapps.UI.generateTTFText(e.toUpperCase(),t);return i.setPositionRound(cleverapps.styles.GameMessageView.text),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i},createTitle:function(e){var t=cleverapps.styles.GameMessageView,i=bundles.gamemessage.frames.gamemessage_title_bg_png;this.game.level.isHard()&&(
i=bundles.gamemessage.frames.gamemessage_title_bg_2_png);var s=new cc.Sprite(i);e=Messages.has(e)?Messages.get(e):e;var n=cleverapps.UI.generateTTFText(e.toUpperCase(),cleverapps.styles.FONTS.GAME_MESSAGE_TITLE_TEXT);return n.fitTo(t.title.width),s.addChild(n),n.setPositionRound(t.title),s.setPositionRound(t.title.bg),s},createBg:function(){var e,t=cleverapps.styles.GameMessageView,i=cleverapps.UI.getSceneSize();if(t.pattern){for(var s=new cc.Sprite(this.getBackgroundImage()).width,n=[],o=0;o<Math.ceil(i.width/(s+t.pattern.margin));o++)n.push(new cc.Sprite(this.getBackgroundImage()));e=new cleverapps.Layout(n,{direction:cleverapps.UI.HORIZONTAL,margin:t.pattern.margin})}else(e=new cc.Scale9Sprite(this.getBackgroundImage())).setContentSize2(i.width,e.height);return e},getDelayTime:function(){return.2}});cleverapps.styles.GameMessageView={text:{x:{align:"center"},y:{align:"center"}},title:{width:200,bg:{x:{align:"center"},y:{align:"center",dy:110}},x:{align:"center"},y:{align:"center"}}}
,cleverapps.overrideFonts(cleverapps.styles.FONTS,{GAME_MESSAGE_TEXT:{size:60,color:cleverapps.styles.COLORS.WHITE,stroke:{color:new cc.Color(145,56,188,255),size:1}},GAME_MESSAGE_TITLE_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE}});var GameTimer=function(e){this.start=Date.now(),this.game=e};GameTimer.prototype.setStartTime=function(e){this.start=e},GameTimer.prototype.getStartTime=function(){return this.start},GameTimer.prototype.getTime=function(){return Date.now()-this.start},cleverapps.DailyTask=function(e,t,i,s){this.type=e,this.goal=t,this.level=s,this.progress=0,this.data=i||{},this.onUpdateListener=function(){}},cleverapps.DailyTask.prototype.getSaveInfo=function(){return{type:this.type,progress:this.progress,collected:this.collected,goal:this.goal,data:this.data}},cleverapps.DailyTask.prototype.addProgress=function(e,t){if("object"==typeof e&&(t=e),"number"!=typeof e&&(e=1),0<e)return this.setProgress(this.progress+e,t)},
cleverapps.DailyTask.prototype.setProgress=function(e,t){"object"==typeof e&&(t=e),"number"!=typeof e&&(e=1),this.isFinished()||this.type===cleverapps.DailyTask.USE_BOOSTER&&this.data.booster!==t.booster||this.type===cleverapps.DailyTask.COLLECT_COLOR_CELLS&&this.data.color!==t.color||this.type===cleverapps.DailyTask.COLLECT_SPECIAL_CELLS&&this.data.cell_code!==t.cell_code||this.type===cleverapps.DailyTask.GUESS_WORDS_WITH_LETTER&&this.data.letter!==t.letter||this.type===cleverapps.DailyTask.COLLECT_CARDS_BY_VALUE&&this.data.cardValue!==t.cardValue||this.type===cleverapps.DailyTask.COLLECT_CARDS_BY_SUIT&&this.data.cardSuit!==t.cardSuit||this.type===cleverapps.DailyTask.COLLECT_HERO_CELLS&&this.data.color!==t.color||e!==this.progress&&(this.progress=Math.min(e,this.goal),this.onUpdateListener(),this.save(),this.isFinished()&&(cleverapps.playSession.inc(cleverapps.EVENTS.SESSION_DAILY_TASK_FINISH),cleverapps.history.add("d"+this.level,1),
this.type===cleverapps.DailyTask.LIKE_PAGE&&cleverapps.serverFlags.setFlag(cleverapps.ServerFlags.PAGE_LIKED)))},cleverapps.DailyTask.prototype.isFinished=function(){return this.progress>=this.goal},cleverapps.DailyTask.prototype.getLevel=function(){return this.level},cleverapps.DailyTask.prototype.run=function(){var e=function(){cleverapps.metha.distract({focus:"DailyTaskRunLevel",action:function(e){cleverapps.metha.wantsToPlay(e,{dailyTask:!0})}})};switch(this.type){case cleverapps.DailyTask.LOGIN_FACEBOOK:cleverapps.social.checkConnection(this.setProgress.bind(this,1));break;case cleverapps.DailyTask.LIKE_PAGE:cleverapps.social.joinGroup?cleverapps.social.joinGroup(function(e){e===cleverapps.Social.CODE_SUCCEED&&(cc.sys.openURL(cleverapps.bySource(cleverapps.config.helpURL)),this.setProgress(1))}.bind(this)):(cc.sys.openURL(cleverapps.bySource(cleverapps.config.helpURL)),this.setProgress(1));break;case cleverapps.DailyTask.SHARE:var t=cleverapps.ShareBonus.cycleShareData("share")
;cleverapps.social.shareDialog(t,function(e){e===cleverapps.Social.CODE_SUCCEED&&(cleverapps.history.add("share",1),this.setProgress(1))}.bind(this));break;case cleverapps.DailyTask.INVITE_FRIENDS:cleverapps.history.add("invt",1),cleverapps.social.inviteFriends({message:Messages.get("SettingsWindow.InviteFriends.message"),title:Messages.get("SettingsWindow.InviteFriends.title")},function(e,t){e===cleverapps.Social.CODE_SUCCEED&&this.addProgress(1)}.bind(this));break;case cleverapps.DailyTask.SEND_FRIEND_HELP:levels.friendRequests.existRequestTypes(levels.FriendRequest.SENT_HELP_REQUESTS)&&new FriendRequestsWindow;break;case cleverapps.DailyTask.SPEND_COINS:e();break;case cleverapps.DailyTask.WATCH_ADS:cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED);break;case cleverapps.DailyTask.TOURNAMENT_WIN:var i=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_BACKGROUND);("olympics"===cleverapps.config.name||i&&i.tournament)&&e();break
;case cleverapps.DailyTask.RECEIVE_PERIODIC_BONUS:cleverapps.periodicBonus.openWindow();break;case cleverapps.DailyTask.PLAY_BONUS_ROUND:cleverapps.metha.distract({focus:"DailyTaskRunBonusRound",action:function(e){cleverapps.bonusRoundChest.locked?cleverapps.Notification.create("messages:BonusRound.ClosedText"):cleverapps.bonusRoundChest.open(e)}});break;default:e()}},cleverapps.DailyTask.prototype.collect=function(){this.isFinished()&&!this.collected&&(this.collected=!0,this.save(),this.onUpdateListener(),cleverapps.missionManager.dispatchEvent(Mission.EVENT_COMPLETE_DAILY_TASK))},cleverapps.DailyTask.prototype.expire=function(){this.isFinished()||(this.expired=!0,this.onUpdateListener())},cleverapps.DailyTask.prototype.givePrize=function(){this.isFinished()&&new DailyTaskRewardWindow(this)},cleverapps.DailyTask.prototype.save=function(){cleverapps.dailyTasks.save()},cleverapps.DailyTask.prototype.getTitle=function(){var e={};return cleverapps.DailyTask.USE_BOOSTER===this.type&&(
e.booster=Messages.get("Boosters."+this.data.booster+".Title")),cleverapps.DailyTask.COLLECT_COLOR_CELLS===this.type&&(e.color=Messages.get("ColorCell."+this.data.color+".Title")),cleverapps.DailyTask.COLLECT_SPECIAL_CELLS===this.type&&(e.elements=Messages.get("DailyTask.14.Element."+this.data.cell_code)),cleverapps.DailyTask.GUESS_WORDS_WITH_LETTER===this.type&&this.data.letter&&(e.letter=this.data.letter.toUpperCase()),cleverapps.DailyTask.COLLECT_HERO_CELLS===this.type&&(e.heroes=Messages.get("DailyTask.24."+this.data.color)),cleverapps.DailyTask.COLLECT_CARDS_BY_VALUE===this.type&&(e.cards=Messages.get("DailyTask.25."+this.data.cardValue)),cleverapps.DailyTask.COLLECT_CARDS_BY_SUIT===this.type&&(e.cards=Messages.get("DailyTask.26."+this.data.cardSuit)),{text:"messages:DailyTask."+this.type+".Title",replace:e}},cleverapps.DailyTask.getIcon=function(e,t){if(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS===e)switch(t.cell_code){case FishCell.GOAL_ID:return new cc.Sprite(
bundles.game.frames.cell_fish);case FlowerCell.GOAL_ID:return new cc.Sprite(bundles.game.frames.flower_cell_3);case NutCell.GOAL_ID:return new cc.Sprite(bundles.game.frames.nut_cell_1);case Mark.GOAL_ID:return new cc.Sprite(bundles.game.frames.mark_goal);case MouseCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_mouse_png);case IceTile.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_ice_png);case DragonCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_dragon_png);case CookieManCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_cookieman_png);case CakeCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_cake_png);case MuffinGoalCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_muffin_png);case WaffleCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_waffles_png);case LollipopCell.GOAL_ID:return new cc.Sprite(
bundles.dailytasks.frames.daily_task_cell_lollipop_png);case ColorCookieManCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_colorcookieman_png);case TruffleCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_truffle_png);case DogCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_dog_png)}var i="daily_task_icon_"+e;if(cleverapps.DailyTask.USE_BOOSTER===e&&(i+="_"+t.booster),cleverapps.DailyTask.COLLECT_COLOR_CELLS===e&&(i+="_"+t.color),cleverapps.DailyTask.COLLECT_HERO_CELLS===e&&(i+="_"+t.color),cleverapps.DailyTask.GUESS_WORDS_WITH_LETTER===e)return new CharView(t.letter.toUpperCase());if(cleverapps.DailyTask.COLLECT_CARDS_BY_VALUE===e)switch(t.cardValue){case"t":return new cc.Sprite(bundles.dailytasks.frames.daily_task_icon_t);case"j":return new cc.Sprite(bundles.dailytasks.frames.daily_task_icon_j);case"q":return new cc.Sprite(bundles.dailytasks.frames.daily_task_icon_q);case"k":return new cc.Sprite(
bundles.dailytasks.frames.daily_task_icon_k);case"a":return new cc.Sprite(bundles.dailytasks.frames.daily_task_icon_a)}if(cleverapps.DailyTask.COLLECT_CARDS_BY_SUIT===e)switch(t.cardSuit){case"c":return new cc.Sprite(bundles.dailytasks.frames.daily_task_icon_c);case"d":return new cc.Sprite(bundles.dailytasks.frames.daily_task_icon_d);case"h":return new cc.Sprite(bundles.dailytasks.frames.daily_task_icon_h);case"s":return new cc.Sprite(bundles.dailytasks.frames.daily_task_icon_s)}return i+="_png",new cc.Sprite(bundles.dailytasks.frames[i])},cleverapps.DailyTask.prototype.getIcon=function(){return cleverapps.DailyTask.getIcon(this.type,this.data)},cleverapps.DailyTask.Create=function(e){var t=new cleverapps.DailyTask(e.type,e.goal,e.data,cleverapps.DailyTask.LEVEL[e.level]);return t.progress=0<e.progress?e.progress:0,t.collected=e.collected,t},cleverapps.DailyTask.LOGIN_FACEBOOK=0,cleverapps.DailyTask.LIKE_PAGE=1,cleverapps.DailyTask.SHARE=2,cleverapps.DailyTask.INVITE_FRIENDS=3,
cleverapps.DailyTask.PASS_LEVEL=4,cleverapps.DailyTask.COLLECT_STARS=5,cleverapps.DailyTask.SEND_FRIEND_HELP=6,cleverapps.DailyTask.WATCH_ADS=7,cleverapps.DailyTask.USE_MULTI_COLOR_CELL=8,cleverapps.DailyTask.USE_BOOSTER=9,cleverapps.DailyTask.COLLECT_COLOR_CELLS=10,cleverapps.DailyTask.PASS_LEVELS_IN_ROW=11,cleverapps.DailyTask.LEVEL_CHAMPION=12,cleverapps.DailyTask.SPEND_COINS=13,cleverapps.DailyTask.COLLECT_SPECIAL_CELLS=14,cleverapps.DailyTask.GUESS_EXTRA_WORDS=15,cleverapps.DailyTask.GUESS_WORDS_WITH_LETTER=16,cleverapps.DailyTask.USE_HINTS=17,cleverapps.DailyTask.TOURNAMENT_WIN=18,cleverapps.DailyTask.FINISH_EPISODE=19,cleverapps.DailyTask.RECEIVE_PERIODIC_BONUS=20,cleverapps.DailyTask.BEAT_FRIEND=22,cleverapps.DailyTask.PLAY_BONUS_ROUND=23,cleverapps.DailyTask.COLLECT_HERO_CELLS=24,cleverapps.DailyTask.COLLECT_CARDS_BY_VALUE=25,cleverapps.DailyTask.COLLECT_CARDS_BY_SUIT=26,cleverapps.DailyTask.COLLECT_JOKERS_USING_COMBO=27,cleverapps.DailyTask.LEVEL=["low","mid","hard"],
cleverapps.DailyTasks=function(e){this.onChangeStateListener=function(){},cleverapps.config.debugMode&&(cleverapps.DailyTasks.DURATION="60 seconds"),this.tasks=[],e?(this.whenStart=-1,this.order=0,this.save()):this.load()},cleverapps.DailyTasks.prototype.getInfo=function(){return{whenStart:this.whenStart,order:this.order,tasks:this.tasks.map(function(e){return e.getSaveInfo()})}},cleverapps.DailyTasks.prototype.processFinishState=function(){this.finishTimeout&&(this.finishTimeout.clear(),delete this.finishTimeout);var e=this.getTimeLeft();0<e?this.finishTimeout=new cleverapps.LongTimeout(this.processFinishState.bind(this),e):this.onChangeStateListener()},cleverapps.DailyTasks.prototype.load=function(e){var t=e||cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.DAILY_TASKS)||{};this.whenStart=void 0!==t.whenStart?t.whenStart:-1,this.order=void 0!==t.order?t.order:0,this.whenStart>Date.now()&&(this.whenStart=Date.now()),t.tasks&&t.tasks.length===cleverapps.DailyTasks.ACTIVE_TASKS&&(
this.tasks=t.tasks.map(function(e,t){return e.level=t,cleverapps.DailyTask.Create(e)})),this.processFinishState()},cleverapps.DailyTasks.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.DAILY_TASKS,this.getInfo()),this.onChangeStateListener(),!1!==e&&this.updateServer()},cleverapps.DailyTasks.UPDATE_SERVER_INTERVAL="1 minute",cleverapps.DailyTasks.prototype.updateServer=cleverapps.timeredThrottle(cleverapps.parseInterval(cleverapps.DailyTasks.UPDATE_SERVER_INTERVAL),function(){cleverapps.synchronizer.addUpdateTask("dailytasks")}),cleverapps.DailyTasks.prototype.collect=function(e){e.collect(),this.sendActivity()},cleverapps.DailyTasks.prototype.collectFinishedTasks=function(e){var t=this.getNotCollectedTasks(),i=cleverapps.once(this.sendActivity);this.tasks=[],e&&this.openWindow(),t.forEach(function(e){e.givePrize(),i()},this),this.save()},cleverapps.DailyTasks.prototype.processResults=function(){this.isRunning()?0===this.tasks.length&&this.startNew(
):0===this.tasks.length?this.startNew():this.getActiveTasks().forEach(function(e){e.expire()})},cleverapps.DailyTasks.prototype.startNew=function(){this.provider||(this.provider=new cleverapps.DailyTasksProvider),this.tasks=this.provider.generateTasks(this.order),this.startGeneratedTasks()},cleverapps.DailyTasks.prototype.startGeneratedTasks=function(){this.order++,this.whenStart=Date.now(),this.save(),this.processFinishState(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_TASKS_START)},cleverapps.DailyTasks.prototype.sendActivity=function(){cleverapps.social.sendActivity&&cleverapps.social.sendActivity(cleverapps.Social.ACTIVITY.DAILY_TASK,{userName:cleverapps.friends.getPlayer().name})},cleverapps.DailyTasks.prototype.getNotCollectedTasks=function(){return this.tasks.filter(function(e){return e.isFinished()&&!e.collected})},cleverapps.DailyTasks.prototype.getActiveTasks=function(){return this.tasks.filter(function(e){return!e.isFinished()})},
cleverapps.DailyTasks.prototype.getTaskByType=function(t){var i;return this.getActiveTasks().forEach(function(e){e.type===t&&(i=e)}),i},cleverapps.DailyTasks.prototype.addProgress=function(e,t,i){var s=this.getTaskByType(e);s&&s.addProgress(t,i)},cleverapps.DailyTasks.prototype.setProgress=function(e,t,i){var s=this.getTaskByType(e);s&&s.setProgress(t,i)},cleverapps.DailyTasks.prototype.getTimeLeft=function(){return this.whenStart+cleverapps.parseInterval(cleverapps.DailyTasks.DURATION)-Date.now()},cleverapps.DailyTasks.prototype.isRunning=function(){return 0<this.getTimeLeft()},cleverapps.DailyTasks.prototype.getTasks=function(){return this.tasks},cleverapps.DailyTasks.prototype.onDiscoverWord=function(e){this.processDiscoverWordWithLetter(e)},cleverapps.DailyTasks.prototype.onDiscoverExtraWord=function(e){this.addProgress(cleverapps.DailyTask.GUESS_EXTRA_WORDS),this.processDiscoverWordWithLetter(e)},cleverapps.DailyTasks.prototype.processDiscoverWordWithLetter=function(e){
cleverapps.unique(e.split("")).forEach(function(e){cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.GUESS_WORDS_WITH_LETTER,1,{letter:e})})},cleverapps.DailyTasks.prototype.processOpenCard=function(e,t){this.addProgress(cleverapps.DailyTask.COLLECT_CARDS_BY_VALUE,1,{cardValue:Card.VALUES[e.value]}),this.addProgress(cleverapps.DailyTask.COLLECT_CARDS_BY_SUIT,1,{cardSuit:e.suit}),t instanceof Wildcard&&this.addProgress(cleverapps.DailyTask.USE_HINTS)},cleverapps.DailyTasks.ACTIVE_TASKS=3,cleverapps.DailyTasks.DURATION="1 day",cleverapps.DailyTasksProvider=function(){this.tasks=[];var e=cleverapps.social.isLoggedIn.bind(cleverapps.social),t=function(e){return levels.user.getProgress()>=e},i=function(){cleverapps.friends.listFriends().length},s=cleverapps.User.calcSource();if(this.register(cleverapps.DailyTask.LOGIN_FACEBOOK,{low:1,active:function(){return!cleverapps.flags.nologin&&!e()&&"facebook"===cleverapps.social.getCode()}}),cleverapps.ShareBonus.IsRewardAvailable()&&(
this.register(cleverapps.DailyTask.LIKE_PAGE,{low:1,active:function(){return!cleverapps.flags.nocommunity&&!cleverapps.serverFlags.hasFlag(cleverapps.ServerFlags.PAGE_LIKED)}}),this.register(cleverapps.DailyTask.INVITE_FRIENDS,{mid:1,active:e}),"android"!==s&&"amazon"!==s&&this.register(cleverapps.DailyTask.SHARE,{low:1,active:e})),this.register(cleverapps.DailyTask.SEND_FRIEND_HELP,{low:1,active:function(){return!cleverapps.flags.noviral&&levels.friendRequests.existRequestTypes(levels.FriendRequest.SENT_HELP_REQUESTS)}}),this.register(cleverapps.DailyTask.WATCH_ADS,{low:cleverapps.flags.reduceAds?10:2,mid:cleverapps.flags.reduceAds?20:10,hard:cleverapps.flags.reduceAds?60:30,active:function(){var e=cleverapps.toolbar.getItem(ToolbarItem.REWARDED_VIDEO);return!cleverapps.flags.noads&&levels.user.checkAvailable(RewardedAdsManager.AVAILABLE)&&RewardedAdsManager.IsEnabled()&&e&&e.isAvailable()}}),this.register(cleverapps.DailyTask.SPEND_COINS,{mid:500,hard:1500}),
"board"===cleverapps.config.type){this.register(cleverapps.DailyTask.PASS_LEVEL,{low:1,mid:5,hard:10}),this.register(cleverapps.DailyTask.GUESS_EXTRA_WORDS,{low:2,mid:10,hard:30}),this.register(cleverapps.DailyTask.USE_HINTS,{low:2,mid:10,hard:25}),cleverapps.metha.getType()===Metha.HOSE&&this.register(cleverapps.DailyTask.FINISH_EPISODE,{mid:1,hard:3,active:function(){return levels.user.level<5}}),this.register(cleverapps.DailyTask.TOURNAMENT_WIN,{low:1,mid:2,hard:8,active:function(){var e=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_BACKGROUND);return cleverapps.isKnockoutGame()||e&&e.tournament}}),this.register(cleverapps.DailyTask.RECEIVE_PERIODIC_BONUS,{low:1,mid:1}),this.register(cleverapps.DailyTask.BEAT_FRIEND,{mid:1,active:i}),this.register(cleverapps.DailyTask.PLAY_BONUS_ROUND,{low:1,active:function(){return cleverapps.bonusRoundChest&&!cleverapps.bonusRoundChest.locked}});var n=["t","a","o","i","n","s","h","r"],o=["d","l","c","u","m","w","g","y","p"]
;cleverapps.settings.language===cc.sys.LANGUAGE_RUSSIAN?(n=["","","","","","","",""],o=["","","","","","","","",""]):cleverapps.settings.language===cc.sys.LANGUAGE_JAPANESE&&(n=["","","","","","","",""],o=["","","","","","","","",""]),n.forEach(function(e){this.register(cleverapps.DailyTask.GUESS_WORDS_WITH_LETTER,{low:3,mid:15,letter:e})}.bind(this)),o.forEach(function(e){this.register(cleverapps.DailyTask.GUESS_WORDS_WITH_LETTER,{low:5,mid:15,letter:e})}.bind(this))}else"solitaire"===cleverapps.config.type?(this.register(cleverapps.DailyTask.PASS_LEVEL,{low:1,mid:5,hard:10}),this.register(cleverapps.DailyTask.USE_HINTS,{low:2,mid:10,hard:25}),Card.VALUES.slice(8).forEach(function(e){this.register(cleverapps.DailyTask.COLLECT_CARDS_BY_VALUE,{low:5,mid:10,hard:15,cardValue:e})}.bind(this)),Card.SUITS.forEach(function(e){this.register(cleverapps.DailyTask.COLLECT_CARDS_BY_SUIT,{low:10,mid:25,hard:50,cardSuit:e})}.bind(this)),this.register(
cleverapps.DailyTask.COLLECT_JOKERS_USING_COMBO,{low:5,mid:10,hard:15})):"differences"===cleverapps.config.type?(this.register(cleverapps.DailyTask.PASS_LEVEL,{low:1,mid:5,hard:10}),this.register(cleverapps.DailyTask.USE_HINTS,{low:2,mid:10,hard:25}),this.register(cleverapps.DailyTask.RECEIVE_PERIODIC_BONUS,{low:1,mid:1})):"match3"===cleverapps.config.type&&(this.register(cleverapps.DailyTask.PASS_LEVEL,{low:2,mid:10,hard:25}),this.register(cleverapps.DailyTask.COLLECT_STARS,{low:3,mid:20,hard:50}),this.register(cleverapps.DailyTask.USE_MULTI_COLOR_CELL,{low:3,mid:10,hard:30}),this.register(cleverapps.DailyTask.USE_BOOSTER,{low:2,mid:5,hard:10,booster:CellBooster.ID}),this.register(cleverapps.DailyTask.USE_BOOSTER,{low:2,mid:4,hard:8,booster:LineBooster.ID}),this.register(cleverapps.DailyTask.USE_BOOSTER,{mid:3,hard:7,booster:ColorBooster.ID}),this.register(cleverapps.DailyTask.COLLECT_COLOR_CELLS,{low:50,mid:500,color:"a"}),this.register(cleverapps.DailyTask.COLLECT_COLOR_CELLS,{
low:50,mid:500,color:"b"}),this.register(cleverapps.DailyTask.COLLECT_COLOR_CELLS,{low:50,mid:500,color:"c"}),this.register(cleverapps.DailyTask.COLLECT_COLOR_CELLS,{low:50,mid:500,color:"d"}),this.register(cleverapps.DailyTask.COLLECT_COLOR_CELLS,{low:50,mid:500,color:"e"}),this.register(cleverapps.DailyTask.COLLECT_COLOR_CELLS,{low:50,mid:500,color:"w"}),this.register(cleverapps.DailyTask.PASS_LEVELS_IN_ROW,{mid:5,hard:10}),this.register(cleverapps.DailyTask.LEVEL_CHAMPION,{mid:1,hard:3,active:i}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{mid:20,hard:50,cell_code:FishCell.GOAL_ID,active:t.bind(this,16)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{low:10,mid:50,hard:150,cell_code:FlowerCell.GOAL_ID,active:t.bind(this,23)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{low:20,mid:100,hard:300,cell_code:NutCell.GOAL_ID,active:t.bind(this,31)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{low:20,mid:100,hard:300,
cell_code:Mark.GOAL_ID,active:t.bind(this,76)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{mid:5,hard:15,cell_code:MouseCell.GOAL_ID,active:t.bind(this,91)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{low:30,mid:150,hard:500,cell_code:IceTile.GOAL_ID,active:t.bind(this,151)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{mid:5,hard:15,cell_code:DragonCell.GOAL_ID,active:t.bind(this,181)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{mid:20,hard:50,cell_code:CookieManCell.GOAL_ID,active:t.bind(this,196)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{mid:50,hard:150,cell_code:CakeCell.GOAL_ID,active:t.bind(this,376)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{low:20,mid:100,hard:300,cell_code:MuffinGoalCell.GOAL_ID,active:t.bind(this,406)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{low:20,mid:100,hard:300,cell_code:WaffleCell.GOAL_ID,active:t.bind(this,526)}),this.register(
cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{low:20,mid:100,hard:300,cell_code:LollipopCell.GOAL_ID,active:t.bind(this,616)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{mid:5,hard:15,cell_code:DogCell.GOAL_ID,active:t.bind(this,706)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{low:10,mid:50,hard:150,cell_code:TruffleCell.GOAL_ID,active:t.bind(this,736)}),this.register(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,{low:20,mid:100,hard:300,cell_code:ColorCookieManCell.GOAL_ID,active:t.bind(this,766)}),this.register(cleverapps.DailyTask.COLLECT_HERO_CELLS,{low:5,mid:25,hard:75,color:"a"}),this.register(cleverapps.DailyTask.COLLECT_HERO_CELLS,{low:5,mid:25,hard:75,color:"b"}),this.register(cleverapps.DailyTask.COLLECT_HERO_CELLS,{low:5,mid:25,hard:75,color:"c"}),this.register(cleverapps.DailyTask.COLLECT_HERO_CELLS,{low:5,mid:25,hard:75,color:"d"}),this.register(cleverapps.DailyTask.COLLECT_HERO_CELLS,{low:5,mid:25,hard:75,color:"e"}),this.register(
cleverapps.DailyTask.COLLECT_HERO_CELLS,{low:5,mid:25,hard:75,color:"w"}),cleverapps.DailyTasksProvider.TASKS_BY_ORDER={0:{low:cleverapps.DailyTask.USE_MULTI_COLOR_CELL,mid:cleverapps.DailyTask.USE_BOOSTER,hard:cleverapps.DailyTask.PASS_LEVELS_IN_ROW}})},cleverapps.DailyTasksProvider.prototype.register=function(e,t){var i=new cleverapps.DailyTaskDefinition(e,t);this.tasks.push(i)},cleverapps.DailyTasksProvider.prototype.getActiveTasksList=function(){return this.tasks.filter(function(t){try{return"function"==typeof t.active?t.active():!1!==t.active}catch(e){throw cleverapps.ReportStream.debug("DailyTasksProvider type = "+t.type+" "+e.message),e}})},cleverapps.DailyTasksProvider.prototype.generateTasks=function(s){var t,i,e,n=this.getActiveTasksList(),o=function(e){var t=e.map(function(e){return e.type});t=cleverapps.unique(t),cleverapps.Random.seed(s);var i=cleverapps.Random.choose(t);return 0<=t.indexOf(cleverapps.DailyTask.LOGIN_FACEBOOK)&&cleverapps.Random.nextDouble()<.3&&(
i=cleverapps.DailyTask.LOGIN_FACEBOOK),void 0!==cleverapps.DailyTasksProvider.CHOOSE_TYPE&&-1!==t.indexOf(cleverapps.DailyTasksProvider.CHOOSE_TYPE)&&(i=cleverapps.DailyTasksProvider.CHOOSE_TYPE),e=e.filter(function(e){return e.type===i}),cleverapps.Random.choose(e)};if(void 0!==cleverapps.DailyTasksProvider.TASKS_BY_ORDER[s])t=n.filter(function(e){return e.type===cleverapps.DailyTasksProvider.TASKS_BY_ORDER[s].low})[0].createTask("low"),i=n.filter(function(e){return e.type===cleverapps.DailyTasksProvider.TASKS_BY_ORDER[s].mid})[0].createTask("mid"),e=n.filter(function(e){return e.type===cleverapps.DailyTasksProvider.TASKS_BY_ORDER[s].hard})[0].createTask("hard");else{var a=n.filter(function(e){return e.low});t=o(a).createTask("low");var r=n.filter(function(e){return e.mid&&e.type!==t.type});i=o(r).createTask("mid"),e=o(n.filter(function(e){return e.hard&&e.type!==t.type&&e.type!==i.type})).createTask("hard")}return[t,i,e]},cleverapps.DailyTasksProvider.TASKS_BY_ORDER={},
cleverapps.DailyTasksProvider.CHOOSE_TYPE=void 0,cleverapps.DailyTaskDefinition=function(e,t){t=t||{},this.type=e,this.active=t.active,this.low=t.low,this.mid=t.mid,this.hard=t.hard,this.data=t},cleverapps.DailyTaskDefinition.prototype.createTask=function(e){var t=this.data[e],i={color:this.data.color,booster:this.data.booster,cell_code:this.data.cell_code,letter:this.data.letter,cardValue:this.data.cardValue,cardSuit:this.data.cardSuit};return new cleverapps.DailyTask(this.type,t,i,e)};var DailyTasksWindow=Window.extend({onWindowLoaded:function(){this.createContent();var e=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.DailyTasksWindow,!0);this._super({name:"dailytaskswindow",title:cleverapps.dailyTasks.isRunning()?"messages:DailyTasksWindow.title":"messages:DailyTasksWindow.finished.title",content:this.content,styles:e}),this.content.baseScale=this.content.scale,cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_TASKS_OPEN_WINDOW),
cleverapps.playSession.set(cleverapps.EVENTS.SESSION_DAILY_TASK_OPEN_WINDOW,!0),cleverapps.audio.playSound(res.window_effect)},createContent:function(){cleverapps.dailyTasks.processResults();var e=[];e.push(this.createBottom()),e.push(this.createTasks());var t=cleverapps.styles.DailyTasksWindow.content,i=new cleverapps.Layout(e,{direction:cleverapps.UI.VERTICAL,y:t.offsetY,margin:t.margin,padding:t.padding});this.content?this.content.innerContent&&this.content.innerContent.removeFromParent():(this.content=new cc.Node,this.content.setContentSize2(i.getContentSize())),this.window&&this.setTitle(Messages.get(cleverapps.dailyTasks.isRunning()?"messages:DailyTasksWindow.title":"messages:DailyTasksWindow.finished.title")),this.content.innerContent=i,this.content.addChild(i),i.setAnchorPoint2(.5,1),i.setPositionRound(0,this.content.height/2)},createBottom:function(){var e,t=new cc.Node;return t.setAnchorPoint2(),t.setContentSize2(cleverapps.styles.DailyTasksWindow.content.bottom),
e=cleverapps.dailyTasks.isRunning()?this.createTimer():this.createRefreshButton(),t.addChild(e),e.setPosition(t.width/2,t.height/2),t.setCascadeOpacityEnabled(!0),e.setCascadeOpacityEnabled(!0),this.bottomContent=t},createTimer:function(){var e=cleverapps.styles.DailyTasksWindow.timer,t=cleverapps.dailyTasks.getTimeLeft(),i=this.countDown=new cleverapps.CountDown(t,{onFinish:function(){this.createContent()}.bind(this)}),s={font:cleverapps.styles.FONTS.DAILY_TASK_TIMER_TEXT||e.timerFont,timerPosition:e.timerPosition};bundles.main.frames.missions_item_bg_png&&(s.background_content=cleverapps.UI.createScale9Sprite(bundles.main.frames.daily_task_timer_bg_png||e.bg),s.background_content.setContentSize2(e.width,e.height));var n=new cleverapps.CountDownView(i,s),o=cleverapps.UI.generateTTFText("messages:DailyTasksWindow.TimeToRefresh",e.font);o.fitTo(e.text.width);var a=[o,n];if(e.direction===cleverapps.UI.VERTICAL&&a.reverse(),n.setCascadeOpacityEnabled(!0),
bundles.main.frames.daily_task_timer_icon_png){var r=new cc.Sprite(bundles.main.frames.daily_task_timer_icon_png);n.addChild(r),r.setPositionRound(e.icon),r.setScale(e.icon.scale||1)}return this.timer=new cleverapps.Layout(a,{direction:e.direction,margin:e.margin}),n.setCascadeOpacityEnabled(this.timer),this.timer},createTasks:function(){var s=[],n=cleverapps.dailyTasks.tasks;n.forEach(function(e,t){"function"!=typeof e.getLevel&&(cleverapps.ReportStream.debug(["task get level is not a function","tasks - "+JSON.stringify(cleverapps.dailyTasks.getInfo()),"current task type - "+typeof e,"keys of tasks "+Object.keys(n),"level "+t]),cleverapps.ReportStream.debug(["task "+e]));var i=new DailyTaskView(e,this.close.bind(this));s.push(i)},this),this.taskViews=cleverapps.clone(s);var e=cleverapps.styles.DailyTasksWindow.tasks,t=new cleverapps.Layout(s.reverse(),{direction:cleverapps.UI.VERTICAL,margin:e.margin}),i=new ccui.Layout;i.setAnchorPoint2(),i.setContentSize2(t.width+e.crop.dx,
t.height+e.crop.dy),i.setClippingEnabled(!0),i.addChild(t),t.setPositionRound(i.width/2,i.height/2);var o=new cc.Node;return o.setAnchorPoint2(),o.setContentSize2(t.getContentSize()),i.setPositionRound(o.width/2,o.height/2),o.addChild(i),o},createRefreshButton:function(){var e=cleverapps.styles.DailyTasksWindow;return new cleverapps.UI.Button({width:e.button.width,height:e.button.height,text:Messages.get("DailyTasksWindow.Refresh"),font:cleverapps.styles.FONTS.BUTTON_TEXT,padding:{x:e.button.paddingX},onClicked:this.refresh.bind(this)})},hideOneTask:function(e,t,i){e.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.Spawn(new cc.MoveBy(.5,cc.p(-e.width,0)).easing(cc.easeBackIn()),new cc.Sequence(new cc.DelayTime(.25),new cc.FadeOut(.25))),new cc.CallFunc(i)))},showOneTask:function(e,t,i){e.setVisible(!1),e.setScale(0),e.setOpacity(0),e.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.CallFunc(function(){e.setVisible(!0),e.onShowAnimation()}),new cc.Spawn(new cc.ScaleTo(.5,1
).easing(cc.easeBackOut()),new cc.FadeIn(.25)),new cc.CallFunc(i)))},hideTasks:function(e){var t=0,i=function(){++t===this.taskViews.length&&e()}.bind(this);this.taskViews.forEach(function(e,t){this.hideOneTask(e,.3*t,i)},this)},showTasks:function(e){var t=0,i=function(){++t===this.taskViews.length&&e()}.bind(this);this.taskViews.forEach(function(e,t){this.showOneTask(e,.3*t,i)},this)},refresh:function(){0===cleverapps.dailyTasks.getNotCollectedTasks().length?(this.bottomContent.runAction(new cc.ScaleTo(.2,0)),this.hideTasks(function(){cleverapps.dailyTasks.startNew(),this.createContent(),this.bottomContent.setVisible(!1),this.showTasks(function(){this.bottomContent.setVisible(!0),this.bottomContent.setOpacity(0),this.bottomContent.runAction(new cc.FadeIn(.3))}.bind(this))}.bind(this))):(cleverapps.dailyTasks.isRunning()||cleverapps.dailyTasks.collectFinishedTasks(),this.createContent())},close:function(){cleverapps.dailyTasks.isRunning()||cleverapps.dailyTasks.collectFinishedTasks(),
this._super()}});DailyTasksWindow.prototype.listBundles=function(){return"match3"===cleverapps.config.type?["game","heroes","dailytasks"]:["dailytasks"]},cleverapps.styles.DailyTasksWindow={button:{width:350,height:100,paddingX:10},tasks:{margin:20,crop:{dx:0,dy:150}},content:{margin:30,bottom:{width:500,height:100},padding:{x:-40,y:0}},timer:{direction:cleverapps.UI.HORIZONTAL,bg:res.missions_item_bg_png,width:240,height:70,margin:10,timerPosition:{x:0,y:-4},font:cleverapps.styles.FONTS.WINDOW_TEXT,timerFont:cleverapps.styles.FONTS.TEXT,text:{width:450}},contentOffset:-60};var DailyTaskView=cc.Node.extend({ctor:function(e,t){this._super(),this.task=e;var i=cleverapps.styles.DailyTaskView;this.setContentSize2(i.width,i.height),this.setAnchorPoint2(),this.setLocalZOrder(i.localZOrder["level_"+e.getLevel()].zOrder),this.addBackground(),this.addTitle(),this.addPresent(),this.addIcon(),-1!==["scramble","differences","wordsoup","tripeaks"].indexOf(cleverapps.config.name
)?this.addProgressBar():(this.addProgressCounter(),this.addBackgroundTop()),this.addCheckMark(),this.addRewardButton(t),this.addPlayButton(t),this.setCascadeOpacityEnabled(!0)},onShowAnimation:function(){var e=this.icon.getScale();this.icon.setScale(.7*e);var t=this.playButton.getScale();this.playButton.setScale(.7*t);var i=this.rewardButton.getScale();this.rewardButton.setScale(.7*i),this.icon.runAction(new cc.Sequence(new cc.ScaleTo(.5,1.2*e),new cc.ScaleTo(.4,e).easing(cc.easeBackOut()))),this.playButton.runAction(new cc.Sequence(new cc.ScaleTo(.5,1.2*t),new cc.ScaleTo(.4,t).easing(cc.easeBackOut()))),this.rewardButton.runAction(new cc.Sequence(new cc.ScaleTo(.5,1.2*i),new cc.ScaleTo(.4,i).easing(cc.easeBackOut())))},onEnterTransitionDidFinish:function(){this._super(),this.task.onUpdateListener=this.createListener(this.onUpdate.bind(this)),this.onUpdate()},getColoredFont:function(e,t){var i=cleverapps.styles.DailyTaskView;return i.fontColors&&(e.stroke={size:2,
color:i.fontColors[t.level]}),e},getBackgroundImage:function(){if(bundles.dailytasks.frames.daily_task_bg_png)return bundles.dailytasks.frames.daily_task_bg_png;var e=this.task.getLevel();return"low"===e?bundles.dailytasks.frames.missions_easy_bg_png:"mid"===e?bundles.dailytasks.frames.missions_medium_bg_png:"hard"===e?bundles.dailytasks.frames.missions_hard_bg_png:void 0},addBackground:function(){var e=this.background=cleverapps.UI.createScale9Sprite(this.getBackgroundImage());e.setContentSize2(this.getContentSize()),e.setPositionRound(this.width/2,this.height/2),this.addChild(e)},addRewardButton:function(){var e=cleverapps.styles.DailyTaskView,t=cleverapps.UI.generateTTFText("messages:DailyTaskView.Get",cleverapps.styles.FONTS.DAILY_TASK_BUTTON_TEXT),i=this.rewardButton=new cleverapps.UI.Button({width:e.button.width,height:e.button.height,button_png:e.button_png,button_on_png:e.button_on_png,content:t,onClicked:function(){new DailyTaskRewardWindow(this.task)}.bind(this)})
;i.setPositionRound(e.button.x,e.button.y),this.addChild(i),i.setScale(e.button.scale),i.baseScale=i.scale,i.setCascadeOpacityEnabled(!0),i.setLocalZOrder(1)},addPlayButton:function(e){var t=cleverapps.styles.DailyTaskView;t=t.playButton?t.playButton:t.button;var i=cleverapps.UI.generateTTFText("messages:DailyTaskView.Go",cleverapps.styles.FONTS.DAILY_TASK_BUTTON_TEXT),s=this.playButton=new cleverapps.UI.Button({width:t.width,height:t.height,button_png:t.button_png,button_on_png:t.button_on_png,content:i,onClicked:function(){e(),this.task.run()}.bind(this)});this.addChild(s),s.setPositionRound(t.x,t.y),s.setScale(t.scale),s.baseScale=s.scale,s.setCascadeOpacityEnabled(!0),s.setLocalZOrder(1)},addProgressBar:function(){var e=cleverapps.styles.DailyTaskView.progressBar;this.progressBar=new ScaledProgressBar(bundles.dailytasks.frames.daily_task_bar_png),this.progressBar.setDimension(e.width,e.height),this.progressBar.setPercentage(0),this.progressBar.setMinWidth(e.minWidth)
;var t=new cc.Scale9Sprite(bundles.dailytasks.frames.daily_task_bar_bg_png);t.setContentSize2(e.width+e.bg.padding.x,e.height+e.bg.padding.y),t.addChild(this.progressBar),t.setCascadeOpacityEnabled(!0),this.progressBar.setPositionRound(e.offsetX,e.offsetY),this.progressBarText=cleverapps.UI.generateTTFText(this.task.progress+" / "+this.task.goal,cleverapps.styles.FONTS.DAILY_TASK_PROGRESS_FONT),t.addChild(this.progressBarText),this.progressBarText.setPositionRound(e.text),this.addChild(t),t.setPositionRound(e)},addProgressCounter:function(){var e=cleverapps.styles.DailyTaskView,t=this.getColoredFont(cleverapps.styles.FONTS.DAILY_TASK_PROGRESS_FONT||e.progress.font,this.task);100<=this.task.progress&&(t=this.getColoredFont(cleverapps.styles.FONTS.DAILY_TASK_PROGRESS_SMALL_FONT||e.progress.fontSmall,this.task));var i=this.progressCounter=cleverapps.UI.generateTTFText(this.task.progress+" / "+this.task.goal,t);i.setAnchorPoint2(),i.setPosition(e.progress.x,e.progress.y),this.addChild(i)},
addTitle:function(){var e=cleverapps.styles.DailyTaskView,t=this.task.getTitle(),i=this.title=cleverapps.UI.generateTTFText(t.text,this.getColoredFont(cleverapps.styles.FONTS.DAILY_TASK_FONT||e.title.font,this.task),t.replace);i.setAnchorPoint2(),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setDimensions(e.title.width,0),i.setPosition(e.title.x,e.title.y),e.title.height&&i.fitTo(void 0,e.title.height),this.addChild(i,1)},addCheckMark:function(){var e=cleverapps.styles.DailyTaskView,t=this.check=new cc.Sprite(bundles.dailytasks.frames.daily_task_mark_png||bundles.main.frames.goal_done_sign||bundles.game.frames.goal_done_sign);t.setPositionRound(e.check.x,this.height/2),t.visible=!1,this.addChild(t)},addPresent:function(){var e=cleverapps.styles.DailyTaskView.present,t=this.present=new cleverapps.Spine(e.animation.skeleton);e.animation.skin&&t.setSkin(e.animation.skin["level_"+this.task.getLevel()]),t.setScale(e.animation.scale),t.setPositionRound(e.x,e.y),t.visible=!1,
this.addChild(t)},addIcon:function(){var e=cleverapps.styles.DailyTaskView,t=this.icon=new cc.Node;t.setAnchorPoint2();var i=this.task.getIcon();if(bundles.dailytasks.frames.daily_task_icon_bg_png){var s=new cc.Sprite(bundles.dailytasks.frames.daily_task_icon_bg_png);t.addChild(s),t.setContentSize2(s.getContentSize()),s.setPositionRound(t.width/2,t.height/2),i.width>.7*s.width&&(i.scale=.7*s.width/i.width)}else t.setContentSize2(i.getContentSize());if(bundles.dailytasks.frames.missions_frame_white_png){var n=this.iconFrame=new cc.Sprite(bundles.dailytasks.frames.missions_frame_white_png);n.setPositionRound(t.width/2,t.height/2),t.addChild(n)}i.setPositionRound(t.width/2,t.height/2),t.addChild(i),t.setCascadeOpacityEnabled(!0),this.addChild(t),t.setPositionRound(e.icon.x,e.icon.y)},addBackgroundTop:function(){var e=cleverapps.styles.DailyTaskView.bg_top,t=cleverapps.UI.createScale9Sprite(e["level_"+this.task.getLevel()]);t.setContentSize2(e.width,e.height),this.addChild(t),
t.setPositionRound(e);var i=cleverapps.UI.generateTTFText("messages:DailyTaskView.level."+this.task.getLevel(),cleverapps.styles.FONTS.DAILY_TASKS_LEVEL_TEXT);i.setAnchorPoint2(),i.fitTo(t.width-cleverapps.styles.UI.Button.contentPadding),t.addChild(i),i.setPositionRound(t.width/2,e.title.y)},updateProgress:function(){this.progressCounter&&(this.progressCounter.visible=!this.task.isFinished(),this.progressCounter.setString(this.task.progress+" / "+this.task.goal),this.task.expired&&this.progressCounter.setPositionY(this.height/2),this.task.expired&&!this.task.isFinished()&&this.progressCounter.setFontFillColor(cleverapps.styles.COLORS.EXPIRED_TASK_FONT_COLOR||cleverapps.styles.COLORS.DARK_RED||cleverapps.styles.COLORS.COLOR_RED)),this.progressBar&&(this.progressBar.setPercentage(this.task.progress/this.task.goal*100),this.progressBarText.setString(this.task.progress+" / "+this.task.goal))},onUpdate:function(){var e=cleverapps.styles.DailyTaskView;this.playButton.setVisible(
!this.task.collected&&!this.task.expired&&!this.task.isFinished()),this.rewardButton.setVisible(!this.task.collected&&!this.task.expired&&this.task.isFinished()),this.iconFrame&&this.iconFrame.setSpriteFrame(new cc.Sprite(this.task.isFinished()?bundles.dailytasks.frames.missions_frame_green_png:bundles.dailytasks.frames.missions_frame_white_png).getSpriteFrame()),this.check&&(this.check.visible=this.task.isFinished()&&this.task.collected),this.updateProgress(),this.task.isFinished()&&!this.task.collected?this.present.setAnimation(0,e.present.animation.animation["level_"+this.task.getLevel()]||e.present.animation.animation,e.present.animation.loop):this.present.visible=!1}});cleverapps.styles.DailyTaskView={width:700,height:180,icon:{x:90,y:94},title:{x:340,y:100,width:300,height:140,font:cleverapps.styles.FONTS.WINDOW_SMALL_TEXT},bg_top:{level_low:bundles.dailytasks.frames.daily_task_missions_easy_top_png,level_mid:bundles.dailytasks.frames.daily_task_missions_medium_top_png,
level_hard:bundles.dailytasks.frames.daily_task_missions_hard_top_png,width:180,height:46,x:{align:"center"},y:{align:"bottom",dy:-8},title:{y:23}},localZOrder:{level_low:{zOrder:1},level_mid:{zOrder:2},level_hard:{zOrder:3}},progress:{x:580,y:120,font:cleverapps.styles.FONTS.WINDOW_TEXT,fontSmall:cleverapps.styles.FONTS.WINDOW_SMALL_TEXT},check:{x:580},present:{x:580,y:120,animation:{skeleton:bundles.windows.jsons.present_json,skin:{level_low:"blue",level_mid:"pink",level_hard:"green"},scale:1,animation:"animation",loop:!0}},button:{width:210,height:100,scale:.7,x:580,y:58}};var DailyTaskRewardWindow=RewardWindow.extend({ctor:function(e){this.task=e,this.reward=this.getReward(),this._super({reward:this.reward})},onWindowLoaded:function(e){this._super({reward:this.reward,title:"messages:DailyTaskRewardWindow.title",name:"dailytaskrewardwindow",text:"messages:DailyTaskRewardWindow.text",animation:cleverapps.styles.DailyTaskRewardWindow.animation,rewardName:"dailyTasks"})},
getReward:function(){var e=RewardsConfig.DailyTask,t=cleverapps.Random.choose(e[this.task.getLevel()]);return e.prepareByRich&&(t=cleverapps.user.prepareRewardByRich(t)),cleverapps.clone(t,!0)},onReceiveReward:function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_TASK_REWARD+this.task.getLevel()),cleverapps.playSession.inc(cleverapps.EVENTS.SESSION_DAILY_TASK_REWARD),cleverapps.dailyTasks.collect(this.task)},receiveReward:function(){this.task.isFinished()&&!this.task.collected&&(this.onReceiveReward(),cleverapps.Chest.prototype._receiveReward(this.reward))}});cleverapps.styles.DailyTaskRewardWindow={animation:{json:res.reward_spine_json}};var BattlePass=function(e){((this.mission=e).battlePass=this).load(e.details),this.onBoughtPremium=function(){}};BattlePass.prototype.setLastShownLvl=function(e){this.lastShownLvl=e,this.save()},BattlePass.prototype.save=function(){this.mission.details=this.getInfo(),this.mission.update(0,this.getInfo())},
BattlePass.prototype.load=function(e){this.boughtPremium=e.boughtPremium||!1,this.currentTask=new BattlePassTask(e.currentTaskData,this),this.levelsToReward=e.levelsToReward||[],this.levelsToPremReward=e.levelsToPremReward||[],this.lastShownLvl=e.lastShownLvl||this.currentLevel()},BattlePass.prototype.getInfo=function(){return{boughtPremium:this.boughtPremium,levelsToReward:this.levelsToReward,levelsToPremReward:this.levelsToPremReward,lastShownLvl:this.lastShownLvl,currentTaskData:{level:this.currentTask.level,progress:this.currentTask.progress}}},BattlePass.prototype.attemptProgressChange=function(e,t){this.isActive()&&!this.tasksCompleted()&&this.currentTask.data.type===e&&(t(),this.currentTask.isFinished()&&this.goNextLevel(),this.save())},BattlePass.prototype.currentLevel=function(){return this.currentTask.level},BattlePass.prototype.goNextLevel=function(){var e=this.currentLevel();this.levelsToReward.push(e),this.levelsToPremReward.push(e),this.currentTask=new BattlePassTask({
level:e+1},this),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BATTLE_PASS_FINISH_TASK+"_"+e)},BattlePass.prototype.takeLevelReward=function(e,t){if(this.levelHasReward(e,t)){var i=BattlePass.getLevels(),s=t?i[e].premiumReward:i[e].reward;return t?this.levelsToPremReward.splice(this.levelsToPremReward.indexOf(e),1):this.levelsToReward.splice(this.levelsToReward.indexOf(e),1),this.tasksCompleted()&&!this.anyRewardsLeft()?this.mission.complete():this.save(),cleverapps.eventLogger.logEvent((t?cleverapps.EVENTS.BATTLE_PASS_RECEIVED_PREMIUM:cleverapps.EVENTS.BATTLE_PASS_RECEIVED)+"_"+e),s}},BattlePass.prototype.takeAllRemainingRewards=function(){var t={},i=BattlePass.getLevels();return this.levelsToReward.forEach(function(e){Product.AddUpRewards(i[e].reward,t)}),this.levelsToReward=[],this.boughtPremium&&(this.levelsToPremReward.forEach(function(e){Product.AddUpRewards(i[e].premiumReward,t)}),this.levelsToPremReward=[]),Product.UnlimitedToHours(t),0<Object.keys(t).length?t:void 0},
BattlePass.prototype.levelHasReward=function(e,t){return t?-1!==this.levelsToPremReward.indexOf(e):-1!==this.levelsToReward.indexOf(e)},BattlePass.prototype.setPremium=function(){this.boughtPremium=!0,this.onBoughtPremium(),this.save()},BattlePass.prototype.tasksCompleted=function(){return BattlePass.getLevels().length<=this.currentTask.level},BattlePass.prototype.anyRewardsLeft=function(){return 0!==this.levelsToReward.length||0!==this.levelsToPremReward.length},BattlePass.prototype.isActive=function(){return cleverapps.eventManager.isActive("battlepass")},BattlePass.prototype.getTimeLeft=function(){return this.isActive()?cleverapps.eventManager.getFeatureEvent("battlepass").getTimeLeft():0};var BattlePassTask=function(e,t){e=e||{},this.battlePass=t,this.level=e.level||0,this.progress=e.progress||0;var i=BattlePass.getLevels()[this.level];this.data=void 0!==i?i.task:{}};BattlePassTask.prototype.addProgress=function(e){e="number"==typeof e?e:1,this.progress+=e},
BattlePassTask.prototype.setProgress=function(e){e="number"==typeof e?e:1,this.progress=e},BattlePassTask.prototype.isFinished=function(){return this.progress>=this.data.goal};var BattlePassMissionLogic=function(e){this.mission=e,this.battlePass=new BattlePass(this.mission)};BattlePassMissionLogic.prototype.receiveReward=function(){return this.battlePass.takeAllRemainingRewards()},BattlePassMissionLogic.prototype.wantsToActOnFinish=function(){return 0!==this.battlePass.levelsToReward.length||0!==this.battlePass.levelsToPremReward.length&&this.battlePass.boughtPremium},BattlePassMissionLogic.prototype.processEvent=function(e,t){var i=this.battlePass.currentTask.addProgress.bind(this.battlePass.currentTask,t.amount);e===Mission.EVENT_PASS_LEVELS_IN_ROW&&0===t.amount&&(i=this.battlePass.currentTask.setProgress.bind(this.battlePass.currentTask,t.amount)),this.battlePass.attemptProgressChange(e,i)},BattlePassMissionLogic.IsAvailable=function(){return!!cleverapps.payments.isAvailable()&&(
-1!==["heroes"].indexOf(cleverapps.config.name)||-1!==["riddles"].indexOf(cleverapps.config.name)&&cleverapps.config.debugMode)},BattlePass.getLevels=function(){return[{level:0,task:{type:Mission.EVENT_COLLECT_COLOR_CELLS,goal:900,icon:bundles.battle_pass.frames.bp_task_icon0},reward:{unlimitedLives:"2 hour"},premiumReward:{unlimitedLives:"24 hour"}},{level:1,task:{type:Mission.EVENT_LEVEL_FINISH,goal:4,icon:bundles.dailytasks.frames.daily_task_icon_11_png},reward:{gold:75},premiumReward:{gold:1e3}},{level:2,task:{type:Mission.EVENT_COLLECT_HERO_CELLS,goal:50,icon:bundles.battle_pass.frames.bp_task_icon1},reward:{unlimitedLives:"6 hour"},premiumReward:{boosters:{0:5}}},{level:3,task:{type:Mission.EVENT_USE_MULTI_COLOR_CELL,goal:1,icon:bundles.dailytasks.frames.daily_task_icon_8_png},reward:{gold:100},premiumReward:{unlimitedLives:"48 hour"}},{level:4,task:{type:Mission.EVENT_COMPLETE_DAILY_TASK,goal:3,icon:bundles.battle_pass.frames.bp_task_icon4},reward:{unlimitedLives:"12 hour"},
premiumReward:{boosters:{1:5}}},{level:5,task:{type:Mission.EVENT_COLLECT_COLOR_CELLS,goal:2e3,icon:bundles.battle_pass.frames.bp_task_icon0},reward:{gold:200},premiumReward:{gold:2e3}},{level:6,task:{type:Mission.EVENT_PLAY_DAILYCUP,goal:5,icon:bundles.battle_pass.frames.bp_task_icon12},reward:{boosters:{2:1}},premiumReward:{boosters:{2:5}}},{level:7,task:{type:Mission.EVENT_LEVEL_FINISH,goal:8,icon:bundles.dailytasks.frames.daily_task_icon_11_png},reward:{gold:300},premiumReward:{unlimitedLives:"72 hour"}},{level:8,task:{type:Mission.EVENT_COLLECT_HERO_CELLS,goal:150,icon:bundles.battle_pass.frames.bp_task_icon1},reward:{unlimitedLives:"24 hour"},premiumReward:{boosters:{0:10}}},{level:9,task:{type:Mission.EVENT_COLLECT_CLOVER,goal:35,icon:bundles.battle_pass.frames.bp_task_icon9},reward:{gold:600},premiumReward:{gold:4e3}},{level:10,task:{type:Mission.EVENT_COLLECT_STARS,goal:20,icon:bundles.battle_pass.frames.bp_task_icon10},reward:{boosters:{2:3}},premiumReward:{boosters:{1:10}}},
{level:11,task:{type:Mission.EVENT_USE_MULTI_COLOR_CELL,goal:4,icon:bundles.dailytasks.frames.daily_task_icon_8_png},reward:{gold:1e3},premiumReward:{unlimitedLives:"120 hour"}},{level:12,task:{type:Mission.EVENT_WIN_DAILYCUP,goal:1,icon:bundles.battle_pass.frames.bp_task_icon11},reward:{unlimitedLives:"48 hour"},premiumReward:{boosters:{2:10}}},{level:13,task:{type:Mission.EVENT_PASS_LEVELS_IN_ROW,goal:5,icon:bundles.battle_pass.frames.bp_task_icon13},reward:{gold:1500},premiumReward:{gold:8e3}}]};var BattlePassWindow=Window.extend({onWindowLoaded:function(e){this.mission=e,this.battlePass=e.battlePass,this.battlePass.currentTask.isFinished()&&this.battlePass.goNextLevel(),this.createContent(),this._super({name:"battlepasswindow",content:this.content,styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.BattlePassWindow.Window,!0)}),this.addTitle("messages:BattlePassWindow.Title"),this.addVerticalText(),this.createHoverNode(),this.addButton(),this.controls(),
this.scheduleUpdate(),this.battlePass.onBoughtPremium=function(){new BattlePassWindow(this.mission),this.close()}.bind(this)},addText:function(){if(!this.battlePass.boughtPremium){var e=cleverapps.UI.generateTTFText("messages:BattlePassWindow.Description",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.setDimensions(this.levelsNode.width,0),e}},addButton:function(){if(!this.battlePass.boughtPremium){var e=cleverapps.styles.BattlePassWindow.button,t=Product.Create("battlepass"),i=cleverapps.UI.generateTTFText(t.getCurrentPrice(),cleverapps.styles.FONTS.BUTTON_TEXT),s=new cc.Sprite(bundles.battle_pass.frames.ticket);s.setScale(e.scale),s.setRotation(e.rotation);var n=new cleverapps.Layout([i,s],{direction:cleverapps.UI.HORIZONTAL,margin:e.margin,x:e.offsetX}),o=this.button=new cleverapps.UI.Button({width:n.width+e.textPadding.x,height:e.height,content:n,onClicked:function(){t.buy(function(){this.battlePass.setPremium()}.bind(this))
}.bind(this)});this.window.addChild(o),o.setPositionRound(e)}},addVerticalText:function(){var n=cleverapps.styles.BattlePassWindow.content.verticalText;["missions","rewards"].forEach(function(e,t){var i=cleverapps.UI.generateTTFText("messages:BattlePassWindow.levels."+e,n.font[t]);i.setRotation(-90),this.content.addChild(i);var s=n.position[t];i.setPosition({x:s.x,y:this.content.height+s.dy})}.bind(this));var e=new cc.Sprite(bundles.battle_pass.frames.ticket);this.content.addChild(e),e.setPosition({x:n.position[2].x,y:this.content.height+n.position[2].dy})},addTitle:function(e){var t=cleverapps.styles.BattlePassWindow.title,i=this.titleBg=cleverapps.UI.createScale9Sprite(t.bg,cleverapps.UI.Scale9Rect.TwoPixelXY);t.scale_9&&(t.scale_9.width?i.setContentSize2(t.scale_9):i.setContentSize2(.6*this.window.width,i.height)),this.window.addChild(i,2),i.setPositionRound(t);var s=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.BATTLEPASS_TITLE);i.addChild(s),s.setPositionRound(t.text),
s.fitTo(i.width+t.text.padding);var n=function(){var e=cleverapps.UI.generateTTFText("messages:Finished",t.timer.font);i.addChild(e),e.setPositionRound(t.timer)};if(0<this.battlePass.getTimeLeft()){for(var o=new cleverapps.CountDownView(new cleverapps.CountDown(this.battlePass.getTimeLeft()),{font:t.timer.font}),a=cleverapps.UI.generateTTFText("messages:BattlePassWindow.TitleTimer",t.timer.font),r=i.width+t.text.padding;a.width+o.text.width>r;)o.text.setFontSize(Math.floor(.9*o.text.getFontSize())),a.setFontSize(Math.floor(.9*a.getFontSize()));var l=a.width+o.text.width+t.timer.margin,c=new cc.Node;c.setAnchorPoint2(),c.setContentSize2(l,a.height),c.addChild(a),a.setPosition(a.width/2,c.height/2),c.addChild(o),o.setPosition(c.width-o.text.width/2,c.height/2),i.addChild(c),c.setPositionRound(t.timer),o.countDown.onFinish=this.createListener(function(){n(),c.setVisible(!1)})}else n()},createContent:function(){var e=cleverapps.styles.BattlePassWindow.content,t={
direction:cleverapps.UI.VERTICAL,margin:e.margin};this.battlePass.boughtPremium?t.y=e.noButtonPaddingY:t.padding=e.contentPadding,this.levelsNode=new BattlePassLevels(this.battlePass);var i=this.addText();this.content=new cleverapps.Layout([i,this.levelsNode].filter(function(e){return void 0!==e}),t)},createHoverNode:function(){var e=this.hoverNode=new BattlePassHover(this,this.levelsNode.levels,this.battlePass);e.setVisible(!1),this.window.addChild(e,2)},controls:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:this.onTouchBegan.bind(this),onTouchEnded:this.onTouchEnded.bind(this),onTouchMoved:this.onTouchMoved.bind(this)},this.levelsNode)},onTouchBegan:function(){return this.hoverNode.setVisible(!1),!0},onTouchMoved:function(e){cc.pDistance(e.getLocation(),e.getStartLocation())>=cleverapps.styles.BattlePassWindow.moveThreshold&&(this.touchActive=!0,this.hoverNode.onTouchMove())},onTouchEnded:function(e){this.touchActive||this.processTouch(e
),this.touchActive=!1},processTouch:function(e){var t=cc.rect(0,0,this.levelsNode.width,this.levelsNode.height),i=this.levelsNode.convertTouchToNodeSpace(e);if(cc.rectContainsPoint(t,i))for(var s in this.levelsNode.levels){var n=this.levelsNode.levels[s];if(n.isTaskPressed(e)){this.hoverNode.showHoverNode(n);break}if(n.rewardPressed(e))break}}});BattlePassWindow.prototype.listBundles=function(){return["battle_pass","game","dailytasks","heroes"]},cleverapps.overrideFonts(cleverapps.styles.DECORATORS,{BATTLEPASS_REWARD_STROKE:{color:cleverapps.styles.COLORS.COLOR_BROWN,size:2},BATTLEPASS_TITLE_STROKE:{color:new cc.Color(209,54,81,255),size:3}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{BATTLEPASS_REWARD:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.BATTLEPASS_REWARD_STROKE},BATTLEPASS_TASK:{size:23,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.BATTLEPASS_REWARD_STROKE},BATTLEPASS_AMOUNT_TASK:{size:31,
color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.BATTLEPASS_REWARD_STROKE},BATTLEPASS_TITLE:{size:60,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.BATTLEPASS_TITLE_STROKE},BATTLEPASS_TIMER:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.BATTLEPASS_TITLE_STROKE},BATTLEPASS_VERTICAL_WHITE_TXT:{size:20,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.BATTLEPASS_REWARD_STROKE},BATTLEPASS_VERTICAL_TXT:{size:20,color:new cc.Color(130,70,40,255)},BATTLEPASS_HOVERNODE_TXT:{size:30,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT}}),cleverapps.styles.BattlePassWindow={moveThreshold:10,button:{height:115,margin:40,scale:.85,rotation:86,offsetX:-300,textPadding:{x:90},x:{align:"center"},y:{align:"bottom",dy:50}},title:{bg:bundles.battle_pass.frames.titleBg,scale_9:!0,x:{align:"center"},y:{align:"top",dy:15},text:{x:{align:"center"},y:{align:"center",dy:15},padding:-120},timer:{x:{
align:"center"},y:{align:"center",dy:-35},font:cleverapps.styles.FONTS.BATTLEPASS_TIMER,margin:6}},content:{margin:0,contentPadding:{x:0,y:50},noButtonPaddingY:-580,verticalText:{font:[cleverapps.styles.FONTS.BATTLEPASS_VERTICAL_TXT,cleverapps.styles.FONTS.BATTLEPASS_VERTICAL_WHITE_TXT,cleverapps.styles.FONTS.BATTLEPASS_VERTICAL_TXT],position:[{x:-28,dy:-175},{x:-28,dy:-320},{x:-38,dy:-495}]}},Window:{}};var BattlePassLevels=cc.Node.extend({ctor:function(e){this._super(),this.battlePass=e,this.setAnchorPoint2();var t=cleverapps.styles.BattlePassLevels.scroll;this.setContentSize2(t.width[cleverapps.wideMode.mode]*resolutionScale,t.height[cleverapps.wideMode.mode]*resolutionScale),this.createLevels(),this.wrapInScroll(),this.addArrows(),this.scrollToLevel(e.currentLevel()),this.animateTransition()},createLevels:function(){var i=this.levels=[];BattlePass.getLevels().forEach(function(e){var t=new BattlePassLevel(e,this.battlePass);i.push(t)}.bind(this)),
this.levelsContainer=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.BattlePassLevels.levelsMargin})},wrapInScroll:function(){var e=this.scroll=new cleverapps.UI.ScrollView(this.levelsContainer,{scrollBarEnabled:!1,containerMovedListener:cleverapps.throttle(30,this.scrollUpdated.bind(this))});e.setContentSize2(this.getContentSize()),e.setPositionRound(this.width/2,this.height/2),this.addChild(e)},scrollUpdated:function(){this.arrows&&this.arrows.onScrollMoved()},addArrows:function(){cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL&&(this.arrows=new BattlePassWindowArrows(this),this.arrows.setPositionRound(this.width/2,this.height/2),this.addChild(this.arrows))},calcPositionPercent:function(e){var t=100*e/(this.scroll.innerContent.width-this.scroll.width);return Math.min(100,Math.max(0,t))},scrollToLevel:function(e){var t=this.levels[e];t?this.scroll.scrollTo(t):this.scroll.scrollTo(cleverapps.UI.ScrollView.SCROLLS.LOWER_RIGHT)},
listTransitionAffectedNodes:function(e){return[e.taskNode,e.rewardNode,e.text]},animateTransition:function(){var e=this.battlePass.currentLevel()-this.battlePass.lastShownLvl,t=this.battlePass.lastShownLvl;if(this.battlePass.setLastShownLvl(this.battlePass.currentLevel()),!(e<1||this.battlePass.tasksCompleted())){for(var i=function(t){this.listTransitionAffectedNodes(t).forEach(function(e){e.replaceParentSamePlace(t)})},s=0;s<e;s++){var n=this.levels[t+s];this.listTransitionAffectedNodes(n).forEach(function(e){e.replaceParentSamePlace(this.levelsContainer)}.bind(this)),n.taskNode.icon.runAction(new cc.Sequence(new cc.DelayTime(.7+.5*s),new cc.FadeTo(.25,140),new cc.CallFunc(i.bind(this,n))))}var o=this.levels[t].taskNode.taskBg,a=this.levels[this.battlePass.currentLevel()],r=this.levels[t],l=a.x-r.x;o.replaceParent(a.taskNode),o.x-=l,o.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.MoveTo(.5*e,{x:o.x+l,y:o.y})))}}});cleverapps.styles.BattlePassLevels={levelsMargin:10,
visiblePadding:10,scroll:{width:[590,740,740],height:[530,530,530]}};var BattlePassLevel=cleverapps.Layout.extend({ctor:function(e,t){this.battlePass=t,this.levelData=e,this.taskNode=this.createTask(e,e.level),this.rewardNode=new BattlePassLevelReward(e,!1,t),this.premRewardNode=new BattlePassLevelReward(e,!0,t),this._super(this.getLayoutItems(),{direction:cleverapps.UI.VERTICAL,margin:cleverapps.styles.BattlePassLevel.margin}),this.customize(),this.addLevelBg(this)},getLayoutItems:function(){return[this.premRewardNode,this.rewardNode,this.taskNode]},customize:function(){this.rewardNode.setLocalZOrder(1);var e=Messages.get("BattlePassWindow.task.level")+" "+(this.levelData.level+1),t=this.text=cleverapps.UI.generateTTFText(e,cleverapps.styles.BattlePassLevel.task.font);t.fitTo(.9*this.taskNode.width),this.addChild(t),t.setPositionRound(cleverapps.styles.BattlePassLevel.task.text)},addLevelBg:function(e){var t=cleverapps.styles.BattlePassLevel,i=cleverapps.UI.createScale9Sprite(
bundles.battle_pass.frames.top_level_bg,cleverapps.UI.Scale9Rect.TwoPixelXY);i.setContentSize2(this.taskNode.width,2*this.taskNode.height+2*t.margin),e.addChild(i,-1),i.setPositionRound(t.bg.top);var s=cleverapps.UI.createScale9Sprite(bundles.battle_pass.frames.bottom_level_bg,cleverapps.UI.Scale9Rect.TwoPixelXY);s.setContentSize2(this.taskNode.width,this.taskNode.height),e.addChild(s,-1),s.setPositionRound(t.bg.bottom)},createTask:function(e){var t=e.task,i=cleverapps.styles.BattlePassLevel.task,s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(i);var n=cleverapps.skins.getSlot("battlePassTaskIcon",{taskType:e.task.type})||t.icon,o=s.icon=new cc.Sprite(n);if(s.addChild(o),o.setPositionRound(i.icon),this.addTaskBg(s,e),e.level>=this.battlePass.currentLevel()){var a=e.level===this.battlePass.currentLevel()?this.battlePass.currentTask.progress+"/"+t.goal:t.goal,r=cleverapps.UI.generateTTFText(a,i.amountFont);r.fitTo(i.goal.width),s.addChild(r),r.setPositionRound(i.goal),
e.level>this.battlePass.currentLevel()&&(cleverapps.UI.convertToGrayScale(o),cleverapps.UI.convertToGrayScale(r))}else e.level<this.battlePass.lastShownLvl&&o.setOpacity(140);return s},addTaskBg:function(e,t){if(t.level===this.battlePass.lastShownLvl&&!this.battlePass.tasksCompleted()){var i=cleverapps.styles.BattlePassLevel,s=e.taskBg=cleverapps.UI.createScale9Sprite(bundles.battle_pass.frames.top_cur_level_bg,cleverapps.UI.Scale9Rect.TwoPixelXY);s.setContentSize2(i.task.width,2*i.task.height+2*i.margin),e.addChild(s,-1),s.setPositionRound(i.task.bg)}},isTaskPressed:function(e){return cc.rectContainsPoint(cc.rect(0,0,this.taskNode.width,this.taskNode.height),this.taskNode.convertTouchToNodeSpace(e))},rewardPressed:function(e){return this.rewardNode.isPressed(e)?(this.rewardNode.onPress(),!0):this.premRewardNode.isPressed(e)?(this.premRewardNode.onPress(),!0):void 0}});cleverapps.styles.BattlePassLevel={margin:25,titleMargin:5,offsetY:0,padding:{x:0,y:0},bg:{top:{x:{align:"center"},y:{
align:"center",dy:70}},bottom:{x:{align:"center"},y:{align:"center",dy:-165}}},task:{width:140,height:140,font:cleverapps.styles.FONTS.BATTLEPASS_TASK,amountFont:cleverapps.styles.FONTS.BATTLEPASS_AMOUNT_TASK,icon:{x:{align:"center"},y:{align:"center",dy:-25}},text:{x:{align:"center",dx:0},y:{align:"center",dy:210}},bg:{x:{align:"center",dx:0},y:{align:"center",dy:-97}},goal:{x:{align:"right",dx:-10},y:{align:"center",dy:-55},width:120}}};var BattlePassLevelReward=cc.Node.extend({ctor:function(e,t,i){this._super(),this.battlePass=i,this.levelData=e,this.rewardData=t?e.premiumReward:e.reward,this.premium=t,this.setAnchorPoint2(),this.setContentSize2(cleverapps.styles.BattlePassLevelReward),this.createContent()},createContent:function(){var e=cleverapps.styles.BattlePassLevelReward,t=this.content=new cc.Node;t.setCascadeOpacityEnabled(!0),t.setAnchorPoint2(),t.setContentSize2(this.getContentSize()),t.setPosition(this.width/2,this.height/2),this.addChild(t);var i=this.getRewardIcon(
this.rewardData);t.addChild(i),(t.icon=i).setPositionRound(e.icon),this.addRewardAmount(this,t,this.rewardData),this.levelData.level<this.battlePass.currentLevel()?this.battlePass.levelHasReward(this.levelData.level,this.premium)?this.createRewardButton():this.setRewardCollected():this.levelData.level>this.battlePass.currentLevel()&&(cleverapps.UI.convertToGrayScale(i),cleverapps.UI.convertToGrayScale(t.amount))},getRewardIcon:function(e){var t=cleverapps.styles.BattlePassLevelReward.icons,i=Object.keys(e)[0];"boosters"===i&&(i=Object.keys(e.boosters)[0]);var s=new cc.Sprite(t[i]);return s.setScale(t.width/s.width),s},addRewardAmount:function(e,t,i){var s=cleverapps.styles.BattlePassLevelReward.amount,n=this.getRewardAmount(i);(t.amount=n).fitTo(s.width),n.setPosition(e.width-n.width/2+s.dx,n.height/2+s.dy),t.addChild(n)},getRewardAmount:function(e){var t=cleverapps.values(e)[0];"object"==typeof t&&(t=cleverapps.values(t)[0]);var i=Object.keys(e)[0]
;return"unlimitedLives"===i?t=Messages.get("BattlePassWindow.reward.lives",{hours:parseInt(t)}):"gold"!==i&&(t="x"+t),cleverapps.UI.generateTTFText(t,cleverapps.styles.BattlePassLevelReward.font)},createRewardButton:function(){var e=cleverapps.styles.BattlePassLevelReward.button,t=cleverapps.UI.generateTTFText("messages:BattlePassWindow.reward.receive",cleverapps.styles.FONTS.BUTTON_SMALL_TEXT),i=cleverapps.UI.wrap(t),s=this.button=new cleverapps.UI.Button({width:e.width,height:e.height,content:i,contentPadding:e.padding,button_png:e.button,button_on_png:e.button_on,onClicked:function(){},swallowTouches:!1});this.addChild(s),s.setPositionRound(e)},setRewardCollected:function(){this.content.icon.setOpacity(140),this.content.amount.setOpacity(140)},isPressed:function(e){return!!cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),this.convertTouchToNodeSpace(e))||!(!this.button||!cc.rectContainsPoint(cc.rect(0,0,this.button.width,this.button.height),
this.button.convertTouchToNodeSpace(e)))},onPress:function(){this.battlePass.levelHasReward(this.levelData.level,this.premium)&&(!this.premium||this.battlePass.boughtPremium?(new RewardWindow({reward:this.battlePass.takeLevelReward(this.levelData.level,this.premium)}),this.button.removeFromParent(),delete this.button,this.setRewardCollected()):new BuyBattlePassWindow(this.battlePass.mission))}});cleverapps.styles.BattlePassLevelReward={width:140,height:140,font:cleverapps.styles.FONTS.BATTLEPASS_REWARD,icon:{x:{align:"center",dx:0},y:{align:"center",dy:10}},amount:{width:110,dx:-20,dy:20},button:{button:bundles.battle_pass.frames.reward_button,button_on:bundles.battle_pass.frames.reward_button_on,width:130,height:50,padding:30,x:{align:"center"},y:{align:"bottom",dy:-25}},icons:{width:80,unlimitedLives:bundles.menubar.frames.life_unlim_png,gold:bundles.menubar.frames.coin_png,exp:bundles.menubar.frames.exp_png,0:bundles.reward_icons.frames.cellbooster,
1:bundles.reward_icons.frames.linebooster,2:bundles.reward_icons.frames.colorbooster}};var BattlePassWindowArrows=cc.Node.extend({ctor:function(e){this._super(),this.levelsNode=e,this.setAnchorPoint2(),this.setContentSize2(e.getContentSize());var t=cleverapps.styles.BattlePassWindowArrows,i=this.leftArrow=new cc.Sprite(bundles.battle_pass.frames.arrow);i.setRotation(180),this.addChild(i),i.setPositionRound(t.left),cleverapps.UI.applyHover(i);var s=this.rightArrow=new cc.Sprite(bundles.battle_pass.frames.arrow);this.addChild(s),s.setPositionRound(t.right),cleverapps.UI.applyHover(s),this.controls(),this.scheduleUpdate()},update:function(e){this._super(e),this.scrolling&&this.scroll(this.scrolling.toRight)},onScrollMoved:function(){var e=this.levelsNode.calcPositionPercent(-this.levelsNode.scroll.innerContent.x);this.rightArrow.setVisible(.25<100-e),this.leftArrow.setVisible(.25<e)},scroll:function(e){var t=this.levelsNode.calcPositionPercent(-this.levelsNode.scroll.innerContent.x),
i=Math.round(this.levelsNode.scroll.width/(this.levelsNode.scroll.innerContent.width/BattlePass.getLevels().length)),s=100/(BattlePass.getLevels().length-i),n=e?t+s:t-s;n=Math.min(100,Math.max(0,n)),this.levelsNode.scroll.scrollToPercent(n,.35,!0)},controls:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.touchStart.bind(this),onTouchMoved:this.touchMove.bind(this),onTouchEnded:this.touchEnd.bind(this),onTouchCancelled:this.touchEnd.bind(this)},this)},touchStart:function(e){return cc.rectContainsPoint(cc.rect(0,0,this.leftArrow.width,this.leftArrow.height),this.leftArrow.convertTouchToNodeSpace(e))?(this.scrolling={toRight:!1},!0):cc.rectContainsPoint(cc.rect(0,0,this.rightArrow.width,this.rightArrow.height),this.rightArrow.convertTouchToNodeSpace(e))?(this.scrolling={toRight:!0},!0):void 0},touchMove:function(e){if(this.scrolling){var t=this.scrolling.toRight?this.rightArrow:this.leftArrow;cc.rectContainsPoint(cc.rect(
0,0,t.width,t.height),t.convertTouchToNodeSpace(e))||delete this.scrolling}},touchEnd:function(){this.scrolling&&delete this.scrolling}});cleverapps.styles.BattlePassWindowArrows={right:{x:{align:"right",dx:140},y:{align:"center",dy:0}},left:{x:{align:"left",dx:-140},y:{align:"center",dy:0}}};var BattlePassHover=cc.Node.extend({ctor:function(e,t,i){this._super(),this.parentWindow=e,this.levelViews=t,this.battlePass=i;var s=cleverapps.styles.BattlePassHover;this.setAnchorPoint2(),this.setContentSize2(s);var n=cleverapps.UI.createScale9Sprite(s.bg);n.setContentSize2(this.getContentSize()),n.setPosition(this.width/2,this.height/2),this.addChild(n)},updateHoverNode:function(e){var t=cleverapps.styles.BattlePassHover,i=Messages.get("BattlePassWindow.infoNode.task"+e);this.text?this.text.setString(i):(this.text=cleverapps.UI.generateTTFText(i,cleverapps.styles.FONTS.BATTLEPASS_HOVERNODE_TXT),this.text.setDimensions(t.textWidth,0),this.text.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),
this.text.setPosition(this.width/2,this.height/2),this.addChild(this.text,1)),this.text.setFontSize(cleverapps.styles.FONTS.BATTLEPASS_HOVERNODE_TXT.size),this.text.fitTo(void 0,.9*this.height);var s=this.parentWindow.window.convertToNodeSpace(this.levelViews[e].parent.convertToWorldSpace(this.levelViews[e].getPosition())),n=cc.director.getRunningScene().scene,o=n.convertToNodeSpace(this.parent.convertToWorldSpace(s)),a=n.width-(o.x+this.width/2),r=o.x-this.width/2;a<0?s.x+=a:r<0&&(s.x-=r),t.offsetY&&(s.y+=t.offsetY),this.setPosition(s),this.setVisible(!0)},showHoverNode:function(e){var t=e.levelData.level;t>=this.battlePass.currentLevel()&&this.hoveredLvl!==t?(this.hoveredLvl=t,this.updateHoverNode(t)):(this.setVisible(!1),this.hoveredLvl=void 0)},onTouchMove:function(){this.hoveredLvl=void 0,this.setVisible(!1)}});cleverapps.styles.BattlePassHover={width:330,height:150,bg:bundles.battle_pass.frames.hoverBg,textWidth:300},BuyBattlePassWindow=Window.extend({onWindowLoaded:function(e){
this.mission=e,this._super({title:"messages:BuyPassRewardWindow.title",name:"battlepassrewardwindow",content:this.getContent(),button:this.getButton()})},getButton:function(){var e=cleverapps.styles.BuyBattlePassWindow.button,t=Product.Create("battlepass");return{width:e.width,height:e.height,text:t.getCurrentPrice(),onPressed:function(){t.buy(function(){this.mission.battlePass.setPremium(),this.close()}.bind(this))}.bind(this)}},getContent:function(){var e=cleverapps.styles.BuyBattlePassWindow,t=new cc.Sprite(bundles.battle_pass.frames.ticket);t.setScale(e.icon.scale);var i=cleverapps.UI.generateTTFText("messages:BuyPassRewardWindow.description",cleverapps.styles.FONTS.WINDOW_TEXT);return i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setDimensions(e.textWidth,0),new cleverapps.Layout([i,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:e.contentPadding})}}),cleverapps.styles.BuyBattlePassWindow={textWidth:500,margin:10,contentPadding:{x:0,y:80},icon:{scale:1.3},
button:{width:150,height:100}};var Race=function(e){((this.mission=e).race=this).load(e.details),this.onPremBuy=function(){},this.onBreakFinishLine=function(){},this.isFinished()&&e.complete()};Race.prototype.complete=function(){this.completeShown=!0},Race.prototype.processBots=function(){var e=this.mission.getResults(),s={};if(e.forEach(function(e){for(var t in this.players)if(this.players[t].botId===e.id){var i=e.amount-this.players[t].currentStage();0<i&&(this.players[t].addProgress(i,!0),s[t]=i)}},this),cleverapps.config.debugMode)if(console.log("# Race update",(new Date).toTimeString()),Object.keys(s).length)for(var t in s)console.log("bot "+t+" gained "+s[t]);else console.log("no bots updated");0<Object.keys(s).length&&this.save()},Race.prototype.save=function(){var e=this.getPlayer().currentStage()-this.mission.result;this.mission.isRunning()&&this.mission.update(e,this.getInfo())},Race.prototype.getInfo=function(){var e={};for(var t in this.players)e[t]=this.players[t].getInfo(
);return{players:e,nextEmptyPlace:this.nextEmptyPlace,boughtPremium:this.boughtPremium,receivedRewards:this.receivedRewards}},Race.prototype.load=function(e){this.boughtPremium=e.boughtPremium||!1,this.nextEmptyPlace=e.nextEmptyPlace||0,this.receivedRewards=e.receivedRewards||[],this.createPlayers(e&&e.players),e.players||setTimeout(function(){this.save()}.bind(this),0)},Race.prototype.setPremium=function(){this.boughtPremium=!0,this.justBoughtPrem=!0,this.save(),this.onPremBuy()},Race.prototype.isRewardReceived=function(e){return-1!==this.receivedRewards.indexOf(e)},Race.prototype.getActiveRewards=function(e){e=void 0===e?this.getPlayer().shownStage:e;var t=[];for(var i in Race.REWARDS){var s=Race.REWARDS[i];if(s.stage>e)break;this.isRewardReceived(s.stage)||s.premium&&!this.boughtPremium||t.push(s)}return t},Race.prototype.collectRewards=function(e){var t={};return e.forEach(function(e){Product.AddUpRewards({gold:e.gold},t),this.receivedRewards.push(e.stage),
cleverapps.eventLogger.logEvent(cleverapps.EVENTS.RACE_FREE_REWARD+"_"+e.stage)},this),0<Object.keys(t).length?(this.save(),t):void 0},Race.prototype.getFinishReward=function(){switch(this.getPlayer().place){case 0:return{gold:500};case 1:return{gold:300};case 2:return{gold:100};default:return}},Race.prototype.getRacers=function(){return this.players},Race.prototype.getPlayer=function(){return this.players[Race.PLAYER_ID]},Race.prototype.addRacerProgress=function(e,t){e=void 0===e?Race.PLAYER_ID:e,t=t||1,this.players[e].addProgress(t),this.isFinished()&&this.mission.complete()},Race.prototype.createPlayers=function(e){for(var t in e=e||this.generatePlayersData(),this.players={},e)this.players[t]=new BalloonRacer(this,e[t],parseInt(t)===Race.PLAYER_ID)},Race.prototype.generatePlayersData=function(){for(var e={},t=["blue","violet","red","green"],i=this.getBotsData(),s=0;s<Race.PLAYERS_NUMB;s++){var n=void 0,o="player",a={avatar:cleverapps.friends.getPlayer().avatar,id:levels.user.id};if(
s!==Race.PLAYER_ID){o=cleverapps.Random.choose(t),t.splice(t.indexOf(o),1);var r=i[0];i.splice(0,1),n=r.id,a=r.avatar.avatar}e[s]={stage:0,skin:o,botId:n,avatarData:a}}return e},Race.prototype.getBotsData=function(){for(var e=this.mission.getResults(),t=[];t.length<Race.PLAYERS_NUMB-1;){var i=cleverapps.Random.choose(e);i.player||-1!==t.indexOf(i)||t.push(i)}return t},Race.prototype.isFinished=function(){return this.getPlayer().currentStage()>=Race.STAGES},Race.prototype.balloonsOnFinish=function(){var e=0;for(var t in this.players)this.players[t].shownStage>=Race.STAGES&&e++;return e},Race.prototype.stageHasReward=function(t){var e=Race.REWARDS.filter(function(e){return e.stage===t})[0];return e&&(!e.premium||this.boughtPremium)},Race.prototype.justStarted=function(){return 0===this.getPlayer().shownStage&&!this.boughtPremium&&!this.startWasShown},Race.prototype.showedStart=function(){this.startWasShown=!0},Race.prototype.transforedPrem=function(){delete this.justBoughtPrem},
Race.prototype.getPremDialogue=function(){for(var e in Race.DIALOGUES_DATA){var t=Race.DIALOGUES_DATA[e];if(t.premium)return this.prepareDialogue(t)}},Race.prototype.getStageDialogue=function(e){for(var t in Race.DIALOGUES_DATA){var i=Race.DIALOGUES_DATA[t];if(i.stage===e){if(!i.noPremium)return i;if(!this.boughtPremium)return i}}},Race.prototype.getActiveDialogue=function(e){var t=this.getStageDialogue(e);if(t)return this.prepareDialogue(t)},Race.prototype.prepareDialogue=function(e){return{dialogue:e.data.map(function(e){return{text:Messages.get(e.text),person:e.person}})}},Race.prototype.calcPlayerStepDelta=function(){var e=this.getPlayer();if(0===e.getStagesDelta())return 0;for(var t=e.shownStage;t<e.currentStage()&&(t++,!this.getStageDialogue(t)&&!this.stageHasReward(t)););return t-e.shownStage},Race.prototype.getCurrentPlayerPlace=function(){if(void 0!==this.getPlayer().place)return this.getPlayer().place;var e=cleverapps.values(this.players);return e.sort(function(e,t){
return t.currentStage()-e.currentStage()}),e.indexOf(this.getPlayer())},Race.PLAYER_ID=2,Race.PLAYERS_NUMB=5,Race.STAGES=50,Race.PREM_BOOST=.1;var BalloonRacer=function(e,t,i){this.isPlayer=i,this.race=e,this.stage=t.stage,this.place=t.place,this.botId=t.botId,this.avatarData=t.avatarData,this.skin=t.skin,i&&e.boughtPremium&&(this.skin="zeppelin"),this.setShownStage(this.currentStage()),this.onSkinChange=function(){}};BalloonRacer.prototype.addProgress=function(e,t){if(this.stage<Race.STAGES){this.isPlayer&&(cleverapps.playSession.inc(cleverapps.EVENTS[this.race.boughtPremium?"RACE_LEVELS_PASSED_PREM":"RACE_LEVELS_PASSED"],1),this.race.boughtPremium&&(e+=e*Race.PREM_BOOST));var i=Math.round(10*(this.stage+e))/10;this.stage=Math.min(i,Race.STAGES),this.calcFinishPlace(),t||this.race.save()}},BalloonRacer.prototype.getInfo=function(){return{stage:this.stage,skin:this.skin,place:this.place,botId:this.botId,avatarData:this.avatarData}},BalloonRacer.prototype.getStagesDelta=function(){
return this.currentStage()-this.shownStage},BalloonRacer.prototype.setPremSkin=function(e){this.skin="zeppelin",this.onSkinChange(e)},BalloonRacer.prototype.setShownStage=function(e){this.shownStage=e},BalloonRacer.prototype.hasFinished=function(){return this.currentStage()>=Race.STAGES},BalloonRacer.prototype.currentStage=function(){return Math.floor(this.stage)},BalloonRacer.prototype.calcFinishPlace=function(){return this.hasFinished()&&void 0===this.place&&(this.place=this.race.nextEmptyPlace,this.race.nextEmptyPlace++,this.race.save(),this.isPlayer&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.RACE_FINISH_PLACE+"_"+this.place)),this.place};var RaceMissionLogic=function(e){this.mission=e,this.race=new Race(this.mission)};RaceMissionLogic.prototype.onChangeResults=function(){this.race.processBots()},RaceMissionLogic.prototype.wantsToActOnFinish=function(){return 7<=this.race.getPlayer().currentStage()&&!this.race.completeShown},RaceMissionLogic.prototype.receiveReward=function(
){},RaceMissionLogic.prototype.hasIntent=function(){return this.race.startedPlaying},RaceMissionLogic.prototype.setIntent=function(){this.race.startedPlaying=!0},RaceMissionLogic.prototype.skipNext=function(){return!this.mission.isRunning()},RaceMissionLogic.prototype.willUseIntent=function(e){switch(delete this.race.startedPlaying,cleverapps.Plot.decideNext(e)){case Boatswain.NEXT_INTENT:return!0;case Boatswain.EXIT_INTENT:return!this.mission.isRunning()||!e.isCurrentLevel();default:return!1}},RaceMissionLogic.prototype.processEvent=function(e,t){e===Mission.EVENT_LEVEL_FINISH&&this.race.startedPlaying&&this.race.addRacerProgress()},RaceMissionLogic.IsAvailable=function(){return!!cleverapps.payments.isAvailable()&&-1!==["wordsoup"].indexOf(cleverapps.config.name)},cleverapps.styles.RaceDialogues={grandFather:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{animation:"animation",position:"right",styles:{json:bundles.race.jsons.gradfather,
title:"messages:person1"}},!0),hero:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{animation:"talk",styles:{json:bundles.main.jsons.hero_json,title:"messages:person0"}},!0)},Race.DIALOGUES_DATA=[{premium:!0,data:[{text:"messages:Race.dialogue.prem_stage_9.0",person:cleverapps.styles.RaceDialogues.grandFather},{text:"messages:Race.dialogue.prem_stage_9.1",person:cleverapps.styles.RaceDialogues.hero}]},{stage:0,data:[{text:"messages:Race.dialogue.stage_0.0",person:cleverapps.styles.RaceDialogues.grandFather},{text:"messages:Race.dialogue.stage_0.1",person:cleverapps.styles.RaceDialogues.hero},{text:"messages:Race.dialogue.stage_0.2",person:cleverapps.styles.RaceDialogues.grandFather}]},{stage:7,data:[{text:"messages:Race.dialogue.stage_7.0",person:cleverapps.styles.RaceDialogues.grandFather},{text:"messages:Race.dialogue.stage_7.1",person:cleverapps.styles.RaceDialogues.hero}]},{stage:9,noPremium:!0,data:[{text:"messages:Race.dialogue.free_stage_9.0",
person:cleverapps.styles.RaceDialogues.grandFather},{text:"messages:Race.dialogue.free_stage_9.1",person:cleverapps.styles.RaceDialogues.hero}]},{stage:16,noPremium:!0,data:[{text:"messages:Race.dialogue.free_stage_16.0",person:cleverapps.styles.RaceDialogues.grandFather},{text:"messages:Race.dialogue.free_stage_16.1",person:cleverapps.styles.RaceDialogues.hero}]},{stage:50,data:[{text:"messages:Race.dialogue.stage_50.0",person:cleverapps.styles.RaceDialogues.grandFather},{text:"messages:Race.dialogue.stage_50.1",person:cleverapps.styles.RaceDialogues.hero}]}],Race.REWARDS=[{stage:7,gold:100},{stage:9,gold:500,premium:!0},{stage:13,gold:120},{stage:16,gold:650,premium:!0},{stage:18,gold:145},{stage:23,gold:800,premium:!0},{stage:25,gold:170},{stage:30,gold:950,premium:!0},{stage:32,gold:200},{stage:37,gold:1200,premium:!0},{stage:39,gold:225},{stage:44,gold:1600,premium:!0},{stage:46,gold:250},{stage:50,gold:1800,premium:!0}];var RaceScene=cleverapps.FixedWidthScene.extend({
ctor:function(e){this._super(cleverapps.Environment.SCENE_RACE),this.race=e.race,this.mission=e,this.createScroll(),this.createSideBg(),this.createPlayers(),this.createRewards(),this.addPlayButton(),this.addProductIcon(),this.addFlags(),this.addPodium(),this.addFinishLine(),this.addFanCounter(),this.scrollToBalloon(),this.needProgressShow=!0,this.race.onBreakFinishLine=this.createListener(this.breakFinishLine.bind(this)),this.race.onPremBuy=this.createListener(function(){this.needProgressShow=!0}.bind(this))},getRefreshSceneActionOnChangeSize:function(){return function(e){cleverapps.scenes.replaceScene(new RaceScene(this.mission),e)}.bind(this)},addFanCounter:function(){var e=this.fanCounter=new RaceFunView(this.race);this.scene.addChild(e),e.setPositionRound(cleverapps.styles.RaceScene.fanCounter),cleverapps.UI.makeHideable(e,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("fan_counter",e)},createScroll:function(){var e=new cc.Node;e.setAnchorPoint2(),e.setContentSize2(
this.width,cleverapps.styles.RaceScene.scroll.totalHeight);var t=new cleverapps.Spine(bundles.race.jsons.bg);t.setAnimation(0,"animation",!0),t.setPositionRound(e.width/2,e.height/2),e.addChild(t);var i=this.scroll=new cleverapps.UI.ScrollView(e,{scrollBarEnabled:!1});i.setContentSize2(cc.director.getWinSize()),i.setAnchorPoint(0,0),this.scene.addChild(i),i.y-=cleverapps.UI.getSceneOffsetY()},createSideBg:function(){var e=function(){var e=new cc.Node;e.setAnchorPoint2(),e.setContentSize2(cleverapps.styles.RaceScene.scroll.sideBgWidth[cleverapps.wideMode.mode]*resolutionScale,this.scroll.innerHeight),this.scroll.addChild(e,1);var t=e.animation=new cleverapps.Spine(bundles.race.jsons.trees);return t.setPosition(e.width/2,e.height/2),e.addChild(t),e}.bind(this),t=cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?"mobile_":"web_",i=e();i.animation.setAnimation(0,t+"left",!0),i.setPosition(i.width/2,this.scroll.innerHeight/2);var s=e();s.animation.setAnimation(0,t+"right",!0),
s.setPosition(this.scroll.width-i.width/2,this.scroll.innerHeight/2)},createRewards:function(){var e={width:this.scroll.width,height:this.scroll.innerHeight+cleverapps.styles.RaceScene.activeZone.yPadding};this.rewards=new RaceRewardsNode(this.race,e),this.rewards.setPositionRound(this.scroll.innerWidth/2,this.scroll.innerHeight/2),this.scroll.addChild(this.rewards,2)},createPlayers:function(){var e=cleverapps.styles.RaceScene.activeZone,t={width:Math.max(e.balloonsNode.minWidth,Math.min(e.balloonsNode.maxWidth,.7*this.scroll.width)),height:this.scroll.innerHeight+e.yPadding};this.balloonsNode=new BalloonsNode(this.race,t),this.balloonsNode.setPositionRound(this.scroll.width/2,this.scroll.innerHeight/2),this.scroll.addChild(this.balloonsNode,3)},addPlayButton:function(){if(this.mission.isRunning()){var e=cleverapps.styles.RaceScene.playButton,t=new cleverapps.UI.Button({width:e.width,height:e.height,text:Messages.get("Play"),onClicked:function(){cleverapps.metha.display({
focus:"BalloonsPlayButton",control:["toolbar","sidebar"],action:function(e){this.race.mission.logic.setIntent(),cleverapps.metha.wantsToPlay(e)}.bind(this)})}.bind(this)});this.scene.addChild(t),t.setPositionRound(e),cleverapps.UI.makeHideable(t,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("race_playButton",t)}},addProductIcon:function(){var e=new cleverapps.Spine(bundles.race.jsons.product_icon);e.setAnimation(0,"animation",!0);var t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(cleverapps.styles.RaceScene.productIcon),e.setPositionRound(t.width/2,t.height/2),t.addChild(e),this.scene.addChild(t),t.setPositionRound(cleverapps.styles.RaceScene.productIcon),cleverapps.UI.makeHideable(t),cleverapps.UI.applyHover(t),cleverapps.UI.onClick(t,function(){cleverapps.metha.display({focus:"RacePremWindow",action:function(e){new RaceBuyWindow(this.race),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})}.bind(this)),cleverapps.metha.registerControl("race_productIcon",t)},
addFlags:function(){var s=cleverapps.styles.RaceScene.flags;["start_left","start_right","finish_left","finish_right"].forEach(function(e){e=e.split("_");var t=new cleverapps.Spine(bundles.race.jsons.flag);t.setAnimation(0,"animation",!0),t.setSkin(e[0]),t.setScale(s.scale[cleverapps.wideMode.mode]),"left"===e[1]&&t.setScaleX(-t.scaleX),this.scroll.addChild(t,"start"===e[0]?2:1);var i=s["xOffset_"+e[0]][cleverapps.wideMode.mode]*resolutionScale;t.setPosition({x:"left"===e[1]?i:this.scroll.width-i,y:s[e[0]+"Y"]})}.bind(this))},scrollToBalloon:function(e,t){e=void 0!==e?e:0,t=t||this.balloonsNode.balloons[Race.PLAYER_ID],this.scroll.scrollTo(t.y+t.height-this.scroll.height/2,e)},showProgress:function(){this.needProgressShow=!1,this.balloonsNode.moveBots(),cleverapps.metha.display({focus:"RaceProgress",control:["fan_counter"],actions:[function(e){this.race.justStarted()?this.showStart(e):e()}.bind(this),this.playerProgress.bind(this),function(e){this.mission.isRunning(
)||this.race.completeShown?e():this.complete(e)}.bind(this)]})},playerProgress:function(e){cleverapps.metha.compound(e,this.createPlayerCycle())},createPlayerCycle:function(e){e=e||[];var t=this.race.calcPlayerStepDelta(),i=this.race.getPlayer();i.setShownStage(i.shownStage+t);var s=i.shownStage;return e=e.concat([function(e){this.playerFlight(e,s,t)}.bind(this),function(e){this.rewards.giveRewards(e,s)}.bind(this),function(e){this.race.justBoughtPrem?this.premTransform(e):this.intermediateDialogue(e,s,t)}.bind(this),function(e){0<t&&16===s?this.suggestPremium(e):e()}.bind(this)]),0<t&&(e=this.createPlayerCycle(e)),e},playerFlight:function(e,t,i){if(0!==i){var s=this.balloonsNode.movePlayerBalloon(e,i,t);this.scroll.scrollTo(s.targetY-this.scroll.height/2,s.time),this.rewards.animatePremiumChests(t,i),this.fanCounter.updateAmount(i)}else e()},breakFinishLine:function(e){1===this.race.balloonsOnFinish()&&this.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.CallFunc(function(){
this.finishLine.setAnimation(0,"finish",!1),this.finishLine.addAnimation(0,"finish_idle",!0)}.bind(this))))},complete:function(e){cleverapps.metha.compound(e,[function(e){this.race.complete(),e()}.bind(this),function(e){new RaceFinishWindow(this.race),cleverapps.metha.onceNoWindowsListener=e}.bind(this),function(e){var t=this.race.getFinishReward();t?(new RewardWindow({reward:t}),cleverapps.metha.onceNoWindowsListener=e):e()}.bind(this),function(e){this.suggestPremium(e)}.bind(this)])},showStart:function(e){cleverapps.metha.compound(e,[function(e){var t=this.race.getActiveDialogue(0);this.showDialogue(t.dialogue,e)}.bind(this),function(e){new RaceStartWindow(this.race),cleverapps.metha.onceNoWindowsListener=e}.bind(this),function(e){this.race.showedStart(),e()}.bind(this)])},premTransform:function(e){cleverapps.metha.compound(e,[function(e){var t=this.race.getPremDialogue();this.showDialogue(t.dialogue,e)}.bind(this),function(e){this.race.getPlayer().setPremSkin(e)}.bind(this),
function(e){this.race.transforedPrem(),e()}.bind(this)])},intermediateDialogue:function(e,t,i){var s=this.race.getActiveDialogue(t);s&&(0<i||this.race.justBoughtPrem)?this.showDialogue(s.dialogue,e):e()},suggestPremium:function(e){this.race.boughtPremium?e():(new RaceBuyWindow(this.race),cleverapps.metha.onceNoWindowsListener=e)},showDialogue:function(e,t){t=t||function(){};var i=new Dialogue(e,{showUp:!0,autoClose:!0});i.on("afterClose",t),new DialogueView(i,{autoPosition:!0,overlay:!0}),i.run()},addFinishLine:function(){var e=cleverapps.styles.RaceScene.finishLine,t=this.finishLine=new cleverapps.Spine(bundles.race.jsons.finish_line);t.setAnimation(0,0<this.race.balloonsOnFinish()?"finish_idle":"idle",!0),t.setScale(e.scale[cleverapps.wideMode.mode]),this.scroll.addChild(t),t.setPositionRound(this.scroll.width/2,this.scroll.innerHeight+e.yOffset)},addPodium:function(){var i=cleverapps.styles.RaceScene.podium;[new cc.Sprite(bundles.race.frames.first),new cc.Sprite(
bundles.race.frames.second),new cc.Sprite(bundles.race.frames.third)].forEach(function(e,t){e.setScale(i.scale[cleverapps.wideMode.mode]),this.scroll.addChild(e),e.setPositionRound({x:this.scroll.width/2+i.xOffset[t]*resolutionScale*e.scale,y:this.scroll.innerHeight+i.yOffset[t]*resolutionScale})},this)},getAudioStyles:function(){return cleverapps.styles.RaceScene.sound}});RaceScene.BUNDLES=["race","dialogues"],cleverapps.styles.RaceScene={scroll:{totalHeight:5764,sideBgWidth:[70,200,200]},flags:{scale:[.7,1,1],startY:350,finishY:5340,xOffset_start:[60,300,300],xOffset_finish:[60,380,380]},activeZone:{yPadding:-800,balloonsNode:{minWidth:500,maxWidth:1050}},playButton:{width:200,height:110,x:{align:"center"},y:{align:"bottom",dy:100}},productIcon:{width:170,height:170,x:{align:"left",dx:40},y:{align:"top",dy:-200}},podium:{scale:[.7,1,1],xOffset:[0,-250,250],yOffset:[-250,-300,-300]},finishLine:{scale:[.62,1,1],yOffset:-470},fanCounter:{x:{align:"right",dx:-30},y:{align:"bottom",dy:110
}},sound:{res:bundles.race.urls.race_bg_music,delay:.5}};var RaceRewardsNode=cc.Node.extend({ctor:function(e,t){this._super(),this.race=e,this.views={},this.setAnchorPoint2(),this.setContentSize2(t),Race.REWARDS.forEach(function(e){this.createReward(e)},this)},createReward:function(e){var t=e.stage,i=cleverapps.styles.RaceRewardsNode.rewards,s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(i.width,i[e.premium?"premHeight":"height"]),s.setScale(i.scale[cleverapps.wideMode.mode]),s.baseScale=s.getScale(),s.reward=e,this.addChild(s);var n=i.offsetX[cleverapps.wideMode.mode]*resolutionScale;s.setPositionRound({x:e.premium?n:this.width-n,y:i.baseY+this.height/Race.STAGES*t});var o=s.animation=new cleverapps.Spine(bundles.race.jsons.chest);o.grade=e.premium?"gold_":"free_",o.setPositionRound(s.width/2,s.height/2),s.addChild(o);var a=o.grade+"idle";a+=this.race.isRewardReceived(t)?"_open":"",o.setAnimation(0,a,!0),this.views[t]=s,this.race.isRewardReceived(t)||(cleverapps.UI.applyHover(s),
cleverapps.UI.onClick(s,this.chestPressed.bind(this,e)))},chestPressed:function(t){this.race.isRewardReceived(t.stage)||cleverapps.metha.display({focus:"RaceChestWindow",action:function(e){new RaceChestWindow(t,this.race),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},setRewardsCollected:function(n,o){n.forEach(function(e,t){var i=e.stage;cleverapps.UI.removeHover(this.views[i]);var s=this.views[i].animation;s.setAnimation(0,s.grade+"unlock",!1),s.runAction(new cc.Sequence(new cc.DelayTime(cleverapps.styles.RaceRewardsNode.delay[s.grade+"sfx"]),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.race.urls[s.grade+"chest_sfx"])}))),s.setCompleteListener(function(){s.setCompleteListener(function(){}),s.addAnimation(0,s.grade+"idle_open",!0),t===n.length-1&&o()})},this)},animatePremiumChests:function(e,t){if(!this.race.boughtPremium){var i=e-t,s=function(e){var t=this.views[e].animation;t.setAnimation(0,t.grade+"ready",!1),t.addAnimation(0,t.grade+"idle",!1)};for(
var n in this.views)n<=e&&i<n&&this.views[n].reward.premium&&this.views[n].runAction(new cc.Sequence(new cc.DelayTime(Balloon.getFlyTime(n-i)-.1),new cc.CallFunc(s.bind(this,n))))}},giveRewards:function(e,t){var i=this.race.getActiveRewards(t);i.length?cleverapps.metha.compound(e,[function(e){this.setRewardsCollected(i,e)}.bind(this),function(e){new RewardWindow({reward:this.race.collectRewards(i)}),cleverapps.metha.onceNoWindowsListener=e}.bind(this)]):e()}});cleverapps.styles.RaceRewardsNode={delay:{free_sfx:.85,gold_sfx:.515},rewards:{width:150,premHeight:250,height:170,baseY:-120,offsetX:[90,220,220],scale:[.65,1,1]}};var BalloonsNode=cc.Node.extend({ctor:function(e,t){this._super(),this.race=e,this.setAnchorPoint2(),this.setContentSize2(t),this.createBalloons()},createBalloons:function(){this.balloons={};var e=this.race.getRacers(),t=this.height/Race.STAGES,i=this.width/Object.keys(e).length,s=Math.min(1,this.width/(cleverapps.styles.Balloon.width*Object.keys(e).length));for(
var n in e){var o=new Balloon(e[n]);o.setScale(s);var a={x:i/2+i*n,y:t*e[n].shownStage};o.setPositionRound(a),this.addChild(o,1),this.balloons[n]=o}},moveBots:function(){for(var e in this.balloons){var t=this.balloons[e],i=t.player.getStagesDelta();i&&!t.player.isPlayer&&(t.player.setShownStage(t.player.currentStage()),this.moveBalloon(t,i,t.player.currentStage()))}},movePlayerBalloon:function(e,t,i){var s=this.balloons[Race.PLAYER_ID],n=this.moveBalloon(s,t,i);return s.runAction(new cc.Sequence(new cc.DelayTime(n.time),new cc.CallFunc(e))),{time:n.time,targetY:n.target.y+s.height}},moveBalloon:function(e,t,i){var s=Balloon.getFlyTime(t);e.setLocalZOrder(e.getLocalZOrder()+10);var n={x:e.x,y:e.y+this.height/Race.STAGES*t};return e.flyTo(s,n),i>=Race.STAGES&&this.race.onBreakFinishLine(s),{time:s,target:n}}}),Balloon=cc.Node.extend({ctor:function(e){this._super(),this.player=e;var t=cleverapps.styles.Balloon;this.setAnchorPoint2(),this.setContentSize2(t)
;var i=this.animation=new cleverapps.Spine(bundles.race.jsons.balloon);i.setSkin(e.skin),i.setPositionRound(this.width/2,this.height/2),this.addChild(i),i.runAction(new cc.Sequence(new cc.DelayTime(.1*cleverapps.Random.random(0,8)),new cc.CallFunc(i.setAnimation.bind(i,0,this.getAnimationName("idle"),!0)))),this.addAvatar(),this.player.onSkinChange=this.createListener(this.transform.bind(this))},addAvatar:function(){var e=cleverapps.styles.Balloon.avatar,t=new cleverapps.UI.Avatar(this.player.avatarData);this.addChild(t),t.setScale(e.scale),t.setPositionRound(e)},flyTo:function(e,t){this.player.isPlayer&&(this.animateFan(),this.playSound()),this.animation.setAnimation(0,this.getAnimationName("fly"),!0),this.runAction(new cc.Sequence(new cc.MoveTo(e,t).easing(cc.easeInOut(2)),new cc.CallFunc(this.animation.setAnimation.bind(this.animation,0,this.getAnimationName("idle"),!0))))},playSound:function(){cleverapps.audio.playSound(bundles.race.urls.fly_sfx)},animateFan:function(){this.fan||(
this.fan=new cleverapps.Spine(bundles.race.jsons.fan),this.addChild(this.fan),this.fan.setPositionRound(this.width/2,cleverapps.styles.Balloon.fan.offsetY*this.scale),this.fan.setCompleteListener(function(){this.fan.setVisible(!1)}.bind(this))),this.fan.setVisible(!0),this.fan.setAnimation(0,"animation3",!1)},transform:function(e){this.player.isPlayer&&(this.animation.setSkin(this.player.skin),this.animation.setAnimation(0,"transition",!1),this.animation.setCompleteListener(function(){this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,this.getAnimationName("idle"),!0),e()}.bind(this)))},getAnimationName:function(e){return this.player.isPlayer&&this.player.race.boughtPremium?"prem_"+e:e}});Balloon.getFlyTime=function(e){return Balloon.FLY_EASING_TIME+Balloon.FLYTHROUGH_TIME*e},Balloon.FLYTHROUGH_TIME=.3,Balloon.FLY_EASING_TIME=.4,cleverapps.styles.Balloon={width:160,height:400,fan:{offsetY:-200},avatar:{scale:.7,x:{align:"center"},y:{align:"center",dy:40}}}
;var RaceFunView=cc.Node.extend({ctor:function(e){this._super(),this.race=e,this.setAnchorPoint2(),this.setContentSize2(cleverapps.styles.RaceFunView),this.addBg(),this.addIcon(),this.addText(),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,this.onClick.bind(this))},onClick:function(){cleverapps.metha.display({focus:"RaceRulesWindow",action:function(e){new RulesWindow({name:"ruleswindow",styles:cleverapps.styles.RaceFunView.rulesWindow}),cleverapps.metha.onceNoWindowsListener=e}})},addBg:function(){var e=cleverapps.UI.createScale9Sprite(bundles.menubar.frames.menu_gold_bg_png);e.setContentSize2(this.getContentSize()),e.setPositionRound(this.width/2,this.height/2),this.addChild(e)},addIcon:function(){var e=new cc.Sprite(bundles.race.frames.fan_count);this.addChild(e),e.setPositionRound(cleverapps.styles.RaceFunView.icon)},addText:function(){this.counter=cleverapps.UI.generateTTFText(this.race.getPlayer().getStagesDelta(),cleverapps.styles.FONTS.MENUBAR_TEXT),this.addChild(
this.counter),this.counter.setPositionRound(cleverapps.styles.RaceFunView.counter)},updateAmount:function(t){if(0!==t){var i=parseInt(this.counter.getString()),e=Balloon.getFlyTime(t)/t,s=function(){this.counter.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.CallFunc(function(){t--;var e=Math.max(0,--i);this.counter.setString(e),0<t&&s()}.bind(this))))}.bind(this);s()}}});cleverapps.styles.RaceFunView={width:180,height:90,icon:{x:{align:"left",dx:10},y:{align:"center"}},counter:{x:{align:"center",dx:35},y:{align:"center"}},rulesWindow:{prefix:"messages:Race.rules.",animation:{json:bundles.race.jsons.rules,name:"animation",height:700},subText:{width:220,left:{x:{align:"left",dx:25},y:{align:"right",dy:-250}},right:{x:{align:"right",dx:-10},y:{align:"right",dy:-250}}}}};var RaceStartWindow=Window.extend({onWindowLoaded:function(e){this.race=e,this.product=Product.Create("raceKey"),this._super({name:"startracewindow",title:"messages:RaceStartWindow.title",content:this.getContent(),
styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.RaceStartWindow.Window,!0)})},getContent:function(){var e=[!1,!0].map(function(e){return this.createCard(e)},this);return new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.RaceStartWindow.margin})},createCard:function(e){var t=cleverapps.styles.RaceStartWindow.card,i=e?"prem_":"",s=cleverapps.UI.createScale9Sprite(bundles.race.frames[i+"card_bg"]);s.setContentSize2(t);var n=new cleverapps.Layout([this.createCardButton(e),this.createCardDescription(i),this.createCardTitle(i),this.createCardIcon(i)],{direction:cleverapps.UI.VERTICAL,margin:t.margin});return s.addChild(n),n.setPositionRound(s.width/2,s.height/2),e&&(this.addBadge(s),this.addPrice(s)),cleverapps.UI.onClick(s,this.onPress.bind(this,e)),cleverapps.UI.applyHover(s),s},createCardIcon:function(e){var t=cleverapps.styles.RaceStartWindow.card.icon,i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(t)
;var s=new cleverapps.Spine(bundles.race.jsons.card_icon_json);return s.setAnimation(0,e+"animation",!0),i.addChild(s),s.setPositionRound(i.width/2,i.height/2),i},createCardTitle:function(e){var t=cleverapps.styles.RaceStartWindow.card.title,i=cleverapps.UI.createScale9Sprite(bundles.race.frames[e+"card_title_bg"]);i.setContentSize2(t);var s="messages:RaceStartWindow."+e+"card.title",n=cleverapps.styles.FONTS[e.toUpperCase()+"RACE_CARD_TITLE_TEXT"],o=cleverapps.UI.generateTTFText(s,n);return i.addChild(o),o.setPositionRound(i.width/2,i.height/2),o.fitTo(.9*i.width),i},createCardDescription:function(i){var s=cleverapps.styles.RaceStartWindow.card.description,e=cleverapps.UI.createScale9Sprite(bundles.race.frames.card_text_bg);e.setContentSize2(s);var t=[3,2,1].map(function(e){var t=cleverapps.UI.generateTTFText("messages:RaceStartWindow."+i+"card.text"+e,cleverapps.styles.FONTS.RACE_CARD_DESCRIPTION_TEXT);return t.setDimensions(s.textWidth,0),t.setHorizontalAlignment(
cc.TEXT_ALIGNMENT_LEFT),t}),n=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL,margin:s.margin});return e.addChild(n),n.setPositionRound(e.width/2,e.height/2),e},createCardButton:function(e){var t=cleverapps.styles.RaceStartWindow.card.button;return new cleverapps.UI.Button({button_png:e?bundles.buttons_main.frames.small_green_button:bundles.buttons_main.frames.small_blue_button,button_on_png:e?bundles.buttons_main.frames.small_green_button_on:bundles.buttons_main.frames.small_blue_button_on,width:t.width,height:t.height,maxWidth:t.maxWidth,padding:t.padding,text:"messages:RaceStartWindow."+(e?"premButton":"freeButton"),onClicked:this.onPress.bind(this,e)})},addBadge:function(e){var t=cleverapps.styles.RaceStartWindow.card.badge,i=new cc.Sprite(bundles.race.frames.badge),s=Messages.get("RaceBuyWindow.price")+"\n"+this.product.getCurrentPrice(),n=cleverapps.UI.generateTTFText(s,cleverapps.styles.FONTS.TILE_SHOP_BADGE_TEXT);n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),
n.fitTo(80),i.addChild(n),n.setPositionRound(i.width/2,i.height/2),n.setRotation(t.rotation),e.addChild(i),i.setPositionRound(t)},addPrice:function(e){var t,i=cleverapps.styles.RaceStartWindow.card.price;t=cleverapps.payments.calcLoadedPrice?cleverapps.payments.calcLoadedPrice(this.product.oldPrice):Product.CURRENCY+" "+this.product.oldPrice;var s=cleverapps.UI.generateTTFText("messages:RaceStartWindow.priceText",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,{price:t});s.fitTo(i.width),e.addChild(s),s.setPositionRound(i)},onPress:function(e){e&&!this.race.boughtPremium?this.product.buy(function(){this.race.setPremium(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.RACE_BUY_PREM+"_"+this.race.getPlayer().currentStage()),this.runAction(new cc.CallFunc(function(){this.close()}.bind(this)))}.bind(this)):this.close()}});cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{RACE_PREM_STROKE:{color:new cc.color(124,11,2),size:1},RACE_PREM_SHADOW:{color:new cc.color(124,11,2),
direction:cc.size(0,-2),blur:1}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{RACE_CARD_TITLE_TEXT:{size:45,color:cleverapps.styles.COLORS.WHITE,stroke:{color:new cc.color(32,38,102),size:1},shadow:{color:new cc.color(32,38,102),direction:cc.size(0,-2),blur:1}},PREM_RACE_CARD_TITLE_TEXT:{size:45,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.RACE_PREM_STROKE,shadow:cleverapps.styles.DECORATORS.RACE_PREM_SHADOW},RACE_CARD_DESCRIPTION_TEXT:{size:18,color:cleverapps.styles.COLORS.COLOR_BROWN}}),cleverapps.styles.RaceStartWindow={margin:5,card:{width:325,height:600,margin:8,title:{width:310,height:65},icon:{width:150,height:150},description:{width:285,height:200,textWidth:265,margin:10},button:{width:150,maxWidth:150,height:75,padding:{x:20}},badge:{rotation:-12,x:{align:"right",dx:20},y:{align:"bottom",dy:-15}},price:{width:135,x:{align:"center",dx:0},y:{align:"bottom",dy:20}}},Window:{contentOffset:-65,Border:{x:35,y:140}}};var RaceBuyWindow=Window.extend(
{onWindowLoaded:function(e){this.race=e,this._super({title:{text:this.race.boughtPremium||this.race.mission.isRunning()?"messages:RaceBuyWindow.title":"messages:RaceBuyWindow.title2",font:cleverapps.styles.FONTS.RACE_BUY_TITLE_TEXT},name:"racebuywindow",content:this.createContent(),styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.RaceBuyWindow.Window,!0)}),this.addButton()},createContent:function(){var e=cleverapps.styles.RaceBuyWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.content);var i=new cleverapps.Spine(bundles.race.jsons.buy_window_json);i.setAnimation(0,"animation",!0),i.setPositionRound(t.width/2,t.height/2),t.addChild(i);var s=this.createText();t.addChild(s),s.setPositionRound(e.text);var n=this.createSubTitle();return t.addChild(n),n.setPositionRound(e.subTitle),t},createText:function(){var n=cleverapps.styles.RaceBuyWindow.text,e=[3,2,1].map(function(e){return t=Messages.get("RaceBuyWindow.text"+e),i=new cc.Sprite(
bundles.race.frames.small_key),(s=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.RACE_DESCRIPTION_TEXT)).setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),s.setDimensions(n.width,0),new cleverapps.Layout([i,s],{direction:cleverapps.UI.HORIZONTAL,margin:n.margin});var t,i,s});return new cleverapps.Layout(e,{direction:cleverapps.UI.VERTICAL,margin:n.linesMargin})},createSubTitle:function(){var e=cleverapps.styles.RaceBuyWindow.subTitle,t=cleverapps.UI.generateTTFText("messages:RaceBuyWindow.subTitle",cleverapps.styles.FONTS.RACE_SUBTITLE_TEXT),i=new cc.Sprite(bundles.menubar.frames.coin_png);return i.setScale(e.scale),new cleverapps.Layout([t,i],{direction:cleverapps.UI.HORIZONTAL,margin:e.margin})},addButton:function(){var e=cleverapps.styles.RaceBuyWindow.button,t=Product.Create("raceKey"),i=new cleverapps.UI.Button({button_png:bundles.buttons.frames.green_button_png,button_on_png:bundles.buttons.frames.green_button_on_png,text:Messages.get(this.race.boughtPremium?"OK":"GetIt"),
width:e.width,onClicked:this.onPressed.bind(this,t)});if(this.window.addChild(i),i.setPositionRound(e),!this.race.boughtPremium){var s=cleverapps.UI.generateTTFText(Messages.get("RaceBuyWindow.price")+" "+t.getCurrentPrice(),cleverapps.styles.FONTS.RACE_PRICE_TEXT);this.window.addChild(s),s.setPositionRound(i.x,i.y+e.priceOffset)}},onPressed:function(e){this.race.boughtPremium?this.close():e.buy(function(){this.race.setPremium(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.RACE_BUY_PREM+"_"+this.race.getPlayer().currentStage()),this.runAction(new cc.CallFunc(function(){this.close()}.bind(this)))}.bind(this))}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{RACE_DESCRIPTION_TEXT:{size:17,color:cleverapps.styles.COLORS.COLOR_BROWN},RACE_SUBTITLE_TEXT:{size:20,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.RACE_PREM_STROKE},RACE_PRICE_TEXT:{size:19,color:cleverapps.styles.COLORS.WHITE},RACE_BUY_TITLE_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE,
stroke:cleverapps.styles.DECORATORS.RACE_PREM_STROKE,shadow:cleverapps.styles.DECORATORS.RACE_PREM_SHADOW}}),cleverapps.styles.RaceBuyWindow={button:{width:190,height:80,priceOffset:-75,x:{align:"center"},y:{align:"bottom",dy:-120}},content:{width:550,height:650},text:{width:250,margin:5,linesMargin:10,x:{align:"center"},y:{align:"center",dy:-188}},subTitle:{width:200,scale:.43,margin:5,x:{align:"center"},y:{align:"center",dy:-60}},Window:{noBackground:!0,Title:{bg:!1,offset:115},maxTitleSize:{scale:.8}}};var RaceChestWindow=Window.extend({onWindowLoaded:function(e,t){this.race=t,this.premium=void 0!==e.premium&&!t.boughtPremium,this.reward=e,this._super({title:"messages:RaceChestWindow.title",name:"racechestwindow",content:this.getContent(),button:this.getButton()})},getButton:function(){var e=cleverapps.styles.RaceChestWindow.button;return{text:this.premium?Messages.get("RaceChestWindow.button"):Messages.get("OK"),width:e.width,onPressed:function(){this.close(),
this.premium&&new RaceBuyWindow(this.race)}.bind(this)}},getContent:function(){var e=new RewardsListComponent(this.reward),t=cleverapps.styles.RaceChestWindow.content,i=this.premium?"messages:RaceChestWindow.textPremium":"messages:RaceChestWindow.text",s=cleverapps.UI.generateTTFText(i,cleverapps.styles.FONTS.WINDOW_TEXT);return s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setDimensions(t.textWidth,0),new cleverapps.Layout([s,e],{direction:cleverapps.UI.VERTICAL,margin:t.margin,padding:t.padding})},listBundles:function(){return["tile_shop"]}});cleverapps.styles.RaceChestWindow={content:{margin:10,textWidth:450,padding:{x:0,y:30}},button:{width:150}};var RaceFinishWindow=Window.extend({onWindowLoaded:function(e){this.race=e,this._super({title:"messages:RaceFinishWindow.title",name:"racefinishwindow",content:this.getContent(),button:this.getButton()}),this.addChild(new Fireworks),cleverapps.audio.playSound(bundles.race.urls.finish_win_sfx)},getContent:function(){
var e=cleverapps.styles.RaceFinishWindow,t=this.race.getCurrentPlayerPlace(),i=new cleverapps.Spine(bundles.race.jsons.finish_win);i.setSkin((this.race.boughtPremium?"b":"a")+t),i.setAnimation(0,"start",!1),i.addAnimation(0,"idle",!0);var s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(e.animation),s.addChild(i),i.setPositionRound(s.width/2,s.height/2);var n=Messages.get(t<3?"RaceFinishWindow.rewarded_text":"RaceFinishWindow.text"),o=cleverapps.UI.generateTTFText(n,cleverapps.styles.FONTS.WINDOW_TEXT);return o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.setDimensions(e.text.width,0),new cleverapps.Layout([o,s],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:e.padding})},getButton:function(){var e=cleverapps.styles.RaceFinishWindow.button;return{text:Messages.get("OK"),width:e.width,onPressed:function(){this.close()}.bind(this)}}});cleverapps.styles.RaceFinishWindow={margin:15,padding:{x:0,y:20},animation:{width:500,height:400},text:{width:450},button:{width:130}}
;var RaffleWindow=Window.extend({onWindowLoaded:function(e){this.mission=e,this.mission||(this.teaser=!0),this.createContent(),this._super({content:this.content,title:"messages:RaffleWindow.title",name:"rafflewindow",button:this.createButton(),help:function(){new RaffleRulesWindow}})},createButton:function(){return{width:cleverapps.styles.RaffleWindow.button.width,height:cleverapps.styles.RaffleWindow.button.height,text:Messages.get(this.teaser?"OK":"Play"),onPressed:function(){this.close(),this.teaser||cleverapps.metha.distract({focus:"RafflePlayButtonPressed",action:function(e){cleverapps.metha.wantsToPlay(e)}})}.bind(this)}},createContent:function(){this.content=new cleverapps.Layout([this.createAnnotation(),this.createTickets(),this.createDescription()],{direction:cleverapps.UI.VERTICAL,margin:cleverapps.styles.RaffleWindow.margin,padding:cleverapps.styles.RaffleWindow.padding})},createDescription:function(){var e=cleverapps.styles.RaffleWindow.description,
t=cleverapps.UI.generateTTFText("messages:RaffleWindow.subTitle",cleverapps.styles.FONTS.WINDOW_TEXT);t.setDimensions(e.subTitleWidth,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var i=cleverapps.UI.generateTTFText("messages:RaffleWindow.description",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return i.setDimensions(e.descriptionWidth,0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),new cleverapps.Layout([i,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin})},createTickets:function(){var e=cleverapps.styles.RaffleWindow.tickets,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.animation);var i=new cleverapps.Spine(bundles.raffle_window.jsons.tickets_json);return i.setAnimation(0,RaffleMissionLogic.getAnimationName(),!0),t.addChild(i),i.setPositionRound(t.width/2,t.height/2),new cleverapps.Layout([this.teaser?this.createTeaser():this.createBar(),t],{direction:cleverapps.UI.VERTICAL})},createTeaser:function(){var e=cleverapps.styles.RaffleWindow.description,
t=cleverapps.UI.generateTTFText("messages:RaffleWindow.teaser",cleverapps.styles.FONTS.WINDOW_TEXT);return t.setDimensions(e.subTitleWidth,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t},createBar:function(){var e=cleverapps.styles.RaffleWindow.tickets.bar,t=cleverapps.UI.createScale9Sprite(bundles.raffle_window.frames.progress_bar_bg);t.setContentSize2(e.width,t.height);var i=new ScaledProgressBar(bundles.raffle_window.frames.progress_bar);i.setPercentage(this.mission.raffle.currentTicketProgress()/RaffleMissionLogic.LVLS_PER_TICKET*100),i.setDimension(t.width,e.height),t.addChild(i),i.setPositionRound(e.offsetX,e.offsetY);var s=this.mission.raffle.currentTicketProgress()+"/"+RaffleMissionLogic.LVLS_PER_TICKET,n=cleverapps.UI.generateTTFText(s,cleverapps.styles.FONTS.WHITE_TEXT);t.addChild(n),n.setPositionRound(t.width/2,t.height/2+e.countOffset);var o=new cc.Sprite(bundles.raffle_window.frames.tickets);t.addChild(o),o.setPositionRound(e.icon)
;var a=cleverapps.UI.generateTTFText(this.mission.raffle.currentTickets(),cleverapps.styles.FONTS.SMALL_WHITE_TEXT);return a.fitTo(e.amount.width),o.addChild(a),a.setPositionRound(e.amount),t},createAnnotation:function(){var e=cleverapps.UI.generateTTFText("messages:RaffleWindow.annotation",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return e.setDimensions(cleverapps.styles.RaffleWindow.annotationWidth,0),e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e},listBundles:function(){return["raffle_window"]}});cleverapps.styles.RaffleWindow={margin:20,annotationWidth:630,padding:{x:0,y:30},button:{width:190,height:110},description:{subTitleWidth:550,descriptionWidth:630,margin:10},tickets:{animation:{width:350,height:300},bar:{width:500,height:45,offsetX:3,offsetY:5,countOffset:-3,amount:{width:40,x:{align:"center",dx:27},y:{align:"bottom",dy:11}},icon:{x:{align:"right",dx:35},y:{align:"center",dy:10}}}}};var RaffleRulesWindow=RulesWindow.extend({onWindowLoaded:function(){
var e=cleverapps.styles.RaffleRulesWindow;e.animation.name=RaffleMissionLogic.getAnimationName(),this._super({name:"rafflexuleswindow",styles:e})},listBundles:function(){return["raffle_window"]}});cleverapps.styles.RaffleRulesWindow={prefix:"messages:RaffleRulesWindow.",animation:{json:bundles.raffle_window.jsons.tickets_rules_json,height:700},subText:{left:{x:{align:"left",dx:35},y:{align:"top",dy:-265}},bottom:{y:{align:"center",dy:-350}}}};var RaffleMissionLogic=function(e){((this.mission=e).raffle=this).load()};RaffleMissionLogic.prototype.load=function(){this.lvlsPassed=this.mission.details.lvlsPassed,void 0===this.lvlsPassed&&(this.lvlsPassed=0)},RaffleMissionLogic.prototype.addProgress=function(){var e=this.currentTickets();if(this.lvlsPassed++,e!==this.currentTickets()){var t=cleverapps.eventManager.getFeatureEvent("raffle").options;cleverapps.eventLogger.logEvent(cleverapps.EVENTS.RAFFLE_RESULT_UPDATE,{raffleName:t&&t.raffleName?t.raffleName:"default",
userId:cleverapps.user.id,amount:this.currentTickets()})}this.save()},RaffleMissionLogic.prototype.save=function(){this.mission.update(0,{lvlsPassed:this.lvlsPassed})},RaffleMissionLogic.prototype.currentTicketProgress=function(){return this.lvlsPassed%RaffleMissionLogic.LVLS_PER_TICKET},RaffleMissionLogic.prototype.processEvent=function(e,t){e===Mission.EVENT_LEVEL_FINISH&&this.levelRewarded(t.level)&&this.addProgress()},RaffleMissionLogic.prototype.levelRewarded=function(e){return e.isRegular()&&e.isNew()||e.episode.isDailyCup()},RaffleMissionLogic.prototype.needVictoryShow=function(e){return this.levelRewarded(e)&&this.justReceivedTicket()},RaffleMissionLogic.prototype.justReceivedTicket=function(){return 0===this.currentTicketProgress()&&0<this.lvlsPassed},RaffleMissionLogic.prototype.currentTickets=function(){return Math.floor(this.lvlsPassed/RaffleMissionLogic.LVLS_PER_TICKET)},RaffleMissionLogic.getAnimationName=function(){var e="animation_ok";return-1!==["web_vk","mobile_vk"
].indexOf(cleverapps.User.calcSource())?e="animation_vk":-1!==["web_mm","mobile_mm"].indexOf(cleverapps.User.calcSource())&&(e="animation_mm"),e},RaffleMissionLogic.IsAvailable=function(){return-1!==["web_vk","mobile_vk"].indexOf(cleverapps.User.calcSource())?-1!==["crocword","heroes"].indexOf(cleverapps.config.name):-1!==["mobile_mm","web_mm","mobile_ok","web_ok"].indexOf(cleverapps.User.calcSource())&&-1!==["wordsoup","crocword","heroes","riddles"].indexOf(cleverapps.config.name)},RaffleMissionLogic.LVLS_PER_TICKET=15;var DailyCupIcon=SideBarIcon.extend({ctor:function(e){var t=cleverapps.overrideStyles(cleverapps.styles.SideBarIcon,cleverapps.styles.DailyCupIcon,!0),i={};-1!==["crocword","wordheaps"].indexOf(cleverapps.config.name)&&(cleverapps.dailyCup.isActive()&&cleverapps.dailyCup.getTimeLeft()&&0<cleverapps.dailyCup.getTimeLeft()?i.leftTime=cleverapps.dailyCup.getTimeLeft():i.title="messages:DailyCupIcon.finished"),this._super(e,t,i),cleverapps.dailyCup.isFinished(
)&&this.turnOnAttention(),cleverapps.dailyCup.updateListeners.iconAttention=this.createListener(function(){cleverapps.dailyCup.isFinished()&&this.turnOnAttention()}.bind(this))},onFinishTimer:function(){-1!==["crocword","wordheaps"].indexOf(cleverapps.config.name)&&(this.hideTimer(),this.addTitle("messages:DailyCupIcon.finished"))},onPressed:function(){this._super(),cleverapps.metha.display({focus:"DailyCupSceneFromIcon",control:["toolbar","sidebar"],action:function(e){cleverapps.scenes.replaceScene(new DailyCupScene,e)}})}});DailyCupIcon.IsAvailable=function(){return cleverapps.dailyCup&&DailyCup.IsAvailable(DailyCup.TYPE_DAILY)&&cleverapps.dailyCup.isActive()},cleverapps.styles.DailyCupIcon={animation:bundles.sidebar.jsons.dailycup_icon_json};var DailyCupPlayButton=cc.Node.extend({ctor:function(e){this._super(),this.options=e;var t=cleverapps.styles.DailyCupPlayButton;if(this.button=this.createButton(),this.addChild(this.button),this.setAnchorPoint2(),this.setContentSize2(
this.button.getContentSize()),this.button.setPositionRound(this.width/2,this.height/2),this.options.parent.addChild(this),this.setPositionRound(t),cleverapps.bet){var i=new CoinsPriceView(cleverapps.Bet.REGEN_AMOUNT,{bg:bundles.main.frames.price_substrate_png});i.setPositionRound(t.price),this.addChild(i)}},createButton:function(){var e=cleverapps.styles.DailyCupPlayButton;return new cleverapps.UI.Button({text:Messages.get("Play"),font:cleverapps.styles.FONTS.BIG_BUTTON_TEXT,onClicked:this.options.onClicked,width:e.width,height:e.height,button_png:e.button_png,button_on_png:e.button_on_png,padding:{x:e.titlePaddingX}})},enable:function(){this.button.enable()},disable:function(){this.button.disable()},setTitle:function(e){var t=cleverapps.styles.DailyCupPlayButton;this.button.text.setString(Messages.get(e)),this.button.text.fitTo(this.button.width-2*t.titlePaddingX)}});cleverapps.styles.DailyCupPlayButton={x:{align:"center"},y:{align:"bottom",dy:120},width:300,height:125,
titlePaddingX:20,price:{x:{align:"center"},y:{align:"center",dy:-90}}};var DailyCupScene=cleverapps.FixedWidthScene.extend({ctor:function(){this._super(cleverapps.Environment.SCENE_DAILY_CUP),this.mainContainer=new cc.Node,this.mainContainer.setAnchorPoint2(),this.mainContainer.setContentSize(this.scene.getContentSize()),this.mainContainer.setPositionRound(this.scene.width/2,this.scene.height/2),cleverapps.UI.makeHideable(this.mainContainer,cleverapps.UI.SCALE_ANIMATION),cleverapps.metha.registerControl("dailyCupMainContainer",this.mainContainer),this.scene.addChild(this.mainContainer),this.table=new DailyCupTable(cleverapps.dailyCup,cleverapps.styles.DailyCupTable,cleverapps.DailyCupRow,this.mainContainer),this.createTableBg(),this.createTitleBg(),this.createTitle(),this.createPlayButton(),this.createHelpButton(),this.createLeadersButton(),cleverapps.playSession.set(cleverapps.EVENTS.DAILY_CUP_DAU,!0),this.onNoConnectionInfo(),
cleverapps.dailyCup.onNoConnectionListener=this.createListener(this.onNoConnectionInfo.bind(this)),cleverapps.dailyCup.isActive()||this.onChangeActivation(),cleverapps.dailyCup.onActivationListener=this.createListener(this.onChangeActivation.bind(this)),this.updateState(),cleverapps.dailyCup.updateListeners.scene=this.createListener(this.updateState.bind(this)),cleverapps.environment.episodeNo=DailyCup.EPISODE_ID,cleverapps.placements.run(Placements.INTERMEDIATE)},getRefreshSceneActionOnChangeSize:function(){return function(e){cleverapps.scenes.replaceScene(new DailyCupScene,e)}},getBackgroundStyles:function(){return cleverapps.styles.DailyCupScene.background},createTableBg:function(){var e=this.getStyles().tableBg;if(e){var t=this.tableBg=cleverapps.UI.createScale9Sprite(bundles.main.frames.table_bg_png||bundles.daily_cup.frames.table_bg_png||bundles.windows.frames.window_bg_png,cleverapps.UI.Scale9Rect.TwoPixelXY);if(t.setContentSize(e.width*this.table.tableView.scaleX,e.height),
this.mainContainer.addChild(t),t.setPositionRound(this.mainContainer.width/2+e.x,this.mainContainer.height/2+e.y),e.stitches&&new StitchesComponent(t,e.stitches),e.innerBg){var i=new cc.Scale9Sprite(bundles.main.frames.window_inner_bg_png);i.setContentSize2(e.innerBg.width*this.table.tableView.scaleX,e.innerBg.height),this.mainContainer.addChild(i),i.setPositionRound(e.innerBg)}}},createLeadersButton:function(){var e=this.getStyles().leadersButton,t=new cc.Sprite(bundles.daily_cup.frames.daily_cup_leaders_icon_png);this.scene.addChild(t),t.setPositionRound(e),t.setLocalZOrder(1),t.baseScale=t.scale=e.scale,cleverapps.UI.applyHover(t),cleverapps.UI.onClick(t,function(){cleverapps.metha.display({focus:"DailyCupLeadersWindow",action:function(e){new DailyCupLeadersWindow,cleverapps.metha.onceNoWindowsListener=e}})}),cleverapps.UI.makeHideable(t,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("leadersButton",t)},onChangeActivation:function(){if(cleverapps.dailyCup.isActive()){
this.loading&&(this.loading.removeFromParent(!0),this.loading=void 0);var e=this.table?.7:0;this.table=new DailyCupTable(cleverapps.dailyCup,cleverapps.styles.DailyCupTable,cleverapps.DailyCupRow,this.mainContainer),this.table.runStartAnimation(e)}else this.table.runFinishAnimation(),this.loading=WaitWindow.prototype.showLoading.call(this,"messages:Loading",{}),this.mainContainer.addChild(this.loading),this.loading.setPositionRound(this.mainContainer.width/2,this.mainContainer.height/2)},onNoConnectionInfo:function(){if(cleverapps.dailyCup.noConnection){var e=this.getStyles().noConnectionInfo;this.noConnectionInfo=cleverapps.UI.createScale9Sprite(e.bg.image),this.noConnectionInfo.setContentSize2(e.bg.width,e.bg.height);var t=cleverapps.UI.generateTTFText("messages:InternetConnectionError",cleverapps.styles.FONTS.WHITE_TEXT);t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),t.setPositionRound(this.noConnectionInfo.width/2,
this.noConnectionInfo.height/2),t.setDimensions(this.noConnectionInfo.width,this.noConnectionInfo.height),this.noConnectionInfo.addChild(t),this.mainContainer.addChild(this.noConnectionInfo,1),this.noConnectionInfo.setPositionRound(e)}else this.noConnectionInfo&&(this.noConnectionInfo.removeFromParent(!0),delete this.noConnectionInfo)},updateState:function(){cleverapps.dailyCup.stillCanPlay()?(this.createTimer(),this.removeText(),this.playButton.enable(),this.playButton.setTitle("Play")):(this.createText(),this.removeTimer(),cleverapps.dailyCup.isFinished()?(this.playButton.setTitle("Next"),this.playButton.enable()):(this.playButton.setTitle("Play"),this.playButton.disable()))},createHelpButton:function(){var e=this.getStyles().helpButton,t=new cleverapps.UI.Button({button_png:res.help_button_png,button_on_png:res.help_button_on_png,onClicked:function(){cleverapps.metha.display({focus:"DailyCupRulesWindow",action:function(e){new DailyCupRulesWindow,
cleverapps.metha.onceNoWindowsListener=e}})}});this.scene.addChild(t),t.setPositionRound(e),cleverapps.UI.makeHideable(t,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("helpButton",t)},createTitleBg:function(){var e=this.getStyles().titleBg;if(e){var t=bundles.daily_cup.frames.daily_cup_titleBg||bundles.main.frames.window_title_bg_png;if(e.useRibbonTitle&&(t=bundles.main.frames.ribbon),this.titleBg=cleverapps.UI.createScale9Sprite(t,cleverapps.UI.Scale9Rect.TwoPixelXY),e.width&&this.titleBg.setContentSize2(e.width*this.table.tableView.scaleX,e.height),e.scale&&this.titleBg.setScale(e.scale),this.mainContainer.addChild(this.titleBg),this.titleBg.setPositionRound(e),bundles.daily_cup.frames.dailycup_title_icon){var i=new cc.Sprite(bundles.daily_cup.frames.dailycup_title_icon);this.titleBg.addChild(i,e.icon.zOrder||0),i.setPositionRound(e.icon)}}},createTitle:function(){var e=this.getStyles(),t=this.title=cleverapps.UI.generateTTFText("messages:DailyCup.title",
cleverapps.styles.FONTS.DAILY_TOURNAMENT_TITLE_TEXT);t.setLocalZOrder(1),this.titleBg?this.titleBg.addChild(t):this.mainContainer.addChild(t),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setPositionRound(e.title),t.fitTo(e.title.width);var i=e.title.width/t.width,s=e.title.height/t.height,n=Math.min(i,s);n<1&&t.setScale(n),window.title=t},removeTimer:function(){this.timer&&(this.timer.removeFromParent(),delete this.timer)},createTimer:function(){if(this.removeTimer(),cleverapps.dailyCup.timeout){var e=cleverapps.dailyCup.timeout.getTimeLeft(),t=this.getStyles().timer,i={font:cleverapps.styles.FONTS.DAILY_CUP_TIMER_TEXT,timerPosition:t.timerPosition,regularFontTimerPosition:t.regularFontTimerPosition};if(t.timerBg){var s=cleverapps.UI.createScale9Sprite(t.timerBg.image);s.setContentSize2(t.timerBg),i.background_content=s}this.timer=new cleverapps.CountDownView(new cleverapps.CountDown(e),i),this.mainContainer.addChild(this.timer),this.timer.setPositionRound(t)}},
removeText:function(){this.textNode&&(this.textNode.removeFromParent(),delete this.textNode)},createText:function(){if(!this.textNode){var e=this.getStyles(),t=cleverapps.UI.generateTTFText("messages:DailyCup.finished",cleverapps.styles.FONTS.DAILY_CUP_TIMER_TEXT);if(this.textNode=new cc.Node,this.textNode.setAnchorPoint2(),this.mainContainer.addChild(this.textNode),this.textNode.setContentSize2(t.getContentSize()),this.textNode.setPositionRound(e.timer),this.textNode.addChild(t),t.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),t.setPositionRound(this.textNode.width/2,this.textNode.height/2),e.timer.timerBg){var i=cleverapps.UI.createScale9Sprite(e.timer.timerBg.image);i.setContentSize2(t.width+e.textBg.offsetWidth,t.height+e.textBg.offsetHeight),this.textNode.addChild(i),i.setLocalZOrder(-1),i.setPositionRound(this.textNode.width/2,this.textNode.height/2)}}},createPlayButton:function(){this.playButton=new DailyCupPlayButton({parent:this.scene,
onClicked:this.onPlayClicked.bind(this)}),cleverapps.UI.makeHideable(this.playButton,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("playButton",this.playButton)},onPlayClicked:function(){cleverapps.dailyCup.stillCanPlay()?cleverapps.dailyCup.noConnection?cleverapps.Notification.create("messages:InternetConnectionError"):cleverapps.metha.display({focus:"PlayDailyCup",action:function(e){cleverapps.dailyCup.wantsToPlay(e)}}):cleverapps.dailyCup.isFinished()&&cleverapps.dailyCup.restart()},getStyles:function(){return cleverapps.styles.DailyCupScene},displayIntro:function(e){cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.DAILY_CUP_RULES)?e():(new DailyCupRulesWindow(function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.DAILY_CUP_RULES,!0)}),cleverapps.metha.onceNoWindowsListener=e)}});DailyCupScene.BUNDLES=function(){return["daily_cup","main","windows"]},cleverapps.styles.DailyCupTable={x:{align:"center",dx:0},y:{align:"center",dy:-40},table:{height:700,
width:500,bg:bundles.daily_cup.frames.daily_cup_table_bg,padding:5}},cleverapps.overrideFonts(cleverapps.styles.FONTS,{DAILY_CUP_TIMER_TEXT:{prefix:"digits#timer_digit_",scale:.9,size:40,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.DailyCupScene={background:{background:bundles.daily_cup.urls.bg},title:{x:{align:"center",dx:0},y:{align:"center",dy:15},width:520,height:100},titleBg:{x:{align:"center",dx:0},y:{align:"top",dy:-90}},noConnectionInfo:{x:{align:"center",dx:0},y:{align:"center",dy:0},bg:{width:480,height:120,image:res.timer_bg_png}},timer:{x:{align:"center",dx:0},y:{align:"top",dy:-275},timerBg:{width:220,height:50,image:res.timer_bg_png},timerPosition:{x:0,y:0}},textBg:{offsetWidth:40,offsetHeight:20},helpButton:{x:{align:"center",dx:-210},y:{align:"bottom",dy:160}},leadersButton:{x:{align:"center",dx:230},y:{align:"bottom",dy:60},scale:.4}};var DailyCupLeadersWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.DailyCupLeadersWindow
;this.content=new cc.Node,this.content.setAnchorPoint(.5,.5),this.content.setContentSize(e.width,e.height),this._super({title:"messages:DailyCupLeadersWindow.Title",name:"dailycupleaderswindow",content:this.content}),cleverapps.dailyCupLeadersWindowTable.getResults("cache")?this.leadersOnLoad(cleverapps.dailyCupLeadersWindowTable.getResults("cache")[0]):(this.loading=new LeadersLoading,this.loading.setPosition(this.content.width/2,this.content.height/2),this.content.addChild(this.loading),cleverapps.RestClient.get("/dailycup/leaders/"+cleverapps.user.id,{},this.createListener(this.leadersOnLoad.bind(this)),function(){cleverapps.Notification.create("messages:LeadersLoadFailed")})),cleverapps.audio.playSound(res.window_effect)},leadersOnLoad:function(e){this.loading&&(this.loading.remove(),cleverapps.dailyCupLeadersWindowTable.updateResults("cache",[e]));for(var t=cleverapps.styles.DailyCupLeadersWindow,i=e.leaders,s=!1,n=0;n<i.length;n++)if(i[n].id===cleverapps.user.id){s=!0,
i[n].player=!0;break}if(!s){var o={id:cleverapps.user.id,firstPlace:e.playerResult.firstPlace,secondPlace:e.playerResult.secondPlace,thirdPlace:e.playerResult.thirdPlace,player:!0,avatar:cleverapps.friends.getPlayer().avatar,text:cleverapps.friends.getPlayer().name,notInTop:!0};i.push(o)}i.forEach(function(e,t){e.place=t+1});var a=this.table=cleverapps.dailyCupLeadersWindowTable.createTableView({id:"dailyCupLeadersWindow",data:i,rowConstructor:cleverapps.DailyCupLeadersRow});a.setPosition(this.content.width/2,this.content.height/2+t.table.y),this.content.addChild(a),this.adjustScale()},adjustScale:function(){var e=this.window.width/(this.table.width+cleverapps.styles.DailyCupLeadersWindow.table.padding)/this.content.scale;e<1&&this.table.setScale(e)}});cleverapps.styles.DailyCupLeadersWindow={width:600,height:770,table:{padding:40,y:-50}};var DailyCupTable=function(e,t,i,s){this.parent=s,this.dailyCup=e,this.id=this.dailyCup.id,this.styles=t,this.rowConstructor=i,this.createTable()}
;DailyCupTable.prototype.createTable=function(){this.tableView&&this.tableView.removeFromParent(),this.tableView=this.dailyCup.table.createTableView({id:this.dailyCup.type,data:this.dailyCup.players,rowConstructor:this.rowConstructor,options:{styles:{height:this.styles.table.height,bg:this.styles.table.bg}}}),this.adjustSize(),this.parent.addChild(this.tableView),this.tableView.setPositionRound(this.styles),this.tableView.setLocalZOrder(1),this.dailyCup.updateListeners.scoreboard=this.tableView.createListener(function(e,t){t&&this.parent.isRunningSafe()&&(t!==this.id?(this.id=t,this.dailyCup.table.resetResults(this.dailyCup.type),this.createTable()):this.updateResults())}.bind(this)),this.dailyCup.onPlayerInfoChanged=this.tableView.createListener(function(){this.dailyCup.table.resetResults(this.dailyCup.type),this.createTable()}.bind(this))},DailyCupTable.prototype.adjustSize=function(){var e=this.styles.table.padding||0,t=cleverapps.UI.getSceneSize().width/(
this.tableView.getContentSize().width+2*e);t<1&&this.tableView.setScale(t)},DailyCupTable.prototype.updateResults=function(){this.tableView.updateResults(this.dailyCup.players)?this.dailyCup.table.updateResults(this.dailyCup.type,this.dailyCup.players):(this.dailyCup.table.resetResults(this.dailyCup.type),this.createTable())},DailyCupTable.prototype.runFinishAnimation=function(){if(!this.inFinishAnimation){this.inFinishAnimation=!0,this.tableView.stopAllActions();var e=this.tableView.getScale();this.tableView.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.1*e).easing(cc.easeIn(2)),new cc.ScaleTo(.3,0),new cc.RemoveSelf))}},DailyCupTable.prototype.runStartAnimation=function(e){this.tableView.stopAllActions();var t=this.tableView.getScale();this.tableView.setScale(0),this.tableView.runAction(new cc.Sequence(new cc.DelayTime(e||0),new cc.ScaleTo(.3,1.1*t).easing(cc.easeOut(2)),new cc.ScaleTo(.2,t)))};var DailyCup=function(e){(this.type=e,this.data=DailyCups.getData(e),this.debugInfo={},
cleverapps.config.debugMode&&(this.data.available.registered="0 days",DailyCup.RELOAD_INTERVAL="5 seconds"),this.updateListeners={},this.onNoConnectionListener=function(){},this.onActivationListener=function(){},this.onPlayerInfoChanged=function(){},this.reset(),this.load(),this.reload(),setInterval(this.reload.bind(this),cleverapps.parseInterval(DailyCup.RELOAD_INTERVAL)),this.runLocalTimeout(),this.table=new cleverapps.Table,cleverapps.friends.playerInfoChangedListeners["dailyCup_"+e]=this.playerInfoChanged.bind(this),this.finished)&&(void 0===this.calcRewardPlace()&&this.data.autoRestart&&this.restart())};DailyCup.prototype.reset=function(){this.deactivate(),this.setNoConnection(!1),this.stars=0,this.level=0,this.timeFinish=void 0,this.finished=!1},DailyCup.prototype.setNoConnection=function(e){this.noConnection!==e&&(this.noConnection=e,this.onNoConnectionListener())},DailyCup.prototype.getTimeLeft=function(){if(this.timeFinish){var e=this.timeFinish-Date.now();return e<0?0:e}},
DailyCup.prototype.runLocalTimeout=function(){this.timeout&&(this.timeout.clear(),delete this.timeout),void 0!==this.getTimeLeft()&&(this.timeout=new cleverapps.LongTimeout(function(){this.runUpdateListeners()}.bind(this),this.getTimeLeft()))},DailyCup.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes[this.data.storageKey]);e&&(this.activate(e.id),this.stars=e.stars,this.level=e.level,this.finished=e.finished,this.timeFinish=e.timeFinish,this.players=e.players,e.timeLeft&&(this.timeFinish=Date.now()+e.timeLeft)),this.players=this.players||[],this.finished&&0===this.players.length&&(this.finished=!1),this.debugInfo.loadTime=Date.now(),this.preparePlayersData()},DailyCup.prototype.getInfo=function(){return{id:this.id,stars:this.stars,level:this.level,finished:this.finished,timeFinish:this.timeFinish}},DailyCup.prototype.updateInfo=function(e,t){this.activate(e.id),this.stars=e.stars,this.level=e.level,this.timeFinish=void 0,this.finished=!1,
this.debugInfo.updateInfoTime=Date.now(),this.save(t)},DailyCup.prototype.save=function(e){var t=this.getInfo();t.players=this.players,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes[this.data.storageKey],t),!e&&this.data.serverTaskName&&cleverapps.synchronizer.addUpdateTask(this.data.serverTaskName)},DailyCup.prototype.createEpisode=function(){var e=Episode.LevelChooseAlgorithm({start:5,seed:1e3*(this.id||0)+(this.level||0)});return new Episode(Episode.Types.DAILYCUP,e)},DailyCup.prototype.getPlayerInfo=function(){return{id:cleverapps.user.id,amount:this.stars,player:!0,avatar:this.getPlayerAvatar(),text:cleverapps.friends.getPlayer().name}},DailyCup.prototype.getPlayerAvatar=function(){return{avatar:cleverapps.friends.getPlayer().avatar,id:cleverapps.user.id}},DailyCup.prototype.playerInfoChanged=function(e){for(var t=0;t<this.players.length;t++)if(this.players[t].id===e){var i=this.getPlayerInfo();return this.players[t].id=i.id,this.players[t].avatar=i.avatar,
this.players[t].text=i.text,this.save(),void this.onPlayerInfoChanged()}},DailyCup.prototype.addDebugPlayers=function(){if(cleverapps.config.debugMode&&DailyCup.DEBUG_PLAYERS_AMOUNT){for(var e=0;this.players.length<DailyCup.DEBUG_PLAYERS_AMOUNT;)this.players.push({id:"10000"+e,amount:10*e,avatar:this.getPlayerAvatar(),text:"Player_"+e}),e++;this.players.sort(function(e,t){return t.amount-e.amount})}},DailyCup.prototype.preparePlayersData=function(){for(var e=void 0,t=0;t<this.players.length;t++)this.players[t].id===cleverapps.user.id&&(this.players[t].amount=this.stars,this.players[t].player=!0,this.players[t].avatar=this.getPlayerAvatar(),e=t);if(void 0===e){var i=this.getPlayerInfo();e=this.players.length,this.players.push(i)}for(this.addDebugPlayers();0<e&&this.players[e-1].amount<this.players[e].amount;){var s=this.players[e-1];this.players[e-1]=this.players[e],this.players[e]=s,e--}this.players[e].notInTop=e>=DailyCup.TOP_LIMIT,this.players.forEach(function(e,t){e.place=t+1})},
DailyCup.prototype.stillCanPlay=function(){return this.isActive()&&0<this.getTimeLeft()},DailyCup.prototype.isFinished=function(){return this.finished},DailyCup.prototype.isActive=function(){return 0!==this.id},DailyCup.prototype.activate=function(e){this.id!==e&&(this.id=e,this.onActivationListener())},DailyCup.prototype.deactivate=function(){0!==this.id&&(this.id=0,this.onActivationListener())},DailyCup.prototype.calcRewardPlace=function(){if(this.isFinished())for(var e=0;e<this.players.length&&e<this.data.rewards.length;e++)if(this.players[e].player){if(0===this.players[e].amount)return;return e}},DailyCup.prototype.giveReward=function(){var i=this.calcRewardPlace(),s=this.id;0===i&&cleverapps.missionManager.dispatchEvent(Mission.EVENT_WIN_DAILYCUP),cleverapps.metha.display({focus:"DailyCupRewards",actions:[function(e){this.data.victoryWindow?(new this.data.victoryWindow(i),cleverapps.metha.onceNoWindowsListener=e):e()}.bind(this),function(e){this.restart()
;var t=this.data.rewards[i];this.type!==DailyCup.TYPE_WEEKLY&&RewardsConfig.DailyCup.prepareByRich&&(t=cleverapps.user.prepareRewardByRich(t)),new DailyCupRewardWindow({reward:t,place:i+1,id:s,type:this.type}),cleverapps.metha.onceNoWindowsListener=e}.bind(this)]})},DailyCup.prototype.restart=function(){this.reset(),this.save(),this.runUpdateListeners(),this.reload()},DailyCup.prototype.markFinished=function(){if(!this.finished){this.finished=!0,this.debugInfo.markFinishedTime=Date.now(),cleverapps.dailyCupLeadersWindowTable.resetResults("cache"),this.save(),this.runUpdateListeners();var e=this.calcRewardPlace();void 0===e||cleverapps.metha.isFocused()||this.giveReward(),void 0===e&&this.data.autoRestart&&this.restart()}},DailyCup.prototype.onRespond=function(){this.reloading=!1},DailyCup.prototype.onSuccess=function(e){if(!e)return console.log("Empty result"),void this.onFailure();var t=this.id;if(this.setNoConnection(!1),this.onRespond(),this.timeFinish=Date.now()+e.time,
this.players=e.players,this.id!==e.id&&(this.stars=0,this.level=0),this.preparePlayersData(),this.id!==e.id&&(this.table.resetResults(this.type),cleverapps.dailyCupLeadersWindowTable.resetResults("cache"),this.activate(e.id)),this.save(!0),this.debugInfo.onSuccessTime=Date.now(),this.debugInfo.onSuccessPlayersLenght=this.players.length,this.debugInfo.onSuccessData=JSON.stringify(e),this.debugInfo.onSuccessThisId=t,e.time<=0){this.calcRewardPlace();this.markFinished()}else this.runLocalTimeout();this.runUpdateListeners()},DailyCup.prototype.onFailure=function(){this.setNoConnection(!0),this.onRespond(),console.error("can't update DailyCup of type "+this.type)},DailyCup.prototype.reload=function(){DailyCup.IsAvailable(this.type)&&(this.reloading||this.isFinished()||(this.type!==DailyCup.TYPE_WEEKLY||cleverapps.scenes.isLoaderScene()||cleverapps.environment.isMainScene())&&(this.type!==DailyCup.TYPE_DAILY||cleverapps.environment.isDailyCupScene()||cleverapps.environment.isMainScene())&&(
this.reloading=!0,cleverapps.RestClient.get("/dailycup/get/"+this.id+"/"+this.type,{},this.onSuccess.bind(this),this.onFailure.bind(this))))},DailyCup.prototype.runUpdateListeners=function(){cleverapps.values(this.updateListeners).forEach(function(e){e(this.players,this.id)}.bind(this))},DailyCup.prototype.addAmount=function(e){if(this.stillCanPlay()){this.type===DailyCup.TYPE_DAILY&&0===this.stars&&cleverapps.missionManager.dispatchEvent(Mission.EVENT_PLAY_DAILYCUP),e=void 0===e?0:e,this.level++,this.stars+=e,this.save();var t=this.id?this.id:-1;cleverapps.RestClient.post("/dailycup/update/"+cleverapps.user.id+"/"+this.type,{id:t,stars:this.stars},function(){},function(){console.log("couldn't update progress")}),this.preparePlayersData()}},DailyCup.prototype.cupWithLives=function(){return cleverapps.lives&&"board"!==cleverapps.config.type},DailyCup.prototype.wantsToPlay=function(e){if(this.cupWithLives()&&cleverapps.lives.isEmpty())return new ShopWindow({tab:ShopWindow.TABS.LIVES}),
void(cleverapps.metha.onceNoWindowsListener=e);var t=this.createEpisode().getLevel();BoostersBefore.isAvailable()&&LevelStartWindow.isAvailable(t.episode.episodeNo,t.levelNo)?(cleverapps.metha.controlFreeFocus("MenuBarGoldItem"),new LevelStartWindow({level:t}),cleverapps.metha.onceNoWindowsListener=e):t.play(e)},DailyCup.IsAvailable=function(e){return(e!==DailyCup.TYPE_WEEKLY||cleverapps.metha.getType()===Metha.KNOCKOUT)&&levels.user.checkAvailable(DailyCups.getData(e).available)},DailyCup.TOP_LIMIT=25,DailyCup.RELOAD_INTERVAL="1 minute",DailyCup.TYPE_DAILY=0,DailyCup.TYPE_WEEKLY=1;var DailyCupsRewards={},DailyCups={getData:function(e){switch(e){case DailyCup.TYPE_DAILY:var t={available:{episode:5,level:0,registered:"7 days",differences:{disabled:!0}},serverTaskName:"userdailycup",rewards:this.getRewards(DailyCup.TYPE_DAILY),leadersWindow:DailyCupLeadersWindow,storageKey:"DAILY_CUP"};return cleverapps.config.debugMode&&delete t.available.registered,t;case DailyCup.TYPE_WEEKLY:return{
available:{episode:0,level:0,projectName:["olympics","differences"]},serverTaskName:"userweeklycup",rewards:this.getRewards(DailyCup.TYPE_WEEKLY),storageKey:"WEEKLY_CUP",victoryWindow:"undefined"!=typeof WeeklyCupVictoryWindow&&WeeklyCupVictoryWindow,autoRestart:!0}}},getRewards:function(e){return e===DailyCup.TYPE_WEEKLY?RewardsConfig.WeeklyCup.places:e===DailyCup.TYPE_DAILY?RewardsConfig.DailyCup.places:void 0}},DailyCupRewardWindow=RewardWindow.extend({onWindowLoaded:function(e){this.place=e.place,this.id=e.id,this._super({title:e.type===DailyCup.TYPE_WEEKLY?"messages:WeeklyCupTable.title":"messages:DailyCup.title",name:"dailycuprewardwindow",text:"messages:DailyCup.reward",reward:e.reward,rewardName:"dailyCup"})},onReceiveReward:function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_CUP_REWARD+"_"+this.place+"_"+this.id)}}),DailyCupRulesWindow=RulesWindow.extend({onWindowLoaded:function(e){this.callback=e,this._super({name:"dailycupruleswindow",
styles:cleverapps.styles.DailyCupRulesWindow})},onClose:function(){this.callback&&this.callback()}});cleverapps.styles.DailyCupRulesWindow={prefix:"messages:DailyCupRulesWindow.",animation:{json:bundles.daily_cup.jsons.daily_cup_json,name:"animation"},subText:{width:200,left:{x:{align:"left",dx:40},y:{align:"top",dy:-250}},right:{x:{align:"right",dx:45},y:{align:"top",dy:-215}},bottom:{x:{align:"center",dx:5},y:{align:"center",dy:-320}}}};var Subscription=function(){this.load(),this.onChangeStateListeners={},cleverapps.config.debugMode&&(Subscription.RELOAD_INTERVAL="1 minute",Subscription.REWARD_INTERVAL="20 minutes",Subscription.BUY_TRIAL_INTERVAL="10 seconds"),"ios"===cleverapps.User.calcSource()&&(Subscription.AVAILABLE={episode:0,level:1}),this.reload(),this.haveTmpId()&&this.runOnBuyReloads()};Subscription.calcSource=function(){var e=cleverapps.User.calcSource();return"mobile_ok"===e&&(e="web_ok"),e},Subscription.prototype.load=function(){var e=cleverapps.DataLoader.load(
cleverapps.DataLoaderTypes.SUBSCRIPTION),t=Subscription.calcSource();e&&e[t]?(this.id=e[t].id,this.lastRewardTime=e[t].lastRewardTime||0,this.lastReloadTime=e[t].lastReloadTime||0,this.trialBoughtTime=e[t].trialBoughtTime||0,this.tokens=e[t].tokens||{}):(this.id=0,this.lastRewardTime=0,this.lastReloadTime=0,this.trialBoughtTime=0,this.tokens={})},Subscription.prototype.getInfo=function(){var e={},t=Subscription.calcSource();return e[t]={id:this.id,lastRewardTime:this.lastRewardTime,lastReloadTime:this.lastReloadTime,trialBoughtTime:this.trialBoughtTime},0<Object.keys(this.tokens).length&&(e[t].tokens=this.tokens),e},Subscription.prototype.updateInfo=function(e,t){var i=Subscription.calcSource();e[i]&&(this.id=e[i].id,this.lastRewardTime=e[i].lastRewardTime||0,this.lastReloadTime=e[i].lastReloadTime||0,this.trialBoughtTime=e[i].trialBoughtTime||0,this.tokens=cleverapps.override({},e[i].tokens||{},this.tokens),this.save(t))},Subscription.prototype.save=function(e){
cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SUBSCRIPTION,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("subscription")},Subscription.prototype.getLeftTime=function(){if(this.isActive()){if(!this.lastRewardTime)return 0;var e=Date.now();return"daily"===Subscription.REWARD_INTERVAL?Math.max(cleverapps.extractDateFromDateTime(this.lastRewardTime)+cleverapps.parseInterval("1 day")-e,0):Math.max(this.lastRewardTime+cleverapps.parseInterval(Subscription.REWARD_INTERVAL)-e,0)}},Subscription.prototype.reload=function(){var e=Subscription.calcSource();cleverapps.isLocalhost()||this.isDebugNoPayments()||-1===["facebook","web_ok","mobile_ok","android","ios"].indexOf(e)||-1!==["android","ios"].indexOf(e)&&0===Object.keys(this.tokens).length||!this.haveTmpId()&&this.lastReloadTime+cleverapps.parseInterval(Subscription.RELOAD_INTERVAL)>Date.now()||this.getAsync(function(e,t){if(!e){t=t||{};var i=this.isActive();if(this.id=t.id,this.lastReloadTime=Date.now(),this.save(),
cleverapps.values(this.onChangeStateListeners).forEach(cleverapps.callFunc),i&&!this.isActive()){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SUBSCRIPTION_CANCELLED);var s=new cleverapps.ReportStream("SubscriptionCancel");s.push("oldActive "+i),s.push(JSON.stringify({userid:cleverapps.user.id,id:this.id,lastRewardTime:this.lastRewardTime,lastReloadTime:this.lastReloadTime,trialBoughtTime:this.trialBoughtTime})),s.send()}}}.bind(this))},Subscription.prototype.getAsync=function(t){var e=Subscription.calcSource();if(-1!==["facebook","web_ok","mobile_ok","android","ios"].indexOf(e))if(levels.user.haveTmpId()&&-1!==["facebook","web_ok","mobile_ok"].indexOf(e))t(cleverapps.Social.CODE_FAILED);else{var i={source:e,tokens:this.tokens,id:this.id};cleverapps.RestClient.post("/subscriptions/get/"+levels.user.id,i,function(e){e&&!e.id&&(e={}),t(cleverapps.Social.CODE_SUCCEED,e)},function(){t(cleverapps.Social.CODE_FAILED)})}},Subscription.prototype.haveTmpId=function(){
return this.id&&2<=this.id.length&&"__"===this.id.substr(0,2)},Subscription.prototype.onBuySubscription=function(e){cleverapps.history.add("sbcrb",1),this.id=cleverapps.user.generateTmpId();var t=Subscription.calcSource();(-1!==["facebook","android","ios"].indexOf(t)||this.isDebugNoPayments())&&(this.lastRewardTime=0),this.lastReloadTime=0,e.trial&&(this.trialBoughtTime=Date.now()),this.save(),this.runOnBuyReloads()},Subscription.prototype.runOnBuyReloads=function(){["5 seconds","15 seconds","30 seconds","1 minute","3 minutes","5 minutes","10 minutes"].forEach(function(e){setTimeout(function(){cleverapps.subscription.reload()},cleverapps.parseInterval(e))})},Subscription.prototype.addPurchaseTokens=function(e,t){Array.isArray(e)||(e=[e]);var a=!1;e.forEach(function(e){var t=e.name,i=e.purchaseToken,s=e.productId,n=e.packageName,o=this.tokens[t]||{};t&&i&&s&&n&&(o.purchaseToken!==i||o.productId!==s||o.packageName!==n)&&(this.tokens[t]={productId:s,packageName:n,purchaseToken:i},a=!0)
}.bind(this)),a&&(t&&!this.isActive()&&(this.lastReloadTime=0,this.reload()),this.save())},Subscription.prototype.isRewardReady=function(){return!!this.isActive()&&0===this.getLeftTime()},Subscription.prototype.getReward=function(){return!!this.isRewardReady()&&(this.lastRewardTime=Date.now(),this.save(),cleverapps.values(this.onChangeStateListeners).forEach(cleverapps.callFunc),!0)},Subscription.prototype.isActive=function(){return this.id},Subscription.prototype.calcReward=function(){var e=cleverapps.clone(RewardsConfig.Subscription,!0);return cleverapps.user.setRandomBoostersReward(e)},Subscription.prototype.reactivate=function(e){!this.isActive()||cleverapps.isLocalhost()||this.isDebugNoPayments()||0===this.id.indexOf("__")||cleverapps.payments.reactivateSubscription&&cleverapps.payments.reactivateSubscription(this.id,e)},Subscription.prototype.canBuyTrial=function(){return!(!cleverapps.isLocalhost()&&-1===["580731438762","577203420866","585959187481","576593702177","8593874"
].indexOf(cleverapps.user.id))||this.trialBoughtTime+cleverapps.parseInterval(Subscription.BUY_TRIAL_INTERVAL)<Date.now()},Subscription.prototype.isDebugNoPayments=function(){return cleverapps.isStaging()&&-1!==Subscription.SOCIAL_PAYMENT_NOT_FREE_ON_STAGING.indexOf(cleverapps.User.calcSource())&&this.toolDebugWithoutPayment},Subscription.prototype.cancel=function(e){if(this.isActive())return cleverapps.isLocalhost()||this.isDebugNoPayments()?(delete this.id,this.save(),void cleverapps.values(this.onChangeStateListeners).forEach(cleverapps.callFunc)):void(0!==this.id.indexOf("__")&&cleverapps.payments.cancelSubscription&&cleverapps.payments.cancelSubscription(this.id,e))},Subscription.IsAvailable=function(){return cleverapps.subscription&&cleverapps.subscription.isActive()||cleverapps.user.checkAvailable(Subscription.AVAILABLE)},Subscription.IsModelAvailable=function(){var e=[];switch(cleverapps.User.calcSource()){case"web_ok":case"mobile_ok":e=Subscription.MODEL_AVAILABLE_OK;break
;case"facebook":e=Subscription.MODEL_AVAILABLE_FACEBOOK;break;case"android":e=Subscription.MODEL_AVAILABLE_ANDROID;break;case"ios":e=Subscription.MODEL_AVAILABLE_IOS}return config&&config.debugMode&&(cleverapps.OK.isAppropriate()||cleverapps.MobileOK.isAppropriate()||cleverapps.FakeFacebook.isAppropriate())&&(e=Subscription.MODEL_AVAILABLE_OK.concat(Subscription.MODEL_AVAILABLE_FACEBOOK)),-1!==e.indexOf(cleverapps.config.name)},Subscription.MODEL_AVAILABLE_OK=["heroes","riddles","wordsoup","crocword","tripeaks","runes","olympics","scramble","differences"],Subscription.MODEL_AVAILABLE_FACEBOOK=["heroes","riddles","wordsoup","crocword","tripeaks","scramble"],Subscription.MODEL_AVAILABLE_ANDROID=["heroes","riddles","wordsoup","crocword","tripeaks","olympics","scramble"],Subscription.MODEL_AVAILABLE_IOS=["crocword","wordsoup","tripeaks"],Subscription.AVAILABLE={episode:3,level:0},Subscription.REWARD_INTERVAL="daily",Subscription.RELOAD_INTERVAL="1 hour",
Subscription.BUY_TRIAL_INTERVAL="3 day",Subscription.SOCIAL_PAYMENT_NOT_FREE_ON_STAGING=["mobile_ok","web_ok"];var SubscriptionWindow=Window.extend({onWindowLoaded:function(){this.weekProduct=new Product("subsWeek"),this.monthProduct=new Product("subsMonth"),this.buySubscription=function(e){if(cleverapps.subscription.isActive())return cleverapps.Notification.create("messages:Product.PurchaseCancelled"),void this.close();var t=function(){cleverapps.subscription.onBuySubscription(e),this.close()}.bind(this);cleverapps.subscription.isDebugNoPayments()?t():e.buy(t)}.bind(this),this.onClaimClicked=function(){this.close()}.bind(this);var e={name:"SubscriptionWindow",content:this.createContent(),styles:this.windowStyles};"olympics"===cleverapps.config.name&&(e.windowBg=bundles.windows.frames.window_gold_bg_png),cleverapps.styles.SubscriptionWindow.window.Title&&(e.title={text:"messages:SubscriptionWindow.Title",
font:cleverapps.styles.FONTS.SUBSCRIPTION_WINDOW_TITLE_TEXT||cleverapps.styles.FONTS.WINDOW_TITLE_TEXT}),this._super(e),cleverapps.audio.playSound(res.window_effect),cleverapps.subscription.isActive()||cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SUBSCRIPTION_WINDOW_OPEN),Lottery.addText(this)},onClose:function(){cleverapps.subscription.isRewardReady()&&new SubscriptionRewardWindow},onShow:function(){var e=cleverapps.styles.SubscriptionWindow;e.animation.person.open?(this.personAnimation.setAnimation(0,e.animation.person.open,!1),this.personAnimation.setCompleteListener(function(){this.personAnimation.setAnimation(0,e.animation.person.idle,!0)}.bind(this))):this.personAnimation.setAnimation(0,e.animation.person.idle,!0),this.prizesView.onShow&&this.prizesView.onShow()},createContent:function(){var e=cleverapps.styles.SubscriptionWindow;this.windowStyles=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.SubscriptionWindow.window,!0),
this.personAnimation=new cleverapps.Spine(bundles.subscription_window.jsons.subscription_json||e.animation.person.json,e.animation.person.scale),this.personAnimationNode=new cc.Node,this.personAnimationNode.setLocalZOrder(e.animation.person.zOrder),this.personAnimationNode.addChild(this.personAnimation),"match3"===cleverapps.config.type?this.prizesView=new SubscriptionPrize(this):this.prizesView=new GoldBasedPrize(this);var t=cleverapps.subscription.isActive(),i=t&&cleverapps.subscription.isRewardReady(),s=t&&!i,n=[];if("ios"===cleverapps.User.calcSource()){var o=new Terms;if(n.push(o),o.width>.9*this.prizesView.width&&o.setScale(.9*this.prizesView.width/o.width),!cleverapps.subscription.isActive()){var a=new Restore;n.push(a),a.setScale(o.getScale())}}n.push(new SubscriptionButtons({isActive:t,prizesLayoutWidth:this.prizesView.width,monthProduct:this.monthProduct,weekProduct:this.weekProduct,buySubscription:this.buySubscription,onClaimClicked:this.onClaimClicked})),n.push(
new SubscriptionInfo({isRewardReady:i,isTimerActive:s,availableTextWidth:this.prizesView.width,close:this.close.bind(this)})),n.push(this.prizesView),(e.window.noBackground||"scramble"===cleverapps.config.name)&&(this.personAnimationNode.setAnchorPoint2(),this.personAnimationNode.setContentSize(e.animation.person.size),this.personAnimation.setPositionRound(e.animation.person.position),n.push(this.personAnimationNode)),e.animation.person.offset&&this.personAnimation.setPositionRound(e.animation.person.offset[cleverapps.wideMode.mode]),e.animation.person.scales&&this.personAnimation.setScale(e.animation.person.scales[cleverapps.wideMode.mode]);var r=new cleverapps.Layout(n,{direction:cleverapps.UI.VERTICAL,padding:e.contentPadding,margin:e.contentItemsMargin});return r.setLocalZOrder(5),e.window.noBackground||"scramble"===cleverapps.config.name||("tripeaks"===cleverapps.config.name?(this.addChild(this.personAnimationNode),this.personAnimationNode.setPositionRound(
e.animation.person.position[cleverapps.wideMode.mode])):(r.addChild(this.personAnimationNode),this.personAnimationNode.setPositionRound(e.animation.person.position))),r}});SubscriptionWindow.prototype.listBundles=function(){return["reward_icons","subscription_window"]},cleverapps.styles.SubscriptionWindow={contentItemsMargin:15,contentPadding:{x:64,y:140,isTop:!0},animation:{person:{position:{x:{align:"left",dx:344},y:{align:"top",dy:-142}},json:bundles.subscription_window.jsons.subscription_window_star_json,open:"open",idle:"idle",scale:1,zOrder:0}},window:{Border:{x:0,y:30},Title:{}}};var SubscriptionRewardWindow=RewardWindow.extend({ctor:function(){this._super({reward:cleverapps.subscription.calcReward()})},onWindowLoaded:function(e){this._super({title:"messages:SubscriptionRewardWindow.title",name:"subscriptionrewardwindow",text:"messages:MiniGameRewardWindow.text",reward:e.reward,rewardName:"subscription"})},onReceiveReward:function(){cleverapps.eventLogger.logEvent(
cleverapps.EVENTS.SUBSCRIPTION_REWARD)},receiveReward:function(){cleverapps.subscription.getReward()&&(this.onReceiveReward(),cleverapps.Chest.prototype._receiveReward(this.reward))}}),SubscriptionIcon=SideBarIcon.extend({ctor:function(e){var t=cleverapps.overrideStyles(cleverapps.styles.SideBarIcon,cleverapps.styles.SubscriptionIcon,!0);this._super(e,t,{title:cleverapps.styles.SubscriptionIcon.title}),cleverapps.subscription.isActive()||Lottery.addIcon(this.container,"icon")},onEnter:function(){this._super(),cleverapps.subscription.onChangeStateListeners.icon=this.createListener(this.onChangeState.bind(this)),this.onChangeState()},onPressed:function(){this._super(),cleverapps.metha.display({focus:"SubscriptionWindow",action:function(e){cleverapps.subscription.reload(),new SubscriptionWindow,cleverapps.metha.onceNoWindowsListener=e}})},onFinishTimer:function(){this.onChangeState()},onChangeState:function(){if(this.turnOffAttention(),this.hideTimer(),cleverapps.subscription.isActive()){
var e=cleverapps.subscription.getLeftTime();0<e?(this.runTimer(e),this.container.lotteryIcon&&this.container.lotteryIcon.setVisible(!1)):this.turnOnAttention()}}});SubscriptionIcon.IsAvailable=function(){return!(!Subscription.IsModelAvailable()||!Subscription.IsAvailable())&&!("ios"===cleverapps.User.calcSource()&&!cleverapps.subscription.isActive()&&!cleverapps.payments.isProductsExists(["subsWeek","subsMonth"]))},cleverapps.styles.SubscriptionIcon={animation:bundles.sidebar.jsons.premium_icon_json};var SubscriptionBonus=cc.Node.extend({ctor:function(){this._super(),this.setAnchorPoint2();var e=cleverapps.styles.SubscriptionBonus,t=new cc.Sprite(bundles.subscription_window.frames.subscription_badge_png);if(this.addChild(t),this.setContentSize2(t.getContentSize()),this.setScale(e.scale),t.setPositionRound(this.width/2,this.height/2),e.backgroundAnimation){var i=new cleverapps.Spine(e.backgroundAnimation.json,e.backgroundAnimation.scale);i.setPositionRound(t.width/2,t.height/2),
t.addChild(i,-1),i.setAnimation(0,e.backgroundAnimation.name,!0)}var s=new cc.Sprite(bundles.subscription_window.frames.subscription_plus_png);if(this.addChild(s),s.setPositionRound(e.plus),!e.description){var n=cleverapps.UI.generateTTFText("messages:UnlimitedLives.ThreeHours",cleverapps.styles.FONTS.WHITE_TEXT);this.addChild(n),n.setPositionRound(e.text),n.fitTo(e.text.width),n.setRotation(e.text.rotation)}this.setPositionRound(e)},getDescription:function(){var e=cleverapps.styles.SubscriptionBonus;if(e.description){var t=cleverapps.UI.generateTTFText("messages:UnlimitedLives.ThreeHoursShort",cleverapps.styles.FONTS.SUBSCRIPTION_WINDOW_GOLD_COIN_TEXT),i=new cc.Sprite(e.description.icon);return i.setScale(e.description.scale),i.setPositionRound(e.description),[i,t]}return[]}});cleverapps.styles.SubscriptionBonus={x:{align:"center",dx:260},y:{align:"center",dy:-135},scale:1,plus:{x:{align:"center",dx:-74},y:{align:"center",dy:18}},text:{x:{align:"center",dx:-10},y:{align:"center",
dy:-30},rotation:20,width:100}};var SubscriptionButtons=cleverapps.Layout.extend({ctor:function(e){var a=cleverapps.styles.SubscriptionButtons,r=cleverapps.User.calcSource();if(e.isActive)h=[new cleverapps.UI.Button({content:cleverapps.UI.generateTTFText("messages:OK",cleverapps.styles.FONTS.SUBSCRIPTION_BUTTON_TEXT),button_png:a.buttonOk.button_png,button_on_png:a.buttonOk.button_on_png,width:a.buttonWidth,maxWidth:a.buttonWidth,height:a.buttonHeight,onClicked:e.onClaimClicked})];else{var t=e.monthProduct.getCurrentPrice();"ios"===r&&(t=Messages.get("SubscriptionWindow.iosMonthButton",{price:e.monthProduct.getCurrentPrice()}));var i=new cleverapps.UI.Button({content:new ProductPriceView(e.monthProduct,{text:t,font:cleverapps.styles.FONTS.SUBSCRIPTION_BUTTON_TEXT}),button_png:a.buttonPay.button_png,button_on_png:a.buttonPay.button_on_png,width:a.buttonWidth,maxWidth:a.buttonWidth,height:a.buttonHeight,contentPadding:1,onClicked:function(){e.buySubscription(e.monthProduct)}});if(
Lottery.addIcon(i,"subscription"),i.lotteryIcon&&i.lotteryIcon.setScale(.7),cleverapps.subscription.canBuyTrial()){var s=Messages.get("ios"===r?"SubscriptionWindow.iosWeekButton":"SubscriptionWindow.Free",{price:e.weekProduct.getCurrentPrice()}),n=new cleverapps.UI.Button({content:new ProductPriceView(e.weekProduct,{text:s,font:cleverapps.styles.FONTS.SUBSCRIPTION_BUTTON_TEXT}),button_png:a.buttonTryFree.button_png,button_on_png:a.buttonTryFree.button_on_png,width:a.buttonWidth,maxWidth:a.buttonWidth,height:a.buttonHeight,contentPadding:1,onClicked:function(){e.buySubscription(e.weekProduct)}}),o="messages:SubscriptionWindow.OneDayAdditional";0===e.weekProduct.trial.indexOf("3 day")&&(o="messages:SubscriptionWindow.ThreeDaysAdditional"),"ios"===r&&(o=Messages.get("SubscriptionWindow.iOSThreeDaysAdditional",{price:e.weekProduct.getCurrentPrice()}));var l=cleverapps.UI.generateTTFText(o,cleverapps.styles.FONTS.SUBSCRIPTION_BUTTON_ADDITIONAL_TEXT);l.setDimensions(a.buttonWidth,0)
;var c=cleverapps.UI.generateTTFText("ios"===r?"":"messages:SubscriptionWindow.MonthlyAdditional",cleverapps.styles.FONTS.SUBSCRIPTION_BUTTON_ADDITIONAL_TEXT);c.setDimensions(a.buttonWidth,0);var p=Math.max(c.getContentSize().height,l.getContentSize().height);l.setDimensions(a.buttonWidth,p),c.setDimensions(a.buttonWidth,p);var d=function(e,t,i){t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER);var s=[t,i];if("ios"===r){var n="subsWeek"===e.itemId?"messages:SubscriptionWindow.weekButtonTitle":"messages:SubscriptionWindow.monthButtonTitle",o=cleverapps.UI.generateTTFText(n,cleverapps.styles.FONTS.SUBSCRIPTION_MAIN_TEXT);o.setDimensions(a.buttonWidth,0),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.push(o)}return new cleverapps.Layout(s,{direction:cleverapps.UI.VERTICAL,margin:a.contentObjectsMargin})},h=[d(e.weekProduct,l,n),d(e.monthProduct,c,i)],u=a.buttonsMargin||Math.max(4*a.contentObjectsMargin,
e.prizesLayoutWidth-2*a.buttonWidth)}else var h=[i]}this._super(h,{direction:cleverapps.UI.HORIZONTAL,margin:u})}});cleverapps.styles.SubscriptionButtons={height:100,contentObjectsMargin:7,buttonWidth:270,buttonHeight:100,buttonTryFree:{button_png:bundles.buttons.frames.green_button_png,button_on_png:bundles.buttons.frames.green_button_on_png},buttonPay:{button_png:bundles.buttons_main.frames.blue_button_png,button_on_png:bundles.buttons_main.frames.blue_button_on_png},buttonOk:{button_png:bundles.buttons.frames.window_button_png,button_on_png:bundles.buttons.frames.window_button_on_png}};var SubscriptionPrize=cc.Node.extend({ctor:function(){this._super();var e=cleverapps.styles.SubscriptionPrize,t=new cc.Node;t.setContentSize2(e.prizesLayout.size.width,e.prizesLayout.size.height),t.setAnchorPoint(0,0);var i=cleverapps.UI.generateTTFText("messages:SubscriptionWindow.AnimationMainText",cleverapps.styles.FONTS.SUBSCRIPTION_OFFERS_MAIN_TEXT);i.setDimensions(e.animation.everyDayTextWidth,0
),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.addChild(i),i.setAnchorPoint2(),i.setPositionRound(e.prizesLayout.everyDayTextPosition);var s=[cleverapps.UI.generateTTFText("messages:SubscriptionWindow.AnimationLeftText",cleverapps.styles.FONTS.SUBSCRIPTION_OFFERS_TEXT)];s.push(cleverapps.UI.generateTTFText("messages:SubscriptionWindow.AnimationLeftMiddleText",cleverapps.styles.FONTS.SUBSCRIPTION_OFFERS_TEXT));var n=[cleverapps.UI.generateTTFText("messages:SubscriptionWindow.AnimationRightText",cleverapps.styles.FONTS.SUBSCRIPTION_OFFERS_TEXT)];n.push(cleverapps.UI.generateTTFText("messages:SubscriptionWindow.UnlimitedLivesTwoHourText",cleverapps.styles.FONTS.SUBSCRIPTION_OFFERS_TEXT));for(var o=[s,n],a=[],r=0;r<o.length;r++){for(var l=[],c=0;c<o[r].length;c++){var p=o[r][c];e.prizesLayout.fitTo&&p.fitTo(e.prizesLayout.fitTo),p.setDimensions(e.animation.oneBoosterTextWidth,0),p.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),l.push(new cleverapps.Layout([p],{
direction:cleverapps.UI.VERTICAL,margin:e.contentObjectsMargin}))}a.push(new cleverapps.Layout(l,{direction:cleverapps.UI.HORIZONTAL,margin:3*e.contentObjectsMargin})),t.addChild(a[r]),a[r].setAnchorPoint2()}a[0].setPositionRound(e.prizesLayout.topBoostersPrizeTextPosition),a[1].setPositionRound(e.prizesLayout.bottomBoostersPrizeTextPosition),this.boostersAnimation=new cleverapps.Spine(e.animation.boosters.json,e.animation.boosters.scale),this.boostersAnimationNode=new cc.Node,this.boostersAnimationNode.addChild(this.boostersAnimation),this.boostersAnimationNode.setContentSize2(e.animation.boosters.width,e.animation.boosters.height),this.boostersAnimationNode.setAnchorPoint2(),t.addChild(this.boostersAnimationNode),this.boostersAnimationNode.setPositionRound(e.prizesLayout.boostersPrizeAnimationPosition),this.boostersAnimationNode.setLocalZOrder(-1);var d=cleverapps.UI.createScale9Sprite(e.animation.background.image,cleverapps.UI.Scale9Rect.TwoPixelXY);d.setContentSize(t.width,t.height
),d.setAnchorPoint(0,0),d.addChild(t),this.setAnchorPoint(.5,.5),this.addChild(d),this.setContentSize(d.getContentSize())},onShow:function(){var e=cleverapps.styles.SubscriptionPrize;this.boostersAnimation.setAnimation(0,e.animation.boosters.open,!1),this.boostersAnimation.setCompleteListener(function(){this.boostersAnimation.setAnimation(0,e.animation.boosters.idle,!0)}.bind(this))}});cleverapps.styles.SubscriptionPrize={contentObjectsMargin:7,animation:{background:{image:bundles.subscription_window.frames.premium_bg},oneBoosterTextWidth:154,everyDayTextWidth:350,boosters:{json:bundles.subscription_window.jsons.subscription_window_boosters_json,open:"open",idle:"idle",scale:1,width:529,height:148}},prizesLayout:{size:{width:550,height:520},boostersPrizeAnimationPosition:{x:{align:"center",dx:90},y:{align:"center",dy:30}},everyDayTextPosition:{x:{align:"center"},y:{align:"top",dy:-20}},topBoostersPrizeTextPosition:{x:{align:"center"},y:{align:"top",dy:-110}},
bottomBoostersPrizeTextPosition:{x:{align:"center"},y:{align:"bottom",dy:140}},fitTo:273}};var SubscriptionInfo=cleverapps.Layout.extend({ctor:function(e){var t=cleverapps.styles.SubscriptionInfo,i={text:"messages:SubscriptionWindow.MainText",font:cleverapps.styles.FONTS.SUBSCRIPTION_MAIN_TEXT};e.isRewardReady&&(i={text:"messages:SubscriptionWindow.RewardIsReadyText",font:cleverapps.styles.FONTS.SUBSCRIPTION_REWARD_READY_TEXT}),e.isTimerActive&&(i={text:"messages:SubscriptionWindow.RewardTimerText",font:cleverapps.styles.FONTS.SUBSCRIPTION_REWARD_READY_TEXT});var s=cleverapps.UI.generateTTFText(i.text,i.font),n=[s];if(e.isTimerActive){var o=cleverapps.UI.createScale9Sprite(t.timer.bg);o.setContentSize2(t.timer),n.push(new cleverapps.CountDownView(new cleverapps.CountDown(cleverapps.subscription.getLeftTime(),{onFinish:function(){e.close()}}),{background_content:o,font:cleverapps.styles.FONTS.TIMER_WHITE_TEXT,timerPosition:{x:0,y:t.timer.textYShift}}))}else s.setDimensions(
e.availableTextWidth,0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);t.direction===cleverapps.UI.VERTICAL&&n.reverse(),this._super(n,{direction:t.direction,margin:3*t.contentObjectsMargin})}});cleverapps.styles.SubscriptionInfo={contentObjectsMargin:7,direction:cleverapps.UI.HORIZONTAL,timer:{bg:res.timer_bg_png,width:210,height:50,textYShift:-3}};var GoldBasedPrize=cc.Node.extend({ctor:function(e){this._super(),this.window=e;var t=cleverapps.styles.GoldBasedPrize;if(this.setAnchorPoint2(),this.setContentSize2(t),"stacks"!==cleverapps.config.subtype){var i=this.createGoldBlock();this.addChild(i)}var s,n=[];s=-1!==["differences","scramble","tripeaks","wordheaps"].indexOf(cleverapps.config.name)?this.createRewardsGrid():this.createGold(),n.push(s);var o=cleverapps.UI.generateTTFText("messages:SubscriptionWindow.AnimationMainText",cleverapps.styles.FONTS.SUBSCRIPTION_WINDOW_GOLD_OFFER_TEXT);o.fitTo(t.everyDayText.width,0),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.push(o)
;var a=new cleverapps.Layout(n,{direction:cleverapps.UI.VERTICAL,margin:t.everyDayText.margin});a.setPositionRound(t.position);var r=this.bg=cleverapps.UI.createScale9Sprite(bundles.subscription_window.frames.subscription_ribbon_png||bundles.main.frames.ribbon,cleverapps.UI.Scale9Rect.TwoPixelXY);r.setAnchorPoint2(0,0),r.setContentSize2(t.goldRibbonBg),r.addChild(a),t.goldRibbonBg.dx&&(r.x+=t.goldRibbonBg.dx),this.addChild(r),this.bonus&&this.addChild(this.bonus)},createGold:function(){var e=cleverapps.styles.GoldBasedPrize,t=cleverapps.UI.generateTTFText(cleverapps.subscription.calcReward().gold,cleverapps.styles.FONTS.SUBSCRIPTION_WINDOW_GOLD_COIN_TEXT),i=new cc.Sprite(bundles.reward_icons.frames.gold_small_png);i.setScale(e.goldAmount.icon.scale),i.setPositionY(i.getPositionY()+e.goldAmount.icon.dy);var s=[i,t];return-1!==["olympics"].indexOf(cleverapps.config.name)&&(this.bonus=new SubscriptionBonus,this.bonus.getDescription().forEach(function(e){s.push(e)})),new cleverapps.Layout(
s,{direction:cleverapps.UI.HORIZONTAL,margin:e.goldAmount.margin})},createRewardsGrid:function(){var n=cleverapps.styles.GoldBasedPrize,e=RewardsHelper.getDisplayData(cleverapps.subscription.calcReward(),{itemsPrefix:"x"}),t=cleverapps.values(e).map(function(e){return function(e,t){var i=new cc.Sprite(e);cleverapps.UI.fitToBox(i,n.prizes.icon),i.setPositionY(i.getPositionY()+n.prizes.icon.dy);var s=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.SUBSCRIPTION_WINDOW_GOLD_COIN_TEXT);return new cleverapps.Layout([i,s],{direction:cleverapps.UI.HORIZONTAL,margin:n.prizes.margin})}(e.img,e.txt)}),i=[],s=2;"scramble"===cleverapps.config.name&&(s=4);var o=new cleverapps.Layout(t.splice(0,s),{direction:cleverapps.UI.HORIZONTAL,margin:n.prizes.marginCol});if(i.push(o),0<t.length){var a=new cleverapps.Layout(t,{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.bet?2*n.prizes.marginCol:n.prizes.marginCol});i.push(a)}return n.prizes.boostersBelow&&i.reverse(),new cleverapps.Layout(i,{
direction:cleverapps.UI.VERTICAL,margin:n.prizes.marginRow})},createGoldBlock:function(){var e=cleverapps.styles.GoldBasedPrize,t=new cc.Node;t.setAnchorPoint2();var i=new cc.Sprite(cleverapps.bet?bundles.subscription_window.frames.heap_gold_bet_png:bundles.subscription_window.frames.heap_gold_png);t.setContentSize2(i.getContentSize()),t.setScale(e.gold.scale);var s=new cleverapps.Spine(e.gold.backgroundAnimation.json,e.gold.backgroundAnimation.scale);return s.setPositionRound(t.width/2,t.height/2),t.addChild(s,-1),s.setAnimation(0,e.gold.backgroundAnimation.name,!0),i.setPositionRound(t.width/2,t.height/2),t.addChild(i),t.setPositionRound(e.gold.position),t}});cleverapps.styles.GoldBasedPrize={width:600,height:500,gold:{animation:!1,backgroundAnimation:{json:res.reward_spine_json,scale:.7,name:"animation"},margin:0,scale:1.45,position:{x:{align:"right",dx:0},y:{align:"top",dy:-70}}},goldRibbonBg:{scaleY:1.4,height:204,width:766},goldAmount:{icon:{scale:1.5,dy:9},margin:10},position:{
x:500,y:100},everyDayText:{margin:-4,width:400}};var PurchaseRewardWindow=RewardWindow.extend({onWindowLoaded:function(e){this._super({title:"messages:PurchaseRewardWindow.title",name:"purchaserewardwindow",reward:e.reward,callback:e.callback,buttonText:"messages:OK",rewardName:!1})},receiveReward:function(){this.reward&&(this.onReceiveReward(),cleverapps.Chest.prototype._receiveReward(this.reward,!0),this.reward=[])},selectDoubleStrategy:function(){}});WINDOW_ANIMATIONS={default:{open:function(e){var t=this.window.scale;this.window.setScale(.8*t),this.window.runAction(new cc.Sequence(new cc.ScaleTo(.3,t).easing(cc.easeBackOut()),new cc.CallFunc(e)))},close:function(e){e()}},fromLeft:{open:function(e){var t=this.window.basePosition;this.window.setPositionX(-t.x),this.window.runAction(new cc.Sequence(new cc.MoveTo(.3,t.x,t.y).easing(cc.easeBackOut()),new cc.CallFunc(e)))},close:function(e){this.window.runAction(new cc.Sequence(new cc.MoveTo(.3,-this.window.x,this.window.y).easing(
cc.easeBackIn()),new cc.CallFunc(e)))}},fromBelow:{open:function(e){var t=this.window.basePosition;this.window.setPositionY(0),this.window.runAction(new cc.Sequence(new cc.MoveTo(.3,t.x,t.y).easing(cc.easeBackOut()),new cc.CallFunc(e)))},close:function(e){this.window.runAction(new cc.Sequence(new cc.MoveTo(.4,this.window.x,0).easing(cc.easeBackIn()),new cc.CallFunc(e)))}},fromLeftToRight:{open:function(e){var t=this.window.basePosition;this.window.setPositionX(-this.window.width/2),this.window.runAction(new cc.Sequence(new cc.MoveTo(.3,t.x,t.y).easing(cc.easeBackOut()),new cc.CallFunc(e)))},close:function(e){this.window.runAction(new cc.Sequence(new cc.MoveTo(.3,this.width+this.window.width/2,this.window.y).easing(cc.easeBackIn()),new cc.CallFunc(e)))}},bezierCircle:{open:function(e){var t=cc.p(this.window.basePosition.x,this.window.basePosition.y),i=cc.p(t.x+.2*this.width,this.height-this.window.height/2),s=cc.p(t.x+.35*this.width,t.y-this.window.height/6),n=this.window.scale
;this.window.setScale(.3*n),this.window.setPosition(i);this.window.runAction(new cc.Sequence(new cc.Spawn(new cc.BezierTo(.25,[i,s,t]),new cc.ScaleTo(.25,n).easing(cc.easeIn(3))),new cc.CallFunc(e)))},close:function(e){var t=cc.p(this.window.basePosition.x,this.window.basePosition.y),i=cc.p(t.x-.2*this.width,this.height-this.window.height/2),s=cc.p(t.x-.35*this.width,t.y-this.window.height/2);this.window.setPosition(t);this.window.runAction(new cc.Sequence(new cc.Spawn(new cc.BezierTo(.25,[t,s,i]),new cc.ScaleTo(.25,.3).easing(cc.easeOut(.33))),new cc.CallFunc(e)))}},instant:{open:function(e){e()},close:function(e){e()}}},AVAILABLE_MOVE_ANIMATIONS={default:function(e,t,i){var s=e.scale,n=e.x,o=e.y,a=-t.col*cleverapps.styles.BaseCellView.CELL_SIZE_PX*.16,r=t.row*cleverapps.styles.BaseCellView.CELL_SIZE_PX*.16;0===t.row&&(r-=.075*cleverapps.styles.BaseCellView.CELL_SIZE_PX),e.runAction(new cc.RepeatForever(new cc.Sequence(new cc.Repeat(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.35,
1.1*s),new cc.MoveTo(.35,n-a,o-r).easing(cc.easeIn(3.5))),new cc.Spawn(new cc.ScaleTo(.35,s),new cc.MoveTo(.35,n,o).easing(cc.easeOut(3.5)))),3),new cc.DelayTime(3))))},homescapes:function(e,t,i){var s=e.getScaleX(),n=e.getScaleY(),o=e.x,a=e.y,r=e.getRotation();if(e.cell.x===i.start.x&&e.cell.y===i.start.y){var l=i.dir.col*cleverapps.styles.BaseCellView.CELL_SIZE_PX*.2,c=-i.dir.row*cleverapps.styles.BaseCellView.CELL_SIZE_PX*.2;e.setLocalZOrder(10),e.runAction(new cc.RepeatForever(new cc.Sequence(new cc.Spawn(new cc.Sequence(new cc.MoveBy(.45,l,c),new cc.MoveBy(.2,-.3*l,-.3*c),new cc.MoveBy(.2,.3*l,.3*c),new cc.MoveTo(.4,o,a).easing(cc.easeOut(1))),new cc.Sequence(new cc.ScaleTo(.45,1.1*s,1.1*n),new cc.DelayTime(.4),new cc.ScaleTo(.4,s,n).easing(cc.easeOut(1)))),new cc.DelayTime(.5))))}else e.runAction(new cc.RepeatForever(new cc.Sequence(new cc.DelayTime(.1),new cc.Spawn(new cc.Sequence(new cc.ScaleTo(.35,1.1*s,1.1*n),new cc.DelayTime(.35),new cc.ScaleTo(.35,s,n)),new cc.Sequence(
new cc.RotateTo(.35,r-5).easing(cc.easeIn(2)),new cc.RotateTo(.175,r+5),new cc.RotateTo(.175,r-5),new cc.RotateTo(.35,r))),new cc.DelayTime(.6))))}},WRONG_MOVE_ANIMATIONS={default:function(e,t){var i=cleverapps.styles.BaseCellView.wrongMove.move,s=function(e){return 0<e?1:e<0?-1:0},n=i*s(t.x-e.cell.x),o=i*s(e.cell.y-t.y),a=.9,r=1.1;e.cell.x===t.x&&(a=1.1,r=.9),Game.counter.setTimeout(function(){}.bind(e),100),e.runAction(new cc.Spawn(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.1,a,r),new cc.MoveBy(.1,new cc.p(n,o))),new cc.Spawn(new cc.ScaleTo(.1,1,1),new cc.MoveBy(.1,new cc.p(-n,-o)))),new cc.CallFunc(e.squeeze.bind(e,1))))}},BOARD_GUN_ANIMATIONS={default:function(e,t){t()},explosion:function(e,t){cleverapps.audio.playSound(res.gun_bombing_effect),this.runAction(new cc.Sequence(new cc.DelayTime(1.3),new cc.CallFunc(t)));var i=new cleverapps.Spine(bundles.game.jsons.gun_json,5);this.addChild(i),i.setPositionRound(this.grid.getPosition()),i.replaceParentSamePlace(
cc.director.getRunningScene().scene),i.setCompleteListenerRemove(),i.setAnimation(0,"animation",!1),i.setTimeScale(.5)},byLetter:function(e,t){cleverapps.audio.playSound(res.gun_bombing_effect),this.runAction(new cc.Sequence(new cc.DelayTime(0),new cc.CallFunc(t))),e.forEach(function(e){var t=this.placeholders[e.row][e.column],i=new cleverapps.Spine(bundles.game.jsons.gun_json);this.letterGrid.addChild(i),i.setAnimation(0,"animation",!1),i.setPositionRound(t.getPosition()),i.setLocalZOrder(-1)}.bind(this))}};var ComicsPlayer=function(e,t){this.stages=e,this.animation=t,this.stage=-1};ComicsPlayer.prototype.onChangeStage=function(){(void 0===this.dialogueStages||this.dialogueStages<1)&&(this.next(),this.dialogueStages=this.comics.dialogueStages||1),this.dialogueStages--},ComicsPlayer.prototype.next=function(){this.stage++,this.stage>=this.stages.length||(this.comics=this.stages[this.stage],this.runAnimation())},ComicsPlayer.prototype.completeShowAnimation=function(){
this.inAnimation&&this.comics.idleAnimation&&(this.animation.setCompleteListener(function(){}),this.inAnimation=!1,this.animation.setAnimation(0,this.comics.idleAnimation,!0))},ComicsPlayer.prototype.runAnimation=function(){this.comics.showAnimation?(this.inAnimation=!0,this.animation.setAnimation(0,this.comics.showAnimation,!1),this.animation.setCompleteListener(this.animation.createListener(this.completeShowAnimation.bind(this)))):(this.inAnimation=!1,this.animation.setAnimation(0,this.comics.idleAnimation,!0))};var ComicsScene=cleverapps.FixedWidthScene.extend({ctor:function(e,t){this._super(cleverapps.Environment.SCENE_COMICS),this.createBg(),this.addFilmEffect();var i=new Dialogue(e.dialogue,{autoClose:!0,autoScroll:3}),s=new ComicsPlayer(e.stages,this.createAnimation(e));i.on("afterClose",t),i.on("changedStage",s.onChangeStage.bind(s)),this.createDialogueView(i),i.run()},onChangeSize:function(e){if(this._super(e),this.bg&&this.bg.setScale(this.bg.baseScale/this.scene.scale),
this.animationNode.setScale(1/this.scene.scale),this.dialogueView){var t=cleverapps.styles.ComicsScene.dialogue,i=this.scene.height*(1-this.scene.scale)/2/this.scene.scale;this.dialogueView.setPositionRound(this.scene.width/2,this.dialogueView.height/2+t.offsetY-cleverapps.UI.getSceneOffsetY()/this.scene.scale-i),this.dialogueView.bg&&this.dialogueView.bg.image&&(this.dialogueView.bg.image.width=this.width/this.scene.scale)}},addFilmEffect:function(){var e=cleverapps.styles.ComicsScene,t={scale:1,silent:!0,noControls:!0};e.createFilmEffect&&(t=cleverapps.extend(t,e.createFilmEffect)),this.runAsync(function(){this.createFilmEffect(t)}.bind(this))},createAnimation:function(e){var t=this.animationNode=new cc.Node;t.setAnchorPoint2(),t.setContentSize(this.scene.getContentSize()),t.setPositionRound(this.scene.width/2,this.scene.height/2),this.scene.addChild(t);var i=1;e.useWindowScale&&cleverapps.styles.WINDOW_SCALE&&(i=cleverapps.styles.WINDOW_SCALE)
;var s=this.animation=new cleverapps.Spine(e.json,i);return t.addChild(s),s.setPositionRound(t.width/2,t.height/2),s},createDialogueView:function(e){var t=cleverapps.styles.ComicsScene.dialogue,i={overlay:!0,shadow:!1};"runes"===cleverapps.config.name&&(i.inner=!0);var s=this.dialogueView=new DialogueView(e,i);this.scene.addChild(s),s.setPositionRound(this.scene.width/2,s.height/2+t.offsetY-cleverapps.UI.getSceneOffsetY()),s.setLocalZOrder(51)},createBg:function(){var e=cleverapps.styles.ComicsScene;if(e.bg){var t=this.bg=new cc.Sprite(e.bg.image);this.scene.addChild(t),t.setPositionRound(this.scene.width/2,this.scene.height/2),this.bg.baseScale=Math.max(this.width/t.width,this.height/t.height),t.setScale(this.bg.baseScale),t.setLocalZOrder(-10)}}});ComicsScene.BUNDLES=function(e){var t=["dialogues"];return e.bundles&&(t=t.concat(e.bundles)),t},ComicsScene.showComics=function(e,t){cleverapps.scenes.replaceScene(new ComicsScene(t,e))},cleverapps.styles.ComicsScene={dialogue:{offsetY:150
}};var KeyboardController=function(){this.keyPressed={},cc.eventManager.addListener(cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:this.onKeyPressedHandler.bind(this),onKeyReleased:this.onKeyReleasedHandler.bind(this)}),2)};KeyboardController.prototype.RETURN_THROTTLE=250,KeyboardController.prototype.THROTTLE_KEYS=[cc.KEY.escape,cc.KEY.back],KeyboardController.prototype.KEYS=[cc.KEY.ctrl,cc.KEY.shift],cleverapps.config.debugMode&&KeyboardController.prototype.KEYS.push(cc.KEY.s,cc.KEY.d),KeyboardController.prototype.isPressed=function(e){return this.keyPressed[e]},KeyboardController.prototype.onKeyPressedHandler=function(e){-1!==this.KEYS.indexOf(e)&&(this.keyPressed[e]=!0)},KeyboardController.prototype.onKeyReleasedHandler=function(e){-1!==this.KEYS.indexOf(e)?this.keyPressed[e]=!1:-1!==this.THROTTLE_KEYS.indexOf(e)&&this.returnAction()},KeyboardController.prototype.returnAction=cleverapps.throttle(KeyboardController.prototype.RETURN_THROTTLE,function(){if(
0<cleverapps.windows.list.length){var e=cleverapps.windows.list[cleverapps.windows.list.length-1];e.closeByBackButton&&e.closeByBackButton()}else{var t=cc.director.getRunningScene();t&&t.closeAction()}});var LanternWindow=Window.extend({onWindowLoaded:function(e,t){var i=this.getStyles();this.mission=e,this.options=t||{},this._super({name:"lanternwindow",title:"messages:LanternWindow.Title",content:this.getContent(),button:{width:i.button.width,height:i.button.height,text:Messages.get("OK"),onPressed:this.close.bind(this)},styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.LanternWindow.window,!0)}),this.onStart()},getStyles:function(){return cleverapps.styles.LanternWindow},onStart:function(){this.mission.isRunning()&&this.addTimer();var e=this.getStyles(),t=this.animation=new cleverapps.Spine(bundles.lantern.jsons.lantern_game_json,e.animation.scale);this.picture.addChild(t),t.setPositionRound(this.picture.width/2+e.animation.x,
this.picture.height/2+e.animation.y),t.setAnimation(0,"idle_"+this.mission.logic.lantern.getCurrentStreak(),!0)},getContent:function(){var e=this.getStyles(),t=this.picture=new cc.Node;t.setContentSize(e.bg.width,e.bg.height),t.setAnchorPoint(0,0);var i=new cc.Sprite(bundles.lantern_window.frames.lantern_bg_png);i.setScale(e.bg.scale),i.setAnchorPoint(0,0),t.addChild(i);var s=this.createBonuses();s.setAnchorPoint(0,0),t.addChild(s),s.setPositionRound(e.bonuses);var n=this.createText();return n.setAnchorPoint(0,0),this.content=new cleverapps.Layout([n,t],{margin:e.margin,direction:cleverapps.UI.VERTICAL}),this.content},createBonuses:function(){var c=this.getStyles(),p=cleverapps.values(Lantern.BONUS_TYPES).sort(function(e,t){return LanternWindow.BONUSES_ORDER[e]-LanternWindow.BONUSES_ORDER[t]}),d=Lantern.BONUSES_BY_SERIA[this.mission.logic.lantern.getCurrentStreak()]||{},h=[];return p.forEach(function(e,t){var i=d[e],s=new cc.Scale9Sprite(i?c.bonuses.bonusBg.on:c.bonuses.bonusBg.off)
;s.setContentSize2(c.bonuses.bonusBg);var n=new cc.Sprite(c.bonuses.images[e].image);if(n.setScale(c.bonuses.images[e].scale),s.addChild(n),(s.icon=n).setPositionRound(s.width/2,s.height/2),i){var o=cleverapps.UI.generateTTFText("x"+d[e],c.bonuses.font);s.addChild(o),o.setPositionRound(c.bonuses.amount)}else n.setColor(new cc.Color(120,120,120,255));if(h.push(s),t<p.length-1){var a=new cc.Sprite(c.bonuses.arrow.image);if(a.setLocalZOrder(1),h.push(a),c.flashingArrows){var r=cleverapps.styles.COLORS.WHITE,l=cleverapps.styles.COLORS.COLOR_DARK_GRAY;i?d[p[t+1]]||a.runAction(new cc.RepeatForever(new cc.Sequence(new cc.TintTo(.9,l.r,l.g,l.b),new cc.DelayTime(.1),new cc.TintTo(.9,r.r,r.g,r.b),new cc.DelayTime(.1)))):a.setColor(l)}}}.bind(this)),new cleverapps.Layout(h,{direction:cleverapps.UI.HORIZONTAL,margin:c.bonuses.margin})},createText:function(){var e=this.getStyles(),t=cleverapps.UI.generateTTFText("messages:LanternWindow.text",e.text.font);return t.setDimensions(e.text.width,0),
t.fitTo(void 0,e.text.height),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t},addTimer:function(){var e=this.getStyles(),t=new cc.Scale9Sprite(e.timer.bg.image);t.setContentSize2(e.timer.bg);var i={background_content:t,font:e.timer.font},s=new cleverapps.CountDownView(new cleverapps.CountDown(this.mission.countdown.getTimeLeft(),{onFinish:this.close.bind(this)}),i);this.picture.addChild(s),s.setPositionRound(e.timer)},listBundles:function(){return["windows","lantern_window","lantern"]}});LanternWindow.BONUSES_ORDER={heroes:0,moves:1,multicolor:2},cleverapps.overrideFonts(cleverapps.styles.FONTS,{LANTERN_WINDOW_TEXT:{size:33,color:new cc.Color(130,70,40,255)},LANTERN_WINDOW_AMOUNT_TEXT:{size:45,color:cleverapps.styles.COLORS.WHITE,stroke:{size:2,color:cleverapps.styles.COLORS.BLACK}}}),cleverapps.styles.LanternWindow={margin:30,bg:{scale:2,width:612,height:532},timer:{x:{align:"center"},y:{align:"top",dy:15},font:cleverapps.styles.FONTS.WINDOW_TEXT,bg:{
image:bundles.main.frames.tournamentstory_bg,width:215,height:65}},text:{height:400,width:600,font:cleverapps.styles.FONTS.LANTERN_WINDOW_TEXT},button:{width:220,height:110},animation:{x:0,y:20,scale:1},bonuses:{x:{align:"center"},y:{align:"bottom",dy:5},bonusBg:{width:180,height:180,on:bundles.lantern_window.frames.bonus_bg_on_png,off:bundles.lantern_window.frames.bonus_bg_off_png},arrow:{image:bundles.lantern_window.frames.lantern_arrow_png},offsetY:5,margin:-23,font:cleverapps.styles.FONTS.LANTERN_WINDOW_AMOUNT_TEXT,amount:{x:{align:"right",dx:-28},y:{align:"bottom",dy:17}},images:{heroes:{image:bundles.reward_icons.frames.heroes_png,scale:1},moves:{image:bundles.reward_icons.frames.moves_png,scale:1},multicolor:{image:bundles.reward_icons.frames.multicolor_png,scale:1}}},window:{Border:{y:170}}};var WardrobeWindow=Window.extend({onWindowLoaded:function(e){this.mission=e,this.wardrobeBundle=bundles[cleverapps.skins.getBundle()||e.feature];var t=cleverapps.styles.WardrobeWindow,
i=cleverapps.environment.isGameScene(),s=cleverapps.overrideStyles(cleverapps.styles.Window,{HelpButton:t.HelpButton,bandButton:!0},!0);this._super({name:"wardrobewindow",content:this.generateContent(),styles:s,help:function(){this.close(),new WardrobeRulesWindow(e)}.bind(this),button:{width:t.button.width,height:t.button.height,button_png:t.button.button_png,button_on_png:t.button.button_on_png,text:i?Messages.get("OK"):Messages.get("Play"),onPressed:function(){cleverapps.eventLogger.logEvent(cleverapps.styles.WardrobeWindow.eventName+"_play"+(i?"_ongame":"")),this.close(),cleverapps.metha.distract({focus:"WardrobePlayButtonPressed",action:function(e){cleverapps.metha.wantsToPlay(e)}})}.bind(this)}})},generateUpperBanner:function(e){var t=cleverapps.styles.WardrobeWindow.banner;this.banner=new cc.Sprite(cleverapps.skins.getSlot("wardrobeWindowBanner"));var i=new ccui.Layout;i.setAnchorPoint2(),i.setPositionRound(t.position.x+e.width/2,e.height+t.position.y),i.setContentSize2(
this.banner.width,2*this.banner.height),i.setClippingEnabled(!0),e.addChild(i),this.banner.setPositionRound(i.width/2,this.banner.height/2),i.addChild(this.banner),this.refreshPerson()},refreshPerson:function(){var e=cleverapps.styles.WardrobeWindow.person;this.banner.removeAllChildren();var t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.width,e.height),this.person=new cleverapps.Spine(e.json,e.scale),this.person.setAnimation(0,"idle",!0),t.addChild(this.person),this.person.setPositionRound(t.width/2,t.height/2),this.banner.addChild(t),t.setPositionRound(this.banner.width/2+e.position.x,this.banner.height/2+e.position.y)},refreshStagesScroll:function(){var e=cleverapps.styles.WardrobeWindow.stages;this.stages.removeAllChildren();for(var t=[],i=0;i<WardrobeWindow.stages.length;i++)t.push(this.generateStageContent(i));var s=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL,margin:e.margin});this.stagesScroll=new cleverapps.UI.ScrollView(s,{
childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_LINEAR}),this.stagesScroll.setContentSize2(e.width,e.height-2*e.padding),this.stagesScroll.setPositionRound(this.stages.width/2,this.stages.height/2),this.stages.addChild(this.stagesScroll);var n=this.mission.logic.getCurrentStage().stage;n>=t.length&&(n=t.length-1),this.needScroll=t[n]},addTimer:function(){var e=this.mission.finishTime()-Date.now();if(!(e<=0)){var t=new cleverapps.CountDown(e,{onFinish:this.close.bind(this)}),i=cleverapps.styles.WardrobeWindow.timer,s={font:i.font,timerPosition:{x:0,y:i.offsetY},regularFontTimerPosition:{x:0,y:i.regularFont.offsetY}};if(i.bg){var n=cleverapps.UI.createScale9Sprite(i.bg.image);n.setContentSize2(i.bg.width,i.bg.height),s.background_content=n}var o=new cleverapps.CountDownView(t,s);this.banner.addChild(o),o.setPositionRound(i.position)}},generateContent:function(){var e=cleverapps.styles.WardrobeWindow,t=new cc.Node;t.setContentSize2(e.width,e.height),t.setAnchorPoint2(),
this.generateUpperBanner(t),this.stages=new cc.Scale9Sprite(e.stages.bg),this.stages.setContentSize2(e.stages.width,e.stages.height);var i=cleverapps.UI.generateTTFText("messages:WardrobeDescText",cleverapps.styles.FONTS.WINDOW_TEXT);i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setDimensions(t.width,0),i.fitTo(void 0,e.text.height);var s=new cleverapps.Layout([i,this.stages],{direction:cleverapps.UI.VERTICAL,margin:e.content.margin});return s.setPositionRound(t.width/2+e.content.position.x,t.height/2+e.content.position.y),t.addChild(s),e.zOrder&&t.setLocalZOrder(e.zOrder),this.refreshStagesScroll(),this.addTimer(),t},scrollToNeedStage:function(e){if(!1!==this.needScroll){var t=this.mission.logic.getCurrentStage().stage;t<WardrobeWindow.stages.length-1&&this.stagesScroll.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.CallFunc(function(){this.stagesScroll.scrollTo(this.needScroll,.5*(WardrobeWindow.stages.length-1-t)),this.needScroll=!1}.bind(this))))}},onShow:function(){
this._super(),this.scrollToNeedStage(.2)},buyDecoration:function(e,t,i){levels.user.takeGold(t)&&(this.close(),this.mission.update(i),cleverapps.eventLogger.logEvent("buy_"+cleverapps.styles.WardrobeWindow.eventName+"_"+(e+1),{amount:t}),cleverapps.eventLogger.logEvent("buy_"+cleverapps.styles.WardrobeWindow.eventName+"_amount_"+(e+1)),this.mission.logic.stageToShow=e+1)},generateStageContent:function(e){var t=cleverapps.styles.WardrobeWindow.stages.stage,i=this.mission.logic.getCurrentStage(),s=0,n=!1,o=!1;i.stage>e?(s=WardrobeWindow.stages[e],n=!0):i.stage==e&&(s=i.progress,o=!0);var a=new cc.Scale9Sprite(t.bg);a.setContentSize2(t.width,t.height),a.setAnchorPoint2();var r=new cc.Node;r.setAnchorPoint2(),r.setContentSize2(a.getContentSize()),r.setPositionRound(a.width/2,a.height/2),r.setCascadeOpacityEnabled(!0),a.addChild(r);var l=new cc.Sprite(this.wardrobeBundle.frames["stage"+(e+1)+"_icon"]);if(l.setPositionRound(t.icon.position.x,t.icon.position.y+r.height/2),l.setScale(
t.icon.scale),r.addChild(l),n&&t.icon.passedMark){var c=new cc.Sprite(t.icon.passedMark.icon);c.setPositionRound(l.x+t.icon.passedMark.position.x,l.y+t.icon.passedMark.position.y),c.setScale(t.icon.passedMark.scale),r.addChild(c)}if(!o){var p=cleverapps.UI.generateTTFText(n?"messages:WardrobeCompleteText":"messages:WardrobeStageTaskText",cleverapps.styles.FONTS.WINDOW_TEXT,{amount:WardrobeWindow.stages[e]});p.fitTo(t.text.width,0),p.setPositionRound(t.text.position.x,t.text.position.y+r.height/2),p.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),r.addChild(p)}if(o){var d=new cc.Scale9Sprite(t.progress.bg);d.setContentSize2(t.progress.width,t.progress.height),d.setAnchorPoint2(),this.progressBar=new ScaledProgressBar(t.progress.line),this.progressBar.setAnchorPoint2(),this.progressBar.setDimension(d.width-2*t.progress.padding.x,d.height-2*t.progress.padding.y),this.progressBar.setPositionRound(t.progress.padding.x,t.progress.padding.y),this.progressBar.setPercentage(
s/WardrobeWindow.stages[e]*100),d.addChild(this.progressBar);var h=cleverapps.UI.generateTTFText("messages:WardrobeCurrentText",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);h.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),h.fitTo(d.width);var u=cleverapps.UI.generateTTFText(s+"/"+WardrobeWindow.stages[e],cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);u.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var v=new cleverapps.Layout([u,d,h],{direction:cleverapps.UI.VERTICAL,margin:t.currentDesc.margin});v.setPositionRound(t.currentDesc.position.x,t.currentDesc.position.y+r.height/2),r.addChild(v);var g=new cc.Sprite(bundles.menubar.frames.coin_png);g.setScale(t.button.coin.scale);var m=cleverapps.UI.generateTTFText(WardrobeWindow.prices[e],cleverapps.styles.FONTS.BUTTON_SMALL_TEXT),f=new cleverapps.Layout([m,g],{direction:cleverapps.UI.HORIZONTAL,margin:t.button.margin}),_=new cleverapps.UI.Button({content:f,width:t.button.width,height:t.button.height,onClicked:function(){this.buyDecoration(e,
WardrobeWindow.prices[e],WardrobeWindow.stages[e]-s)}.bind(this),button_png:t.button.button_png,button_on_png:t.button.button_on_png}),y=cleverapps.UI.generateTTFText("messages:WardrobeBuyText",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);y.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),y.fitTo(t.buttonContainer.width);var w=new cleverapps.Layout([y,_],{direction:cleverapps.UI.VERTICAL,margin:t.buttonContainer.margin});w.setPositionRound(t.buttonContainer.position.x,t.buttonContainer.position.y+r.height/2),r.addChild(w)}var b=WardrobeWindow.prizes[e+1];if(b&&!n){var S=new cc.Node;S.setAnchorPoint2(),S.setPositionRound(t.present.x,t.present.y),S.setContentSize2(t.present.width,t.present.height);var T=new cleverapps.Spine(t.present.animation.json,t.present.scale);T.setAnimation(0,t.present.animation.animation,!0),t.present.animation.skin&&T.setSkin(t.present.animation.skin),b.skin&&T.setSkin(b.skin),S.addChild(T),T.setPositionRound(S.width/2,S.height/2),cleverapps.tooltipManager.create(S
,{rewards:b.prize,text:"messages:WardrobePrizeRewardTitle",position:cleverapps.styles.UI.Tooltip.LOCATION.above}),r.addChild(S,t.present.zOrder?t.present.zOrder:-1)}return n||o||p.setOpacity(80),a}});WardrobeWindow.prototype.listBundles=function(){return["wardrobe_window"]},WardrobeWindow.stages=[1,2,3,4,5,5,5,5,5,5,5,5],WardrobeWindow.prices=[100,150,300,350,650,1e3,1250,1500,2e3,2500,3e3,3500],WardrobeWindow.prizes={4:{prize:{gold:100},skin:"pink"},8:{prize:{gold:300},skin:"blue"},12:{prize:{gold:500},skin:"green"}},cleverapps.styles.WardrobeWindow={eventName:"wardrobe",HelpButton:{x:{align:"left",dx:64},y:{align:"bottom",dy:64}},CloseButton:{},timer:{font:cleverapps.styles.FONTS.SMALL_WHITE_TEXT,offsetY:-2,regularFont:{offsetY:-2},position:{x:{align:"center",dx:0},y:{align:"bottom",dy:4}},bg:{width:180,height:50,image:bundles.wardrobe_window.frames.progress_bg}},person:{json:bundles.main.jsons.hero_json,scale:.65,width:200,height:200,position:{x:-80,y:44}},banner:{position:{x:0,
y:130}},stages:{bg:bundles.wardrobe_window.frames.window_table_bg,width:596,height:506,padding:14,margin:14,stage:{bg:res.row_player_png,width:566,height:150,present:{x:160,y:97,iconDelta:20,width:100,height:100,scale:.55,animation:{json:bundles.windows.jsons.present_json,animation:"animation"}},currentDesc:{margin:6,position:{x:270,y:0}},buttonContainer:{width:120,position:{x:470,y:0},margin:2},button:{width:160,height:74,button_png:res.small_green_button,button_on_png:res.small_green_button_on,margin:4,coin:{scale:.46}},progress:{width:200,height:28,padding:{x:2,y:2},bg:bundles.wardrobe_window.frames.progress_bg,line:bundles.wardrobe_window.frames.progress_fill},text:{width:330,position:{x:360,y:0}},icon:{scale:.8,position:{x:80,y:0},passedMark:{icon:res.goal_done_sign,scale:1,position:{x:60,y:-26}}}}},width:520,height:800,content:{margin:30,position:{x:0,y:-40}},text:{height:180},button:{button_png:res.red_button,button_on_png:res.red_button_on,width:250,height:100}}
;var WardrobeReceiveWindow=Window.extend({onWindowLoaded:function(e){this.mission=e;var t=cleverapps.styles.WardrobeReceiveWindow;this._super({name:"wardrobereceivewindow",content:this.generateContent(),closeButton:!1,button:{width:t.button.width,height:t.button.height,text:Messages.get("OK"),onPressed:this.close.bind(this)}})},onShow:function(){this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){this.visible&&cleverapps.audio.playSound(bundles.main.urls.reward_window_effect)}.bind(this))))},personAnimation:function(){this.person.setAnimation(0,cleverapps.styles.WardrobeReceiveWindow.person.actionAnimation,!1),this.person.setCompleteListener(function(){this.person.setCompleteListener(function(){}),this.person.setAnimation(0,"idle",!0),this.personNode.runAction(new cc.Sequence(new cc.DelayTime(5),new cc.CallFunc(this.personAnimation.bind(this))))}.bind(this))},generateContent:function(){var e=cleverapps.styles.WardrobeReceiveWindow,t=new cc.Node
;t.setContentSize2(e.width,e.height),t.setAnchorPoint2(),this.personNode=new cc.Node,this.personNode.setContentSize2(e.personNode.width,e.personNode.height),this.personNode.setAnchorPoint2(),this.person=new cleverapps.Spine(e.person.json,e.person.scale),this.personNode.addChild(this.person),this.person.setPositionRound(this.personNode.width/2,this.personNode.height/2);var i=cleverapps.UI.generateTTFText("messages:WardrobeRecieveText",cleverapps.styles.FONTS.WINDOW_TEXT);i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setDimensions(t.width,0);var s=new cleverapps.Layout([this.personNode,i],{direction:cleverapps.UI.VERTICAL,margin:e.content.margin});return s.setPositionRound(t.width/2+e.content.position.x,t.height/2+e.content.position.y),t.addChild(s),this.personAnimation(),t}});WardrobeReceiveWindow.prototype.listBundles=function(){return["wardrobe_window"]},cleverapps.styles.WardrobeReceiveWindow={width:520,height:500,personNode:{width:300,height:500},personLayout:{position:{x:50,
y:-10}},person:{json:bundles.main.jsons.hero_json,actionAnimation:"idle_jump",scale:.9,width:100,height:50,position:{x:80,y:220}},content:{margin:50,position:{x:0,y:90}},button:{width:250,height:100}};var WardrobeRulesWindow=Window.extend({onWindowLoaded:function(e){this.mission=e,this.wardrobeBundle=bundles[cleverapps.skins.getBundle()||e.feature];var t=cleverapps.styles.WardrobeRulesWindow;this._super({name:"wardroberuleswindow",content:this.generateContent(),button:{width:t.button.width,height:t.button.height,text:Messages.get("OK")}})},scrollToStage:function(e){var t=0;0<e&&((t=this.stageNodes[this.skin-1].x-this.stagesLayout.width/2)<0&&(t=0),t>this.stagesList.width-this.stagesLayout.width&&(t=this.stagesList.width-this.stagesLayout.width));this.stagesList.runAction(new cc.MoveTo(.3,{x:-t,y:this.stagesList.y}))},updateSkin:function(){void 0===this.skin?this.skin=0:(0!==this.skin&&this.stageNodes[this.skin-1].setOpacity(100),this.skin=(this.skin+1)%(WardrobeWindow.stages.length+1),
0!==this.skin&&this.stageNodes[this.skin-1].setOpacity(255)),this.person.setSkin("skin_"+this.skin);var e=cleverapps.styles.WardrobeRulesWindow.states[this.skin];e.mirror?this.personNode.setScaleX(-1):this.personNode.setScaleX(1),this.scrollToStage(this.skin),e.animation&&(this.person.setAnimation(0,e.animation,!1),this.person.setCompleteListener(function(){this.person.setAnimation(0,"idle",!0)}.bind(this))),e.sound&&cleverapps.audio.playSound(e.sound),this.person.runAction(new cc.Sequence(new cc.DelayTime(e.time),new cc.CallFunc(function(){this.updateSkin()}.bind(this))))},onClose:function(){new WardrobeWindow(this.mission)},generateContent:function(){var e=cleverapps.styles.WardrobeRulesWindow,t=new cc.Node;t.setContentSize2(e.width,e.height),t.setAnchorPoint2();var i=this.personNode=new cc.Node;i.setAnchorPoint2(),i.setContentSize(e.person.width,e.person.height),this.person=new cleverapps.Spine(e.person.json,e.person.scale),this.person.setAnimation(0,"idle",!0),i.addChild(
this.person),this.person.setPositionRound(e.person.position),this.stageNodes=[];for(var s=0;s<WardrobeWindow.stages.length;s++){var n=new cc.Sprite(this.wardrobeBundle.frames["stage"+(s+1)+"_icon"]);n.setScale(e.icon.scale),n.setOpacity(100),this.stageNodes.push(n)}this.stagesList=new cleverapps.Layout(this.stageNodes,{direction:cleverapps.UI.HORIZONTAL,margin:e.icon.margin}),this.stagesLayout=new ccui.Layout,this.stagesLayout.addChild(this.stagesList),this.stagesLayout.setClippingEnabled(!0),this.stagesLayout.setContentSize2(e.icons.width,e.icons.height),this.stagesLayout.setAnchorPoint2(),this.stagesList.setAnchorPoint2(0,.5),this.stagesList.setPositionRound(0,this.stagesLayout.height/2),this.updateSkin();var o=cleverapps.UI.generateTTFText("messages:WardrobeRulesText",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.setDimensions(t.width,0),o.fitTo(void 0,e.text.height);var a=new cleverapps.Layout([o,this.stagesLayout,i],{
direction:cleverapps.UI.VERTICAL,margin:e.content.margin});return a.setPositionRound(t.width/2+e.content.position.x,t.height/2+e.content.position.y),t.addChild(a),t}});WardrobeRulesWindow.prototype.listBundles=function(){return["wardrobe_window"]},cleverapps.styles.WardrobeRulesWindow={width:520,height:780,icons:{width:500,height:110},icon:{scale:.55,margin:15},person:{json:bundles.main.jsons.hero_json,scale:1,width:200,height:260,position:{x:{align:"center"},y:{align:"center"}}},text:{height:260},content:{margin:30,position:{x:0,y:-40}},button:{width:250,height:100},states:[{time:1,mirror:!1},{time:1,mirror:!1},{animation:"idle_jump",time:2,mirror:!1},{time:1,mirror:!0},{animation:"idle_jump",time:2,mirror:!0},{time:1,mirror:!1},{animation:"idle_jump",time:2,mirror:!1},{time:1,mirror:!0},{animation:"idle_jump",time:2,mirror:!0},{time:1,mirror:!1},{animation:"idle_jump",time:2,mirror:!1},{time:1,mirror:!0},{animation:"idle_jump",time:5,mirror:!0}]};var Favorite=function(e){
this.mission=e,this.productId=Favorite.CalcFavorite(),this.product=new Product(this.productId),this.product.favorite=!0};Favorite.prototype.getReward=function(){return RewardsConfig.Favorite[this.productId]},Favorite.prototype.isPackProduct=function(){return-1!==Favorite.PACK_PRODUCTS.indexOf(this.productId)},Favorite.CalcFavorite=function(){return cleverapps.paymentsHistory.calcFavoriteProduct(Favorite.ListProducts())},Favorite.ListProducts=function(){return"match3"===cleverapps.config.type||-1!==["scramble","tripeaks"].indexOf(cleverapps.config.name)?Favorite.PACK_PRODUCTS.concat(Favorite.COIN_PRODUCTS):Favorite.COIN_PRODUCTS},Favorite.IsAvailable=function(){return void 0!==Favorite.CalcFavorite()},Favorite.PACK_PRODUCTS=["jamPack","tastyPack","honeyPack","epicPack","sweetPack"],Favorite.COIN_PRODUCTS=["gold1800","gold3800","gold6000","gold25000"];var BoostersSale=function(e){this.mission=e,this.reward=void 0,this.onRewardListener=function(){}}
;BoostersSale.prototype.listProducts=function(){var e=this.mission.productsExpensive;switch(cleverapps.paymentsHistory.classify()){case cleverapps.PaymentsHistory.PAYER_NONE:case cleverapps.PaymentsHistory.PAYER_WEAK:e=this.mission.productsCheap}return e},BoostersSale.prototype.onUpdate=function(){this.mission.result===BoostersSale.PURCHASES_LIMIT&&(this.reward=this.mission.prize,this.onRewardListener(),this.mission.complete())},BoostersSale.PURCHASES_LIMIT=5;var WardRobeMissionLogic=function(e){this.mission=e,this.refreshSkin(this.mission)};WardRobeMissionLogic.prototype.refreshSkin=function(){var t=void 0;["valentines","xmas","memorial"].forEach(function(e){-1!==cleverapps.eventManager.listCurrentFeatures().indexOf(e)&&(t=e)});var e=t?"wardrobe_"+t:"wardrobe",i=t?bundles[t].jsons.hero_json:bundles.main.jsons.hero_json,s="skin_"+this.getCurrentStage(this.mission).stage;cleverapps.Spine.updateSkin(e,i,s),cleverapps.user.trigger("heroSkinUpdated",s)},
WardRobeMissionLogic.prototype.onUpdate=function(){this.refreshSkin(this.mission)},WardRobeMissionLogic.prototype.skipNext=function(){return this.mission.isRunning()&&this.stageToShow},WardRobeMissionLogic.prototype.getCurrentStage=function(){for(var e=0,t=this.mission.result;t>=WardrobeWindow.stages[e];)t-=WardrobeWindow.stages[e],e++;return e===WardrobeWindow.stages.length?{stage:e,finished:!0}:{stage:e,progress:t}},WardRobeMissionLogic.prototype.getProgressForStage=function(e){var t=0;return WardrobeWindow.stages.slice(0,e).forEach(function(e){t+=e}),t},WardRobeMissionLogic.prototype.runReceiveDialogue=function(e){for(var t=[],i="WardrobeDialogue.stage"+(this.getCurrentStage().stage-1)+".text",s=0;Messages.has(i+s);s++)t.push({text:Messages.get(i+s)});if(t.length){var n=new Dialogue(t,{showUp:!0}),o=function(){n.stage>=n.data.length-1&&n.close()};n.on("afterClose",e),n.on("buttonClicked",o),n.on("screenClicked",function(){n.typing||o()}),new DialogueView(n,{autoPosition:!0,
overlay:!0}),n.run()}else e()},WardRobeMissionLogic.prototype.givePrize=function(e,t){var i=WardrobeWindow.prizes[e];if(i){var s=cleverapps.styles.FONTS.WINDOW_TITLE_TEXT;cleverapps.styles.FONTS.SMALL_TITLE_TEXT&&cleverapps.eventManager.isActive("valentines")&&(s=cleverapps.styles.FONTS.SMALL_TITLE_TEXT),new RewardWindow({title:{text:"messages:WardrobePrizeRewardTitle",font:s},callback:t,reward:i.prize})}else t()},WardRobeMissionLogic.prototype.processEvent=function(e,t){if(e===Mission.EVENT_LEVEL_FINISH&&this.mission.isRunning()&&(t.level.isRegular()&&t.level.isNew()||t.level.episode.isDailyCup())){var i=this.getCurrentStage().stage;this.mission.update(1);var s=this.getCurrentStage().stage;s!==i&&(this.stageToShow=s)}},WardRobeMissionLogic.IsAvailable=function(){return-1!==["wordsoup","crocword","scramble"].indexOf(cleverapps.config.name)};var LanternMissionLogic=function(e){this.mission=e,this.lantern=new Lantern(e)};LanternMissionLogic.prototype.giveBonus=function(e,t){
this.lantern.isActive(t)&&0<this.lantern.getCurrentStreak()?cleverapps.metha.compound(e,[function(e){new LanternView(this.lantern),Game.counter.setTimeout(e,1e3*cleverapps.styles.LanternView.show.delay)}.bind(this),function(e){this.lantern.giveBonus(e)}.bind(this)]):e()},LanternMissionLogic.IsAvailable=function(){return levels.user.checkAvailable(LanternMissionLogic.AVAILABLE)},LanternMissionLogic.AVAILABLE={episode:4,level:3,adventure:{episode:4,level:3,debugMode:!0}},Mission.EVENT_LEVEL_FINISH=0,Mission.EVENT_COLLECT_COLOR_CELLS=1,Mission.EVENT_COLLECT_HERO_CELLS=2,Mission.EVENT_USE_MULTI_COLOR_CELL=3,Mission.EVENT_COMPLETE_DAILY_TASK=4,Mission.EVENT_PLAY_DAILYCUP=5,Mission.EVENT_COLLECT_CLOVER=6,Mission.EVENT_COLLECT_STARS=7,Mission.EVENT_WIN_DAILYCUP=8,Mission.EVENT_PASS_LEVELS_IN_ROW=9,Mission.TYPE_COMBO=0,Mission.TYPE_COLLECT_MARK=1,Mission.TYPE_BURN_NEARBY=2,Mission.TYPE_LETTER=3,Mission.TYPE_TREASURE_SEARCH=7,Mission.TYPE_LANTERN=9,Mission.TYPE_WARDROBE=10,
Mission.TYPE_FAVORITE_SALE=11,Mission.TYPE_LIVES_SALE=12,Mission.TYPE_BOOSTERS_SALE=13,Mission.TYPE_COINS_SALE=14,Mission.TYPE_BATTLEPASS=15,Mission.TYPE_RACE=16,Mission.TYPE_RAFFLE=17,Mission.TYPE_STICKERS_COLLECTION=18;var Missions={SEMAPHORE_CLASSIC:1,SEMAPHORE_BACKGROUND:2,SEMAPHORE_LANTERN:4,SEMAPHORE_WARDROBE:8,SEMAPHORE_SALE:16,SEMAPHORE_BATTLEPASS:32,SEMAPHORE_RAFFLE:64},BaseMissionData={available:{episode:1,level:11,social:!0},view:MissionWindow,duration:"1 day",semaphore:Missions.SEMAPHORE_CLASSIC,cooldown:"1 minute",startWindow:MissionRulesWindow,prize:RewardsConfig.Tournament.places};Missions[Mission.TYPE_COMBO]=cleverapps.extend({},BaseMissionData,{available:{episode:2,level:7,social:!0},name:"MagicTournament",icon:bundles.main.frames.clover_png,gameIcon:bundles.game.frames.clover_png,competition:{step:[5,20],amount:[20,30]},bundle:"magic_tournament",sideBarJson:bundles.sidebar.jsons.tournament_magic_icon_json,finishView:MissionWindow}),
Missions[Mission.TYPE_COLLECT_MARK]=cleverapps.extend({},BaseMissionData,{available:{episode:1,level:12,social:!0},name:"RoseTournament",icon:bundles.main.frames.rose_png,gameIcon:bundles.game.frames.rose_png,competition:{step:[10,40],amount:[20,30]},bundle:"rose_tournament",sideBarJson:bundles.sidebar.jsons.tournament_rose_icon_json,finishView:MissionWindow}),Missions[Mission.TYPE_BURN_NEARBY]=cleverapps.extend({},BaseMissionData,{available:{episode:2,level:3,social:!0},name:"TulpanTournament",icon:bundles.main.frames.tulpan_png,gameIcon:bundles.game.frames.tulpan_png,competition:{step:[3,10],amount:[20,30]},bundle:"tulpan_tournament",sideBarJson:bundles.sidebar.jsons.tournament_tulpan_icon_json,finishView:MissionWindow}),Missions[Mission.TYPE_LETTER]=cleverapps.extend({},BaseMissionData,{name:"LetterTournament",icon:bundles.main.frames.mission_letter_png,gameIcon:bundles.game.frames.mission_letter_png,competition:{step:[2,6],amount:[20,30]},cooldown:"2 days",
sideBarJson:bundles.sidebar.jsons.mission_letter_icon_json,finishView:MissionWindow,bundle:"letter_tournament",STAR_TYPES_AMOUNT:2}),Missions[Mission.TYPE_TREASURE_SEARCH]=cleverapps.extend({},BaseMissionData,{available:{episode:2,level:7,social:!1},name:"TreasureSearch",view:TreasureSearchWindow,icon:res.shovel,minigame:{price:1},prize:RewardsConfig.TreasureSearch,startWindow:TreasureSearchWindow,nudgeWindow:TreasureSearchWindow,duration:"3 days",semaphore:Missions.SEMAPHORE_BACKGROUND,cooldown:"3 days",bundle:"treasuresearch",sideBarJson:bundles.sidebar.jsons.treasure_search_icon_json}),Missions[Mission.TYPE_STICKERS_COLLECTION]=cleverapps.extend({},BaseMissionData,{available:{episode:2,level:7,social:!0},name:"StickersCollection",view:StickersCollectionWindow,minigame:{price:1},prize:RewardsConfig.StickersCollection,startWindow:StickersCollectionWindow,nudgeWindow:StickersCollectionWindow,duration:"3 days",semaphore:Missions.SEMAPHORE_BACKGROUND,cooldown:"3 days",
bundle:"stickers_collection",sideBarJson:bundles.sidebar.jsons.stickers_collection_icon_json,logic:StickersCollectionLogic,startCurrency:0,tournament:!0}),Missions[Mission.TYPE_LANTERN]=cleverapps.extend({},BaseMissionData,{available:{episode:4,level:3,social:!1},name:"Lantern",view:LanternWindow,duration:"2 day",semaphore:Missions.SEMAPHORE_LANTERN,cooldown:"5 days",startWindow:LanternWindow,sideBarJson:bundles.sidebar.jsons.lantern_icon_json,iconForce:Forces.LANTERN,logic:LanternMissionLogic,prize:void 0}),Missions[Mission.TYPE_WARDROBE]=cleverapps.extend({},BaseMissionData,{available:{episode:1,level:11,social:!1},name:"Wardrobe",view:WardrobeWindow,semaphore:Missions.SEMAPHORE_WARDROBE,startWindow:WardrobeRulesWindow,logic:WardRobeMissionLogic,sideBarJson:bundles.sidebar.jsons.wardrobe_icon_json,feature:"wardrobe"}),Missions[Mission.TYPE_BATTLEPASS]=cleverapps.extend({},BaseMissionData,{name:"BattlePass",view:BattlePassWindow,semaphore:Missions.SEMAPHORE_BATTLEPASS,
startWindow:BattlePassWindow,finishView:BattlePassWindow,logic:BattlePassMissionLogic,sideBarJson:bundles.sidebar.jsons.battlepass_icon_json,feature:"battlepass",cooldown:"15 days"}),Missions[Mission.TYPE_RACE]=cleverapps.extend({},BaseMissionData,{name:"Race",view:RaceScene,semaphore:Missions.SEMAPHORE_BATTLEPASS,startWindow:void 0,finishView:RaceScene,logic:RaceMissionLogic,sideBarJson:bundles.sidebar.jsons.race_icon_json,iconForce:Forces.RACE,feature:"race",cooldown:"8 days",competition:{amount:[4,4],superBots:[1,2],superBotsForce:CompetitionAlgorithm.BOT_SUPER_FORCE,minBotForce:5},available:{episode:2,level:1}}),Missions[Mission.TYPE_FAVORITE_SALE]=cleverapps.extend({},BaseMissionData,{priority:5,name:"FavoriteSale",view:FavoriteSaleWindow,semaphore:Missions.SEMAPHORE_SALE,startWindow:FavoriteSaleWindow,logic:Favorite,sideBarJson:bundles.sidebar.jsons.lives_sale_icon_json,prize:RewardsConfig.Sale,feature:"favorite"}),Missions[Mission.TYPE_LIVES_SALE]=cleverapps.extend({},
BaseMissionData,{name:"LivesSale",view:BoostersSaleWindow,semaphore:Missions.SEMAPHORE_SALE,startWindow:BoostersSaleWindow,logic:BoostersSale,sideBarJson:bundles.sidebar.jsons.lives_sale_icon_json,prize:RewardsConfig.Sale,feature:"lives",productsCheap:["unlimitedLives05","lives074","exp1"],productsExpensive:["unlimitedLives2","lives3","exp4"],available:{episode:1,level:1}}),-1!==["tripeaks","scramble"].indexOf(cleverapps.config.name)&&(Missions[Mission.TYPE_FAVORITE_SALE].sideBarJson=bundles.sidebar.jsons.favorite_sale_icon_json),"match3"!==cleverapps.config.type&&(Missions[Mission.TYPE_LIVES_SALE].productsCheap=cleverapps.substract(Missions[Mission.TYPE_LIVES_SALE].productsCheap,["exp1"]),Missions[Mission.TYPE_LIVES_SALE].productsExpensive=cleverapps.substract(Missions[Mission.TYPE_LIVES_SALE].productsExpensive,["exp4"])),Missions[Mission.TYPE_BOOSTERS_SALE]=cleverapps.extend({},BaseMissionData,{name:"BoostersSale",view:BoostersSaleWindow,semaphore:Missions.SEMAPHORE_SALE,
startWindow:BoostersSaleWindow,sideBarJson:bundles.sidebar.jsons.boosters_sale_icon_json,logic:BoostersSale,prize:RewardsConfig.Sale,feature:"boosters",productsCheap:["cellPack05","linePack074","colorPack10"],productsExpensive:["cellPack2","linePack3","colorPack4"],available:{episode:1,level:1}}),"stacks"===cleverapps.config.subtype&&(Missions[Mission.TYPE_BOOSTERS_SALE].productsCheap=["hintBoosterBeforePack3","eyePack2","highlightPack1"],Missions[Mission.TYPE_BOOSTERS_SALE].productsExpensive=["hintBoosterBeforePack3","eyePack2","highlightPack1"]),Missions[Mission.TYPE_COINS_SALE]=cleverapps.extend({},BaseMissionData,{name:"CoinsSale",view:BoostersSaleWindow,semaphore:Missions.SEMAPHORE_SALE,startWindow:BoostersSaleWindow,sideBarJson:bundles.sidebar.jsons.coins_sale_icon_json,logic:BoostersSale,prize:RewardsConfig.Sale,feature:"coins",productsCheap:["gold500sale","gold1800sale"],productsExpensive:["gold500sale","gold1800sale"],available:{episode:1,level:1}}),
Missions[Mission.TYPE_RAFFLE]=cleverapps.extend({},BaseMissionData,{name:"Raffle",view:RaffleWindow,semaphore:Missions.SEMAPHORE_RAFFLE,startWindow:RaffleWindow,sideBarJson:bundles.sidebar.jsons.raffle_icon_json,logic:RaffleMissionLogic,finishView:void 0,prize:void 0,feature:"raffle",available:{episode:2,level:0}}),"olympics"===cleverapps.config.name&&cleverapps.override(Missions[Mission.TYPE_LIVES_SALE],{productsCheap:["unlimitedLives05","lives074","gold1"],productsExpensive:["unlimitedLives2","lives3","gold4"],sideBarJson:bundles.sidebar.jsons.lives_sale_json});var CurrentEpisodeLabel=cc.Node.extend({ctor:function(e,t){this._super(),this.episode=e,this.createContent(),this.setAnchorPoint2(),this.setPositionRound({x:{align:"center"},y:{align:"center"}}),this.setLocalZOrder(1)},createContent:function(){this.bg=this.createBg();var e=this.label=new cc.Node;e.setAnchorPoint2(),e.setContentSize2(this.bg.getContentSize()),e.addChild(this.bg),e.setPositionRound(
cleverapps.styles.CurrentEpisodeLabel.label.alignment),this.addLabelText(),this.setContentSize2(e.getContentSize()),this.addChild(this.label)},createBg:function(){var e,t=cleverapps.styles.CurrentEpisodeLabel.background;if(t.json){(e=new cc.Node).setAnchorPoint2(),e.setContentSize2(t);var i=this.bgAnimation=new cleverapps.Spine(t.json);i.setAnimation(0,"idle",!1),i.setPosition(e.width/2,e.height/2),e.addChild(i)}else e=cleverapps.UI.createScale9Sprite(t.image),t.width&&e.setContentSize2(t);return e.setPosition(e.width/2,e.height/2),e},addLabelText:function(){var e=cleverapps.styles.CurrentEpisodeLabel.label.islandText,t=this.labelText=cleverapps.UI.generateTTFText("messages:StartEpisodeWindow.Title"+this.episode.episodeNo,e.font);t.fitTo(this.bg.width+e.padding),t.setPositionRound(e.alignment),this.label.addChild(t)},addLevelsLabel:function(){var e=cleverapps.styles.CurrentEpisodeLabel.label.levelsText;if(e){var t=this.episode.levels.filter(function(e){
return e.type===Episode.LEVEL_TYPE_PASSED}).length,i=this.episode.levels.length,s=cleverapps.UI.generateTTFText(t+"/"+i,e.font);s.setPositionRound(e.alignment),this.label.addChild(s)}}});cleverapps.MiniGame=function(e){cleverapps.config.debugMode&&(cleverapps.MiniGame.TIMEOUT="60 seconds",cleverapps.MiniGame.AVAILABLE.registered="30 seconds"),cleverapps.DailyChest.call(this,{isNewUser:e,serverTaskName:"bonuses",interval:cleverapps.parseInterval(cleverapps.MiniGame.TIMEOUT)}),this.closedText="messages:MiniGame.ClosedText"},cleverapps.MiniGame.prototype=Object.create(cleverapps.DailyChest.prototype),cleverapps.MiniGame.prototype.constructor=cleverapps.MiniGame,cleverapps.MiniGame.prototype.initializeForNewUser=function(){this.locked=!1,this.setWhenUnlock(Date.now())},cleverapps.MiniGame.TIMEOUT="1 day",cleverapps.MiniGame.prototype.resetUnlockCountdown=function(){cleverapps.DailyChest.prototype.resetUnlockCountdown.call(this),cleverapps.localPushes.sendPush(
cleverapps.LocalPushes.MINI_GAME_CODE,this.when-Date.now())},cleverapps.MiniGame.prototype.refreshItems=function(){},cleverapps.MiniGame.prototype.isAvailable=function(){return!!levels.user.checkAvailable(cleverapps.MiniGame.AVAILABLE)&&!this.locked},cleverapps.MiniGame.prototype.getReward=function(){cleverapps.history.add("drwrd",1);var e=cleverapps.Random.choose(RewardsConfig.MiniGame);return levels.user.isBeginner()&&RewardsConfig.MiniGameBeginner&&(e=cleverapps.Random.choose(RewardsConfig.MiniGameBeginner)),levels.user.isNovice()&&RewardsConfig.MiniGameNovice&&(e=cleverapps.Random.choose(RewardsConfig.MiniGameNovice)),e=cleverapps.user.prepareRewardByRich(e)},cleverapps.MiniGame.prototype.openWindow=function(e){if(cleverapps.periodicBonus.locked)cleverapps.Notification.create(cleverapps.periodicBonus.closedText),e&&e();else{var t=cleverapps.clone(cleverapps.periodicBonus.getReward(),!0);new MiniGameWindow(t),e&&(cleverapps.metha.onceNoWindowsListener=e)}},
cleverapps.MiniGame.AVAILABLE={episode:1,level:1,registered:"1 hour"};var MiniGameWindow=Window.extend({onWindowLoaded:function(e){this.reward=e;var n=cleverapps.styles.MiniGameWindow,o=this.content=new cc.Node;o.setAnchorPoint(.5,.5),o.setContentSize2(n.width,n.height),this.createText(),this.boxes=[],n.boxes.reverse().forEach(function(e,t){var i=new cc.Node;i.setAnchorPoint(.5,.5),i.setContentSize2(n.box),i.setPositionRound(o.width/2+e.x,o.height/2+e.y),i.setScale(n.box.scale),i.baseScale=n.box.scale;var s=i.animation=new cleverapps.Spine(n.animation.json);i.addChild(s),e.skin&&s.setSkin(e.skin),s.setPositionRound(i.width/2-n.box.offsetX,i.height/2-n.box.offsetY),s.setAnimation(0,e.name||"animation",!0),o.addChild(i),this.onMouseOver&&(i.onMouseOver=this.onMouseOver.bind(this,i)),this.onMouseOut&&(i.onMouseOut=this.onMouseOut.bind(this,i)),cleverapps.UI.applyHover(i),cleverapps.UI.onClick(i,this.onPressed.bind(this,i),{noThrottle:n.noThrottle}),this.boxes.push(i)},this)
;var t=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.MiniGameWindow.window,!0);this._super({title:this.getTitle(),name:"minigamewindow",content:o,closeButton:!1,notCloseByTouchInShadow:!0,styles:t,shareCheckBox:this.getShareOptions(),buttons:this.getButtons()}),cleverapps.audio.playSound(res.window_effect)},getTitle:function(){return"messages:MiniGameWindow.Title"},createText:function(){var e=cleverapps.styles.MiniGameWindow,t=cleverapps.UI.generateTTFText("messages:MiniGameWindow.Text",cleverapps.styles.FONTS.WINDOW_TEXT);t.setPositionRound(this.content.width/2+e.text.x,this.content.height/2+e.text.y),this.content.addChild(t),this.text=t},getShareOptions:function(){},onShow:function(){this.showUpAnimation(),this.isOpened||this.setCustomCursor()},onHide:function(){this.boxes&&this.boxes.forEach(function(e){e.stopAllActions()}),this.text&&this.text.stopAllActions(),this.hint&&(this.hint.removeFromParent(),delete this.hint),this.setDefaultCursor()},close:function(
){this.hint&&this.hint.close(),this._super()},onClose:function(){this.setDefaultCursor()},showUpAnimation:function(){var e=this.boxes,i=e.map(function(e){return e.getPosition()}),s=[[2,0,1],[0,2,1],[1,0,2]];this.text.scale=0,e.forEach(function(e,t){e.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.MoveTo(.3,i[s[0][t]]),new cc.DelayTime(.1),new cc.CallFunc(function(){0===t&&cleverapps.audio.playSound(res.daily_game_mix_effect)}),new cc.MoveTo(.3,i[s[1][t]]),new cc.DelayTime(.1),new cc.CallFunc(function(){0===t&&cleverapps.audio.playSound(res.daily_game_mix_effect)}),new cc.MoveTo(.3,i[s[2][t]]),new cc.DelayTime(.1),new cc.CallFunc(function(){0===t&&cleverapps.audio.playSound(res.daily_game_mix_effect)}),new cc.MoveTo(.3,i[t]),new cc.DelayTime(.3),new cc.CallFunc(function(){0===t&&this.text.runAction(new cc.ScaleTo(1,1).easing(cc.easeBackOut()))}.bind(this))))},this)},setDefaultCursor:function(){!cc.sys.isNative&&cleverapps.styles.MiniGameWindow.customCursor&&(
cc._canvas.style.cursor="default",this.onMouseMoveListener&&(cc.eventManager.removeListener(this.onMouseMoveListener),delete this.onMouseMoveListener,this.cursor&&(this.cursor.removeFromParent(!0),delete this.cursor)))},setCustomCursor:function(){!cc.sys.isNative&&cleverapps.styles.MiniGameWindow.customCursor&&"mouse"in cc.sys.capabilities&&(this.onMouseMoveListener=cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:function(e){return this.cursor||(cc._canvas.style.cursor="none",this.cursor=new cc.Sprite(bundles.windows.frames.daily_game_cursor_png),this.cursor.setAnchorPoint2(0,1),this.cursor.setLocalZOrder(10),this.window.addChild(this.cursor)),this.cursor.setPositionRound(this.window.convertToNodeSpace(e.getLocation())),!0}.bind(this)},this.window))},onPressed:function(e){new MiniGameRewardWindow(this.reward),this.close()},getButtons:function(){var e=cleverapps.styles.MiniGameWindow;if(!e.button)return[];var t=this.okButton=new cleverapps.UI.Button({
text:Messages.get("OK"),font:cleverapps.styles.FONTS.BUTTON_TEXT,width:e.button.width,height:e.button.height,onClicked:function(){this.close(),this.receiveReward()}.bind(this)});return t.setVisible(!1),[t]}});MiniGameWindow.prototype.listBundles=function(e){return["reward_icons"]},cleverapps.styles.MiniGameWindow={width:500,height:300,text:{x:0,y:-200},box:{width:150,height:150,scale:1,offsetX:0,offsetY:0},boxes:[{x:-180,y:-50,skin:"green",name:"animation"},{x:0,y:50,skin:"blue",name:"animation"},{x:180,y:-50,skin:"pink",name:"animation"}],animation:{json:bundles.windows.jsons.present_json},window:{decors:{}},noThrottle:!1};var MiniGameRewardWindow=RewardWindow.extend({ctor:function(e){this._super({reward:e})},onWindowLoaded:function(e){this._super({title:"messages:MiniGameRewardWindow.title",name:"minigamerewardwindow",buttonText:"OK",reward:e.reward,text:"messages:MiniGameRewardWindow.text",rewardName:"miniGame"})},onReceiveReward:function(){cleverapps.eventLogger.logEvent(
cleverapps.EVENTS.DAILY_BONUS)},receiveReward:function(){cleverapps.periodicBonus.locked||(cleverapps.periodicBonus.open(),this.onReceiveReward(),cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.RECEIVE_PERIODIC_BONUS),cleverapps.Chest.prototype._receiveReward(this.reward))},getButtons:function(){var e=this.getDoubleButton();return e?[e]:[]}});cleverapps.styles.MiniGameRewardWindow={padding:{x:200,y:0}},cleverapps.UI.Tooltip=cc.Node.extend({ctor:function(e,t){this._super();var i=cleverapps.styles.UI.Tooltip,s=t.size||i.SIZE.medium;if(t.rewards?this.setContentSize2(s.width+i.rewards.extraWidth,s.height+i.rewards.extraHeight):this.setContentSize2(s),this.setAnchorPoint2(),this.bg=new cc.Scale9Sprite(bundles.tooltip.frames.tooltip_bg_png),this.addChild(this.bg),this.bg.setPositionRound(this.width/2,this.height/2),this.bg.setContentSize2(this.getContentSize()),void 0===t.arrow&&(t.arrow=t.position===i.LOCATION.below?i.ARROW.top:i.ARROW.bottom),this.drawArrow(t.arrow),t.content){
this.content=t.content,this.bg.addChild(this.content);var n=Math.min(this.width/(this.content.width*this.content.scaleX+i.content.padding),this.height/(this.content.height*this.content.scaleY+i.content.padding));n<1&&this.content.setScale(this.content.scaleX*n,this.content.scaleY*n),this.content.setPositionRound(this.width/2,this.height/2+i.content.offset.y)}else{var o=cleverapps.UI.generateTTFText(t.text,cleverapps.styles.FONTS.TOOLTIP_TEXT);o.fitTo(this.width-i.content.padding);var a=o;if(t.rewards){var r=new TooltipRewardsView(t.rewards);a=new cleverapps.Layout([r,o],{direction:cleverapps.UI.VERTICAL,margin:i.rewards.margin})}a.setPositionRound(this.width/2,this.height/2+i.content.offset.y),this.bg.addChild(a)}this.show(),this.target=e},hide:function(){this.stopAllActions();var e=.2*this.scale;this.runAction(new cc.Sequence(new cc.ScaleTo(e,0),new cc.CallFunc(function(){this.content&&this.content.removeFromParent()}.bind(this)),new cc.RemoveSelf))},show:function(){
this.stopAllActions(),this.setScale(.2),this.runAction(new cc.Sequence(new cc.CallFunc(function(){this.x-this.width/2<0&&(this.bg.x+=this.width/2-this.x+cleverapps.styles.UI.Tooltip.bgPadding),this.x+this.width/2>cc.director.getRunningScene().width&&(this.bg.x-=this.width/2-cc.director.getRunningScene().width+this.x+cleverapps.styles.UI.Tooltip.bgPadding)}.bind(this)),new cc.ScaleTo(.1,1))),this.runAction(new cc.Sequence(new cc.DelayTime(4),new cc.CallFunc(function(){this.hide()}.bind(this))))},drawArrow:function(e){var t=e===cleverapps.styles.UI.Tooltip.ARROW.bottom?new cc.Scale9Sprite(bundles.tooltip.frames.tooltip_shadow_arrow_png):new cc.Scale9Sprite(bundles.tooltip.frames.tooltip_arrow_png);this.addChild(t),t.setRotation(e.rotation),t.setPositionRound(e)}}),cleverapps.styles.UI.Tooltip={content:{padding:20,offset:{y:-4}},bgPadding:10,rewards:{extraWidth:0,extraHeight:110,margin:10},SIZE:{short:{width:360,height:100},medium:{width:480,height:100},long:{width:600,height:100}},
LOCATION:{above:{x:{align:"center",dx:0},y:{align:"top",dy:60},rewards:{x:{align:"center",dx:0},y:{align:"top",dy:120}}},below:{x:{align:"center",dx:0},y:{align:"bottom",dy:-72},rewards:{x:{align:"center",dx:0},y:{align:"bottom",dy:-142}}}},ARROW:{top:{x:{align:"center",dx:0},y:{align:"top",dy:20},rotation:180},bottom:{x:{align:"center",dx:0},y:{align:"bottom",dy:-16},rotation:0},left:{x:{align:"left",dx:-22},y:{align:"center",dy:0},rotation:90},right:{x:{align:"right",dx:22},y:{align:"center",dy:0},rotation:-90}}};var TooltipManager=function(){this.active=void 0;var e=cc._EventListenerTouchOneByOne.create();if(e.onTouchBegan=function(){this.onClick()}.bind(this),cc.eventManager.addListener(e,-1),"mouse"in cc.sys.capabilities){var t=cc._EventListenerMouse.create();t.onMouseScroll=function(){this.onClick()}.bind(this),cc.eventManager.addListener(t,-1)}};TooltipManager.prototype.create=function(i,s){cleverapps.UI.onClick(i,function(e){if(i.isDisplayed()){if(
cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce(),s.clickableArea){var t=s.clickableArea.convertToNodeSpace(i.convertToWorldSpace(e));cc.rectContainsPoint(cc.rect(0,0,s.clickableArea.width,s.clickableArea.height),t)&&cleverapps.tooltipManager.onClick(i,s)}else cleverapps.tooltipManager.onClick(i,s);s.hideHandler&&s.hideHandler.postponeHiding(4e3)}},{noThrottle:!0})},TooltipManager.prototype.onClick=cleverapps.accumulate(0,function(e,t){if(e||this.active){var i=this.active&&this.active.target,s=e&&i!==e;this.hide(),s&&this.show(e,t||{})}}),TooltipManager.prototype.show=function(e,t){var i=new cleverapps.UI.Tooltip(e,t);e.addChild(i),i.setPositionRound(t.rewards?t.position.rewards:t.position),i.replaceParentSamePlace(cc.director.getRunningScene()),i.registerCleanupCallback(function(){this.active===i&&delete this.active}.bind(this)),this.active=i},TooltipManager.prototype.hide=function(){this.active&&this.active.hide()}
;var TooltipRewardsView=cleverapps.Layout.extend({ctor:function(e){var n=cleverapps.styles.TooltipRewardsView,t=[];for(key in e.boosters)t.push({text:e.boosters[key],icon:n.boosters.icons[key]});e.unlimitedLives&&t.push({text:Product.FormatUnlimitedLives(e.unlimitedLives,!0).title,icon:bundles.reward_icons.frames.life_unlim_small,scale:.95,toReplace:{amount:e.unlimitedLives.amount}}),e.gold&&t.push({text:e.gold,icon:bundles.reward_icons.frames.gold_small_png}),e.exp&&t.push({text:e.exp,icon:bundles.reward_icons.frames.reward_exp_png}),e.stars&&t.push({text:e.stars,icon:bundles.reward_icons.frames.stars_png});var i=t.map(function(e){var t=cleverapps.UI.generateTTFText(e.text,cleverapps.styles.FONTS.TOOLTIP_IMAGE_FONT,e.toReplace);n.textHeight&&t.fitTo(void 0,n.textHeight);var i=new cc.Sprite(e.icon);i.setScale(n.iconHeight/i.height*(e.scale?e.scale:1));var s=new cleverapps.Layout([t,i],{direction:cleverapps.UI.VERTICAL,margin:n.textMargin});return s.setAnchorPoint2(.5,1),s})
;this._super(i,{direction:cleverapps.UI.HORIZONTAL,margin:n.margin,align:n.align})}});cleverapps.styles.TooltipRewardsView={iconHeight:60,margin:30,textMargin:0};var Exclamation=function(){this.onShowListener=function(e){},this.onHideListener=function(){}};Exclamation.prototype.show=function(e,t){this.enabled&&this.onShowListener(e,t)},Exclamation.prototype.setGame=function(e){this.game=e,this.game.onChangeOutcomeListeners.exclamation=this.disable.bind(this),this.enabled=!0},Exclamation.prototype.disable=function(){this.enabled=!1,delete this.game,this.onHideListener()},Exclamation.prototype.createView=function(){return-1!==["heroes","runes"].indexOf(cleverapps.config.name)?new EXCLAMATIONS.heroes:-1!==["board","solitaire","differences"].indexOf(cleverapps.config.type)?new EXCLAMATIONS.words:-1!==["adventure"].indexOf(cleverapps.config.name)?new EXCLAMATIONS.actor:new EXCLAMATIONS.base},Exclamation.prototype.getCongratulations=function(){return-1!==["heroes","runes"].indexOf(
cleverapps.config.name)?["wow","super","yay","yeah","ohyeah","oh"]:Messages.get("congratulations")};var EXCLAMATIONS={base:cc.Node.extend({ctor:function(){this._super();var e=this.getStyles();this.setAnchorPoint2(),this.setContentSize2(e),e.scale&&this.setScale(e.scale[cleverapps.wideMode.mode]),cleverapps.exclamation.onShowListener=this.createListener(cleverapps.throttle(1e3,this.showMessage.bind(this))),cleverapps.exclamation.onHideListener=this.createListener(this.hideMessage.bind(this))},showMessage:function(e,t){var i=bundles.game.urls.keep_going_effect,s="keep_going_letsgo",n=cleverapps.styles.FONTS.MESSAGE_TEXT_NORMAL;switch(t){case FieldView.MESSAGE_WARNING:s="5_moves_left",i=bundles.game.urls.five_moves_effect,n=cleverapps.styles.FONTS.MESSAGE_TEXT_WARNING;break;case FieldView.MESSAGE_CONGRATS:s="you_win",i=bundles.main.urls.beat_friend_effect,n=cleverapps.styles.FONTS.MESSAGE_TEXT_CONGRATS}this.runActions(e,n,i,s)},hideMessage:function(){this.setVisible(!1)},
runActions:function(e,t,i,s){this.createAnimation(s),this.createMsg(e,t),this.playSound(i)},playSound:function(e){if(e){var t=this.getStyles().sound?this.getStyles().sound.delay:0;this.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.CallFunc(function(){cleverapps.audio.playSound(e)})))}},createMsg:function(e,t){var i=this.createText(e,t);i.opacity=0,i.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.FadeIn(.2),new cc.Spawn(new cc.MoveBy(.1,0,-2),new cc.ScaleTo(.1,1,.9)),new cc.ScaleTo(.25,1,1),new cc.DelayTime(.3),new cc.FadeOut(.2),new cc.RemoveSelf))},createText:function(e,t){var i=cleverapps.UI.LabelTTF.prototype.getLocalizedText.call(null,e),s=cleverapps.UI.generateTTFText(e,t);return-1!==i.indexOf(" ")?s.setDimensions(this.width,0):s.fitTo(this.width),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setPositionRound(this.width/2,this.height/2),this.addChild(s),s},createAnimation:function(e){this.animation||(this.animation=new cleverapps.Spine(
bundles.exclamations.jsons.animation),this.animation.setPositionRound(this.width/2,this.height/2),this.addChild(this.animation)),this.animation.setAnimation(0,e,!1)},getStyles:function(){return cleverapps.styles.Exclamations.base}})};EXCLAMATIONS.heroes=EXCLAMATIONS.base.extend({getStyles:function(){return cleverapps.styles.Exclamations.heroes},showMessage:function(e,t){var i=this.getStyles(),s="messages:message.YouWin"===e?res.sound_win_effect:bundles.game.urls.keep_going_effect,n=cleverapps.styles.FONTS.CONGRATS_MESSAGE_FONT,o=i[e];o?n.color=o.color:t===FieldView.MESSAGE_WARNING?n.color=i.warning.color:n.color=i.default.color;var a="lets_go";-1!==cleverapps.exclamation.getCongratulations().indexOf(e)?(s=bundles.game.urls[e+"_effect"],e="messages:message."+(a=e)):"messages:message.KeepGoing"===e?s=bundles.game.urls.go_on_effect:"messages:message.Shuffle"===e&&(a="shuffle",s=bundles.game.urls.shuffle_effect),this.runActions(e,n,s,a)},createMsg:function(e,t){var i=this.createText(e,t)
;i.setRotation(10);i.setScale(.1),i.setVisible(!1),i.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.Show,new cc.ScaleTo(.3,1).easing(cc.easeInOut(3)),new cc.DelayTime(.55),new cc.ScaleTo(.3,.1),new cc.RemoveSelf))}}),EXCLAMATIONS.words=EXCLAMATIONS.base.extend({getStyles:function(){return cleverapps.styles.Exclamations.base},showMessage:function(e){this.runActions(e,void 0,void 0,"animation")},createMsg:function(e){e=Messages.getLocalized(e);var t=this.splitTextToLines(e).map(this.createLine.bind(this)),i=new cleverapps.Layout(t.reverse(),{direction:cleverapps.UI.VERTICAL,margin:t.length&&t[0].height/10||0});i.setCascadeOpacityEnabled(!0),i.setOpacity(0),i.setScale(0),i.setPositionRound(this.width/2,this.height/2),this.addChild(i);var s=1,n=cc.director.getRunningScene();i.width>n.scene.width&&(s=n.scene.width/(1.2*i.width)),this.setVisible(!0),this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(1.4),new cc.Hide)),i.runAction(new cc.Spawn(new cc.FadeIn(.25),
new cc.Sequence(new cc.ScaleTo(.2,1.4*s,1.4*s),new cc.ScaleTo(.2,.8*s,.8*s),new cc.ScaleTo(1,s,s)),new cc.Sequence(new cc.DelayTime(1.2),new cc.FadeOut(.2),new cc.RemoveSelf)))},createLine:function(e){var t=new cc.Node;t.setAnchorPoint(.5,.5);for(var i=0,s=0,n=this.splitLineToBlocks(e),o=0;o<n.length;o++){var a=cleverapps.UI.generateTTFText(n[o],cleverapps.styles.FONTS.CONGRATE_TEXT);t.addChild(a);var r=Math.abs(o-n.length/2),l=1-.2/n.length*r,c=.2+.6/n.length*r;a.setPosition(i+a.width*l/2,a.height/2),i+=a.width*l,s=Math.max(s,a.height),a.setScale(0),a.runAction(new cc.Sequence(new cc.ScaleTo(c,1.36),new cc.ScaleTo(.13,l)))}return t.setContentSize(i,s),t.setCascadeOpacityEnabled(!0),t},splitTextToLines:function(e){if(!e)return[];var t=e.indexOf(" ");if(e.length<=16||-1===t)return[e];var i=e.substr(0,16).lastIndexOf(" ");-1===i&&(i=t);var s=[e.substr(0,i)];return s=s.concat(e.substr(i+1).trim())},splitLineToBlocks:function(e){var t=e.split("");return t.length<=6?t:t.slice(0,3).concat([
t.slice(3,t.length-3).join("")]).concat(t.slice(t.length-3,t.length))}}),EXCLAMATIONS.actor=EXCLAMATIONS.words.extend({getStyles:function(){return cleverapps.styles.Exclamations.actor},showMessage:function(e){var t=bundles.exclamations.urls.exclamation_alert_effect;if(-1!==cleverapps.exclamation.getCongratulations().indexOf(e)){var i=cleverapps.Random.mathChoose(this.getStyles().actorActions);t=i.sound,cc.director.getRunningScene().actor.animate(i.animation,{noSFX:!0})}else"messages:message.YouWin"===e?t=bundles.exclamations.urls.exclamation_win_effect:"messages:message.Shuffle"===e&&(t=bundles.exclamations.urls.exclamation_shuffle_effect);this.runActions(e,void 0,t,"animation")}}),cleverapps.overrideColors(cleverapps.styles.COLORS,{CONGRATS_RED:new cc.Color(255,35,60,255),CONGRATS_LIGHT_GREEN:new cc.Color(182,248,68,255),CONGRATS_BLUE:new cc.Color(0,177,249,255),CONGRATS_ORANGE:new cc.Color(233,117,38,255),CONGRATS_PURPLE:new cc.Color(194,11,227,255),CONGRATS_GREEN:new cc.Color(0,209,
121,255),CONGRATS_DARK_RED:new cc.Color(241,15,51,255)}),cleverapps.styles.Exclamations={base:{width:600,height:200}},cleverapps.styles.Exclamations.heroes=cleverapps.overrideStyles(cleverapps.styles.Exclamations.base,{width:760,scale:[.8,1,1],sound:{delay:.6},default:{color:cleverapps.styles.COLORS.CONGRATS_BLUE},warning:{color:cleverapps.styles.COLORS.CONGRATS_DARK_RED},yeah:{color:cleverapps.styles.COLORS.CONGRATS_RED},super:{color:cleverapps.styles.COLORS.CONGRATS_LIGHT_GREEN},yay:{color:cleverapps.styles.COLORS.CONGRATS_BLUE},lets_go:{color:cleverapps.styles.COLORS.CONGRATS_ORANGE},ohyeah:{color:cleverapps.styles.COLORS.CONGRATS_PURPLE},oh:{color:cleverapps.styles.COLORS.CONGRATS_GREEN},wow:{color:cleverapps.styles.COLORS.CONGRATS_DARK_RED}},!0),cleverapps.styles.Exclamations.actor=cleverapps.overrideStyles(cleverapps.styles.Exclamations.base,{actorActions:[{animation:Actor.ANIMATIONS.ATTACK1,sound:bundles.game.urls.sc_welldone},{animation:Actor.ANIMATIONS.ATTACK2,
sound:bundles.game.urls.sc_welldone2},{animation:Actor.ANIMATIONS.ATTACK3,sound:bundles.game.urls.sc_welldone3}]},!0);var ComboBarView=cc.Node.extend({ctor:function(e){this._super(),this.combo=e;var t=cleverapps.styles.ComboBarView;this.setPositionRound(t.positions[cleverapps.wideMode.mode]),this.setContentSize(t),this.setAnchorPoint2(),this.setScale(t.scale[cleverapps.wideMode.mode]),this.initSlots(),this.progressPoints=new Array(cleverapps.Combo.COMBO_LEVEL_WITH_PRIZE),cleverapps.UI.makeHideable(this,cleverapps.UI.HORIZONTAL),cleverapps.metha.registerControl("comboBar",this),cleverapps.tooltipManager.create(this,{text:Messages.get("StreakTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.below,size:cleverapps.styles.UI.Tooltip.SIZE.long})},initSlots:function(){var e=cleverapps.styles.ComboBarView,t=new cc.Node;t.setPositionRound(e.row),this.progressSlots=[];for(var i=0;i<cleverapps.Combo.COMBO_LEVEL_WITH_PRIZE;i++){var s=new cc.Sprite(
0===i?bundles.game.frames.combo_notch1:bundles.game.frames.combo_notch2);s.setPosition(i*e.slot.offset,0),t.addChild(s),this.progressSlots.push(s)}var n=cleverapps.UI.createSprite(bundles.game.frames.combo_back_png);n.setPosition(this.width/2,this.height/2),n.setContentSize(e),n.setLocalZOrder(-1),n.addChild(t),this.addChild(n),this.goalSlot=new cc.Node,this.goalSlot.setPosition(this.width+e.goal.offsetX,e.goal.offsetY),this.updateGoal(),this.addChild(this.goalSlot)},onChangeLevel:function(e){e&&(this.progressPoints[this.combo.level-1]=e),this.progressSlots.forEach(function(e,t){e.innerView&&t>=this.combo.level&&(e.innerView.runAction(new cc.Sequence(new cc.ScaleTo(.1,0),new cc.RemoveSelf)),e.innerView=void 0),void 0===e.innerView&&t<this.combo.level&&this.drawProgressPoint(e,t)}.bind(this))},drawProgressPoint:function(e,t){var i=cleverapps.styles.ComboBarView.progressImages[this.progressPoints[t]];e.innerView=cleverapps.UI.createSprite(
0===t?bundles.game.frames.combo_point1:bundles.game.frames.combo_point2);var s=cleverapps.UI.createSprite(i);s.setPosition(e.innerView.width/2,e.innerView.height/2),e.innerView.addChild(s),e.innerView.setPosition(e.width/2,e.height/2),e.innerView.setScale(0),e.addChild(e.innerView),e.innerView.runAction(new cc.ScaleTo(.2,1)),s.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.ScaleTo(.2,1.4).easing(cc.easeBackOut()),new cc.ScaleTo(.1,1)));var n=new cleverapps.Spine(bundles.game.jsons.combo_light_json);n.setAnimation(0,"animation",!1),n.setPositionRound(this.goalView.width/2,this.goalView.height/2),n.setCompleteListenerRemove(),this.goalView.addChild(n),this.goalView.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.2),new cc.ScaleTo(.1,.9),new cc.ScaleTo(.1,1.1),new cc.ScaleTo(.1,1)))},updateGoal:function(){switch(this.goalView&&(this.goalView.removeFromParent(),this.goalView=void 0),this.combo.currentGoal){case 0:var e=cleverapps.cardSkins.getSelectedSkin().combo;break;case 1:
e=cleverapps.cardSkins.getSelectedSkin().combo2;break;default:e=bundles.game.frames.combo_goal_png}this.goalView=cleverapps.UI.createSprite(e),this.goalSlot.addChild(this.goalView),this.goalView.setScale(0),this.goalView.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.ScaleTo(.3,1)))},reward:function(e,t){var i=cleverapps.styles.ComboBarView.bonus,s=CardView.GetView(e);this.goalView&&(this.goalView.visible=!1),this.addChild(s),s.setPosition(this.width+i.offsetX,i.offsetY),s.setScale(i.scale),s.setRotation(i.rotation),s.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.3,1).easing(cc.easeInOut(3)),new cc.RotateTo(.3,0)),new cc.CallFunc(function(){t(),cleverapps.audio.playSound(bundles.game.urls.collected_effect)})))}});cleverapps.styles.ComboBarView={width:308,height:98,scale:[1,.9,1],positions:[{x:{align:"right",dx:-20},y:{align:"top",dy:-124}},{x:{align:"right",dx:-20},y:{align:"top",dy:-134}},{x:{align:"right",dx:-20},y:{align:"top",dy:-134}}],goal:{offsetX:-46,offsetY:50
},row:{x:{align:"left",dx:40},y:{align:"center"}},slot:{offset:50},bonus:{offsetX:-46,offsetY:40,rotation:18,scale:.42}};var ComboView=cc.Node.extend({ctor:function(e,t){this._super(),this.combo=e,this.setAnchorPoint2(),"solitaire"===cleverapps.config.type?(this.comboBarView=new ComboBarView(this.combo),t.addChild(this.comboBarView),this.combo.on("updateGoal",function(){this.comboBarView.updateGoal()}.bind(this))):(this.border=new cleverapps.Spine(bundles.combo_background.jsons.combo_background_json),this.border.setCascadeOpacityEnabled(!0),this.addChild(this.border),this.particles=new cleverapps.Spine(bundles.combo_background.jsons.combo_background_particles_json),this.addChild(this.particles)),this.updateSize=cleverapps.accumulate(10,this.updateSize.bind(this)),this.updateSize(),this.onChangeLevel(),this.combo.on("changeSize",this.updateSize.bind(this)),this.combo.on("changeLevel",this.onChangeLevel.bind(this)),this.combo.on("stopAlarm",this.stopAlarm.bind(this)),this.combo.on(
"runAlarm",this.runAlarm.bind(this)),this.combo.on("reward",this.reward.bind(this)),this.combo.on("runLater",this.runLater.bind(this))},runLater:function(e,t){this.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.CallFunc(t)))},updateSize:function(){var e=cleverapps.UI.getSceneSize();this.setContentSize(e.width,e.height+2*cleverapps.UI.getSceneOffsetY());var t=this.parent;this.setPositionRound(t.width/2,t.height/2),this.border&&(this.border.setScaleX(this.width/this.border.width/t.scale),this.border.setScaleY(this.height/this.border.height/t.scale),this.border.setPositionRound(this.width/2,this.height/2),this.particles.setPositionRound(this.width/2,this.height/2))},stopAlarm:function(){this.border&&(this.border.stopAllActions(),this.border.runAction(new cc.FadeTo(.3,255)))},reward:function(e,t){this.comboBarView&&this.comboBarView.reward(e,t)},runAlarm:function(){this.border&&(this.border.stopAllActions(),this.border.runAction(new cc.RepeatForever(new cc.Sequence(new cc.FadeTo(.5,
170),new cc.FadeTo(.5,255)))))},onChangeLevel:function(e){if(this.border)if(this.combo.level<=1)this.border.visible=!1,this.particles.visible=!1;else{this.border.visible=!0,this.particles.visible=!0;var t=Math.min(this.combo.level,cleverapps.Combo.COMBO_LEVEL_WITH_PRIZE)-1;this.border.setAnimation(0,"c"+t,!1),this.border.addAnimation(0,"c"+t+"_idle",!0),this.particles.setAnimation(0,"c"+t,!1),this.particles.addAnimation(0,"c"+t+"_idle",!0)}this.comboBarView&&this.comboBarView.onChangeLevel(e)}}),SceneDecors={add:function(e,t){if(t)return this.createDecors(e,t)},createDecors:function(i,e){return e.map(function(e){var t;return e.json?(t=new cleverapps.Spine(e.json)).setAnimation(0,e.animation,!0):t=new cc.Sprite(e.image),i.addChild(t),e.scale&&(t.scale.x&&t.setScale(e.scale.x,e.scale.y),t.setScale(e.scale)),void 0!==e.zOrder&&t.setLocalZOrder(e.zOrder),t.setPositionRound(e),t})}};cleverapps.styles.SceneDecors={},cleverapps.SkinManager=function(){this.active=void 0,
this.defaultSlots=cleverapps.SkinManager.SKINS.default.slots},cleverapps.SkinManager.prototype.getSlot=function(e,t){if(this.active&&this.active.slots[e]){var i=this.active.slots[e](t);if(void 0!==i)return i}return this.defaultSlots[e]&&this.defaultSlots[e](t)},cleverapps.SkinManager.prototype.update=function(){this.active=void 0,cleverapps.eventManager&&cleverapps.eventManager.listCurrentFeatures().forEach(function(e){cleverapps.SkinManager.SKINS[e]&&(this.active=cleverapps.SkinManager.SKINS[e])},this)},cleverapps.SkinManager.prototype.getBundle=function(){if(this.active)return this.active.bundle},cleverapps.SkinManager.SKINS={default:{localization:{},slots:{windowDecors:function(e){return e.decors},windowBg:function(e){return e.image},spine:function(e){return e.json},menuBarItem:function(e){},sceneControlButton:function(e){},episodeView:function(e){},episodeViewTitle:function(e){},iconBg:function(e){return e.image},gameAudio:function(){},sceneBg:function(){},gameSceneBg:function(){},
missionIcon:function(e){return cleverapps.environment.isGameScene()&&Missions[e.type].gameIcon?Missions[e.type].gameIcon:Missions[e.type].icon},missionSidebarJson:function(e){return Missions[e.type].sideBarJson},missionStar:function(e){return res["mission_star"+e.type+"_png"]},missionWindowTitleIcon:function(e){return e.icon},tulpanScale:function(){return cleverapps.styles.TulpanCellView.scale},removeMissions:function(){},toolbarDecors:function(){return[]},localization:function(){return cleverapps.SkinManager.SKINS.default.localization},windowTitle:function(e){return e.image},battlePassTaskIcon:function(e){},missionMarkIcon:function(e){return cleverapps.environment.isGameScene()&&Missions[e.type].gameIcon?Missions[e.type].gameIcon:Missions[e.type].icon},wardrobeWindowBanner:function(){return bundles.wardrobe_window.frames.window_bg},cardMarkSpine:function(e){return e.json}}}},cleverapps.SkinManager.SKINS.xmas={bundle:"xmas",localization:{tripeaks:{
"Missions.LetterTournament.Title":"Xmas.Missions.LetterTournament.Title","MissionRulesWindow.LetterTournament.text2":"Xmas.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Xmas.MissionRulesWindow.LetterTournament.text3","AddMovesWindow.missionGiveUp.LetterTournament":"Xmas.AddMovesWindow.missionGiveUp.LetterTournament","AddMovesWindow.mission.LetterTournament":"Xmas.AddMovesWindow.mission.LetterTournament",CloversTooltip:"Xmas.CloversTooltip"},wordsoup:{"Missions.LetterTournament.Title":"Xmas.Missions.LetterTournament.Title","MissionRulesWindow.LetterTournament.text2":"Xmas.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Xmas.MissionRulesWindow.LetterTournament.text3","WardrobeDialogue.stage0.text0":"Xmas.WardrobeDialogue.stage0.text0","WardrobeDialogue.stage1.text0":"Xmas.WardrobeDialogue.stage1.text0","WardrobeDialogue.stage2.text0":"Xmas.WardrobeDialogue.stage2.text0",
"WardrobeDialogue.stage3.text0":"Xmas.WardrobeDialogue.stage3.text0","WardrobeDialogue.stage4.text0":"Xmas.WardrobeDialogue.stage4.text0","WardrobeDialogue.stage5.text0":"Xmas.WardrobeDialogue.stage5.text0","WardrobeDialogue.stage6.text0":"Xmas.WardrobeDialogue.stage6.text0","WardrobeDialogue.stage7.text0":"Xmas.WardrobeDialogue.stage7.text0","WardrobeDialogue.stage8.text0":"Xmas.WardrobeDialogue.stage8.text0","WardrobeDialogue.stage9.text0":"Xmas.WardrobeDialogue.stage9.text0","WardrobeDialogue.stage10.text0":"Xmas.WardrobeDialogue.stage10.text0","WardrobeDialogue.stage11.text0":"Xmas.WardrobeDialogue.stage11.text0",WardrobeDescText:"Xmas.WardrobeDescText",WardrobeRulesText:"Xmas.WardrobeRulesText",WardrobePrizeRewardTitle:"Xmas.WardrobePrizeRewardTitle","Missions.LetterTournament.Rules1":"Xmas.Missions.LetterTournament.Rules1"},scramble:{"Missions.LetterTournament.Title":"Xmas.Missions.LetterTournament.Title",
"MissionRulesWindow.LetterTournament.text2":"Xmas.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Xmas.MissionRulesWindow.LetterTournament.text3"}},slots:{windowDecors:function(e){var t=e.decors&&cleverapps.clone(e.decors,!0)||{};return t.leaves_left=!1,t.leaves_right=!1,t.xmas_window_1=!0,t.xmas_window_2=!0,"crocword"===cleverapps.config.name&&(e.window instanceof VictoryWindow||(t.xmas_decor_horizontal=!0),t.xmas_decor_right_top=!0,t.xmas_decor_left_top=!0,t.xmas_decor_vertical_right=!0,t.xmas_decor_vertical_left=!0),-1!==["scramble"].indexOf(cleverapps.config.name)&&("victorywindow"!==e.window.name&&(t.xmas_decor_left_top=!0,t.xmas_decor_right_top=!0),"leaderswindow"!==e.window.name&&(t.xmas_decor_bottom=!0)),-1!==["tripeaks"].indexOf(cleverapps.config.name)&&(t.xmas_decor_left_top=!0,t.xmas_decor_center_top=!0,t.xmas_decor_right_top=!0,"leaderswindow"!==e.window.name&&(t.xmas_decor_bottom=!0)),
"riddles"===cleverapps.config.name&&e.level&&e.level.isHard()&&(t.xmas_window_1=!1,t.xmas_window_2=!1),t},windowBg:function(e){return"riddles"===cleverapps.config.name&&e.level&&e.level.isHard()?e.image:bundles.xmas.frames.window_bg_png?bundles.xmas.frames.window_bg_png:void 0},hero:function(e){if(bundles.xmas.jsons[e.color+"_hero_spine_json"])return bundles.xmas.jsons[e.color+"_hero_spine_json"]},spine:function(e){var t={};return-1!==["heroes","riddles"].indexOf(cleverapps.config.name)&&(t[bundles.heroes.jsons.A_hero_spine_json]=bundles.xmas.jsons.A_hero_spine_json,t[bundles.heroes.jsons.B_hero_spine_json]=bundles.xmas.jsons.B_hero_spine_json,t[bundles.heroes.jsons.C_hero_spine_json]=bundles.xmas.jsons.C_hero_spine_json,t[bundles.heroes.jsons.D_hero_spine_json]=bundles.xmas.jsons.D_hero_spine_json,t[bundles.heroes.jsons.E_hero_spine_json]=bundles.xmas.jsons.E_hero_spine_json,t[bundles.heroes.jsons.W_hero_spine_json]=bundles.xmas.jsons.W_hero_spine_json),
"board"===cleverapps.config.type&&(t[bundles.main.jsons.hero_json]=bundles.xmas.jsons.hero_json,t[bundles.game.jsons.hero_json]=bundles.xmas.jsons.hero_json),-1!==["tripeaks"].indexOf(cleverapps.config.name)&&(t[bundles.letter_tournament.jsons.mission_window_json]=bundles.xmas.jsons.xmas_mission_window_json),-1!==["scramble"].indexOf(cleverapps.config.name)&&(t[bundles.letter_tournament.jsons.mission_window_json]=bundles.xmas.jsons.mission_window_json,cleverapps.styles.MissionWindow.heroTitleAnimation=cleverapps.styles.xmasNewStyles.heroTitleAnimation),t[e.json]?t[e.json]:e.json},menuBarItem:function(e){return-1!==["crocword","scramble","tripeaks"].indexOf(cleverapps.config.name)?cleverapps.styles.SceneDecors.menuBarItemXmas:"undefined"!=typeof LivesView&&e.target instanceof LivesView?cleverapps.styles.SceneDecors.livesViewXmas:cleverapps.styles.SceneDecors.menuBarItemXmas},sceneControlButton:function(e){return cleverapps.styles.SceneDecors.sceneControlButtonXmas},
progressViewDecor:function(e){return cleverapps.styles.SceneDecors.progressViewDecor},episodeView:function(e){return cleverapps.styles.SceneDecors.episodeViewXmas},iconBg:function(e){if(bundles.xmas.frames.icon_bg_png)return bundles.xmas.frames.icon_bg_png},gameAudio:function(){if("wordsoup"===cleverapps.config.name)return bundles.xmas.urls.background_music_game},sceneBg:function(){if("wordsoup"===cleverapps.config.name)return{pattern:bundles.xmas.urls.pattern_bg_main_png}},gameSceneBg:function(e){if("wordsoup"===cleverapps.config.name)return{pattern:bundles.xmas.urls.pattern_bg_main_png}},missionIcon:function(e){if(-1!==["wordsoup","tripeaks","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.xmas.frames.mission_letter_png},missionSidebarJson:function(e){if(-1!==["wordsoup","tripeaks","scramble"].indexOf(cleverapps.config.name))switch(e.type){case Mission.TYPE_LETTER:return-1!==["scramble"].indexOf(cleverapps.config.name
)?bundles.xmas.jsons.mission_icon_json:bundles.sidebar.jsons.xmas_letter_json;case Mission.TYPE_WARDROBE:return bundles.xmas.jsons.wardrobe_sidebar_icon_json}},missionStar:function(e){return-1!==["wordsoup","scramble"].indexOf(cleverapps.config.name)?bundles.xmas.frames["mission_star"+e.type+"_png"]:-1!==["tripeaks"].indexOf(cleverapps.config.name)?bundles.xmas.frames.mission_letter_png:void 0},missionRulesWindow:function(e){if(-1!==["wordsoup","tripeaks","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.xmas.jsons.letter_rules_json},wardrobeWindowBanner:function(){return bundles.xmas.frames.window_banner},cardMarkSpine:function(e){return-1!==["tripeaks"].indexOf(cleverapps.config.name)&&"mission"===e.type?bundles.xmas.jsons.xmas_marks_json:e.json},localization:function(){if(cleverapps.SkinManager.SKINS.xmas.localization[cleverapps.config.name])return cleverapps.SkinManager.SKINS.xmas.localization[cleverapps.config.name]}}},
cleverapps.SkinManager.SKINS.valentines={bundle:"valentines",localization:{heroes:{"Missions.TulpanTournament.Title":"Valentine.Missions.TulpanTournament.Title","Missions.TulpanTournament.Rules1":"Valentine.Missions.TulpanTournament.Rules1","Missions.TulpanTournament.AnimationMainTextWin":"Valentine.Missions.TulpanTournament.AnimationMainTextWin","Missions.TulpanTournament.AnimationMainTextLose":"Valentine.Missions.TulpanTournament.AnimationMainTextLose","Missions.TulpanTournament.AnimationMainTextInfo0":"Valentine.Missions.TulpanTournament.AnimationMainTextInfo0","Missions.TulpanTournament.AnimationMainTextInfo1":"Valentine.Missions.TulpanTournament.AnimationMainTextInfo1"},riddles:{"Missions.TulpanTournament.Title":"Valentine.Missions.TulpanTournament.Title","Missions.TulpanTournament.Rules1":"Valentine.Missions.TulpanTournament.Rules1","Missions.TulpanTournament.AnimationMainTextWin":"Valentine.Missions.TulpanTournament.AnimationMainTextWin",
"Missions.TulpanTournament.AnimationMainTextLose":"Valentine.Missions.TulpanTournament.AnimationMainTextLose","Missions.TulpanTournament.AnimationMainTextInfo0":"Valentine.Missions.TulpanTournament.AnimationMainTextInfo0","Missions.TulpanTournament.AnimationMainTextInfo1":"Valentine.Missions.TulpanTournament.AnimationMainTextInfo1","AddMovesWindow.mission.TulpanTournament":"Valentine.AddMovesWindow.mission.TulpanTournament","AddMovesWindow.missionGiveUp.TulpanTournament":"Valentine.AddMovesWindow.missionGiveUp.TulpanTournament"},wordsoup:{"Missions.LetterTournament.Title":"Valentine.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Valentine.Missions.LetterTournament.Rules1","MissionRulesWindow.LetterTournament.text2":"Valentine.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Valentine.MissionRulesWindow.LetterTournament.text3"},crocword:{"Missions.LetterTournament.Title":"Valentine.Missions.LetterTournament.Title",
"Missions.LetterTournament.Rules1":"Valentine.Missions.LetterTournament.Rules1","MissionRulesWindow.LetterTournament.text2":"Valentine.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Valentine.MissionRulesWindow.LetterTournament.text3"}},slots:{removeMissions:function(){if("riddles"===cleverapps.config.name||"heroes"===cleverapps.config.name)return[Mission.TYPE_COLLECT_MARK,Mission.TYPE_COMBO]},menuBarItem:function(e){if(-1!==["crocword","wordsoup","riddles","heroes"].indexOf(cleverapps.config.name))return cleverapps.styles.SceneDecors.menuBarItemValentines},sceneControlButton:function(e){if(-1!==["crocword","wordsoup","riddles"].indexOf(cleverapps.config.name))return cleverapps.styles.SceneDecors.sceneControlButtonValentines},episodeView:function(e){if(-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name))return cleverapps.styles.SceneDecors.episodeViewValentines},episodeViewTitle:function(e){if(-1!==["wordsoup"].indexOf(
cleverapps.config.name))return cleverapps.styles.SceneDecors.episodeViewTitleValentines},iconBg:function(e){if(-1!==["crocword","heroes","riddles"].indexOf(cleverapps.config.name))return bundles.valentines.frames.valentines_icon_bg_png},toolbarDecors:function(e){if(-1!==["crocword","wordsoup","heroes","riddles"].indexOf(cleverapps.config.name))return cleverapps.styles.SceneDecors.toolbarViewValentines},windowDecors:function(e){if(-1!==["wordsoup","crocword","heroes","riddles"].indexOf(cleverapps.config.name)){var t=e.decors&&cleverapps.clone(e.decors,!0)||{};return e.window instanceof LeadersWindow||(t.valentines_decor_right=!0,t.valentines_decor_right2=!0),t.valentines_decor_left=!0,t.valentines_decor_left2=!0,-1!==["heroes","wordsoup","riddles","crocword"].indexOf(cleverapps.config.name)&&(t.valentines_decor_hearts=!0,t.valentines_decor_top_1=!0,t.valentines_decor_top_2=!0,t.valentines_decor_top_3=!0,t.valentines_decor_heart_top_1=!0,t.valentines_decor_heart_top_2=!0,
t.valentines_decor_heart_top_3=!0,t.valentines_decor_heart_top_4=!0,t.gears_animation=!1,t.gears=!1,t.star=!1,t.present=!1,t.leaves_left=!1,t.leaves_right=!1),t}return e.decors},missionIcon:function(e){return-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER?bundles.valentines.frames.mission_icon_png:-1!==["riddles","heroes"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_BURN_NEARBY?bundles.valentines.frames.mission_icon_png:void 0},missionSidebarJson:function(e){if(-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.sidebar.jsons.valentine_letter_json},missionStar:function(e){if(-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name))return bundles.valentines.frames["mission_star"+e.type+"_png"]},missionRulesWindow:function(e){if(-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.valentines.jsons.letter_rules_json},
spine:function(e){var t={};return-1!==["heroes","riddles"].indexOf(cleverapps.config.name)&&(t[bundles.tulpan_tournament.jsons.json]=bundles.valentines.jsons.json,t[bundles.main.jsons.tournament_tulpan_icon_json]=bundles.valentines.jsons.icon_json),"board"===cleverapps.config.type&&(t[bundles.main.jsons.hero_json]=bundles.valentines.jsons.hero_json),t[e.json]?t[e.json]:e.json},localization:function(){if(cleverapps.SkinManager.SKINS.valentines.localization[cleverapps.config.name])return cleverapps.SkinManager.SKINS.valentines.localization[cleverapps.config.name]},gameSceneBg:function(e){if("wordsoup"===cleverapps.config.name)return{pattern:bundles.valentines.urls.valentines_pattern_bg_png}},gameAudio:function(){},windowTitle:function(e){if("heroes"===cleverapps.config.name)return bundles.valentines.frames.valentines_window_title_bg_png},battlePassTaskIcon:function(e){if(e.taskType===Mission.EVENT_COLLECT_CLOVER&&-1!==["riddles","heroes"].indexOf(cleverapps.config.name)
)return bundles.valentines.frames.mission_icon_png}}},cleverapps.SkinManager.SKINS.easter={bundle:"easter",localization:{heroes:{"Missions.TulpanTournament.Title":"Easter.Missions.TulpanTournament.Title","Missions.TulpanTournament.Rules1":"Easter.Missions.TulpanTournament.Rules1","Missions.TulpanTournament.AnimationMainTextWin":"Easter.Missions.TulpanTournament.AnimationMainTextWin","Missions.TulpanTournament.AnimationMainTextLose":"Easter.Missions.TulpanTournament.AnimationMainTextLose","Missions.TulpanTournament.AnimationMainTextInfo0":"Easter.Missions.TulpanTournament.AnimationMainTextInfo0","Missions.TulpanTournament.AnimationMainTextInfo1":"Easter.Missions.TulpanTournament.AnimationMainTextInfo1","AddMovesWindow.mission.TulpanTournament":"Easter.AddMovesWindow.mission.TulpanTournament","AddMovesWindow.missionGiveUp.TulpanTournament":"Easter.AddMovesWindow.missionGiveUp.TulpanTournament"},riddles:{"Missions.RoseTournament.Title":"Easter.Missions.RoseTournament.Title",
"Missions.RoseTournament.Rules1":"Easter.Missions.RoseTournament.Rules1","Missions.RoseTournament.AnimationMainTextWin":"Easter.Missions.RoseTournament.AnimationMainTextWin","Missions.RoseTournament.AnimationMainTextLose":"Easter.Missions.RoseTournament.AnimationMainTextLose","Missions.RoseTournament.AnimationMainTextInfo0":"Easter.Missions.RoseTournament.AnimationMainTextInfo0","Missions.RoseTournament.AnimationMainTextInfo1":"Easter.Missions.RoseTournament.AnimationMainTextInfo1","AddMovesWindow.mission.TulpanTournament":"Easter.AddMovesWindow.mission.RoseTournament","AddMovesWindow.missionGiveUp.RoseTournament":"Easter.AddMovesWindow.missionGiveUp.RoseTournament","AddMovesWindow.mission.RoseTournament":"Easter.AddMovesWindow.mission.RoseTournament"},wordsoup:{"Missions.LetterTournament.Title":"Easter.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Easter.Missions.LetterTournament.Rules1",
"MissionRulesWindow.LetterTournament.text2":"Easter.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Easter.MissionRulesWindow.LetterTournament.text3"},crocword:{"Missions.LetterTournament.Title":"Easter.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Easter.Missions.LetterTournament.Rules1","MissionRulesWindow.LetterTournament.text2":"Easter.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Easter.MissionRulesWindow.LetterTournament.text3"}},slots:{windowDecors:function(e){var t=e.decors&&cleverapps.clone(e.decors,!0)||{};return"wordsoup"===cleverapps.config.name&&(e.window instanceof LeadersWindow||(t.window_bottom_right_corner_2=!0,t.window_bottom_right_corner_1=!0,t.window_bottom_left_corner_2=!0,t.window_bottom_left_corner_1=!0)),"riddles"===cleverapps.config.name&&(t.window_bottom_right=!0,t.window_bottom_left=!0),t},menuBarItem:function(){
return cleverapps.styles.SceneDecors.menuBarItemEaster},episodeView:function(){return cleverapps.styles.SceneDecors.episodeViewEaster},toolbarDecors:function(){return cleverapps.styles.SceneDecors.toolbarViewEaster},tulpanScale:function(){if("heroes"===cleverapps.config.name)return.9},missionIcon:function(e){return-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER?bundles.easter.frames.letter_mission_icon:-1!==["heroes"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_BURN_NEARBY?bundles.easter.frames.tulpan_png:-1!==["riddles"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_COLLECT_MARK?bundles.easter.frames.rose_png:void 0},missionSidebarJson:function(e){if(-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.sidebar.jsons.easter_letter_json},missionStar:function(e){if(-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name)
)return bundles.easter.frames["mission_star"+e.type+"_png"]},missionMarkIcon:function(){return bundles.easter.frames["rose_"+(Math.random()<.5?1:2)]},missionRulesWindow:function(e){if(-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.easter.jsons.letter_rules_json},removeMissions:function(){return"riddles"===cleverapps.config.name?[Mission.TYPE_COMBO,Mission.TYPE_BURN_NEARBY]:"heroes"===cleverapps.config.name?[Mission.TYPE_COLLECT_MARK,Mission.TYPE_COMBO]:void 0},gameSceneBg:function(){if("wordsoup"===cleverapps.config.name)return{pattern:bundles.easter.urls.pattern_bg}},spine:function(e){var t={};return-1!==["riddles"].indexOf(cleverapps.config.name)&&(t[bundles.rose_tournament.jsons.json]=bundles.easter.jsons.rose_tournament_json,t[bundles.main.jsons.tournament_rose_icon_json]=bundles.easter.jsons.tournament_rose_icon_json),-1!==["heroes"].indexOf(cleverapps.config.name)&&(
t[bundles.tulpan_tournament.jsons.json]=bundles.easter.jsons.tulpan_tournament_json,t[bundles.main.jsons.tournament_tulpan_icon_json]=bundles.easter.jsons.tournament_tulpan_icon_json),t[e.json]},localization:function(){if(cleverapps.SkinManager.SKINS.easter.localization[cleverapps.config.name])return cleverapps.SkinManager.SKINS.easter.localization[cleverapps.config.name]}}},cleverapps.SkinManager.SKINS.memorial={bundle:"memorial",localization:{heroes:{"Missions.TulpanTournament.Title":"Memorial.Missions.TulpanTournament.Title","Missions.TulpanTournament.Rules1":"Memorial.Missions.TulpanTournament.Rules1","Missions.TulpanTournament.AnimationMainTextWin":"Memorial.Missions.TulpanTournament.AnimationMainTextWin","Missions.TulpanTournament.AnimationMainTextLose":"Memorial.Missions.TulpanTournament.AnimationMainTextLose","Missions.TulpanTournament.AnimationMainTextInfo0":"Memorial.Missions.TulpanTournament.AnimationMainTextInfo0",
"Missions.TulpanTournament.AnimationMainTextInfo1":"Memorial.Missions.TulpanTournament.AnimationMainTextInfo1","AddMovesWindow.mission.TulpanTournament":"Memorial.AddMovesWindow.mission.TulpanTournament","AddMovesWindow.missionGiveUp.TulpanTournament":"Memorial.AddMovesWindow.missionGiveUp.TulpanTournament","BoostersSaleWindow.title":"Memorial.BoostersSaleWindow.title"},wordsoup:{"Missions.LetterTournament.Title":"Memorial.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Memorial.Missions.LetterTournament.Rules1","MissionRulesWindow.LetterTournament.text2":"Memorial.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Memorial.MissionRulesWindow.LetterTournament.text3","Race.force":"Memorial.Race.force","Race.dialogue.stage_0.0":"Memorial.Race.dialogue.stage_0.0","Race.dialogue.stage_0.1":"Memorial.Race.dialogue.stage_0.1","Race.dialogue.stage_0.2":"Memorial.Race.dialogue.stage_0.2",
"Race.dialogue.stage_7.0":"Memorial.Race.dialogue.stage_7.0","Race.dialogue.stage_7.1":"Memorial.Race.dialogue.stage_7.1","Race.dialogue.stage_50.0":"Memorial.Race.dialogue.stage_50.0","Race.dialogue.stage_50.1":"Memorial.Race.dialogue.stage_50.1","BoostersSaleWindow.title":"Memorial.BoostersSaleWindow.title"},crocword:{"Missions.LetterTournament.Title":"Memorial.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Memorial.Missions.LetterTournament.Rules1","MissionRulesWindow.LetterTournament.text2":"Memorial.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Memorial.MissionRulesWindow.LetterTournament.text3",WardrobeDescText:"Memorial.WardrobeDescText",WardrobeRulesText:"Memorial.WardrobeRulesText",WardrobePrizeRewardTitle:"Memorial.WardrobePrizeRewardTitle","WardrobeDialogue.stage0.text0":"Memorial.WardrobeDialogue.stage0.text0","WardrobeDialogue.stage1.text0":"Memorial.WardrobeDialogue.stage1.text0",
"WardrobeDialogue.stage2.text0":"Memorial.WardrobeDialogue.stage2.text0","WardrobeDialogue.stage3.text0":"Memorial.WardrobeDialogue.stage3.text0","WardrobeDialogue.stage4.text0":"Memorial.WardrobeDialogue.stage4.text0","WardrobeDialogue.stage5.text0":"Memorial.WardrobeDialogue.stage5.text0","WardrobeDialogue.stage6.text0":"Memorial.WardrobeDialogue.stage6.text0","WardrobeDialogue.stage7.text0":"Memorial.WardrobeDialogue.stage7.text0","WardrobeDialogue.stage8.text0":"Memorial.WardrobeDialogue.stage8.text0","WardrobeDialogue.stage9.text0":"Memorial.WardrobeDialogue.stage9.text0","WardrobeDialogue.stage10.text0":"Memorial.WardrobeDialogue.stage10.text0","WardrobeDialogue.stage11.text0":"Memorial.WardrobeDialogue.stage11.text0","BoostersSaleWindow.title":"Memorial.BoostersSaleWindow.title"},riddles:{"Missions.TulpanTournament.Title":"Memorial.Missions.TulpanTournament.Title","Missions.TulpanTournament.Rules1":"Memorial.Missions.TulpanTournament.Rules1",
"Missions.TulpanTournament.AnimationMainTextWin":"Memorial.Missions.TulpanTournament.AnimationMainTextWin","Missions.TulpanTournament.AnimationMainTextLose":"Memorial.Missions.TulpanTournament.AnimationMainTextLose","Missions.TulpanTournament.AnimationMainTextInfo0":"Memorial.Missions.TulpanTournament.AnimationMainTextInfo0","Missions.TulpanTournament.AnimationMainTextInfo1":"Memorial.Missions.TulpanTournament.AnimationMainTextInfo1","AddMovesWindow.mission.TulpanTournament":"Memorial.AddMovesWindow.mission.TulpanTournament","AddMovesWindow.missionGiveUp.TulpanTournament":"Memorial.AddMovesWindow.missionGiveUp.TulpanTournament","BoostersSaleWindow.title":"Memorial.BoostersSaleWindow.title"}},slots:{spine:function(e){var t={};return-1!==["heroes","riddles"].indexOf(cleverapps.config.name)&&(t[bundles.tulpan_tournament.jsons.json]=bundles.memorial.jsons.json,t[bundles.main.jsons.tournament_tulpan_icon_json]=bundles.memorial.jsons.icon_json),-1!==["crocword"].indexOf(
cleverapps.config.name)&&(t[bundles.main.jsons.hero_json]=bundles.memorial.jsons.hero_json,t[bundles.main.jsons.wardrobe_icon_json]=bundles.memorial.jsons.wardrobe_icon_json),t[e.json]?t[e.json]:e.json},toolbarDecors:function(e){if(-1!==["heroes","riddles","wordsoup","crocword"].indexOf(cleverapps.config.name))return cleverapps.styles.SceneDecors.toolbarViewMemorial},windowDecors:function(e){if(-1!==["heroes","riddles","wordsoup","crocword"].indexOf(cleverapps.config.name)){var t=e.decors&&cleverapps.clone(e.decors,!0)||{};return t.memorial_decor_top=!0,t.memorial_decor_bottom_left=!0,t.memorial_decor_bottom_right=!0,e.window instanceof LeadersWindow&&(t.memorial_decor_bottom_right=!1),e.window instanceof FavoriteSaleWindow&&(t.memorial_decor_bottom_left=!1),e.window instanceof SubscriptionWindow&&-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name)&&(t.memorial_decor_top=!1,t.memorial_decor_bottom_left=!1,t.memorial_decor_bottom_right=!1),e.window instanceof WardrobeWindow&&(
t.memorial_decor_top=!1),e.window instanceof WardrobeRulesWindow&&(t.memorial_decor_top=!1),e.window instanceof WardrobeReceiveWindow&&(t.memorial_decor_top=!1),t.leaves_right=!1,t.gears=!1,t.gears_animation=!1,t}return e.decors},missionIcon:function(e){return-1!==["heroes","riddles"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_BURN_NEARBY?bundles.memorial.frames.mission_icon_png:-1!==["wordsoup","crocword"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER?bundles.memorial.frames.mission_icon_png:void 0},missionStar:function(e){if(-1!==["wordsoup","crocword"].indexOf(cleverapps.config.name))return bundles.memorial.frames["mission_star"+e.type+"_png"]},missionRulesWindow:function(e){if(-1!==["wordsoup","crocword"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.memorial.jsons.letter_rules_json},missionSidebarJson:function(e){if(-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER
)return bundles.sidebar.jsons.memorial_letter_json},removeMissions:function(){if(-1!==["heroes","riddles"].indexOf(cleverapps.config.name))return[Mission.TYPE_COLLECT_MARK,Mission.TYPE_COMBO]},wardrobeWindowBanner:function(){return bundles.memorial.frames.wardrobe_window_banner},localization:function(){if(cleverapps.SkinManager.SKINS.memorial.localization[cleverapps.config.name])return cleverapps.SkinManager.SKINS.memorial.localization[cleverapps.config.name]}}},cleverapps.SkinManager.SKINS.halloween={bundle:"halloween",localization:{heroes:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title"},scramble:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title","Missions.LetterTournament.Title":"Halloween.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Halloween.Missions.LetterTournament.Rules1","MissionRulesWindow.LetterTournament.text2":"Halloween.MissionRulesWindow.LetterTournament.text2",
"MissionRulesWindow.LetterTournament.text3":"Halloween.MissionRulesWindow.LetterTournament.text3"},wordsoup:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title"},tripeaks:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title",CloversTooltip:"Halloween.CloversTooltip","Missions.LetterTournament.Title":"Halloween.Missions.LetterTournament.Title","MissionRulesWindow.LetterTournament.text2":"Halloween.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Halloween.MissionRulesWindow.LetterTournament.text3","AddMovesWindow.missionGiveUp.LetterTournament":"Halloween.AddMovesWindow.missionGiveUp.LetterTournament","AddMovesWindow.mission.LetterTournament":"Halloween.AddMovesWindow.mission.LetterTournament"},differences:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title"},riddles:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title"}},slots:{windowDecors:function(e){var t={};return-1!==["wordsoup"].indexOf(
cleverapps.config.name)&&-1!==[VictoryWindow].indexOf(e.window.constructor)?t.web_bottom=!0:(t.web_top=!0,t.web_bottom=!0,t.pumpkin_animation=!0),-1!==["wordsoup"].indexOf(cleverapps.config.name)&&-1!==[ExtraWindow].indexOf(e.window.constructor)&&(t.web_top=!1),-1!==[MiniGameWindow].indexOf(e.window.constructor)&&(t.web_top=!1,t.web_bottom=!1),-1!==["olympics","differences"].indexOf(cleverapps.config.name)&&-1!==[KnockoutWindow].indexOf(e.window.constructor)&&(t.pumpkin_animation=!1),-1!==[PiggyBankWindow,MissionRulesWindow,DailyTasksWindow,LeadersWindow].indexOf(e.window.constructor)&&(t.forest=!0,t.roots_top_left=!0,t.roots_top_right=!0,t.owls_animation=!0,t.pumpkin_animation=!1,t.web_top=!1),-1!==[MissionRulesWindow].indexOf(e.window.constructor)&&cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL&&(t.forest=!1,t.owls_animation=!1),-1!==[RestartWindow,LevelStartWindow,LoseWindow,SettingsWindow].indexOf(e.window.constructor)&&(t.pumpkins=!0,t.candle_animation=!0,
t.pumpkin_animation=!1,t.web_top=!1),"undefined"!=typeof QuestWindow&&e.window.constructor===QuestWindow&&(t.pumpkin_animation=!1),"undefined"!=typeof BuildingStartWindow&&e.window.constructor===BuildingStartWindow&&(t.web_top=!1),-1!==[RulesWindow].indexOf(e.window.constructor)&&(t.pumpkin_animation=!1),"differences"===cleverapps.config.name&&-1!==[MissionWindow].indexOf(e.window.constructor)&&(t.pumpkin_animation=!1),"tripeaks"===cleverapps.config.name&&(-1!==[MissionWindow].indexOf(e.window.constructor)&&(t.web_top=!1),-1!==[VictoryWindow].indexOf(e.window.constructor)&&(t.web_top=!1,t.pumpkin_animation=!1),e.window instanceof RulesWindow&&(t.pumpkin_animation=!1)),"scramble"===cleverapps.config.name&&(-1!==[BackgroundsWindow].indexOf(e.window.constructor)&&(t.web_bottom=!1),e.window instanceof RulesWindow&&(t.pumpkin_animation=!1),-1!==[DailyCupLeadersWindow,CryptexWindow,BackgroundsWindow,VictoryWindow].indexOf(e.window.constructor)&&(t.pumpkin_animation=!1),-1!==[DailyTasksWindow
,LevelStartWindow,SettingsWindow].indexOf(e.window.constructor)&&(t.pumpkin_animation=!0)),t},missionSidebarJson:function(e){if(-1!==["tripeaks","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.sidebar.jsons.halloween_letter_json},localization:function(){if(cleverapps.SkinManager.SKINS.halloween.localization[cleverapps.config.name])return cleverapps.SkinManager.SKINS.halloween.localization[cleverapps.config.name]},missionIcon:function(e){if(-1!==["scramble","tripeaks"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.halloween.frames.mission_letter_png},missionStar:function(e){return-1!==["scramble"].indexOf(cleverapps.config.name)?bundles.halloween.frames["mission_star_"+e.type+"_png"]:-1!==["tripeaks"].indexOf(cleverapps.config.name)?bundles.halloween.frames.mission_letter_png:void 0},missionRulesWindow:function(e){if(-1!==["tripeaks","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER
)return bundles.halloween.jsons.letter_rules_json},spine:function(e){var t={};return-1!==["scramble","tripeaks"].indexOf(cleverapps.config.name)&&(t[bundles.letter_tournament.jsons.mission_window_json]=bundles.halloween.jsons.halloween_mission_window_json),t[e.json]},cardMarkSpine:function(e){return-1!==["tripeaks"].indexOf(cleverapps.config.name)&&"mission"===e.type?bundles.halloween.jsons.halloween_marks_json:e.json}}},cleverapps.SkinManager.SKINS.black_friday={bundle:"black_friday",slots:{windowDecors:function(e){var t=e.decors&&cleverapps.clone(e.decors,!0)||{};return"scramble"===cleverapps.config.name&&-1!==[FavoriteSaleWindow,BoostersSaleWindow].indexOf(e.window.constructor)&&(t.black_friday_balloon=!0,t.black_friday_label=!0),t}}};var NoConnectionWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.NoConnectionWindow;this._super({title:"messages:NoConnectionWindow.title",name:"noconnectionwindow",content:this.getContent(),button:{width:e.button.width,
height:e.button.height,text:Messages.get("OK"),onPressed:function(){this.close()}.bind(this)}})},getContent:function(){var e=cleverapps.styles.NoConnectionWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.animation);var i=new cleverapps.Spine(bundles.main.jsons.no_connection_json,1);t.addChild(i),i.setPositionRound(t.width/2,t.height/2),i.setAnimation(0,"animation",!0);var s=cleverapps.UI.generateTTFText("messages:RestartWindow.AnErrorOccured",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return s.setDimensions(e.text.width,0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),new cleverapps.Layout([s,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin})}});cleverapps.styles.NoConnectionWindow={width:500,height:800,margin:30,animation:{width:400,height:400},text:{width:480},button:{width:200,height:100}};var BaseBoosterBefore=function(e){cleverapps.EventEmitter.call(this),this.id=e,this.price=cleverapps.config.prices.boosters[e][1],this.state=BaseBoosterBefore.ACTIVE_STATE,
this.bonusState=BaseBoosterBefore.BONUS_EMPTY_STATE,this.isAvailable()||(this.state=BaseBoosterBefore.DISABLED_STATE)};BaseBoosterBefore.prototype=Object.create(cleverapps.EventEmitter.prototype),(BaseBoosterBefore.prototype.constructor=BaseBoosterBefore).prototype.onStart=function(){this.state===BaseBoosterBefore.USE_STATE&&cleverapps.boostersCounter.use(this.id)},BaseBoosterBefore.prototype.onGiveUp=function(){this.state===BaseBoosterBefore.USE_STATE&&(cleverapps.boostersCounter.add(this.id,1),this.state=BaseBoosterBefore.ACTIVE_STATE)},BaseBoosterBefore.prototype.isActivated=function(){return this.state===BaseBoosterBefore.USE_STATE},BaseBoosterBefore.prototype.isBonusActivated=function(){return this.bonusState===BaseBoosterBefore.BONUS_LANTERN_STATE},BaseBoosterBefore.prototype.getActivatedStates=function(){var e=[];return this.isActivated()&&e.push(this.state),this.isBonusActivated()&&e.push(this.bonusState),e},BaseBoosterBefore.prototype.getAmount=function(){
return cleverapps.boostersCounter.getAmount(this.id)},BaseBoosterBefore.prototype.setState=function(e){this.state=e,this.trigger("update")},BaseBoosterBefore.prototype.setBonusState=function(e){this.bonusState=e,this.trigger("update")},BaseBoosterBefore.prototype.use=function(){if(this.state===BaseBoosterBefore.ACTIVE_STATE)if(0<this.getAmount())this.setState(BaseBoosterBefore.USE_STATE);else if(cleverapps.user.canTakeGold(this.price)){levels.user.takeGold(this.price),cleverapps.boostersCounter.add(this.id,1);var e=BoostersBefore.instance&&BoostersBefore.instance.level;cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HINT_USED,{hash:e.hash,amount:this.price}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTERS_BOUGHT,{amount:1}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTERS_BOUGHT_ITEM,{id:this.id,amount:1}),cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect),this.setState(BaseBoosterBefore.USE_STATE)
}else cleverapps.flags.nopayments?cleverapps.Notification.create("messages:NotEnoughCoins"):new ShopWindow({tab:ShopWindow.TABS.COINS})},BaseBoosterBefore.prototype.unuse=function(){this.state===BaseBoosterBefore.USE_STATE&&this.setState(BaseBoosterBefore.ACTIVE_STATE)},BaseBoosterBefore.prototype.onClick=function(){this.state===BaseBoosterBefore.USE_STATE?this.unuse():(this.use(),cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce())},BaseBoosterBefore.prototype.isAvailable=function(){return cleverapps.user.checkAvailable(BoostersBeforeConfig[this.id].available)},BaseBoosterBefore.prototype.showTutorialStep=function(e){this.isForceAvailable()?(cleverapps.boostersCounter.canUse(this.id)||cleverapps.boostersCounter.add(this.id,1),this.trigger("showForce",e)):e()},BaseBoosterBefore.prototype.isForceAvailable=function(){return this.isAvailable()&&!cleverapps.forces.isShown(this.force.id)},BaseBoosterBefore.ACTIVE_STATE=0,BaseBoosterBefore.USE_STATE=1,
BaseBoosterBefore.DISABLED_STATE=4,BaseBoosterBefore.BONUS_LANTERN_STATE=2,BaseBoosterBefore.BONUS_EMPTY_STATE=6;var ComboBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_COMBO),this.force=Forces.FIRST_BOOSTERS_BEFORE};ComboBooster.prototype=Object.create(BaseBoosterBefore.prototype),(ComboBooster.prototype.constructor=ComboBooster).prototype.giveBonus=function(){var e=this.getActivatedStates().length*ComboBooster.COMBOS_AMOUNT,t=ComboBooster.COMBOS_TIMEOUTS.slice(0,e),i=Game.currentGame.field.addRandomCombo(e,{boosterBefore:!0,timeouts:t});i<e&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTER_COMBO_NO_PLACE,{amount:e-i}),i<=e-ComboBooster.COMBOS_AMOUNT&&this.onGiveUp()},ComboBooster.COMBOS_AMOUNT=5,ComboBooster.COMBOS_TIMEOUTS=[0,120,250,360,500,620,750,860,1e3,1100];var DiceBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_DICE),this.force=Forces.SECOND_BOOSTERS_BEFORE};DiceBooster.prototype=Object.create(BaseBoosterBefore.prototype),(
DiceBooster.prototype.constructor=DiceBooster).prototype.giveBonus=function(){Game.currentGame.dice.roll(),Game.currentGame.dice.reward(),this.number=Game.currentGame.dice.number},DiceBooster.prototype.getBonusDuration=function(){return DiceBooster.BONUS_DURATION+.2*(this.number||6)},DiceBooster.BONUS_DURATION=2.6;var MagnetBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_MAGNET),this.force=Forces.FIRST_BOOSTERS_BEFORE};MagnetBooster.prototype=Object.create(BaseBoosterBefore.prototype),(MagnetBooster.prototype.constructor=MagnetBooster).prototype.giveBonus=function(){var e=Game.currentGame.table.getScreen(),t=cleverapps.Random.shuffle(e.cardsThatCanBeReplacedWithBoosters());if(0!==t.length){var i=t.filter(function(e){return e.isOpen()}),s=0<i.length?i[0]:t[0],n=cleverapps.extend(s.toJSON(),{marks:["magnet"]}),o=CardFactory.Create(n);o.setOwner(s.owner),o.deep=s.deep,o.screenZOrder=s.screenZOrder,e.replaceCard(s,o),e.trigger("replaceCardWithAnother",s,o),s.isOpen(
)&&o.flip();var a=o.marks[0];a.hide(),e.trigger("demonstrateBoosterBefore",o,function(){a.show(!0)})}else this.onGiveUp()},MagnetBooster.prototype.getBonusDuration=function(){return MagnetBooster.BONUS_DURATION},MagnetBooster.BONUS_DURATION=2.2;var MovesBooster=function(e){BaseBoosterBefore.call(this,BoostersBefore.TYPE_MOVES),this.force=Forces.SECOND_BOOSTERS_BEFORE,e&&0===e.episodeNo&&e.levelNo<=2&&(this.state=BaseBoosterBefore.DISABLED_STATE)};MovesBooster.prototype=Object.create(BaseBoosterBefore.prototype),(MovesBooster.prototype.constructor=MovesBooster).prototype.giveBonus=function(){var e=0;this.isActivated()&&(e+=MovesBooster.BOUGHT_MOVES_AMOUNT),this.isBonusActivated()&&(e+=MovesBooster.BONUS_MOVES_AMOUNT),Game.currentGame.setMoves(Game.currentGame.moves+e,{animate:!0,boosterBefore:!0}),Game.currentGame.beginMoves+=e},MovesBooster.BONUS_MOVES_AMOUNT=3,MovesBooster.BOUGHT_MOVES_AMOUNT=5;var MultiColorBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_MULTICOLOR
),this.force=Forces.THIRD_BOOSTERS_BEFORE};MultiColorBooster.prototype=Object.create(BaseBoosterBefore.prototype),(MultiColorBooster.prototype.constructor=MultiColorBooster).prototype.giveBonus=function(){var e=this.getActivatedStates().length,t=Game.currentGame.field.addRandomMulticolor(e,{boosterBefore:!0});t<e&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTER_MULTICOLOR_NO_PLACE,{amount:e-t}),this.onGiveUp())};var TwoJokersBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_TWO_JOKERS),this.force=Forces.THIRD_BOOSTERS_BEFORE};TwoJokersBooster.prototype=Object.create(BaseBoosterBefore.prototype),(TwoJokersBooster.prototype.constructor=TwoJokersBooster).prototype.giveBonus=function(){var s=Game.currentGame.table.getScreen(),e=function(e,t){if(e){var i=CardFactory.Create({feature:"wild",x:e.getPositionX(),y:e.getPositionY(),rotation:e.getRotation(),screenZOrder:e.screenZOrder});i.setOwner(e.owner),i.deep=e.deep,s.insertBeforeCard(e,i),s.trigger("insertCard",i,
t?-2*cleverapps.styles.CardView.width:2*cleverapps.styles.CardView.width)}},t=s.cardsWithPossibilityOfPlacingUnderThem();e(t.filter(function(e){return e.getPositionX()<0}).pop(),!0),e(t.filter(function(e){return 0<=e.getPositionX()}).pop(),!1)},TwoJokersBooster.prototype.getBonusDuration=function(){return TwoJokersBooster.BONUS_DURATION},TwoJokersBooster.BONUS_DURATION=1.6;var HighlightBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_HIGHLIGHT),this.force=Forces.FIRST_BOOSTERS_BEFORE};HighlightBooster.prototype=Object.create(BaseBoosterBefore.prototype),(HighlightBooster.prototype.constructor=HighlightBooster).prototype.giveBonus=function(){Game.currentGame.currentHighlighter.enable()};var EyeBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_EYE),this.force=Forces.SECOND_BOOSTERS_BEFORE};EyeBooster.prototype=Object.create(BaseBoosterBefore.prototype),(EyeBooster.prototype.constructor=EyeBooster).prototype.giveBonus=function(){this.trigger("giveBonus")
},EyeBooster.prototype.getBonusDuration=function(){return 5};var MagnifierBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_HINT),this.force=Forces.THIRD_BOOSTERS_BEFORE};MagnifierBooster.prototype=Object.create(BaseBoosterBefore.prototype),(MagnifierBooster.prototype.constructor=MagnifierBooster).prototype.giveBonus=function(){Game.currentGame.keypad.addMagnifiers(MagnifierBooster.AMOUNT),Game.currentGame.keypad.magnifiersShowUp()},MagnifierBooster.AMOUNT=5;var BoostersBefore=function(e){var t=(BoostersBefore.instance=this).level=e.level;"solitaire"===cleverapps.config.type?(this.list=[new MagnetBooster,new DiceBooster,new TwoJokersBooster],cleverapps.boostersCounter.onChangeListeners.BoostersBefore=function(){this.list.forEach(function(e){e.onChangeAmountListener()})}.bind(this)):"stacks"===cleverapps.config.subtype?this.list=[new HighlightBooster,new EyeBooster,new MagnifierBooster]:this.list=[new ComboBooster,new MovesBooster(t),new MultiColorBooster]
;var i=Lantern.GetStreak(this.level);if(0<i){this.lantern=Lantern.Get();for(var s=0;s<i;s++)this.list[s].setBonusState(BaseBoosterBefore.BONUS_LANTERN_STATE)}};BoostersBefore.prototype.onStart=function(){this.list.forEach(function(e){e.onStart()})},BoostersBefore.prototype.onGiveUp=function(){cleverapps.lives&&this.list.forEach(function(e){e.onGiveUp()})},BoostersBefore.prototype.giveBonus=function(e){var t=this.list.filter(function(e){return 0<e.getActivatedStates().length});"match3"===cleverapps.config.type&&t.reverse();var i=t.map(function(i){return i.getActivatedStates().forEach(function(e){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTERS_EXECUTE+"_"+i.id+"_"+e)}),function(e){i.giveBonus();var t=cleverapps.styles.BoostersBefore.duration;i.getBonusDuration&&(t=i.getBonusDuration()),0===t?e():Game.currentGame.counter.setTimeout(e,1e3*t)}});cleverapps.metha.compound(e,i)},BoostersBefore.prototype.showTutorialStep=function(){var e=this.list.map(function(t){return function(e){
t.showTutorialStep(e)}});cleverapps.metha.compound(function(){},e)},BoostersBefore.prototype.getActivatedBooster=function(t){var e=this.list.filter(function(e){return e instanceof t})[0];return e&&e.isActivated()?e:void 0},BoostersBefore.isAvailable=function(){return cleverapps.user.checkAvailable(BoostersBefore.AVAILABLE)},BoostersBefore.AVAILABLE={episode:0,level:4,projectName:["riddles","heroes","tripeaks","scramble","adventure","runes"]},cleverapps.styles.BoostersBefore={duration:.3},BoostersBefore.TYPE_COMBO=5,BoostersBefore.TYPE_MOVES=6,BoostersBefore.TYPE_MULTICOLOR=7,BoostersBefore.TYPE_MAGNET=10,BoostersBefore.TYPE_DICE=11,BoostersBefore.TYPE_TWO_JOKERS=12,BoostersBefore.TYPE_HIGHLIGHT=13,BoostersBefore.TYPE_EYE=14,BoostersBefore.TYPE_HINT=15;var BoostersBeforeConfig={};BoostersBeforeConfig[BoostersBefore.TYPE_COMBO]={icon:bundles.reward_icons.frames.heroes_png,available:{episode:0,level:13}},BoostersBeforeConfig[BoostersBefore.TYPE_MOVES]={
icon:bundles.reward_icons.frames.moves_png,available:{episode:1,level:3}},BoostersBeforeConfig[BoostersBefore.TYPE_MULTICOLOR]={icon:bundles.reward_icons.frames.multicolor_png,available:{episode:1,level:7}},BoostersBeforeConfig[BoostersBefore.TYPE_MAGNET]={icon:bundles.reward_icons.frames.magnet_png,available:{episode:0,level:14}},BoostersBeforeConfig[BoostersBefore.TYPE_DICE]={icon:bundles.reward_icons.frames.dice_png,available:{episode:1,level:3}},BoostersBeforeConfig[BoostersBefore.TYPE_TWO_JOKERS]={icon:bundles.reward_icons.frames.joker_png,available:{episode:1,level:7}},BoostersBeforeConfig[BoostersBefore.TYPE_HIGHLIGHT]={icon:bundles.reward_icons.frames.highlight,available:{episode:0,level:13}},BoostersBeforeConfig[BoostersBefore.TYPE_EYE]={icon:bundles.reward_icons.frames.eye,available:{episode:1,level:3}},BoostersBeforeConfig[BoostersBefore.TYPE_HINT]={icon:bundles.reward_icons.frames.hint,available:{episode:1,level:7}};var BoosterBeforeAmountView=cc.Node.extend({ctor:function(
e){this._super(),this.setAnchorPoint(.5,.5),this.setCascadeOpacityEnabled(!0),this.booster=e;var t=cleverapps.styles.BoosterBeforeAmountView;this.bg=new cc.Sprite(bundles.boosters_before.frames.booster_before_purple_button_png),this.bg.setScale(t.background.scale),this.bg.setAnchorPoint2(),this.addChild(this.bg),this.booster.state===BaseBoosterBefore.DISABLED_STATE&&this.booster.getAmount()>cleverapps.BoostersCounter.INIT_AMOUNT&&cleverapps.UI.convertToGrayScale(this.bg),this.amount=cleverapps.UI.generateTTFText("",cleverapps.styles.FONTS.BOOSTER_BEFORE_AMOUNT_TEXT),this.addChild(this.amount),this.icon=new cc.Sprite(bundles.boosters_before.frames.booster_before_plus_icon_png),this.addChild(this.icon),this.update()},showActivated:function(){this.amount.visible=!1,this.icon.visible=!0,this.icon.setSpriteFrame(bundles.boosters_before.frames.booster_before_check_icon_png),this.bg.setSpriteFrame(bundles.boosters_before.frames.booster_before_green_button_png)},showAmount:function(){
this.amount.visible=!1,this.icon.visible=!1,this.icon.setSpriteFrame(bundles.boosters_before.frames.booster_before_plus_icon_png),this.bg.setSpriteFrame(bundles.boosters_before.frames.booster_before_purple_button_png),0<this.booster.getAmount()?(this.amount.visible=!0,this.amount.setString(this.booster.getAmount()),this.amount.fitTo(this.bg.width*this.bg.scale*.85)):this.icon.visible=!0},update:function(){this.booster.isActivated()?this.showActivated():this.showAmount(),this.visible=this.booster.state!==BaseBoosterBefore.DISABLED_STATE||this.booster.getAmount()>cleverapps.BoostersCounter.INIT_AMOUNT;var e=cleverapps.styles.BoosterBeforeAmountView;this.setContentSize2(Math.max(this.bg.width*this.bg.scale,this.amount.width*this.amount.scale),Math.max(this.bg.height*this.bg.scale,this.amount.height*this.amount.scale)),this.amount.setPositionRound(e.amount),this.bg.setPositionRound(this.width/2,this.height/2),this.icon.setPositionRound(e.icon)}});cleverapps.styles.BoosterBeforeAmountView={
background:{scale:1},amount:{x:{align:"center",dx:0},y:{align:"center",dy:4}},icon:{x:{align:"center"},y:{align:"center"}}};var BoosterBeforeBonusView=cc.Sprite.extend({ctor:function(e){this._super(bundles.boosters_before.frames.booster_before_green_button_png),this.booster=e,this.icon=new cc.Sprite(bundles.boosters_before.frames.booster_before_lantern_icon_png),this.icon.setPositionRound(this.width/2,this.height/2),this.addChild(this.icon),this.update()},lanternAnimation:function(){this.visible=!1,this.runAction(new cc.Sequence(new cc.DelayTime(1.1),new cc.CallFunc(this.update.bind(this))))},update:function(){this.visible=this.booster.isBonusActivated()}}),BoosterBeforeView=cc.Scale9Sprite.extend({ctor:function(e){var t=cleverapps.styles.BoosterBeforeView;this._super(bundles.boosters_before.frames.booster_before_bg_png),this.setContentSize2(t),this.booster=e;var i=t.icon[e.id]?t.icon[e.id].dy:t.icon.dy,s=this.icon=new cc.Sprite(BoostersBeforeConfig[e.id].icon);s.scale=s.baseScale=1,
s.setPositionRound(this.width/2,this.height/2+i),this.addChild(s),e.state===BaseBoosterBefore.DISABLED_STATE&&(cleverapps.UI.convertToGrayScale(s),void 0!==cleverapps.styles.BoosterBeforeView.disabled[e.id]&&(s.opacity*=cleverapps.styles.BoosterBeforeView.disabled[e.id].opacity)),e.bonusState===BaseBoosterBefore.BONUS_LANTERN_STATE&&(this.bonus=new BoosterBeforeBonusView(e),this.bonus.setPositionRound(t.bonus),this.addChild(this.bonus)),this.amount=new BoosterBeforeAmountView(e),this.amount.setPositionRound(t.amount),this.addChild(this.amount);var n=cleverapps.overrideStyles(cleverapps.styles.CoinsPriceView,t.price.styles,!0);if(this.price=new CoinsPriceView(e.price,{styles:n}),this.price.setPositionRound(t.price),this.addChild(this.price),e.on("update",this.createListener(this.update.bind(this))),e.on("showForce",this.createListener(this.showForce.bind(this))),this.update(),this.bonus&&this.bonus.lanternAnimation(),e.isAvailable())cleverapps.UI.applyHover(this),cleverapps.UI.onClick(
this,this.onClick.bind(this));else{var o=BoostersBeforeConfig[e.id].available;cleverapps.tooltipManager.create(this,{text:Messages.get("UnlockOnLevel",{level:cleverapps.humanReadableNumber(o.episode,o.level)}),position:cleverapps.styles.UI.Tooltip.LOCATION.above,size:cleverapps.styles.UI.Tooltip.SIZE.short})}this.booster.onChangeAmountListener=this.createListener(this.update.bind(this))},onClick:function(){var e=this.booster.isActivated()?bundles.main.urls.booster_before_cancel_effect:bundles.main.urls.booster_before_selection_effect;cleverapps.audio.playSound(e),this.booster.onClick(),this.icon.stopAllActions(),this.icon.setScale(.95*this.icon.baseScale),this.icon.runAction(new cc.ScaleTo(.15,this.icon.baseScale).easing(cc.easeBackInOut()))},update:function(){var e=bundles.boosters_before.frames.booster_before_bg_png;this.booster.state===BaseBoosterBefore.DISABLED_STATE?e=bundles.boosters_before.frames.booster_before_bg_off_png:this.booster.isActivated()&&(
e=bundles.boosters_before.frames.booster_before_bg_on_png),this.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(e)),this.amount.update(),this.bonus&&this.bonus.update(),this.price.visible=this.booster.state===BaseBoosterBefore.ACTIVE_STATE&&this.booster.getAmount()<=0,this.booster.state===BaseBoosterBefore.USE_STATE&&Messages.has("BoosterBeforeUse_"+this.booster.id)&&cleverapps.Notification.create("messages:BoosterBeforeUse_"+this.booster.id,{image:new cc.Sprite(BoostersBeforeConfig[this.booster.id].icon)})},showForce:function(e){var t=this.booster.force;cleverapps.forces.isAvailable(this,t)?(cleverapps.forces.create(this,t),cleverapps.forces.onceForceClosed=e,this.update()):e()}});cleverapps.styles.BoosterBeforeView={width:186,height:186,bonus:{x:{align:"left",dx:0},y:{align:"bottom",dy:-18}},amount:{x:{align:"right",dx:18},y:{align:"bottom",dy:-18}},price:{x:{align:"center",dx:0},y:{align:"top",dy:5},styles:{icon:{scale:.6},bg:{
image:bundles.boosters_before.frames.booster_before_price_bg_png,padding:{x:20,y:8},dx:4,dy:-2},margin:3}},disabled:{},icon:{dy:0}},cleverapps.styles.BoosterBeforeView.disabled[BoostersBefore.TYPE_DICE]={opacity:.8};var BoostersBeforeComponent=function(e){var t=cleverapps.styles.BoostersBeforeComponent,i=cleverapps.UI.generateTTFText("messages:BoostersBeforeComponent.Title",cleverapps.styles.FONTS.BOOSTERS_BEFORE_TEXT||cleverapps.styles.FONTS.WINDOW_BIG_TEXT),s=e.list.map(function(e){return new BoosterBeforeView(e)}.bind(this)),n=new cleverapps.Layout(s,{margin:t.margin,direction:cleverapps.UI.HORIZONTAL}),o=new cleverapps.Layout([n,i],{margin:t.contentMargin||t.margin,direction:cleverapps.UI.VERTICAL});if(o.height+=2*t.margin,e.lantern){var a=new LanternView(e.lantern,o);o.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.CallFunc(function(){a.replaceParentSamePlace(cleverapps.windows.currentWindow()),a.setLocalZOrder(20)}),new cc.DelayTime(.6),new cc.CallFunc(function(){
e.lantern.onGiveBonusListener()}.bind(this))))}return o};cleverapps.styles.BoostersBeforeComponent={margin:15};var BoostersBeforeHelper={animateAppear:function(e,t,i){if(i=cleverapps.once(i||function(){}),e&&e.parent&&t.target&&t.target.parent){var s=t.target,n=cc.director.getRunningScene();e.setPosition(e.getParent().convertToNodeSpace(s.getParent().convertToWorldSpace(s.getPosition()))),e.replaceParentSamePlace(n),e.setLocalZOrder(10),e.setScale(2),e.runAction(new cc.Sequence(new cc.ScaleTo(.5,t.scale).easing(cc.easeBackOut()),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.main.urls.collect_coins_effect),!1!==t.remove&&e.parent&&e.removeFromParent(!0)}))),e.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.CallFunc(i))),BoostersBeforeHelper.animateStars(e)}else i()},animateStars:function(e){var t=new cleverapps.Spine(bundles.game.jsons.boosters_before_json);t.setAnimation(0,"animation",!1),t.setPositionRound(e.x,e.y),e.parent.addChild(t),t.setLocalZOrder(
e.getLocalZOrder()-1),t.setTimeScale(1.3),t.runAction(new cc.Sequence(new cc.DelayTime(1.3),new cc.RemoveSelf))}},EyeBoosterView=cc.Node.extend({ctor:function(e,t){this._super(),this.booster=e,this.boardView=t,this.board=this.boardView.board,this.setAnchorPoint2(),this.booster.on("giveBonus",this.giveBonus.bind(this))},giveBonus:function(){this.boardView.toggleElements(!1);var e=cc.director.getRunningScene().scene,t=new cleverapps.Spine(bundles.game.jsons.eye_booster_json);e.addChild(t),t.setLocalZOrder(110),t.setPositionRound(e.width/2,e.height/2),t.setAnimation(0,"show",!1),t.setCompleteListener(function(){t.setAnimation(0,"activate",!1),t.setCompleteListenerRemove(),t.setTimeScale(.8);var n=[];this.boardView.placeholders.forEach(function(e,s){e.forEach(function(e,t){if(!this.board.foundWordsSet[this.board.words[s]]){var i=new CharView(this.board.words[s][t].toUpperCase(),{hard:this.board.level.isHard(),noBg:cleverapps.styles.CharView.noHintBg});this.boardView.letterGrid.addChild(i),
i.setPositionRound(e.x,e.y+cleverapps.styles.BoardView.Letter.paddingBottom),n.push(i)}}.bind(this))}.bind(this)),n.sort(function(e,t){return e.x-t.x}),this.audio=cleverapps.audio.playSound(bundles.game.urls.eye_booster_effect,{loop:!0}),this.runPass(n,0)}.bind(this)),cleverapps.audio.playSound(bundles.game.urls.eye_booster_start_effect)},runPass:function(e,n){if(n===EyeBoosterView.PASSES_COUNT)return cleverapps.audio.stopSound(this.audio),void this.onAllPassesFinished(e);var t=cleverapps.styles.EyeBoosterView,o=t.MIN_OPACITY_OFFSET,a=t.MAX_OPACITY_OFFSET,r=e[0].x-o,l=e[e.length-1].x+o,c=l-r,p=cleverapps.wait(e.length,this.runPass.bind(this,e,n+1));e.forEach(function(e){var t,i=((t=n%2==0?e.x:l-e.x)-o-r)/c*EyeBoosterView.SINGLE_PASS_TIME,s=(t-a-r)/c*EyeBoosterView.SINGLE_PASS_TIME-i;e.setOpacity(0),e.runAction(new cc.Sequence(new cc.DelayTime(i),new cc.FadeIn(s),new cc.FadeOut(s),new cc.CallFunc(p)))})},onAllPassesFinished:function(e){e.forEach(function(e){e.removeFromParent()}),
this.boardView.showUpAnimation(void 0,{onlyElements:!0})}});EyeBoosterView.SINGLE_PASS_TIME=1.8,EyeBoosterView.PASSES_COUNT=2,cleverapps.styles.EyeBoosterView={MIN_OPACITY_OFFSET:300,MAX_OPACITY_OFFSET:100};var MethaIcon=SideBarIcon.extend({ctor:function(e){var t=cleverapps.overrideStyles(cleverapps.styles.SideBarIcon,cleverapps.styles.MethaIcon,!0);this._super(e,t)},onEnter:function(){switch(this._super(),cleverapps.metha.getType()){case Metha.FARM:!cleverapps.farm.isCompleted()&&cleverapps.farm.getBuilding().getQuest().isCompleted()&&this.turnOnAttention();break;case Metha.HOMEFIX:!cleverapps.home.isCompleted()&&cleverapps.home.getFurnitureToUpgrade()&&this.turnOnAttention()}},onPressed:function(){this._super(),cleverapps.audio.playSound(bundles.main.urls.icon_click_effect),cleverapps.metha.display({focus:"gotoMetha",action:function(e){cleverapps.scenes.replaceScene(new NoMainMethaScene,e)}})}});MethaIcon.IsAvailable=function(){return cleverapps.metha.withSimpleMain()},
cleverapps.styles.MethaIcon={animation:bundles.sidebar.jsons.metha_icon_json};var Rocket=cc.Node.extend({ctor:function(e,t,i){this._super(),this.startCell=e,this.targetCell=t,this.addChild(i.rocket),this.setVisible(!1);var s=0;i.startDX&&(s+=i.startDX),cleverapps.styles.Rocket.startDX&&(s+=cleverapps.styles.Rocket.startDX);var n=0;i.startDY&&(n+=i.startDY),cleverapps.styles.Rocket.startDY&&(n+=cleverapps.styles.Rocket.startDY),this.setPositionRound(BaseCellView.alignInTheGrid(e.x,e.y)),this.setPosition(this.getPosition().x+s,this.getPosition().y+n),this.aim(i)},aim:function(e){this.targetPos=BaseCellView.alignInTheGrid(this.targetCell.x,this.targetCell.y),this.prevPos=this.getPosition(),this.scheduleUpdate(),this.animateFly(e)},animateFly:function(e){var t=cleverapps.styles.Rocket,i=this.getPosition(),s=BaseCellView.alignInTheGrid(this.targetCell.x,this.targetCell.y),n=cc.p(i.x,Math.max(i.y,s.y)+t.flyUp),o=cc.p(s.x,n.y),a=this.targetCell.y-this.startCell.y;if(
this.targetCell.y>this.startCell.y&&Math.abs(this.targetCell.x-this.startCell.x)<=1){var r=Math.abs(a)*cleverapps.styles.BaseCellView.CELL_SIZE_PX;this.startCell.x<Field.SIZE/2?o.x+=r:o.x-=r}else if(this.startCell.x===this.targetCell.x&&this.startCell.y>this.targetCell.y){r=Math.abs(a)*cleverapps.styles.BaseCellView.CELL_SIZE_PX;n.y-=r/2,this.startCell.x<Field.SIZE/2?n.x+=r/2:n.x-=r/2,o=cc.p(n.x,s.y+cleverapps.styles.BaseCellView.CELL_SIZE_PX)}this.runAction(new cc.Sequence(new cc.DelayTime(e.delay),new cc.CallFunc(function(){this.setVisible(!0),e.onLaunch()}.bind(this)),new cc.BezierTo(e.duration,[n,o,s]).easing(cc.easeIn(1)),new cc.CallFunc(function(){this.unscheduleUpdate(),e.onArrive(function(){this.runAction(new cc.RemoveSelf)}.bind(this))}.bind(this))))},update:function(e){this._super(e),this.setRotation(180*Math.atan2(this.x-this.prevPos.x,this.y-this.prevPos.y)/Math.PI),this.prevPos=this.getPosition()}});cleverapps.styles.Rocket={flyUp:150};var ViewReader={
calcGrowType:function(e){return e.getGround(Iso.UP_LEFT)!==Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_RIGHT)!==Map2d.TILE_GREEN_LEVEL_2?bundles.merge.frames.grow12_corner:e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_2?bundles.merge.frames.grow12_both:e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_2?bundles.merge.frames.grow12_left:bundles.merge.frames.grow12_right},calcBorderTypeUp:function(e){return e.getGround(Iso.UP_ABOVE)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_LEFT)!==Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_RIGHT)!==Map2d.TILE_GREEN_LEVEL_2?bundles.merge.frames.level2_up_corner:e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_2?bundles.merge.frames.level2_up_both:e.isWater(Iso.UP_LEFT)&&e.isWater(Iso.UP_RIGHT)&&e.getGround(Iso.UP_ABOVE)===Map2d.TILE_GREEN_LEVEL_1?bundles.merge.frames.level1_up_corner:e.getGround(Iso.UP_LEFT
)===Map2d.TILE_GREEN_LEVEL_1&&e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_1?bundles.merge.frames.level1_up_both:void 0},calcBorderTypeDown:function(e){return e.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_2||e.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_1&&e.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_1?bundles.merge.frames.level1_down_both:e.isWater(Iso.DOWN_LEFT)&&e.isWater(Iso.DOWN_RIGHT)&&e.isGround(Iso.DOWN_BELOW)?bundles.merge.frames.level1_down_corner:e.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_2?bundles.merge.frames.level1_down_left_only:e.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_1?bundles.merge.frames.level1_down_left_only:e.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_2?bundles.merge.frames.level1_down_right_only:e.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_1?bundles.merge.frames.level1_down_right_only:void 0},calcBorderTypeLeft:function(e){return e.getGround(
Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_2?e.getGround(Iso.UP_ABOVE)!==Map2d.TILE_GREEN_LEVEL_2?bundles.merge.frames.level2_left_inner_last:bundles.merge.frames.level2_left_inner:e.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_1&&e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_1?e.getGround(Iso.UP_ABOVE)!==Map2d.TILE_GREEN_LEVEL_1?bundles.merge.frames.level1_left_inner_last:bundles.merge.frames.level1_left_inner:e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_2?e.isWater(Iso.UP_ABOVE)?bundles.merge.frames.level2_up_left_only_last:bundles.merge.frames.level2_up_left_only:e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_1?e.getGround(Iso.UP_ABOVE)!==Map2d.TILE_GREEN_LEVEL_1?bundles.merge.frames.level1_up_left_only_last:bundles.merge.frames.level1_up_left_only:e.isWater(Iso.DOWN_LEFT)&&e.isWater(Iso.UP_LEFT)&&e.isGround(Iso.HORIZONTAL_LEFT)?bundles.merge.frames.level1_left_corner:void 0},calcBorderTypeRight:function(e){
return e.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_2?e.getGround(Iso.UP_ABOVE)!==Map2d.TILE_GREEN_LEVEL_2?bundles.merge.frames.level2_right_inner_last:bundles.merge.frames.level2_right_inner:e.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_1&&e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_1?e.getGround(Iso.UP_ABOVE)!==Map2d.TILE_GREEN_LEVEL_1?bundles.merge.frames.level1_right_inner_last:bundles.merge.frames.level1_right_inner:e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_2?e.isWater(Iso.UP_ABOVE)?bundles.merge.frames.level2_up_right_only_last:bundles.merge.frames.level2_up_right_only:e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_1?e.isWater(Iso.UP_ABOVE)?bundles.merge.frames.level1_up_right_only_last:bundles.merge.frames.level1_up_right_only:e.isWater(Iso.DOWN_RIGHT)&&e.isWater(Iso.UP_RIGHT)&&e.isGround(Iso.HORIZONTAL_RIGHT)?bundles.merge.frames.level1_right_corner:void 0},unlockBorders:function(){
ViewReader.lockedBorders=[]},frameBorderLocksCache:{},getFrameBorderLocks:function(e){if(ViewReader.frameBorderLocksCache[e])return ViewReader.frameBorderLocksCache[e];var t=[],i=cleverapps.styles.ViewReader.borderLocks;return-1!==i.upBoth.indexOf(e)?(t.push(ViewReader.UP_LEFT_LOCK),t.push(ViewReader.UP_RIGHT_LOCK)):-1!==i.upLeft.indexOf(e)?t.push(ViewReader.UP_LEFT_LOCK):-1!==i.upLeft.indexOf(e)&&t.push(ViewReader.UP_RIGHT_LOCK),ViewReader.frameBorderLocksCache[e]=t},lockBorders:function(e){var t=ViewReader.getFrameBorderLocks(e);return 0===t.length?e:0<cleverapps.intersect(t,ViewReader.lockedBorders).length?void 0:(ViewReader.lockedBorders=ViewReader.lockedBorders.concat(t),e)},calcBorderType:function(e){ViewReader.unlockBorders();var t=ViewReader.calcBorderTypeUp(e),i=ViewReader.calcBorderTypeDown(e),s=ViewReader.calcBorderTypeLeft(e);return[t,ViewReader.calcBorderTypeRight(e),s,i].map(function(e){return ViewReader.lockBorders(e)}).filter(function(e){return void 0!==e})},
createTopYAnchorElement:function(e){if(e.height<=cleverapps.styles.Map2dView.cell.height)return e;var t=new cc.Node;return t.setContentSize(cleverapps.styles.Map2dView.cell.width,cleverapps.styles.Map2dView.cell.height),t.setAnchorPoint2(),e.setAnchorPoint2(.5,1),e.setPositionRound(t.width/2,t.height),t.addChild(e),t},parse:function(e,t){switch(e){case Map2d.TILE_GROW:return[ViewReader.createTopYAnchorElement(new cc.Sprite(ViewReader.calcGrowType(t)))];case Map2d.TILE_WATER:return[new cc.Sprite(bundles.merge.frames.water)];case Map2d.TILE_BORDER:return ViewReader.calcBorderType(t).map(function(e){return ViewReader.createTopYAnchorElement(new cc.Sprite(e))});case Map2d.TILE_GREEN_LEVEL_1:case Map2d.TILE_GREEN_LEVEL_2:var i=(t.pointer.x+t.pointer.y)%2;return[new cc.Sprite(i?bundles.merge.frames.green_ground_1:bundles.merge.frames.green_ground_2)]}return[]},UP_LEFT_LOCK:0,UP_RIGHT_LOCK:1};cleverapps.styles.ViewReader={borderLocks:{upBoth:[bundles.merge.frames.level1_up_corner,
bundles.merge.frames.level1_up_both,bundles.merge.frames.level2_up_corner,bundles.merge.frames.level2_up_both,bundles.merge.frames.level1_up_right_only,bundles.merge.frames.level1_up_left_only,bundles.merge.frames.level2_up_right_only,bundles.merge.frames.level2_up_left_only],upLeft:[bundles.merge.frames.level1_up_left_only_last,bundles.merge.frames.level2_up_left_only_last,bundles.merge.frames.level1_left_inner,bundles.merge.frames.level1_left_inner_last,bundles.merge.frames.level2_left_inner,bundles.merge.frames.level2_left_inner_last],upRight:[bundles.merge.frames.level1_up_right_only_last,bundles.merge.frames.level2_up_right_only_last,bundles.merge.frames.level1_right_inner,bundles.merge.frames.level1_right_inner_last,bundles.merge.frames.level2_right_inner,bundles.merge.frames.level2_right_inner_last]}};var Map2d=function(e){cleverapps.EventEmitter.call(this),e=e.map(function(e){return"string"==typeof e&&(e=e.split("").map(cleverapps.castType)),e});var t=this.map(e,function(e){
return e===Map2d.TILE_WATER?Map2d.TILE_WATER:void 0}),i=this.map(e,function(e){return e===Map2d.TILE_WATER?Map2d.TILE_BORDER:void 0}),s=this.map(e,function(e){return e===Map2d.TILE_WATER?void 0:e}),n=this.map(e,function(){}),o=this.map(e,function(){});this.layers=[t,i,s,n,o],this.onAdd=function(){},this.onMove=function(){},this.onFogOpen=function(){},this.pointer={x:0,y:0},this.constructGrowth()};Map2d.prototype=Object.create(cleverapps.EventEmitter.prototype),(Map2d.prototype.constructor=Map2d).TILE_WATER=0,Map2d.TILE_GREEN_LEVEL_1=1,Map2d.TILE_GREEN_LEVEL_2=2,Map2d.TILE_GROW=10,Map2d.TILE_BORDER=11,Map2d.LAYER_WATER=0,Map2d.LAYER_BORDERS=1,Map2d.LAYER_GROUND=2,Map2d.LAYER_UNITS=3,Map2d.LAYER_FOG=4;var Iso={SAME:{x:0,y:0},UP_LEFT:{y:-1,x:0},UP_RIGHT:{y:0,x:1},UP_ABOVE:{y:-1,x:1},DOWN_LEFT:{y:0,x:-1},DOWN_RIGHT:{y:1,x:0},DOWN_BELOW:{y:1,x:-1},HORIZONTAL_LEFT:{y:-1,x:-1},HORIZONTAL_RIGHT:{y:1,x:1}};Map2d.prototype.fogOpen=function(e,t){this.layers[Map2d.LAYER_FOG][t][e]=void 0,
this.onFogOpen(e,t)},Map2d.prototype.getView=function(){return this.onDiscoverView()},Map2d.prototype.setPointer=function(e,t){this.pointer.x=e,this.pointer.y=t},Map2d.prototype.map=function(e,t){return e.map(function(e){return e.map(t)})},Map2d.prototype.getGround=function(e){return this.layers[Map2d.LAYER_GROUND][this.pointer.y+e.y]&&this.layers[Map2d.LAYER_GROUND][this.pointer.y+e.y][this.pointer.x+e.x]},Map2d.prototype.setValue=function(e,t,i){this.layers[e][this.pointer.y+t.y][this.pointer.x+t.x]=i,this.trigger("setValue",e,this.pointer.x+t.x,this.pointer.y+t.y)},Map2d.prototype.add=function(e,t,i,s){this.layers[e][i][t]=s},Map2d.prototype.createFog=function(e){this.layers[Map2d.LAYER_FOG][e.y][e.x]=e},Map2d.prototype.getFog=function(e,t){return this.layers[Map2d.LAYER_FOG][t][e]},Map2d.prototype.remove=function(e,t,i){this.layers[e][i][t]=void 0},Map2d.prototype.isWater=function(e){
return this.layers[Map2d.LAYER_WATER][this.pointer.y+e.y]&&this.layers[Map2d.LAYER_WATER][this.pointer.y+e.y][this.pointer.x+e.x]===Map2d.TILE_WATER},Map2d.prototype.isGround=function(e,t){return"object"==typeof e&&e.direction&&(t=this.pointer.y+e.y,e=this.pointer.x+e.x),this.layers[Map2d.LAYER_GROUND][t]&&-1!==[Map2d.TILE_GREEN_LEVEL_1,Map2d.TILE_GREEN_LEVEL_2].indexOf(this.layers[Map2d.LAYER_GROUND][t][e])},Map2d.prototype.getUnit=function(e,t){return this.layers[Map2d.LAYER_UNITS][t][e]},Map2d.prototype.bfs=function(e,t,i){var s=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}],n=[{x:e,y:t}],o={};o[e+t*this.getWidth()]=!0;for(var a=0;a<n.length;)for(var r=n[a++],l=0;l<s.length;l++){var c=r.x+s[l].x,p=r.y+s[l].y;o[c+p*this.getWidth()]||this.isGround(c,p)&&this.getUnit(c,p)&&this.getUnit(c,p).isMergeable(i)&&(o[c+p*this.getWidth()]=!0,n.push({x:c,y:p}))}return n},Map2d.prototype.findEmptySlot=function(e,t){var i=[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0}];cleverapps.Random.shuffle(i);for(
var s=1;s<100;s++)for(var n=0;n<=s;n++)for(var o=0;o<2;o++){var a=n;if(0<o){if(0===n)continue;a=-n}for(var r=0;r<i.length;r++){var l=e+(0===i[r].x?a:i[r].x*s),c=t+(0===i[r].y?a:i[r].y*s);if(this.isGround(l,c)&&!this.getUnit(l,c))return{x:l,y:c}}}},Map2d.prototype.relocate=function(e,t){var i=this.findEmptySlot(e,t);this.layers[Map2d.LAYER_UNITS][t][e].move(i.x,i.y)},Map2d.prototype.constructGrowth=function(e,t){if(void 0!==e)this.setPointer(e,t),this.getGround(Iso.SAME)===Map2d.TILE_GREEN_LEVEL_2&&(this.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_1&&this.setValue(Map2d.LAYER_GROUND,Iso.DOWN_LEFT,Map2d.TILE_GROW),this.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_1&&this.setValue(Map2d.LAYER_GROUND,Iso.DOWN_RIGHT,Map2d.TILE_GROW),this.getGround(Iso.DOWN_BELOW)===Map2d.TILE_GREEN_LEVEL_1&&this.setValue(Map2d.LAYER_GROUND,Iso.DOWN_BELOW,Map2d.TILE_GROW));else for(t=0;t<this.getHeight();t++)for(e=0;e<this.getWidth();e++)this.constructGrowth(e,t)},
Map2d.prototype.getWidth=function(){return this.layers[Map2d.LAYER_WATER][0].length},Map2d.prototype.getHeight=function(){return this.layers[Map2d.LAYER_WATER].length},Object.keys(Iso).forEach(function(e){Iso[e].direction=!0});var Map2dView=cc.Node.extend({ctor:function(o){console.log("CREATE VIEW"),this._super();var e=(this.map2d=o).getWidth()+o.getHeight(),t=e*cleverapps.styles.Map2dView.cell.width/2,i=e*cleverapps.styles.Map2dView.cell.height/2;this.cutLeft=t*Map2dView.VISIBLE_BOX/2,this.cutTop=i*(1-Map2dView.VISIBLE_BOX)/2,this.setContentSize2(t-2*this.cutLeft,i-2*this.cutTop),this.setAnchorPoint2();for(var s=[],n=0;n<o.getHeight();n++)for(var a=0;a<o.getWidth();a++)s.push({x:a,y:n});s.sort(function(e,t){return e.y-e.x-(t.y-t.x)}),this.layerViews=o.layers.map(function(e,t){for(var i={cells:[]},s=0;s<o.getHeight();s++){i.cells.push([]);for(var n=0;n<o.getWidth();n++)i.cells[s].push(void 0)}return i},this),s.forEach(function(e){for(var t in o.layers){var i=parseInt(t),s=new cc.Node
;s.setCascadeOpacityEnabled(!0);var n=this.alignInIsometricGrid(e.x,e.y);switch(s.setPositionRound(n.x,n.y),i){case Map2d.LAYER_WATER:s.setLocalZOrder(-3);break;case Map2d.LAYER_BORDERS:s.setLocalZOrder(-2);break;case Map2d.LAYER_GROUND:s.setLocalZOrder(-1)}this.layerViews[i].cells[e.y][e.x]=s,this.addChild(s)}},this),o.layers.forEach(function(e,t){var s=this.layerViews[t].cells;e.forEach(function(e,i){e.forEach(function(e,t){o.setPointer(t,i),this.createView(e,s[i][t],o)},this)},this)},this),o.onAdd=function(e,t,i,s){this.createView(s,this.layerViews[e].cells[i][t],o)}.bind(this),o.onDiscoverView=function(){return this}.bind(this),cleverapps.config.debugMode&&cleverapps.UI.onClick(this,function(e){var t=this.getCellByCoordinates(e);if(t){o.setPointer(t.x,t.y);var i=o.getFog(t.x,t.y);console.log(t,i?"fog"+i.fogBlock.id:o.isWater(Iso.SAME)?"water":"ground"+o.getGround(Iso.SAME),o.getUnit(t.x,t.y))}}.bind(this),{swallowTouches:!1}),cleverapps.UI.onClick(this,function(){
InfoView.CloseInfo()},{swallowTouches:!1,ignoreOnTouchMoved:!0})}});Map2dView.prototype.getCellByCoordinates=function(e){var t=this.alignInIsometricGrid(0,0),i=Map2dView.ScreenToIso(e.x-t.x,e.y-t.y);return cc.p(Math.round(i.x),Math.round(i.y))},Map2dView.ScreenToIso=function(e,t){var i=e/cleverapps.styles.Map2dView.cell.width,s=t/cleverapps.styles.Map2dView.cell.height;return{x:i+s,y:i-s}},Map2dView.IsoToScreen=function(e,t){var i=(e-t)/2;return{x:(e+t)/2*cleverapps.styles.Map2dView.cell.width,y:i*cleverapps.styles.Map2dView.cell.height}},Map2dView.prototype.getCell=function(e,t,i){return this.layerViews[e].cells[i][t]},Map2dView.prototype.createView=function(e,t,i){var s=[];e instanceof FogTile?s.push(new FogTileView(e)):e instanceof Highlight?s.push(new HighlightView(e)):e instanceof Unit?s.push(new UnitView(e)):s=ViewReader.parse(e,i),s.forEach(function(e){t.addChild(e)})},Map2dView.prototype.alignInIsometricGrid=function(e,t){var i=e+t+1,s=e-t+this.map2d.getHeight();return cc.p(
i*cleverapps.styles.Map2dView.cell.width/2-this.cutLeft,s*cleverapps.styles.Map2dView.cell.height/2-this.cutTop)},Map2dView.VISIBLE_BOX=.5,cleverapps.styles.Map2dView={cell:{width:172,height:98}},cleverapps.ServerFlags=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SERVER_FLAGS);this.flags=e||[]},cleverapps.ServerFlags.prototype.reset=function(){this.flags=[],this.save()},cleverapps.ServerFlags.prototype.hasFlag=function(e){return 0<=this.flags.indexOf(e)},cleverapps.ServerFlags.prototype.setFlag=function(e){this.hasFlag(e)||(this.flags.push(e),this.save())},cleverapps.ServerFlags.prototype.getInfo=function(){return this.flags},cleverapps.ServerFlags.prototype.updateInfo=function(e,t){this.flags=e,this.save(t)},cleverapps.ServerFlags.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SERVER_FLAGS,this.flags),e||cleverapps.synchronizer.addUpdateTask("serverflags")},cleverapps.ServerFlags.PAGE_LIKED=2,cleverapps.ServerFlags.PAYER=3
;var levels={reset:function(){levels.episodes.reset(),levels.episodes.setCurrentEpisode(levels.user.episode),levels.tutorial&&levels.tutorial.stop(),cleverapps.social.isLoggedIn()?cleverapps.SocialManager.onLogin():cleverapps.synchronizer.syncWhenReady()},initUser:function(){var e=!1===cleverapps.DataLoader.haveSavedData();return e&&(console.log("Creating new user"),cleverapps.synchronizer.reset()),cleverapps.user=levels.user=new levels.User(e),e},initialize:function(){cleverapps.rewardedAdsManager.init(),cleverapps.LocalizationManager.run(),cleverapps.localPushes.init(),levels.progress.init(),cleverapps.isLevels()&&levels.episodes.setCurrentEpisode(cleverapps.user.episode),UIScrollBarFix(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.APP_INITIALIZE),cleverapps.Shaders.initialize(),cleverapps.wideMode=new cleverapps.WideMode,cleverapps.config.debugMode&&-1===["mergecraft","wondermerge","spades","wordheaps","mergeriddles","mergeheroes"].indexOf(cleverapps.config.name)&&(
cleverapps.administrator=new Administrator,cleverapps.administrator.run()),cleverapps.flags.update(),cleverapps.placements=new Placements,cc.renderer.assignedZStep=1e-4},User:function(e){this.onLevelStatusChanged=function(e,t){},cleverapps.User.call(this,e)}};levels.User.prototype=Object.create(cleverapps.User.prototype),levels.User.prototype.constructor=levels.User,levels.User.prototype.getProgress=function(){return cleverapps.humanReadableNumber(this.episode,this.level)-1},levels.User.prototype.loadData=function(e){cleverapps.User.prototype.loadData.call(this,e),this.episode=e.episode,this.level=e.level,this.league=this.calcLeague(),this.progress=e.progress||0,e.uniqueStartEvent&&(this.uniqueStartEvent=e.uniqueStartEvent),this.calcRating(),this.calcExp()},levels.User.prototype.calcRating=function(){var e=this.calcLeague();this.league!==e&&(this.league=e,this.onLeagueChangeListener()),this.save()},levels.User.prototype.calcExp=function(){void 0===this.exp&&this.setExp(
this.getProgress())},levels.User.prototype.isUniqueStart=function(e,t,i){var s=e+"_"+t+"_"+i;return this.uniqueStartEvent!==s&&(this.uniqueStartEvent=s,this.save(!1),!0)},levels.User.prototype.getPassAllProgress=function(){return this.progress},levels.User.prototype.isCurrentLevel=function(e,t){if(cleverapps.metha.getType()!==Metha.HOSE)return!0;var i=this.getCurrentLevel();return i.levelNo===e&&i.episodeNo===t},levels.User.prototype.isPassedLevel=function(e,t){return cleverapps.metha.getType()===Metha.HOSE&&(this.episode>t||this.episode===t&&this.level>e)},levels.User.prototype.getHumanReadableNumber=function(){return cleverapps.humanReadableNumber(this.episode,this.level)},levels.User.prototype.checkAvailable=function(e){var t=cc.game.config.projectName;if(e[t])return this.checkAvailable(e[t]);var i=cleverapps.User.calcSource();return e[i]?this.checkAvailable(e[i]):!(e.registered&&this.registered+cleverapps.parseInterval(e.registered)>Date.now())&&((
!cleverapps.flags.nosocial||!e.social)&&(!e.disabled&&(!(e.debugMode&&!cleverapps.config.debugMode)&&(void 0===e.level&&(e.level=0),void 0===e.episode&&(e.episode=0),(!e.projectName||(Array.isArray(e.projectName)||(e.projectName=[e.projectName]),-1!==e.projectName.indexOf(t)))&&((!e.source||(Array.isArray(e.source)||(e.source=[e.source]),-1!==e.source.indexOf(i)))&&((!e.language||cleverapps.settings.language===e.language)&&((!e.payments||!cleverapps.flags.nopayments)&&(this.episode>e.episode||this.level>=e.level&&this.episode===e.episode))))))))},levels.User.prototype.sendLevelPassedEvents=function(){var e=[1,3,5],i=this.getDaysSinceRegistration(),s=this.getHumanReadableNumber();[50,100,200].forEach(function(t){t+1===s&&e.forEach(function(e){i<e&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_PASS_EVENT+"_"+t+"_"+e)},this)},this)},levels.User.prototype.isPassedAll=function(){return this.episode>=levels.episodes.getAmountEpisodes()},levels.User.prototype.incLevel=function(){if(
this.isPassedAll())return this.progress++,this.trigger("incLevel"),void this.save();var e=this.level,t=this.episode;levels.episodes.currentLevel=void 0,this.level++,this.level===Episode.LEVELS_PER_EPISODE&&(this.level=0,this.incEpisode()),this.trigger("incLevel"),this.calcRating(),this.save(),this.sendLevelPassedEvents(),this.onLevelStatusChanged(t,e),this.onLevelStatusChanged(this.episode,this.level),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.ACHIEVED_LEVEL),cleverapps.User.reportRetention&&cleverapps.User.reportRetention()},levels.User.prototype.incEpisode=function(){this.episode++,this.calcRating(),this.save(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_UP),cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.FINISH_EPISODE)},levels.User.prototype.getPhysicalLevel=function(){return this.getHumanReadableNumber()},levels.User.prototype.getCurrentLevel=function(){return this.isPassedAll()?Episode.LevelChooseAlgorithm({start:5,seed:this.progress}):{
episodeNo:this.episode,levelNo:this.level}},levels.User.prototype.getVirtualLevel=function(){return this.getHumanReadableNumber()+this.progress},levels.User.prototype.setId=function(e){this.reportChannel&&this.reportChannel(),this.id=e,delete this.idfa,this.save(!1)},levels.User.prototype.getSaveInfo=function(){var e=cleverapps.User.prototype.getSaveInfo.call(this);return cleverapps.extend(e,{episode:this.episode,level:this.level,uniqueStartEvent:this.uniqueStartEvent,progress:this.progress})},levels.User.prototype.initializeNewPlayer=function(){cleverapps.User.prototype.initializeNewPlayer.call(this),this.episode=0,this.level=0,this.progress=0},levels.User.GOLD_FB_CONNECT_REWARD=100;var VersionChecker=function(){this.serverVersion=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SERVER_VERSION,{raw:!0}),this.clientVersion=void 0};VersionChecker.prototype.check=function(){cleverapps.RestClient.get("/",{},function(e){this.serverVersion=e,cleverapps.DataLoader.save(
cleverapps.DataLoaderTypes.SERVER_VERSION,e,{raw:!0})}.bind(this),function(){console.log("Error getting server version in VersionChecker!")}.bind(this))},VersionChecker.prototype.needUpdate=function(){return!!this.serverVersion&&parseInt(cc.game.config.version)<parseInt(this.serverVersion)},VersionChecker.prototype.isNewClientVersionAvailable=function(){return this.clientVersion&&this.clientVersion!==cc.game.config.version},VersionChecker.prototype.isClientVersionActual=function(){return this.clientVersion&&this.clientVersion===cc.game.config.version},VersionChecker.prototype.loadClientVersion=function(t){if(t=t||function(){},cc.sys.isNative||cleverapps.isLocalhost()||-1!==["instant","plinga","huzcom"].indexOf(cleverapps.User.calcSource()))return this.clientVersion=cc.game.config.version,void t();var e=cleverapps.config.deployment+window.location.pathname,i=e.lastIndexOf("/");e=e.substr(0,i+1)+"version.json";var s=function(e){console.log("loaded current client version - "+e.version),
this.clientVersion=e.version,t()}.bind(this);cleverapps.RestClient.get(e,{},s,function(){console.log("error loading client version from path - "+e),t()})},levels.FPS={run:function(e,t){levels.FPS.fpsInterval||(levels.FPS.episode=e,levels.FPS.level=t,levels.FPS.fpsStatistics=[],levels.FPS.fpsTotalFrames=cc.director.getTotalFrames(),levels.FPS.fpsInterval=setInterval(function(){if(levels.FPS.fpsStatistics.length<levels.FPS.FPS_STATISTICS_MAX_LENGTH){var e=cc.director.getTotalFrames(),t=Math.round(1e3*(e-levels.FPS.fpsTotalFrames)/levels.FPS.FPS_STATISTICS_INTERVAL);60<t&&(t=60),levels.FPS.fpsStatistics.push(t),levels.FPS.fpsTotalFrames=e}else levels.FPS.stop()},levels.FPS.FPS_STATISTICS_INTERVAL))},stop:function(){if(levels.FPS.fpsInterval&&(clearInterval(levels.FPS.fpsInterval),levels.FPS.fpsInterval=!1),levels.FPS.fpsStatistics&&levels.FPS.fpsStatistics.length){levels.FPS.fpsStatistics.sort();var e=levels.FPS.fpsStatistics[Math.floor(
levels.FPS.fpsStatistics.length*levels.FPS.FPS_STATISTICS_PERCENT_VALUE)];console.log("SAVE FPS: "+e),cc.sys.os!==cc.sys.OS_IOS&&void 0===cleverapps.settings.fpsMode&&(e<=levels.FPS.FPS_SWITCH_TO_LOW?(console.log("Auto switch to low fps mode!"),cleverapps.settings.setFpsMode(cleverapps.Settings.FPS_MODE_LOW)):(console.log("Auto switch to high fps mode!"),cleverapps.settings.setFpsMode(cleverapps.Settings.FPS_MODE_HIGH))),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_FPS,{episode:levels.FPS.episode,level:levels.FPS.level,fps:e}),levels.FPS.fpsStatistics=!1}}},levels.FPS.FPS_STATISTICS_MAX_LENGTH=15,levels.FPS.FPS_STATISTICS_PERCENT_VALUE=.1,levels.FPS.FPS_STATISTICS_INTERVAL=500,levels.FPS.FPS_SWITCH_TO_LOW=40;var NewVersionWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.NewVersionWindow,t=new cc.Node;t.setAnchorPoint(.5,.5),t.setContentSize(e.width,e.height);var i=cleverapps.UI.generateTTFText("messages:NewVersionWindow.text1",
cleverapps.styles.FONTS.WINDOW_TEXT,{version:cleverapps.versionChecker.serverVersion,title:Messages.get(cleverapps.config.title)});i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setDimensions(cc.size(e.width+50,0)),i.setPosition(t.width/2,t.height/2+30),t.addChild(i),(i=cleverapps.UI.generateTTFText("messages:NewVersionWindow.text2",cleverapps.styles.FONTS.WINDOW_TEXT)).setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setDimensions(cc.size(e.width+50,0)),i.setPosition(t.width/2,t.height/2-100),t.addChild(i),this._super({title:"messages:NewVersionWindow.Title",name:"newversionwindow",content:t,button:{text:Messages.get("OK"),onPressed:function(){var e=cleverapps.config[levels.user.source]||cleverapps.config.facebook;cc.sys.openURL(e.url)},width:e.width/2},closeButton:!1})},close:function(){}});cleverapps.styles.NewVersionWindow={width:500,height:300};var WaitWindow=Window.extend({onWindowLoaded:function(e){this.message=e,void 0===this.message&&(this.message=Messages.get(
"Loading")||"Loading");var t=this.showLoading(this.message);t.setCascadeOpacityEnabled(!0),t.setOpacity(0),t.setVisible(!1);var i=cleverapps.styles.WaitWindow;this._super({name:"waitwindow",noBackground:!0,content:t,closeButton:!1,styles:i,notCloseByTouchInShadow:!0}),t.runAction(new cc.Sequence(new cc.DelayTime(i.delay),new cc.CallFunc(function(){t.setVisible(!0)}),new cc.FadeTo(.3,255))),this.hints=[]},showLoading:function(e,t){t=t||{};var i=cleverapps.styles.WaitWindow,s=new cc.Node;s.setAnchorPoint(.5,.5),s.setContentSize(i.width,i.height);var n=this.loadingAnimation=new cleverapps.Spine(res.loading_json,1.5);n.setPosition(cc.p(i.width/2,i.height/2+i.animation.y)),s.addChild(n);var o=t.font?t.font:i.textFont;if(i.text){var a=t.textOffsetY?t.textOffsetY:i.text.y;this.loadingText=cleverapps.UI.generateTTFText(e,o),this.loadingText.setDimensions(i.width,0),this.loadingText.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.loadingText.setPosition(i.width/2,i.height/2+a),s.addChild(
this.loadingText)}return n.setAnimation(0,"idle",!0),s},showHint:function(e){this.loadingText&&(this.loadingText.setString(e),this.hints.push(e))},removeHint:function(e){if(this.loadingText){var t=this.hints.indexOf(e);0<=t&&this.hints.splice(t,1),e=0<this.hints.length?this.hints[this.hints.length-1]:"",this.loadingText.setString(e)}},closeByBackButton:function(){},popUpAnimation:function(){},closeAnimation:function(e){e()}});cleverapps.styles.WaitWindow=cleverapps.overrideStyles(cleverapps.styles.Window,{delay:.2,width:300,height:200,animation:{y:-60},text:{y:-100},textFont:cleverapps.styles.FONTS.WAIT_WINDOW_TEXT},!0);var StartEpisodeWindow=Window.extend({onWindowLoaded:function(e){this.episode=e,this._super({title:"messages:StartEpisodeWindow.Title"+levels.episodes.currentEpisode,name:"startepisodewindow",content:this.getContent(),closeButton:!1,button:{width:cleverapps.styles.StartEpisodeWindow.button.width,height:cleverapps.styles.StartEpisodeWindow.button.height,
text:Messages.get("OK"),onPressed:this.close.bind(this)}}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},getContent:function(){var e=cleverapps.styles.StartEpisodeWindow,t=new cleverapps.Spine(bundles.main.jsons.yellow_hi_spine_json);t.setAnimation(0,"animation",!0);var i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(e.animation),i.addChild(t),t.setPositionRound(i.width/2,i.height/2);var s=cleverapps.UI.generateTTFText("messages:StartEpisodeWindow.Text"+this.episode.episodeNo,cleverapps.styles.FONTS.WINDOW_TEXT);s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var n,o,a,r=[i,s];return cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?(a=e.phoneMargin,n=cleverapps.UI.VERTICAL,o=e.text.phoneWidth,r.reverse()):(a=e.margin,n=cleverapps.UI.HORIZONTAL,o=e.text.width),s.setDimensions(o,0),new cleverapps.Layout(r,{direction:n,margin:a,padding:e.padding})}});cleverapps.styles.StartEpisodeWindow={animation:{width:300,height:300},phoneMargin:20,margin:40,text:{
phoneWidth:600,width:400},padding:{x:0,y:40},button:{width:250,height:100}};var StuckPlayerView=cc.Node.extend({ctor:function(e){this._super();var t=cleverapps.styles.StuckPlayerView,i=new cleverapps.UI.Avatar(e);this.addChild(i);var s=cleverapps.humanReadableNumber(e.episode,e.level),n=cleverapps.UI.generateTTFText("messages:StuckWindow.player.text",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,{level:s});n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setDimensions(t.text.width,0),n.y=t.text.y,this.addChild(n),cleverapps.UI.wrap(this)}});cleverapps.styles.StuckPlayerView={text:{width:195,y:-120}};var StuckWindow=Window.extend({onWindowLoaded:function(e){var t,i=cleverapps.styles.StuckWindow;i.animation&&(t=new cleverapps.Spine(i.animation)).setAnimation(0,"animation",!0);var s=new cc.Node;e.forEach(function(e){s.addChild(new StuckPlayerView(e))}),cleverapps.UI.arrangeWithMargins(s.children,{direction:cleverapps.UI.HORIZONTAL,margin:i.players.margin}),cleverapps.UI.wrap(s),
s.setAnchorPoint2();var n=cleverapps.UI.generateTTFText("messages:StuckWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT);n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setDimensions(i.text.width,0);var o=new cc.Node;o.addChild(s),o.addChild(n),t&&o.addChild(t),cleverapps.UI.arrangeWithMargins(o.children,{margin:i.margin}),cleverapps.UI.wrap(o),o.setAnchorPoint2(),o=cleverapps.UI.wrapWithPadding(o,i.padding),this._super({title:"messages:StuckWindow.title",name:"stuckwindow",minWidth:i.minWidth,content:o,button:{width:i.button.width,height:i.button.height,content:cleverapps.UI.generateTTFText("messages:StuckWindow.button.text",cleverapps.styles.FONTS.BUTTON_TEXT),onPressed:function(){levels.progress.sendStuckFriendsHelp(e,function(){this.closed||this.close()}.bind(this))}.bind(this)}}),cleverapps.audio.playSound(res.window_effect)},listBundles:function(){return["game"]},load:function(e,t,i){e=cleverapps.wait(2,e),this._super(e,t,i),cleverapps.UI.Avatar.preload(i,
cleverapps.waitNoMore(5e3,e))}});StuckWindow.displayIfNeeded=function(){var t=levels.progress.getStuckFriends();0<t.length&&!cleverapps.flags.noviral&&cleverapps.metha.display({focus:"StuckWindow",action:function(e){new StuckWindow(t),cleverapps.metha.onceNoWindowsListener=e}})},cleverapps.styles.StuckWindow={minWidth:600,margin:50,padding:{x:0,y:60},players:{margin:60},text:{width:650},animation:bundles.game.jsons.send_help_spine_json,button:{width:380,height:110}};var FinishEpisodeWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.Window,!0),cleverapps.styles.FinishEpisodeWindow);this.episode=e.episode;var i=this.content=new cc.Node,s="messages:FinishEpisodeWindow.Text"+this.episode.episodeNo;Messages.has(s)||(s="messages:FinishEpisodeWindow.Text");var n=this.text=cleverapps.UI.generateTTFText(s,cleverapps.styles.FinishEpisodeWindow.font);if(n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setDimensions(t.width,0),
i.addChild(n),t.animation){var o=new cleverapps.Spine(t.animation.json);o.setAnimation(0,"animation",!0),i.setLocalZOrder(10),i.addChild(o)}else if(t.image){var a=this.findProperBundle(this.episode),r=new cc.Sprite(bundles[a].urls.episode_finish_image);i.addChild(r),r.setPosition(i.width/2,t.image.y)}if(cleverapps.UI.arrangeWithMargins(i.children,{margin:t.margin,x:t.width/2,y:t.padding.y}),t.text.bg){var l=new cc.Scale9Sprite(t.text.bg.image);l.setContentSize2(n.width+2*t.text.bg.padding.x,n.height+2*t.text.bg.padding.y),this.content.addChild(l),l.setPositionRound(n.getPosition()),l.setLocalZOrder(n.getLocalZOrder()-1)}cleverapps.UI.wrap(i),i.setAnchorPoint2(),this._super({title:"messages:FinishEpisodeWindow.Title",name:"finishepisodewindow",content:i,closeButton:!0,noBackground:t.noBackground,button:{width:t.Button.width,height:t.Button.height,text:Messages.get("OK"),onPressed:this.close.bind(this),bottomPadding:t.BottomButton.bottomPadding},buttons:this.getButtons(),
shareCheckBox:this.getShareOptions(),styles:t})},onShow:function(){this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){this.visible&&cleverapps.audio.playSound(bundles.game.urls.win_effect)}.bind(this))))},getButtons:function(){var e=[],t=ShareBonusButton.create(this.getShareOptions());return t&&e.push(t),e},getShareOptions:function(){return{shareBonus:cleverapps.ShareBonus.SHARES.finishEpisode,shareId:cleverapps.ShareBonus.SHARES.finishEpisode.id,toReplace:{episodeTitle:this.episode.getBundle().title||this.episode.episodeNo+1}}},findProperBundle:function(e){if(!cleverapps.styles.FinishEpisodeWindow.animation){for(var t=[],i=0;i<10;i++){var s="finish_episode_"+i,n=s+"_"+cleverapps.settings.language;if(bundles[n])t.push(n);else{if(!bundles[s])break;t.push(s)}}return t[e.episodeNo%t.length]}},listBundles:function(e){var t=["finish_episode_window"],i=this.findProperBundle(e.episode);return i&&t.push(i),t}});cleverapps.styles.FinishEpisodeWindow={width:600,
height:740,text:{y:165,Dimensions:{y:300}},margin:80,padding:{y:50},image:{y:500,width:700},Button:{width:280,height:110},font:cleverapps.styles.FONTS.WINDOW_TEXT};var HelpFromFriendsWindow=Window.extend({onWindowLoaded:function(e,t){var i=this.styles=cleverapps.styles.HelpFromFriendsWindow;i[e.type]&&(i=cleverapps.overrideStyles(cleverapps.clone(i,!0),i[e.type]));var s=i.height,n=i.width,o=new cc.Node;o.setAnchorPoint(.5,.5);var a=new cc.Node;e.buy?a.setContentSize2(i.container.buy):a.setContentSize2(i.container);var r=new cleverapps.Spine(bundles.help_from_friends.jsons.help_from_friends_json);r.setSkin(cc.game.config.projectName),r.setAnimation(0,e.type,!0),a.addChild(r),e.buy?r.setPositionRound(i.animation.buy):r.setPositionRound(i.animation),o.addChild(a),o.setContentSize2(n,s);var l=cleverapps.UI.generateTTFText("messages:helpFromFriends."+e.type+".text",i.text.font,{amount:e.amount});l.setDimensions(n,0),l.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),l.setVerticalAlignment(
cc.VERTICAL_TEXT_ALIGNMENT_CENTER),o.addChild(l);var c=cleverapps.UI.arrangeWithMargins([l,a],{direction:cleverapps.UI.VERTICAL,margin:i.margin.y,x:i.width/2,y:i.margin.bottom});o.setContentSize2(i.width,c+i.margin.top);var p,d=e.amount,h=function(){cleverapps.audio.playSound(res.shop_buy_effect),this.closeAnimationCallbacks.push(function(){t(p,e)}),this.close(),e.event&&cleverapps.eventLogger.logEvent(e.event)}.bind(this);if(e.buy){var u=i.animation.buy.person,v=new cleverapps.Spine(u.json,u.scale);v.setAnimation(0,u.animation,!0),a.addChild(v),v.setPositionRound(u),p=new cleverapps.UI.Button({width:i.button.buy.width,height:i.button.buy.height,content:this.getBuyButtonContent(e.price),onClicked:function(){levels.user.takeGold(e.price)&&h()}})}else p=new BonusButton({styles:i.button,reward:d,rewardIcon:e.icon,text:"messages:helpFromFriends."+e.type+".Button.text",onClick:function(){if(e.request)cleverapps.social.inviteRandomFriends(h,"helpInviteFriends");else if(e.video){if(
!cleverapps.rewardedAdsManager.isAvailable())return void cleverapps.Notification.create("messages:AdsUnavailable");cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,this.createListener(h))}}.bind(this)});this._super({title:"messages:helpFromFriends."+e.type+".title",name:"helpfromfriendswindow",content:o}),p.setPositionRound(this.window.width/2,p.height/2+i.button.Margin.y),this.window.addChild(p);var g=bundles.help_from_friends.urls["window_effect_"+e.type]||bundles.main.urls.window_effect;cleverapps.audio.playSound(g)},getBuyButtonContent:function(e){var t=cleverapps.styles.HelpFromFriendsWindow.button.buy,i=new cc.Node;i.setAnchorPoint(.5,.5);var s=new cc.Sprite(bundles.menubar.frames.coin_png);s.setScale(t.coin.scale),i.addChild(s);e=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.BUTTON_TEXT);return i.addChild(e),cleverapps.UI.arrangeWithMargins(i.getChildren(),{direction:cleverapps.UI.HORIZONTAL,margin:t.buyMargin}),cleverapps.UI.wrap(i),i}})
;HelpFromFriendsWindow.isAvailable=function(e){if(!cleverapps.user.checkAvailable(HelpFromFriendsWindow.AVAILABLE))return!1;if(e.buy&&!levels.user.canTakeGold(e.price))return!1;if(e.video&&!cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED))return!1;var t=HelpFromFriendsWindow.load()[e.storageKey||e.type]||0;return Date.now()-t>cleverapps.parseInterval(e.interval)},HelpFromFriendsWindow.chooseMovesHelp=function(){var e=.12;if(config.debugMode&&(e=5),Math.random()>e)return!1;var t=[HelpFromFriendsWindow.TYPES.addmoves,HelpFromFriendsWindow.TYPES.addmovesvideo].filter(function(e){return HelpFromFriendsWindow.isAvailable(e)});return 0!==t.length&&cleverapps.Random.choose(t)},HelpFromFriendsWindow.showIfCanMoves=function(t){var i=HelpFromFriendsWindow.chooseMovesHelp();i&&cleverapps.metha.display({focus:"HelpFromFriendsWindow.moves",action:function(e){HelpFromFriendsWindow.create(i,t),cleverapps.metha.onceNoWindowsListener=e}})},HelpFromFriendsWindow.showIfCan=function(
e,t){HelpFromFriendsWindow.isAvailable(e)&&HelpFromFriendsWindow.create(e,t)},HelpFromFriendsWindow.create=function(t,i){var e=HelpFromFriendsWindow.load();e[t.storageKey||t.type]=Date.now(),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.HELP_FROM_FRIENDS,e),config.debugMode&&(HelpFromFriendsWindow.TYPES.addmoves.interval="1 minute",HelpFromFriendsWindow.TYPES.addlivesvideo.interval="1 minute",HelpFromFriendsWindow.TYPES.addcoinsvideo.interval="1 minute"),cleverapps.flags.reduceAds&&t.amountReduced&&(t.amount=t.amountReduced),cleverapps.eventLogger.logEvent(t.show),new HelpFromFriendsWindow(t,function(e){i&&i(e,t),t.success.forEach(function(e){cleverapps.eventLogger.logEvent(e)})})},HelpFromFriendsWindow.load=function(){return cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.HELP_FROM_FRIENDS)||{}},HelpFromFriendsWindow.TYPES={showhint:{type:"showhint",interval:"1 day",amount:1,request:!0,icon:!1,success:[cleverapps.EVENTS.HINT_FOR_INVITE_SUCCESS],
show:cleverapps.EVENTS.HINT_FOR_INVITE_SHOW},addmoves:{type:"addmoves",storageKey:"addmoves",interval:"1 hour",amount:3,buy:!0,price:50,icon:"#main-moves_icon.png",success:[cleverapps.EVENTS.MOVES_FOR_BUY_SUCCESS],show:cleverapps.EVENTS.MOVES_FOR_BUY_SHOW},addmovesvideo:{type:"addmovesvideo",storageKey:"addmoves",interval:"1 hour",amount:3,video:!0,icon:"#main-moves_icon.png",success:[cleverapps.EVENTS.MOVES_FOR_VIDEO_SUCCESS,cleverapps.EVENTS.REWARDED_ADD_MOVES],show:cleverapps.EVENTS.MOVES_FOR_VIDEO_SHOW},addlivesvideo:{type:"addlivesvideo",interval:"30 minutes",amount:1,video:!0,icon:bundles.main.frames.accept_life_icon,success:[cleverapps.EVENTS.LIVES_FOR_VIDEO_SUCCESS,cleverapps.EVENTS.REWARDED_ADD_LIVES],show:cleverapps.EVENTS.LIVES_FOR_VIDEO_SHOW},addcoinsvideo:{type:"addcoinsvideo",interval:"30 minutes",amount:30,amountReduced:10,video:!0,success:[cleverapps.EVENTS.COINS_FOR_VIDEO_SUCCESS,cleverapps.EVENTS.REWARDED_ADD_COINS],show:cleverapps.EVENTS.COINS_FOR_VIDEO_SHOW}},
HelpFromFriendsWindow.ADD_MOVES_CLEAR_INTERVAL="30 minutes",HelpFromFriendsWindow.AVAILABLE={episode:0,level:9},HelpFromFriendsWindow.prototype.listBundles=function(){return["help_from_friends"]},cleverapps.styles.HelpFromFriendsWindow={text:{font:cleverapps.styles.FONTS.WINDOW_TEXT,y:110,dimension:{y:150}},container:{width:200,height:180,buy:{width:200,height:280}},animation:{buy:{x:240,y:110,person:{x:-60,y:110,scale:.8,json:bundles.dialogues.jsons.default_json,animation:"animation"}},x:100,y:80},width:620,y:70,margin:{bottom:70,y:30,top:60},button:{width:320,height:120,buy:{width:260,height:100,buyMargin:20,coin:{scale:1}},Text:{font:cleverapps.styles.FONTS.BUTTON_TEXT,offsetX:0,offsetY:18},RewardText:{font:cleverapps.styles.FONTS.SHARE_BUTTON_REWARD_TEXT,offsetX:-18,offsetY:-24},RewardCoins:{scale:.5,offsetX:20,offsetY:-24},Margin:{y:50}}};var BeatFriendView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint(.5,.5);var t=new cleverapps.UI.Avatar(e);this.addChild(t),
this.avatar=t,this.setContentSize(t.width*t.scale,t.height*t.scale),t.setPositionRound(this.width/2,t.height/2);var i=new cc.Sprite(res.levelstart_cup_1);i.setPositionRound(this.avatar.width+cleverapps.styles.BeatFriendView.Cup.Margin.x,this.avatar.y),i.setLocalZOrder(1),this.addChild(i),this.cup=i}});cleverapps.styles.BeatFriendView={Cup:{Margin:{x:10}}};var BeatFriendWindow=Window.extend({onWindowLoaded:function(e,t){this.friendId=e,this.friend=cleverapps.friends.getById(e),this.level=t,cleverapps.social.sendActivity&&cleverapps.social.sendActivity(cleverapps.Social.ACTIVITY.PASSED_FRIEND,{userName:cleverapps.friends.getPlayer().name,friendName:this.friend.name});var i=cleverapps.styles.BeatFriendWindow,s=new cc.Node;s.setAnchorPoint(.5,.5),s.setContentSize(i.width,i.height),this.content=s;var n=cleverapps.UI.generateTTFText("messages:LevelFriendBeatWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT,{friendName:this.friend.name});n.setDimensions(i.Text.width,0),n.setPositionRound(
s.width/2,s.height-n.height/2+i.Text.Margin.y),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.content.addChild(n);var o=new cc.Sprite(bundles.beatfriendwindow.frames.beat_friend_bg_png);o.setScale(i.bg.scale),o.setPositionRound(s.width/2+i.bg.offsetX,o.height*o.scale/2+i.bg.offsetY),s.addChild(o),this.bg=o,this.addAvatars(),this._super({title:"messages:LevelFriendBeatWindow.title",name:"beatfriendwindow",content:s,buttons:this.listButtons()}),cleverapps.audio.playSound(res.window_effect),this.customize()},customize:function(){},addAvatars:function(){var e=this.content,t=new BeatFriendView(cleverapps.friends.getById(this.friendId)),i=new BeatFriendView(cleverapps.friends.getPlayer());e.addChild(t),e.addChild(i);var s=cleverapps.styles.BeatFriendWindow;t.setPositionRound(e.width/2+s.Animation.Friend.Margin.x,this.bg.y+s.Animation.Friend.Margin.y),t.originalPosition=t.getPosition(),i.setPositionRound(e.width/2+s.Animation.User.Margin.x,this.bg.y+s.Animation.User.Margin.y),
i.originalPosition=i.getPosition(),this.friend=t,this.user=i},onShow:function(){var a=this.user;a.stopAllActions(),a.setPositionRound(this.user.originalPosition),a.scale=1,a.cup.opacity=0,a.cup.scale=0;var e=cleverapps.styles.BeatFriendWindow.Animation;[cc.pRound(e.User.MoveBy[0].x,e.User.MoveBy[0].y),cc.pRound(e.User.MoveBy[1].x,e.User.MoveBy[1].y),cc.pRound(e.User.MoveBy[2].x,e.User.MoveBy[2].y)].forEach(function(e,t){a.runAction(new cc.Sequence(new cc.DelayTime(.4*t*1.5+.2),new cc.CallFunc(function(e,t){var i=a.getPosition(),s=cc.pRound(i.x+e.x,i.y+e.y),n=cc.pRound((i.x+2*s.x)/3,(i.y+2*s.y)/3+e.x*(t?1.2:2)),o=cc.pRound((i.x+n.x)/2,(i.y+n.y)/2);a.runAction(new cc.Spawn(new cc.BezierTo(1.5*(t?.5:.4),[o,n,s])))}.bind(this,e,2===t))))}),a.runAction(new cc.Sequence(new cc.DelayTime(1.2*1.5+.2),new cc.ScaleTo(.3*1.5,1.4).easing(cc.easeBackOut()),new cc.CallFunc(function(){a.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.5,1.45),new cc.ScaleTo(.5,1.4))))}))),
a.cup.runAction(new cc.Sequence(new cc.DelayTime(2.3),new cc.Spawn(new cc.ScaleTo(.3*1.5,1).easing(cc.easeBackOut()),new cc.FadeIn(.3*1.5))));var t=void 0===BeatFriendWindow.SOUND_DELAY?2.3:BeatFriendWindow.SOUND_DELAY;this.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.main.urls.beat_friend_effect)})));var i=this.friend;i.stopAllActions(),i.setPositionRound(i.originalPosition),i.scale=1.4,i.cup.visible=!1,i.runAction(new cc.Sequence(new cc.DelayTime(1.7),new cc.Spawn(new cc.ScaleTo(.3*1.5,1),new cc.MoveBy(.3*1.5,cc.pRound(e.Friend.MoveBy.x,e.Friend.MoveBy.y)))))},onHide:function(){this.user&&(this.user.stopAllActions(),this.user.cup&&this.user.cup.stopAllActions()),this.friend&&this.friend.stopAllActions()},listButtons:function(){if(this.level.isRegular()){var e=ShareBonusButton.create({shareBonus:cleverapps.ShareBonus.SHARES.beatFriend,toReplace:{levelNo:levels.user.getProgress(),friendId:this.friendId},callback:function(){
this.close()}.bind(this)});if(e)return[e]}var t=cleverapps.styles.BeatFriendWindow;return[new BottomButton(this,{width:t.Button.width,height:t.Button.height,text:Messages.get("OK"),onPressed:this.close.bind(this)})]}});BeatFriendWindow.prototype.listBundles=function(){return["beatfriendwindow"]},BeatFriendWindow.AVAILABLE={episode:0,level:5},cleverapps.styles.BeatFriendWindow={width:600,height:600,bg:{offsetX:0,offsetY:80,scale:2},Button:{width:280,height:110,Margin:{x:26}},Animation:{User:{MoveBy:{0:{x:25,y:10},1:{x:35,y:10},2:{x:230,y:20}},Margin:{x:-200,y:-50}},Friend:{MoveBy:{x:-40,y:-20},Margin:{x:-50,y:-40}}},Text:{Margin:{y:-80},width:500},share:{}};var FinisherWindow=Window.extend({onWindowLoaded:function(){var e=this.generateContent();this._super({title:"messages:FinisherWindow.title",name:"finisherwindow",content:e,button:{width:cleverapps.styles.FinisherWindow.Button.width,height:cleverapps.styles.FinisherWindow.Button.height,text:Messages.get("FinisherWindow.Button.text"),
onPressed:function(){cc.sys.openURL(cleverapps.bySource(cleverapps.config.helpURL))}}}),cleverapps.audio.playSound(bundles.game.urls.win_effect),this.addChild(new Fireworks)},generateContent:function(){var e=cleverapps.styles.FinisherWindow,t=new cc.Node;t.setAnchorPoint(.5,.5),this.content=t;var i=function(e){var t={android:bundles.store_links.urls.android_png,ios:bundles.store_links.urls.ios_png,amazon:bundles.store_links.urls.amazon_png}[e],i=cleverapps.config[e]&&cleverapps.config[e].url;if(i&&t){var s=new cc.Sprite(t);return cleverapps.UI.applyHover(s),cleverapps.UI.onClick(s,function(){cc.sys.openURL(i)}),s}};this.addText("messages:FinisherWindow.GroupText");var s=cleverapps.User.calcSource();if(cc.sys.isNative||cleverapps.isInstant()||-1!==["mobile_ok","web_ok","mobile_vk","web_vk","web_mm","mobile_mm"].indexOf(s)){var n=i(s);n&&this.addButtons([n]),this.addText("messages:FinisherWindow.AllAndStoreText")}else{var o=["android","ios","amazon"].map(i).filter(function(e){
return void 0!==e});0<o.length&&(this.addButtons(o.slice(0,2)),this.addText("messages:FinisherWindow.StoreText")),this.addText("messages:FinisherWindow.AllPassedText")}return cleverapps.UI.arrangeWithMargins(t.getChildren(),{direction:cleverapps.UI.VERTICAL,margin:e.Text.margin,y:e.bottomPadding.y}),cleverapps.UI.wrap(t),t=cleverapps.UI.wrapWithPadding(t,e.padding)},addText:function(e){var t=cleverapps.styles.FinisherWindow.Text,i=cleverapps.UI.generateTTFText(e,t.font);i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setDimensions(t.width,0),this.content.addChild(i)},addButtons:function(e){var t=cleverapps.styles.FinisherWindow,i=new cc.Node;e.forEach(function(e){i.addChild(e)}),cleverapps.UI.arrangeWithMargins(i.getChildren(),{direction:cleverapps.UI.HORIZONTAL,margin:t.margin}),cleverapps.UI.wrap(i),i=cleverapps.UI.wrapWithPadding(i,{x:0,y:10}),this.content.addChild(i)}});FinisherWindow.prototype.listBundles=function(){return["store_links"]},cleverapps.styles.FinisherWindow={
bottomPadding:{y:0},padding:{x:0,y:10},GroupInfo:{width:450,heigth:70},Text:{font:cleverapps.styles.FONTS.SMALL_TEXT_BROWN,paddingTop:10,paddingBottom:10,width:550,margin:10},Button:{width:460,height:100},paddingTop:25,paddingBottom:50,width:500,margin:30},CustomSyncers.extractors.result=function(e){if(cleverapps.config.results){var t=[];if(e)t.push(e);else for(var i=cleverapps.user.episode;0<=i;i--)if(!cleverapps.userresult.isEmpty(i)){var s=cleverapps.userresult.getEpisodeInfo(i);s.episodeNo=i,t.push(s)}return 0<t.length?t.map(function(e){return{episode:e.episodeNo,scores:JSON.stringify(UserResult.ParseLib.objToArray(e.scores)),stars:JSON.stringify(UserResult.ParseLib.objToNumber(e.stars))}}):void 0}},CustomSyncers.importerData.result=function(e){cleverapps.config.results&&e.forEach(function(e){var t=e.episode,i=UserResult.ParseLib.parseScores(e.scores),s=UserResult.ParseLib.parseStars(e.stars);Object.keys(i).forEach(function(e){s.hasOwnProperty(e)&&cleverapps.userresult.updateLevel(
t,e,i[e],s[e],{force:!0,skipUpdate:!0})})})},levels.GameHints=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.LEVEL_HINTS);this.usedHints="number"==typeof e?e:0},levels.GameHints.prototype.reset=function(){this.isCurrentLevel()&&(this.usedHints=0,this.save())},levels.GameHints.prototype.isCurrentLevel=function(){return Game.currentGame&&Game.currentGame.level.isCurrentLevel()},levels.GameHints.prototype.addHint=function(){this.isCurrentLevel()&&(this.usedHints++,this.save())},levels.GameHints.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.LEVEL_HINTS,this.usedHints)};var Lantern=function(e){this.mission=e,this.onGiveBonusListener=function(){},this.load()};Lantern.prototype.isActive=function(e){return e?e.isCurrentLevel():levels.user.isCurrentLevel(cleverapps.environment.levelNo,cleverapps.environment.episodeNo)},Lantern.getMaxStreak=function(){return 3},Lantern.prototype.giveBonus=function(n){var o=this.getCurrentStreak()
;cleverapps.audio.playSound(res.lanterngivebonus_effect),Game.currentGame.counter.setTimeout(function(){var e=Lantern.BONUSES_BY_SERIA[o];for(var t in e){if(t===Lantern.BONUS_TYPES.HEROES){var i=Game.currentGame.field.addRandomCombo(e[t]);i<e[t]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LANTERN_COMBO_NO_PLACE,{amount:e[t]-i})}if(t===Lantern.BONUS_TYPES.MULTICOLOR){var s=Game.currentGame.field.addRandomMulticolor(e[t]);s<e[t]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LANTERN_MULTICOLOR_NO_PLACE,{amount:e[t]-s})}t===Lantern.BONUS_TYPES.MOVES&&(Game.currentGame.setMoves(Game.currentGame.moves+e[t],{animate:!0}),Game.currentGame.beginMoves+=e[t])}n()}.bind(this),1e3*cleverapps.styles.Lantern.duration),this.onGiveBonusListener()},Lantern.prototype.save=function(){this.mission.result=0,this.mission.update(this.streak)},Lantern.prototype.load=function(){this.streak=this.mission.result,this.savedStreak=this.streak,this.beforeShownProgress=this.streak},
Lantern.prototype.getCurrentStreak=function(){return this.savedStreak},Lantern.prototype.restoreSavedStreak=function(){this.streak=this.savedStreak,this.save()},Lantern.prototype.onStart=function(){this.savedStreak=this.streak,this.streak=0,this.save()},Lantern.prototype.onWin=function(){this.streak=Math.min(this.savedStreak+1,Lantern.getMaxStreak()),this.savedStreak=this.streak,this.save()},Lantern.prototype.onLose=function(){this.streak=0,this.savedStreak=0,this.beforeShownProgress=0,this.save()},Lantern.Get=function(){return cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN)&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN).logic.lantern},Lantern.IsActive=function(e){var t=Lantern.Get();return t&&t.isActive(e)},Lantern.GetStreak=function(e){var t=Lantern.Get();return t&&t.isActive(e)&&0<t.streak?t.streak:0},Lantern.BONUS_TYPES={},Lantern.BONUS_TYPES.HEROES="heroes",Lantern.BONUS_TYPES.MULTICOLOR="multicolor",
Lantern.BONUS_TYPES.MOVES="moves",Lantern.BONUSES_BY_SERIA={1:{heroes:5},2:{heroes:5,moves:3},3:{heroes:5,moves:3,multicolor:1}},cleverapps.styles.Lantern={duration:.4};var LanternView=cc.Node.extend({ctor:function(e,t){this._super(),this.lantern=e,this.setAnchorPoint2(),this.setLocalZOrder(2),this.styles=cleverapps.styles.LanternView,this.animation=new cleverapps.Spine(bundles.lantern.jsons.lantern_game_json),this.addChild(this.animation),this.setContentSize2(this.animation.getContentSize()),this.animation.setPositionRound(this.width/2,this.height/2),(t=t||cc.director.getRunningScene().fieldView).addChild(this),this.lantern.onGiveBonusListener=this.createListener(this.hide.bind(this)),this.show()},show:function(){this.animation.setAnimation(0,"idle_"+this.lantern.getCurrentStreak(),!0);var e=this.getParent().convertToNodeSpace(cc.p(-this.width,0));e.x||(e.x=0),e.y=this.styles.show.y;var t=1/this.parent.scale,i=this.styles.offset.x*(t<1?t:1),s=this.styles.offset.y*(t<1?t:1),n=cc.p(
this.parent.width/2+i,this.parent.height/2+s);this.setPositionRound(e),"heroes"===cleverapps.config.name?this.runAction(new cc.MoveTo(.5,n)):(this.setRotation(45),this.runAction(new cc.Spawn(new cc.MoveTo(.5,n),new cc.RotateTo(.5,0)))),cleverapps.audio.playSound(res.lanternshow_effect)},hide:function(){var t=this.getParent().convertToNodeSpace(cc.p(-this.width,0));t.y=this.styles.hide.y,this.animation.setCompleteListener(function(){this.animation.setAnimation(0,"idle_"+this.lantern.getCurrentStreak(),!0);var e=new cc.Spawn(new cc.MoveTo(.5,t),new cc.RotateTo(.4,-45));"heroes"===cleverapps.config.name&&(e=new cc.MoveTo(.5,t)),this.runAction(new cc.Sequence(e,new cc.RemoveSelf))}.bind(this)),this.animation.setAnimation(0,"out_"+this.lantern.getCurrentStreak(),!1),cleverapps.audio.playSound(res.lanternhide_effect)}});cleverapps.styles.LanternView={offset:{x:0,y:150},show:{y:100,delay:1},hide:{y:1e3}};var FriendSorter=function(){this.data=cleverapps.DataLoader.load(
cleverapps.DataLoaderTypes.SORTER),this.data||(this.data={}),cleverapps.config.debugMode&&(FriendSorter.PRIVACY_INTERVAL="1 minute"),this.update()};FriendSorter.PRIVACY_INTERVAL="1 day",FriendSorter.prototype.update=function(){var e={},t=Date.now(),i=!1;for(var s in this.data)this.data[s]+cleverapps.parseInterval(FriendSorter.PRIVACY_INTERVAL)>t?e[s]=this.data[s]:i=!0;i&&(this.data=e,this.save())},FriendSorter.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SORTER,this.data)},FriendSorter.isActivePlayer=function(e){return 1<=e.episode||6<=e.level},FriendSorter.prototype.canUse=function(e){return void 0===this.data[e]},FriendSorter.prototype.markUsed=function(e){e.forEach(function(e){this.data[e]=Date.now()},this),this.save()},FriendSorter.prototype.listActiveFriends=function(){return levels.progress.data?levels.progress.data.filter(FriendSorter.isActivePlayer).map(function(e){return cleverapps.friends.getById(e.id)}).filter(function(e){return e}
):cleverapps.friends.listFriends()},FriendSorter.prototype.listInactiveFriends=function(){var e=cleverapps.invitalbleFriends.listFriends();if(levels.progress.data){var t=levels.progress.data.filter(function(e){return!FriendSorter.isActivePlayer(e)});e=e.concat(t.map(function(e){return cleverapps.friends.getById(e.id)})).filter(function(e){return e})}return this.update(),e=e.filter(function(e){return e&&void 0===this.data[e.id]},this)};var SelectFriendWindow=Window.extend({onWindowLoaded:function(e,t){var i=new cc.Node;i.setAnchorPoint(.5,.5),this.content=i,this.type=e,cleverapps.config.debugMode&&(SelectFriendWindow.PROCESS_PERIOD="300 second");var s=cleverapps.friends.listFriends().concat(cleverapps.invitalbleFriends.listFriends());s.length?this.generateFriendsContent(s,t):this.generateNoFriendsContent();var n=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.SelectFriendWindow.window,!0);this._super({title:SelectFriendWindow.ByType[this.type].title,
name:"selectfriendwindow"+e,content:i,styles:n}),cleverapps.audio.playSound(res.window_effect)},addCheck:function(e,t){var i=new cc.Sprite(res.select_friend_checkbox_selected);t&&cleverapps.UI.convertToGrayScale(i),i.setPosition(e.width/2,e.height/2),e.check=i,e.addChild(i)},checkElementByFriendId:function(e,t){var i=this.selectedElements.friends.indexOf(e);-1!==i?(this.selectedElements.data[e].checked=!1,this.selectedElements.data[e].check.removeFromParent(),this.selectedElements.data[e]=void 0,this.selectedElements.friends.splice(i,1)):(this.addCheck(t),t.checked=!0,this.selectedElements.data[e]=t,this.selectedElements.friends.push(e),this.selectedElements.friends.length>SelectFriendWindow.MAX_SELECTED&&this.checkElementByFriendId(this.selectedElements.friends[0])),this.updateSelectedContent()},generateCheckbox:function(i,s){var e=cleverapps.styles.SelectFriendWindow.withFriends.friendContainer.checkBox;if(!this.processTimeData)for(
var t in this.processTimeData=cleverapps.DataLoader.load(SelectFriendWindow.ByType[this.type].dataLoaderType()),this.processTimeData||(this.processTimeData={}),this.processTimeData)this.processTimeData[t]<Date.now()-cleverapps.parseInterval(SelectFriendWindow.PROCESS_PERIOD)&&(this.processTimeData[t]=void 0);var n=function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(e){var t=s.convertTouchToNodeSpace(e);return!!cc.rectContainsPoint(cc.rect(0,0,s.width,s.height),t)&&(t=this.friendsContainer.convertTouchToNodeSpace(e),cc.rectContainsPoint(cc.rect(0,0,this.friendsContainer.width,this.friendsContainer.height),t))}.bind(this),onTouchEnded:function(e){var t=s.convertTouchToNodeSpace(e);if(!cc.rectContainsPoint(cc.rect(0,0,s.width,s.height),t))return!1;t=this.friendsContainer.convertTouchToNodeSpace(e),cc.rectContainsPoint(cc.rect(0,0,this.friendsContainer.width,this.friendsContainer.height),t)&&this.checkElementByFriendId(i.id,o)}.bind(this)},
s),s.onMouseOver=function(){s.bg&&s.bg.setColor(cleverapps.styles.COLORS.HOVER),o.setScale(1.1)},s.onMouseOut=function(){s.bg&&s.bg.setColor(cleverapps.styles.COLORS.WHITE),o.setScale(1)},cleverapps.UI.applyHover(s)}.bind(this),o=this.generateCheckBoxBg();if(o.setPositionRound(e.x,s.height/2+cleverapps.styles.SelectFriendWindow.Avatar.y),s.fullData={checkBox:o,id:i.id},s.addChild(o),this.processTimeData&&this.processTimeData[i.id]&&this.processTimeData[i.id]>Date.now()-cleverapps.parseInterval(SelectFriendWindow.PROCESS_PERIOD)){var a={showHours:!0,font:cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,imageFont:!1};console.log("disabled",s);var r=this.processTimeData[i.id]+cleverapps.parseInterval(SelectFriendWindow.PROCESS_PERIOD)-Date.now(),l=new cleverapps.CountDownView(new cleverapps.CountDown(r),a),c=function(){l.refresh(),l.removeFromParent(),s.name.setVisible(!0),s.avatar.setOpacity(255),o.setOpacity(255),s.coinsIcon&&s.coinsIcon.setOpacity(255),o.check.removeFromParent(),
s.notActive=!1,n()}.bind(this);return l.onEnter=function(){cleverapps.CountDownView.prototype.onEnter.call(this),l.countDown.onFinish=l.createListener(c)},l.setPosition(s.width/2,e.timer.y),s.addChild(l),s.name.setVisible(!1),this.addCheck(o,!0),o.setOpacity(150),s.avatar.setOpacity(120),s.notActive=!0,void(s.coinsIcon&&s.coinsIcon.setOpacity(150))}s.notActive=!1,n()},generateCheckBoxBg:function(){var e=new cc.Sprite(res.select_friend_checkbox);return e.setAnchorPoint(.5,.5),e.setCascadeOpacityEnabled(!0),e},generateFriendContent:function(e,t){var i=cleverapps.styles.SelectFriendWindow.withFriends.friendContainer,s=new cc.Node;if(s.setAnchorPoint(.5,.5),s.setContentSize(i.width,i.height),i.BackgroundImage){var n=cleverapps.UI.createScale9Sprite(i.BackgroundImage);n.setAnchorPoint(.5,.5),n.setContentSize(i.width,i.height),n.setPosition(s.width/2,s.height/2),s.addChild(n),s.bg=n}var o=new cleverapps.UI.Avatar(e);o.setPositionRound(cleverapps.styles.SelectFriendWindow.Avatar.x,
s.height/2+cleverapps.styles.SelectFriendWindow.Avatar.y),o.setAnchorPoint2(),(s.avatar=o).setCascadeOpacityEnabled(!0),s.addChild(o);var a=cleverapps.UI.generateTTFText(e.name,cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return a.setDimensions(i.Name.width,i.Name.height),a.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),a.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),s.addChild(a),a.setPositionRound(s.width/2,i.Name.y),s.name=a,this.generateCheckbox(e,s),s},getButtonContent:function(){var e=new cc.Node;e.setAnchorPoint2();var t=cleverapps.UI.generateTTFText(SelectFriendWindow.ByType[this.type].button,cleverapps.styles.FONTS.BUTTON_TEXT);return e.buttonText=t,e.addChild(t),e.setContentSize(t.width,t.height),t.setPositionRound({align:"center"},{align:"center"}),e},generateFriendsContent:function(e,i){this.selectedElements={friends:[],data:{}};var t=cleverapps.styles.SelectFriendWindow.withFriends;this.content.setContentSize(t.width,t.height);var s=new cleverapps.UI.Button({
content:this.getButtonContent(),width:t.Button.width,height:t.Button.height,font:cleverapps.styles.FONTS.BUTTON_TEXT,onClicked:function(){this.selectedElements.friends.length&&(this.close(),i(this.selectedElements.friends,function(){if(this.processTimeData){for(var e=0;e<this.selectedElements.friends.length;e++)this.processTimeData[this.selectedElements.friends[e]]=Date.now();cleverapps.DataLoader.save(SelectFriendWindow.ByType[this.type].dataLoaderType(),this.processTimeData)}}.bind(this)))}.bind(this),clickThrottle:cleverapps.UI.SOCIAL_CLICK_THROTTLE});s.setPositionRound(this.content.width/2+t.Button.x,t.Button.y),this.button=s,this.content.addChild(s);var n=new cc.Node;n.setAnchorPoint(0,.5),n.setPositionRound(t.SelectedBlock.x,t.SelectedBlock.y);var o=this.generateCheckBoxBg();o.setAnchorPoint(0,.5),o.setPositionRound(0,o.height/2),n.addChild(o);var a=cleverapps.UI.generateTTFText("messages:Selected",cleverapps.styles.FONTS.WINDOW_TEXT);a.setPositionRound(
o.width+t.SelectedBlock.margin.x,o.y+a.height/2),a.setAnchorPoint(0,.5),n.addChild(a);var r=cleverapps.UI.generateTTFText("",cleverapps.styles.FONTS.WINDOW_TEXT);r.setAnchorPoint(.5,.5),this.selectedAmountText=r,n.addChild(r),this.updateSelectedContent(),r.setPositionRound(a.x+a.width/2,o.y-r.height/2),n.setContentSize(o.width+a.width+t.SelectedBlock.margin.x,o.height),this.content.addChild(n),n.onMouseOver=function(){o.setScale(1.1)},n.onMouseOut=function(){o.setScale(1)},cleverapps.UI.applyHover(n),cleverapps.UI.onClick(n,function(e){this.switchSelectAll(o)}.bind(this));var l=new cc.Node;this.friendContainers=e.map(function(e,t){return{container:this.generateFriendContent(e,i),order:t}},this),levels.friendSorter.update(),this.friendContainers.sort(function(e,t){return e.container.notActive!==t.container.notActive?e.container.notActive?1:-1:levels.friendSorter.canUse(e.container.fullData.id)!==levels.friendSorter.canUse(t.container.fullData.id)?levels.friendSorter.canUse(
e.container.fullData.id)?-1:1:e.order-t.order}),this.friendContainers.length>SelectFriendWindow.MAX_ROWS_AMOUNT*SelectFriendWindow.IN_ROW&&(this.friendContainers=this.friendContainers.slice(0,SelectFriendWindow.MAX_ROWS_AMOUNT*SelectFriendWindow.IN_ROW));for(var c=0;c<this.friendContainers.length;c++)l.addChild(this.friendContainers[c].container),this.friendContainers[c].container.setPositionRound(c%SelectFriendWindow.IN_ROW*(t.friendContainer.margin+t.friendContainer.width)+t.friendContainer.width/2,l.height-Math.floor(c/SelectFriendWindow.IN_ROW)*(t.friendContainer.margin+t.friendContainer.height)-t.friendContainer.height/2);l=cleverapps.UI.wrap(l),this.friendsContainer=new cleverapps.UI.ScrollView(l),this.friendsContainer.setContentSize(l.width+cleverapps.styles.SelectFriendWindow.scroll.margin.mx[0],t.friendsContainer.height),this.friendsContainer.setAnchorPoint(.5,0),this.friendsContainer.setPositionRound(this.content.width/2,t.friendsContainer.y),
cc.sys.isNative||this.switchSelectAll(o),this.content.addChild(this.friendsContainer)},switchSelectAll:function(e){if(e.selected){e.selected=!1,e.check.removeFromParent();for(var t=this.selectedElements.friends.length-1;0<=t;t--)this.checkElementByFriendId(this.selectedElements.friends[t])}else{var i=!1;for(t=0;t<this.friendContainers.length;t++){var s=this.friendContainers[t].container,n=s.fullData;this.selectedElements.friends.length<SelectFriendWindow.MAX_SELECTED&&!s.notActive&&!n.checkBox.checked&&(this.checkElementByFriendId(n.id,n.checkBox),i=!0)}i&&(e.selected=!0,this.addCheck(e))}},updateSelectedContent:function(){this.selectedAmountText.setString(this.selectedElements.friends.length+"/"+SelectFriendWindow.MAX_SELECTED),this.selectedElements.friends.length?this.button.enable():this.button.disable()},generateNoFriendsContent:function(){var e=cleverapps.styles.SelectFriendWindow.noFriends;this.content.setContentSize(e.width,e.height);var t=cleverapps.UI.generateTTFText(
SelectFriendWindow.ByType[this.type].noFriends,cleverapps.styles.FONTS.WINDOW_TEXT);t.setPositionRound(this.content.width/2,e.Text.y),t.setDimensions(e.Text.width,e.Text.height),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.content.addChild(t);var i=new cleverapps.UI.Button({text:Messages.get("SettingsWindow.InviteFriends"),width:e.Button.width,height:e.Button.height,font:cleverapps.styles.FONTS.BUTTON_TEXT,onClicked:function(){cleverapps.social.inviteFriendsWindow(function(){this.close()}.bind(this))}.bind(this)});i.setPositionRound(this.content.width/2,e.Button.y),this.content.addChild(i)}});SelectFriendWindow.ByType={askLives:{title:"messages:SelectFriendWindow.askLives.title",button:"messages:Ask",noFriends:"messages:SelectFriendWindow.askLives.noFriendsText",dataLoaderType:function(){return cleverapps.DataLoaderTypes.ASKED_LIVES}},askStars:{title:"messages:SelectFriendWindow.askStars.title",button:"messages:Ask",
noFriends:"messages:SelectFriendWindow.askStars.noFriendsText",dataLoaderType:function(){return cleverapps.DataLoaderTypes.ASKED_STARS}}},SelectFriendWindow.PROCESS_PERIOD="1 day",SelectFriendWindow.MAX_SELECTED=10,SelectFriendWindow.MAX_ROWS_AMOUNT=10,SelectFriendWindow.IN_ROW=3,cleverapps.styles.SelectFriendWindow={Avatar:{x:140,y:20},scroll:{margin:{mx:[30]}},withFriends:{width:670,height:750,friendsContainer:{height:580,y:100},friendContainer:{BackgroundImage:bundles.main.frames.bounty_item_bg,height:180,width:210,margin:20,Name:{width:200,height:40,y:24},checkBox:{x:42,timer:{y:24,height:20}}},Button:{width:300,height:120,y:0,x:190,margin:10},SelectedBlock:{y:0,x:0,margin:{x:20}}},noFriends:{width:550,height:500,Text:{y:250,width:550,height:400},Button:{width:450,height:120,y:0}}};var AdminGiftsWindow=RewardWindow.extend({ctor:function(e){var t=AdminGiftsWindow.prepareReward(JSON.parse(e));this._super({reward:t})},onWindowLoaded:function(e){var t=cleverapps.styles.AdminGiftsWindow
;this._super({title:"messages:AdminGifts",name:"admingiftswindow",reward:e.reward,textWidth:t.text.width,text:"messages:AdminGiftsText",styles:t.animationStyles})},receiveReward:function(){this.opened||(this.opened=!0,cleverapps.Chest.prototype._receiveReward(this.reward,!0),cleverapps.audio.playSound(res.shop_buy_effect),cleverapps.starChest&&!cleverapps.starChest.locked&&new StarChestWindow)},onClose:function(){this.receiveReward()}});AdminGiftsWindow.prepareReward=function(e){var r={};return e.forEach(function(e){if("object"==typeof e&&e.hasOwnProperty("type")&&e.hasOwnProperty("amount")){var t=e.type;if(-1!==["gold","unlimitedLives","stars","exp","gun","hl","wardrobe","lives"].indexOf(t)||0===t.indexOf("booster")){var i=e.amount;if(0===t.indexOf("booster"))void 0===r.boosters&&(r.boosters=[]),r.boosters[parseInt(t.replace("booster",""))]=i;else if("unlimitedLives"===t)r.unlimitedLives={interval:i+" hour",amount:i,title:"messages:AMOUNT_HOURS"};else if("hl"===t){r.herolevels=[];for(
var s=0;s<e.amount.length;){var n=e.amount[s];s++;for(var o=0,a=!1;s<e.amount.length&&"0"<=e.amount[s]&&e.amount[s]<="9";)o=10*o+"0123456789".indexOf(e.amount[s]),a=!0,s++;a&&r.herolevels.push([n,o])}}else r[t]=i}}}),r},cleverapps.styles.AdminGiftsWindow={text:{width:600},animationStyles:{animation:{y:-40},reward:{y:-232}}};var AdminSetProgressWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.styles.AdminSetProgressWindow;e=JSON.parse(e);var i=new cc.Node;i.setContentSize2(t.content);var s=cleverapps.humanReadableNumber(parseInt(e.episode),parseInt(e.level)),n=cleverapps.UI.generateTTFText("messages:AdminSetProgress.Text",cleverapps.styles.FONTS.WINDOW_TEXT,{levelNo:s});n.setDimensions(t.text.width,0),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.addChild(n);var o=new cleverapps.UI.Button({text:Messages.get("Yes"),onClicked:function(){this.close(),this.setLevel(e.episode,e.level)}.bind(this),font:cleverapps.styles.FONTS.BUTTON_TEXT,width:t.buttons.width,
height:t.buttons.height});this._super({title:"messages:AdminSetProgress.Title",name:"adminsetprogresswindow",content:i,button:{text:Messages.get("No"),width:t.buttons.width,height:t.buttons.height}}),this.buttons.add(o)},setLevel:function(e,t){levels.user.level=parseInt(t),levels.user.episode=parseInt(e),levels.user.save(),levels.episodes.reset(),levels.episodes.setCurrentEpisode(levels.user.episode),cleverapps.metha.distract({focus:"setProgressReload",action:function(e){cleverapps.metha.gotoMainScene(e)}})}});cleverapps.styles.AdminSetProgressWindow={buttons:{width:160,height:100},content:{width:500,height:430},text:{width:500}},levels.FriendRequests=function(){this.load(),this.lastServerReload=0,this.onNewListener=function(){},this.onChangeListener=function(){},cleverapps.flags.noviral&&this.deleteFakeRequests(),this.serverReload(),FakeRequestSender.sendIfNeed(this),setInterval(function(){this.serverReload(),FakeRequestSender.sendIfNeed(this)}.bind(this),cleverapps.parseInterval(
"1 minute"))},levels.FriendRequests.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.FRIEND_REQUESTS);if(e){this.notProcessed=[];var t=this.listAvailableTypes();e.notProcessed=e.notProcessed.filter(function(e){return-1!==t.indexOf(e.type)});for(var i=0;i<e.notProcessed.length;i++)this.notProcessed.push(levels.FriendRequest.createFriendRequest(e.notProcessed[i]));this.processedIds=e.processedIds}else this.notProcessed=[],this.processedIds=[]},levels.FriendRequests.prototype.save=function(){for(var e=[],t=0;t<this.notProcessed.length;t++)e.push(this.notProcessed[t].getData());cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.FRIEND_REQUESTS,{notProcessed:e,processedIds:this.processedIds})},levels.FriendRequests.prototype.idInNotProcessed=function(e){for(var t=0;t<this.notProcessed.length;t++)if(this.notProcessed[t].getId()===e)return!0;return!1},levels.FriendRequests.prototype.lastNotProcessedId=function(){for(
var e=this.notProcessed.length-1;0<=e;e--)if(this.notProcessed[e].canView())return this.notProcessed[e].id;return!1},levels.FriendRequests.prototype.existNotProcessed=function(){for(var e=0;e<this.notProcessed.length;e++)if(this.notProcessed[e].canView())return!0;return!1},levels.FriendRequests.prototype.existRequestFrom=function(e){for(var t=0;t<this.notProcessed.length;t++)if(this.notProcessed[t].canView()&&this.notProcessed[t].from===e)return!0;return!1},levels.FriendRequests.prototype.existRequestTypes=function(e){for(var t=0;t<this.notProcessed.length;t++)if(0<=e.indexOf(this.notProcessed[t].type))return!0;return!1},levels.FriendRequests.prototype.processById=function(e){for(var t=!1,i=!1,s=0;s<this.notProcessed.length;s++)if(this.notProcessed[s].getId()===e){this.notProcessed[s].onServer()&&(i=!0),this.notProcessed.splice(s,1),t=!0;break}i&&(this.processedIds.push(e),this.deleteOnServerById(e)),t&&this.onChangeListener(),this.save()},
levels.FriendRequests.prototype.onServerLoad=function(e){var t=[],i=!1,s=this.listAvailableTypes();Array.isArray(e)||(cleverapps.ReportStream.debug("FriendRequests.onServerLoad data type is - "+typeof e),e=[]),e=e.filter(function(e){return-1!==s.indexOf(e.type)});for(var n=0;n<e.length;n++)0<=this.processedIds.indexOf(e[n].id)?(this.deleteOnServerById(e[n].id),t.push(e[n].id)):this.idInNotProcessed(e[n].id)||(this.notProcessed.push(levels.FriendRequest.createFriendRequest({id:e[n].id,from:e[n].fromUserId,type:e[n].type})),i=!0);this.processedIds=t,this.save(),i&&(this.onNewListener(),this.onChangeListener())},levels.FriendRequests.prototype.sendServerRequest=function(e,t){cleverapps.RestClient.post("/friendrequests/create/"+cleverapps.user.id+"/a",{toUserId:e,type:t})},levels.FriendRequests.prototype.deleteOnServerById=function(e){cleverapps.RestClient.post("/friendrequests/delete/"+cleverapps.user.id+"/a",{id:e})},levels.FriendRequests.prototype.serverReload=function(){
this.lastServerReload<Date.now()-cleverapps.parseInterval(levels.FriendRequests.RELOAD_INTERVAL)&&cleverapps.synchronizer.synced&&(this.lastServerReload=Date.now(),cleverapps.RestClient.get("/friendrequests/getmy/"+cleverapps.user.id+"/a",{},this.onServerLoad.bind(this)))},levels.FriendRequests.prototype.deleteFakeRequests=function(){var e=this.notProcessed.filter(function(e){return!e.fake});e.length!==this.notProcessed.length&&(this.notProcessed=e,this.onChangeListener(),this.save())},levels.FriendRequests.prototype.listAvailableTypes=function(){var e=[levels.FriendRequest.TYPE_ADMIN_SET_PROGRESS,levels.FriendRequest.TYPE_STUCK_HELP_COINS,levels.FriendRequest.TYPE_ADMIN_GIFTS,levels.FriendRequest.TYPE_BOUNTY_READY];return"undefined"==typeof match3&&(e=e.concat([levels.FriendRequest.TYPE_SENT_COINS,levels.FriendRequest.TYPE_ASK_COINS,levels.FriendRequest.TYPE_SENT_HELP_COINS,levels.FriendRequest.TYPE_ASK_HELP_COINS])),cleverapps.lives&&(e=e.concat([
levels.FriendRequest.TYPE_SENT_HELP_LIVE,levels.FriendRequest.TYPE_ASK_HELP_LIVE,levels.FriendRequest.TYPE_SENT_LIVE,levels.FriendRequest.TYPE_ASK_LIVE])),cleverapps.starChest&&(e=e.concat([levels.FriendRequest.TYPE_SENT_HELP_STAR,levels.FriendRequest.TYPE_ASK_HELP_STAR,levels.FriendRequest.TYPE_SENT_STAR,levels.FriendRequest.TYPE_ASK_STAR])),e},levels.FriendRequests.RELOAD_INTERVAL="10 minutes",levels.FriendRequest=function(e){this.id=e.id,this.from=e.from,this.type=e.type,this.fake=e.fake,this.onRemoveListener=function(){}},levels.FriendRequest.prototype.getId=function(){return this.id},levels.FriendRequest.prototype.getView=function(){if(this.canView())return levels.FriendRequestView},levels.FriendRequest.prototype.canView=function(){return levels.FriendRequest.REQUEST_TYPES[this.type]},levels.FriendRequest.prototype.isFake=function(){return!0===this.fake},levels.FriendRequest.prototype.onServer=function(){return!this.isFake()},levels.FriendRequest.prototype.getData=function(){
return{id:this.id,from:this.from,type:this.type,fake:this.fake}},levels.FriendRequest.prototype.process=function(){var e=levels.FriendRequest.REQUEST_TYPES[this.type];if(!e.checkProcess||e.checkProcess()){var t=function(){e.createNewRequestId&&levels.friendRequests.sendServerRequest(this.from,e.createNewRequestId),e.onProcess&&e.onProcess(this),this.remove(),0<=levels.FriendRequest.SENT_HELP_REQUESTS.indexOf(this.type)&&cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.SEND_FRIEND_HELP)}.bind(this);e.fbRequest?cleverapps.social.sendRequest(this.from,e.fbRequest,t):t()}},levels.FriendRequest.prototype.canRemove=function(){return this.type!==levels.FriendRequest.TYPE_BOUNTY_READY||0===cleverapps.bountyManager.listPrizes().length},levels.FriendRequest.prototype.remove=function(){this.canRemove()&&(levels.friendRequests.processById(this.getId()),this.onRemoveListener())},levels.FriendRequest.prototype.cancel=function(){levels.friendRequests.processById(this.getId()),
this.onRemoveListener()},levels.FriendRequest.createFriendRequest=function(e){return new levels.FriendRequest(e)},levels.FriendRequest.addLiveProcess=function(e){e.animateCollect(cleverapps.styles.MenuBar.LivesItem.target,function(){cleverapps.lives.setAmount(cleverapps.lives.amount+1)})},levels.FriendRequest.checkAddLiveProcess=function(){return!0},levels.FriendRequest.addStarProcess=function(e){e.animateCollect(cleverapps.styles.MenuBar.StarChestItem.target,function(){cleverapps.starChest.addStars(1),cleverapps.starChest.locked||cleverapps.metha.display({focus:"StarChestFriendRequest",action:function(e){new StarChestWindow,cleverapps.metha.onceNoWindowsListener=e}})})},levels.FriendRequest.addCoinsProcess=function(e,t){t=t||levels.FriendRequest.HELP_COINS_AMOUNT,e.animateCollect(cleverapps.styles.MenuBar.GoldItem.target,function(){cleverapps.user.setGold(cleverapps.user.gold+t)})},levels.FriendRequest.addCoinsStuckProcess=function(e){levels.FriendRequest.addCoinsProcess(e,
levels.FriendRequest.STUCK_COINS_AMOUNT)},levels.FriendRequest.adminGifts=function(e){new AdminGiftsWindow(e.from)},levels.FriendRequest.adminSetProgress=function(e){new AdminSetProgressWindow(e.from)},levels.FriendRequest.TYPE_ASK_LIVE=0,levels.FriendRequest.TYPE_SENT_LIVE=1,levels.FriendRequest.TYPE_ASK_STAR=2,levels.FriendRequest.TYPE_SENT_STAR=3,levels.FriendRequest.TYPE_ASK_HELP_LIVE=4,levels.FriendRequest.TYPE_SENT_HELP_LIVE=5,levels.FriendRequest.TYPE_ASK_HELP_STAR=6,levels.FriendRequest.TYPE_SENT_HELP_STAR=7,levels.FriendRequest.TYPE_BOUNTY_READY=8,levels.FriendRequest.TYPE_ASK_HELP_COINS=9,levels.FriendRequest.TYPE_SENT_HELP_COINS=10,levels.FriendRequest.TYPE_ADMIN_GIFTS=11,levels.FriendRequest.TYPE_ASK_COINS=12,levels.FriendRequest.TYPE_SENT_COINS=13,levels.FriendRequest.TYPE_STUCK_HELP_COINS=14,levels.FriendRequest.TYPE_ADMIN_SET_PROGRESS=15,levels.FriendRequest.SENT_HELP_REQUESTS=[levels.FriendRequest.TYPE_ASK_LIVE,levels.FriendRequest.TYPE_ASK_HELP_LIVE,
levels.FriendRequest.TYPE_ASK_STAR,levels.FriendRequest.TYPE_ASK_HELP_STAR,levels.FriendRequest.TYPE_ASK_COINS,levels.FriendRequest.TYPE_ASK_HELP_COINS,levels.FriendRequest.TYPE_STUCK_HELP_COINS],levels.FriendRequest.HELP_COINS_AMOUNT=10,levels.FriendRequest.STUCK_COINS_AMOUNT=50,levels.FriendRequest.REQUEST_TYPES=[{image:"send_life_icon",button_png:"small_blue_button",button_on_png:"small_blue_button_on",button_text:"Send",text:"AskLiveRequest",fbRequest:"sendLiveRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_LIVE},{image:"accept_life_icon",text:"SendLiveRequest",fbRequest:"thanksForLiveRequest",onProcess:levels.FriendRequest.addLiveProcess,checkProcess:levels.FriendRequest.checkAddLiveProcess},{image:"send_star_icon",button_png:"small_blue_button",button_on_png:"small_blue_button_on",button_text:"Send",text:"AskStarRequest",fbRequest:"sendStarRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_STAR},{image:"accept_star_icon",text:"SendStarRequest",
fbRequest:"thanksForStarRequest",onProcess:levels.FriendRequest.addStarProcess},{image:"send_life_icon",button_png:"small_blue_button",button_on_png:"small_blue_button_on",button_text:"Send",text:"AskHelpRequest",fbRequest:"sentHelpRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_HELP_LIVE},{image:"accept_life_icon",text:"SentHelpRequest",fbRequest:"thanksForHelpRequest",onProcess:levels.FriendRequest.addLiveProcess,checkProcess:levels.FriendRequest.checkAddLiveProcess},{image:"send_star_icon",button_png:"small_blue_button",button_on_png:"small_blue_button_on",button_text:"Send",text:"AskHelpRequest",fbRequest:"sentHelpRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_HELP_STAR},{image:"accept_star_icon",text:"SentHelpRequest",fbRequest:"thanksForHelpRequest",onProcess:levels.FriendRequest.addStarProcess},{avatar:"shop_gold3_png",text:"BountyRequest",button_text:"Collect",onProcess:BountyManager.openWindow},{image:"send_coins_icon",button_png:"small_blue_button",
button_on_png:"small_blue_button_on",button_text:"Send",text:"AskHelpRequest",fbRequest:"sentHelpRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_HELP_COINS},{image:"accept_coins_icon",text:"SentHelpRequest",fbRequest:"thanksForHelpRequest",onProcess:levels.FriendRequest.addCoinsProcess},{avatar:"shop_gold4_png",text:"AdminGifts",noCancel:!0,onProcess:levels.FriendRequest.adminGifts},{image:"send_coins_icon",button_png:"small_blue_button",button_on_png:"small_blue_button_on",button_text:"Send",text:"AskCoinsRequest",fbRequest:"sendCoinsRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_COINS},{image:"accept_coins_icon",text:"SendCoinsRequest",fbRequest:"thanksForCoinsRequest",onProcess:levels.FriendRequest.addCoinsProcess},{image:"accept_stuck_coins_icon",text:"SendStuckHelpRequest",onProcess:levels.FriendRequest.addCoinsStuckProcess},{avatar:"accept_coins_icon",text:"AdminSetProgress",onProcess:levels.FriendRequest.adminSetProgress}],levels.FriendRequest.SYSTEM_ID=-1
,levels.FriendRequestView=cc.Node.extend({ctor:function(e,t,i){this._super(),this.setContentSize(cleverapps.styles.FriendRequestView.width,cleverapps.styles.FriendRequestView.height),this.setAnchorPoint2(),this.model=e,this.onRemove=i,this.createBackground(),this.createFromContent(),this.createRequestContent(),this.createRequestImage(),this.createCancelContent(),this.createProcessContent(),cleverapps.UI.onClick(this,function(){t.showAutoHide&&t.showAutoHide()||this.process()}.bind(this))},onEnter:function(){this._super(),this.model.onRemoveListener=this.createListener(this.removeAnimation.bind(this)),this.model.animateCollect=this.createListener(this.animateCollect.bind(this))},animateCollect:function(e,t){cleverapps.history.add("reqclt",1),WindowHelper.animateCollect(this.image,{scale:.8,target:e},t)},createFromContent:function(){var e,t,i=levels.FriendRequest.REQUEST_TYPES[this.model.type],s=void 0;if(cleverapps.social instanceof cleverapps.BaseFB&&(s=this.model.from),i.avatar
)e=res[i.avatar],t=new cleverapps.UI.Avatar(e,s);else{var n=cleverapps.friends.getById(this.model.from);t=n?new cleverapps.UI.Avatar(n):new cleverapps.UI.Avatar("https://scontent.xx.fbcdn.net/v/",s)}var o=cleverapps.styles.FriendRequestView.Avatar;t.setPositionRound(t.width/2+o.Margin.x,this.height/2+o.Margin.y),t.setAnchorPoint2(),this.addChild(t)},createBackground:function(){var e=cleverapps.UI.createScale9Sprite(bundles.main.frames.wood_bg,cleverapps.UI.Scale9Rect.TwoPixelXY);e.setContentSize2(this.width,this.height),e.setPosition(this.width/2,this.height/2),this.addChild(e)},getRequestText:function(){var e=levels.FriendRequest.REQUEST_TYPES[this.model.type];return Messages.get(e.text)},createRequestContent:function(){var e=this.getRequestText();if(e){var t=cleverapps.styles.FriendRequestView.Request;(e=cleverapps.UI.generateTTFText(e,t.font)).setPositionRound(this.width/2+t.x,this.height/2+t.y),e.setDimensions(t.width,0),e.fitTo(void 0,t.height),e.setHorizontalAlignment(
cc.TEXT_ALIGNMENT_CENTER),e.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.addChild(e)}},getRequestImage:function(){var e=levels.FriendRequest.REQUEST_TYPES[this.model.type];if(e.image){var t=new cc.Sprite(res[e.image]);return e.imageScale&&t.setScale(e.imageScale),t}return!1},createRequestImage:function(){var e=this.getRequestImage();e&&(e.setPosition(cleverapps.styles.FriendRequestView.Icon.x,this.height/2+cleverapps.styles.FriendRequestView.Icon.y),this.addChild(e),this.image=e)},getProcessButtonStyle:function(){var e=levels.FriendRequest.REQUEST_TYPES[this.model.type];return{button_png:e.button_png?res[e.button_png]:res.small_green_button,button_on_png:e.button_on_png?res[e.button_on_png]:res.small_green_button_on,text:Messages.get(e.button_text?e.button_text:"Accept"),font:cleverapps.styles.FriendRequestView.processButton.font}},createProcessContent:function(){var e=this.getProcessButtonStyle(),t=cleverapps.styles.FriendRequestView.processButton,i=new cc.Node;i.setPosition(
t.width/2,t.height/2);var s=cleverapps.UI.generateTTFText(e.text,e.font);s.fitTo(.9*t.width),s.setPosition(0,t.text.y),i.addChild(s);var n=new cleverapps.UI.Button({button_png:e.button_png,button_on_png:e.button_on_png,content:i,onClicked:this.process.bind(this),width:t.width,height:t.height});levels.FriendRequest.REQUEST_TYPES[this.model.type].image?n.setPositionRound(this.width-n.width/2-cleverapps.styles.FriendRequestView.processButton.x,this.height/2+cleverapps.styles.FriendRequestView.processButton.y):n.setPositionRound(this.width-n.width/2-cleverapps.styles.FriendRequestView.processButton.noImage.x,this.height/2+cleverapps.styles.FriendRequestView.processButton.noImage.y),this.addChild(n)},createCancelContent:function(){var e=levels.FriendRequest.REQUEST_TYPES[this.model.type],t=cleverapps.styles.FriendRequestView.close;if(!e.noCancel){var i=new cleverapps.UI.Button({button_png:res[t.image.off],button_on_png:res[t.image.on],onClicked:this.cancel.bind(this)});i.setPositionRound(
this.width-i.width/2+t.x,this.height-i.height/2+t.y),i.baseScale=t.scale,i.scale=t.scale,this.addChild(i)}},cancel:function(){this.model.cancel()},process:function(){this.model.process()},removeAnimation:function(){this.runAction(new cc.Sequence(new cc.ScaleTo(.3,0),new cc.CallFunc(this.onRemove),new cc.RemoveSelf))},showAnimation:function(e){this.setScale(0),this.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.ScaleTo(.3,1)))}}),cleverapps.styles.FriendRequestView={width:480,height:166,close:{x:10,y:10,scale:.75,image:{on:"close_small_on",off:"close_small"}},processButton:{width:170,height:60,font:cleverapps.styles.FONTS.BUTTON_SMALL_TEXT,x:20,y:-35,noImage:{x:90,y:-35},text:{y:0}},Request:{x:66,y:28,width:270,height:80,font:cleverapps.styles.FONTS.WINDOW_SMALL_TEXT},Icon:{x:216,y:-30},Avatar:{Margin:{x:25,y:0}}};var FakeRequestSender={load:function(){cleverapps.config.debugMode&&(FakeRequestSender.REQUEST_PERIOD="1 minute");var e=cleverapps.DataLoader.load(
cleverapps.DataLoaderTypes.FAKE_REQUESTS);return e||(e={lastLoadTime:0}),e},save:function(e){e.lastLoadTime=Date.now(),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.FAKE_REQUESTS,e)},sendIfNeed:function(e){if(0!==cleverapps.friends.listIds().length&&!cleverapps.flags.noviral){var t=FakeRequestSender.load(),i=Math.floor((Date.now()-t.lastLoadTime)/cleverapps.parseInterval(FakeRequestSender.REQUEST_PERIOD));if(!(i<=0)){var s=e.notProcessed.filter(function(e){return e.isFake()});i>FakeRequestSender.MAX_REQUESTS-s.length&&(i=FakeRequestSender.MAX_REQUESTS-s.length);var n=!1,o=levels.friendSorter.listActiveFriends();cleverapps.Random.shuffle(o),10<o.length&&(o=o.slice(0,10));for(var a=0;a<o.length&&0<i;a++){var r=o[a];if(!e.existRequestFrom(r.id)){var l=cleverapps.Random.mathChoose(this.listFakeRequestsTypes(e));i--,n=!0,e.notProcessed.push(levels.FriendRequest.createFriendRequest({id:"__"+Math.floor(1e15*Math.random()),from:r.id,type:l,fake:!0}))}}n&&(e.onNewListener(),
FakeRequestSender.save(t),e.save())}}},listFakeRequestsTypes:function(e){var t=[levels.FriendRequest.TYPE_ASK_HELP_LIVE,levels.FriendRequest.TYPE_ASK_HELP_STAR,levels.FriendRequest.TYPE_ASK_HELP_COINS],i=e.listAvailableTypes();return t.filter(function(e){return-1!==i.indexOf(e)})},MAX_REQUESTS:2,REQUEST_PERIOD:"12 hours"},UserResult=function(){this.scores={},this.stars={};var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.RESULT_FIFO);if(e)for(var t=0;t<e.length;t++){var i=e[t].match(/\d+$/);if(i){var s=parseInt(i[0],10);this.loadEpisode(s)}}};UserResult.prototype.isActive=function(e){return!cleverapps.config.editorMode&&(cleverapps.config.results&&HoseEpisode.isFreshEpisode(e))},UserResult.prototype.isEmpty=function(e){return!this.scores[e]||0===Object.keys(this.scores[e]).length},UserResult.prototype.getEpisodeInfo=function(e){return{scores:this.scores[e]||{},stars:this.stars[e]||{}}},UserResult.prototype.getStarsForLevel=function(e,t){return this.isEmpty(e
)?0:this.stars[e][t]||0},UserResult.prototype.getScoresForLevel=function(e,t){return this.isEmpty(e)?0:this.scores[e][t]||0},UserResult.prototype.updateLevel=function(e,t,i,s,n){if(n=n||{},this.isActive(e)){this.scores[e]=this.scores[e]||{},this.stars[e]=this.stars[e]||{};var o=!1;(!this.scores[e][t]||this.scores[e][t]<i)&&(o=!0,this.scores[e][t]=i),(!this.stars[e][t]||this.stars[e][t]<s)&&(o=!0,this.stars[e][t]=s,levels.episodes.episodes&&levels.episodes.episodes[e]&&levels.episodes.episodes[e].levels[t].improveStars(s)),o&&this.saveEpisode(e,n)}},UserResult.ParseLib={parseScores:function(e){var t=JSON.parse(e);return Array.isArray(t)?UserResult.ParseLib.objFromArray(t):t},parseStars:function(e){var t=JSON.parse(e);return"number"==typeof t?UserResult.ParseLib.objFromNumber(t):t},objFromArray:function(e){var i={};return e.forEach(function(e,t){i[t]=e}),i},objFromNumber:function(e){for(var t={},i=0;i<Episode.LEVELS_PER_EPISODE;i++)t[i]=e%4,e=Math.floor(e/4);return t},
objToArray:function(e){for(var t=[],i=0;i<Episode.LEVELS_PER_EPISODE;i++)void 0===e[i]?t.push(0):t.push(e[i]);return t},objToNumber:function(e){for(var t=0,i=1,s=0;s<Episode.LEVELS_PER_EPISODE;s++)void 0!==e[s]&&(t+=i*e[s]),i*=4;return t}},UserResult.GetStoreKey=function(e){return cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_result_"+e},UserResult.prototype.saveEpisode=function(e,t){if(t&&t.force);else if(!this.isActive(e))return;var i={scores:this.scores[e],stars:this.stars[e]};cleverapps.DataLoader.save(UserResult.GetStoreKey(e),i,{fifoKey:cleverapps.DataLoaderTypes.RESULT_FIFO,limit:Episode.FRESH_EPISODES}),(!t||t&&!t.skipUpdate)&&cleverapps.synchronizer.addUpdateTask("result")},UserResult.prototype.loadEpisode=function(e,t){if(this.scores[e]={},this.stars[e]={},this.isActive(e)){var i=cleverapps.DataLoader.load(UserResult.GetStoreKey(e));i&&(this.scores[e]=i.scores,this.stars[e]=i.stars)}},UserResult.prototype.reset=function(e){this.scores[e]={},
this.stars[e]={},this.saveEpisode(e,{force:!0})};var Results=function(e){this.data=void 0,this.lastUpdateTime=0,this.episode=e,this.isActive()&&this.load(),this.reload(),this.setReloadTimeout()};Results.prototype.clearReloadTimeout=function(){this.reloadTimeout&&this.reloadTimeout.clear()},Results.prototype.setReloadTimeout=function(){this.clearReloadTimeout(),this.reloadTimeout=new cleverapps.LongTimeout(function(){this.reload(),this.setReloadTimeout()}.bind(this),1.01*this.calcCacheTime())},Results.prototype.destructor=function(){this.clearReloadTimeout()},Results.prototype.isActive=function(){return cleverapps.config.results&&this.episode.isFreshEpisode()},Results.prototype.botResults=function(e){var t=this.episode.getLevelContent(e).score;return[{id:"bot3",avatar:res.bot_avatar_3,name:"Donuter",score:10*Math.round(.7*t/10)},{id:"bot2",avatar:res.bot_avatar_2,name:"Lemon Ice",score:10*Math.round(.8*t/10)},{id:"bot1",avatar:res.bot_avatar_1,name:"Creamer",score:10*Math.round(1*t/10)}
]},Results.prototype.listFriendResults=function(e){if(cleverapps.isLocalhost()){var i=this.episode.getLevelContent(e).score;return cleverapps.friends.listFriends().map(function(e,t){return{id:e.id,avatar:e.avatar,name:e.name,score:Math.round(1*i/10)*(8-t)}})}var s=[];return this.data&&this.data[e]&&this.data[e].forEach(function(e){var t=cleverapps.friends.getById(e.id);t&&s.push({id:e.id,avatar:t.avatar,name:t.name,score:e.score})},this),s},Results.prototype.listTop4=function(e,t){var i=t?[]:this.botResults(e);(i=i.concat(this.listFriendResults(e))).sort(function(e,t){return t.score-e.score});var s=void 0;return cleverapps.userresult.isActive(this.episode.episodeNo)&&(s={id:levels.user.id,avatar:cleverapps.friends.getPlayer().avatar,name:cleverapps.friends.getPlayer().name,score:cleverapps.userresult.getScoresForLevel(this.episode.episodeNo,e)}),i=i.slice(0,s?3:4),s&&(s.player=!0,i.push(s)),i.sort(function(e,t){
return e.score!==t.score?t.score-e.score:e.id===levels.user.id?-1:t.id===levels.user.id?1:0}),i},Results.GetStoreKey=function(e){return cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_results_"+e},Results.prototype.reset=function(){this.data=void 0,this.lastUpdateTime=0,this.save(!0)},Results.prototype.save=function(e){!0!==e&&(this.lastUpdateTime=Date.now());var t={data:this.data,when:this.lastUpdateTime};cleverapps.DataLoader.save(Results.GetStoreKey(this.episode.episodeNo),t,{fifoKey:cleverapps.DataLoaderTypes.RESULTS_FIFO,limit:Episode.FRESH_EPISODES}),this.setReloadTimeout()},Results.prototype.load=function(){var e=cleverapps.DataLoader.load(Results.GetStoreKey(this.episode.episodeNo));e&&(this.data=e.data,this.lastUpdateTime=e.when)},Results.prototype.calcCacheTime=function(){return this.episode.episodeNo===levels.user.episode?cleverapps.parseInterval(Results.CACHE_CURRENT_INTERVAL):cleverapps.parseInterval(Results.CACHE_NEAR_INTERVAL)},
Results.prototype.whenFriendListUpdated=function(){if(void 0!==this.data){for(var e in this.data)this.data[e]=this.data[e].filter(function(e){return void 0!==cleverapps.friends.getById(e.id)});this.reload(!0)}else this.reload()},Results.prototype.reload=function(e){this.isActive()&&(void 0!==this.data?(e||this.lastUpdateTime+this.calcCacheTime()<Date.now())&&this.getFromServer():this.getFromServer())},Results.prototype.getFromServer=function(){if(cleverapps.friends.haveData()&&!this.loading){this.loading=!0;var e=function(e){this.loading=!1,this.data={},e.forEach(function(e){var t=e.userId,i=UserResult.ParseLib.parseScores(e.scores);for(var s in i){var n=i[s];void 0===this.data[s]&&(this.data[s]=[]),this.data[s].push({id:t,score:n})}},this),this.episode.isFreshEpisode()&&this.save()}.bind(this),t=cleverapps.friends.listIds();t.length&&(t.join(","),cleverapps.RestClient.get("/results/"+this.episode.episodeNo+"/"+t,{},e,function(e){console.log("Failure loading friends results: ",e)}))}},
Results.CACHE_NEAR_INTERVAL="3 days",Results.CACHE_CURRENT_INTERVAL="1 hour";var Progress=function(){this.data=void 0,this.lastUpdateTime=[0,0],this.load(),this.onUpdated=function(){}};Progress.prototype.init=function(){this.reload(!0),setInterval(this.reload.bind(this),cleverapps.parseInterval(Progress.CHECK_INTERVAL))},Progress.TYPE_NEAR=0,Progress.TYPE_FAR=1,Progress.FILTER_FRIENDS=2,Progress.RESET=3,Progress.CHECK_INTERVAL="12 hours",Progress.CACHE_INTERVAL=["1 day","3 day"],Progress.STUCK_INTERVAL="5 day",Progress.STUCK_HELP_INTERVAL="14 days",Progress.prototype.reset=function(){this.lastUpdateTime=[0,0],this.data=void 0,this.save(Progress.RESET)},Progress.prototype.listByEpisode=function(t){return this.data?this.data.filter(function(e){return e.episode===t}):[]},Progress.getType=function(e){return 1<Math.abs(e.episode-levels.user.episode)?Progress.TYPE_FAR:Progress.TYPE_NEAR},Progress.prototype.listIds=function(e){var t=(this.data?this.data.filter(function(e){
return Progress.getType(e)===Progress.TYPE_FAR}):[]).map(function(e){return e.id}),i=cleverapps.friends.listIds();return e===Progress.TYPE_NEAR?i.filter(function(e){return-1===t.indexOf(e)}):i.filter(function(e){return-1!==t.indexOf(e)})},Progress.GetStoreKey=function(){return cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_progress"},Progress.prototype.save=function(e){e!==Progress.FILTER_FRIENDS&&e!==Progress.RESET&&(this.lastUpdateTime[e]=Date.now());var t={data:this.data,last:this.lastUpdateTime};cleverapps.DataLoader.save(Progress.GetStoreKey(),t),this.onUpdated()},Progress.prototype.load=function(){var e=cleverapps.DataLoader.load(Progress.GetStoreKey());e&&(this.data=e.data,this.lastUpdateTime=e.last||[0,0])},Progress.prototype.whenFriendListUpdated=function(){if(this.data){var t=cleverapps.friends.listIds();this.data=this.data.filter(function(e){return-1!==t.indexOf(e.id)}),this.save(Progress.FILTER_FRIENDS),this.reload(!0)}else this.reload()},
Progress.prototype.reload=function(e){if(!this.data)return this.getFromServer(Progress.TYPE_NEAR),void this.getFromServer(Progress.TYPE_FAR);(e||this.lastUpdateTime[Progress.TYPE_NEAR]+cleverapps.parseInterval(Progress.CACHE_INTERVAL[Progress.TYPE_NEAR])<Date.now())&&this.getFromServer(Progress.TYPE_NEAR),this.lastUpdateTime[Progress.TYPE_FAR]+cleverapps.parseInterval(Progress.CACHE_INTERVAL[Progress.TYPE_FAR])<Date.now()&&this.getFromServer(Progress.TYPE_FAR)},Progress.prototype.getLeaders=function(){var e=[];if(!this.data)return e;for(var t=0;t<this.data.length;t++)cleverapps.friends.getById(this.data[t].id)&&e.push({id:this.data[t].id,rating:cleverapps.humanReadableNumber(this.data[t].episode,this.data[t].level),name:cleverapps.friends.getById(this.data[t].id).name,avatar:cleverapps.friends.getById(this.data[t].id).avatar});return e.sort(function(e,t){return t.rating-e.rating}),cleverapps.config.leagues&&e.forEach(function(e){e.league=Progress.getLeague(e.rating)}),e},
Progress.getLeague=function(e){var t=cleverapps.config.leagues;if(!t)return 0;for(var i=0;i<t.length;i++){var s=t[i];if(!1===s||e<=s)return i}return t.length-1},Progress.prototype.getStuckFriendsFake=function(){return cleverapps.friends.listFriends().map(function(e,t){return{id:e.id,name:e.name,avatar:e.avatar,episode:2*(t+1),level:t+3}})},Progress.prototype.getStuckFriends=function(){if(cleverapps.isLocalhost())return this.getStuckFriendsFake();var s=[];if(!this.data||this.updateInProgress)return s;var n=Date.now();return this.data.forEach(function(e){var t=e.updateTime||n;if(!(e.helpTime&&e.helpTime+cleverapps.parseInterval(Progress.STUCK_HELP_INTERVAL)>n)){var i=cleverapps.friends.getById(e.id);i&&t+cleverapps.parseInterval(Progress.STUCK_INTERVAL)<n&&s.push({id:e.id,name:i.name,avatar:i.avatar,episode:e.episode,level:e.level})}}.bind(this)),s.sort(function(e,t){return e.episode!==t.episode?t.episode-e.episode:t.level-e.level}),s.slice(0,3)},
Progress.prototype.sendStuckFriendsHelp=function(e,t){var i=e.map(function(e){return e.id});cleverapps.social.sendRequest(i,"stuckHelpGold",function(){i.forEach(function(e){cleverapps.friends.inApp(e)&&levels.friendRequests.sendServerRequest(e,levels.FriendRequest.TYPE_STUCK_HELP_COINS)}),this.data.forEach(function(e){-1!==i.indexOf(e.id)&&(e.helpTime=Date.now())}),this.save(Progress.FILTER_FRIENDS),t()}.bind(this))},Progress.prototype.getFromServer=function(i){var s=this.listIds(i);if(0!==s.length){var e=function(e){this.updateInProgress=!1;var t=cleverapps.friends.listIds();this.data||(this.data=[]);var r={};this.data.forEach(function(e){r[e.id]=e}),this.data=this.data.filter(function(e){return-1!==t.indexOf(e.id)&&-1===s.indexOf(e.id)}),e.forEach(function(e){var t=e.id,i=e.episode,s=e.level;i>=levels.episodes.getAmountEpisodes()&&(i=levels.episodes.getAmountEpisodes()-1,s=Episode.LEVELS_PER_EPISODE-1);var n=r[e.id],o=Date.now();n&&n.updateTime&&n.episode===i&&n.level===s&&(
o=n.updateTime);var a={id:t,episode:i,level:s,updateTime:o};n&&n.helpTime&&(a.helpTime=n.helpTime),this.data.push(a)},this),this.save(i)}.bind(this),t=s.join(",");this.updateInProgress=!0,cleverapps.RestClient.get("/progress/"+t,{},e,function(e){console.log("Failure loading friends progress: ",e)})}},levels.EpisodesScene=MainScene.extend({ctor:function(){this._super(),this.customize(),new levels.EpisodesController(this.scene),PlayButton.IsAvailable()&&(this.scene.playButton=new PlayButtonView,this.scene.addChild(this.scene.playButton),this.scene.playButton.addFingerTip())},customize:function(){}}),cleverapps.styles.EpisodesScene={},levels.EpisodesScene.BUNDLES=function(){for(var e=[],t=[],i=0;i<cleverapps.styles.PagesView.visiblePages;i++){e.push("episode_"+(levels.user.episode+i));var s="episode_"+(levels.user.episode+i)+"_external";bundles[s]&&(cc.sys.isNative?t=t.concat(bundles[s].urls):e.push(s))}return t.forEach(function(e){cc.loader.load(e)}),e};var Episode=function(e,t,i,s){s={
type:Episode.Types.REGULAR};for(var n=0;n<arguments.length;n++){var o=arguments[n];if("object"!=typeof o)if(Episode.TypeValues[o]&&(s.type=o),-1!==[Episode.Types.BONUSROUNDS,Episode.Types.DAILY_LEVELS,Episode.Types.EDITOR].indexOf(o)&&(s.episodeNo=o),cleverapps.isNumber(o))s[void 0===s.episodeNo?"episodeNo":"levelNo"]=o;else isNaN(parseInt(o))||void 0!==s.episodeNo||(s.episodeNo=o);else cleverapps.override(s,o)}this.episodeNo=s.episodeNo,this.levelNo=s.levelNo,this.copyData=s.copyData,this.type=s.type,this.onLoadListener=function(){},this.onRemoveListener=function(){},this.whenLoadedListeners=[],this.init()};Episode.prototype.isComingSoon=function(){return this.episodeNo===Episodes.getAmountEpisodes()},Episode.prototype.init=function(){this.loaded=!1,this.levelsPerEpisode=Episode.LEVELS_PER_EPISODE,void 0!==bundles[this.bundleId()].levelsAmount&&(this.levelsPerEpisode=bundles[this.bundleId()].levelsAmount),(this.isComingSoon()||void 0!==this.levelNo)&&(this.levelsPerEpisode=1)
;var e=void 0!==this.levelNo?[this.levelNo]:cleverapps.rangeArray(0,this.levelsPerEpisode-1);this.levels=e.map(function(e){var t=cleverapps.userresult.getStarsForLevel(this.episodeNo,e);return new Level(this,e,t)}.bind(this))},Episode.prototype.getLevel=function(e){return void 0!==this.levelNo&&(e=0),this.levels[e]},Episode.prototype.isRegular=function(){return this.type===Episode.Types.REGULAR},Episode.prototype.getCurrentLevel=function(){for(var e in this.levels){var t=this.levels[e];if(t.type===Level.TYPE_CURRENT)return t}},Episode.prototype.whenLoaded=function(e,t){this.loaded?e(this):(t||cleverapps.bundleLoader.addBlockWindow(),this.whenLoadedListeners.push(function(){cleverapps.bundleLoader.removeBlockWindow(),e(this)}.bind(this)))},Episode.prototype.isPassed=function(){return levels.user.episode>this.episodeNo},Episode.prototype.isCurrent=function(){return levels.user.episode===this.episodeNo},Episode.prototype.destructor=function(){this.loadTask&&this.loadTask.cancel(),
this.loadDataStarted&&cleverapps.bundleLoader.deleteBundle(this.bundleId()),this.onRemoveListener(),this.deleted=!0},Episode.BundleId=function(e,t){t=t||cleverapps.settings.language;var i="episode_"+e;return"board"===cleverapps.config.type&&"en"!==t&&e!==Episode.Types.DAILY_LEVELS&&(i+="_"+t),i},Episode.prototype.bundleId=function(){return this.episodeNo===Episodes.getAmountEpisodes()?"episode_coming_soon":Episode.BundleId(this.episodeNo)},Episode.prototype.finishWait=function(){this.waitCounter--,0===this.waitCounter&&this.onceLoaded()},Episode.prototype.loadData=function(){if(this.loadDataStarted||this.deleted)return cleverapps.NO_ACTION;this.loadDataStarted=!0,this.loadDataInt()},Episode.prototype.loadDataInt=function(){this.waitCounter=1,this.loadTask=new SuccessWait(function(e){cleverapps.bundleLoader.loadBundle(this.bundleId(),e)}.bind(this),this.finishWait.bind(this))},Episode.prototype.onceLoaded=function(){this.loaded=!0,this.onLoadListener&&this.onLoadListener(),
this.whenLoadedListeners.forEach(cleverapps.callFunc),this.whenLoadedListeners=[]},Episode.prototype.getHardLevels=function(){return this.getBundle().hard||[]},Episode.prototype.getBundle=function(){return bundles[this.bundleId()]},Episode.prototype.getContent=function(){return this.content||(this.content=cc.loader.getRes(this.getBundle().jsons.levels),this.copyData&&(this.content=JSON.parse(JSON.stringify(this.content)))),this.content},Episode.prototype.getLevels=function(){var e=this.getContent();return Array.isArray(e)?e:e.levels},Episode.prototype.isDebug=function(){return this.getContent().debug},Episode.prototype.getHashes=function(){var i={};return this.getLevels().forEach(function(e,t){Object.assign(i,this.getLevelHashes(t))}.bind(this)),i},Episode.prototype.getLevelHashes=function(s){var n={},o=this.getLevelVersions(s);return Object.keys(o).map(cleverapps.castType).sort().forEach(function(e){var t=o[e],i=Level.CalcHash(t);n[i]={levelNo:s,version:e,hash:i}}),n},
Episode.prototype.getLevelVersions=function(e){var t=this.getLevels();t&&t[e]||cleverapps.ReportStream.debug("No levels for episode "+this.episodeNo+" level "+e);var i=t[e];Array.isArray(i)||(i=[i]);var s={};return i.forEach(function(e,t){var i=e.version||t;s[i]=e}),s},Episode.prototype.getMaxVersion=function(e){var t=0;for(var i in e)t=Math.max(t,parseInt(i));return t},Episode.prototype.getLevelContent=function(e){var t=this.getLevelVersions(e),i=this.getMaxVersion(t);cleverapps.config.editorMode&&void 0!==LevelManager.getInstance().version&&!cleverapps.environment.isMainScene()&&(i=LevelManager.getInstance().version);var s=t[i];return s.episodeNo=this.episodeNo,s.levelNo=e,s.version=i,s},Episode.prototype.isDailyCup=function(){return this.type===Episode.Types.DAILYCUP},Episode.prototype.isBonusRound=function(){return this.type===Episode.Types.BONUSROUNDS},Episode.prototype.isDailyLevel=function(){return this.type===Episode.Types.DAILY_LEVELS},Episode.LevelChooseAlgorithm=function(e){
var t=e.start,i=e.finish||levels.episodes.getAmountEpisodes(),s=e.seed,n=t*Episode.LEVELS_PER_EPISODE,o=i*Episode.LEVELS_PER_EPISODE-1;void 0!==s&&cleverapps.Random.seed(s);var a=cleverapps.Random.random(n,o);return{levelNo:a%Episode.LEVELS_PER_EPISODE,episodeNo:Math.floor(a/Episode.LEVELS_PER_EPISODE)}},Episode.LEVELS_PER_EPISODE=15,Episode.Types={REGULAR:"regular",BONUSROUNDS:"bonusrounds",EDITOR:"editor",DAILY_LEVELS:"daily_levels",DAILYCUP:"dailycup"},Episode.TypeValues=cleverapps.createSet(cleverapps.values(Episode.Types));var HoseEpisode=function(e){Episode.apply(this,arguments),this.onAnimatePass=void 0,this.onAnimateOpen=void 0,this.onExternalLoadListener=function(){}};HoseEpisode.prototype=Object.create(Episode.prototype),(HoseEpisode.prototype.constructor=HoseEpisode).prototype.currentLevelPosition=function(e){var t=cleverapps.styles.LevelView[this.getBundle().levelPositions||"levels_1"];return t&&t[e]},HoseEpisode.prototype.init=function(){Episode.prototype.init.call(this,
arguments),this.externalLoaded=!1,cleverapps.userresult.loadEpisode(this.episodeNo),this.friendsResults=new Results(this),this.updateProgress()},HoseEpisode.prototype.updateProgress=function(){var t=[],s={};this.levels.forEach(function(e,t){e.players.forEach(function(e){s[e]=t})});var e=levels.progress.listByEpisode(this.episodeNo),i=[];e.forEach(function(e){e.level!==s[e.id]&&t.push(e),i.push(e.id)}),t.forEach(function(e){var t=this.levels[s[e.id]];t&&t.removePlayer(e.id);var i=this.levels[e.level];i?i.insertPlayer(e.id):console.log("No level for player: "+e.id+" at "+e.level)},this),Object.keys(s).forEach(function(e){if(-1===i.indexOf(e)){var t=this.levels[s[e]];t&&t.removePlayer(e)}},this)},HoseEpisode.prototype.isFirstNotInShadow=function(){return!!this.isAvailableToPlay()&&cleverapps.user.episode-this.episodeNo==Episode.FRESH_EPISODES-1},HoseEpisode.prototype.destructor=function(){this.externalLoadTask&&this.externalLoadTask.cancel(),
this.friendsResults&&this.friendsResults.destructor(),this.loadDataStarted&&(cleverapps.bundleLoader.deleteBundles(this.listRpgBundles()),cleverapps.bundleLoader.deleteBundle(this.bundleExternalId())),Episode.prototype.destructor.apply(this,arguments)},HoseEpisode.prototype.bundleExternalId=function(){return this.bundleId()+"_external"},HoseEpisode.prototype.listRpgBundles=function(){var i=[];return!cleverapps.config.rpg||"number"!=typeof this.episodeNo||this.episodeNo>=Episodes.getAmountEpisodes()?i:(i.push(this.getIslandBundleId()),"runes"!==cleverapps.config.name||this.isPassed()||!cleverapps.styles.IslandEnemies[this.episodeNo]||cleverapps.styles.IslandEnemies[this.episodeNo].forEach(function(e){var t=cleverapps.Spine.jsonToBundle[e.enemy];t&&bundles[t]&&i.push(t)}),i)},HoseEpisode.WAIT_FOR_EXTERNAL_TIMEOUT=3e3,HoseEpisode.prototype.waitExternal=function(){this.waitExternalTimeout=void 0,this.finishWait()},HoseEpisode.prototype.loadDataInt=function(){this.waitCounter=1,
this.getExternalBundle()&&!this.externalLoaded&&(this.waitCounter++,this.waitExternalTimeout=setTimeout(this.waitExternal.bind(this),Episode.WAIT_FOR_EXTERNAL_TIMEOUT),this.externalLoadTask=new SuccessWait(function(e){cleverapps.bundleLoader.loadBundle(this.bundleExternalId(),e)}.bind(this),this.onceExternalLoaded.bind(this))),this.loadTask=new SuccessWait(function(e){var t=[this.bundleId()].concat(this.listRpgBundles());cleverapps.bundleLoader.loadBundles(t,e)}.bind(this),this.finishWait.bind(this))},HoseEpisode.prototype.onceExternalLoaded=function(){this.externalLoaded=!0,this.loaded&&this.onExternalLoadListener&&this.onExternalLoadListener(),this.waitExternalTimeout&&(clearTimeout(this.waitExternalTimeout),this.finishWait())},HoseEpisode.prototype.onceLoaded=function(){Episode.prototype.onceLoaded.apply(this,arguments),(this.getExternalBundle()&&this.externalLoaded||!this.getExternalBundle())&&this.onExternalLoadListener&&this.onExternalLoadListener()},
HoseEpisode.prototype.getIslandBundleId=function(){return"episode_"+Math.floor(this.episodeNo/10)+"_island"},HoseEpisode.prototype.getIslandBundle=function(){return bundles[this.getIslandBundleId()]},HoseEpisode.prototype.getExternalBundle=function(){if(cleverapps.metha.getType()===Metha.HOSE)return bundles[this.bundleExternalId()]},HoseEpisode.prototype.animatePass=function(e){this.onAnimatePass?this.onAnimatePass(e):e()},HoseEpisode.prototype.animateOpen=function(e){this.onAnimateOpen?this.onAnimateOpen(e):e()},HoseEpisode.isFreshEpisode=function(e){return e>=cleverapps.user.episode-HoseEpisode.FRESH_EPISODES+1&&e<=cleverapps.user.episode},HoseEpisode.prototype.isFreshEpisode=function(){return HoseEpisode.isFreshEpisode(this.episodeNo)},HoseEpisode.prototype.isAvailableToPlay=function(){return!!cleverapps.config.editorMode||(cleverapps.config.results?this.isFreshEpisode():levels.user.episode>=this.episodeNo)},HoseEpisode.FRESH_EPISODES=3;var EpisodesManager={create:function(){switch(
cleverapps.config.name){case"riddles":case"runes":case"adventure":case"crocword":return new HoseEpisodes}return new FakeEpisodes}},Episodes=function(){this.getAmountEpisodes=Episodes.getAmountEpisodes};Episodes.prototype.reset=function(){delete Episodes.amountEpisodes},Episodes.getAmountEpisodes=function(){return void 0===Episodes.amountEpisodes&&(Episodes.amountEpisodes=Episodes.calcAmountEpisodes()),Episodes.amountEpisodes},Episodes.calcAmountEpisodes=function(){for(var e=0;void 0!==bundles[Episode.BundleId(e)];){var t=bundles[Episode.BundleId(e)];if(!t.jsons||!t.jsons.levels)break;e++}return e};var HoseEpisodes=function(){Episodes.call(this),this.episodes={},this.onAddEpisode=function(e){},levels.user.onLevelStatusChanged=function(e,t){var i=this.episodes[e];i&&i.levels[t].update()}.bind(this);var e={};cc.sys.isNative&&"match3"===cleverapps.config.type&&(e={amount:cleverapps.styles.PagesView.visiblePages+2,interval:"2 seconds",delay:"2 seconds"}),
this.loadEpisodesExecutor=new ExecutorPool(e),cleverapps.config.results&&cleverapps.friends.addFriendsUpdatedListener(function(){for(var e in this.episodes){this.episodes[e].friendsResults.whenFriendListUpdated()}}.bind(this)),cleverapps.friends.addFriendsUpdatedListener(function(){levels.progress.whenFriendListUpdated()}),levels.progress.onUpdated=function(){for(var e in this.episodes){this.episodes[e].updateProgress()}}.bind(this),cleverapps.metha.getType()===Metha.HOSE&&this.reset()};HoseEpisodes.prototype=Object.create(Episodes.prototype),(HoseEpisodes.prototype.constructor=HoseEpisodes).prototype.gamePlayed=function(e,t){},HoseEpisodes.prototype.getActiveEpisode=function(){var e=levels.user.getCurrentLevel(),t=this.episodes[e.episodeNo];return t||(this.addEpisode(e.episodeNo),(t=this.episodes[e.episodeNo]).loadData()),t},HoseEpisodes.prototype.wantsToPlay=function(e,t){var i=this.getActiveEpisode().getLevel(levels.user.getCurrentLevel().levelNo);((t=t||{}
).playNext||t.dailyTask||t.mission||LevelStartWindow.isAvailable(i.episode.episodeNo,i.levelNo))&&BoostersBefore.isAvailable()?cleverapps.metha.compound(e,[function(e){t.playNext?cleverapps.Plot.GameLeave(e,t):e()},function(e){cleverapps.metha.controlFreeFocus("MenuBarGoldItem"),new LevelStartWindow({level:i}),cleverapps.metha.onceNoWindowsListener=e}]):(cleverapps.metha.controlFreeFocus("mainTableView"),i.play(e))},HoseEpisodes.prototype.reset=function(){for(var e in delete this.currentEpisode,this.episodes)this.removeEpisode(e);this.episodes={},Episodes.prototype.reset.apply(this,arguments)},HoseEpisodes.prototype.addEpisode=function(e){var t=new HoseEpisode(e);this.episodes[e]=t,this.onAddEpisode(t)},HoseEpisodes.prototype.removeEpisode=function(e){this.episodes[e].destructor(),delete this.episodes[e]},HoseEpisodes.prototype.getCurrentEpisode=function(){return this.episodes[this.currentEpisode]},HoseEpisodes.prototype.loadCurrentEpisode=function(e){var t=[this.getCurrentEpisode()]
;cleverapps.styles.PagesView.noAutoScroll&&this.episodes[this.currentEpisode+1]&&t.push(this.episodes[this.currentEpisode+1]);var i=cleverapps.wait(t.length,e);t.forEach(function(e){e.whenLoaded(i)})},HoseEpisodes.prototype.range=function(e,t,i){return cleverapps.rangeArray(e+t,e+i).filter(function(e){return 0<=e&&e<=this.getAmountEpisodes()}.bind(this))},HoseEpisodes.prototype.setCurrentEpisode=function(t){void 0===(t=parseInt(t))&&(t=levels.user.episode),t>=this.getAmountEpisodes()&&(t=this.getAmountEpisodes()),this.currentEpisode=t;var e,i,s=Object.keys(this.episodes).map(function(e){return parseInt(e)});if(this.currentEpisode<0)e=s.concat(s.indexOf(this.currentEpisode)<0?[this.currentEpisode]:[]).filter(function(e){return 0<=e||e===t}),i=[t];else{var n=cleverapps.styles.PagesView.visiblePages;e=this.range(t,-1,n+1),i=this.range(t,cleverapps.styles.PagesView.prevEpisodeShowed?-1:0,n)}cleverapps.substract(s,e).forEach(function(e){this.removeEpisode(e)},this),cleverapps.substract(e,s
).forEach(function(e){this.addEpisode(e)},this),i.forEach(function(e){this.loadEpisodesExecutor.execute(function(){return this.episodes[e]?this.episodes[e].loadData():cleverapps.NO_ACTION}.bind(this))},this)},HoseEpisodes.prototype.nextEpisode=function(){this.currentEpisode+cleverapps.styles.PagesView.visiblePages<=this.getAmountEpisodes()&&this.setCurrentEpisode(this.currentEpisode+1)},HoseEpisodes.prototype.prevEpisode=function(){return 0<this.currentEpisode&&(this.setCurrentEpisode(this.currentEpisode-1),!0)};var FakeEpisodes=function(){Episodes.call(this)};FakeEpisodes.prototype=Object.create(Episodes.prototype),(FakeEpisodes.prototype.constructor=FakeEpisodes).prototype.setCurrentEpisode=function(){},FakeEpisodes.prototype.getCurrentEpisode=function(){};var CloudsAnimation=cc.Node.extend({ctor:function(){this._super(),this.setLocalZOrder(101);var e=this.animation=new cleverapps.Spine(res.episode_clouds_spine_json);if(this.addChild(e),this.inUse=!0,
cleverapps.styles.EpisodeView.text){var t=cleverapps.UI.generateTTFText("messages:LoadingEpisode",cleverapps.styles.FONTS.EPISODE_CLOUD_TEXT);t.setPositionRound(cleverapps.styles.EpisodeView.text.x,cleverapps.styles.EpisodeView.text.y),t.setDimensions(.5*cleverapps.UI.getSceneSize().width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.addChild(t),(this.text=t).setAnchorPoint2()}},startLoadAnimation:function(e){this.animation.setAnimation(0,"idle",!0),this.setVisible(!1),this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){this.visible=e.isRunningSafe()&&e.visible,this.text&&this.text.runAction(new cc.FadeIn(.3))}.bind(this))))},finishLoadAnimation:function(e){this.animation.setAnimation(0,"open",!1),this.animation.setCompleteListener(function(){this.finishAnimation(e)}.bind(this)),this.text&&(this.text.stopAllActions(),this.text.runAction(new cc.FadeOut(.7)))},finishAnimation:function(e){this.inUse&&(this.inUse=!1,cc.pool.putInPool(this),
"function"==typeof e&&e())},unuse:function(){this.animation.visible=!1,this.animation.setCompleteListener(function(){}),this.animation.setStartVisibleListener(function(){}),this.removeFromParent()},reuse:function(){this.inUse=!0}});CloudsAnimation.factory=function(){return cc.pool.hasObject(CloudsAnimation)?cc.pool.getFromPool(CloudsAnimation):new CloudsAnimation},levels.EpisodesController=function(i){var e=levels.episodes.currentLevel,t=levels.episodes.getCurrentEpisode();t||(levels.episodes.setCurrentEpisode(levels.user.episode),t=levels.episodes.getCurrentEpisode());var s=t.episodeNo;(cleverapps.user.episode<s||!t.isAvailableToPlay()&&!t.isComingSoon())&&(e=s=void 0),void 0===s&&(s=levels.user.episode),void 0===e&&(e=s===levels.user.episode?levels.user.level:0),levels.episodes.changeEpisodeAnimation&&(s=levels.user.episode-1,e=Episode.LEVELS_PER_EPISODE-1),levels.episodes.currentEpisode!==s&&levels.episodes.setCurrentEpisode(s);var n=new PagesView({
currentLevelPos:levels.episodes.episodes[s].currentLevelPosition(e),disableLevelScroll:levels.episodes.disableLevelScroll,beginPage:s,amountPages:levels.episodes.getAmountEpisodes()+1,swallowTouches:!0});n.setLocalZOrder(-1),cleverapps.styles.EpisodeView.parallaxContainer?i.parallaxContainer.addChild(n):i.addChild(n),cleverapps.styles.EpisodesScene.hidable&&(cleverapps.UI.makeHideable(n),cleverapps.metha.registerControl("mainTableView",n)),i.updateBackgroundScale=function(){n.updateParallaxBackgroundsScale()};var o=function(e){if(n.autoScroll){var t=n.currentPage!==levels.episodes.currentEpisode;n.currentPage=levels.episodes.currentEpisode,n.scrollToCurrentPage(!1,t,e)}};levels.episodes.scrollToCurrentLevel=function(){n.scrollToCurrentLevel(!1)},levels.episodes.scrollToCurrentEpisode=function(e,t,i){n.currentPage=levels.episodes.currentEpisode,n.scrollToCurrentPage(e,t,i,levels.episodes.currentEpisode)};var a=function(){};for(var r in n.onScrolledToCurrentPage=function(){
cleverapps.bundleLoader.clearUnusedResources(),a()},levels.episodes.gotoNextEpisode=function(e,t,i){a=function(){a=function(){},e()},n.autoScroll?(levels.episodes.nextEpisode(),o(t)):n.scrollToCurrentPage(!1,!0,t,void 0!==i?i:levels.episodes.currentEpisode+1)},levels.episodes.gotoPrevEpisode=function(e){n.autoScroll?(levels.episodes.prevEpisode(),o(e)):n.scrollToCurrentPage(!1,!0,e,levels.episodes.currentEpisode-1)},n.onNextPageListener=function(){levels.episodes.nextEpisode(),o()}.bind(this),n.onPrevPageListener=function(){levels.episodes.prevEpisode(),o()}.bind(this),this.addPage=function(e){if(e.isComingSoon()){var t=new ComingSoonEpisodeView(e,i);n.addPage(t)}else if(0<=e.episodeNo){t=new EpisodeView(e,i);n.addPage(t)}},levels.episodes.onAddEpisode=n.createListener(this.addPage),levels.episodes.episodes)this.addPage(levels.episodes.episodes[r]);this.customize()},levels.EpisodesController.prototype.customize=function(){};var PagesView=PagingScrollView.extend({ctor:function(e){
this.options=e;var t=cleverapps.UI.getSceneSize(),i=cleverapps.styles.PagesView;this.currentLevelPos=e.currentLevelPos,this.disableLevelScroll=e.disableLevelScroll;var s="scene"===i.pageWidth?t.width:i.pageWidth,n="scene"===i.pageHeight?t.height:i.pageHeight;this._super({beginPage:e.beginPage,amountPages:e.amountPages,swallowTouches:e.swallowTouches,noWheelScroll:e.noWheelScroll,styles:i,pageWidth:s,pageHeight:n}),this.setAnchorPoint(.5,.5);var o="scene"===i.width?t.width:i.width,a="scene"===i.height?t.height:i.height;this.setContentSize(o,a),this.calcFirstOffset(),this.parallax=new PagesViewParallax(i.parallax,this.container,i.direction),i["3d"]&&this.scheduleUpdate();var r=cleverapps.styles.PagesView.maxWidth;r&&r<o&&this.setScale(o/r)},updateParallaxBackgroundsScale:function(){this.parallax.updateScale()},update:function(e){if(this._super(e),cleverapps.styles.PagesView["3d"]){var a,r=cleverapps.styles.PagesView["3d"]
;a=cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?r.mobileScales:r.scales,this.getVisiblePages().forEach(function(e){var t=this.height,i=-this.container.y,s=(t-(e.y-i)+this.pageHeight/2)/t,n=(s=s<1?s:1)*a[1]+a[0],o=n;r.horizont&&(o=s*a[1]+(s*(1-r.horizont.scale)+r.horizont.scale)*a[0]),e.setScale(n,o),e.setLocalZOrder(-e.pageNo)}.bind(this))}},scrollToCurrentLevel:function(e){this.autoScroll||!this.currentLevelPos||this.disableLevelScroll&&e||this.scrollToPositionInPage(this.currentLevelPos,e)},showAnimation:function(e,t){if(this.stopAllActions(),e)return this.visible=!0,void this.setScale(1);this.getPages().forEach(function(e){e.setVisible(this.currentPage===e.pageNo)}.bind(this)),this.visible=!0,this.runAction(new cc.Sequence(new cc.DelayTime(t||0),new cc.ScaleTo(.25,1),new cc.CallFunc(function(){this.showCurrentPageOnly()}.bind(this))))},hideAnimation:function(e,t){if(this.stopAllActions(),e)return this.setScale(0),void(this.visible=!1);this.getPages().forEach(function(e){
e.setVisible(this.currentPage===e.pageNo)}.bind(this)),this.runAction(new cc.Sequence(new cc.DelayTime(t||0),new cc.ScaleTo(.15,0),new cc.CallFunc(function(){this.visible=!1}.bind(this))))},onEnter:function(){this._super(),this.customize(),this.scrollToCurrentPage(!0),this.scrollToCurrentLevel(!0)},customize:function(){this.setPosition(this.width/2,this.height/2+30*resolutionScale)}});cleverapps.styles.PagesView={direction:PagingScrollView.DIRECTIONS.Horizontal,height:1200,width:"scene",visiblePages:1,prevEpisodeShowed:!1,pageHeight:1200,pageWidth:"scene","3d":!1,parallax:{speed:[0,.15],zIndex:[-1e3,-999],layers:[1,2,2],bundle:"episodes_spines",width:"scene",height:"scene"}};var EpisodeView=cc.Node.extend({ctor:function(e,t){this._super(),this.episode=e,this.pageNo=e.episodeNo,this.levels=[],this.setAnchorPoint(.5,.5),(this.episode.currentView=this).episodesScene=t;var i=cleverapps.UI.getSceneSize(),s=cleverapps.styles.EpisodeView.height,
n=cleverapps.styles.EpisodeView.offsetEpisodes?-cleverapps.UI.getSceneOffsetY():0;if(cleverapps.styles.EpisodeView.direction===cleverapps.UI.VERTICAL?(this.setPositionRound(i.width/2,s*(e.episodeNo+.5)+n),this.bgScale=(s+cleverapps.styles.EpisodeView.addPixels)/s):(this.setPosition(i.width*(e.episodeNo+.5),s/2),this.bgScale=(i.width+cleverapps.styles.EpisodeView.addPixels)/i.width),this.isCustomBackground()||this.addDefaultBackground(),e.onLoadListener=this.createListener(this.onLoad.bind(this)),e.getExternalBundle()&&e.externalLoaded&&e.loaded||!e.getExternalBundle()&&e.loaded?this.onExternalLoad():e.onExternalLoadListener=this.createListener(this.onExternalLoad.bind(this)),e.onRemoveListener=this.createListener(this.onDelete.bind(this)),this.setLocalZOrder(-e.episodeNo),cleverapps.config.debugMode&&cleverapps.styles.EpisodeView.episodeNum&&!cleverapps.screenshotsMode){var o=cleverapps.UI.generateTTFText("Episode #"+this.episode.episodeNo,cleverapps.styles.FONTS.BUTTON_TEXT,{})
;this.addChild(o),o.setPositionRound(cleverapps.styles.EpisodeView.episodeNum.position),o.setLocalZOrder(10)}this.updateScale()},customize:function(){},updateScale:function(){var e=cleverapps.styles.EpisodeView;if(e.scale)this.setScale(e.scale);else{var t=cleverapps.UI.getSceneSize().width/(e.Background.width+e.padding);(t=Math.max(e.minScale,t))<1&&this.setScale(t)}this.baseScale=this.scale},onShow:function(){this.episode.loaded?this.onLoad():this.startLoadAnimation()},onDelete:function(){this.removeLoadAnimation(),this.removeNotOpennedAnimation(),this.removeFromParent()},addBetweenEpisodesFlag:function(){var e=cleverapps.styles.LevelView;if(e.betweenEpisodesFlag&&(e=e.betweenEpisodesFlag)[this.episode.getBundle().levelPositions]){var t=this.episode.bundleId(),i=e[this.episode.getBundle().levelPositions];if(!1!==i[t]){var s=new cleverapps.Spine(e.spine);s.setPositionRound(i[t]?i[t]:i.default),s.setAnimation(0,this.episode.episodeNo<levels.user.episode?e.passed:e.notpassed,!0),
this.addChild(s)}}},onLoad:function(){this.addDescription(),this.finishLoadAnimation(),this.levelViews=[],cleverapps.config.rpg||(this.levelViews=this.episode.levels.map(function(e){var t=LevelView;cleverapps.config.editorMode&&(t=LevelViewEditor);var i=new t(e,this);return this.addChild(i),i},this)),this.addBetweenEpisodesFlag(),this.addPlayerAvatar(),this.addFingerTip(),this.addTitle(),this.customize(),this.episode.getExternalBundle()&&!this.episode.externalLoaded&&this.addDefaultBackground()},onExternalLoad:function(){this.addSpines(),this.addIsland(),this.addBackground()},addTitle:function(){if("undefined"==typeof match3){var e={episodeNo:this.episode.episodeNo+1},t=cleverapps.styles.EpisodeView.title,i="messages:EpisodeView.Title";if(this.episode.isComingSoon()&&(i="messages:EpisodeView.ComingSoonTitle"),t.bg){var s=cleverapps.UI.createScale9Sprite(t.bg.image);this.addChild(s),s.setPositionRound(t.bg),s.setContentSize2(t.bg)}var n=this.title=cleverapps.UI.generateTTFText(i,
cleverapps.styles.FONTS.EPISODE_TITLE_TEXT,e);n.y=t.y,this.addChild(n,1)}},addDescription:function(){if("board"===cleverapps.config.type&&"stacks"!==cleverapps.config.subtype){var e,t=cleverapps.styles.EpisodeView;if(this.episode.isComingSoon())(e=cleverapps.UI.generateTTFText("messages:EpisodeView.ComingSoonDescription",cleverapps.styles.FONTS.DESCRIPTION_TEXT)).fitTo(.9*t.Background.width);else{for(var i=100,s=0,n=0;n<this.episode.levelsPerEpisode;n++){var o=this.episode.getLevelContent(n);i=Math.min(i,o.base.length),s=Math.max(s,o.base.length)}var a=Math.round(i/3+s/2-2);a<1&&(a=1),5<a&&(a=5),a=this.formatDifficulty(a);var r=i+" - "+s;i===s&&(r=i),e=cleverapps.UI.generateTTFText("messages:EpisodeView.Description",cleverapps.styles.FONTS.DESCRIPTION_TEXT,{letters:r,difficulty:a})}(this.description=e).y=t.description.y,this.addChild(e)}},isCustomBackground:function(){return this.episode.getExternalBundle()||this.episode.getBundle().urls.background},addBackground:function(){
var e=this.episode.getExternalBundle()&&this.episode.getExternalBundle().urls.background||this.episode.getBundle().urls.background;if(e){if(void 0===cc.loader.getRes(e))return console.log("No bg image loaded, using default: "+e),void this.addDefaultBackground();this.bg=new cc.Sprite(cc.loader.getRes(e)),this.bg.setScale(this.bgScale),this.bg.setLocalZOrder(-1),this.addChild(this.bg)}},addDefaultBackground:function(){if("undefined"==typeof match3){var e=cleverapps.styles.EpisodeView.Background;this.bg=cleverapps.UI.createScale9Sprite(bundles.main.frames.episode_bg_png,cleverapps.UI.Scale9Rect.TwoPixelY),this.bg.setContentSize(e.width,e.height),this.bg.y=e.y,this.bg.setLocalZOrder(-1),this.addChild(this.bg),SceneDecors.add(this.bg,cleverapps.skins.getSlot("episodeView"))}else bundles.main.urls.blank_bg_jpg&&(this.bg=new cc.Sprite(bundles.main.urls.blank_bg_jpg),this.bg.setScale(2*this.bgScale),this.bg.setLocalZOrder(-2),this.addChild(this.bg))},addSpines:function(){
var e=this.episode.getExternalBundle()&&this.episode.getExternalBundle().urls.png;if(e)if(void 0!==cc.loader.getRes(e))for(var t=0;t<10;t++){var i=this.episode.getExternalBundle().jsons["spine_"+t+"_json"];if(!i)break;var s=new cleverapps.Spine(i);s.setAnimation(0,"animation",!0),s.setLocalZOrder(1),this.animation=s,this.addChild(s)}else console.log("No spines image loaded")},addIsland:function(){var e=this.episode.getIslandBundle();if(e&&e.jsons["island_"+this.episode.episodeNo+"_json"]){var t=this.island=new IslandView(this.episode,this.episodesScene);t.setLocalZOrder(3),this.addChild(t)}},removeLoadAnimation:function(){this.loading&&(this.loading.finishAnimation(),delete this.loading)},removeNotOpennedAnimation:function(){this.notOpennedAnimation&&(this.notOpennedAnimation.removeFromParent(),delete this.notOpennedAnimation)},startLoadAnimation:function(){if(cleverapps.styles.EpisodeView.loadAnimation){var e=CloudsAnimation.factory();e.pageNo=this.pageNo,e.setPositionRound(
this.getPosition()),this.getParent().addChild(e),(this.loading=e).startLoadAnimation(this)}},formatDifficulty:function(e){return e},finishLoadAnimation:function(){if(cleverapps.styles.EpisodeView.loadAnimation){if(this.loading)if(cc.director.getRunningScene()instanceof levels.EpisodesScene&&this.loading.visible){var e=cleverapps.styles.EpisodeView;e.openSound&&cleverapps.audio.playSound(res[e.openSound]),this.loading.finishLoadAnimation(this.removeLoadAnimation.bind(this))}else this.removeLoadAnimation();if(cleverapps.styles.EpisodeView.oldAnimation&&!this.episode.isComingSoon()&&cleverapps.user.episode>=this.episode.episodeNo){var t;if(this.episode.isAvailableToPlay())this.episode.isFirstNotInShadow()&&(t=new cleverapps.Spine(res.episode_clouds_line_spine_json)).setAnimation(0,"animation",!0);else{(t=new cleverapps.Spine(res.episode_clouds_spine_json)).setAnimation(0,"old",!0);var i=cleverapps.UI.generateTTFText("messages:EpisodeView.TooOldEpisode",
cleverapps.styles.FONTS.EPISODE_CLOUD_TEXT);i.setPositionRound(t.width/2,t.height/2+cleverapps.styles.EpisodeView.text.y),i.setDimensions(.5*cleverapps.UI.getSceneSize().width,0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setAnchorPoint2(),t.addChild(i)}t&&(t.setLocalZOrder(100),t.pageNo=this.pageNo,t.setPositionRound(this.getPosition()),this.getParent().addChild(t),this.notOpennedAnimation=t)}}},createUserView:function(){return new cleverapps.UI.Avatar(cleverapps.friends.getPlayer())},addPlayerAvatar:function(){var e=this.levelViews[levels.user.level];if(e&&!this.userView&&levels.user.episode===this.episode.episodeNo&&!this.episode.isComingSoon())if(cleverapps.social.isLoggedIn()){var t,i=this.userView=this.createUserView(),s=e.inLeftLevels(!0);cleverapps.styles.EpisodeView["player"+levels.user.level]?(t=cleverapps.styles.EpisodeView["player"+levels.user.level],s&&cleverapps.styles.EpisodeView["playerLeftLevels"+levels.user.level]&&(
t=cleverapps.styles.EpisodeView["playerLeftLevels"+levels.user.level])):(t=cleverapps.styles.EpisodeView.player,s&&cleverapps.styles.EpisodeView.playerLeftLevels&&(t=cleverapps.styles.EpisodeView.playerLeftLevels)),i.setPosition(e.getPosition()),i.x+=e.width/2+t.x,i.y+=e.height/2+t.y,void 0!==t.scale&&i.setScale(i.getScale()*t.scale),this.addChild(i),i.setLocalZOrder(4)}else cleverapps.friends.onUserUpdatedListener=this.createListener(function(){this.addPlayerAvatar()}.bind(this))},addFingerTip:function(){if(levels.user.episode===this.episode.episodeNo&&!this.episode.isComingSoon()&&cleverapps.styles.EpisodeView.fingerTip){var e=this.levelViews[levels.user.level];if(!e||e.fingerTip)return;var t=new FingerView({control:"episode_view_finger"});t.setLocalZOrder(14),e.fingerTip=t,e.addChild(t),t.setPositionRound(e.width/2,e.height/2),t.delay(cleverapps.styles.EpisodeView.finger.delay),t.fadeIn(new cc.p(0,0)),t.press(),t.delay(.3),t.unPress(),t.delay(.1),t.press(),t.delay(.3),t.unPress(),
t.fadeOut(),t.run({looped:!0})}}});cleverapps.styles.EpisodeView={height:cleverapps.styles.SCENE_HEIGHT,paddingTop:300,parallaxContainer:!0,addPixels:2,direction:cleverapps.UI.HORIZONTAL,Background:{width:720,height:1200},title:{y:490},description:{y:420},player:{x:5,y:5},episodeNum:{position:[{x:-180,y:480},{x:-540,y:480},{x:-540,y:480}]},finger:{delay:5},loadAnimation:!1,oldAnimation:!1,openSound:!1};var ComingSoonEpisodeView=EpisodeView.extend({ctor:function(e,t){this._super(e,t),this.setLocalZOrder(1)},customize:function(){this._super();var e=cleverapps.styles.EpisodeView.comingSoon;e.textOffset&&(this.title.y+=e.textOffset,this.description.y+=e.textOffset)},onExternalLoad:function(){this._super(),this.addCharacter()},addCharacter:function(){var e=cleverapps.styles.EpisodeView.comingSoon.character;if(e.json)(t=new cleverapps.Spine(e.json)).setAnimation(0,e.animationName,!0);else var t=new cc.Sprite(e.image?e.image:res.character_png);t.setScale(e.scale),t.setPosition(e.x,e.y),
this.addChild(t)},addBackground:function(){if(res.episode_clouds_line_spine_json){var e=new cleverapps.Spine(res.episode_clouds_spine_json);e.setAnimation(0,"idle",!0),e.setLocalZOrder(-1),this.addChild(e)}}});cleverapps.overrideStyles(cleverapps.styles.EpisodeView,{comingSoon:{character:{scale:1,x:0,y:0}}});var Level=function(e,t,i){this.episode=e,this.levelNo=t,this.episodeNo=e.episodeNo,this.stars=i||0,this.players=[],this.update()};Level.prototype.getHash=function(){},Level.prototype.listPlayers=function(){return this.players.length<=3?this.players:this.players.splice(0,3)},Level.prototype.isClickable=function(){return!!cleverapps.config.editorMode||!(this.type===Level.TYPE_NOTPASSED||!this.episode.isAvailableToPlay())&&(this.type===Level.TYPE_CURRENT||"olympics"!==cleverapps.config.name)},Level.prototype.getHumanReadableNumber=function(){return cleverapps.humanReadableNumber(this.episodeNo,this.levelNo)},Level.prototype.insertPlayer=function(e){this.players.push(e)},
Level.prototype.removePlayer=function(e){var t=this.players.indexOf(e);-1<t&&this.players.splice(t,1)},Level.prototype.isRegular=function(){return this.episode.isRegular()},Level.prototype.isCurrentLevel=function(){return this.isRegular()&&levels.user.isCurrentLevel(this.levelNo,this.episode.episodeNo)},Level.prototype.isPassedLevel=function(){return levels.user.isPassedLevel(this.levelNo,this.episode.episodeNo)},Level.prototype.isHard=function(){return-1!==this.episode.getHardLevels().indexOf(this.levelNo)},Level.prototype.isNew=function(){return this.type!==Level.TYPE_PASSED||this.isCurrentLevel()},Level.prototype.isLastLevelOnEpisode=function(){return this.levelNo===this.episode.levelsPerEpisode-1},Level.prototype.getVersion=function(){return void 0===this.version&&(this.version=this.episode.getLevelContent(this.levelNo).version),this.version},Level.prototype.improveStars=function(e){this.stars=e},Level.prototype.loadBundle=function(e){var t=e&&e.onSuccess||function(){};this.load(t)
},Level.prototype.load=function(e,t){this.content&&!cleverapps.config.editorMode?e&&e():(this.episode.loadData(),this.episode.whenLoaded(function(){this.content=this.episode.getLevelContent(this.levelNo),this.hash=Level.CalcHash(this.content),e&&e()}.bind(this),t))},Level.prototype.unload=function(){this.episode.destructor()},Level.CalcHash=function(e){return RecursiveHasher(e,["episodeNo","levelNo","version","hard","paint","extra","gold","hash","hashes","comments","translate","definitions"])},Level.prototype.play=function(e,s){cleverapps.social.requestFullScreen(function(){cleverapps.config.editorMode&&(this.content=void 0,cleverapps.environment.setScene(cleverapps.Environment.SCENE_GAME)),cleverapps.rewardedAdsManager&&cleverapps.isLocalhost()&&cleverapps.rewardedAdsManager.showInterstitial();var i=new SceneProxy;cleverapps.scenes.replaceScene(i,e),this.episode.levels&&1===this.episode.levels.length&&!this.episode.loaded&&i.whenLoaded(function(e){e.registerCleanupCallback(
this.unload.bind(this))}.bind(this)),this.load(function(){var e=new Game(this,s),t=new GameScene(e,this);t instanceof SceneProxy?t.whenLoaded(function(e){i.instance=e,i.onLoad()}):(i.instance=t,i.onLoad())}.bind(this))}.bind(this))},Level.prototype.onPressed=function(){cleverapps.lives&&cleverapps.lives.isEmpty()?cleverapps.metha.display({focus:["LevelPressedNoLives","MenuBarGoldItem","MenuBarLivesItem"],action:function(e){new ShopWindow({tab:ShopWindow.TABS.LIVES}),cleverapps.metha.onceNoWindowsListener=e}}):cleverapps.bet&&!cleverapps.bet.isEnough()?cleverapps.metha.display({focus:["LevelPressedNotEnoughForBet","MenuBarGoldItem"],action:function(e){new ShopWindow({tab:ShopWindow.TABS.COINS}),cleverapps.metha.onceNoWindowsListener=e}}):!BoostersBefore.isAvailable()&&(!0!==cleverapps.config.results||this.isCurrentLevel()&&!this.isHard())||!LevelStartWindow.isAvailable(this.episode.episodeNo,this.levelNo)?cleverapps.metha.display({focus:"LevelPressedPlay",action:function(e){this.play(e)
}.bind(this)}):cleverapps.metha.display({focus:"LevelStartWindow",control:"MenuBarGoldItem",actions:[function(e){this.load(e)}.bind(this),function(e){new LevelStartWindow({level:this}),cleverapps.metha.onceNoWindowsListener=e}.bind(this)]})},Level.prototype.update=function(){cleverapps.metha.getType()===Metha.HOSE?levels.user.episode>this.episode.episodeNo?this.type=Level.TYPE_PASSED:levels.user.episode<this.episode.episodeNo?this.type=Level.TYPE_NOTPASSED:levels.user.level>this.levelNo?this.type=Level.TYPE_PASSED:levels.user.level===this.levelNo?this.type=Level.TYPE_CURRENT:this.type=Level.TYPE_NOTPASSED:this.type=Level.TYPE_CURRENT},Level.prototype.isChampion=function(){if(!this.episode.friendsResults)return!1;var e=this.episode.friendsResults.listTop4(this.levelNo,!0);return!(e.length<=1||levels.user.id!==e[0].id||void 0===e[0].score)},Level.TYPE_PASSED=0,Level.TYPE_CURRENT=1,Level.TYPE_NOTPASSED=2;var PlayerView=cleverapps.UI.Avatar.extend({ctor:function(e,t,i,s){
var n=cleverapps.friends.getById(e);if(this._super(n.avatar),this.id=e,void 0!==t){var o=cleverapps.styles.LevelView;o=t?o["PlayerViewLeft"+s]?o["PlayerViewLeft"+s]:o.PlayerViewLeft:o["PlayerViewRight"+s]?o["PlayerViewRight"+s]:o.PlayerViewRight,this.setPositionRound(o.x,o.y),o.scale&&this.setScale(o.scale)}else{o=cleverapps.styles.LevelView.PlayerView;this.setPositionRound(o.x,o.y),o.scale&&this.setScale(o.scale)}}});PlayerView.TAG=1;var LevelView=cc.Node.extend({ctor:function(e,t){this._super(),this.level=e,void 0!==t&&this.calculatePosition(t),void 0!==t&&t.episode.isComingSoon()?this.setPosition(cleverapps.styles.LevelView.coming_soon[0]):(this.addLevelBg(),this.addLevelId()),this.level.listPlayers().forEach(this.insertPlayer.bind(this)),this.level.isClickable()?(this.addTouchListener(),cleverapps.UI.applyHover(this)):(this.level.type===Level.TYPE_NOTPASSED||!this.level.episode.isAvailableToPlay()&&this.level.episode.episodeNo>=levels.user.episode
)&&cleverapps.tooltipManager.create(this,{text:Messages.get("LevelNotPassedTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.below}),void 0!==t&&t.episode.isComingSoon()||this.customize()},inLeftLevels:function(e){var t=cleverapps.styles.LevelView;if(t.leftLevels){var i=t.leftLevels;e&&t.playerLeftLevels&&(i=t.playerLeftLevels);var s=!1;return this.level.episodeNo%2&&!t.notAlternate&&(s=!s),0<=i.indexOf(this.level.levelNo)&&(s=!s),s}},insertPlayer:function(e,t){if(cleverapps.friends.getById(e)){var i=cleverapps.styles.LevelView,s=new PlayerView(e,this.inLeftLevels(),this.level.episodeNo,this.level.levelNo),n=cleverapps.styles.LevelView.playersInterval,o=i.notAlternate?!this.inLeftLevels():this.inLeftLevels();s.x+=t*(o?n.x:-n.x),s.y-=t*n.y,0<t&&s.setLocalZOrder(-t),this.addChild(s)}},calculatePosition:function(){var e=cleverapps.styles.LevelView[this.level.episode.getBundle().levelPositions||"levels_1"][this.level.levelNo];(this.level.levelNo<Episode.LEVELS_PER_EPISODE||e
)&&this.setPosition(e)},customize:function(){},getAnimationName:function(){var e=this.level.isHard()?["hard_past","hard_current","hard_future"]:["past","current","future"],t=this.getStars();return void 0!==t&&this.level.type===Level.TYPE_PASSED?(e=this.level.isHard()?["hard_past_stars0","hard_past_stars1","hard_past_stars2","hard_past_stars3"]:["past_stars0","past_stars1","past_stars2","past_stars3"])[t]:e[this.level.type]},getStars:function(){if(cleverapps.config.results&&(this.level.episode.isAvailableToPlay()&&this.level.type!==Level.TYPE_CURRENT&&this.level.type===Level.TYPE_PASSED))return void 0!==this.level.stars?this.level.stars:0},addLevelBg:function(){var e=cleverapps.styles.LevelView,t=new cc.Node;t.setContentSize(e.clickSize),this.setContentSize(t.getContentSize());var i=this.getAnimationName(),s=new cleverapps.Spine(bundles.level.jsons.level_json);s.setAnimation(0,i,!0),s.setPosition(t.width/2,t.height/2+e.dy),t.addChild(s),this.setAnchorPoint2(),this.addChild(t)},
addLevelId:function(){this.level.isHard()&&cleverapps.styles.LevelView.hideHardLevelNo||LevelView.generateLevelId(this,this.level.type,this.level.getHumanReadableNumber())},addTouchListener:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(e){var t=this.convertTouchToNodeSpace(e);return this.beginLocation=e.getLocation(),!(!cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)||!this.isVisible())&&(this.onTouchBegan(),!0)}.bind(this),onTouchMoved:function(e){if(this.beginLocation){var t=e.getLocation();if(10<Math.abs(t.x-this.beginLocation.x)+Math.abs(t.y-this.beginLocation.y))return this.onTouchEnded(),this.beginLocation=!1}return!0}.bind(this),onTouchEnded:function(e){if(this.beginLocation){var t=this.convertTouchToNodeSpace(e);if(cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t))return this.onTouchBegan(),this.onPressed(),!0}return!1}.bind(this)},this)},onPressed:function(){cleverapps.audio.playSound(
res.click_effect),this.level.onPressed()},onTouchBegan:function(){this.startPositionY=this.startPositionY||this.getPositionY(),this.setPositionY(this.startPositionY-3)},onTouchEnded:function(){this.setPositionY(this.startPositionY)}});LevelView.generateLevelId=function(e,t,i){var s=cleverapps.styles.LevelView.LevelId;if(cleverapps.config.editorMode||-1!==s.showTypes.indexOf(t)){var n=cleverapps.styles.FONTS.LEVEL_TITLE_TEXT;t===Level.TYPE_NOTPASSED&&(n=cleverapps.styles.FONTS.LEVEL_NOT_PASSED_TITLE_TEXT),t===Level.TYPE_CURRENT&&cleverapps.styles.FONTS.LEVEL_CURRENT_TITLE_TEXT&&(n=cleverapps.styles.FONTS.LEVEL_CURRENT_TITLE_TEXT);var o,a=cleverapps.UI.generateTTFText(i,n);1e3<=i?o=cleverapps.styles.FONTS.LEVEL_TITLE_TEXT.alternativeSizes[1]:100<=i&&(o=cleverapps.styles.FONTS.LEVEL_TITLE_TEXT.alternativeSizes[0]),o&&a.setScale(o),e.addChild(a);var r=s;(e.levelId=a).setPositionRound(r.x,r.y)}},cleverapps.overrideFonts(cleverapps.styles.FONTS,{LEVEL_TITLE_TEXT:{size:40,
color:cleverapps.styles.COLORS.WHITE,alternativeSizes:[.9,.8]},LEVEL_NOT_PASSED_TITLE_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE,alternativeSizes:[.9,.8]}}),cleverapps.styles.LevelView={curLevelAction:{scale:1.2},coming_soon:[{x:-60,y:-200}],LevelId:{x:{dx:0},y:{dy:0},showTypes:[Level.TYPE_PASSED,Level.TYPE_CURRENT,Level.TYPE_NOTPASSED]},playersInterval:{x:16,y:8},PlayerView:{x:0,y:0},clickSize:{width:90,height:75},dy:-10};var FbConnectWindow=Window.extend({onWindowLoaded:function(e,t,i){var s=cleverapps.styles.FbConnectWindow;i=i||{};var n=s.width,o=[],a=function(e){e.setDimensions(n,0),e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.push(e)};i.errorMessage&&a(cleverapps.UI.generateTTFText(i.errorMessage,cleverapps.styles.FONTS.SMALL_TEXT_ERROR)),a(cleverapps.UI.generateTTFText("messages:FbConnectWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT));var r=new cleverapps.Layout(o,{padding:s.padding,y:s.offsetY,margin:s.Text.padding,direction:cleverapps.UI.VERTICAL,x:n/2})
;this._super({title:"messages:SignIn",name:"fbconnectwindow",content:r}),e=cleverapps.once(e||function(){});var l=function(){this.onClose=function(){},this.close(),e()}.bind(this);t=cleverapps.once(t||function(){}),this.onClose=t;var c=function(){this.onClose=function(){},this.close(),t()}.bind(this);this.addButtons(l,c),cleverapps.audio.playSound(res.window_effect)},addButtons:function(i,s){var n=cleverapps.social.getCodes(),o=cleverapps.styles.FbConnectWindow,e=n.map(function(e){o.Button[e]&&o.Button[e].button_png;var t={multiSocials:1<n.length,height:o.Button.height,showText:1===n.length,iconScale:o.Button.iconScale,login:!0,source:e,onSuccess:i,onFailure:s};return new FbButton(t)}),t=new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL,margin:o.Button.margin});this.window.addChild(t);var a=o.Button.bottomPadding;1<n.length&&void 0!==o.Button.multiSocials.bottomPadding&&(a=o.Button.multiSocials.bottomPadding),t.setPositionRound(this.window.width/2,t.height/2+a)}})
;cleverapps.styles.FbConnectWindow={width:600,offsetY:75,padding:{x:0,y:0},Button:{bottomPadding:50,height:120,margin:40,iconScale:.9,multiSocials:{}},Text:{extraWidth:0,padding:20},ButtonContent:{width:340,height:120,image:{x:20,y:5},minWidth:80,text:{x:10,y:6},empty:!1}};var Boatswain=function(e){this.level=e,this.level.episode.isDailyCup()?this.intent=this.BACK_TO_DAILY_CUP:this.intent=this.BACK_TO_MAIN};Boatswain.prototype.BACK_TO_DAILY_CUP=function(e){cleverapps.scenes.replaceScene(new DailyCupScene,e)},Boatswain.prototype.DAILY_LEVEL_BACK_TO_MAIN=function(e){var t=function(){cleverapps.metha.gotoMainScene(e)};cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)?(t=cleverapps.waitNoMore(3e4,t),cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,t)):t()},Boatswain.prototype.BACK_TO_MAIN=function(e){cleverapps.Plot.GameLeave(e,{level:this.level})},Boatswain.prototype.PLAY_NEXT=function(e){cleverapps.metha.wantsToPlay(e,{level:this.level,playNext:!0})},
Boatswain.prototype.REPLAY=function(e,t){(t=t||{}).level=this.level,t.replay=!0,cleverapps.metha.wantsToReplay(e,t)},Boatswain.EXIT_INTENT=0,Boatswain.NEXT_INTENT=1,Boatswain.REPLAY_INTENT=2;var DailyLevel=function(){if(cleverapps.isLocalhost()&&delete DailyLevel.AVAILABLE.source,this.isAvailable()){var e=cleverapps.User.calcChannel("event");e&&0===e.indexOf(DailyLevel.EVENT_NAME)&&(this.currentEvent=e.substr(DailyLevel.EVENT_NAME.length),this.startFromPortlet=!0),this.currentEvent=this.currentEvent||this.getCurrentEvent();var t=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.DAILY_LEVEL);this.passed=t&&t.event===this.currentEvent&&(!t.levelsToPass||0===t.levelsToPass),this.levelsToPass=t&&t.levelsToPass?t.levelsToPass:this.getCountOfLevelsForReward(),cleverapps.config.debugMode&&-1!==["576593702177"].indexOf(cleverapps.user.id)&&(this.passed=!1)}};DailyLevel.prototype.start=function(e){var t=this.getCurrentLevel(),i=new Episode(Episode.Types.DAILY_LEVELS,t).getLevel()
;LevelStartWindow.isAvailable(cleverapps.user.episode,cleverapps.user.level)&&BoostersBefore.isAvailable()?(new LevelStartWindow({level:i}),cleverapps.metha.onceNoWindowsListener=e):i.play(e)},DailyLevel.prototype.isAvailable=function(){return cleverapps.user.checkAvailable(DailyLevel.AVAILABLE)&&bundles.episode_daily_levels},DailyLevel.prototype.isActive=function(){return this.isAvailable()&&!this.passed},DailyLevel.prototype.isStartFromPortlet=function(){return this.isAvailable()&&this.startFromPortlet},DailyLevel.prototype.reset=function(){this.passed=!1,this.levelsToPass=this.getCountOfLevelsForReward(),cleverapps.DataLoader.remove(cleverapps.DataLoaderTypes.DAILY_LEVEL)},DailyLevel.prototype.onWin=function(e){this.levelsToPass--,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.DAILY_LEVEL,{event:this.getCurrentEvent(),levelsToPass:this.levelsToPass}),0===this.levelsToPass&&(this.passed=!0,cleverapps.social.setStatus&&cleverapps.social.setStatus(
DailyLevel.EVENT_NAME+this.getCurrentEvent(),this.getStatus(e)),cleverapps.eventLogger.logEvent("daily_level_passed_"+this.getCurrentEvent()))},DailyLevel.prototype.getStatus=function(e){var t={},i=e.content;if("board"===cleverapps.config.type){var s=function(e){return 1===e?Messages.get("DailyLevel.Status.wordsAmount1"):e<=4?Messages.get("DailyLevel.Status.wordsAmount234",{amount:e}):Messages.get("DailyLevel.Status.wordsAmount5",{amount:e})};t={firstWord:i.words[0].toUpperCase(),base:i.base.toUpperCase(),amountMinus1:s(i.words.length-1),baseLength:i.base.length,wordsAmount:s(i.words.length)}}else"solitaire"===cleverapps.config.type&&(t={cardsCount:Game.currentGame.table.beginCards,movesLeft:i.hand.num});var n=Messages.get("DailyLevel.Status.common",t);return n[Math.round(Math.random()*n.length)]},DailyLevel.prototype.getCurrentEvent=function(){if(this.currentEvent)return this.currentEvent;var e=new Date;return cleverapps.padZeroes(e.getFullYear()%100,2)+cleverapps.padZeroes(
e.getMonth()+1,2)+cleverapps.padZeroes(e.getDate(),2)},DailyLevel.prototype.getCurrentLevel=function(){var e=this.getCurrentEvent(),t=e.substr(0,2),i=e.substr(2,2),s=e.substr(4,2),n=new Date;n.setUTCFullYear(parseInt("20"+t),parseInt(i)-1,parseInt(s)),n.setUTCHours(0,0,0,0);var o=n.getTime()-new Date("2019-12-17").getTime();o/=864e5;var a=Math.floor(o),r=bundles.episode_daily_levels.levelsAmount-this.getCountOfLevelsForReward()+1,l=(a%r+r)%r;return console.log("dailylevel.getCurrentLevel event "+e+" levelNo "+l),l+(this.getCountOfLevelsForReward()-this.levelsToPass)},DailyLevel.prototype.getCountOfLevelsForReward=function(){return 1},DailyLevel.EVENT_NAME="dailylevel",DailyLevel.AVAILABLE={projectName:["wordsoup","crocword","olympics","tripeaks"],language:"ru",source:["web_ok","mobile_ok"]};var DailyLevelIcon=SideBarIcon.extend({ctor:function(e){var t=cleverapps.overrideStyles(cleverapps.styles.SideBarIcon,cleverapps.styles.DailyLevelIcon,!0);this._super(e,t,{
title:cleverapps.styles.DailyLevelIcon.title})},onEnter:function(){this._super(),this.turnOnAttention()},onPressed:function(){this._super(),cleverapps.metha.display({focus:"DailyLevel",actions:[function(e){cleverapps.dailyLevel.start(e)},function(e){cleverapps.dailyLevel.isActive()||this.removeFromSideBar(),e()}.bind(this)]})}});DailyLevelIcon.IsAvailable=function(){return cleverapps.dailyLevel.isActive()},cleverapps.styles.DailyLevelIcon={animation:bundles.sidebar.jsons.daily_level_json};var DailyLevelWindow=Window.extend({onWindowLoaded:function(e){this.options=e;var t=cleverapps.styles.DailyLevelWindow;this._super({title:"messages:DailyLevelWindow.title",name:"dailylevelwindow",content:this.getContent(),styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.DailyLevelWindow.window,!0),button:{text:Messages.get("Play"),width:t.button.width,height:t.button.height,onPressed:function(){this.close()}.bind(this)}}),t.hero&&(this.hero=new cleverapps.Spine(t.hero.json,1
),this.hero.setAnimation(0,t.hero.animation,!0),this.hero.setPositionRound(t.hero),this.hero.setScale(t.hero.scale),this.addChild(this.hero))},getContent:function(){var e=cleverapps.styles.DailyLevelWindow,t=[];if(e.animation.json){var i=this.createAnimation();t.push(i)}if(e.label){var s=new cc.Sprite(e.label);s.rotation=-15,t.push(s)}var n=new cleverapps.Layout(t,{direction:cleverapps.UI.HORIZONTAL,margin:2*e.contentObjectsMargin}),o=this.createText();return new cleverapps.Layout([o,n],{direction:cleverapps.UI.VERTICAL,margin:e.contentObjectsMargin,padding:{x:0,y:e.contentObjectsMargin}})},createText:function(){var e=cleverapps.styles.DailyLevelWindow,t=cleverapps.UI.generateTTFText("messages:DailyLevelWindow.text",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,{left:cleverapps.dailyLevel.levelsToPass});return t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setDimensions(cc.size(e.textWidth,0)),t},createAnimation:function(){var e=cleverapps.styles.DailyLevelWindow,t=new cc.Node
;t.setAnchorPoint2(),t.setContentSize(e.size);var i=new cleverapps.Spine(e.animation.json,e.scale);return i.setAnimation(0,e.animation.name?e.animation.name:"idle",!0),t.addChild(i),i.setPositionRound(t.width/2+e.animation.dx,t.height/2+e.animation.dy),t}}),CleverAppsHeroesRules={ClockMakerPortals:!0,SlideFallDown:!(cleverapps.styles.DailyLevelWindow={contentObjectsMargin:30,textWidth:540,size:{width:250,height:350},scale:.55,button:{width:200,height:100},animation:{dx:-100,dy:-70,json:bundles.main.jsons.hero_json,name:"coming_soon"},label:bundles.game.frames.label_50_ok_png}),Features:{Plane:!1},Plus:!0,Heroes:!0,ExplodeDuration:.5},NewRules={ClockMakerPortals:!0,SlideFallDown:!0,Features:{Plane:!0},Plus:!1,Heroes:!1,ExplodeDuration:.3},Match3Rules=CleverAppsHeroesRules;cleverapps.styles.SCENE_HORIZONTAL_WIDTH=1740,cleverapps.styles.SCENE_HORIZONTAL_MAX_HEIGHT=800,cleverapps.SCENE_HORIZONTAL_BG_DX=2,cleverapps.overrideColors(cleverapps.styles.COLORS,{MOVES_DANGER:new cc.Color(255,0,0,
255),EPISODE_CLOUD_TEXT_COLOR:new cc.Color(220,56,98,255),COLOR_WINDOW_TEXT:new cc.Color(130,70,40,255),MESSAGE_RED:new cc.Color(246,42,71,255),MESSAGE_PINK:new cc.Color(245,0,138,255)}),cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{WHITE_TEXT_STROKE:{color:cleverapps.styles.COLORS.WHITE,size:2},MESSAGE_RED_STROKE:{color:cleverapps.styles.COLORS.MESSAGE_RED,size:4},MESSAGE_PINK_STROKE:{color:cleverapps.styles.COLORS.MESSAGE_PINK,size:4},MESSAGE_GREEN_STROKE:{color:cleverapps.styles.COLORS.MESSAGE_GREEN,size:4},MOVES_CELL_STROKE:{color:new cc.Color(140,83,37,255),size:4},BLACK_TEXT_STROKE:{color:cleverapps.styles.COLORS.BLACK,size:2},TILE_SHOP_WINDOW_STROKE:{color:new cc.Color(150,111,72,255),size:2},TILE_SHOP_WINDOW_FRIDAY_STROKE:{color:new cc.Color(84,84,84,255),size:1},TILE_SHOP_WINDOW_TITLE_SHADOW:{color:new cc.Color(112,109,109,255),direction:cc.size(0,-4),blur:0},TILE_SHOP_WINDOW_TIMER_SHADOW:{color:new cc.Color(192,44,44,255),direction:cc.size(2,0),blur:0},
TILE_SHOP_WINDOW_FRIDAY_TITLE_STROKE:{color:new cc.Color(188,90,70,255),size:2},TILE_SHOP_BADGE_STROKE:{color:new cc.Color(237,4,3,255),size:3}}),cleverapps.overrideStyles(cleverapps.styles.Window,{minHeight:400,minWidth:300,Background:{scale9:cleverapps.UI.Scale9Rect.TwoPixelXY},Title:{offset:55}}),cleverapps.overrideStyles(cleverapps.styles.EpisodeView,{oldAnimation:!0,offsetEpisodes:!0}),cleverapps.overrideStyles(cleverapps.styles.WaitWindow,{text:{y:-60}}),cleverapps.styles.FONTS=cleverapps.overrideFonts(cleverapps.styles.FONTS,{MOVES_TEXT:{prefix:"moves_digit_",size:40,color:cleverapps.styles.COLORS.WHITE},GOAL_TEXT:{prefix:"digits_game#goals_digit_",size:39,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.DARK_OLIVE_GREEN_STROKE},RPG_LIFE_DELTA_RED:{prefix:"white_digit_",size:40,color:cleverapps.styles.COLORS.COLOR_RED},RPG_LIFE_DELTA_GREEN:{prefix:"white_digit_",size:40,color:cleverapps.styles.COLORS.LIFE_GREEN},BOOSTER_AMOUNT_TEXT:{
prefix:"booster_digits#booster_digit_",size:38,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.BOOSTER_AMOUNT_STROKE},BOOSTER_BEFORE_AMOUNT_TEXT:{prefix:"digits#timer_digit_",scale:1,size:40,color:cleverapps.styles.COLORS.WHITE},LEVEL_TITLE_TEXT:{prefix:"digits#level_digit_",size:40,color:cleverapps.styles.COLORS.WHITE,alternativeSizes:[.9,.8]},LEVEL_NOT_PASSED_TITLE_TEXT:{prefix:"digits#level_digit_",size:40,color:cleverapps.styles.COLORS.WHITE,alternativeSizes:[.9,.8]},WINDOW_WHITE_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE},MESSAGE_TEXT_NORMAL:{size:77,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.MESSAGE_GREEN_STROKE},MESSAGE_TEXT_WARNING:{size:77,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.MESSAGE_RED_STROKE},MESSAGE_TEXT_CONGRATS:{size:77,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.MESSAGE_PINK_STROKE},WINDOW_TEXT:{size:40,
color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},ADDMOVES_PRICE:{size:40,color:cleverapps.styles.COLORS.WHITE},EPISODE_CLOUD_TEXT:{size:50,color:cleverapps.styles.COLORS.EPISODE_CLOUD_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.WHITE_TEXT_STROKE},NOTIFICATION_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE},MOVES_CELL_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.MOVES_CELL_STROKE},TILE_SHOP_WINDOW_TEXT:{size:35,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},TILE_SHOP_SPECIAL_OFFER_TEXT:{prefix:"digits#timer_digit_",scale:.5,color:cleverapps.styles.COLORS.WHITE},TILE_SHOP_OFFER_TEXT:{prefix:"digits#timer_digit_",scale:.8,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},TILE_SHOP_WINDOW_TITLE_TEXT:{size:75,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TILE_SHOP_WINDOW_TITLE_SHADOW},TILE_SHOP_WINDOW_FRIDAY_TEXT:{size:35,color:cleverapps.styles.COLORS.WHITE,
stroke:cleverapps.styles.DECORATORS.TILE_SHOP_WINDOW_FRIDAY_STROKE},TILE_SHOP_WINDOW_BADGE_TIMER:{size:23,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TILE_SHOP_WINDOW_TIMER_SHADOW},TILE_SHOP_WINDOW_FRIDAY_TITLE_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.TILE_SHOP_WINDOW_FRIDAY_TITLE_STROKE},TILE_SHOP_BADGE_TEXT:{size:25,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.TILE_SHOP_BADGE_STROKE},COINS_PRICE_TEXT:{size:60,color:cleverapps.styles.COLORS.WHITE,prefix:"digits#timer_digit_",scale:.8}}),cleverapps.overrideStyles(cleverapps.styles.ShopWindow,{contentOffset:0,contentPadding:0}),cleverapps.overrideStyles(cleverapps.styles.LoadingScene,{bar:{x:2,y:1,scale9:{width:380,height:60,minWidth:60}},barBg:{y:70,scale9:{width:384,height:62}},message:{y:0}}),cleverapps.overrideStyles(cleverapps.styles.PagesView,{direction:PagingScrollView.DIRECTIONS.Vertical,height:cleverapps.styles.SCENE_HEIGHT,
pageHeight:cleverapps.styles.SCENE_HEIGHT,noAutoScroll:!0,prevEpisodeShowed:!0}),cleverapps.overrideStyles(cleverapps.styles.ShadowView,{opacity:160}),cleverapps.overrideStyles(cleverapps.styles.GiveUpAlertView,{bg:{image:bundles.main.frames.tutorial_text_bg_png},text:{x:{align:"center",dx:20},padding:[{x:-50},{x:-80},{x:-80}]}}),cleverapps.overrideStyles(cleverapps.styles.CoinsPriceView,{icon:{scale:.6},bg:{image:bundles.main.frames.timer_bg_png,padding:{x:6,y:4},dx:0},margin:4}),cleverapps.overrideStyles(cleverapps.styles.LargeTileRewardsBlock,{boosterIcons:{0:bundles.reward_icons.frames.cellbooster_small,1:bundles.reward_icons.frames.linebooster_small,2:bundles.reward_icons.frames.colorbooster_small,5:bundles.reward_icons.frames.heroes_small_png,6:bundles.reward_icons.frames.moves_small_png,7:bundles.reward_icons.frames.multicolor_small_png},exp:{icon:bundles.reward_icons.frames.reward_exp_png,scale:.5}}),cleverapps.overrideStyles(cleverapps.styles.TooltipRewardsView,{boosters:{
icons:{0:bundles.reward_icons.frames.cellbooster_small,1:bundles.reward_icons.frames.linebooster_small,2:bundles.reward_icons.frames.colorbooster_small,5:bundles.reward_icons.frames.heroes_png,6:bundles.reward_icons.frames.moves_png,7:bundles.reward_icons.frames.multicolor_png}}}),cleverapps.overrideStyles(cleverapps.styles.UI.Tooltip,{rewards:{extraWidth:10}}),cleverapps.overrideStyles(cleverapps.styles.RewardsListComponent,{boosters:{icons:{5:bundles.reward_icons.frames.heroes_png,6:bundles.reward_icons.frames.moves_png,7:bundles.reward_icons.frames.multicolor_png}}}),cleverapps.overrideStyles(cleverapps.styles.PackProductTile,{title:{paddingX:60}});var Shape=function(e){this.cells=e||[],this.minRow=Field.SIZE,this.maxRow=0,this.minCol=Field.SIZE,this.maxCol=0};Shape.prototype.merge=function(t){this.cells.forEach(function(e){e.animate(BaseCell.ANIMATION_MOVE_TO,t)})},Shape.prototype.add=function(e){this.cells.push(e),this.minRow>e.y&&(this.minRow=e.y),this.maxRow<e.y&&(
this.maxRow=e.y),this.minCol>e.x&&(this.minCol=e.x),this.maxCol<e.x&&(this.maxCol=e.x)},Shape.prototype.calculateForm=function(){return this.form?this.form:4<=this.maxRow-this.minRow||4<=this.maxCol-this.minCol?this.form=Shape.FIVE:2<=this.maxRow-this.minRow&&2<=this.maxCol-this.minCol?this.form=Shape.CROSS:3<=this.maxRow-this.minRow?this.form=Shape.FOUR_V:3<=this.maxCol-this.minCol?this.form=Shape.FOUR_H:1<=this.maxRow-this.minRow&&1<=this.maxCol-this.minCol&&Match3Rules.Features.Plane?this.form=Shape.PLANE:this.form=Shape.THREE},Shape.prototype.getCenter=function(){for(var e,t=Game.currentGame.field.lastMove,i=(this.maxCol+this.minCol)/2,s=(this.maxRow+this.minRow)/2,n=Number.MAX_VALUE,o=0;o<this.cells.length;o++){var a=this.cells[o],r=Math.abs(a.y-s)+Math.abs(a.x-i);t&&(t[0].x===a.x&&t[0].y===a.y||t[1].x===a.x&&t[1].y===a.y)&&(r=-1),r<n&&!a.innerCell&&a.lives<=1&&0<=a.lives&&(n=r,e=a)}return e||this.cells[0]},Shape.THREE=".",Shape.FIVE="*",Shape.CROSS="+",Shape.FOUR_V="|",
Shape.FOUR_H="-",Shape.PLANE=":",levels.LevelAttempts=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.LEVEL_ATTEMPTS);this.attempts=e||{}},levels.LevelAttempts.prototype.addAttempt=function(e){if(e.isCurrentLevel()){var t=e.getHumanReadableNumber();void 0===this.attempts[t]&&(this.attempts[t]=0),this.attempts[t]++,this.save()}},levels.LevelAttempts.prototype.amountAttemptsOnLastLevels=function(e){var t=[];for(var i in this.attempts)t.push({levelId:i,attempts:this.attempts[i]});if(e>t.length)return!1;t.sort(function(e,t){return t.levelId-e.levelId});for(var s=0,n=0;n<e;n++)s+=t[n].attempts;return s},levels.LevelAttempts.prototype.getAttempts=function(){var e=levels.user.getProgress()+1;return this.attempts[e]},levels.LevelAttempts.prototype.save=function(){var e=1e9,t=0;for(var i in this.attempts)parseInt(i)<e&&(e=parseInt(i)),t++;t>levels.LevelAttempts.MAX_HISTORY&&delete this.attempts[e],cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.LEVEL_ATTEMPTS,
this.attempts)},levels.LevelAttempts.MAX_HISTORY=10;var HelpByFiveAttemptsWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.HelpByFiveAttemptsWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.width,e.height);var i=new cleverapps.Spine(e.Animation.json);i.setPositionRound(e.width/2+e.Animation.x,e.Animation.y),t.addChild(i),i.setAnimation(0,"animation",!0);var s=cleverapps.UI.generateTTFText("messages:HelpByFiveAttempts.text",cleverapps.styles.FONTS.WINDOW_TEXT);s.setDimensions(e.Text.width,0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),s.setPositionRound(e.width/2,e.Text.y),t.addChild(s),this._super({title:"messages:HelpByFiveAttempts.title",name:"helpbyfiveattemptswindow",content:t,button:{width:e.Button.width,height:e.Button.height,text:Messages.get("OK"),onPressed:this.close.bind(this)}}),cleverapps.audio.playSound(bundles.game.urls.perfect_effect)},onClose:function(){
Game.currentGame.helpByFiveAttempts()}});HelpByFiveAttemptsWindow.showIfCan=function(){if(Game.currentGame.canHelpByFiveAttempts()){var e=levels.levelAttempts.getAttempts();e<5||e%5!=0||(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HELP_BY_FIVE_ATTEMPTS),cleverapps.metha.display({focus:"HelpByFiveAttemptsWindow",action:function(e){new HelpByFiveAttemptsWindow,cleverapps.metha.onceNoWindowsListener=e}}))}},HelpByFiveAttemptsWindow.prototype.listBundles=function(){return["game"]},cleverapps.styles.HelpByFiveAttemptsWindow={width:600,height:550,Animation:{y:240,x:-20,json:bundles.game.jsons.help_from_buddies_json},Text:{width:600,y:130},Button:{width:250,height:120}},levels.EpisodesScene.prototype.updateBackgroundScale=function(){this.scene.updateBackgroundScale&&this.scene.updateBackgroundScale()};var prevEpisodesBUNDLES=levels.EpisodesScene.BUNDLES;levels.EpisodesScene.BUNDLES=function(){var e=prevEpisodesBUNDLES().concat(["episodes_spines","episodes_resources"])
;return"runes"===cleverapps.config.name&&e.push("heroes"),e},cleverapps.overrideStyles(cleverapps.styles.LevelView,{LevelId:{offsetY:-2,showTypes:[Level.TYPE_PASSED,Level.TYPE_CURRENT]}}),cleverapps.overrideStyles(cleverapps.styles.EpisodeView,{player:{x:-170,y:0},playerLeftLevels:{x:60,y:0},player14:{x:-170,y:-60},playerLeftLevels14:{x:60,y:-60},text:{x:0,y:350},loadAnimation:!0,direction:cleverapps.UI.VERTICAL}),ComingSoonEpisodeView.prototype.addCharacter=function(){var e=cleverapps.styles.EpisodeView.coming_soon;this.activities=[],this.addCup(),cleverapps.isInstant()||this.addJoin();var t=new cleverapps.Layout(this.activities,{direction:e.activities.direction,margin:e.activities.margin});t.setScale(e.activities.scale[cleverapps.wideMode.mode]);var i=[];i.push(t);var s=this.createText();s&&i.push(s),this.animation&&(i.push(this.animation),this.animation.setScale(e.animation.scale),this.animation.removeFromParent()),this.addAnimationText();var n=this.content=new cleverapps.Layout(i,{
direction:cleverapps.UI.VERTICAL,margin:e.margin});this.animation&&this.animation.setAnimation(0,"animation",!0),n.setScale(e.scale),this.addChild(n),e.positions&&n.setPositionRound(e.positions[cleverapps.wideMode.mode])},ComingSoonEpisodeView.prototype.addAnimationText=function(){var e=cleverapps.styles.EpisodeView.coming_soon;if(e.animation.text&&this.animation){var t=cleverapps.UI.generateTTFText("messages:EpisodeView.ComingSoonEpisode.animationText",cleverapps.styles.FONTS.EPISODE_CLOUD_TEXT);t.setDimensions(e.animation.text.width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.animation.addChild(t),t.setPositionRound(e.animation.text);var i=e.animation.text.height/t.height;i<1&&t.setScale(i)}},ComingSoonEpisodeView.prototype.createText=function(){var e=cleverapps.styles.EpisodeView.coming_soon,t=0<this.activities.length?e.text.activitiesMsg:e.text.noActivitiesMsg;if(t){var i=cleverapps.UI.generateTTFText(t,e.font);return i.setDimensions(
e.text.width[cleverapps.wideMode.mode]*resolutionScale,0),i.setScale(e.text.scale[cleverapps.wideMode.mode]),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i}},ComingSoonEpisodeView.prototype.createButton=function(e,t){var i=cleverapps.styles.EpisodeView.coming_soon;return new cleverapps.UI.Button({text:Messages.get(e),padding:{x:i.activities.button.paddingX},font:i.activities.button.font,width:i.activities.button.width,height:i.activities.button.height,onClicked:t})},ComingSoonEpisodeView.prototype.createActivityText=function(e){var t=cleverapps.styles.EpisodeView.coming_soon;return(e=cleverapps.UI.generateTTFText(e,t.font)).setDimensions(t.activities.text.width,t.activities.text.height),e.setHorizontalAlignment(t.activities.text.horizontalAlignment),e.setVerticalAlignment(t.activities.text.verticalAlignment),e},ComingSoonEpisodeView.prototype.createAnimation=function(e){if(cleverapps.styles.EpisodeView.coming_soon.activities.animation){var t=new cleverapps.Spine(e)
;return t.setAnimation(0,"animation",!0),t}},ComingSoonEpisodeView.prototype.addCup=function(){if(void 0!==cleverapps.dailyCup&&cleverapps.dailyCup.isActive()){var e=cleverapps.styles.EpisodeView.coming_soon,t=[],i=this.createActivityText("messages:EpisodeView.ComingSoonEpisode.cup");t.push(i);var s=this.createButton(e.activities.text.cupMsg,function(){cleverapps.metha.display({focus:"DailyCupSceneFromComingSoon",control:["toolbar","sidebar"],action:function(e){cleverapps.scenes.replaceScene(new DailyCupScene,e)}})});t.push(s);var n=this.createAnimation(bundles.episode_coming_soon.jsons.cup_json);n&&t.push(n),this.addActivity(t)}},ComingSoonEpisodeView.prototype.addJoin=function(){if(-1===["amazon","huzcom","pliega"].indexOf(cleverapps.User.calcSource())){var e=cleverapps.styles.EpisodeView.coming_soon,t=[],i=this.createActivityText("messages:EpisodeView.ComingSoonEpisode.join");t.push(i);var s=this.createButton(e.activities.text.joinMsg,function(){cc.sys.openURL(cleverapps.bySource(
cleverapps.config.helpURL))});t.push(s);var n=this.createAnimation(bundles.episode_coming_soon.jsons.join_json);n&&t.push(n),this.addActivity(t)}},ComingSoonEpisodeView.prototype.addActivity=function(e){var t=cleverapps.styles.EpisodeView.coming_soon;this.activities.push(new cleverapps.Layout(e,{direction:t.activities.itemsDirection,margin:t.activities.itemsMargin}))},cleverapps.overrideStyles(cleverapps.styles.EpisodeView,{coming_soon:{animation:{scale:1},activities:{margin:30,itemsMargin:10,text:{width:380,height:120,horizontalAlignment:cc.TEXT_ALIGNMENT_CENTER,verticalAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,cupMsg:"Compete",joinMsg:"Join"},button:{width:380,height:120,paddingX:10,font:cleverapps.styles.FONTS.BUTTON_TEXT},animation:!0,scale:[.8,1,1],itemsDirection:cleverapps.UI.VERTICAL,direction:cleverapps.UI.HORIZONTAL},margin:40,text:{width:[380,550,550],scale:[.9,1,1],activitiesMsg:"messages:EpisodeView.ComingSoonEpisode.activities",
noActivitiesMsg:"messages:EpisodeView.ComingSoonEpisode"},scale:1,font:cleverapps.styles.FONTS.EPISODE_CLOUD_TEXT}});var IslandView=cc.Node.extend({ctor:function(e,t){this._super(),(this.episode=e).onAnimatePass=this.createListener(this.animatePass.bind(this)),e.onAnimateOpen=this.createListener(this.animateOpen.bind(this));var i=cleverapps.styles.IslandView,s=this.animation=this.islandAnimation();s.setContentSize(i.width,i.height),s.setLocalZOrder(1),this.addChild(s),this.updateAnimation(),this.addCharacters(),this.setContentSize2(s.getContentSize()),this.setAnchorPoint2();var n=i.positions;if(cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&i.positionsMobile&&(n=i.positionsMobile),this.setPositionRound(n[e.episodeNo%Object.keys(n).length]),s.setPositionRound(this.width/2,this.height/2),s.setCascadeOpacityEnabled(!0),e.isCurrent()&&(this.label=new CurrentEpisodeLabel(e),this.addChild(this.label),cleverapps.UI.onClick(this,function(){e.getCurrentLevel().onPressed()}.bind(this),
{swallowTouches:!1,ignoreOnTouchMoved:!0}),levels.episodes.changeEpisodeAnimation&&this.label.setVisible(!1)),this.addDecoration(),cleverapps.config.debugMode&&cleverapps.flags.islandsInfoEnabled){var o=new cc.Node;o.setContentSize2(500,300),s.addChild(o),o.setAnchorPoint2(),o.debugBorder();var a=cleverapps.UI.generateTTFText("Episode: "+this.episode.episodeNo,cleverapps.styles.FONTS.BUTTON_SMALL_TEXT);s.addChild(a)}},onEnter:function(){this._super(),this.parent.loading&&(this.visible=!1,this.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.CallFunc(function(){this.visible=!0}.bind(this)))))},islandAnimation:function(){var e=this.episode.getIslandBundle();return new cleverapps.Spine(e.jsons["island_"+this.episode.episodeNo+"_json"],1)},addCharacters:function(){var e=cleverapps.styles.IslandEnemies;if(e&&e[this.episode.episodeNo])return levels.user.episode-1===this.episode.episodeNo&&levels.episodes.changeEpisodeAnimation?(this.addEnemies(!0),void this.addFriends(!0)):void(
this.episode.isPassed()?this.addFriends():this.addEnemies())},addFriends:function(e){this.friends=this.createCharacters(!0,e),this.runCharactersAnimation(this.friends,e?"attack":"idle")},addEnemies:function(e){this.enemies=this.createCharacters(!1,e),this.runCharactersAnimation(this.enemies,e?"attack":"idle")},runCharactersAnimation:function(e,i){e&&e.forEach(function(t){var e=function(){if("idle"===i){var e=function(){t.inAnimation=!1,t.setCompleteListener(function(){}),t.setAnimation(0,t.idleAnimation,!0),t.runAction(new cc.Sequence(new cc.DelayTime(20*Math.random()+3),new cc.CallFunc(function(){t.inAnimation=!0,t.setCompleteListener(e),t.setAnimation(0,t.attackAnimation,!1)})))};e()}"attack"===i&&(t.inAnimation=!0,t.setAnimation(0,t.attackAnimation,!0)),"die"===i&&(t.setCompleteListener(function(){t.setCompleteListener(function(){}),t.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.ScaleTo(.3,0),new cc.RemoveSelf))}),t.setAnimation(0,t.dieAnimation,!1))}
;t.inAnimation?t.setCompleteListener(e):e()})},createCharacters:function(u,v){var g=cleverapps.styles.IslandEnemies,m=[];return g[this.episode.episodeNo].forEach(function(e,t){var i={x:0,y:0},s=e.enemy,n=g.enemies.scale,o=g.enemies.idleAnimation,a=g.enemies.attackAnimation,r=g.enemies.dieAnimation,l=g.enemies.x,c=g.enemies.y;if(v&&(i=g.enemies.delta),u){var p=1e3*this.episode.episodeNo+t,d=cleverapps.Random.choose(Heroes.AVAILABLE_HEROES,p);d=d.toUpperCase(),s=bundles.heroes.jsons[d+"_hero_spine_json"],n=g.friends.scale,o=g.friends.idleAnimation,a=g.friends.attackAnimation,l=g.friends.x,c=g.friends.y,v&&(i=g.friends.delta)}var h=new cleverapps.Spine(s,n);h.setSkin("regular"),e.flipped&&!v&&h.setScaleX(-1),h.setPositionRound(e.x+l+i.x,e.y+c+i.y),this.animation.addChild(h),m.push(h),h.idleAnimation=o,h.attackAnimation=a,h.dieAnimation=r},this),m},addDecoration:function(){if(bundles.episodes_spines){for(var e=0;bundles.episodes_spines.jsons["island_decor_"+e];)e++;if(e){
var t=cleverapps.styles.IslandView;if(!(t=cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&t.decorPositionsMobile?t.decorPositionsMobile:t.decorPositions).disabled){t=t[this.episode.episodeNo%Object.keys(t).length];var i=this.episode.episodeNo%e,s=new cleverapps.Spine(bundles.episodes_spines.jsons["island_decor_"+i],1);this.addChild(s),s.setAnimation(0,"animation",!0),s.setPositionRound(this.width/2+t.x,this.height/2+t.y),t.scaleX&&s.setScaleX(t.scaleX)}}}},updateAnimation:function(e){var t=e;e||(t=this.episode.isPassed()||this.episode.isCurrent()&&!levels.episodes.changeEpisodeAnimation?"open":"close"),this.animation.setAnimation(0,t,!0)},animatePass:function(e){this.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(function(){this.runCharactersAnimation(this.enemies,"die")}.bind(this)))),this.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){this.runCharactersAnimation(this.friends,"idle"),this.label&&(this.label.setVisible(!0),
this.label.setScale(0),this.label.runAction(new cc.ScaleTo(.5,1).easing(cc.easeIn(2))))}.bind(this)))),this.runAction(new cc.Sequence(new cc.DelayTime(cleverapps.styles.IslandView.animatePass.delay),new cc.CallFunc(e)))},animateOpen:function(e){this.animation.setAnimation(0,"transition",!1),this.runAction(new cc.Sequence(new cc.DelayTime(1.5),new cc.CallFunc(function(){this.label&&(this.label.setVisible(!0),this.label.setScale(0),this.label.runAction(new cc.ScaleTo(.5,1).easing(cc.easeIn(2)))),e()}.bind(this)))),this.animation.setCompleteListener(function(){this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,"open",!0)}.bind(this))}});cleverapps.styles.IslandView={width:400,height:300,positions:{0:{x:150,y:0},1:{x:-150,y:0}},positionsMobile:{0:{x:-50,y:0},1:{x:50,y:0}},decorPositions:{0:{x:600,y:0,scaleX:-1},1:{x:-600,y:0}},decorPositionsMobile:{disabled:!0},animatePass:{delay:3.5}};var FreeMoves={available:void 0,calcAvailable:function(){
void 0!==FreeMoves.available&&!0!==FreeMoves.available||(FreeMoves.available=0===levels.user.episode||1===levels.user.episode&&levels.user.level<=5)}},FreeBombMoves={available:void 0,calcAvailable:function(){return!cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.FREE_BOMB_MOVES)&&cleverapps.user.checkAvailable(FreeBombMoves.AVAILABLE)},isAvailable:function(){return this.available=this.calcAvailable(),this.available},unAvailable:function(){this.available=!1,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.FREE_BOMB_MOVES,1)},AVAILABLE:{episode:7,level:0}},Score=function(e,t){this.level=e,this.levelContent=e.content,this.points=0,this.stars=0,this.moveExplode=0,this.movesTarget=t,this.calcRequired(),this.onChangePercentListener=function(){},this.onAddStarListener=function(){}};Score.COEFS=[.5,.75,1],Score.prototype.calcRequired=function(){this.required=0,this.goals={},this.goalTargets={},this.moves=0,this.movesRemaining=0,this.guns=0,this.boosters=0,this.buyMoves=0,
this.levelContent.goals.forEach(function(e){if(this.goals[e.type]=0,this.goalTargets[e.type]=e.target,0===e.target&&!cc.sys.isNative){var t=this.level.getHumanReadableNumber()+" level has goal target 0";if(cleverapps.config.debugMode&&!cleverapps.config.editorMode)throw new Error(t);cleverapps.ReportStream.debug(t)}}.bind(this)),cleverapps.config.debugMode&&(this.baseRequired=Score.CalcBaseRequired(this.goalTargets,this.levelContent.moves)),this.required=Score.CalcRequired(this.goalTargets,this.levelContent.moves,this.levelContent.score)},Score.CalcBaseRequired=function(e,t){var i=0,s=0;for(var n in e)s+=e[n];i+=10*s;var o=5*t;return s<o&&0<t&&(i+=3*(o-s)),i},Score.CalcRequired=function(e,t,i){var s=Score.CalcBaseRequired(e,t,i),n=i||100;return Math.floor(s*n/100)},Score.prototype.addGoalTarget=function(e,t){this.addGoalFinished||(this.goalTargets[e]+=t,this.required=Score.CalcRequired(this.goalTargets,this.levelContent.moves,this.levelContent.score),this.updatePoints())},
Score.prototype.addGoal=function(e,t){this.addGoalFinished||(this.goals[e]+=t,this.updatePoints())},Score.prototype.addGun=function(){this.guns++,this.updatePoints()},Score.prototype.addBooster=function(){this.boosters++,this.updatePoints()},Score.prototype.addBuyMoves=function(){this.buyMoves++,this.updatePoints()},Score.prototype.addMoves=function(){this.moves++,this.updatePoints()},Score.prototype.addMovesRemaining=function(e){this.movesRemaining+=e,void 0!==this.movesRemainingTarget&&(this.movesRemaining=Math.min(this.movesRemaining,this.movesRemainingTarget)),this.updatePoints()},Score.prototype.setMovesRemainingTarget=function(e){this.movesRemainingTarget=e,this.movesRemaining=Math.min(this.movesRemaining,this.movesRemainingTarget),this.updatePoints()},Score.prototype.calcPoints=function(){var e=0,t=Object.keys(this.goals).length,i=Game.currentGame&&Game.currentGame.outcome===GameBase.OUTCOME_VICTORY;for(var s in this.goals)e+=Math.min(this.goals[s],1.5*this.goalTargets[s]
)/Math.max(this.goalTargets[s],1);if(0<this.movesTarget){var n=this.moves;i&&n<this.movesTarget&&(n=this.movesTarget),e=(e+n/this.movesTarget)/(t+1)*.7}else e/=t;return e+=.3*this.movesRemaining/(.1*this.movesTarget),e+=.15*this.guns+.1*this.buyMoves+.05*this.boosters,e*=this.required,this.levelContent.stars&&(e*=this.levelContent.stars/100),Math.ceil(e)},Score.prototype.updatePoints=function(){var e=this.calcPoints();if(this.points<e){this.points=e,this.onChangePercentListener(100*this.points/this.required);for(var t=Score.ScoreToStars(this.points,this.required),i=this.stars+1;i<=t;i++)this.onAddStarListener(i);this.stars=t}},Score.prototype.addMoveExplode=function(e){this.moveExplode+=Math.ceil(e/2)},Score.ScoreToStars=function(e,t){for(var i=0;i<Score.COEFS.length;i++)if(e<Score.COEFS[i]*t)return i;return Score.COEFS.length};var Goal=function(e,t,i){this.type=e,this.amount=0,this.done=!1,this.target=t,i&&(this.createOnCollect=i,this.onCollectCreated=0),
this.onChangedListener=function(){},this.onCompletedListener=function(){},this.onCompletedGoalsListener=function(){},this.onIncompletedListener=function(){},this.onIncompletedGoalsListener=function(){}};Goal.prototype.inc=function(e,t){if(Game.currentGame){if(e=e||1,this.amount+=e,t||(Game.currentGame.score.addMoveExplode(e),Game.currentGame.score.addGoal(this.type,e)),this.createOnCollect&&this.onCollectCreated<this.createOnCollect.amount){var i=this.createOnCollect.amount-this.onCollectCreated,s=void 0;5<i&&(s={start:4,end:7}),10<i&&(s={start:2,end:5}),Game.currentGame.field.addNextCell(this.createOnCollect.type.split(""),s),this.onCollectCreated++}this.onChangedListener(this.amount),this.checkCompleted(),this.checkIncompleted(),cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.COLLECT_SPECIAL_CELLS,e,{cell_code:this.type})}},Goal.prototype.incTarget=function(e,t){Game.currentGame&&(this.target+=e,t||Game.currentGame.score.addGoalTarget(this.type,e),this.onChangedListener(
this.amount),this.checkCompleted(),this.checkIncompleted())},Goal.prototype.getRemaining=function(){return Math.max(0,this.target-this.amount)},Goal.prototype.checkCompleted=function(){this.amount>=this.target&&!this.done&&(this.done=!0,this.onCompletedListener(),this.onCompletedGoalsListener())},Goal.prototype.checkIncompleted=function(){this.amount<this.target&&this.done&&(this.done=!1,this.onIncompletedListener(),this.onIncompletedGoalsListener())};var Goals=function(e){this.elements={},this.isDone=!1;var i=this.amountGoals=0;e.goals.forEach(function(e){var t=new Goal(e.type,e.target,e.createOnCollect);this.elements[e.type]=t,this.amountGoals++,i++,t.onCompletedGoalsListener=function(){0===--i&&(this.isDone=!0)}.bind(this),t.onIncompletedGoalsListener=function(){0<++i&&(this.isDone=!1)}.bind(this)},this)};Goals.prototype.incGoal=function(e,t,i){this.elements[e].inc(t,i)},Goals.prototype.typeInGoals=function(e){return void 0!==this.elements[e]},Goals.prototype.inGoals=function(e){
return this.typeInGoals(e.getGoalId())},Goals.prototype.incTarget=function(e,t,i){this.elements[e].incTarget(t,i)},Goals.prototype.goalsInLeft=function(){return cleverapps.wideMode.mode===cleverapps.WideMode.HORIZONTAL},Goals.prototype.getFlyDuration=function(e){var t,i;this.goalsInLeft()?(t=e.y-(Field.SIZE-1)/2,i=e.x+2):(t=e.y+2,i=e.x-(Field.SIZE-1)/2);var s=Math.sqrt(t*t+i*i)/Goals.FLY_DURATION_KOEF;return s<Goals.MIN_FLY_DURATION&&(s=Goals.MIN_FLY_DURATION),s},Goals.prototype.check=function(e,t,i){var s=e.getGoalId(),n=this.getFlyDuration(e),o=Goals.UP_DURATION+Goals.WAIT_DURATION;if(t){var a=Goals.DEFAULT_NEXT_CELL_DURATION;a*i>Goals.MAX_NEXT_CELL_DURATION&&(a=Goals.MAX_NEXT_CELL_DURATION/i),o+=a*=t}var r=e.coef||0;r++;var l=n+o;return Game.counter.setTimeout(function(){}.bind(this),1e3*(o+Goals.BLOCKED_DURATION)),Game.counter.goalSetTimeout(function(){this.incGoal(s,r)}.bind(this),1e3*(l+e.preCollectDuration()-Goals.INC_DELAY)),{duration:l,waitDuration:o-Goals.UP_DURATION,type:s}}
,Goals.FLY_DURATION_KOEF=8,Goals.UP_DURATION=.2,Goals.MIN_FLY_DURATION=.5,Goals.BLOCKED_DURATION=.3,Goals.DEFAULT_NEXT_CELL_DURATION=.15,Goals.MAX_NEXT_CELL_DURATION=.6,Goals.WAIT_DURATION=.2;var Floor={DIRS:[{x:1,y:Goals.INC_DELAY=0},{x:0,y:1},{x:-1,y:0},{x:0,y:-1}],LEFT:0,STRAIGHT:1,RIGHT:2,CalculateBorder:function(s,e){for(var t,i,n=function(e,t,i){return s[e-i.y]&&s[e-i.y][t-i.x]},o=0;o<Field.SIZE;o++)for(var a=0;a<Field.SIZE;a++)if(s[o][a])for(var r=0;r<Floor.DIRS.length;r++){var l=Floor.DIRS[r];if(!n(o,a,l)){var c=Floor.DIRS[(r+1)%Floor.DIRS.length];n(o,a,(i=c,{x:(t=l).x+i.x,y:t.y+i.y}))?e(o,a,r,Floor.LEFT):n(o,a,c)?e(o,a,r,Floor.STRAIGHT):e(o,a,r,Floor.RIGHT)}}}},CrazyCombosLibrary={multicolorSimple:function(e,t){e.crazyActionSimple(t)},multicolorCombo:function(e,t){e.crazyActionDuplicateCombos(t)},multicolorTwo:function(e,t){CrazyCombosHelper.merge([e,t],function(e){return new SuperMultiColorCell(e.x,e.y)},function(e){e.explode()})},planeTwo:function(e,t){
CrazyCombosHelper.merge([e,t],function(e){return new SuperMultiColorCell(e.x,e.y)},function(e){e.explode()})},planeLiner:function(e,t){CrazyCombosHelper.merge([e,t],function(e){return new SuperMultiColorCell(e.x,e.y)},function(e){e.explode()})},linerTwo:function(e,t){CrazyCombosHelper.merge([e,t],function(e){return new SuperMultiColorCell(e.x,e.y)},function(e){e.explode()})},comboCombo:function(e,t){e.algo.name===CombosLibrary.TYPE_PLANE&&t.algo.name===CombosLibrary.TYPE_PLANE?CrazyCombosLibrary.planeTwo(e,t):-1!==[e.algo.name,t.algo.name].indexOf(CombosLibrary.TYPE_PLANE)?CrazyCombosLibrary.planeLiner(e,t):CrazyCombosLibrary.linerTwo(e,t)}},CrazyCombosHelper={merge:function(e,t,i){var s=new Shape(e),n=this.getMergeDuration(),o=s.getCenter();s.merge({target:o,duration:n});var a=t(o);Game.counter.setTimeout(function(){e.forEach(function(e){e.delete()}),Game.currentGame.field.addCell(a),a.animate(BaseCell.ANIMATION_CREATE),Game.counter.setTimeout(function(){i(a)},
1e3*a.beforeExplodeTimeout())},1e3*n)},getMergeDuration:function(){return.2}},CrazyCombos=function(e,t){if(e instanceof MultiColorCell||t instanceof MultiColorCell)if(e instanceof MultiColorCell&&t instanceof MultiColorCell)CrazyCombosLibrary.multicolorTwo(e,t);else{var i=e,s=t;t instanceof MultiColorCell&&(i=t,s=e),s instanceof ComboCell||s instanceof ComboGoalCell?CrazyCombosLibrary.multicolorCombo(i,s):CrazyCombosLibrary.multicolorSimple(i,s)}else(e instanceof ComboCell||e instanceof ComboGoalCell)&&(t instanceof ComboCell||t instanceof ComboGoalCell)&&CrazyCombosLibrary.comboCombo(e,t)},Field=function(e){this.loader=e,this.onCellAdded=function(){},this.onTileAdded=function(){},this.onScoreAdded=function(){},this.onCloverAdded=function(){},this.onChangeSelected=function(){},this.onChangeSize=function(){},this.onBackgroundAdded=function(){},this.onMoveListener=function(){},this.onShowUpAnimation=function(){},this.onShowUpAnimationStartListener=function(){},this.onShakeField=function(
){},this.onTouchStarted=function(){},this.onTouchMoved=function(){},this.onTouchEnded=function(){},this.onTouchSwiped=function(){},this.onAddBorder=function(){},this.onShuffleAnimationListener=function(){},this.onBombByLeftMovesCreate=function(e){},this.onGoalsDoneAnimationListener=function(){},this.onBigExplodeAnimationListener=function(){},this.onFiveMovesLeftListener=function(){},this.onMoveAnimationListener=function(e,t,i){},this.onLetsGoAnimationListener=function(){},this.onHardLevelAnimationListener=function(){},this.onTutorialFinishAnimation=function(){},this.onBonusByLeftMovesListener=function(){},this.onHideAll=function(){},this.availableMove=new AvailableMove,BoosterAdvice.isEnabled()&&(this.boosterAdvice=new BoosterAdvice(this)),this.shufflesInRow=0,this.barriers=new Barriers};Field.prototype.calcEmptyColumns=function(e){for(var t=1e3,i=0;i<e.field.length;i++){for(var s=0,n=e.field[i].length-1;0<=n&&" "===e.field[i][n];n--)s++;s<t&&(t=s)}return t},
Field.prototype.calcEmptyRows=function(e){for(var t=0,i=e.field.length-1;0<=i;i--){for(var s=!0,n=0;n<e.field[i].length;n++)if(" "!==e.field[i][n]){s=!1;break}if(!s)break;t++}return t},Field.prototype.smile=function(){if(Game.currentGame&&Game.currentGame.field===this&&Game.currentGame.started&&!cc.game.isPaused()){for(var e=[],t=0;t<Field.SIZE;t++)for(var i=0;i<Field.SIZE;i++)this.cells[t]&&this.cells[t][i]&&this.cells[t][i].smile&&0<=this.cells[t][i].y&&e.push(this.cells[t][i]);if(0!==e.length)e[Math.floor(Math.random()*e.length)].smile()}},Field.prototype.showUpCells=function(){for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)this.cells[e][t]&&this.cells[e][t].animate(BaseCell.ANIMATION_SHOWUP),this.floor[e][t]&&this.floor[e][t].animate(BaseCell.ANIMATION_SHOWUP)},Field.prototype.showUpAnimation=function(e){this.onShowUpAnimationStartListener(),Field.SHOW_UP_ANIMATION_SOUND_DELAY&&Game.counter.setTimeout(function(){cleverapps.audio.playSound(
bundles.game.urls.game_start_effect)}.bind(this),Field.SHOW_UP_ANIMATION_SOUND_DELAY),Game.counter.setTimeout(function(){this.showUpCells(),Field.SHOW_UP_ANIMATION_SOUND_DELAY||cleverapps.audio.playSound(bundles.game.urls.game_start_effect),e()}.bind(this),Field.SHOW_UP_ANIMATION_DELAY)},Field.SHOW_UP_ANIMATION_START_DELAY=0,Field.SHOW_UP_ANIMATION_DELAY=1200,Field.SHOW_UP_ANIMATION_DURATION=2200,Field.prototype.showHideAnimation=function(){this.hidden||(this.hidden=!0,cleverapps.audio.playSound(bundles.game.urls.game_finish_effect),this.stopSmile())},Field.prototype.stopSmile=function(){void 0!==this.smileInterval&&(clearInterval(this.smileInterval),delete this.smileInterval)},Field.prototype.isSelected=function(e){return this.selected&&this.selected.y===e.y&&this.selected.x===e.x},Field.prototype.select=function(e){if(e){if(!e.movable||e.controlDisabled)return cleverapps.audio.playSound(res.click_blocked_effect),void e.animate(BaseCell.ANIMATION_MISTAKE);if(this.selected){if(
this.isSelected(e))return e.animate(BaseCell.ANIMATION_SELECT),void this.removeSelection();this.removeSelection()}(this.selected=e).animate(BaseCell.ANIMATION_SELECT),this.onChangeSelected(this.selected)}},Field.prototype.resetCoefs=function(){if(this.needResetCoef){this.needResetCoef=!1;for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var i=this.cells[e][t];i instanceof GoalColorCell?i.resetCoef():i&&i.innerCell&&i.innerCell instanceof GoalColorCell&&i.innerCell.resetCoef()}}},Field.prototype.prepareResetCoefs=function(){this.needResetCoef=!0;for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var i=this.cells[e][t];i instanceof GoalColorCell?i.prepareResetCoef():i&&i.innerCell&&i.innerCell instanceof GoalColorCell&&i.innerCell.prepareResetCoef()}},Field.prototype.removeSelection=function(){this.selected&&this.selected.onRemoveSelection&&this.selected.onRemoveSelection(),this.selected=void 0,this.onChangeSelected(this.selected)},Field.prototype.tileEvents=function(e){
this.onTileAdded(e),e.onAfterExplodeListener=this.removeTile.bind(this)},Field.prototype.cellEvents=function(e){this.onCellAdded(e),e.onAfterExplodeListener=this.removeCell.bind(this)},Field.prototype.addBackground=function(e,t){this.floor[t][e]=void 0,this.onBackgroundAdded(e,t)},Field.prototype.getRandomMulticolorTo=function(){var e,t,i=[];for(e=0;e<Field.SIZE;e++)for(t=0;t<Field.SIZE;t++)if(this.cells[e][t]){var s=this.cells[e][t];s.canDelete()&&i.push(s)}return 0<i.length&&i[cleverapps.Random.random(i.length)]},Field.prototype.addRandomMulticolor=function(e,t){var i=t&&t.boosterBefore,s=function(){var e=this.getRandomMulticolorTo();if(e){var t=new MultiColorCell(e.x,e.y);return Game.currentGame.field.addCell(t),i?(e.delete(),t.animate(BaseCell.ANIMATION_CREATE_FROM_BOOSTER_BEFORE)):t.animate(BaseCell.ANIMATION_CREATE_FROM_CENTER,{scale:.3}),Game.counter.setTimeout(function(){i||(e.delete(),t.animate(BaseCell.ANIMATION_CREATE,{silent:!0}))}.bind(this),
BaseCellView.CREATE_FROM_CENTER_DURATION),t}}.bind(this);e=e||1;for(var n=[],o=0;o<e;o++){var a=s();a&&n.push(a)}return n.length},Field.prototype.listRandomComboOptions=function(e){for(var t=[],i=0;i<Field.SIZE;i++)for(var s=0;s<Field.SIZE;s++)if(this.cells[i][s]){var n=this.cells[i][s];n.canDelete()&&t.push(n)}return t},Field.prototype.addRandomCombo=function(e,t){for(var s=(t=t||{}).boosterBefore,i=t.timeouts||[],n=cleverapps.Random.shuffle(this.listRandomComboOptions()),o=function(e,t,i){Game.counter.setTimeout(function(){e.delete(),this.addCell(t),s?t.animate(BaseCell.ANIMATION_CREATE_FROM_BOOSTER_BEFORE):(t.animate(BaseCell.ANIMATION_CREATE_FROM_CENTER,{scale:.3}),Game.counter.setTimeout(function(){t.animate(BaseCell.ANIMATION_CREATE)},BaseCellView.CREATE_FROM_CENTER_DURATION))}.bind(this),i)}.bind(this),a=[],r=0;r<n.length&&a.length<e;r++){var l=n[r],c=ComboCell.Create(l,{random:!0});if(c){l.missionMark&&(c.missionMark=!0);var p=a.length<i.length?i[a.length]:0;a.push(c),
l.toDelete=!0,o(l,c,p)}}return a.length},Field.prototype.load=function(e){if(this.floor=[],this.cells=[],this.selected=void 0,this.nextCells=[],this.blockedCells=[],e.firstCells)for(var t=0;t<e.firstCells.length;t++)this.nextCells.push([e.firstCells[t]]);Field.SIZE=e.field.length,Field.SIZE_X=Field.SIZE-this.calcEmptyColumns(e),Field.SIZE_Y=Field.SIZE-this.calcEmptyRows(e),this.onChangeSize();for(t=0;t<Field.SIZE;t++){this.floor.push([]),this.cells.push([]),this.blockedCells.push([]);for(var i=0;i<Field.SIZE;i++)this.floor[t].push(null),this.cells[t].push(void 0),this.blockedCells[t].push(!1)}var s=new Loader;s.load(e.field,function(e){this.cells[e.y][e.x]=e,this.addBackground(e.x,e.y)}.bind(this)),s.load(e.floor,function(e){this.addTile(e)}.bind(this)),this.barriers.load(e.barriers),TransporterTile.onLevelLoad(this.floor),GumDecoratorCell.onLevelLoad(),SyrupTile.onLevelLoad(),this._paint(),this.callCellEvents(),Floor.CalculateBorder(this.cells,this.onAddBorder),
this.calculateFallDownPortals(),cleverapps.environment.isSceneWithPreview()||(this.smileInterval=setInterval(function(){Math.random()<.1&&this.smile()}.bind(this),200))},Field.prototype.calculateFallDownPortals=function(){if(Match3Rules.SlideFallDown)if(this.portals={},Match3Rules.ClockMakerPortals){for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)if(null!==this.floor[t][e]){this.portals[e]=t-1;break}}else for(e=0;e<Field.SIZE;e++)null!==this.floor[0][e]&&(this.portals[e]=-1)},Field.prototype.markNotWillFall=function(){for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)this.cells[e][t]&&(this.cells[e][t].willFall=!1)},Field.prototype.animateDidFallNotWillFall=function(){for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)this.cells[e][t]&&(!0===this.cells[e][t].didFall&&!1===this.cells[e][t].willFall&&this.cells[e][t].animate(BaseCell.ANIMATION_DOWN),this.cells[e][t].didFall=this.cells[e][t].willFall)},Field.prototype.callCellEvents=function(){for(
var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)this.cells[e][t]&&this.cellEvents(this.cells[e][t])},Field.prototype.createRandomCell=function(e,t){return this.nextCells.length?this.loader.loadNext(t,e,this.nextCells.shift()):this.loader.loadNext(t,e,[Loader.WILDCARD])},Field.prototype.addNextCell=function(e,t){if(e[0]!==ColorCookieManCell.CODES[0]){for(var i=t||{start:7,end:15},s=cleverapps.Random.random(i.start,i.end),n=0;n<s;n++)this.nextCells.push([Loader.WILDCARD]);this.nextCells.push(e)}else ColorCookieManCell.exitToNextMove++},Field.prototype.addTile=function(e){this.tileEvents(e),this.floor[e.y][e.x]=e},Field.prototype.addCell=function(e,t,i){void 0===t&&(t=e.x),void 0===i&&(i=e.y),this.cellEvents(e),this.cells[i][t]=e},Field.prototype.replenishGaps=function(e){return Match3Rules.SlideFallDown?this.slideFallDown(e):this.simpleFallDown(e)},Field.prototype.isBlockedAbove=function(e,t){return!1===this.barriers.canMove(e-1,t,e,t)||this.portals[t]!==e-1&&(
void 0===this.floor[e-1]||null===this.floor[e-1][t]||void 0!==this.cells[e-1][t]&&(!this.cells[e-1][t].movable||this.cells[e-1][t].sticky))},Field.prototype.canFall=function(e,t,i){if(!this.isEmpty(e+1,t+i))return!1;if(!1===this.barriers.canMove(e,t,e+1,t))return!1;return this.portals[t]===e?0===i:!(0!==i&&!this.blockedCells[e+1][t+i])&&!(void 0===this.cells[e]||void 0===this.cells[e][t]||!this.cells[e][t].movable||this.cells[e][t].sticky)},Field.prototype.doFall=function(e,t,i,s){if(this.portals[t]===e){var n=s(t,e);this.addCell(n,t+i,e+1),n.onAppear(),n.move({x:t+i,y:e+1},{moveInterval:.1},n.onFinishAppear),n.willFall=!0}else this.cells[e][t].move({y:e+1,x:t+i},{moveInterval:.1}),this.cells[e+1][t+i]=this.cells[e][t],this.cells[e][t].willFall=!0,this.cells[e][t]=void 0},Field.prototype.slideFallDown=function(e){for(var t=0;t<Field.SIZE;t++)for(var i=0;i<Field.SIZE;i++)this.isEmpty(i,t)?0<i&&!0===this.blockedCells[i-1][t]?this.blockedCells[i][t]=!0:this.isBlockedAbove(i,t)&&(
this.blockedCells[i][t]=!0):this.blockedCells[i][t]=!1;var s=!1,n=-1,o=Math.random()<.5?1:0;for(i=Field.SIZE-2;-1<=i;i--){o=1-o;for(var a=0;a<Field.SIZE;a++){t=a;if((o+i)%2==0&&(t=Field.SIZE-1-a),-1===i&&-1===this.portals[t]||-1!==i&&!this.isEmpty(i,t)){var r=10;if(this.canFall(i,t,0))r=0;else{var l=this.canFall(i,t,-1),c=this.canFall(i,t,1);l&&c?r=n=-n:l?r=-1:c&&(r=1)}if(10!==r){if(s=!0,this.doFall(i,t,r,e),0!==r)for(var p=i;0<=p&&this.blockedCells[p][t+r]&&(this.blockedCells[p][t+r]=!1,!this.isBlockedAbove(p,t+r));p--);(0<i&&!0===this.blockedCells[i-1][t]||0<=i&&this.isBlockedAbove(i,t))&&(this.blockedCells[i][t]=!0)}}}}return s},Field.prototype.simpleFallDown=function(e){for(var t=Field.REPLENISH_GAPS_DELAY_STEP,i=0;i<Field.SIZE;i++){for(var s=[],n=0,o=0,a=Field.SIZE-1;0<=a;a--)if(!1===this.barriers.canMove(a,i,a+1,i)&&(n=s.length),void 0!==this.cells[a][i]&&this.cells[a][i].fallThroughBarrier&&s.length&&s.length===n&&!this.cells[a+1][i]&&n--,this.isEmpty(a,i))s.push({y:a,x:i}
);else if(void 0!==this.cells[a][i]&&this.cells[a][i].movable&&!this.cells[a][i].sticky&&s.length>n){var r=s[n++];this.cells[a][i].move(r,{delay:o,squeeze:!0}),o+=t*cleverapps.Random.nextDouble(),this.cells[r.y][r.x]=this.cells[a][i],this.cells[a][i]=void 0,s.push({y:a,x:i})}for(var l=void 0,c=0;c<s.length;c++){var p=s[c];if(void 0===this.cells[p.y][p.x]){void 0!==l&&p.y<l-1&&(o+=.1*(l-1-p.y)),l=p.y;var d=e(p.x,-(c+1));this.addCell(d,p.x,p.y),d.onAppear(),d.move(p,{delay:o,squeeze:!0},d.onFinishAppear),o+=t*cleverapps.Random.nextDouble()}}}},Field.prototype.isEmpty=function(e,t){return null!==this.floor[e][t]&&void 0===this.cells[e][t]},Field.prototype.removeTile=function(e,t){this.floor[t][e]=void 0},Field.prototype.removeCell=function(e,t){this.cells[t][e]=void 0},Field.prototype.findAllShapes=function(e){for(var a=[],r=[],t=0;t<Field.SIZE;t++)r.push({});var l=function(e,t,i,s){this.isThreeInRow(t,i)&&!r[t][i]&&this.cells[t][i].getColor()===s&&(r[t][i]=!0,e.add(this.cells[t][i]))
}.bind(this),i=function(e,t){if(!r[e][t]&&this.isThreeInRow(e,t)){var i=this.cells[e][t].getColor(),s=0,n=new Shape;for(l(n,e,t,i);s<n.cells.length;){var o=n.cells[s++];l(n,o.y+1,o.x,i),l(n,o.y-1,o.x,i),l(n,o.y,o.x+1,i),l(n,o.y,o.x-1,i)}a.push(n)}}.bind(this);if(e)i(e.y,e.x);else for(var s=0;s<Field.SIZE;s++)for(var n=0;n<Field.SIZE;n++)i(s,n);return a},Field.prototype.findRandomMove=function(){var e=cleverapps.Random.choose(this.findValidMove(!0)),t=this.cells[e.start.y+e.dir.row][e.start.x+e.dir.col];this.swap(e.start,t,!0),e.shape=this.findAllShapes(e.start)[0],this.swap(e.start,t,!0),this.availableMove.setMove(e)},Field.prototype._paint=function(e){for(var t=0;t<1e3;t++){var i=!1;if(!e)for(var s=0;s<Field.SIZE;s++)for(var n=0;n<Field.SIZE;n++)this.isThreeInRow(s,n)&&(this.cells[s][n]=this.cells[s][n].repaint(),i=!0);if(!i&&this.findValidMove())return e&&Game.counter.setTimeout(function(){},0),!0;for(var o=[],a=0;a<Field.SIZE;a++)for(var r=0;r<Field.SIZE;r++
)this.cells[a][r]&&this.cells[a][r].canRepaint(e)&&o.push([a,r]);if(o.length){var l=cleverapps.Random.choose(o),c=this.cells[l[0]][l[1]];this.cells[l[0]][l[1]]=c.repaint(),e&&(c.delete(),this.addCell(this.cells[l[0]][l[1]]))}}return e||cleverapps.ErrorHandler.logError("Cant repaint by 1000 attemts on level: "+(15*cleverapps.environment.episodeNo+cleverapps.environment.levelNo+1)),!1},Field.prototype.move=function(e,t){this.onMoveListener(),this.onMoveAnimationListener(e,t,!0),cleverapps.audio.playSound(bundles.game.urls.move_effect),this.removeSelection(),this.lastMove=[{x:e.x,y:e.y},{x:t.x,y:t.y}],e.move(t.getPosition(),{squeeze:!0}),t.move(e.getPosition(),{squeeze:!0}),Game.counter.setOnceZero(function(){this.swapBack(e,t),CrazyCombos(e,t)}.bind(this)),Game.counter.setAfterRunStages(function(){e.actionAfterRunStages(t),t.actionAfterRunStages(e)}.bind(this))},Field.prototype.invalidMove=function(e,t){this.removeSelection(),this.onMoveAnimationListener(e,t,!1),e.onWrongMoveListener(t),
cleverapps.audio.playSound(bundles.game.urls.wrong_move_effect)},Field.prototype.wrongMove=function(e,t){this.removeSelection(),this.onMoveAnimationListener(e,t,!1),e.onWrongMoveListener(t),t.onWrongMoveListener(e),cleverapps.audio.playSound(bundles.game.urls.wrong_move_effect)},Field.prototype.swap=function(e,t,i){if(this.cells[e.y][e.x]=t,this.cells[t.y][t.x]=e,i){var s=t.x,n=t.y;t.x=e.x,t.y=e.y,e.x=s,e.y=n}},Field.prototype.swapBack=function(e,t){this.cells[e.y][e.x]=e,this.cells[t.y][t.x]=t},Field.prototype.canMove=function(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)===1},Field.prototype.isValidMove=function(e,t){if(!e)return!1;if(!this.isWithinBounds(e.y+t.row,e.x+t.col))return!1;var i=this.cells[e.y+t.row][e.x+t.col];if(!i)return!1;if(!e.movable||!i.movable||e.controlDisabled||i.controlDisabled)return!1;if(!1===this.barriers.canMove(e.y,e.x,i.y,i.x))return!1;if(e.canMoveWith(i))return!0;if(i.canMoveWith(e))return!0;this.swap(e,i);var s=this.isThreeInRow(e.y,e.x
)||this.isThreeInRow(i.y,i.x);return this.swapBack(e,i),!!s||void 0},Field.prototype.onGameFinish=function(){for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)this.cells[e][t]&&this.cells[e][t].onGameFinish()},Field.prototype.bonusByLeftMoves=function(e){var t=Math.min(e,Field.MAX_ONE_TIME_LEFT_MOVES_EXPLODE_CELLS),i=BombByLeftMoves.ChooseLocations(this,t);this.onBonusByLeftMovesListener();for(var s=Field.BONUS_BY_MOVES_DELAY;0<i.length;s+=100){var n=cleverapps.Random.nextDouble(),o=n<.33?1:n<.66?2:3;i.splice(0,o).forEach(function(e,t){Game.counter.setTimeout(function(){this.bombByLeftMovesCreate(e)}.bind(this),s)}.bind(this))}Game.currentGame.setMoves(Game.currentGame.moves-e),Game.currentGame.score.addMovesRemaining(e)},Field.prototype.goalsDoneAnimation=function(){this.goalsDoneAnimationShown||(this.goalsDoneAnimationShown=!0,Game.counter.goalCounter.setTimeout(function(){},1200),this.onGoalsDoneAnimationListener())},Field.prototype.bombByLeftMovesCreate=function(e){
var t=new BombByLeftMoves(e.col,e.row);this.onBombByLeftMovesCreate(t),t.go()},Field.prototype.shuffle=function(e,t){if(this.findValidMove()&&!e)return this.shufflesInRow=0,!1;if(this.shufflesInRow++,1<this.shufflesInRow&&(10<this.shufflesInRow&&(cleverapps.ErrorHandler.logError("Endless shuffle"),Game.currentGame.stillNoPenalty()?Game.currentGame.giveUp():Game.currentGame.lose()),this._paint(!0)))return this.shufflesInRow=0,!1;if(!t){this.onShuffleAnimationListener(),t=[];for(var i=0;i<Field.SIZE;i++)for(var s=0;s<Field.SIZE;s++)this.cells[i][s]&&this.cells[i][s]instanceof ColorCell&&this.cells[i][s].movable&&!this.cells[i][s].sticky&&!this.cells[i][s].controlDisabled&&t.push(this.cells[i][s])}for(var n,o,a=0;a<50;a++){t.sort(function(){return cleverapps.Random.nextDouble()-.5}),o=[],n=[];for(i=0;i<t.length;i++)o.push({x:t[i].x,y:t[i].y}),n.push({x:t[(i+1)%t.length].x,y:t[(i+1)%t.length].y});for(i=0;i<t.length;i++)t[i].x=n[i].x,t[i].y=n[i].y,this.cells[t[i].y][t[i].x]=t[i];var r=!1;(
this.findValidMove()||0<this.findAllShapes().length)&&(r=!0);for(i=0;i<t.length;i++)t[i].x=o[i].x,t[i].y=o[i].y,this.cells[t[i].y][t[i].x]=t[i];if(r){this.shufflesInRow=0;break}}return Game.counter.setTimeout(function(){for(var e=0;e<t.length;e++)t[e].move(n[e],{moveInterval:Field.SHUFFLE_MOVE_INTERVAL,shuffle:!0});Game.counter.setOnceZero(function(){for(var e=0;e<t.length;e++)this.cells[n[e].y][n[e].x]=t[e]}.bind(this))}.bind(this),1e3*Field.SHUFFLE_MOVE_INTERVAL),!0},Field.prototype.findValidMove=function(e){for(var t=[],i=function(e){var t=this.cells[e.start.y+e.dir.row][e.start.x+e.dir.col];if(this.swap(e.start,t,!0),this.isThreeInRow(t.y,t.x)){e.dir.row=-e.dir.row,e.dir.col=-e.dir.col;var i=e.start;e.start=t,t=i}this.swap(e.start,t,!0)}.bind(this),s=0;s<Field.SIZE;s++)for(var n=0;n<Field.SIZE;n++){var o=this.cells[s][n];if(o){if(s<Field.SIZE-1){var a={start:o,dir:{row:1,col:0}};if(this.isValidMove(a.start,a.dir)){if(i(a),!e)return a;t.push(a)}}if(n<Field.SIZE-1){var r={start:o,
dir:{row:0,col:1}};if(this.isValidMove(r.start,r.dir)){if(i(r),!e)return r;t.push(r)}}}}return!!e&&t},Field.prototype.isThreeInRow=function(e,t){return!!this.isCellInField(e,t)&&(void 0!==this.cells[e][t].getColor()&&(!(!Match3Rules.Features.Plane||!(this.haveSquare(e,t,1,1)||this.haveSquare(e,t,1,-1)||this.haveSquare(e,t,-1,1)||this.haveSquare(e,t,-1,-1)))||(this.have3SameColor(e,t,1,0)||this.have3SameColor(e,t,0,1))))},Field.prototype.haveSquare=function(e,t,i,s){var n=this.cells[e][t].getColor();return this.isCellInField(e+i,t+s)&&this.cells[e+i][t+s].getColor()===n&&this.isCellInField(e,t+s)&&this.cells[e][t+s].getColor()===n&&this.isCellInField(e+i,t)&&this.cells[e+i][t].getColor()===n},Field.prototype.have3SameColor=function(e,t,i,s){var n=this.cells[e][t].getColor(),o=this.isCellInField(e+i,t+s)&&this.cells[e+i][t+s].getColor()===n,a=this.isCellInField(e-i,t-s)&&this.cells[e-i][t-s].getColor()===n;return!(!a||!o)||(i+=i,s+=s,!(!o||!this.isCellInField(e+i,t+s
)||this.cells[e+i][t+s].getColor()!==n)||!(!a||!this.isCellInField(e-i,t-s)||this.cells[e-i][t-s].getColor()!==n))},Field.prototype.isCellInField=function(e,t){return this.isWithinBounds(e,t)&&this.cells[e][t]},Field.prototype.inField=function(e,t){return this.isWithinBounds(e,t)&&null!==this.floor[e][t]},Field.prototype.isWithinBounds=function(e,t){return 0<=e&&0<=t&&e<Field.SIZE&&t<Field.SIZE},Field.prototype.hardLevelAnimation=function(){this.onHardLevelAnimationListener()},Field.prototype.letsGoAnimation=function(){this.onLetsGoAnimationListener()},Field.prototype.tutorialFinishAnimation=function(){this.onTutorialFinishAnimation()},Field.MAX_ONE_TIME_LEFT_MOVES_EXPLODE_CELLS=10,Field.REPLENISH_GAPS_DELAY_STEP=.1,Field.SHUFFLE_MOVE_INTERVAL=.5,Field.BONUS_BY_MOVES_DELAY=1e3;var Barriers=function(){this.onLoadListener=function(){}};Barriers.prototype.clear=function(){if(this.isDownBarrier)for(var e=0;e<this.isDownBarrier.length;e++)for(var t=0;t<this.isDownBarrier[e].length;t++
)this.isDownBarrier[e][t]=0;if(this.isRightBarrier)for(e=0;e<this.isRightBarrier.length;e++)for(t=0;t<this.isRightBarrier[e].length;t++)this.isRightBarrier[e][t]=0},Barriers.prototype.empty=function(){if(!this.isDownBarrier||!this.isRightBarrier)return!0;for(var e=0;e<this.isDownBarrier.length;e++)for(var t=0;t<this.isDownBarrier[e].length;t++)if(this.isDownBarrier[e][t])return!1;for(e=0;e<this.isRightBarrier.length;e++)for(t=0;t<this.isRightBarrier[e].length;t++)if(this.isRightBarrier[e][t])return!1;return!0},Barriers.prototype.save=function(){var e=[[],[]];if(this.isDownBarrier)for(var t=0;t<this.isDownBarrier.length;t++)for(var i=0;i<this.isDownBarrier[t].length;i++)this.isDownBarrier[t][i]&&e[0].push([t,i]);if(this.isRightBarrier)for(t=0;t<this.isRightBarrier.length;t++)for(i=0;i<this.isRightBarrier[t].length;i++)this.isRightBarrier[t][i]&&e[1].push([t,i]);return e},Barriers.prototype.load=function(e){this.isDownBarrier=[],this.isRightBarrier=[];for(var t=0;t<Field.SIZE-1;t++){for(
var i=[],s=0;s<Field.SIZE-1;s++)i.push(0);this.isRightBarrier.push(i.slice()),i.push(0),this.isDownBarrier.push(i)}if(this.isRightBarrier.push(this.isRightBarrier[0].slice()),e&&Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1])){for(t=0;t<e[0].length;t++)0<=e[0][t][0]&&e[0][t][0]<this.isDownBarrier.length&&0<=e[0][t][1]&&e[0][t][1]<this.isDownBarrier[e[0][t][0]].length&&(this.isDownBarrier[e[0][t][0]][e[0][t][1]]=1);for(t=0;t<e[1].length;t++)0<=e[1][t][0]&&e[1][t][0]<this.isRightBarrier.length&&0<=e[1][t][1]&&e[1][t][1]<this.isRightBarrier[e[1][t][0]].length&&(this.isRightBarrier[e[1][t][0]][e[1][t][1]]=1);this.onLoadListener()}},Barriers.prototype.canMove=function(e,t,i,s){if(!this.isDownBarrier||!this.isRightBarrier)return!0;if(e!=i){var n=e,o=t;return i<e&&(n=i),n<0||n>=this.isDownBarrier.length||o<0||o>=this.isDownBarrier[0].length?0:!this.isDownBarrier[n][o]}o=t;return s<t&&(o=s),(n=e
)<0||n>=this.isRightBarrier.length||o<0||o>=this.isRightBarrier[0].length?0:!this.isRightBarrier[n][o]},Barriers.bundleId=function(){return"barrier"};var AvailableMove=function(){this.visible=!1,this.running=!0,this.disabled=!1,this.scaredInterval=void 0,this.onChangeVisibleListener=function(){},this.onChangeMoveListener=function(){},this.off(),this.needReset=!0};AvailableMove.prototype.off=function(){this.setVisible(!1),this.scaredInterval&&clearInterval(this.scaredInterval),this.running=!1},AvailableMove.prototype.on=function(){this.disabled||(this.running=!0,this.boo())},AvailableMove.prototype.setDisabled=function(e){this.disabled!==e&&((this.disabled=e)?this.off():this.on())},AvailableMove.prototype.setMove=function(e){this.move=e,this.boo(),this.onChangeMoveListener(e)},AvailableMove.prototype.setVisible=function(e){this.visible!==e&&(this.visible=e,this.onChangeVisibleListener(this.visible))},AvailableMove.prototype.boo=function(){!1!==this.running&&(this.setVisible(!1),
this.scaredInterval&&clearInterval(this.scaredInterval),this.scaredInterval=setTimeout(function(){this.setVisible(!0)}.bind(this),AvailableMove.TIMEOUT))},AvailableMove.TIMEOUT=8e3;var Match3=function(e,t){GameBase.call(this,e,t),this.loader=new Loader,ColorCookieManCell.exitToNextMove=ColorCookieManCell.amountToExit=0,this.moves=this.levelContent.moves,this.leftMoves=this.moves,this.beginMoves=this.moves,this.score=new Score(e,this.beginMoves),this.goals=new Goals(this.levelContent),this.field=new Field(this.loader),this.prolongation=new Prolongation(this),this.lastMoveExplode=0,this.bigExplodeAmount=Match3.BIG_EXPLODE_AMOUNT,this.started=!1,BaseAnimationFactories={},this.callsOnFieldReady=[],this.boosters=new Boosters,this.field.onMoveListener=function(){this.moveInProgress=!0,0<this.moves&&(this.onMoveChangeMoves(),this.outcome===GameBase.OUTCOME_UNKNOWN&&BoosterCell.isNeedToAdd(this.moves,this.beginMoves)&&this.field.nextCells.push("booster"),
this.outcome===GameBase.OUTCOME_UNKNOWN&&TulpanCell.isNeedToAdd(this.moves,this.beginMoves)&&this.field.nextCells.push("tulpan")),this.updateOneTimePerMoveFeatures(),this.field.prepareResetCoefs()}.bind(this),this.counter=new GameCounter,Game.counter=this.counter,this.counter.fieldCounter.registerStage(0,this.hideAvailableMove.bind(this)),this.counter.fieldCounter.registerStage(99,ComboCell.resetComboTargets),this.counter.fieldCounter.registerStage(100,this.burn.bind(this)),this.counter.fieldCounter.registerStage(101,this.specialShuffle.bind(this)),this.counter.fieldCounter.registerStage(102,this.field.resetCoefs.bind(this.field)),this.counter.fieldCounter.registerStage(199,this.fall.bind(this)),this.counter.fieldCounter.registerStage(300,this.shuffle.bind(this)),this.counter.fieldCounter.onStageActivatedListener=function(){this.field.availableMove.needReset=!0}.bind(this),this.counter.registerStage(0,this.finishMove.bind(this)),this.counter.registerStage(5,this.incTutorial.bind(this))
,this.counter.registerStage(10,this.explodeOnGameFinish.bind(this)),this.counter.registerStage(20,this.bonusByLeftMoves.bind(this)),this.counter.registerStage(30,this.finalizeWin.bind(this)),this.counter.registerStage(40,this.showSmartHint.bind(this)),this.counter.goalCounter.registerStage(0,this.goalsDoneAnimation.bind(this)),this.counter.goalCounter.registerStage(10,this.checkWin.bind(this)),this.onCloverAdded=function(){},this.onChangeMovesStateListener=function(){},this.onChangeMovesListener=function(){},this.onMoveEnded=function(){},this.onBoosterCellCollected=function(){},this.onAnimatedChangeMovesListener=function(e,t,i){},this.start=void 0,this.field.onTouchStarted=this.onFieldTouchStarted.bind(this),this.field.onTouchMoved=this.onFieldTouchMoved.bind(this),this.field.onTouchEnded=this.onFieldTouchEnded.bind(this),this.field.onTouchSwiped=this.onFieldTouchSwiped.bind(this),cleverapps.config.rpg&&(this.enemies=this.selectEnemies()),
"adventure"===cleverapps.config.name?this.counter.fieldCounter.registerStage(998,this.bigExplodeStage.bind(this)):"runes"===cleverapps.config.name&&(this.moves<0&&(this.originalMoves=this.moves,this.moves=100,this.leftMoves=this.moves,this.beginMoves=this.moves),this.counter.fieldCounter.registerStage(997,this.bigExplodeStage.bind(this)),this.counter.fieldCounter.registerStage(998,this.enemyAttackStage.bind(this)),this.counter.fieldCounter.registerStage(999,SharkCell.process))},Game=Match3;Match3.prototype=Object.create(GameBase.prototype),(Match3.constructor=Match3).prototype.afterChangeOutcome=function(){this.outcome===GameBase.OUTCOME_VICTORY?this.score.setMovesRemainingTarget(this.moves):this.finishGame()},Match3.prototype.showUp=function(e){cleverapps.environment.isEditorScene()?e():cleverapps.metha.compound(e,[function(e){Game.counter.setTimeout(e,Field.SHOW_UP_ANIMATION_START_DELAY)},function(e){this.field.showUpAnimation(e)}.bind(this),function(e){Game.counter.setTimeout(e,
Field.SHOW_UP_ANIMATION_DURATION)},function(e){this.started=!0,this.callsOnFieldReady.forEach(function(e){e()}),-1!==["heroes","matchcraft"].indexOf(cleverapps.config.name)&&this.showStartLevelMessage(),this.levelWithTutorial()?(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TUTORIAL_BEGIN),this.tutorial=new LevelTutorial(this.levelContent.tutorial,function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TUTORIAL_COMPLETE),this.field.tutorialFinishAnimation(),e()}.bind(this),!0),this.createTutorialController(!0)):e()}.bind(this),function(e){this.boostersBefore?this.boostersBefore.giveBonus(e):cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN)?cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN).logic.giveBonus(e,this.level):e()}.bind(this)])},Match3.prototype.getDailyCupStars=function(){return this.score.stars},Match3.prototype.onMoveChangeMoves=function(){this.decMoves()},Match3.prototype.incMoves=function(){this.setMoves(this.moves+1),
this.leftMoves++},Match3.prototype.decMoves=function(){this.setMoves(this.moves-1),this.leftMoves--},Match3.prototype.specialShuffle=function(){this.cellsForSpecialShuffle&&(this.field.shuffle(!0,this.cellsForSpecialShuffle),this.cellsForSpecialShuffle=void 0)},Match3.prototype.skipWinAnimation=function(){0<this.moves&&Game.currentGame.score.addMovesRemaining(this.moves),this.finalizeWin()},Match3.prototype.showStartLevelMessage=function(){this.levelWithTutorial()||(this.level.isHard()?this.field.hardLevelAnimation():this.field.letsGoAnimation())},Match3.prototype.levelWithTutorial=function(){return this.levelContent.tutorial&&this.level.isRegular()&&(this.level.isCurrentLevel()||cleverapps.config.debugMode)},Match3.prototype.initColorCellsPool=function(){for(var e=0;e<this.levelContent.colors.length;e++){var t=this.loader.loadNext(0,0,[this.levelContent.colors[e]]);if(t&&t.putInPoolAvailable)for(var i=t.getViewClass(),s=0;s<10;s++)0<s&&(t=this.loader.loadNext(0,0,[
this.levelContent.colors[e]])),cc.pool.putInPool(new i(t))}},Match3.prototype.initPool=function(){FieldScoreView.fillPool(),this.initColorCellsPool(),ExplosionView.fillPool(),CoefAnimation.fillPool(),void 0!==ColorFulAnimationView&&ColorFulAnimationView.fillPool(),BombByLeftMovesAnimation.fillPool()},Match3.prototype.canHelpByFiveAttempts=function(){return!1!==this.field.getRandomMulticolorTo()&&!this.helpByFiveAttemptsDone},Match3.prototype.helpByFiveAttempts=function(){this.helpByFiveAttemptsDone||(this.helpByFiveAttemptsDone=1,this.field.addRandomMulticolor(),cleverapps.playSession.inc(cleverapps.EVENTS.HELP_BY_FIVE_ATTEMPTS))},Match3.prototype.onFieldTouchStarted=function(e){this.field.availableMove.boo(),this.boosters.active&&this.boosters.active.onFieldTouchStarted(e)},Match3.prototype.onFieldTouchMoved=function(e){this.boosters.active?this.boosters.active.onFieldTouchMoved(e):this.field.selected&&this.field.selected.onMouseMove&&this.field.selected.onMouseMove(e)},
Match3.prototype.onFieldTouchEnded=function(e){if(this.field.availableMove.boo(),console.log("CLICK"),e){if(console.log("CLICK 1"),e.movable&&this.field.selected&&this.field.canMove(this.field.selected,e)){var t={row:e.y-this.field.selected.y,col:e.x-this.field.selected.x};this.tryMove(t)}else e.smile&&e.smile(),this.field.select(e);e.onTouchEnd()}},Match3.prototype.tryMove=function(e,t){var i=this.field.selected;if(t&&(i=this.field.cells[t.row]?this.field.cells[t.row][t.col]:void 0),i){var s=i.x+e.col,n=i.y+e.row;if(this.field.isWithinBounds(n,s)){var o=this.field.cells[n][s];if(o){var a=function(e){return e.movable&&!e.controlDisabled};if(a(i))if(a(o)){var r=this.field.isValidMove(i,e);if(!1!==r){var l=this.field.cells[i.y+e.row][i.x+e.col];!0===r?this.field.move(i,l):this.field.wrongMove(i,l)}}else this.field.invalidMove(i,o);else i.animate(BaseCell.ANIMATION_MISTAKE)}}}},Match3.prototype.onFieldTouchSwiped=function(e){this.field.swipeSelected&&this.tryMove(e,
this.field.swipeSelected)},Match3.MOVES_STATE_NORMAL=0,Match3.MOVES_STATE_DANGER=1,Match3.prototype._setMoves=function(e,t){this.goals.isDone||5<e&&this.moves<=5?this.onChangeMovesStateListener(Match3.MOVES_STATE_NORMAL):!this.goals.isDone&&e<=5&&5<this.moves&&this.onChangeMovesStateListener(Match3.MOVES_STATE_DANGER);var i=e-this.moves;this.moves=e,this.onChangeMovesListener(e,i,t)},Match3.prototype.setMoves=function(e,t){(t=t||{}).animate?this.onAnimatedChangeMovesListener(e-this.moves,t,this._setMoves.bind(this,e,t)):this._setMoves(e,t)},Match3.prototype.stop=function(){this.field.onTouchStarted=function(){},this.field.onTouchMoved=function(){},this.field.onTouchEnded=function(){},this.field.onTouchSwiped=function(){},this.field.onMoveListener=function(){},levels.FPS.stop(),GameBase.prototype.stop.call(this)},Match3.prototype.finishGame=function(){this.field.showHideAnimation(this.outcome),this.stop()},Match3.prototype.checkWin=function(){this.goals.isDone&&this.win()},
Match3.prototype.showSmartHint=function(){this.field.boosterAdvice&&this.field.boosterAdvice.enable()},Match3.prototype.finalizeWin=function(){this.outcome===GameBase.OUTCOME_VICTORY&&(this.score.updatePoints(),this.onVictoryAnimationsFinished(),this.finishGame())},Match3.prototype.updateOneTimePerMoveFeatures=function(){this.dirtDecoratorCellCanProcess=!0,this.crabDecoratorCellCanProcess=!0,this.crabMakerCellCanProcess=!0,this.dirtMakerCellCanProcess=!0,this.lollipopCellCanProcess=!0,this.dirtyHoneyTileCanProcess=!0,this.iceMakerCellCanProcess=!0,this.sharkCellCanProcess=!0,this.iceBlockMakerTileCanProcess=!0,this.cannonCellCanProcess=!0,this.smallPetardCellCanProcess=!0,CookieManCell.prepareToUp(),ColorCookieManCell.prepareToUp(),TransporterTile.prepareToMove(),SharkCell.prepareToProcess(),CandleCell.prepare(),BombCell.prepareToProcess()},Match3.prototype.onExecuteBooster=function(){this.score&&this.score.addBooster(),this.cannonCellCanProcess=!0},
Match3.prototype.finishMove=function(){if(this.outcome===GameBase.OUTCOME_VICTORY&&(this.score.addGoalFinished=!0),this.moveInProgress&&this.outcome===GameBase.OUTCOME_UNKNOWN&&(this.moveInProgress=!1,!this.goals.isDone)){if(this.onMoveEnded(this.moves))return;this.bigExplodeProcess()}this.score.moveExplode=0},Match3.prototype.bigExplodeProcess=function(){return this.lastMoveExplode<this.score.moveExplode?this.lastMoveExplode=this.score.moveExplode:this.lastMoveExplode=0,this.lastMoveExplode>=this.bigExplodeAmount&&(this.bigExplodeAmount++,this.bigExplode(),!0)},Match3.prototype.shakeField=function(e){this.field.onShakeField(e)},Match3.prototype.incTutorial=function(){this.tutorial&&!this.tutorial.finished&&this.outcome===GameBase.OUTCOME_UNKNOWN&&this.tutorial.nextStep()},Match3.prototype.goalsDoneAnimation=function(){this.goals.isDone&&this.field.goalsDoneAnimation()},Match3.prototype.explodeOnGameFinish=function(){this.goals.isDone&&(this.field.availableMove.setDisabled(!0),
this.field.boosterAdvice&&this.field.boosterAdvice.disable(),this.field.onGameFinish())},Match3.prototype.bonusByLeftMoves=function(){this.goals.isDone&&0<this.moves&&this.outcome===GameBase.OUTCOME_VICTORY&&(-1!==["riddles","heroes"].indexOf(cleverapps.config.name)?this.field.bonusByLeftMoves(this.moves):this.score.addMovesRemaining(this.moves))},Match3.prototype.load=function(){this.field.load(this.levelContent)},Match3.prototype.hideAvailableMove=function(){this.field.availableMove.off(),this.field.boosterAdvice&&this.field.boosterAdvice.disable()},Match3.prototype.bigExplode=function(e){this.tutorial&&!this.tutorial.finished||this.field.onBigExplodeAnimationListener(e)},Match3.prototype.burn=function(){for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)this.field.cells[e][t]&&this.field.cells[e][t].onBurnStage();var i=this.field.findAllShapes();0!==i.length&&(i.forEach(function(e){e.cells.forEach(function(e){e.prepareForBurn()})}),SyrupTile.enableProcess(),i.forEach(
function(n){var o=n.getCenter(),e=n.calculateForm();if(Match3Rules.Plus){var a=1;switch(e){case Shape.FOUR_V:case Shape.FOUR_H:case Shape.CROSS:a=2}}if(o instanceof GoalColorCell||o.innerCell instanceof GoalColorCell){var t=0;n.cells.forEach(function(e){e instanceof GoalColorCell&&t++,e.coef&&(t+=e.coef)}),this.field.onScoreAdded(t,o.getColor(),o.x,o.y)}if(-1!==[Mission.TYPE_COMBO].indexOf(this.getMissionType())&&e!==Shape.THREE){var i=1;switch(e){case Shape.CROSS:i=2;break;case Shape.FIVE:i=3}void 0===this.outcome&&(this.addClover(this.getMissionType(),i),this.field.onCloverAdded(i,o.x,o.y))}n.cells.sort(function(e,t){return cleverapps.wideMode.mode===cleverapps.WideMode.HORIZONTAL?e.x!==t.x?e.x-t.x:e.y-t.y:e.y!==t.y?e.y-t.y:e.x-t.x}),n.cells.forEach(function(e,t){var i={id:t,groupSize:n.cells.length};if(e===o&&o.lives<=1&&0<=o.lives&&!o.innerCell){var s=ComboCell.Create(o,{shape:n});s&&(i.callback=function(){Game.counter.setTimeout(function(){this.field.addCell(s),s.animate(
BaseCell.ANIMATION_CREATE)}.bind(this),200)}.bind(this))}Match3Rules.Plus?e.boomNeighbors(a):e.boomNeighbors(),e.hurt(i)},this),RugTile.process(n.cells),SyrupTile.process(n.cells)},this),this.lastMove=void 0)},Match3.prototype.fall=function(){this.field.markNotWillFall(),this.field.replenishGaps(function(e,t){return this.field.createRandomCell(e,t)}.bind(this))&&this.counter.setOnceZero(this.fall.bind(this)),this.field.animateDidFallNotWillFall()},Match3.prototype.shuffle=function(){return!!this.field.shuffle()||(this.field.availableMove.needReset&&(this.field.availableMove.needReset=!1,this.field.findRandomMove()),this.field.availableMove.on(),!1)},Match3.prototype.addBoosterCellReward=function(e){Game.currentGame.collectedBoosterCell=e,Game.currentGame.rewards[GameBase.REWARD_BOOSTER]=1,cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTER_CELL_COLLECTED),this.onBoosterCellCollected()},Match3.prototype.getPercentOfCompletion=function(){var e=0,t=0,i=this.goals.elements;for(
var s in i)e+=i[s].target,t+=Math.min(i[s].amount,i[s].target);return t/e},Match3.BIG_EXPLODE_AMOUNT=9;var Loader=function(){this.map={},this.map[" "]=void 0,this.doMap(ColorCell),this.doMap(GoalColorCell),this.doMap(MultiColorCell),this.doMap(SuperMultiColorCell),this.doMap(FishCell),this.doMap(FlowerCell),this.doMap(ChainDecoratorCell),this.doMap(NutCell),this.doMap(IceCreamMakerCell),this.doMap(DonutBoxCell),this.doMap(GrassTile),this.doMap(IceTile),this.doMap(TransporterTile),this.doMap(MouseCell),this.doMap(BlanketCell),this.doMap(DogCell),this.doMap(BombCell),this.doMap(DirtDecoratorCell),this.doMap(CrabDecoratorCell),this.doMap(DragonCell),this.doMap(CookieManCell),this.doMap(BoxDecoratorCell),this.doMap(GingerHouseCell),this.doMap(GingerHousePartCell),this.doMap(CrabMakerCell),this.doMap(FireworkCell),this.doMap(CakeCell),this.doMap(MuffinCell),this.doMap(MuffinGoalCell),this.doMap(BurstCell),this.doMap(DirtMakerCell),this.doMap(WaffleCell),this.doMap(TruffleCell),this.doMap(
ColorCookieManCell),this.doMap(CandleCell),this.doMap(RabbitTile),this.doMap(LollipopCell),this.doMap(ColorBombCell),this.doMap(BagDecoratorCell),this.doMap(IceBlockDecoratorCell),this.doMap(RugTile),this.doMap(FireflyJarCell),this.doMap(MultiColorBombCell),this.doMap(DirtyHoneyTile),this.doMap(DirtyHoneyDecoratorCell),this.doMap(ColorContainerCell),this.doMap(IceMakerCell),this.doMap(SharkCell),this.doMap(MovesCell),this.doMap(GumDecoratorCell),this.doMap(ClockCell),this.doMap(SmallPetardCell),this.doMap(IceBlockMakerTile),this.doMap(CannonCell),this.doMap(WallCell),this.doMap(SyrupTile),this.doMap(FigureDragonCell)};Loader.prototype.doMap=function(t){t.CODES.forEach(function(e){if(void 0!==this.map[e])throw console.log("Duplicate mapping for "+e),console.log(t),1;this.map[e]=t},this)},Loader.prototype.loadNext=function(e,t,i){if("booster"===i)return new BoosterCell(t,e);if("tulpan"===i)return new TulpanCell(t,e);i[0]===Loader.WILDCARD&&(i[0]=cleverapps.Random.choose(
Game.currentGame.levelContent.colors));var s=this.map[i[0]];if(void 0!==s){var n=new s(t,e);return n.load(i,this),n}},Loader.prototype.load=function(e,c){var p=0;e.forEach(function(e){var t=e.split("");t.reverse();for(var i=0,s=t.length-1;0<=s;){var n=t[s];s--;var o=[];if("0"<=n&&n<="9"){for(var a=n-"0";0<=s&&"0"<=t[s]&&t[s]<="9";)a=10*a+(t[s]-"0"),s--;for(var r=0;r<a;r++)o.push(t[s]),s--}else o.push(n);var l=this.loadNext(p,i,o);l&&c(l),i++}p++},this)},Loader.prototype.save=function(e,t){for(var i=[],s=0;s<Field.SIZE;s++){for(var n=[],o=0;o<Field.SIZE;o++)if(void 0===e[s][o])n.push(" ");else{var a=e[s][o].save();1<a.length&&(a=a.length.toString().split("").concat(a)),n=n.concat(a)}i.push(n.join(""))}return i};var GameCounter=function(){Counter.call(this),this.fieldCounter=new Counter,this.goalCounter=new Counter,this.fieldCounter.registerStage(1e3,this.onOneStable.bind(this)),this.goalCounter.registerStage(1e3,this.onOneStable.bind(this))};GameCounter.prototype=Object.create(
Counter.prototype),(GameCounter.prototype.constructor=GameCounter).prototype.turnOff=function(){this.fieldCounter.turnOff(),this.goalCounter.turnOff()},GameCounter.prototype.onOneStable=function(){this.isActive()||(this.runStages(),cleverapps.config.debugMode&&Match3Player.instance&&Match3Player.instance.trigger("prepareForMove"))},GameCounter.prototype.isActive=function(){return this.fieldCounter.isActive()||this.goalCounter.isActive()},GameCounter.prototype.setOnceZero=function(e){this.fieldCounter.onceZero=e},GameCounter.prototype.setAfterRunStages=function(e){this.fieldCounter.afterRunStages=e},GameCounter.prototype.setTimeout=function(e,t){return this.fieldCounter.setTimeout(e,t)},GameCounter.prototype.goalSetTimeout=function(e,t){return this.goalCounter.setTimeout(e,t)};var LevelTutorial=function(e,t,i){this.data=e,this.onStartLevel=i,this.step=-1,this.finished=!1,this.onFinishCallbacks=[t]};LevelTutorial.prototype.runOnFinishCallbacks=function(){this.onFinishCallbacks.forEach(
function(e){e&&e()})},LevelTutorial.prototype.nextStep=function(e){this.step++,this.step>=this.data.length?(this.runOnFinishCallbacks(),this.finished=!0):(Game.currentGame.hideAvailableMove(),this.prepare(this.data[this.step]),this.onChangeStep(this.data[this.step],e))},LevelTutorial.prototype.finishAll=function(){this.finishStep(),this.step=this.data.length,this.finished=!0,this.runOnFinishCallbacks()},LevelTutorial.prototype.finishStep=function(){for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var i=Game.currentGame.field.cells[e][t];i&&void 0!==i.tutorialMovable&&(i.movable=i.tutorialMovable,i.hurtable=i.tutorialHurtable,delete i.tutorialMovable,delete i.tutorialHurtable)}Game.currentGame.field.onChangeSelected=this.oldFieldOnChangeSelected,this.oldFieldOnChangeSelected=function(){},Game.currentGame.tryMove=this.oldGameTryMove,this.oldGameTryMove=function(){},Game.currentGame.boosters.setActive=this.oldBoostersSetActive,this.oldBoostersSetActive=function(){},
Game.currentGame.boosters.onExecute=this.oldBoostersOnExecute,this.oldBoostersOnExecute=function(){},Game.currentGame.field.availableMove.setDisabled(!1),Game.currentGame.field.boosterAdvice&&Game.currentGame.field.boosterAdvice.enable(),this.onFinishStep&&this.onFinishStep()},LevelTutorial.prototype.existInControll=function(e,t){for(var i=this.data[this.step],s=0;s<i.control.length;s++)if(e===i.control[s][0]&&t===i.control[s][1])return!0;return!1},LevelTutorial.prototype.prepare=function(t){for(var e=0;e<Field.SIZE;e++)for(var i=0;i<Field.SIZE;i++){var s=Game.currentGame.field.cells[e][i];s&&!this.existInControll(i,e)&&(s.tutorialMovable=s.movable,s.tutorialHurtable=s.hurtable,s.movable=!1,s.hurtable=!1)}this.oldFieldOnChangeSelected=Game.currentGame.field.onChangeSelected,Game.currentGame.field.onChangeSelected=function(e){this.onChangeSelected(e),this.oldFieldOnChangeSelected(e)}.bind(this),this.oldGameTryMove=Game.currentGame.tryMove,Game.currentGame.tryMove=function(e,t){
var i=Game.currentGame.field.selected;t&&(i=Game.currentGame.field.cells[t.row]?Game.currentGame.field.cells[t.row][t.col]:void 0),Game.currentGame.field.isValidMove(i,e)&&(this.finishStep(),Game.currentGame.tryMove(e,t))}.bind(this),void 0!==t.booster&&cleverapps.boostersCounter.getAmount(t.booster)<cleverapps.BoostersCounter.INIT_AMOUNT&&cleverapps.boostersCounter.setAmount(t.booster,cleverapps.BoostersCounter.INIT_AMOUNT),this.oldBoostersSetActive=Game.currentGame.boosters.setActive,Game.currentGame.boosters.setActive=function(e){void 0!==t.booster&&e&&e.id===t.booster&&(this.finishStep(),Game.currentGame.boosters.setActive(e),this.nextStep(!0))}.bind(this),this.oldBoostersOnExecute=Game.currentGame.boosters.onExecute,Game.currentGame.boosters.onExecute=function(e){e&&this.existInControll(e.x,e.y)&&(this.finishStep(),Game.currentGame.boosters.onExecute(e))}.bind(this),Game.currentGame.field.availableMove.setDisabled(!0),
Game.currentGame.field.boosterAdvice&&Game.currentGame.field.boosterAdvice.disable()};var BombByLeftMoves=function(e,t){this.x=e,this.y=t,this.onExplodeListener=function(){},this.onAnimateListener=function(){}};BombByLeftMoves.prototype.go=function(){this.onAnimateListener(),Game.counter.setTimeout(function(){this.explode()}.bind(this),1400)},BombByLeftMoves.prototype.explode=function(){for(var e=-1;e<=1;e++)for(var t=-1;t<=1;t++){var i=this.x+e,s=this.y+t;Game.currentGame.field.isCellInField(s,i)&&Game.currentGame.field.cells[s][i].hurt({id:0,groupSize:1})}this.onExplodeListener()},BombByLeftMoves.ChooseLocations=function(l,e){for(var c=[],t=0;t<Field.SIZE;t++){c.push([]);for(var i=0;i<Field.SIZE;i++)c[t].push(!1)}for(var s=function(e,t){if(!l.cells[e][t]||l.cells[e][t].lives<0)return 0;for(var i=0,s=-1;s<=1;s++)for(var n=-1;n<=1;n++){var o=e+s,a=t+n;if(l.isCellInField(o,a)&&0<l.cells[o][a].lives&&!c[o][a])if(Game.currentGame.goals.inGoals(l.cells[o][a])){var r=1;l.cells[o][a].coef&&(
r+=l.cells[o][a].coef),i+=10*r}else i+=3}return i},n=function(e,t){for(var i=-1;i<=1;i++)for(var s=-1;s<=1;s++){var n=e+i,o=t+s;l.isCellInField(n,o)&&(c[n][o]=!0)}},o=[],a=0;a<e;a++){var r=!1,p=0;for(t=0;t<Field.SIZE;t++)for(i=0;i<Field.SIZE;i++){var d=s(t,i);p<d&&(p=d,r={row:t,col:i})}if(!r)break;n(r.row,r.col),o.push(r)}return cleverapps.shuffle(o),o};var BaseAnimation=cc.Node.extend({ctor:function(e,t){this._super(),cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&cc.loader.getRes(e)?(this.animation=new cleverapps.Spine(e),this.addChild(this.animation)):t&&(this.sprite=new cc.Sprite(t),this.addChild(this.sprite)),this.inUse=!0,this.visible=!1,this.setLocalZOrder(10),this.startVisibleListener=function(){}},setSkin:function(e){this.animation&&this.animation.setSkin(e)},setStartVisibleListener:function(e){this.startVisibleListener=e},runAnimate:function(e,t,i,s){i instanceof cc.Node&&(s=i),t instanceof cc.Node&&(s=t),s&&this.setStartVisibleListener(function(){
s.visible=!1}),this.animation?(this.animation.setCompleteListener(function(){this.finishAnimation(t)}.bind(this)),this.animation.setStartVisibleListener(this.startVisibleListener),this.animation.setAnimation(0,e,!1)):(i&&this.sprite?this.sprite.runAction(new cc.Sequence(i,new cc.CallFunc(function(){this.finishAnimation(t)}.bind(this)))):this.runAction(new cc.CallFunc(function(){this.finishAnimation(t)}.bind(this))),this.startVisibleListener()),this.visible=!0},finishAnimation:function(e){this.inUse&&(this.inUse=!1,cc.pool.putInPool(this),"function"==typeof e&&e())},unuse:function(){this.removeFromParent(!1),this.visible=!1,this.animation&&(this.animation.visible=!1,this.animation.setStartVisibleListener(function(){}),this.animation.setCompleteListener(function(){})),this.startVisibleListener=function(){}},reuse:function(){this.inUse=!0,this.sprite&&(this.sprite.setOpacity(255),this.sprite.setScale(1))}});BaseAnimation.runAnimate=function(e,t,i,s,n){var o=BaseAnimation.factory(t)
;o.setPositionRound(e.width/2,e.height/2),e.addChild(o),o.runAnimate(i,s,n)};var DummyAnimation=cc.Node.extend({ctor:function(e){this._super(),this.inUse=!0,e&&(this.image=new cc.Sprite(e),this.addChild(this.image))},runAnimate:function(e,t,i,s){i instanceof cc.Node&&(s=i),t instanceof cc.Node&&(s=t),this.runAction(new cc.Sequence(new cc.DelayTime(DummyAnimation.DURATION),new cc.CallFunc(function(){s&&s.isRunningSafe()&&s.setVisible(!1),this.finishAnimation(t)}.bind(this))))},finishAnimation:function(e){this.inUse&&(this.inUse=!1,"function"==typeof e&&e(),this.removeFromParent())},setSkin:function(e){}});DummyAnimation.DURATION=.2,BaseAnimation.DEFAULT_LIMIT=9;var BaseAnimationClasses={},BaseAnimationFactories={};BaseAnimation.getClass=function(e){var t=e,i=BaseAnimationClasses[t];return i||(BaseAnimationClasses[t]=i=BaseAnimation.extend({ctor:function(){this._super(e)}})),i};var BaseAnimationSemaphore=function(e){this.amount=e};BaseAnimationSemaphore.prototype.lock=function(e){if(
0<this.amount)return this.amount--,e=e||.3,setTimeout(function(){this.amount++}.bind(this),1e3*e),!0},BaseAnimation.semaphore=function(e,t){var i="semaphore_"+e,s=BaseAnimationFactories[i];return s||(s=BaseAnimationFactories[i]=new BaseAnimationSemaphore(t)),s},BaseAnimation.factoryLimited=function(e,t,i){return t=t||BaseAnimation.DEFAULT_LIMIT,BaseAnimation.factory(e,t,i)},BaseAnimation.factory=function(t,i,s){var e=t+"_"+i;i=i||65536;var n=BaseAnimationFactories[e];return n||(n=BaseAnimationFactories[e]=function(){var e=BaseAnimation.getClass(t);return cc.pool.hasObject(e)?cc.pool.getFromPool(e):0<i?(i--,new e):new DummyAnimation(s)}),n()};var BaseBooster=function(e){this.id=e,this.prices=cleverapps.config.prices.boosters[e];var t=BaseBooster.AVAILABLE[e];this.disabled=!levels.user.checkAvailable(t),this.hoverCell=void 0,this.onExecuteListener=function(e){},this.onHurtCellsListener=function(e){},this.onActivateListener=function(){},this.onDeactivateListener=function(){},
this.onChangeAmountListener=function(){}};BaseBooster.prototype.deactivate=function(){this.onDeactivateListener(),this.onFieldTouchMoved(void 0)},BaseBooster.prototype.getAmount=function(){return cleverapps.boostersCounter.getAmount(this.id)},BaseBooster.prototype.execute=function(e){if(e=e&&this.isAllowedTarget(e)?e:void 0,this.onExecuteListener(e),e){Game.currentGame&&Game.currentGame.field.boosterAdvice&&Game.currentGame.field.boosterAdvice.disable();var t=this.listAffected(e),i=t.cells,s=t.tiles;0<i.length&&(cleverapps.boostersCounter.use(this.id),this.hurtCells(i),this.hurtTiles(s),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HINT_USED,{amount:this.prices[1]}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTERS_EXECUTE),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTERS_EXECUTE+"_"+this.id),Game.currentGame&&Game.currentGame.onExecuteBooster())}},BaseBooster.prototype.hurtCells=function(t){t.forEach(function(e){e.willBurn=!0,e.onBeforeHurtViaBooster(t)}),
this.onHurtCellsListener(t),delete this.hoverCell},BaseBooster.prototype.hurtCell=function(e,t,i){e.alive&&e.hover(!1),e.hurt({id:t,groupSize:i,boosterId:this.id})},BaseBooster.prototype.hurtTiles=function(e){e.forEach(function(e){e.hurtViaBooster(this.id)}.bind(this))},BaseBooster.prototype.addHover=function(e){this.isAllowedTarget(e)&&this.listAffected(e).cells.forEach(function(e){e.hover(!0)})},BaseBooster.prototype.removeHover=function(e){this.listAffected(e).cells.forEach(function(e){e.hover(!1)})},BaseBooster.prototype.onFieldTouchStarted=function(e){this.execute(e)},BaseBooster.prototype.onFieldTouchMoved=function(e){if(this.hoverCell!==e){var t=[],i=[];this.hoverCell&&(t=this.listAffected(this.hoverCell).cells,this.hoverCell=void 0),e&&this.isAllowedTarget(e)&&(this.hoverCell=e,i=this.listAffected(e).cells);var s=function(e){return e.x+"_"+e.y};cleverapps.substract(t,i,s).forEach(function(e){e.hover(!1)}),cleverapps.substract(i,t,s).forEach(function(e){e.hover(!0)})}},
BaseBooster.prototype.isAllowedTarget=function(e){return e.hurtable},BaseBooster.prototype.onFieldTouchEnded=function(e){e&&this.execute(e)},BaseBooster.prototype.getViewClass=function(){return BaseBoosterView},BaseBooster.AVAILABLE={0:{level:12},1:{episode:1,level:4},2:{episode:1,level:10}};var CellBooster=function(){BaseBooster.call(this,CellBooster.ID)};CellBooster.prototype=Object.create(BaseBooster.prototype),(CellBooster.prototype.constructor=CellBooster).prototype.listAffected=function(e){this.targetCell=e;var t=[];return Game.currentGame.field.floor[e.y][e.x]&&t.push(Game.currentGame.field.floor[e.y][e.x]),{cells:[e],tiles:t}},CellBooster.prototype.getViewClass=function(){return CellBoosterView},CellBooster.prototype.hurtCells=function(i){BaseBooster.prototype.hurtCells.call(this,i),Game.counter.fieldCounter.setTimeout(function(){i.forEach(function(e,t){this.hurtCell(e,t,i.length)}.bind(this)),Game.currentGame&&Game.currentGame.shakeField({power:.5})}.bind(this),
CellBooster.HURT_DELAY)},CellBooster.ID=0,CellBooster.HURT_DELAY=500;var LineBooster=function(){BaseBooster.call(this,LineBooster.ID)};LineBooster.prototype=Object.create(BaseBooster.prototype),(LineBooster.prototype.constructor=LineBooster).prototype.listAffected=function(e){var t=[],i=[],s=0,n=Field.SIZE,o=1;LineBooster.DIRECTION===LineBooster.DIRECTIONS.DOWN_UP&&(s=Field.SIZE-1,o=n=-1);for(var a=s;a!==n;a+=o)Game.currentGame.field.cells[a][e.x]&&Game.currentGame.field.cells[a][e.x].hurtable&&(t.push(Game.currentGame.field.cells[a][e.x]),Game.currentGame.field.floor[a][e.x]&&i.push(Game.currentGame.field.floor[a][e.x]));return{cells:t,tiles:i}},LineBooster.prototype.isAllowedTarget=function(){return!0},LineBooster.prototype.getViewClass=function(){return LineBoosterView},LineBooster.prototype.hurtCells=function(s){BaseBooster.prototype.hurtCells.call(this,s),s.forEach(function(e,t){var i=LineBooster.HURT_DELAY+100*Math.abs(e.y-s[0].y);Game.counter.fieldCounter.setTimeout(function(){
this.hurtCell(e,0,1),Game.currentGame&&t===s.length-1&&Game.currentGame.shakeField()}.bind(this),i)}.bind(this))},LineBooster.ID=1,LineBooster.DIRECTIONS={UP_DOWN:0,DOWN_UP:1},LineBooster.DIRECTION=LineBooster.DIRECTIONS.UP_DOWN,LineBooster.HURT_DELAY=0;var ColorBooster=function(){BaseBooster.call(this,ColorBooster.ID)};ColorBooster.prototype=Object.create(BaseBooster.prototype),(ColorBooster.prototype.constructor=ColorBooster).prototype.listAffected=function(e){for(var t=[],i=[],s=(this.targetCell=e).getColor(),n=0;n<Field.SIZE;n++)for(var o=0;o<Field.SIZE;o++)Game.currentGame.field.cells[n][o]&&Game.currentGame.field.cells[n][o].hurtable&&(Game.currentGame.field.cells[n][o].getColor()!==s||void 0===s&&Game.currentGame.field.cells[n][o]!==e||(t.push(Game.currentGame.field.cells[n][o]),Game.currentGame.field.floor[n][o]&&i.push(Game.currentGame.field.floor[n][o])));return{cells:t,tiles:i}},ColorBooster.prototype.getViewClass=function(){return ColorBoosterView},
ColorBooster.prototype.hurtCells=function(i){BaseBooster.prototype.hurtCells.call(this,i),Game.counter.fieldCounter.setTimeout(function(){var e=[];Array.prototype.push.apply(e,i),cleverapps.shuffle(e).forEach(function(e){e.animate(BaseCell.ANIMATION_MULTI_COLOR_SELECT)}),i.forEach(function(e,t){this.hurtCell(e,t,i.length)}.bind(this)),Game.currentGame&&Game.currentGame.shakeField()}.bind(this),ColorBooster.HURT_DELAY)},ColorBooster.HURT_DELAY=900,ColorBooster.ID=2;var Boosters=function(){this.active=void 0,this.list=[new CellBooster,new LineBooster,new ColorBooster],this.list.forEach(function(t){t.onExecuteListener=function(e){cleverapps.history.add("bstr"+t.id,1),this.onExecute(e)}.bind(this)},this),cleverapps.boostersCounter.onChangeListener=function(){this.list.forEach(function(e){e.onChangeAmountListener()})}.bind(this),cleverapps.environment.onOpenWindowListener=function(e){this.setActive(void 0)}.bind(this),this.onSetActiveListener=function(){},this.onExecuteListener=function(e
){}};Boosters.prototype.amountAvailable=function(){var t=0;return this.list.forEach(function(e){e.disabled||t++}),t},Boosters.prototype.listAll=function(){return this.list},Boosters.prototype.getActive=function(){},Boosters.prototype.onExecute=function(e){this.setActive(void 0),this.onExecuteListener(e)},Boosters.prototype.setActive=function(e){this.active!==e&&(this.active&&(Game.currentGame.field.availableMove.on(),this.active.deactivate()),this.active=e,this.active&&(Game.currentGame.field.availableMove.off(),Game.currentGame.field.removeSelection(),this.active.onActivateListener()),this.onSetActiveListener())},HintAlgorithm=function(e){this.ideas=[],this.field=e},HintAlgorithm.prototype.getResult=function(){for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var i=this.field.cells[e][t];if(i)for(var s=0;s<this.ideas.length;s++)if(this.ideas[s].call(this,i))return{row:e,col:t}}},HintAlgorithm.prototype.isRemovable=function(e){return!(!e.hurtable||!e.hurtable)&&-1===[
"DonutBoxCell","IceCreamMakerCell","CandleCell"].indexOf(e.constructor.name)},HintAlgorithm.prototype.isActiveGoal=function(e){var t=Game.currentGame.goals.elements,i=e.getGoalId();return void 0!==i&&t[i]&&!t[i].done},HintAlgorithm.prototype.countSameGoals=function(e){var t=Game.currentGame.goals.elements,i=e.getGoalId();if(this.isActiveGoal(e))return t[i].getRemaining()},HintAlgorithm.prototype.getEater=function(t){var e=Game.currentGame.EATERS.filter(function(e){return-1!==e.getAcceptedColors().indexOf(t)});if(e&&0!==e.length)return void 0!==EaterCell.COLOR_EATERS[t]?e[(EaterCell.COLOR_EATERS[t]+1)%e.length]:e[0]},HintAlgorithm.prototype.isBottomRowElement=function(e){return-1!==["FishCell","GingerHousePartCell","CookieManCell"].indexOf(e.constructor.name)},CellHintAlgorithm=function(e){HintAlgorithm.call(this,e),this.ideas=[this.removeBombIdea,this.moveToBottomIdea,this.collectMarkIdea,this.completeGoalIdea]},CellHintAlgorithm.prototype=Object.create(HintAlgorithm.prototype),
CellHintAlgorithm.constructor=CellHintAlgorithm,CellHintAlgorithm.prototype.getId=function(){return CellBooster.ID},CellHintAlgorithm.prototype.getResult=function(){for(var e=this.totalMarks=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)this.field.cells[e][t]&&this.field.cells[e][t].mark&&this.totalMarks++;return HintAlgorithm.prototype.getResult.call(this)},CellHintAlgorithm.prototype.removeBombIdea=function(e){if("BombCell"===e.constructor.name){var t=e.untilExplode;return t<=3&&0<t||void 0}},CellHintAlgorithm.prototype.completeGoalIdea=function(e){if(this.isActiveGoal(e)&&!(3<this.countSameGoals(e)))return"CandleCell"===e.constructor.name?e.state===CandleCell.STATE_OFF&&1===this.countSameGoals(e):e.hurtable&&1===e.lives},CellHintAlgorithm.prototype.collectMarkIdea=function(e){if(e.mark)return this.totalMarks<=2},CellHintAlgorithm.prototype.moveToBottomIdea=function(e){var t=0<e.y&&this.field.cells[e.y-1][e.x];if(t&&this.isBottomRowElement(t)){for(var i=void 0,
s=e.y;s<Field.SIZE;s++)if(this.field.cells[s][e.x]){if(i)return!1;i=this.field.cells[s][e.x]}if(i&&this.isRemovable(i))return!0}},LineHintAlgorithm=function(e){HintAlgorithm.call(this,e),this.ideas=[this.completeGoalIdea,this.bottomRowElementsIdea]},LineHintAlgorithm.prototype=Object.create(HintAlgorithm.prototype),LineHintAlgorithm.constructor=LineHintAlgorithm,LineHintAlgorithm.prototype.getId=function(){return LineBooster.ID},LineHintAlgorithm.prototype.getResult=function(){return this.columnsProcessed={},HintAlgorithm.prototype.getResult.call(this)},LineHintAlgorithm.prototype.completeGoalIdea=function(e){if(!this.columnsProcessed[e.col]&&this.isActiveGoal(e)&&e.hurtable){for(var t=e.getGoalId(),i=this.countSameGoals(e),s=e.col,n=0,o=0;o<Field.SIZE;o++){(e=this.field.cells[o][s])&&e.getGoalId()===t&&n++}return i<=n}},LineHintAlgorithm.prototype.bottomRowElementsIdea=function(e){return this.isBottomRowElement(e)},ColorHintAlgorithm=function(e){HintAlgorithm.call(this,e),this.ideas=[
this.completeGoalIdea,this.feedEaterIdea]},ColorHintAlgorithm.prototype=Object.create(HintAlgorithm.prototype),ColorHintAlgorithm.constructor=ColorHintAlgorithm,ColorHintAlgorithm.prototype.getId=function(){return ColorBooster.ID},ColorHintAlgorithm.prototype.completeGoalIdea=function(e){if(this.isActiveGoal(e)){var t=e.getColor();if(t){for(var i=e.getGoalId(),s=this.countSameGoals(e),n=0,o=0;o<Field.SIZE;o++)for(var a=0;a<Field.SIZE;a++){(e=this.field.cells[o][a])&&e.getColor()===t&&e.getGoalId()===i&&(n++,e.coef&&(n+=e.coef))}return s<=n}}},ColorHintAlgorithm.prototype.feedEaterIdea=function(e){if(Game.currentGame.EATERS&&!(!e instanceof ColorCell)){var t=this.getEater(e.getColor());if(t)return t.lives<=10}};var BoosterAdvice=function(t){this.field=t,this.boosterAlgorithms=[CellHintAlgorithm,LineHintAlgorithm,ColorHintAlgorithm].map(function(e){return new e(t)}),this.movesSinceShown=0,this.onChangeVisibleListener=function(){},this.onShowAdvice=function(){}}
;BoosterAdvice.prototype.showAdvice=function(){if(this.clearTimeout(),this.movesSinceShown++,Game.currentGame&&this.isReady()){var e=this.getAdvice();e&&(this.showTimeout=setTimeout(function(){this.movesSinceShown=0,this.onShowAdvice(e),this.setVisible(!0)}.bind(this),2e3))}},BoosterAdvice.prototype.isReady=function(){return 2<this.movesSinceShown&&!cleverapps.screenshotsMode},BoosterAdvice.prototype.clearTimeout=function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=void 0)},BoosterAdvice.prototype.setVisible=function(e){this.visible=e,this.onChangeVisibleListener(this.visible)},BoosterAdvice.prototype.disable=function(){this.disabled=!0,this.clearTimeout(),this.setVisible(!1)},BoosterAdvice.prototype.enable=function(){this.disabled=!1,this.showAdvice()},BoosterAdvice.prototype.getAdvice=function(){var e=this.boosterAlgorithms.map(function(e){if(!Game.currentGame.boostersController.boosters.list[e.getId()].disabled){var t=e.getResult();return t?{target:t,
boosterId:e.getId()}:void 0}}).filter(function(e){return void 0!==e});return cleverapps.Random.choose(e)},BoosterAdvice.isEnabled=function(){return!cleverapps.screenshotsMode};var BaseBoosterView=cc.Node.extend({create:function(e){this.mainIcon=new cc.Sprite(e.icon_png),this.setContentSize2(this.mainIcon.getContentSize()),this.mainIcon.setPositionRound(this.width/2,this.height/2),this.addChild(this.mainIcon)},ctor:function(e,t){this._super(),this.setAnchorPoint2(),this.booster=e,this.icons=t,this.create(t),e.onActivateListener=this.createListener(this.showActivated.bind(this)),e.onDeactivateListener=this.createListener(this.showDeactivated.bind(this)),e.onHurtCellsListener=this.createListener(this.onHurtCellsAnimation.bind(this));var i=cleverapps.styles.BaseBoosterView;if(i.background){var s=res.booster_icon_bg_png;e.disabled&&res.booster_locked_png&&(s=res.booster_locked_png);var n=new cc.Sprite(s),o=i.background[cleverapps.wideMode.mode];o&&o.scale9&&(
n=cleverapps.UI.createScale9Sprite(s,o.scale9)).setContentSize(o.width,o.height),n.setLocalZOrder(-1),n.setPositionRound(this.width/2+i.bgOffset.x,this.height/2+i.bgOffset.y),this.addChild(n),this.bg=n;var a=new cc.Sprite(res.booster_icon_bg_on_png);if(o&&o.scale9&&(a=cleverapps.UI.createScale9Sprite(res.booster_icon_bg_on_png,o.scale9)).setContentSize(o.width,o.height),a.setLocalZOrder(-1),a.setPositionRound(n.getPosition()),a.visible=!1,this.addChild(a),this.bgOn=a,e.disabled&&i.locked){var r=new cc.Sprite(res.locked_png);n.addChild(r),r.setPositionRound(i.locked.x,i.locked.y)}}i.scales&&(this.setScale(i.scales[cleverapps.wideMode.mode]),this.baseScale=i.scales[cleverapps.wideMode.mode]),e.disabled&&i.hideWhenDisabled&&this.setVisible(!1),this.amount=new BoosterAmountView(e),this.amount.setPositionRound(this.width+i.amount.x,i.amount.y),this.addChild(this.amount),this.price=new cc.Sprite(res["booster_price_"+e.id]),this.price.setPositionRound(this.width/2+i.price.x,i.price.y),
this.addChild(this.price),0<e.getAmount()?this.price.setVisible(!1):this.amount.setVisible(!1),e.disabled?(this.amount.setVisible(!1),this.price.setVisible(!1),this.mainIcon.setVisible(!1)):(cleverapps.UI.applyHover(this),this.onTouchBeganListener=function(){},this.onTouchOutListener=function(){},this.onTouchMovedListener=function(){},this.onTouchEndedListener=function(){},cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)},this),e.onChangeAmountListener=this.createListener(function(){0<e.getAmount()?(this.amount.setVisible(!0),this.amount.setAmount(e.getAmount()),this.price.setVisible(!1)):(this.price.setVisible(!0),this.amount.setVisible(!1))}.bind(this)))},showActivated:function(){this.mainIcon.setSpriteFrame(this.icons.icon_active_png),this.setBackground(!0)},showDeactivated:function(){this.mainIcon.setSpriteFrame(this.icons.icon_png),
this.setBackground(!1)},onTouchBegan:function(e){return this.containsTouch(e)?(this.onTouchBeganListener(),!0):(this.runAction(new cc.CallFunc(function(){this.onTouchOutListener()}.bind(this))),!1)},containsTouch:function(e){var t=this.convertTouchToNodeSpace(e);return cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)},onTouchMoved:function(e){this.onTouchMovedListener(e)},onTouchEnded:function(e){this.containsTouch(e)||this.onTouchEndedListener(e)},onHurtCellsAnimation:function(e){},setBackground:function(e){cleverapps.styles.BaseBoosterView.background&&(this.bg.visible=!e,this.bgOn.visible=e)}});cleverapps.styles.BaseBoosterView={zoomScale:1.05,amount:{x:-16,y:10},price:{x:-2,y:20},bgOffset:{x:0,y:0},locked:{x:{align:"center"},y:{align:"center"}}};var CellBoosterView=BaseBoosterView.extend({ctor:function(e){this._super(e,{icon_moving_png:res.cellbooster_moving_png,icon_png:res.cellbooster_png,icon_active_png:res.cellbooster_active_png})},setAnimationZOrder:function(e){
e.setLocalZOrder(100)},onHurtCellsAnimation:function(e){var t=e[0],i=BaseCellView.alignInTheGrid(t.x,t.y),s=cc.director.getRunningScene().fieldView,n=new cleverapps.Spine(res.cellbooster_spine_json,1);this.setAnimationZOrder(n),n.setPosition(i),s.addChild(n),n.setAnimation(0,"animation",!1),n.setCompleteListener(function(){n.runAction(new cc.Sequence(new cc.RemoveSelf,new cc.CallFunc(function(){Game.currentGame&&Game.currentGame.bigExplode(this.booster.id)}.bind(this))))}.bind(this)),cleverapps.audio.playSound(bundles.game.urls.spoon_use_effect)}}),LineBoosterView=BaseBoosterView.extend({ctor:function(e){this._super(e,{icon_moving_png:res.linebooster_moving_png,icon_png:res.linebooster_png,icon_active_png:res.linebooster_active_png})},onHurtCellsAnimation:function(e){var t=cc.director.getRunningScene().fieldView,i=e[0],s=BaseCellView.alignInTheGrid(i.x,i.y),n=new cleverapps.Spine(res.linebooster_spine_json,1);n.setLocalZOrder(100),t.addChild(n);var o=cleverapps.styles.LineBoosterView
;n.setPosition(s.x,s.y+o.animation.y),n.setAnimation(0,"animation",!1),n.setTimeScale(o.timeScale.scale),n.setCompleteListener(function(){n.runAction(new cc.Sequence(new cc.RemoveSelf,new cc.CallFunc(function(){Game.currentGame&&Game.currentGame.bigExplode(this.booster.id)}.bind(this))))}.bind(this)),cleverapps.audio.playSound(bundles.game.urls.rolling_pin_use_effect)}});cleverapps.styles.LineBoosterView={animation:{y:-450},timeScale:{scale:1.4}};var ColorBoosterView=BaseBoosterView.extend({ctor:function(e){this._super(e,{icon_moving_png:res.colorbooster_moving_png,icon_png:res.colorbooster_png,icon_active_png:res.colorbooster_active_png})},getAnimationPosition:function(){return BaseCellView.alignInTheGrid(this.booster.targetCell.x,this.booster.targetCell.y)},setAnimationZOrder:function(e){e.setLocalZOrder(100)},onHurtCellsAnimation:function(){var e=this.getAnimationPosition(),t=cc.director.getRunningScene().fieldView,i=new cleverapps.Spine(res.colorbooster_spine_json,1)
;this.setAnimationZOrder(i),i.setPosition(e),t.addChild(i),i.setAnimation(0,"animation",!1),i.setCompleteListener(function(){i.runAction(new cc.Sequence(new cc.RemoveSelf,new cc.CallFunc(function(){Game.currentGame&&Game.currentGame.bigExplode(this.booster.id)}.bind(this))))}.bind(this)),cleverapps.audio.playSound(bundles.game.urls.rocket_use_effect)}}),BoostersController=function(e,i,t){this.boosters=e;var n=[];cleverapps.styles.UI.BoostersTargets=[];var o=this.boostersView=new BoostersView(e,i);i.addChild(o),cleverapps.styles.UI.BoostersViewPosition&&o.setPositionRound(cleverapps.styles.UI.BoostersViewPosition[e.amountAvailable()][cleverapps.wideMode.mode]),this.boosters.listAll().forEach(function(e,t){var i=new(e.getViewClass())(e);n[t]=i,o.addChild(i);var s=cleverapps.styles.UI.BoostersPositions[cleverapps.wideMode.mode][t];i.setPositionRound(s.x,s.y),cleverapps.styles.UI.BoostersTargets.push(i),i.onTouchBeganListener=this.onTouchBegan.bind(this,e),
i.onTouchOutListener=this.onTouchOut.bind(this,e),i.onTouchMovedListener=this.onTouchMoved.bind(this),i.onTouchEndedListener=this.onTouchEnded.bind(this)},this),this.getTouchedCell=t,this.getView=function(e){return n[e]},this.upForTutorial=function(e){i.show(!0),n[e].originalPosition=n[e].getPosition(),n[e].replaceParentSamePlace(Game.levelTutorialView);var t=n[e].getPosition();return i&&i.originalPosition&&(t.x+=i.originalPosition.x-i.getPosition().x,t.y+=i.originalPosition.y-i.getPosition().y),n[e].setPosition(t),t}.bind(this),this.backFromTutorial=function(e){n[e].replaceParent(o),n[e].setPosition(n[e].originalPosition)}.bind(this)};BoostersController.prototype.onTouchBegan=function(e){!Game.counter.isActive()&&Game.currentGame&&(this.boosters.active===e?this.boosters.setActive(void 0):cleverapps.boostersCounter.canUse(e.id)?this.boosters.setActive(e):levels.user.canTakeGold(e.prices[1])?(levels.user.takeGold(e.prices[1]),cleverapps.boostersCounter.add(e.id,1),
cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTERS_BOUGHT,{amount:1}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTERS_BOUGHT_ITEM,{id:e.id,amount:1}),cleverapps.audio.playSound(res.shop_buy_effect),this.boosters.setActive(e)):cleverapps.flags.nopayments?cleverapps.Notification.create("messages:NotEnoughCoins"):cleverapps.metha.display({focus:"ShopWindow",control:"MenuBarGoldItem",action:function(e){new ShopWindow({tab:ShopWindow.TABS.COINS}),cleverapps.metha.onceNoWindowsListener=e}}))},BoostersController.prototype.onTouchOut=function(e){!Game.counter.isActive()&&Game.currentGame&&this.boosters.active===e&&this.boosters.setActive(void 0)},BoostersController.prototype.onTouchMoved=function(e){var t=this.getTouchedCell(e);this.onTouchMovedThrottled(t)},BoostersController.prototype.onTouchMovedThrottled=cleverapps.timeredThrottle(300,function(e){this.boosters.active&&this.boosters.active.onFieldTouchMoved(e)}),BoostersController.prototype.onTouchEnded=function(e){if(
this.boosters.active){var t=this.getTouchedCell(e);t&&t.hurtable?this.boosters.active.onFieldTouchEnded(t):this.boosters.setActive(void 0)}};var BoosterAdviceView=cc.Node.extend({ctor:function(e,t){this._super(),this.fieldView=t,this.setLocalZOrder(10),e.onChangeVisibleListener=this.createListener(function(e){this.setVisible(e)}.bind(this)),e.onShowAdvice=this.createListener(this.showAdvice.bind(this))},showAdvice:function(e){if(Game.currentGame&&(!Game.levelTutorialView||!Game.levelTutorialView.tutorial||Game.levelTutorialView.tutorial.finished)){var t=Game.currentGame.boostersController.getView(e.boosterId);this.finger&&this.finger.removeFromParent(!0),this.finger=new FingerView({control:"booster_advice_finger"}),this.addChild(this.finger),this.finger.fadeIn(this.getRelativeCoordinates(t)),this.finger.press(),this.finger.delay(.3),this.finger.unPress(),this.finger.delay(.1),this.finger.press(),this.finger.delay(.3),this.finger.fadeOut(),this.finger.delay(1.6)
;var i=BaseCellView.alignInTheGrid(e.target.col,e.target.row),s=cc.director.getRunningScene().scene.convertToNodeSpace(this.fieldView.convertToWorldSpace(i));this.finger.fadeIn(s),this.finger.press(),this.finger.delay(.3),this.finger.unPress(),this.finger.delay(.1),this.finger.press(),this.finger.delay(.3),this.finger.fadeOut(),this.finger.delay(1.6),this.finger.run({looped:!0})}},setVisible:function(e){this.finger&&this.finger.setVisible(e)}}),BaseTile=function(e,t){this.x=e,this.y=t,this.alive=!0,e<0&&(this.isForGoal=!0),this.onBeforeExplodeListener=function(){},this.onAfterExplodeListener=function(){},this.onAnimationListener=function(e,t){}};BaseTile.prototype.load=function(e){},BaseTile.prototype.save=function(){throw"Not implemented"},BaseTile.prototype.bundleId=function(){return!1},BaseTile.prototype.animate=function(e,t){this.onAnimationListener(e,t)},BaseTile.prototype.hurt=function(){this.explode()},BaseTile.prototype.hurtViaBooster=function(e){},
BaseTile.prototype.getExplodeInterval=function(){return.1},BaseTile.prototype.getMyCell=function(){return Game.currentGame.field.cells[this.y][this.x]},BaseTile.prototype.explode=function(){if(this.alive){this.alive=!1;var e=this.getExplodeInterval();this.onBeforeExplodeListener(),Game.counter.setTimeout(function(){this.onAfterExplodeListener(this.x,this.y)}.bind(this),1e3*e)}},BaseTile.prototype.preCollectDuration=function(){return 0};var IceTile=function(e,t){BaseTile.call(this,e,t),this.putInPoolAvailable=!0,this.onCreateNew=function(){}};IceTile.prototype=Object.create(BaseTile.prototype),(IceTile.prototype.constructor=IceTile).CODES=["@"],IceTile.prototype.getViewClass=function(){return IceTileView},IceTile.prototype.bundleId=function(){return"ice"},IceTile.prototype.getGoalId=function(){return IceTile.GOAL_ID},IceTile.prototype.showUpDuration=function(){return.6},IceTile.prototype.getExplodeInterval=function(){return.3},IceTile.GOAL_ID="@",IceTile.prototype.save=function(){
return IceTile.CODES};var TransporterTile=function(e,t,i){BaseTile.call(this,e,t),this.direction=0,this.connected=!1,Game.currentGame.counter.fieldCounter.registerStage(200,TransporterTile.process)};TransporterTile.prototype=Object.create(BaseTile.prototype),(TransporterTile.prototype.constructor=TransporterTile).prototype.getViewClass=function(){return TransporterTileView},TransporterTile.prototype.save=function(){var e=TransporterTile.CODES;return e=e.concat([this.direction])},TransporterTile.prototype.load=function(e,t){e.shift(),this.direction=parseInt(e[0]),e.shift()},TransporterTile.prototype.bundleId=function(){return"transporter"},TransporterTile.prototype.getDestination=function(e){void 0===e&&(e=this.direction);var t=TransporterTile.directions[e];return{x:this.x+t.x,y:this.y+t.y}},TransporterTile.processBelt=function(e){for(var t=e[e.length-1].getMyCell(),i=e.length-2;0<=i;i--)e[i].process(e,i,e[i].getMyCell());e[e.length-1].process(e,e.length-1,t)},
TransporterTile.prototype.process=function(e,t,i){if(this.canMove){this.canMove=!1;var s=t===e.length-1?e[0]:e[t+1];this.onProcessListener(),i.beforeMoveByTransporter(s),1<Math.abs(i.x-s.x)||1<Math.abs(i.y-s.y)?(i.animate(BaseCell.ANIMATION_TRANSPORTER_LOOP_START),Game.counter.setTimeout(function(){i.move({x:s.x,y:s.y},{moveInterval:.5,source:this,scale:0},function(){i.animate(BaseCell.ANIMATION_TRANSPORTER_LOOP_FINISH)}.bind(this))}.bind(this),200)):i.move({x:s.x,y:s.y},{moveInterval:.5,source:this}),Game.currentGame.field.cells[s.y][s.x]=i}},TransporterTile.prepareToMove=function(){if(Game.currentGame)for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)Game.currentGame.field.floor[e][t]&&Game.currentGame.field.floor[e][t].constructor===TransporterTile&&(Game.currentGame.field.floor[e][t].canMove=!0,Game.currentGame.field.floor[e][t].connected=!1)},TransporterTile.process=function(){if(Game.currentGame){if(!TransporterTile.belts){TransporterTile.belts=[];for(
var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)if(Game.currentGame.field.floor[e][t]&&Game.currentGame.field.floor[e][t].constructor===TransporterTile){var i=Game.currentGame.field.floor[e][t];i.connected||TransporterTile.belts.push(TransporterTile.formBelt(i))}}TransporterTile.belts.forEach(function(e){TransporterTile.processBelt(e)})}},TransporterTile.prototype.getPrevDir=function(){var e=TransporterTile.getPreviousTile(this);return void 0===e?TransporterTile.getOutOfFieldDir(this):e.direction},TransporterTile.getOutOfFieldDir=function(i){var e=[TransporterTile.UP,TransporterTile.DOWN,TransporterTile.LEFT,TransporterTile.RIGHT],s={};s[TransporterTile.UP]=TransporterTile.DOWN,s[TransporterTile.DOWN]=TransporterTile.UP,s[TransporterTile.LEFT]=TransporterTile.RIGHT,s[TransporterTile.RIGHT]=TransporterTile.LEFT;var n=[];return e.forEach(function(e){var t=i.getDestination(e);Game.currentGame.field.isCellInField(t.y,t.x)||TransporterTile.checkIfBadDir(s[e],i)||n.push(s[e])}),
-1!==n.indexOf(i.direction)||0===n.length?i.direction:n[Math.floor(Math.random()*n.length)]},TransporterTile.checkIfBadDir=function(e,t){return TransporterTile.directions[e].x+TransporterTile.directions[t.direction].x===0&&TransporterTile.directions[e].y+TransporterTile.directions[t.direction].y===0},TransporterTile.getPreviousTile=function(s){var e=[TransporterTile.UP,TransporterTile.DOWN,TransporterTile.LEFT,TransporterTile.RIGHT],n=void 0;return Game.currentGame.field.floor&&e.forEach(function(e){var t=s.getDestination(e),i=Game.currentGame.field.floor[t.y]?Game.currentGame.field.floor[t.y][t.x]:void 0;i&&i.constructor===TransporterTile&&!i.connected&&i.getDestination().x===s.x&&i.getDestination().y===s.y&&(n=i)}),n},TransporterTile.getNextTile=function(s){var e=[TransporterTile.UP,TransporterTile.DOWN,TransporterTile.LEFT,TransporterTile.RIGHT],n=void 0;return Game.currentGame.field.floor&&e.forEach(function(e){var t=s.getDestination(e),
i=Game.currentGame.field.floor[t.y]?Game.currentGame.field.floor[t.y][t.x]:void 0;i&&i.constructor===TransporterTile&&!i.connected&&s.getDestination().x===i.x&&s.getDestination().y===i.y&&(n=i)}),n},TransporterTile.formBelt=function(e){for(var t=e,i=TransporterTile.getPreviousTile(e);i&&i!==e;)t=i,i=TransporterTile.getPreviousTile(i);for(var s=[],n=t;n;)s.push(n),n.connected=!0,n=TransporterTile.getNextTile(n);return s},TransporterTile.onLevelLoad=function(e){TransporterTile.belts&&(TransporterTile.belts=void 0);for(var t=0;t<e.length;t++)for(var i=0;i<e.length;i++){var s=e[t][i];s&&s.constructor===TransporterTile&&(s.onSetImage(),s.onAnimate())}},TransporterTile.prototype.onAnimate=function(){},TransporterTile.prototype.explode=function(){},TransporterTile.prototype.hurt=function(){},TransporterTile.prototype.onSetImage=function(){},TransporterTile.prototype.onProcessListener=function(){},TransporterTile.CODES=[">"],TransporterTile.UP=0,TransporterTile.RIGHT=1,TransporterTile.DOWN=2,
TransporterTile.LEFT=3,TransporterTile.directions={},TransporterTile.directions[TransporterTile.UP]={x:0,y:-1},TransporterTile.directions[TransporterTile.DOWN]={x:0,y:1},TransporterTile.directions[TransporterTile.LEFT]={x:-1,y:0},TransporterTile.directions[TransporterTile.RIGHT]={x:1,y:0};var RugTile=function(e,t){BaseTile.call(this,e,t),this.putInPoolAvailable=!0,Game.currentGame&&-1===Game.currentGame.callsOnFieldReady.indexOf(RugTile.onGameStart)&&Game.currentGame.callsOnFieldReady.push(RugTile.onGameStart),this.onCreateNew=function(){}};RugTile.prototype=Object.create(BaseTile.prototype),(RugTile.prototype.constructor=RugTile).prototype.getViewClass=function(){return RugTileView},RugTile.prototype.save=function(){return RugTile.CODES},RugTile.prototype.bundleId=function(){return"rug"},RugTile.prototype.getGoalId=function(){return RugTile.GOAL_ID},RugTile.hurtViaCombo=function(e,t){if(Game.currentGame){var i=Game.currentGame.field.floor[e.y][e.x],
s=Game.currentGame.field.floor[t.y][t.x];i&&i.constructor===RugTile&&(void 0!==s||RugTile.isDecorator(t)||RugTile.processTo({x:t.x,y:t.y}))}},RugTile.process=function(e){if(Game.currentGame&&RugTile.checkIfTriggered(e)){var t=[];e.forEach(function(e){void 0===Game.currentGame.field.floor[e.y][e.x]&&(RugTile.isDecorator(e)||t.push({x:e.x,y:e.y}))}),t.forEach(function(e){RugTile.processTo(e)})}},RugTile.checkIfTriggered=function(e){var t=!1;return e.forEach(function(e){Game.currentGame.field.floor[e.y][e.x]&&Game.currentGame.field.floor[e.y][e.x].constructor===RugTile&&(RugTile.isDecorator(e)||(t=!0))}),t},RugTile.processTo=function(e){if(Game.currentGame){var t=Game.currentGame.field.cells[e.y][e.x];if(!(t&&-1!==[MuffinGoalCell,MuffinCell].indexOf(t.constructor)&&0<t.lives)){var i=new RugTile(e.x,e.y);Game.currentGame.field.addTile(i),i.onCreateNew(),Game.counter.setTimeout(function(){bundles.rug.urls.rug_create_effect&&cleverapps.audio.playSound(bundles.rug.urls.rug_create_effect)},600
),Game.counter.goalSetTimeout(function(){Game.currentGame&&Game.currentGame.goals.typeInGoals(RugTile.GOAL_ID)&&Game.currentGame.goals.incGoal(RugTile.GOAL_ID,1)},600)}}},RugTile.onGameStart=function(){for(var e=0,t=0;t<Field.SIZE;t++)for(var i=0;i<Field.SIZE;i++)Game.currentGame.field.floor[t][i]&&Game.currentGame.field.floor[t][i].constructor===RugTile&&e++;Game.currentGame&&Game.currentGame.goals.typeInGoals(RugTile.GOAL_ID)&&Game.currentGame.goals.incGoal(RugTile.GOAL_ID,e)},RugTile.prototype.hurtViaBooster=function(e){if(this.shouldTrigger()){for(var t={0:1,1:2,2:4}[e],i=[{x:this.x-1,y:this.y},{x:this.x,y:this.y+1},{x:this.x+1,y:this.y},{x:this.x,y:this.y-1}],s=[],n=0;n<i.length&&s.length!==t;n++)this.isAllowed(i[n].x,i[n].y)&&s.push(i[n]);s.forEach(function(e){RugTile.processTo(e)})}},RugTile.prototype.shouldTrigger=function(){var e=Game.currentGame.field.cells[this.y][this.x];return!!e&&(!RugTile.isDecorator(e)&&!(void 0===e.getColor()||!e.hurtable))},
RugTile.prototype.isAllowed=function(e,t){if(!(0<=e&&0<=t&&e<Field.SIZE&&t<Field.SIZE))return!1;var i=Game.currentGame.field.cells[t][e];return void 0===Game.currentGame.field.floor[t][e]&&i&&!RugTile.isDecorator(i)},RugTile.isDecorator=function(e){return e&&e.innerCell||-1!==[CrabMakerCell,DirtMakerCell].indexOf(e.constructor)},RugTile.prototype.explode=function(){},RugTile.CODES=["|"],RugTile.GOAL_ID="|";var RabbitTile=function(e,t){BaseTile.call(this,e,t),this.isForGoal=void 0===e,this.isForEditor=e<0,this.lives=2,this.onHurtListener=function(){}};RabbitTile.prototype=Object.create(BaseTile.prototype),(RabbitTile.prototype.constructor=RabbitTile).CODES=["T"],RabbitTile.prototype.getViewClass=function(){return RabbitTileView},RabbitTile.prototype.bundleId=function(){return"rabbit"},RabbitTile.prototype.getGoalId=function(){return RabbitTile.GOAL_ID},RabbitTile.GOAL_ID="rabbit",RabbitTile.prototype.save=function(){var e=RabbitTile.CODES;return this.isRoot&&(e=e.concat([""+this.size]))
,1<this.lives&&(e=e.concat(["l",""+this.lives])),e},RabbitTile.prototype.load=function(e){var t=e.indexOf("l");-1!==t?(this.lives=parseInt(e[t+1]),e=e.slice(0,t)):this.lives=1,1<e.length&&(this.isRoot=!0,this.size=parseInt(e[1]),Game.currentGame&&Game.currentGame.callsOnFieldReady.push(function(){this.children().forEach(function(e){e.root=this}.bind(this))}.bind(this)))},RabbitTile.prototype.hurt=function(){this.alive&&(this.lives--,this.lives<1&&(this.alive=!1),this.onHurtListener(),this.root?this.root.checkAlive():this.alive||this.explode())},RabbitTile.prototype.checkAlive=function(){this.children().some(function(e){return e.alive})||(this.children().forEach(function(e){e.explode()}),Game.counter.goalSetTimeout(function(){},700))},RabbitTile.prototype.children=function(){for(var e=[],t=this.x;t<this.x+this.size;++t)for(var i=this.y;i<this.y+this.size;++i)e.push(Game.currentGame.field.floor[i][t]);return e},RabbitTile.prototype.explode=function(){var e=this.getExplodeInterval()
;this.onBeforeExplodeListener(),Game.counter.setTimeout(function(){this.onAfterExplodeListener(this.x,this.y)}.bind(this),1e3*e)};var DirtyHoneyTile=function(e,t){BaseTile.call(this,e,t),this.lives=1,this.putInPoolAvailable=!0,Game.currentGame&&Game.currentGame.callsOnFieldReady.indexOf(DirtyHoneyTile.onGameStart)<0&&Game.currentGame.callsOnFieldReady.push(DirtyHoneyTile.onGameStart),Game.currentGame.counter.fieldCounter.registerStage(211,DirtyHoneyTile.process),this.onCreateNew=function(){}};DirtyHoneyTile.prototype=Object.create(BaseTile.prototype),(DirtyHoneyTile.prototype.constructor=DirtyHoneyTile).prototype.getViewClass=function(){return DirtyHoneyTileView},DirtyHoneyTile.prototype.save=function(){return DirtyHoneyTile.CODES},DirtyHoneyTile.prototype.getGoalId=function(){return DirtyHoneyTile.GOAL_ID},DirtyHoneyTile.onGameStart=function(){DirtyHoneyTile.createdAmount=0},DirtyHoneyTile.prototype.explode=function(){BaseTile.prototype.explode.call(this),Game.counter.goalSetTimeout(
function(){Game.currentGame&&Game.currentGame.goals.typeInGoals(DirtyHoneyTile.GOAL_ID)&&(0<DirtyHoneyTile.createdAmount?(DirtyHoneyTile.createdAmount--,Game.currentGame.goals.incGoal(DirtyHoneyTile.GOAL_ID,1,!0)):Game.currentGame.goals.incGoal(DirtyHoneyTile.GOAL_ID,1))},0),Game.currentGame.dirtyHoneyTileCanProcess=!1},DirtyHoneyTile.prototype.showUpDuration=function(){return.6},DirtyHoneyTile.prototype.getExplodeInterval=function(){return.6},DirtyHoneyTile.canProcessTo=function(e,t){if(Game.currentGame.field.isCellInField(e,t)){var i=Game.currentGame.field.cells[e][t],s=Game.currentGame.field.floor[e][t];return void 0!==i.getColor()&&void 0===s}return!1},DirtyHoneyTile.isDirtyHoneyTile=function(e,t){return!!Game.currentGame.field.isCellInField(e,t)&&(Game.currentGame.field.floor[e][t]&&Game.currentGame.field.floor[e][t].constructor===DirtyHoneyTile)},DirtyHoneyTile.canBlock=function(e,t){if(Game.currentGame.field.isCellInField(e,t)){var i=Game.currentGame.field.cells[e][t];return!(
i instanceof BigCell||i instanceof DecoratorCell)&&void 0!==i.getColor()}return!1},DirtyHoneyTile.processTo=function(e){var t=new DirtyHoneyTile(e.x,e.y);Game.currentGame.field.addTile(t),t.onCreateNew(),Game.counter.setTimeout(function(){},1e3*t.showUpDuration()),DirtyHoneyTile.createdAmount++,Game.counter.goalSetTimeout(function(){Game.currentGame&&Game.currentGame.goals.typeInGoals(DirtyHoneyTile.GOAL_ID)&&Game.currentGame.goals.incTarget(DirtyHoneyTile.GOAL_ID,1,!0)},1e3*t.showUpDuration())},DirtyHoneyTile.block=function(e){var t=new DirtyHoneyDecoratorCell(e.x,e.y);t.setInnerCell(e),Game.currentGame.field.addCell(t),t.onCreateNew(),Game.counter.setTimeout(function(){},1e3*t.showUpDuration())},DirtyHoneyTile.canSpread=function(e,t,i,s){return DirtyHoneyTile.isDirtyHoneyTile(e,t)&&!0===Game.currentGame.field.barriers.canMove(e,t,i,s)},DirtyHoneyTile.process=function(){if(Game.currentGame&&Game.currentGame.dirtyHoneyTileCanProcess){var e,t,i=[],s=[];for(e=0;e<Field.SIZE;e++)for(
t=0;t<Field.SIZE;t++)DirtyHoneyTile.isDirtyHoneyTile(e,t)&&DirtyHoneyTile.canBlock(e,t)&&s.push(Game.currentGame.field.cells[e][t]),DirtyHoneyTile.canProcessTo(e,t)&&(DirtyHoneyTile.canSpread(e-1,t,e,t)||DirtyHoneyTile.canSpread(e+1,t,e,t)||DirtyHoneyTile.canSpread(e,t-1,e,t)||DirtyHoneyTile.canSpread(e,t+1,e,t))&&i.push(Game.currentGame.field.cells[e][t]);DirtyHoneyTile.chooseActions(i,s,2)}},DirtyHoneyTile.chooseActions=function(e,t,i){for(var s=0;s<i;s++){var n=[];if(0<e.length&&n.push(DirtyHoneyTile.PROCESS_TYPES.TILE),0<t.length&&n.push(DirtyHoneyTile.PROCESS_TYPES.DECORATOR),0===n.length)break;var o=cleverapps.Random.choose(n);if(Game.currentGame.dirtyHoneyTileCanProcess=!1,o===DirtyHoneyTile.PROCESS_TYPES.TILE){var a=cleverapps.Random.random(e.length);DirtyHoneyTile.processTo(e[a]),e.splice(a,1)}if(o===DirtyHoneyTile.PROCESS_TYPES.DECORATOR){a=cleverapps.Random.random(t.length);DirtyHoneyTile.block(t[a]),t.splice(a,1)}}},DirtyHoneyTile.PROCESS_TYPES={TILE:0,DECORATOR:1},
DirtyHoneyTile.CODES=["z"],DirtyHoneyTile.GOAL_ID="dirty_honey";var IceBlockMakerTile=function(e,t){BaseTile.call(this,e,t),this.movable=!1,Game.currentGame&&Game.currentGame.callsOnFieldReady.indexOf(IceBlockMakerTile.process)<0&&(Game.currentGame.iceBlockMakerTileCanProcess=!0,Game.currentGame.callsOnFieldReady.push(IceBlockMakerTile.process)),this.onCellFreezed=function(){},Game.currentGame.counter.fieldCounter.registerStage(214,IceBlockMakerTile.process)};IceBlockMakerTile.prototype=Object.create(BaseTile.prototype),(IceBlockMakerTile.prototype.constructor=IceBlockMakerTile).prototype.getViewClass=function(){return IceBlockMakerTileView},IceBlockMakerTile.prototype.hurt=function(){},IceBlockMakerTile.process=function(){if(Game.currentGame.iceBlockMakerTileCanProcess){Game.currentGame.iceBlockMakerTileCanProcess=!1;for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var i=Game.currentGame.field.floor[e][t];i&&i instanceof IceBlockMakerTile&&i.process()}}},
IceBlockMakerTile.prototype.process=function(){var e=Game.currentGame.field.cells[this.y][this.x];e&&this.isFreezable(e)?(e===this.currCell?this.setCurrentMoves(this.currMoves+1):this.setCurrent(e),2===this.currMoves&&(this.currCell instanceof IceBlockDecoratorCell?this.updateFreeze():this.freezeCell())):this.setCurrent()},IceBlockMakerTile.prototype.setCurrentMoves=function(e){1!==this.currMoves&&2!==this.currMoves||0!==e||this.onStateChanged(!1),0===this.currMoves&&1===e&&this.onStateChanged(!0),this.currMoves=e},IceBlockMakerTile.prototype.freezeCell=function(){var e=new IceBlockDecoratorCell(this.x,this.y);e.setInnerCell(this.currCell),e.lives=1,Game.currentGame.field.addCell(e),this.setCurrent(e),this.onCellFreezed(),Game.counter.setTimeout(function(){},1e3)},IceBlockMakerTile.prototype.updateFreeze=function(){this.currCell.lives=2,this.currCell.onUpdate(),this.setCurrent()},IceBlockMakerTile.prototype.setCurrent=function(e){e?this.currCell=e:delete this.currCell,
this.setCurrentMoves(0)},IceBlockMakerTile.prototype.isFreezable=function(e){return(!(e instanceof DecoratorCell)||e instanceof IceBlockDecoratorCell&&1===e.lives)&&void 0!==e.getColor()},IceBlockMakerTile.prototype.bundleId=function(){return["ice_block_maker","ice_block"]},IceBlockMakerTile.prototype.save=function(){return IceBlockMakerTile.CODES},IceBlockMakerTile.MOVES_TO_FREEZE=2,IceBlockMakerTile.CODES=["h"];var SyrupTile=function(e,t){BaseTile.call(this,e,t),this.isForGoal=void 0===e,this.isForEditor=-1===e,this.putInPoolAvailable=!0,this.onCreateNew=function(){},this.onRemoveSurface=function(){},this.onAddSurface=function(){}};SyrupTile.prototype=Object.create(BaseTile.prototype),(SyrupTile.prototype.constructor=SyrupTile).prototype.getViewClass=function(){return SyrupTileView},SyrupTile.prototype.hurt=function(){},SyrupTile.prototype.explode=function(){},SyrupTile.prototype.removeSurface=function(){this.onRemoveSurface()},SyrupTile.prototype.addSurface=function(){
this.onAddSurface()},SyrupTile.isSeparator=function(e,t){var i=Game.currentGame.field.floor[t][e],s=Game.currentGame.field.cells[t][e];return null===i||s&&s instanceof WallCell},SyrupTile.iterateLine=function(e,s){var n=Game.currentGame.field,t=e.x,i=e.y,o=function(e,t,i){for(;n.isWithinBounds(t,e)&&!SyrupTile.isSeparator(e,t);)s(e,t),SyrupTile.isVertical()?e+=i:t+=i}.bind(this);o(t,i,1),SyrupTile.isVertical()?t--:i--,o(t,i,-1)},SyrupTile.createLine=function(e){var i=Game.currentGame.field,s=i.floor,n=0,o=BaseCell.DIRECTIONS[SyrupTile.dir];SyrupTile.iterateLine(e,function(e,t){s[t][e]||(SyrupTile.createNew(e,t),n++),i.isWithinBounds(t-o.y,e-o.x)&&s[t-o.y][e-o.x]&&s[t-o.y][e-o.x]instanceof SyrupTile&&s[t-o.y][e-o.x].removeSurface()}),Game.counter.goalSetTimeout(function(){Game.currentGame&&Game.currentGame.goals.typeInGoals(SyrupTile.GOAL_ID)&&0<n&&Game.currentGame.goals.incGoal(SyrupTile.GOAL_ID,n)},600)},SyrupTile.isVertical=function(){
return SyrupTile.dir===BaseCell.UP||SyrupTile.dir===BaseCell.DOWN},SyrupTile.createNew=function(e,t){var i=BaseCell.DIRECTIONS[SyrupTile.dir],s=Game.currentGame.field,n=s.floor,o=new SyrupTile(e,t);s.isWithinBounds(t+i.y,e+i.x)&&n[t+i.y][e+i.x]&&n[t+i.y][e+i.x]instanceof SyrupTile&&(o.isNewWithin=!0),s.addTile(o),o.onCreateNew(),Game.counter.setTimeout(function(){},1e3*o.showUpDuration())},SyrupTile.enableProcess=function(){Game.currentGame.syrupTileCanProcess=!0},SyrupTile.process=function(e){if(void 0!==SyrupTile.dir&&Game.currentGame.syrupTileCanProcess){for(var n=Game.currentGame.field.floor,t=[],i=0;i<e.length-1;i++)for(var s=i+1;s<e.length;s++){var o=BaseCell.DIRECTIONS[SyrupTile.dir],a=function(e,t){var i=n[e.y][e.x],s=n[t.y][t.x];return i instanceof SyrupTile&&!s&&e.x+o.x===t.x&&e.y+o.y===t.y};a(e[i],e[s])?t.push(e[s]):a(e[s],e[i])&&t.push(e[i])}t.forEach(function(e){SyrupTile.createLine(e)}),0<t.length&&(Game.currentGame.syrupTileCanProcess=!1)}},
SyrupTile.onLevelLoad=function(){if(void 0!==SyrupTile.dir){var e=Game.currentGame.field,t=e.floor,i=0,s=BaseCell.DIRECTIONS[SyrupTile.dir];if(SyrupTile.isVertical())for(var n=0;n<Field.SIZE;n++)for(var o=SyrupTile.dir===BaseCell.UP?0:Field.SIZE-1,a=!1;e.isWithinBounds(o,n);o-=s.y)t[o][n]&&t[o][n]instanceof SyrupTile&&(a||(t[o][n].addSurface(),a=!0),i++);else for(o=0;o<Field.SIZE;o++)for(n=SyrupTile.dir===BaseCell.LEFT?0:Field.SIZE-1,a=!1;e.isWithinBounds(o,n);n-=s.x)t[o][n]&&t[o][n]instanceof SyrupTile&&(a||(t[o][n].addSurface(),a=!0),i++);Game.currentGame&&Game.currentGame.goals.typeInGoals(SyrupTile.GOAL_ID)&&Game.currentGame.goals.incGoal(SyrupTile.GOAL_ID,i)}},SyrupTile.prototype.showUpDuration=function(){return.3},SyrupTile.prototype.load=function(e){this.dir=SyrupTile.dir=parseInt(e[1])},SyrupTile.prototype.save=function(){return SyrupTile.CODES.concat([SyrupTile.dir])},SyrupTile.prototype.bundleId=function(){return"syrup"},SyrupTile.prototype.getGoalId=function(){
return SyrupTile.GOAL_ID},SyrupTile.CODES=[""],SyrupTile.GOAL_ID="syrup";var BaseTileView={initialize:function(e){this.tile=e,this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setLocalZOrder(2),this.setPosition(BaseCellView.alignInTheGrid(e.x,e.y)),BaseTileViewBeforeShowUpAnimation.call(this),e.onBeforeExplodeListener=this.startExploding.bind(this),e.onChangeParent=this.replaceParent.bind(this),e.onAnimationListener=this.showAnimation.bind(this)},delete:function(){this.tile&&this.tile.putInPoolAvailable?cc.pool.putInPool(this):this.removeFromParent()},startExploding:function(e){this.stopAllActions(),this.runAction(new cc.Sequence(new cc.Spawn(new cc.RotateBy(e,720),new cc.ScaleTo(e,0)),new cc.CallFunc(function(){this.delete()},this)))}};BaseTileViewBeforeShowUpAnimation=function(){Game.currentGame.started||this.setScale(0)},BaseTileViewShowUpAnimation=function(e){this.runAction(new cc.Sequence(new cc.DelayTime(.25+.4*(
1.2*this.tile.y+this.tile.x)/Field.SIZE),new cc.ScaleTo(.6,1).easing(cc.easeBackOut()),new cc.CallFunc(function(){e&&e.callback&&e.callback()})))},BaseTileView.showUp=function(e){BaseTileViewShowUpAnimation.call(this,e)},BaseTileView.showHide=function(){this.runAction(new cc.Sequence(new cc.DelayTime(.25+.4*(1.2*(Field.SIZE-1-this.tile.y)+(Field.SIZE-1-this.tile.x))/Field.SIZE),new cc.ScaleTo(.3,0).easing(cc.easeIn(1))))},BaseTileView.showAnimation=function(e){switch(e){case BaseCell.ANIMATION_SHOWUP:this.showUp();break;case BaseCell.ANIMATION_SHOWHIDE:this.showHide()}},BaseTileView.reuse=function(e){this.initialize(e)},BaseTileView.unuse=function(){this.removeFromParent(),this.tile.onBeforeExplodeListener=function(){},this.tile.onChangeParent=function(){},this.tile.onAnimationListener=function(){},delete this.tile};var IceTileView=cc.Node.extend(cleverapps.extend({},BaseTileView,{ctor:function(e){this._super(),this.setAnchorPoint(.5,.5),this.initialize(e),e.x<0?(
this.image=new cc.Sprite(res.ice_goal),this.image.setScaleX(cleverapps.styles.IceTileView.goal.scaleX)):(this.image=new cc.Sprite(res.ice_tile),this.setLocalZOrder(3)),this.image.setPosition(this.width/2,this.height/2),this.addChild(this.image),this.tile.onCreateNew=this.animateCreateNew.bind(this)},initialize:function(e){this.image&&this.image.setScale(1),BaseTileView.initialize.call(this,e)},startExploding:function(){if(this.stopAllActions(),Game.currentGame.goals.inGoals(this.tile)){var i=cc.director.getRunningScene().fieldView,e=BaseAnimation.factoryLimited(bundles.ice.jsons.ice_spine_json),s=this.getPosition(),n=this.tile;e.setPosition(s),i.addChild(e),Game.counter.goalSetTimeout(function(){}.bind(this),700);var o=0;IceTileView.lastExplodeTime>Date.now()-100?o=IceTileView.groupSize:(IceTileView.groupSize=0,IceTileView.lastExplodeTime=Date.now()),IceTileView.groupSize++;var a=IceTileView.groupSize,t=cleverapps.styles.IceTileView
;t.collectAnimation&&this.onCollectAnimation&&this.onCollectAnimation(n,o,a),this.runAsync(function(){this.delete()}.bind(this)),e.runAnimate("two",t.collectAnimation?void 0:function(){if(Game.currentGame){var e=Game.currentGame.goals.check(n,o,a),t=new cc.Sprite(res.ice_goal);t.setLocalZOrder(5),t.setPosition(s.x+cleverapps.styles.IceTileView.potMargin.x,s.y+cleverapps.styles.IceTileView.potMargin.y),i.addChild(t),Game.currentGame.goalsController.getViewByType(e.type).collect(t,e,o,function(){t.isRunningSafe()&&t.removeFromParent()})}},new cc.Sequence(new cc.CallFunc(function(e){e.setScale(.1)}),new cc.Spawn(new cc.MoveBy(.3,cleverapps.styles.IceTileView.potMargin.x,cleverapps.styles.IceTileView.potMargin.y),new cc.ScaleTo(.5,1).easing(cc.easeBackOut()))))}else this.image.runAction(new cc.Sequence(new cc.ScaleTo(.3,0).easing(cc.easeBackIn()),new cc.CallFunc(function(){this.runAsync(function(){this.delete()}.bind(this))}.bind(this))))},animateCreateNew:function(){this.image.setScale(0)
,this.image.runAction(new cc.Sequence(new cc.ScaleTo(.1,.25).easing(cc.easeBackOut()),new cc.ScaleTo(.1,.15).easing(cc.easeBackOut()),new cc.ScaleTo(.3,1.05).easing(cc.easeBackOut()),new cc.ScaleTo(.1,1).easing(cc.easeBackOut())))}}));IceTileView.lastExplodeTime=0,IceTileView.groupSize=0,cleverapps.styles.IceTileView={potMargin:{x:-53,y:-32},goal:{scaleX:-1}};var RabbitTileView=cc.Node.extend(cleverapps.extend({},BaseTileView,{ctor:function(e){if(this._super(),this.setAnchorPoint(.5,.5),this.initialize(e),this.setLocalZOrder(3),e.isForGoal)this.image=new cc.Sprite(bundles.rabbit.frames.rabbit_goal),this.image.setPosition(this.width/2,this.height/2),this.addChild(this.image);else if(e.isForEditor)e.size?this.image=new cc.Sprite(bundles.editor.frames["rabbitTile"+e.size+"_"+e.lives]):1<e.lives?this.image=new cc.Sprite(bundles.editor.frames["rabbitTileCover_"+e.lives]):this.image=new cc.Sprite(bundles.rabbit.frames.rabbit_tile_cover),this.image.setPosition(this.width/2,this.height/2),
this.addChild(this.image);else if(e.isRoot&&(this.image=new cc.Sprite(bundles.rabbit.frames["rabbit_tile_"+e.size]),this.addChild(this.image),this.image.setPositionRound({align:"left"},{align:"top"}),this.image.setVisible(!1)),this.cover=this.createImage(e),this.cover.setPosition(this.width/2,this.height/2),this.addChild(this.cover),"editor"===cleverapps.environment.scene){this.cover.setOpacity(150);var t=cleverapps.UI.generateTTFText(""+e.lives,cleverapps.styles.FONTS.EDITOR_RED_TEXT);this.addChild(t),t.setPositionRound({align:"left"},{align:"top"})}},initialize:function(e){BaseTileView.initialize.call(this,e),e.onHurtListener=this.hurtAnimation.bind(this)},createImage:function(e){var t=new cc.Sprite(bundles.rabbit.frames.rabbit_tile_cover);return 1===e.lives&&t.setOpacity(150),t},hurtAnimation:function(){this.coverAnimation=BaseAnimation.factoryLimited(bundles.rabbit.jsons.wrapper_spine1_json),this.coverAnimation.setPosition(this.width/2,this.height/2),this.addChild(
this.coverAnimation),this.tile.lives<1?this.coverAnimation.runAnimate("animation",this.cover):(this.coverAnimation.runAnimate("animation"),this.runAsync(function(){this.cover.setOpacity(150)}.bind(this))),cleverapps.audio.playSound(bundles.game.urls.nut_effect)},startExploding:function(){if(this.tile.isRoot){this.stopAllActions();var i=cc.director.getRunningScene().fieldView,s=this.getPosition();2===this.tile.size&&(s.x+=cleverapps.styles.BaseCellView.CELL_SIZE_PX/2,s.y-=cleverapps.styles.BaseCellView.CELL_SIZE_PX/2);var n=this.tile;Game.currentGame&&this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){if(Game.currentGame){var e=Game.currentGame.goals.check(n),t=new cc.Sprite(bundles.rabbit.frames["rabbit_tile_"+n.size]);t.setLocalZOrder(5),t.setPosition(s.x,s.y),i.addChild(t),t.tileSize=n.size,Game.currentGame.goalsController.getViewByType(e.type).collect(t,e,0,function(){t.isRunningSafe()&&t.removeFromParent()})}
this.coverAnimation&&this.coverAnimation.finishAnimation()}.bind(this)),new cc.RemoveSelf))}},showUp:function(){var e={};this.image&&(e.callback=function(){this.image.visible=!0}.bind(this)),BaseTileView.showUp.call(this,e)}}));cleverapps.styles.RabbitTileView={};var TransporterTileView=cc.Node.extend(cleverapps.extend({},BaseTileView,{ctor:function(e){this._super(),this.setAnchorPoint(.5,.5),this.initialize(e),this.setAnimation(),this.setImage(),this.tile.onSetImage=this.setImage.bind(this),this.tile.onAnimate=this.animate.bind(this),this.tile.onProcessListener=this.animateProcess.bind(this)},getEditorSprite:function(){var e=new cc.Sprite(bundles.editor.frames.transporterTile);switch(this.tile.direction){case TransporterTile.UP:e.setRotation(-90);break;case TransporterTile.DOWN:e.setRotation(90);break;case TransporterTile.LEFT:e.setRotation(180);break;case TransporterTile.RIGHT:}return e},getFieldSprite:function(){var e=this.tile.getPrevDir();if(this.tile.direction===e){return(
t=new cc.Sprite(bundles.transporter.frames.transporter_straight_tile)).setRotation([-90,0,90,180][this.tile.direction]),t}var t,i=this.getTransform();return(t=new cc.Sprite(bundles.transporter.frames.transporter_corner_tile)).setRotation(i.angle?i.angle:0),t.setScale(i.scaleX,i.scaleY),t},getTransform:function(){var e=TransporterTileView.CODES[this.tile.getPrevDir()]+TransporterTileView.CODES[this.tile.direction];return TransporterTileView.TRANSFORMS[e]},animateProcess:function(){if(this.animation&&cleverapps.styles.TransporterTileView.animateOnProcess){var e=this.tile.getPrevDir()===this.tile.direction?"straight":"corner";if(this.animation.setAnimation(0,e,!1),this.animation.setVisible(!0),this.image.setVisible(!1),this.animation.setCompleteListener(function(){this.animation.setVisible(!1),this.image.setVisible(!0)}.bind(this)),this.tile.getPrevDir()!==this.tile.direction){var t=this.getTransform();this.animation.setRotation(t.angle?t.angle:0),this.animation.setScale(t.scaleX,t.scaleY
)}this.animationDir(),cleverapps.audio.playSound(bundles.transporter.urls.transporter_effect)}},animationDir:function(){if(!cleverapps.styles.TransporterTileView.animateOnProcess||this.tile.getPrevDir()===this.tile.direction){var e=TransporterTileView.CODES[this.tile.direction];this.animation.setRotation({L:0,R:180,D:-90,U:90}[e])}},setImage:function(){var e="editor"===cleverapps.environment.scene?this.getEditorSprite():this.getFieldSprite();e.setPosition(this.width/2,this.height/2),void 0!==this.image&&this.image.removeFromParent(),this.image=e,this.addChild(e)},setAnimation:function(){cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&(this.animation=new cleverapps.Spine(bundles.transporter.jsons.transporter_json,1),this.animation.setPosition(this.width/2,this.height/2),this.animation.setLocalZOrder(10),this.animationDir(),this.addChild(this.animation))},animate:function(){
this.animation&&!cleverapps.styles.TransporterTileView.animateOnProcess&&this.animation.setAnimation(0,"idle",!0)}}));TransporterTileView.CODES=["U","R","D","L"],TransporterTileView.TRANSFORMS={UR:{scaleX:1,scaleY:1},UL:{scaleX:-1,scaleY:1},DR:{scaleX:1,scaleY:-1},DL:{scaleX:-1,scaleY:-1},RU:{scaleX:-1,scaleY:-1},RD:{scaleX:-1,scaleY:1},LU:{scaleX:1,scaleY:-1},LD:{scaleX:1,scaleY:1}},cleverapps.styles.TransporterTileView={animateOnProcess:!1};var RugTileView=cc.Node.extend(cleverapps.extend({},BaseTileView,{ctor:function(e){this._super(),this.setAnchorPoint(.5,.5),this.initialize(e),this.setImage(),this.setLocalZOrder(4),this.tile.onCreateNew=this.animateCreateNew.bind(this)},setImage:function(){var e=this.tile.x<0?"rug_goal":"rug_tile",t=new cc.Sprite(bundles.rug.frames[e]);t.setPosition(this.width/2,this.height/2),this.image=t,this.addChild(t)},animateCreateNew:function(){this.image.setScale(0),this.image.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.ScaleTo(.1,.25).easing(
cc.easeBackOut()),new cc.ScaleTo(.1,.15).easing(cc.easeBackOut()),new cc.ScaleTo(.3,1.05).easing(cc.easeBackOut()),new cc.ScaleTo(.1,1).easing(cc.easeBackOut())))}})),DirtyHoneyTileView=cc.Node.extend(cleverapps.extend({},BaseTileView,{ctor:function(e){this._super(),this.setAnchorPoint2(),this.initialize(e);var t=this.image=new cc.Sprite(res.dirty_honey_tile);this.addChild(t),t.setPositionRound(this.width/2,this.height/2),e.x<0&&t.setScale(.8)},initialize:function(e){BaseTileView.initialize.call(this,e),this.tile.onCreateNew=this.animateCreateNew.bind(this)},animateCreateNew:function(){this.setScale(1),this.image.visible=!1,BaseAnimation.runAnimate(this,res.dirty_honey_json,"under_on",function(){this.image.visible=!0}.bind(this),this.image),cleverapps.audio.playSound(cleverapps.styles.DirtyHoneyTileView.growUpSound)},startExploding:function(){this.stopAllActions(),BaseAnimation.runAnimate(this,res.dirty_honey_json,"under_off",this.image),cleverapps.audio.playSound(
cleverapps.styles.DirtyHoneyTileView.dieSound)}}));cleverapps.styles.DirtyHoneyTileView={growUpSound:res.dirty_honey_create_effect,dieSound:res.special_element_die};var IceBlockMakerTileView=cc.Node.extend(cleverapps.extend({},BaseTileView,{ctor:function(e){this._super(e),this.setAnchorPoint2(),this.initialize(e);var t=this.animation=new cleverapps.Spine(bundles.ice_block_maker.jsons.ice_block_maker_json,1);this.addChild(t),t.setPositionRound(this.width/2,this.height/2),t.setAnimation(0,"idle_2",!0),e.onStateChanged=this.changeState.bind(this),e.onCellFreezed=this.onCellFreezed.bind(this)},changeState:function(e){var t=e?"idle_1":"idle_2",i=e?"transition_1":"transition_2";this.animation.setCompleteListener(function(){this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,t,!0)}.bind(this)),this.animation.setAnimation(0,i,!1)},onCellFreezed:function(){cleverapps.audio.playSound(cleverapps.styles.IceBlockMakerTileView.growUpSound)}}))
;cleverapps.styles.IceBlockMakerTileView={growUpSound:res.special_element_grow_up};var SyrupTileView=cc.Node.extend(cleverapps.extend({},BaseTileView,{ctor:function(e){this._super(),this.setAnchorPoint(.5,.5),this.initialize(e),this.createAnimation(),e.isForEditor&&this.addEditorText()},initialize:function(e){BaseTileView.initialize.call(this,e),this.setLocalZOrder(0),e.onCreateNew=this.createNew.bind(this),e.onRemoveSurface=this.removeSurface.bind(this),e.onAddSurface=this.addSurface.bind(this)},addEditorText:function(){var e;SyrupTile.dir===BaseCell.UP&&(e="up"),SyrupTile.dir===BaseCell.DOWN&&(e="down"),SyrupTile.dir===BaseCell.LEFT&&(e="left"),SyrupTile.dir===BaseCell.RIGHT&&(e="right"),e=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.WHITE_TEXT),this.addChild(e),e.setPositionRound(this.width/2,this.height/2)},createAnimation:function(){var e=this.tile.isForGoal?bundles.syrup.jsons.syrup_goal_json:bundles.syrup.jsons.syrup_json;this.animation=new cleverapps.Spine(e),
this.animation.setAnimation(0,"idle",!0),this.addChild(this.animation),this.animation.setPositionRound(this.width/2,this.height/2)},getStyles:function(){return cleverapps.styles.SyrupTileView},createNew:function(){this.animation.setAnimation(0,"transition_"+SyrupTile.dir,!1),this.tile.isNewWithin?this.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.CallFunc(function(){this.animation.setAnimation(0,"idle",!0),this.animation.setCompleteListener(function(){})}.bind(this)))):this.animation.setCompleteListener(function(){this.animation.setAnimation(0,"idle_"+SyrupTile.dir,!0),this.animation.setCompleteListener(function(){})}.bind(this))},removeSurface:function(){this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,"idle",!0)},addSurface:function(){this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,"idle_"+SyrupTile.dir,!0)}}));cleverapps.styles.SyrupTileView={surface:{dist:50}};var BaseCell=function(e,t){this.x=e,this.y=t,
this.movable=!1,this.hurtable=!0,this.lives=1,this.alive=!0,this.explodeOnGameFinish=!1,this.moving=0,this.isHovered=!1,this.didFall=!1,this.willFall=!1,this.depth=0,this.onDepthChanged=function(){},this.visible=!0,this.onVisibleChanged=function(){},e<0&&(this.isForGoal=!0),this.onDebugListener=function(){},this.onAnimationListener=function(e,t){},this.onHoverListener=function(e){},this.onBeforeMoveListener=function(){},this.onFinishMoveListener=function(){},this.onWrongMoveListener=function(e,t){},this.onBeforeExplodeListener=function(){},this.onAfterExplodeListener=function(){},this.onChangeLivesListener=function(){},this.onDeleteListener=function(){},this.onChangeParent=function(){},this.onAppear=function(){},this.onFinishAppear=function(){},this.onAvailableMoveListener=function(e){},this.onGameFinishListener=function(){}};BaseCell.prototype.setInnerCell=function(e){this.innerCell&&(this.innerCell.parentCell=void 0,this.innerCell.setDepth(0)),(this.innerCell=e)&&(e.parentCell=this,
e.setDepth(this.depth+1),e.changeVisible(this.visible&&!this.hideInnerCell))},BaseCell.prototype.setDepth=function(e){this.depth=e,this.onDepthChanged(),this.innerCell&&this.innerCell.setDepth(this.depth+1)},BaseCell.prototype.onGameFinish=function(){this.onGameFinishListener(),this.explodeOnGameFinish&&this.hurt()},BaseCell.prototype.changeParent=function(e){this.onChangeParent(e),this.innerCell&&this.innerCell.changeParent(e)},BaseCell.prototype.changeVisible=function(e){this.innerCell&&this.innerCell.changeVisible(e&&!this.hideInnerCell),this.visible=e,this.onVisibleChanged(e)},BaseCell.prototype.getLives=function(){return this.lives},BaseCell.prototype.onBeforeHurtViaBooster=function(){},BaseCell.prototype.editorComponents=function(){return[BaseCellComponent]},BaseCell.prototype.canRepaint=function(){return!1},BaseCell.prototype.canDelete=function(){return!1},BaseCell.prototype.repaint=function(){return this},BaseCell.prototype.totalLives=function(){var e;return Game.currentGame&&(
e=Game.currentGame.field.floor[this.y][this.x]),this.getLives()+(this.innerCell?this.innerCell.getLives():0)+(e&&e.lives?e.lives:0)},BaseCell.prototype.hover=function(e){this.isHovered!==e&&(this.isHovered=e,this.onHoverListener(e))},BaseCell.prototype.animate=function(e,t){this.onAnimationListener(e,t)},BaseCell.prototype.load=function(e){throw"Not implemented"},BaseCell.prototype.save=function(){throw"Not implemented"},BaseCell.prototype.actionAfterRunStages=function(){},BaseCell.prototype.getPosition=function(){return{y:this.y,x:this.x}},BaseCell.prototype.willEndFall=function(){this.didFall&&(this.didFall=!1,this.animate(BaseCell.ANIMATION_DOWN))},BaseCell.prototype.onBurnStage=function(){this.willBurn=!1},BaseCell.prototype.move=function(e,t,i){var s;s=(t=t||{}).moveInterval?t.moveInterval:.1*(Math.abs(e.y-this.y)+Math.abs(e.x-this.x)),t.moveInterval=s,t.delay?Game.counter.setTimeout(function(){this.onBeforeMoveListener(e,t)}.bind(this),1e3*t.delay):(t.delay=0,
this.onBeforeMoveListener(e,t)),this.moving++,Game.counter.setTimeout(function(){this.onFinishMoveListener(e,t,i),t.squeeze&&(e.y<this.y?this.animate(BaseCell.ANIMATION_DOWN):e.y>this.y?this.animate(BaseCell.ANIMATION_UP):e.x>this.x?this.animate(BaseCell.ANIMATION_RIGHT):this.animate(BaseCell.ANIMATION_LEFT)),this.x=e.x,this.y=e.y,this.moving--,this.afterMove(e,t)}.bind(this),1e3*(t.moveInterval+t.delay))},BaseCell.prototype.afterMove=function(e,t){t&&t.callback&&"function"==typeof t.callback&&t.callback()},BaseCell.prototype.hurt=function(e){this.lives<1||!this.alive||!this.hurtable||(this.lives--,this.onChangeLivesListener(),this.animate(BaseCell.ANIMATION_HURT),Game.counter.setTimeout(function(){this.lives<=0&&this.explode(e)}.bind(this),1e3*this.hurtDuration()))},BaseCell.prototype.hurtDuration=function(){return 0},BaseCell.prototype.getColor=function(){},BaseCell.prototype.boom=function(e){!this.alive||this.lives<1||this.animate(BaseCell.ANIMATION_BOOM_NEIGHBOUR)},
BaseCell.prototype.bundleId=function(){return!1},BaseCell.prototype.getTypeId=function(){var e=1;if(!Game.currentGame)return e;for(var t in Game.currentGame.loader.map){if(this.constructor===Game.currentGame.loader.map[t])break;e++}e*=10;var i=this.getColor();if(i){e++;for(t=0;t<ColorCell.CODES.length&&i!==ColorCell.CODES[t];t++)e++}return e},BaseCell.prototype.canMoveWith=function(e){return!1},BaseCell.prototype.delete=function(){Game.currentGame&&Game.currentGame.field.isSelected(this)&&Game.currentGame.field.removeSelection(),this.onDeleteListener(),this.viewExists=void 0},BaseCell.prototype.explodeDuration=function(){return Match3Rules.ExplodeDuration},BaseCell.prototype.getMinLives=function(){return 1},BaseCell.prototype.onExplode=function(){Game.currentGame&&Game.currentGame.field.floor[this.y][this.x]&&Game.currentGame.field.floor[this.y][this.x].hurt()},BaseCell.prototype.preCollectDuration=function(){return 0},BaseCell.neighbors=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}],
BaseCell.prototype.forNeighbor=function(t){if(Game.currentGame){var i=Game.currentGame.field;BaseCell.neighbors.forEach(function(e){i.isCellInField(this.y+e.y,this.x+e.x)&&t(i.cells[this.y+e.y][this.x+e.x])},this)}},BaseCell.prototype.iterateLineOfFire=function(e,t,i,s,n){if(Game.currentGame)for(var o=Game.currentGame.field;o.isWithinBounds(t,e)&&!(o.cells[t][e]instanceof WallCell);){var a=o.cells[t][e];n?(a||(a=new BaseCell(e,t)),s(a)):a&&a.alive&&a.hurtable&&s(a),e+=i.x,t+=i.y}},BaseCell.prototype.getGoalId=function(){},BaseCell.prototype.boomNeighbors=function(e){},BaseCell.prototype.afterExplode=function(e){this.onAfterExplodeListener(this.x,this.y),this.onExplode(),e&&e()},BaseCell.prototype.explodeViaCollect=function(e){if(!Game.currentGame.goals.typeInGoals(this.getGoalId()))return cleverapps.ReportStream.debug("Collected cell not in goals!"),void this.explode(e);if(this.alive){this.alive=!1,(e=e||{}).groupSize||(e.groupSize=1),e.id||(e.id=0);var t=Game.currentGame.goals.check(
this,e.id,e.groupSize);this.onBeforeExplodeListener(t,e.id);var i=this.explodeDuration();Game.counter.setTimeout(this.afterExplode.bind(this,e.callback),1e3*i)}},BaseCell.prototype.onDoubleTouch=function(){},BaseCell.prototype.onTouchEnd=function(){this.lastTouchEnd||(this.lastTouchEnd=0);var e=Date.now();e-this.lastTouchEnd<500?(this.lastTouchEnd=0,this.onDoubleTouch()):this.lastTouchEnd=e},BaseCell.prototype.getRandomColor=function(){return cleverapps.Random.choose(Game.currentGame.levelContent.colors).toLowerCase()},BaseCell.prototype.explode=function(e){if(this.alive){this.alive=!1,e=e||{},Game.currentGame.score.addMoveExplode(1);var t=this.explodeDuration();this.onBeforeExplodeListener(t),Game.counter.setTimeout(this.afterExplode.bind(this,e.callback),1e3*t)}},BaseCell.prototype.prepareForBurn=function(){this.willBurn=!0},BaseCell.prototype.beforeMoveByTransporter=function(e){},BaseCell.ANIMATION_DOWN=0,BaseCell.ANIMATION_UP=1,BaseCell.ANIMATION_RIGHT=2,BaseCell.ANIMATION_LEFT=3,
BaseCell.ANIMATION_MISTAKE=4,BaseCell.ANIMATION_SHOWUP=5,BaseCell.ANIMATION_SHOWHIDE=6,BaseCell.ANIMATION_HURT=7,BaseCell.ANIMATION_MULTI_COLOR_SELECT=8,BaseCell.ANIMATION_CREATE=9,BaseCell.ANIMATION_SMILE=10,BaseCell.ANIMATION_CREATE_FROM_CELL=11,BaseCell.ANIMATION_OPEN=12,BaseCell.ANIMATION_ONCLICK=13,BaseCell.ANIMATION_COOKIE_UP=14,BaseCell.ANIMATION_SELECT=15,BaseCell.ANIMATION_CREATE_FROM_CENTER=16,BaseCell.ANIMATION_BOOM_NEIGHBOUR=17,BaseCell.ANIMATION_COOKIE_IN=18,BaseCell.ANIMATION_COOKIE_OUT=19,BaseCell.ANIMATION_TRANSPORTER_LOOP_START=20,BaseCell.ANIMATION_TRANSPORTER_LOOP_FINISH=21,BaseCell.ANIMATION_GOTO_POSITION=22,BaseCell.ANIMATION_ICE_MAKER_MOVE=23,BaseCell.ANIMATION_MOVE_TO=24,BaseCell.ANIMATION_CREATE_FROM_BOOSTER_BEFORE=25,CreateTypes={NOT_CREATE_AGAIN_TYPE:"x",CREATE_AGAIN_TYPE:"y",AUTO_CREATED_TYPE:"a"},BaseCell.DIRECTIONS={},BaseCell.UP=0,BaseCell.UP_RIGHT=1,BaseCell.RIGHT=2,BaseCell.DOWN_RIGHT=3,BaseCell.DOWN=4,BaseCell.DOWN_LEFT=5,BaseCell.LEFT=6,
BaseCell.UP_LEFT=7,BaseCell.DIRECTIONS[BaseCell.UP]={x:0,y:-1},BaseCell.DIRECTIONS[BaseCell.UP_RIGHT]={x:1,y:-1},BaseCell.DIRECTIONS[BaseCell.RIGHT]={x:1,y:0},BaseCell.DIRECTIONS[BaseCell.DOWN_RIGHT]={x:1,y:1},BaseCell.DIRECTIONS[BaseCell.DOWN]={x:0,y:1},BaseCell.DIRECTIONS[BaseCell.DOWN_LEFT]={x:-1,y:1},BaseCell.DIRECTIONS[BaseCell.LEFT]={x:-1,y:0},BaseCell.DIRECTIONS[BaseCell.UP_LEFT]={x:-1,y:-1};var BoosterCell=function(e,t){BaseCell.call(this,e,t),this.movable=!0,this.hurtable=!1,this.putInPoolAvailable=!0,this.fallThroughBarrier=!0,this.selectType(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTER_CELL_ADDED),Game.currentGame&&(Game.currentGame.boosterAdded=!0,Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN&&(!Game.currentGame.tutorial||Game.currentGame.tutorial.finished)&&0<Game.currentGame.moves&&0===BombCell.listToExplode().length&&(Game.currentGame.tutorial=new LevelTutorial([{closeByTouch:1,cellBooster:this,control:[],textBlock:{
text:"messages:BoosterCellTutorial"}}],function(){}),Game.currentGame.createTutorialController()))};BoosterCell.prototype=Object.create(BaseCell.prototype),(BoosterCell.prototype.constructor=BoosterCell).prototype.onTouchEnd=function(){this.animate(BaseCell.ANIMATION_DOWN),cleverapps.Notification.create("messages:Booster.MoveToDown")},BoosterCell.listAvailable=function(){return Game.currentGame.boosters.list.filter(function(e){return!e.disabled}).map(function(e){return e.id})},BoosterCell.prototype.selectType=function(){this.type=cleverapps.Random.choose(BoosterCell.listAvailable())},BoosterCell.prototype.getViewClass=function(){return BoosterCellView},BoosterCell.prototype.onBurnStage=function(){if(Game.currentGame){for(var e=this.y+1;e<Field.SIZE;e++)if(Game.currentGame.field.inField(e,this.x))return;this.explode(),Game.currentGame.addBoosterCellReward(this)}},BoosterCell.prototype.explodeDuration=function(){return 1},BoosterCell.isNeedToAdd=function(e,t){if(
Game.currentGame.boosterAdded)return!1;if(0===BoosterCell.listAvailable().length)return!1;if(Game.currentGame.level.isCurrentLevel()&&15<t&&2<t-e&&5<e&&Math.random()<.08/(t-8)){var i=!1;if(Game.currentGame.field.nextCells.forEach(function(e){"booster"===e&&(i=!0)}),!i)return!0}return!1};var TulpanCell=function(e,t){BaseCell.call(this,e,t),this.movable=!0,this.putInPoolAvailable=!0};TulpanCell.prototype=Object.create(BaseCell.prototype),(TulpanCell.prototype.constructor=TulpanCell).prototype.getViewClass=function(){return TulpanCellView},TulpanCell.prototype.boom=function(){this.hurt()},TulpanCell.isNeedToAdd=function(e,t,i,s,n){if(i||(i=Mission.TYPE_BURN_NEARBY),s||(s=TulpanCell),n||(n="tulpan"),Game.currentGame&&2<t-e&&Game.currentGame.getMissionType()===i){for(var o=0,a=0;a<Field.SIZE;a++)for(var r=0;r<Field.SIZE;r++){var l=Game.currentGame.field.cells[a][r];l&&l.constructor===s&&o++}for(a=0;a<Game.currentGame.field.nextCells.length;a++)Game.currentGame.field.nextCells[a]===n&&o++
;return Math.random()<.3-.1*o}return!1};var BigCell=function(e,t,i,s,n){return BaseCell.call(this,e,t),this.movable=!1,this.hurtable=!0,this.cellClass=i,this.isHead=!0,(this.head=this).headExploded=!1,this.rows=2,s&&2<s&&(this.rows=s),this.cols=2,n&&2<n&&(this.cols=n),e<0?!(this.isForGoal=!0):(this.checkHeadFlag(),!0)};BigCell.prototype=Object.create(BaseCell.prototype),(BigCell.prototype.constructor=BigCell).prototype.checkHeadFlag=function(){for(var e=0;e<this.rows;e++)for(var t=0;t<this.cols;t++)t+e!==0&&0<=this.y-e&&Game.currentGame.field.cells[this.y-e]&&0<=this.x-t&&Game.currentGame.field.cells[this.y-e][this.x-t]&&Game.currentGame.field.cells[this.y-e][this.x-t]instanceof this.cellClass&&Game.currentGame.field.cells[this.y-e][this.x-t].isHead&&(this.isHead=!1,this.head=Game.currentGame.field.cells[this.y-e][this.x-t])},BigCell.prototype.editorComponents=function(){if(this.isHead)return[BaseCellComponent,BigCellComponent]},BigCell.prototype.load=function(e){if(1<e.length){
var t=e.splice(1).join("");this.lives=parseInt(t)}},BigCell.prototype.save=function(){if(this.isHead){var e=""+this.lives;return this.cellClass.CODES.concat(e.split(""))}return this.cellClass.CODES},BigCell.prototype.animate=function(e,t){this.isHead?BaseCell.prototype.animate.call(this,e,t):this.head.isHead&&this.head.animate(e,t)},BigCell.prototype.getLives=function(){return this.isHead?this.lives:this.head.getLives()},BigCell.prototype.hurt=function(){this.isHead?BaseCell.prototype.hurt.apply(this,arguments):this.head.hurt()},BigCell.prototype.hover=function(e){this.isHead?BaseCell.prototype.hover.call(this,e):this.head.hover(e)},BigCell.prototype.onHeadExplode=function(){this.explodeViaCollect()},BigCell.prototype.explode=function(){if(this.isHead){if(this.headExploded||!Game.currentGame)return;this.headExploded=!0;for(var e=Game.currentGame.field.cells,t=0;t<this.rows;t++)for(var i=0;i<this.cols;i++)0<t+i&&e[this.y+t][this.x+i].explode();this.onHeadExplode()
}else BaseCell.prototype.explode.call(this)};var ColorCell=function(e,t,i){BaseCell.call(this,e,t),this.movable=!0,this.color=i,this.mark=void 0,this.missionMark=void 0,this.putInPoolAvailable=!0};ColorCell.prototype=Object.create(BaseCell.prototype),(ColorCell.prototype.constructor=ColorCell).prototype.useCustomView=function(){return!1},ColorCell.prototype.onDoubleTouch=function(){if(cleverapps.config.debugMode){var e=ComboCell.Create(this,{random:!0});e&&!this.moving&&(this.delete(),Game.currentGame.field.addCell(e),e.animate(BaseCell.ANIMATION_CREATE)),Game.currentGame.field.findRandomMove()}},ColorCell.prototype.getColor=function(){return this.color},ColorCell.prototype.canRepaint=function(){return!0},ColorCell.prototype.canDelete=function(){return this.constructor===ColorCell&&!this.mark&&!this.toDelete},ColorCell.prototype.repaint=function(){var e=Game.currentGame.field.loader.loadNext(this.y,this.x,[Loader.WILDCARD]);return this.mark&&e.addMark(),e.missionMark=this.missionMark,e
},ColorCell.prototype.boomNeighbors=function(t){this.alive&&this.forNeighbor(function(e){e.boom(t,this)}.bind(this))},ColorCell.prototype.addMark=function(){this.mark=new Mark(this)},ColorCell.prototype.explodeViaEater=function(e,t){if(this.alive){this.alive=!1,(t=t||{}).groupSize||(t.groupSize=1),t.id||(t.id=0);var i=e.check(this,t.id,t.groupSize);this.onBeforeExplodeMouseListener(e,i,t.id);var s=this.explodeDuration();Game.counter.setTimeout(this.afterExplode.bind(this,t.callback),1e3*s)}},ColorCell.prototype.simpleExplode=function(e){var t=EaterCell.find(e,this.color);t?this.explodeViaEater(t,e):BaseCell.prototype.explode.call(this,e)},ColorCell.prototype.explode=function(e){this.mark&&(this.mark.explode(),this.mark=void 0),cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.COLLECT_COLOR_CELLS,{color:this.color.toLowerCase()}),cleverapps.missionManager.dispatchEvent(Mission.EVENT_COLLECT_COLOR_CELLS),this.simpleExplode(e)},ColorCell.prototype.addMissionMark=function(){if(
!this.mark&&Game.currentGame&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN&&Game.currentGame.getMissionType()===Mission.TYPE_COLLECT_MARK){if(cleverapps.config.debugMode&&cleverapps.config.editorMode)return;Math.random()<.1&&(this.missionMark=!0)}},ColorCell.prototype.load=function(e){var t=e.shift();this.color=t,0<e.length&&this.addMark(),this.addMissionMark()},ColorCell.prototype.save=function(){return this.mark?[this.color,this.mark.code]:[this.color]},ColorCell.prototype.getViewClass=function(){if("a"===this.color)return ColorCellView_a;if("b"===this.color)return ColorCellView_b;if("c"===this.color)return ColorCellView_c;if("d"===this.color)return ColorCellView_d;if("e"===this.color)return ColorCellView_e;if("w"===this.color)return ColorCellView_w;throw"unknown color: "+this.color},ColorCell.CODE_COLORS={a:"blue",b:"green",c:"purple",d:"red",e:"yellow",w:"white"};var GoalColorCell=function(e,t,i){ColorCell.call(this,e,t,i),this.coef=0,this.onBeforeIncCoef=function(){},
this.onBeforeResetCoef=function(){}};GoalColorCell.prototype=Object.create(ColorCell.prototype),(GoalColorCell.prototype.constructor=GoalColorCell).prototype.getGoalId=function(){return this.color},GoalColorCell.prototype.smile=function(){this.mark&&Math.random()<.5?this.mark.smile():this.animate(BaseCell.ANIMATION_SMILE)},GoalColorCell.prototype.resetCoef=function(){if(this.alive&&0!==this.coef&&!this.frozenForBurn&&this.needResetCoef){this.onBeforeResetCoef(.2),this.coef=0,this.needResetCoef=!1,Game.counter.setTimeout(function(){},200)}},GoalColorCell.prototype.incCoef=function(e){if(Match3Rules.Plus&&this.alive&&!this.frozenForBurn&&(this.needResetCoef&&(this.coef=0,this.needResetCoef=!1),9!==this.coef)){this.onBeforeIncCoef(.2),this.coef+=e,9<this.coef&&(this.coef=9),Game.counter.setTimeout(function(){},200)}},GoalColorCell.prototype.canDelete=function(){return this.constructor===GoalColorCell&&!this.mark&&!this.toDelete},GoalColorCell.prototype.prepareForBurn=function(){
this.frozenForBurn=!0,BaseCell.prototype.prepareForBurn.call(this)},GoalColorCell.prototype.prepareResetCoef=function(){Game.currentGame.field.floor[this.y][this.x]instanceof GrassTile||(this.needResetCoef=!0)},GoalColorCell.prototype.boom=function(e){this.alive&&(this.frozenForBurn||(this.incCoef(e),this.animate(BaseCell.ANIMATION_BOOM_NEIGHBOUR)))},GoalColorCell.prototype.getViewClass=function(){if("a"===this.color)return GoalColorCellView_A;if("b"===this.color)return GoalColorCellView_B;if("c"===this.color)return GoalColorCellView_C;if("d"===this.color)return GoalColorCellView_D;if("e"===this.color)return GoalColorCellView_E;if("w"===this.color)return GoalColorCellView_W;throw"unknown color: "+this.color},GoalColorCell.prototype.explode=function(e){if(this.mark&&(this.mark.explode(),this.mark=void 0),EaterCell.find(e,this.color))this.simpleExplode(e);else{var t=(this.coef||0)+1;cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.COLLECT_COLOR_CELLS,t,{
color:this.color.toLowerCase()}),cleverapps.missionManager.dispatchEvent(Mission.EVENT_COLLECT_COLOR_CELLS,{amount:t}),this.explodeViaCollect(e)}},GoalColorCell.prototype.load=function(e){var t=e.shift();this.color=t.toLowerCase(),0<e.length&&this.addMark(),this.addMissionMark()},GoalColorCell.prototype.save=function(){return this.mark?[this.color.toUpperCase(),this.mark.code]:[this.color.toUpperCase()]};var SpecialColorCell=function(e,t,i){ColorCell.call(this,e,t,i)};SpecialColorCell.prototype=Object.create(ColorCell.prototype),(SpecialColorCell.prototype.constructor=SpecialColorCell).prototype.repaint=function(){return this.color=this.getRandomColor(),this},SpecialColorCell.prototype.canRepaint=function(e){return!e},SpecialColorCell.prototype.onDoubleTouch=function(){};var DecoratorCell=function(e,t){this.onExplodeHurt=0,this.onExplodeBoomCounter=0,BaseCell.call(this,e,t),this.innerCell=void 0};DecoratorCell.prototype=Object.create(BaseCell.prototype),(
DecoratorCell.prototype.constructor=DecoratorCell).prototype.load=function(e,t){e.shift();this.setInnerCell(t.loadNext(this.y,this.x,e))},DecoratorCell.prototype.boomHurt=function(e){this.lives<1||!this.alive?this.onExplodeBoomCounter++:this.hurt(e)},DecoratorCell.prototype.hurt=function(e){this.lives<1||!this.alive?this.onExplodeHurt++:BaseCell.prototype.hurt.call(this,e)},DecoratorCell.prototype.canRepaint=function(e){return!e&&(!!this.getColor()&&this.innerCell.canRepaint())},DecoratorCell.prototype.repaint=function(){return this.canRepaint()&&this.setInnerCell(this.innerCell.repaint()),this},DecoratorCell.prototype.onExplode=function(){this.innerCell.viewExists=!0,Game.currentGame.field.addCell(this.innerCell),this.innerCell.visible||this.innerCell.changeVisible(!0);for(var e=0;e<this.onExplodeHurt;e++)this.innerCell.hurt();0<this.onExplodeBoomCounter&&this.innerCell.boom(this.onExplodeBoomCounter,this),this.setInnerCell(void 0)},DecoratorCell.prototype.explode=function(e){
this.getGoalId()&&Game.currentGame.goals.typeInGoals(this.getGoalId())?this.explodeViaCollect(e):BaseCell.prototype.explode.call(this,e)},DecoratorCell.prototype.animate=function(e,t){BaseCell.prototype.animate.call(this,e,t),this.innerCell&&-1!==[BaseCell.ANIMATION_SHOWUP,BaseCell.ANIMATION_TRANSPORTER_LOOP_START,BaseCell.ANIMATION_TRANSPORTER_LOOP_FINISH].indexOf(e)&&this.innerCell.animate(e,t)},DecoratorCell.prototype.move=function(e,t,i){this.innerCell&&this.innerCell.move(e,t,i),BaseCell.prototype.move.call(this,e,t,i)},DecoratorCell.prototype.hover=function(e){this.innerCell&&this.innerCell.hover(e),BaseCell.prototype.hover.call(this,e)},DecoratorCell.prototype.afterMove=function(e,t){BaseCell.prototype.afterMove.call(this,e,t);for(var i=this;i.innerCell;){var s=i.innerCell;s.x=e.x,s.y=e.y,i=s}};var ChainDecoratorCell=function(e,t){DecoratorCell.call(this,e,t)};ChainDecoratorCell.prototype=Object.create(DecoratorCell.prototype),(
ChainDecoratorCell.prototype.constructor=ChainDecoratorCell).prototype.getViewClass=function(){return ChainDecoratorCellView},ChainDecoratorCell.prototype.load=function(e,t){e.shift(),"2"===e[0]&&(e.shift(),this.lives=2),this.setInnerCell(t.loadNext(this.y,this.x,e))},ChainDecoratorCell.prototype.save=function(){var e=ChainDecoratorCell.CODES;return 2===this.lives&&(e=e.concat("2")),e.concat(this.innerCell.save())},ChainDecoratorCell.prototype.getColor=function(){return this.innerCell.getColor()};var IceBlockDecoratorCell=function(e,t){DecoratorCell.call(this,e,t),this.controlDisabled=!0,this.movable=!0,this.putInPoolAvailable=!0};IceBlockDecoratorCell.prototype=Object.create(DecoratorCell.prototype),(IceBlockDecoratorCell.prototype.constructor=IceBlockDecoratorCell).prototype.getViewClass=function(){return IceBlockDecoratorCellView},IceBlockDecoratorCell.prototype.load=function(e,t){e.shift(),this.lives=parseInt(e[0]),e.shift(),this.setInnerCell(t.loadNext(this.y,this.x,e))},
IceBlockDecoratorCell.prototype.bundleId=function(){return"ice_block"},IceBlockDecoratorCell.prototype.save=function(){var e=IceBlockDecoratorCell.CODES;return(e=e.concat(this.lives)).concat(this.innerCell.save())},IceBlockDecoratorCell.prototype.getColor=function(){return this.innerCell.getColor()};var FishCell=function(e,t){BaseCell.call(this,e,t),this.movable=!0,this.hurtable=!1,this.putInPoolAvailable=!0};FishCell.prototype=Object.create(BaseCell.prototype),(FishCell.prototype.constructor=FishCell).prototype.onTouchEnd=function(){this.movable&&(this.animate(BaseCell.ANIMATION_ONCLICK),cleverapps.Notification.create("messages:Fish.MoveToDown"))},FishCell.prototype.smile=function(){this.alive&&this.animate(BaseCell.ANIMATION_SMILE)},FishCell.prototype.load=function(e){},FishCell.prototype.save=function(){return FishCell.CODES},FishCell.prototype.getViewClass=function(){return FishCellView},FishCell.prototype.onBurnStage=function(){if(Game.currentGame){for(
var e=this.y+1;e<Field.SIZE;e++)if(Game.currentGame.field.inField(e,this.x))return;this.explodeViaCollect()}},FishCell.prototype.getGoalId=function(){return FishCell.GOAL_ID},FishCell.GOAL_ID="cell_fish";var CookieManCell=function(e,t){BaseCell.call(this,e,t),this.movable=!0,this.hurtable=!1,this.putInPoolAvailable=!0,Game.currentGame.counter.fieldCounter.registerStage(204,CookieManCell.process)};CookieManCell.prototype=Object.create(BaseCell.prototype),(CookieManCell.prototype.constructor=CookieManCell).prototype.onTouchEnd=function(){this.movable&&(this.animate(BaseCell.ANIMATION_ONCLICK),cleverapps.Notification.create("messages:CookieMan.MoveToDown"))},CookieManCell.prepareToUp=function(){if(Game.currentGame)for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===CookieManCell&&(Game.currentGame.field.cells[e][t].canUp=!0,Game.currentGame.field.cells[e][t].movedDownToTransporterOnPreviousMove&&(
Game.currentGame.field.cells[e][t].movedDownToTransporterOnPreviousMove=!1))},CookieManCell.process=function(){if(Game.currentGame)for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===CookieManCell&&Game.currentGame.field.cells[e][t].process()},CookieManCell.prototype.move=function(e,t){e.y>this.y&&(t&&t.source&&t.source instanceof TransporterTile||(this.canUp=!1),Game.currentGame&&Game.currentGame.field.floor[e.y][e.x]instanceof TransporterTile&&(this.movedDownToTransporterOnPreviousMove=!0,this.canUp=!1)),BaseCell.prototype.move.apply(this,arguments)},CookieManCell.prototype.beforeMoveByTransporter=function(e){e.x-this.x!=0&&(this.movedDownToTransporterOnPreviousMove||(this.canUp=!0)),e.y-this.y!=0&&(this.canUp=!1)},CookieManCell.prototype.process=function(){if(this.canUp){var e=this.x,t=this.y;if(!1!==Game.currentGame.field.barriers.canMove(t,e,t-1,e)&&Game.currentGame.field.isCellInField(t-1,e
)&&Game.currentGame.field.cells[t-1][e].movable&&Game.currentGame.field.cells[t-1][e].constructor!==CookieManCell&&Game.currentGame.field.cells[t-1][e].constructor!==ColorCookieManCell){var i=Game.currentGame.field.cells[t-1][e];this.y=t-1,this.animate(BaseCell.ANIMATION_COOKIE_UP,function(){this.onFinishMoveListener({x:this.x,y:this.y},{})}.bind(this)),Game.counter.setTimeout(function(){i.move({x:e,y:t},{moveInterval:.1})}.bind(this),500),Game.counter.setTimeout(function(){Game.currentGame.field.cells[t][e]=i,Game.currentGame.field.cells[t-1][e]=this}.bind(this),this.upDuration()),this.canUp=!1}}},CookieManCell.prototype.upDuration=function(){return 1300},CookieManCell.prototype.bundleId=function(){return"cookieman"},CookieManCell.prototype.smile=function(){this.alive&&this.animate(BaseCell.ANIMATION_SMILE)},CookieManCell.prototype.load=function(e){},CookieManCell.prototype.save=function(){return CookieManCell.CODES},CookieManCell.prototype.getViewClass=function(){
return CookieManCellView},CookieManCell.prototype.onBurnStage=function(){for(var e=this.y+1;e<Field.SIZE;e++)if(Game.currentGame.field.inField(e,this.x))return;this.explodeViaCollect()},CookieManCell.prototype.getGoalId=function(){return CookieManCell.GOAL_ID},CookieManCell.GOAL_ID="cookie_man";var FlowerCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1};FlowerCell.prototype=Object.create(BaseCell.prototype),(FlowerCell.prototype.constructor=FlowerCell).prototype.load=function(e){this.lives=parseInt(e[1])},FlowerCell.prototype.save=function(){return FlowerCell.CODES.concat([this.lives])},FlowerCell.prototype.getViewClass=function(){return FlowerCellView},FlowerCell.prototype.getGoalId=function(){return FlowerCell.GOAL_ID},FlowerCell.prototype.boom=function(){this.hurt()},FlowerCell.prototype.hurtDuration=function(){return 0===this.lives?.4:0},FlowerCell.prototype.explode=function(){Game.currentGame.goals.inGoals(this)?BaseCell.prototype.explodeViaCollect.call(this
):BaseCell.prototype.explode.call(this)},FlowerCell.GOAL_ID="flower_cell";var EaterCell=function(e,t,i,s,n){BigCell.call(this,e,t,i,s,n)&&(this.lives=10,this.onShowupViewListener=function(){},this.isHead&&(Game.currentGame.EATERS||(Game.currentGame.EATERS=[]),Game.currentGame.EATERS.push(this)),EaterCell.COLOR_EATERS={},this.hurtable=!1)};EaterCell.prototype=Object.create(BigCell.prototype),(EaterCell.prototype.constructor=EaterCell).prototype.setDepth=function(e){BaseCell.prototype.setDepth.call(this,e),0<this.depth?(Game.currentGame.EATERS||(Game.currentGame.EATERS=[]),Game.currentGame.EATERS=Game.currentGame.EATERS.filter(function(e){return!(e instanceof EaterCell&&e.constructor===this.constructor&&e.x===this.x&&e.y===this.y)}.bind(this))):(Game.currentGame.EATERS||(Game.currentGame.EATERS=[]),this.isHead&&Game.currentGame.EATERS.push(this))},EaterCell.prototype.checkHeadFlag=function(){BigCell.prototype.checkHeadFlag.call(this),!this.isHead&&Game.currentGame.EATERS&&(
Game.currentGame.EATERS=Game.currentGame.EATERS.filter(function(e){return!(e instanceof EaterCell&&e.x===this.x&&e.y===this.y)}.bind(this)))},EaterCell.prototype.getView=function(){return this.onShowupViewListener()},EaterCell.prototype.editorComponents=function(){if(this.isHead)return[BaseCellComponent,BigCellComponent,LiveLineComponent]},EaterCell.find=function(e,t){if(Game.currentGame&&Game.currentGame.EATERS){var i=Game.currentGame.EATERS.filter(function(e){return-1!==e.getAcceptedColors().indexOf(t)});if(0!==i.length)return 0!==(e?e.id:0)&&void 0!==EaterCell.COLOR_EATERS[t]||(void 0===EaterCell.COLOR_EATERS[t]?EaterCell.COLOR_EATERS[t]=0:EaterCell.COLOR_EATERS[t]=(EaterCell.COLOR_EATERS[t]+1)%i.length),i[EaterCell.COLOR_EATERS[t]]}},EaterCell.prototype.getFlyDuration=function(e){var t=e.y-(this.y+.5),i=e.x-(this.x+.5);return Math.sqrt(t*t+i*i+2)/8},EaterCell.prototype.check=function(e,t,i){var s=this.getFlyDuration(e),n=Goals.UP_DURATION+Goals.WAIT_DURATION,
o=Goals.DEFAULT_NEXT_CELL_DURATION;o*i>Goals.MAX_NEXT_CELL_DURATION&&(o=Goals.MAX_NEXT_CELL_DURATION/i);var a=s+(n+=o*=t);return Game.counter.setTimeout(function(){this.isHead?this.realHurt():this.head.realHurt()}.bind(this),1e3*a),{duration:a,waitDuration:n-Goals.UP_DURATION}},EaterCell.prototype.realHurt=function(){if(0<this.lives){if(Game.currentGame.score.addMoveExplode(1),this.hurtable=!0,this.hurt(),0===this.lives)for(var e=0;e<Game.currentGame.EATERS.length;e++)if(Game.currentGame.EATERS[e]===this){Game.currentGame.EATERS.splice(e,1);break}this.hurtable=!1}},EaterCell.prototype.hurtDuration=function(){return.4};var DogCell=function(e,t){EaterCell.call(this,e,t,DogCell)};DogCell.prototype=Object.create(EaterCell.prototype),(DogCell.prototype.constructor=DogCell).prototype.bundleId=function(){return"dog"},DogCell.prototype.getViewClass=function(){return EaterCellView},DogCell.prototype.getGoalId=function(){return DogCell.GOAL_ID},DogCell.prototype.getAcceptedColors=function(){
return DogCell.ACCEPTED_COLORS},DogCell.GOAL_ID="dog_cell",DogCell.ACCEPTED_COLORS=["e"];var MouseCell=function(e,t){EaterCell.call(this,e,t,MouseCell)};MouseCell.prototype=Object.create(EaterCell.prototype),(MouseCell.prototype.constructor=MouseCell).prototype.bundleId=function(){return"mouse"},MouseCell.prototype.getViewClass=function(){return EaterCellView},MouseCell.prototype.getGoalId=function(){return MouseCell.GOAL_ID},MouseCell.prototype.getAcceptedColors=function(){return MouseCell.ACCEPTED_COLORS},MouseCell.GOAL_ID="mouse_cell",MouseCell.ACCEPTED_COLORS=["a"];var BlanketCell=function(t,i,e,s){if(EaterCell.call(this,t,i,BlanketCell,e,s),this.setAcceptedColors([BlanketCell.DEFAULT_ACCEPTED_COLOR]),Game&&Game.currentGame&&Game.currentGame.field&&Game.currentGame.field.cells)for(var n=0;n<Field.SIZE&&this.isHead;n++)for(var o=0;o<Field.SIZE&&this.isHead;o++
)Game.currentGame.field.cells[n]&&Game.currentGame.field.cells[n][o]instanceof BlanketCell&&Game.currentGame.field.cells[n][o].isHead&&o<=t&&n<=i&&t<o+Game.currentGame.field.cells[n][o].cols&&i<n+Game.currentGame.field.cells[n][o].rows&&(this.isHead=!1,this.head=Game.currentGame.field.cells[n][o],Game.currentGame.EATERS&&(Game.currentGame.EATERS=Game.currentGame.EATERS.filter(function(e){return!(e instanceof BlanketCell&&e.x===t&&e.y===i)})));this.hideInnerCell=!0,this.deleteView=function(){}};BlanketCell.prototype=Object.create(EaterCell.prototype),(BlanketCell.prototype.constructor=BlanketCell).prototype.checkHeadFlag=function(){},BlanketCell.prototype.resizeBeforeViewCreated=function(e,t){this.isHead&&(this.rows=e,this.cols=t)},BlanketCell.prototype.getCenterVector=function(){return{x:cleverapps.styles.BaseCellView.CELL_SIZE_PX*(this.cols-1)/2,y:-cleverapps.styles.BaseCellView.CELL_SIZE_PX*(this.rows-1)/2}},BlanketCell.prototype.getGoalTargetPosition=function(e){
var t=this.getCenterVector();return e.x-=t.x,e.y-=t.y,e},BlanketCell.prototype.load=function(e,t){2<e.length&&(e[1]!==BlanketCell.SEPARATOR?(this.resizeBeforeViewCreated(parseInt(e[1],10),parseInt(e[3],10)),this.setAcceptedColors([e[2]]),this.lives=parseInt(e.slice().splice(4).join("")),this.setInnerCell(t.loadNext(this.y,this.x,e.splice(4+this.lives.toString().length+1)))):this.setInnerCell(t.loadNext(this.y,this.x,e.splice(2))))},BlanketCell.prototype.save=function(){var e=BlanketCell.SEPARATOR;return this.isHead&&(e=""+this.rows+this.getAcceptedColors().join("")+this.cols+this.lives+BlanketCell.SEPARATOR),BlanketCell.CODES.concat(e.split("")).concat(this.innerCell.save())},BlanketCell.prototype.explodeDuration=function(){return.1},BlanketCell.prototype.explode=function(){if(this.isHead){if(this.headExploded||!Game.currentGame)return;this.headExploded=!0;for(var i=Game.currentGame.field.cells,e=0;e<this.rows;e++)for(var t=0;t<this.cols;t++)if(i[this.y+e][this.x+t].innerCell){
var s=i[this.y+e][this.x+t].innerCell;i[this.y+e][this.x+t].setInnerCell(void 0),s instanceof BigCell&&s.checkHeadFlag(),Game.currentGame.field.addCell(s),s.visible||s.changeVisible(!0)}Game.counter.setTimeout(function(){for(var e=0;e<this.rows;e++)for(var t=0;t<this.cols;t++){if(i[this.y+e][this.x+t])i[this.y+e][this.x+t].animate(BaseCell.ANIMATION_BOOM_NEIGHBOUR)}}.bind(this),1e3*this.explodeDuration()),Game.counter.setTimeout(function(){},1e3*this.explodeDuration()),this.deleteView()}},BlanketCell.prototype.afterExplode=function(){},BlanketCell.prototype.bundleId=function(){return"blanket"},BlanketCell.prototype.getViewClass=function(){return BlanketCellView},BlanketCell.prototype.getGoalId=function(){return BlanketCell.GOAL_ID},BlanketCell.prototype.setAcceptedColors=function(e){this.isHead&&(this.acceptedColors=e)},BlanketCell.prototype.getAcceptedColors=function(){return this.acceptedColors},BlanketCell.prototype.editorComponents=function(){if(this.isHead)return[BaseCellComponent
,BlanketCellComponentCreator,LiveLineComponent]},BlanketCell.SEPARATOR=">",BlanketCell.GOAL_ID="blanket_cell",BlanketCell.DEFAULT_ACCEPTED_COLOR="d";var DragonCell=function(e,t){BigCell.call(this,e,t,DragonCell)?(this.hurtable=!0,this.lives=10):this.hurtable=!0};DragonCell.prototype=Object.create(BigCell.prototype),(DragonCell.prototype.constructor=DragonCell).prototype.editorComponents=function(){if(this.isHead)return[BaseCellComponent,BigCellComponent,LiveLineComponent]},DragonCell.prototype.bundleId=function(){return"dragon"},DragonCell.prototype.getViewClass=function(){return DragonCellView},DragonCell.prototype.getGoalId=function(){return DragonCell.GOAL_ID},DragonCell.prototype.smile=function(){this.alive&&this.animate(BaseCell.ANIMATION_SMILE)},DragonCell.prototype.boom=function(){this.hurt()},DragonCell.prototype.onHeadExplode=function(){this.onOpenAnimation(),Game.counter.setTimeout(this.explodeViaCollect.bind(this),DragonCell.EXPLODE_VIA_COLLECT_TIMEOUT)},
DragonCell.GOAL_ID="dragon_cell",DragonCell.EXPLODE_VIA_COLLECT_TIMEOUT=300;var BombCell=function(e,t){SpecialColorCell.call(this,e,t),this.untilExplode=void 0,this.basicUntilExplode=void 0,this.createType=void 0,this.putInPoolAvailable=!0,this.onChangeUntilExplode=function(){},this.onBoom=function(){},Game.currentGame.counter.registerStage(-10,BombCell.process)};BombCell.prototype=Object.create(SpecialColorCell.prototype),(BombCell.prototype.constructor=BombCell).prototype.editorComponents=function(){return[BaseCellComponent,BombCellComponent,SwitchModeComponent]},BombCell.prototype.bundleId=function(){return"bomb"},BombCell.prototype.smile=function(){this.alive&&this.animate(BaseCell.ANIMATION_SMILE)},BombCell.prototype.explode=function(e){if(this.createType!==CreateTypes.NOT_CREATE_AGAIN_TYPE){var t=""+this.basicUntilExplode;Game.currentGame.field.addNextCell(BombCell.CODES.concat([CreateTypes.AUTO_CREATED_TYPE,"."]).concat(t.split("")))}this.getGoalId(
)&&Game.currentGame.goals.typeInGoals(this.getGoalId())?this.explodeViaCollect(e):BaseCell.prototype.explode.call(this,e)},BombCell.prototype.load=function(e){e.shift(),this.createType=e.shift(),this.color=e.shift(),"."===this.color&&(this.color=this.getRandomColor()),this.untilExplode=parseInt(e.join("")),this.basicUntilExplode=this.untilExplode},BombCell.prototype.decTimer=function(){this.untilExplode--,this.onChangeUntilExplode()},BombCell.prototype.addUntilExplode=function(e){this.untilExplode+=e,this.onChangeUntilExplode()},BombCell.prototype.save=function(){var e=""+this.basicUntilExplode;return BombCell.CODES.concat([this.createType,this.color]).concat(e.split(""))},BombCell.prototype.getViewClass=function(){return BombCellView},BombCell.listToExplode=function(){var e=[];if(!Game.currentGame||Game.currentGame.outcome!==GameBase.OUTCOME_UNKNOWN)return e;for(var t=Game.currentGame.bombCellCanProcess?1:0,i=0;i<Field.SIZE;i++)for(var s=0;s<Field.SIZE;s++)if(
Game.currentGame.field.cells[i][s]){var n=Game.currentGame.field.cells[i][s];n.constructor===BombCell&&n.untilExplode===t&&e.push(n)}return e},BombCell.prepareToProcess=function(){if(Game.currentGame){Game.currentGame.bombCellCanProcess=!0;for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var i=Game.currentGame.field.cells[e][t];i&&i instanceof BombCell?i.bombCellCanProcess=!0:i&&i.innerCell instanceof BombCell&&(i.innerCell.bombCellCanProcess=!1)}}},BombCell.process=function(){if(Game.currentGame&&Game.currentGame.bombCellCanProcess&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN){Game.currentGame.bombCellCanProcess=!1;var t,i,a=[];for(t=0;t<Field.SIZE;t++)for(i=0;i<Field.SIZE;i++)if(Game.currentGame.field.cells[t][i]){var e=Game.currentGame.field.cells[t][i];e.constructor===BombCell&&e.bombCellCanProcess&&(e.bombCellCanProcess=!1,e.createType===CreateTypes.AUTO_CREATED_TYPE?e.createType=CreateTypes.CREATE_AGAIN_TYPE:(e.decTimer(),0===e.untilExplode&&a.push(e)))}if(
0<a.length){Game.currentGame.loseByBombExplodeRunning=!0;var s=function(){Game.currentGame.loseByBombExplodeRunning=!1,0===Game.currentGame.moves&&Game.currentGame.incMoves(),Game.counter.setTimeout(function(){for(t=0;t<Field.SIZE;t++)for(i=0;i<Field.SIZE;i++)if(Game.currentGame.field.cells[t][i]){var e=Game.currentGame.field.cells[t][i];e.constructor===BombCell&&e.addUntilExplode(AddBombMovesWindow.MOVES_TO_ADD)}},100)},n=function(){a.forEach(function(e){e.onBoom()});var e=cc.director.getRunningScene().scene,t=new cc.Node;t.setContentSize(this.window.getContentSize()),t.setAnchorPoint(this.window.getAnchorPoint());var i=e.convertToNodeSpace(this.content.convertToWorldSpace(this.content.getPosition()));t.setPosition(i.x,i.y-cleverapps.styles.Window.contentOffset);var s=new cleverapps.Spine(res.reward_spine_json,1.5);s.setPosition(this.bombIconAnimation.getPosition()),t.addChild(s),this.bombIconAnimation.replaceParentSamePlace(t),this.timerTxt.replaceParentSamePlace(t),
this.sadIconAnimation.replaceParentSamePlace(t),t.setLocalZOrder(14),this.bombIconAnimation.setAnimation(0,"boom",!1),this.sadIconAnimation.setAnimation(0,"windowsboom",!1),s.setAnimation(0,"animation",!0),e.addChild(t);var n=new cleverapps.Spine(bundles.bomb.jsons.bomb_splash_json,1);cleverapps.styles.BombCellView.skins&&n.setSkin("skin_"+a[0].color);var o=cleverapps.UI.getSceneSize();n.setPosition(o.width/2,o.height/2),n.setLocalZOrder(15),e.addChild(n),n.visible=!1,Game.counter.setTimeout(function(){n.setAnimation(0,"animation",!1)},1e3),Game.counter.setTimeout(function(){Game.currentGame.lose()},3e3)};cleverapps.audio.playSound(bundles.game.urls.no_moves_effect);var o=void 0!==Game.currentGame.addBombMovesId?Game.currentGame.addBombMovesId:0;if(o>=cleverapps.config.prices.prolongations.length)n();else{var r=cleverapps.config.prices.prolongations[o];FreeBombMoves.isAvailable()?(r=0,cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FREE_BOMB_MOVES)
):Game.currentGame.addBombMovesId=o+1;var l=Game.currentGame;cleverapps.metha.displayWhenFreeFocus({focus:"AddBombMovesWindow",control:"panel_info",action:function(e){l&&Game.currentGame===l&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN?cleverapps.metha.compound(e,[function(e){Game.currentGame.counter.setTimeout(e,500)},function(e){new AddBombMovesWindow(r,a[0].color,s,n,function(){FreeBombMoves.unAvailable()}),cleverapps.metha.onceNoWindowsListener=e}]):e()}})}}}},BombCell.prototype.getGoalId=function(){return BombCell.GOAL_ID},BombCell.GOAL_ID="bomb";var DirtDecoratorCell=function(e,t){DecoratorCell.call(this,e,t),this.putInPoolAvailable=!0,this.onCreateNew=function(){},Game.currentGame.counter.fieldCounter.registerStage(202,DirtDecoratorCell.process)};DirtDecoratorCell.prototype=Object.create(DecoratorCell.prototype),(DirtDecoratorCell.prototype.constructor=DirtDecoratorCell).prototype.getViewClass=function(){return DirtDecoratorCellView},
DirtDecoratorCell.prototype.save=function(){return DirtDecoratorCell.CODES.concat(this.innerCell.save())},DirtDecoratorCell.prototype.boom=function(){this.boomHurt()},DirtDecoratorCell.prototype.onExplode=function(){Game.currentGame.dirtDecoratorCellCanProcess=!1,DecoratorCell.prototype.onExplode.call(this)},DirtDecoratorCell.processTo=function(e){var t=new DirtDecoratorCell(e.cell.x,e.cell.y);t.setInnerCell(e.cell),t.onCreate=!0,Game.currentGame.field.addCell(t),t.onCreateNew(e.dir),Game.currentGame.goals.typeInGoals(DirtDecoratorCell.GOAL_ID)&&Game.currentGame.goals.incTarget(DirtDecoratorCell.GOAL_ID,1,!0),Game.counter.setTimeout(function(){},900)},DirtDecoratorCell.canProcessTo=function(e,t){if(Game.currentGame.field.isCellInField(e,t)){var i=Game.currentGame.field.cells[e][t].constructor;return-1!==[ColorCell,GoalColorCell,ColorBombCell,WaffleCell,FireworkCell,TruffleCell,ColorCookieManCell,LollipopCell,BombCell,NutCell].indexOf(i)}return!1},DirtDecoratorCell.process=function(){
if(Game.currentGame&&Game.currentGame.dirtDecoratorCellCanProcess){for(var e=[-1,1,0,0],t=[0,0,-1,1],i=["down","up","right","left"],s=[],n=0;n<Field.SIZE;n++)for(var o=0;o<Field.SIZE;o++)if(Game.currentGame.field.cells[n][o]&&Game.currentGame.field.cells[n][o].constructor===DirtDecoratorCell)for(var a=0;a<4;a++)DirtDecoratorCell.canProcessTo(n+e[a],o+t[a])&&!0===Game.currentGame.field.barriers.canMove(n,o,n+e[a],o+t[a])&&s.push({cell:Game.currentGame.field.cells[n+e[a]][o+t[a]],dir:i[a]});0<s.length&&(Game.currentGame.dirtDecoratorCellCanProcess=!1,DirtDecoratorCell.processTo(cleverapps.Random.choose(s)))}},DirtDecoratorCell.prototype.getGoalId=function(){return DirtDecoratorCell.GOAL_ID},DirtDecoratorCell.GOAL_ID="dirt_decorator";var CrabDecoratorCell=function(e,t){DecoratorCell.call(this,e,t),this.putInPoolAvailable=!0,this.onCrabMove=function(){},Game.currentGame&&Game.currentGame.counter.fieldCounter.registerStage(203,CrabDecoratorCell.process)}
;CrabDecoratorCell.prototype=Object.create(DecoratorCell.prototype),(CrabDecoratorCell.prototype.constructor=CrabDecoratorCell).prototype.getViewClass=function(){return CrabDecoratorCellView},CrabDecoratorCell.prototype.save=function(){return CrabDecoratorCell.CODES.concat(this.innerCell.save())},CrabDecoratorCell.prototype.getColor=function(){return this.innerCell.getColor()},CrabDecoratorCell.prototype.smile=function(){this.alive&&this.animate(BaseCell.ANIMATION_SMILE)},CrabDecoratorCell.prototype.canMoveTo=function(e,t){if(!Game.currentGame.field.isCellInField(t,e))return!1;if(CrabDecoratorCell.blockedByCrab[t][e])return!1;var i=Game.currentGame.field.cells[t][e].constructor;return-1!==[ColorCell,GoalColorCell,WaffleCell,ColorBombCell,FireworkCell,TruffleCell,ColorCookieManCell,LollipopCell].indexOf(i)},CrabDecoratorCell.prototype.process=function(){for(var e=[],t=[-1,1,0,0],i=[0,0,-1,1],s=0;s<4;s++)this.canMoveTo(this.x+t[s],this.y+i[s]
)&&!0===Game.currentGame.field.barriers.canMove(this.y,this.x,this.y+i[s],this.x+t[s])&&e.push(Game.currentGame.field.cells[this.y+i[s]][this.x+t[s]]);if(e.length){Game.currentGame.crabDecoratorCellCanProcess=!1;var n=cleverapps.Random.choose(e);CrabDecoratorCell.blockedByCrab[n.y][n.x]=!0,this.innerCell.viewExists=!0,this.innerCell.x=this.x,this.innerCell.y=this.y,Game.currentGame.field.addCell(this.innerCell),Game.counter.setTimeout(function(){this.onCrabMove(n,.3,n.x-this.x),Game.counter.setTimeout(function(){this.viewExists=!0,this.x=n.x,this.y=n.y,this.setInnerCell(n),Game.currentGame.field.addCell(this),this.onCrabFinishMove(n)}.bind(this),300)}.bind(this),50*CrabDecoratorCell.processedCrabs),CrabDecoratorCell.processedCrabs++,8<CrabDecoratorCell.processedCrabs&&(CrabDecoratorCell.processedCrabs=0)}},CrabDecoratorCell.process=function(){if(Game.currentGame&&Game.currentGame.crabDecoratorCellCanProcess){var e,t;for(CrabDecoratorCell.blockedByCrab=[],
e=CrabDecoratorCell.processedCrabs=0;e<Field.SIZE;e++)for(CrabDecoratorCell.blockedByCrab.push([]),t=0;t<Field.SIZE;t++)CrabDecoratorCell.blockedByCrab[e].push(!1);for(e=0;e<Field.SIZE;e++)for(t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===CrabDecoratorCell&&Game.currentGame.field.cells[e][t].process()}},CrabDecoratorCell.prototype.getGoalId=function(){return CrabDecoratorCell.GOAL_ID},CrabDecoratorCell.GOAL_ID="crab_decorator";var BoxDecoratorCell=function(e,t){DecoratorCell.call(this,e,t),this.hideInnerCell=!0};BoxDecoratorCell.prototype=Object.create(DecoratorCell.prototype),(BoxDecoratorCell.prototype.constructor=BoxDecoratorCell).prototype.getViewClass=function(){return BoxDecoratorCellView},BoxDecoratorCell.prototype.load=function(e,t){e.shift(),0<="234".indexOf(e[0])&&(this.lives=parseInt(e[0]),e.shift()),this.setInnerCell(t.loadNext(this.y,this.x,e))},BoxDecoratorCell.prototype.smile=function(){
this.alive&&0<this.lives&&this.animate(BaseCell.ANIMATION_SMILE)},BoxDecoratorCell.prototype.save=function(){var e=BoxDecoratorCell.CODES;return 1<this.lives&&(e=e.concat(this.lives)),e.concat(this.innerCell.save())},BoxDecoratorCell.prototype.boom=function(){this.boomHurt()},BoxDecoratorCell.prototype.onExplode=function(){DecoratorCell.prototype.onExplode.call(this)},BoxDecoratorCell.prototype.bundleId=function(){return"box"},BoxDecoratorCell.prototype.getGoalId=function(){return BoxDecoratorCell.GOAL_ID},BoxDecoratorCell.GOAL_ID="box_decorator";var Mark=function(e){this.code=Mark.CODE,this.cell=e,this.onExplodeListener=function(e,t){},this.onSmileListener=function(){}};Mark.prototype.explode=function(){var e=Game.currentGame.goals.inGoals(this),t={},i=cleverapps.styles.MarkView.animation.start.duration;if(e){var s=Game.currentGame.goals.getFlyDuration(this.cell);t.flyDuration=s,Game.counter.goalSetTimeout(function(){Game.currentGame.goals.incGoal(this.getGoalId(),1)}.bind(this),1e3*(
s+i))}Game.counter.goalSetTimeout(function(){},1e3*i),this.onExplodeListener(e,t)},Mark.prototype.smile=function(){this.onSmileListener()},Mark.prototype.getGoalId=function(){return Mark.GOAL_ID},Mark.CODE="!",Mark.GOAL_ID=Mark.CODE;var GingerHouseCell=function(e,t){BigCell.call(this,e,t,GingerHouseCell)&&(this.collectedParts=[],this.animatingParts=0,this.hurtable=!1,this.putInPoolAvailable=!0,this.isHead&&(Game.currentGame.HOUSES||(Game.currentGame.HOUSES=[]),Game.currentGame.HOUSES.push(this),Game.currentGame&&Game.currentGame.callsOnFieldReady.indexOf(GingerHouseCell.onGameStart)<0&&Game.currentGame.callsOnFieldReady.push(GingerHouseCell.onGameStart)),this.onCollectPartListener=function(){})};GingerHouseCell.prototype=Object.create(BigCell.prototype),(GingerHouseCell.prototype.constructor=GingerHouseCell).find=function(e){if(Game.currentGame&&Game.currentGame.HOUSES)for(var t=0;t<Game.currentGame.HOUSES.length;t++)if(-1===Game.currentGame.HOUSES[t].collectedParts.indexOf(e)
)return Game.currentGame.HOUSES[t]},GingerHouseCell.onGameStart=function(){if(Game.currentGame){GingerHouseCell.createdParts=[0,0,0,0];for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var i=Game.currentGame.field.cells[t][e];if(void 0!==i){for(;i.innerCell;)i=i.innerCell;i instanceof GingerHousePartCell&&GingerHouseCell.createdParts[i.type]++}}}},GingerHouseCell.prototype.load=function(e){},GingerHouseCell.prototype.bundleId=function(){return"gingerbread_house"},GingerHouseCell.prototype.save=function(){return GingerHouseCell.CODES},GingerHouseCell.prototype.getViewClass=function(){return GingerHouseCellView},GingerHouseCell.prototype.getGoalId=function(){return GingerHouseCell.GOAL_ID},GingerHouseCell.prototype.collectPart=function(e){this.collectedParts.push(e.type),this.animatingParts++;var t=this.getFlyDuration(e);this.onCollectPartListener(e,t),Game.counter.setTimeout(function(){if(Game.currentGame){this.animatingParts--,
4===this.collectedParts.length&&0===this.animatingParts&&this.explode();for(var e=[],t=0;t<4;t++)GingerHouseCell.createdParts[t]<Game.currentGame.HOUSES.length&&e.push(t);if(e.length){var i=cleverapps.Random.choose(e);GingerHouseCell.createdParts[i]++,Game.currentGame.field.addNextCell(GingerHousePartCell.getCodeByType(i))}}}.bind(this),1e3*t)},GingerHouseCell.prototype.getFlyDuration=function(e){var t=e.y-(this.y+.5),i=e.x-(this.x+.5);return Math.sqrt(t*t+i*i+2)/6+Goals.UP_DURATION+Goals.WAIT_DURATION},GingerHouseCell.GOAL_ID="gingerhouse_cell";var GingerHousePartCell=function(e,t){BaseCell.call(this,e,t),this.movable=!0,this.hurtable=!1};GingerHousePartCell.prototype=Object.create(BaseCell.prototype),(GingerHousePartCell.prototype.constructor=GingerHousePartCell).prototype.load=function(e){switch(e[1]){case"^":this.type=GingerHousePartCell.TYPES.ROOF;break;case"&":this.type=GingerHousePartCell.TYPES.DOOR;break;case"*":this.type=GingerHousePartCell.TYPES.WINDOW;break;case"#":
this.type=GingerHousePartCell.TYPES.WALL}},GingerHousePartCell.getCodeByType=function(e){var t="";switch(e){case GingerHousePartCell.TYPES.ROOF:t="^";break;case GingerHousePartCell.TYPES.DOOR:t="&";break;case GingerHousePartCell.TYPES.WINDOW:t="*";break;case GingerHousePartCell.TYPES.WALL:t="#"}return GingerHousePartCell.CODES.concat(t)},GingerHousePartCell.prototype.save=function(){return GingerHousePartCell.getCodeByType(this.type)},GingerHousePartCell.prototype.getViewClass=function(){return GingerHousePartCellView},GingerHousePartCell.prototype.onBurnStage=function(){for(var e=this.y+1;e<Field.SIZE;e++)if(Game.currentGame.field.inField(e,this.x))return;this.explode()},GingerHousePartCell.prototype.explode=function(){if(this.alive){this.alive=!1,GingerHouseCell.find(this.type).collectPart(this);var e=this.explodeDuration();this.onBeforeExplodeListener(e),Game.counter.setTimeout(this.afterExplode.bind(this),1e3*e)}},GingerHousePartCell.EXPLODE_VIA_COLLECT_TIMEOUT=300,
GingerHousePartCell.TYPES={WALL:0,DOOR:1,WINDOW:2,ROOF:3};var CrabMakerCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1,this.hurtable=!1,this.stage=0,Game.currentGame.counter.fieldCounter.registerStage(217,CrabMakerCell.process),this.onChangeStage=function(e){}};CrabMakerCell.prototype=Object.create(BaseCell.prototype),(CrabMakerCell.prototype.constructor=CrabMakerCell).prototype.load=function(e){this.stage=parseInt(e[1])},CrabMakerCell.prototype.bundleId=function(){return["crab_maker"]},CrabMakerCell.prototype.save=function(){return CrabMakerCell.CODES.concat([this.stage])},CrabMakerCell.prototype.getViewClass=function(){return CrabMakerCellView},CrabMakerCell.prototype.makeCrab=function(){if(void 0!==Game.currentGame){var e=new CrabDecoratorCell(this.x,this.y);e.setInnerCell(this),e.createdByCrabMaker=!0,Game.currentGame.field.addCell(e),Game.currentGame.crabDecoratorCellCanProcess=!1}},CrabMakerCell.prototype.boom=function(e,t){this.skipProcess=!0},
CrabMakerCell.prototype.process=function(){this.stage===CrabMakerCell.STAGES_COUNT?this.stage=0:this.stage++,this.onChangeStage(function(){this.stage===CrabMakerCell.STAGES_COUNT&&this.makeCrab()}.bind(this))},CrabMakerCell.process=function(){if(Game.currentGame.crabMakerCellCanProcess){Game.currentGame.crabMakerCellCanProcess=!1;for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===CrabMakerCell&&(Game.currentGame.field.cells[e][t].skipProcess?Game.currentGame.field.cells[e][t].skipProcess=!1:Game.currentGame.field.cells[e][t].process())}},CrabMakerCell.STAGES_COUNT=3;var FireworkCell=function(e,t,i){SpecialColorCell.call(this,e,t,i),this.createType=void 0,this.totalDuration=0,this.onOutburstListener=function(e){},this.putInPoolAvailable=!0};FireworkCell.prototype=Object.create(SpecialColorCell.prototype),(FireworkCell.prototype.constructor=FireworkCell).prototype.editorComponents=function(){
return[BaseCellComponent,SwitchModeComponent]},FireworkCell.prototype.useCustomView=function(){return void 0===this.x},FireworkCell.prototype.getViewClass=function(){return FireworkCellView},FireworkCell.prototype.explode=function(e){this.createType===CreateTypes.CREATE_AGAIN_TYPE&&Game.currentGame.field.addNextCell(FireworkCell.CODES.concat([CreateTypes.CREATE_AGAIN_TYPE,"."])),BaseCell.prototype.explode.call(this,e)},FireworkCell.prototype.hurt=function(e){if(!(this.lives<1)&&this.alive){var n,t=CombosLibrary.helpers.classifyTargets();if(0<t.simple.length&&0<t.special.length)n=[cleverapps.Random.choose(t.simple),cleverapps.Random.choose(t.special)];else{var i=t.simple;0===i.length&&(i=t.special),i=cleverapps.Random.shuffle(i),n=i.slice(0,2)}n.forEach(function(e,t){e.prepareForBurn();var i=this.getFlyDuration(e),s=FireworkCell.HURT_DELAY+(t+1)*FireworkCell.ANIMATION_DURATION+i;this.totalDuration=Math.max(this.totalDuration,s),Game.counter.setTimeout(function(){e.hurt({id:t,
groupSize:n.length}),RugTile.hurtViaCombo(this,e)}.bind(this),1e3*s)}.bind(this)),this.onOutburstListener(n),this.hurtedCells=n.length,BaseCell.prototype.hurt.call(this,e)}},FireworkCell.prototype.getFlyDuration=function(e){var t=(Math.abs(e.x-this.x)+Math.abs(e.y-this.y))/FireworkCell.FLY_SPEED;return t=Math.max(t,FireworkCell.MIN_FLY_DURATION),t=Math.min(t,FireworkCell.MAX_FLY_DURATION)},FireworkCell.prototype.load=function(e){this.createType=e[1],this.color=e[2],"."===this.color&&(this.color=this.getRandomColor())},FireworkCell.prototype.save=function(){return FireworkCell.CODES.concat([this.createType,this.color])},FireworkCell.prototype.hurtDuration=function(){return 0===this.hurtedCells?0:FireworkCell.HURT_DELAY+this.hurtedCells*FireworkCell.ANIMATION_DURATION},FireworkCell.prototype.explodeDuration=function(){return this.totalDuration-this.hurtDuration()},FireworkCell.prototype.getGoalId=function(){return FireworkCell.GOAL_ID},FireworkCell.GOAL_ID="firework",
FireworkCell.HURT_DELAY=.3,FireworkCell.ANIMATION_DURATION=.4,FireworkCell.FLY_SPEED=10,FireworkCell.MIN_FLY_DURATION=.8,FireworkCell.MAX_FLY_DURATION=2.5;var CakeCell=function(e,t){if(BigCell.call(this,e,t,CakeCell)){this.lives=3,this.hurtable=!0;var i=e-this.head.x,s=t-this.head.y;this.part=i+2*s+1}else this.hurtable=!0};CakeCell.prototype=Object.create(BigCell.prototype),(CakeCell.prototype.constructor=CakeCell).prototype.bundleId=function(){return"cake"},CakeCell.prototype.getViewClass=function(){return CakeCellView},CakeCell.prototype.getGoalId=function(){return CakeCell.GOAL_ID},CakeCell.prototype.load=function(e){},CakeCell.prototype.save=function(){return CakeCell.CODES},CakeCell.prototype.boom=function(){this.hurt()},CakeCell.prototype.hurt=function(){if(0<this.lives){this.lives--;var e=Game.currentGame.goals.check(this,1,1);this.head.onChangeLivesListener(this,e),this.head.animate(BaseCell.ANIMATION_HURT),this.head.checkAlive()}},
CakeCell.prototype.onBeforeHurtViaBooster=function(e){if(!(0<this.lives)){for(var t=[],i=0;i<2;++i)for(var s=0;s<2;++s)if(i!==this.dx&&s!==this.dy){var n=Game.currentGame.field.cells[this.head.y+s][this.head.x+i];if(0<n.lives){if(-1!==e.indexOf(n))return;t.push(n)}}if(0!==t.length){var o=2,a=t[0];t.forEach(function(e){var t=Math.abs(this.x-e.x)+Math.abs(this.y-e.y);t<o&&(a=e,o=t)}.bind(this)),a.willBurn=!0,e.push(a)}}},CakeCell.prototype.checkAlive=function(){for(var e=!1,t=0;t<2;++t)for(var i=0;i<2;++i)0<Game.currentGame.field.cells[this.y+i][this.x+t].lives&&(e=!0);e||this.head.explode()},CakeCell.prototype.onHeadExplode=function(){BaseCell.prototype.explode.call(this)},CakeCell.prototype.editorComponents=function(){return this.isHead?[BaseCellComponent,BigCellComponent]:[BaseCellComponent]},CakeCell.GOAL_ID="cake_cell";var BurstCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1,Game.currentGame.counter.fieldCounter.registerStage(206,BurstCell.process),
this.onBurstListener=function(e){}};BurstCell.prototype=Object.create(BaseCell.prototype),(BurstCell.prototype.constructor=BurstCell).prototype.load=function(e){this.lives=parseInt(e[1])},BurstCell.prototype.bundleId=function(){return"burst"},BurstCell.prototype.save=function(){return BurstCell.CODES.concat([this.lives])},BurstCell.prototype.getViewClass=function(){return BurstCellView},BurstCell.prototype.hurt=function(){this.lives<1||(this.lives--,this.onChangeLivesListener())},BurstCell.prototype.boom=function(){this.hurt()},BurstCell.prototype.burstDuration=function(e,t){var i=e.x-this.x,s=e.y-this.y;return BurstCell.BURST_INTERVAL*t+Math.sqrt(i*i+s*s)/BurstCell.BURST_SPEED},BurstCell.prototype.processTo=function(e,t){BurstCell.changed[e.y][e.x]=!0,this.onBurstListener(e,t),Game.counter.setTimeout(function(){e.hurt()}.bind(this),1e3*this.burstDuration(e,t))},BurstCell.prototype.process=function(){if(Game.currentGame){var e,t,i=[];for(e=0;e<Field.SIZE;e++)for(t=0;t<Field.SIZE;t++
)if(!BurstCell.changed[e][t]&&Game.currentGame.field.cells[e][t]){var s=Game.currentGame.field.cells[e][t];!s.hurtable||s instanceof CandleCell&&s.state===CandleCell.STATE_ON||i.push(s)}if(0<i.length){var n=0;for(e=0;e<BurstCell.BURST_COUNT&&0<i.length;e++){var o=cleverapps.Random.random(i.length);this.processTo(i[o],e),n=Math.max(n,this.burstDuration(i[o])),i.splice(o,1)}this.animate(BaseCell.ANIMATION_OPEN),Game.counter.setTimeout(function(){this.lives=BurstCell.MAX_LIVES,this.onChangeLivesListener()}.bind(this),1e3*n)}}},BurstCell.process=function(){var e,t,i=[];for(e=0;e<Field.SIZE;e++)for(t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===BurstCell&&0===Game.currentGame.field.cells[e][t].lives&&i.push(Game.currentGame.field.cells[e][t]);if(0<i.length){for(BurstCell.changed=[],e=0;e<Field.SIZE;e++)for(BurstCell.changed.push([]),t=0;t<Field.SIZE;t++)BurstCell.changed.push(!1);for(e=0;e<i.length;e++)i[e].process()}},
BurstCell.BURST_COUNT=5,BurstCell.MAX_LIVES=4,BurstCell.BURST_SPEED=12,BurstCell.BURST_INTERVAL=.1;var DirtMakerCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1,this.hurtable=!1,this.stage=0,Game.currentGame.counter.fieldCounter.registerStage(207,DirtMakerCell.process),this.onChangeStage=function(e){},this.onShoot=function(e,t){}};DirtMakerCell.prototype=Object.create(BaseCell.prototype),(DirtMakerCell.prototype.constructor=DirtMakerCell).prototype.load=function(e){this.stage=parseInt(e[1])},DirtMakerCell.prototype.bundleId=function(){return["dirt_maker"]},DirtMakerCell.prototype.save=function(){return DirtMakerCell.CODES.concat([this.stage])},DirtMakerCell.prototype.getViewClass=function(){return DirtMakerCellView},DirtMakerCell.prototype.makeDirt=function(){var e,t,i=[];for(e=0;e<Field.SIZE;e++)for(t=0;t<Field.SIZE;t++){var s=Game.currentGame.field.cells[e][t];!s||-1!==DirtMakerCell.changedCells.indexOf(s
)||s.constructor!==ColorCell&&s.constructor!==GoalColorCell&&s.constructor!==HeroCell&&s.constructor!==HeroGoalCell&&s.constructor!==WaffleCell&&s.constructor!==LollipopCell||i.push(s)}if(0<i.length){var n=i[cleverapps.Random.random(i.length)];DirtMakerCell.changedCells.push(n);var o=n.x,a=n.y;this.stage=0,this.onShoot(o,a),Game.counter.setTimeout(function(){var e=new DirtDecoratorCell(o,a);e.setInnerCell(n),e.onCreate=!0,Game.currentGame.field.addCell(e),e.onCreateNew("up"),Game.currentGame.goals.typeInGoals(DirtDecoratorCell.GOAL_ID)&&Game.currentGame.goals.incTarget(DirtDecoratorCell.GOAL_ID,1,!0)}.bind(this),this.getMakeDirtDuration())}},DirtMakerCell.prototype.getMakeDirtDuration=function(){return 1950},DirtMakerCell.prototype.boom=function(e,t){this.skipProcess=!0},DirtMakerCell.prototype.process=function(){this.stage+1<DirtMakerCell.STAGES_COUNT?(this.stage++,this.onChangeStage()):this.makeDirt()},DirtMakerCell.process=function(){if(Game.currentGame.dirtMakerCellCanProcess){
Game.currentGame.dirtDecoratorCellCanProcess=!1,Game.currentGame.dirtMakerCellCanProcess=!1,DirtMakerCell.changedCells=[];for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===DirtMakerCell&&(Game.currentGame.field.cells[e][t].skipProcess?Game.currentGame.field.cells[e][t].skipProcess=!1:Game.currentGame.field.cells[e][t].process())}},DirtMakerCell.STAGES_COUNT=4;var WaffleCell=function(e,t,i){SpecialColorCell.call(this,e,t,i),this.putInPoolAvailable=!0};WaffleCell.prototype=Object.create(SpecialColorCell.prototype),(WaffleCell.prototype.constructor=WaffleCell).prototype.getViewClass=function(){return WaffleCellView},WaffleCell.prototype.getGoalId=function(){return WaffleCell.GOAL_ID},WaffleCell.prototype.bundleId=function(){return"waffle"},WaffleCell.prototype.explode=function(e){this.mark&&(this.mark.explode(),this.mark=void 0),this.explodeViaCollect(e)},WaffleCell.prototype.load=function(e){
this.color=e[1],"."===this.color&&(this.color=this.getRandomColor()),2<e.length&&this.addMark()},WaffleCell.prototype.save=function(){var e=WaffleCell.CODES.slice();return e.push(this.color),this.mark&&e.push(this.mark.code),e},WaffleCell.GOAL_ID="waffle";var TruffleCell=function(e,t,i){SpecialColorCell.call(this,e,t,i),this.lives=TruffleCell.LIVES,this.putInPoolAvailable=!0,this.onChangeLivesListener=function(){}};TruffleCell.prototype=Object.create(SpecialColorCell.prototype),(TruffleCell.prototype.constructor=TruffleCell).prototype.getViewClass=function(){return TruffleCellView},TruffleCell.prototype.getGoalId=function(){return TruffleCell.GOAL_ID},TruffleCell.prototype.bundleId=function(){return"truffle"},TruffleCell.prototype.repaint=function(){return this.colors=this.getRandomColors(this.lives),this.color=this.colors[0],this},TruffleCell.prototype.getRandomColors=function(e,t){for(var i=Game.currentGame.levelContent.colors.slice().filter(function(e){return!t||t&&e.toLowerCase(
)!==t.toLowerCase()}),s=0;s<i.length;s++)i[s]=i[s].toLowerCase();return i=cleverapps.Random.shuffle(i),t&&"."!==t?(i=i.splice(0,e-1)).unshift(t):i=i.splice(0,e),i},TruffleCell.prototype.hurt=function(e){this.lives<1||!this.alive||(this.lives--,0<this.lives?(this.onChangeLivesListener(),this.animate(BaseCell.ANIMATION_HURT),this.color=this.colors[this.colors.length-this.lives],Game.counter.setTimeout(function(){},1e3*this.hurtDuration())):this.explode(e))},TruffleCell.prototype.hurtDuration=function(){return.5},TruffleCell.prototype.explode=function(e){this.mark&&(this.mark.explode(),this.mark=void 0),this.explodeViaCollect(e)},TruffleCell.prototype.load=function(e){this.colors=this.getRandomColors(this.lives,e[1]),this.color=this.colors[0],"!"===e[e.length-1]&&this.addMark()},TruffleCell.prototype.save=function(){var e=TruffleCell.CODES.slice();return e.push(this.colors[0]),e.push("."),this.mark&&e.push(this.mark.code),e},TruffleCell.GOAL_ID="truffle",TruffleCell.LIVES=3
;var LollipopCell=function(e,t,i){SpecialColorCell.call(this,e,t,i),Game.currentGame.counter.fieldCounter.registerStage(208,LollipopCell.process),this.putInPoolAvailable=!0,this.onChangeColorListener=function(e,t){}};LollipopCell.prototype=Object.create(SpecialColorCell.prototype),(LollipopCell.prototype.constructor=LollipopCell).prototype.getGoalId=function(){return LollipopCell.GOAL_ID},LollipopCell.prototype.getViewClass=function(){return LollipopCellView},LollipopCell.prototype.bundleId=function(){return"lollipop"},LollipopCell.prototype.explode=function(e){this.mark&&(this.mark.explode(),this.mark=void 0),this.explodeViaCollect(e)},LollipopCell.prototype.smile=function(){this.alive&&!this.isForGoal&&this.animate(BaseCell.ANIMATION_SMILE)},LollipopCell.prototype.process=function(){for(var e=-1,t=0;t<Game.currentGame.levelContent.colors.length;t++){if(Game.currentGame.levelContent.colors[t].toLowerCase()===this.color){e=t;break}}var i=this.color;e=(e+1
)%Game.currentGame.levelContent.colors.length,this.color=Game.currentGame.levelContent.colors[e].toLowerCase(),this.onChangeColorListener(this,i);var s=cleverapps.settings.fpsMode===cleverapps.Settings.FPS_MODE_LOW?0:900;return Game.counter.setTimeout(function(){}.bind(this),s),this},LollipopCell.prototype.load=function(e){this.color=e[1],"."===this.color&&(this.color=this.getRandomColor()),2<e.length&&this.addMark()},LollipopCell.prototype.save=function(){var e=LollipopCell.CODES.slice();return e.push(this.color),this.mark&&e.push(this.mark.code),e},LollipopCell.process=function(){if(Game.currentGame.lollipopCellCanProcess){Game.currentGame.lollipopCellCanProcess=!1;for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var i=Game.currentGame.field.cells[e][t];i&&i.constructor===LollipopCell&&i.process()}}},LollipopCell.GOAL_ID="lollipop";var CandleCell=function(e,t){BaseCell.call(this,e,t),this.isForGoal=void 0===e,this.state=CandleCell.STATE_OFF,this.movable=!1,
this.onChangeStateListener=function(){},Game.currentGame&&Game.currentGame.callsOnFieldReady.indexOf(CandleCell.onGameStart)<0&&Game.currentGame.callsOnFieldReady.push(CandleCell.onGameStart),Game.currentGame&&Game.counter.fieldCounter.registerStage(150,CandleCell.applyIncGoal)};CandleCell.prototype=Object.create(BaseCell.prototype),(CandleCell.prototype.constructor=CandleCell).onGameStart=function(){for(var e=CandleCell.incDelta=0;e<Field.SIZE;++e)for(var t=0;t<Field.SIZE;++t){var i=Game.currentGame.field.cells[e][t];i&&i.constructor===CandleCell&&i.state===CandleCell.STATE_ON&&i.updateGoal(1)}},CandleCell.prototype.bundleId=function(){return"candle"},CandleCell.prototype.load=function(e){this.state=e[1]},CandleCell.prototype.save=function(){return CandleCell.CODES.concat([this.state])},CandleCell.prototype.getViewClass=function(){return CandleCellView},CandleCell.prototype.getGoalId=function(){return CandleCell.GOAL_ID},CandleCell.prototype.boom=function(){this.hurt()},
CandleCell.applyIncGoal=function(){0<CandleCell.incDelta&&Game.counter.goalSetTimeout(function(){Game.currentGame.goals.incGoal(CandleCell.GOAL_ID,CandleCell.incDelta,!0),CandleCell.incDelta=0}.bind(this),0)},CandleCell.prototype.updateGoal=function(e){Game.currentGame&&Game.currentGame.goals.typeInGoals(CandleCell.GOAL_ID)&&(e<0?Game.counter.goalSetTimeout(function(){Game.currentGame.goals.incGoal(CandleCell.GOAL_ID,e,!0)},0):CandleCell.incDelta+=e)},CandleCell.prototype.hurt=function(e){e=e||{},Game.currentGame.goals.isDone||this.wasHurt&&this.state===CandleCell.STATE_ON&&void 0!==e.boosterId||(this.wasHurt=!0,this.state===CandleCell.STATE_ON?(this.state=CandleCell.STATE_OFF,this.updateGoal(-1)):(this.state=CandleCell.STATE_ON,this.updateGoal(1)),this.onChangeStateListener())},CandleCell.prepare=function(){if(Game.currentGame)for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===CandleCell&&(
Game.currentGame.field.cells[e][t].wasHurt=!1)},CandleCell.STATE_ON="+",CandleCell.STATE_OFF="-",CandleCell.GOAL_ID="candle_cell";var BagDecoratorCell=function(e,t){DecoratorCell.call(this,e,t),this.hideInnerCell=!0};BagDecoratorCell.prototype=Object.create(DecoratorCell.prototype),(BagDecoratorCell.prototype.constructor=BagDecoratorCell).prototype.getViewClass=function(){return BagDecoratorCellView},BagDecoratorCell.prototype.smile=function(){this.alive&&this.animate(BaseCell.ANIMATION_SMILE)},BagDecoratorCell.prototype.load=function(e,t){e.shift(),this.color=e[0],e.shift(),"."===this.color&&(this.color=ColorCell.prototype.getRandomColor()),this.setInnerCell(t.loadNext(this.y,this.x,e))},BagDecoratorCell.prototype.save=function(){var e=BagDecoratorCell.CODES.slice();return e.push(this.color),e.concat(this.innerCell.save())},BagDecoratorCell.prototype.boom=function(e,t){t&&t.color===this.color&&this.boomHurt()},BagDecoratorCell.prototype.explodeDuration=function(){return 0},
BagDecoratorCell.prototype.bundleId=function(){return"bag"},BagDecoratorCell.prototype.getGoalId=function(){return BagDecoratorCell.GOAL_ID},BagDecoratorCell.GOAL_ID="bag_decorator";var ColorCookieManCell=function(e,t,i){"random"===i&&(i=this.getRandomColor()),SpecialColorCell.call(this,e,t,i),this.lives=1,this.movable=!0,this.hurtable=!0,this.putInPoolAvailable=!0,Game.currentGame.counter.fieldCounter.registerStage(209,ColorCookieManCell.processExit),Game.currentGame.counter.fieldCounter.registerStage(210,ColorCookieManCell.process)};ColorCookieManCell.prototype=Object.create(SpecialColorCell.prototype),(ColorCookieManCell.prototype.constructor=ColorCookieManCell).prepareToUp=function(){var e,t;if(Game.currentGame)for(ColorCookieManCell.amountToExit+=ColorCookieManCell.exitToNextMove,e=ColorCookieManCell.exitToNextMove=0;e<Field.SIZE;e++)for(t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===ColorCookieManCell&&(
Game.currentGame.field.cells[e][t].canUp=!0)},ColorCookieManCell.process=function(){if(Game.currentGame)for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===ColorCookieManCell&&Game.currentGame.field.cells[e][t].process()},ColorCookieManCell.processExit=function(){if(Game.currentGame&&ColorCookieManCell.amountToExit){for(var e=[],t=0;t<Field.SIZE;t++)for(var i=Field.SIZE-1;0<=i;i--)if(Game.currentGame.field.isCellInField(i,t)){var s=Game.currentGame.field.cells[i][t];s.canDelete()&&e.push(s);break}for(;0<ColorCookieManCell.amountToExit&&0<e.length;){var n=cleverapps.Random.random(e.length),o=e[n];e.splice(n,1),ColorCookieManCell.amountToExit--,o.delete(),new ColorCookieManCell(o.x,o.y,"random").processExit()}}},ColorCookieManCell.prototype.processExit=function(){Game.currentGame.field.addCell(this),this.canUp=!1,this.animate(BaseCell.ANIMATION_COOKIE_IN,function(){}.bind(this)),
Game.counter.fieldCounter.setTimeout(function(){}.bind(this),1300)},ColorCookieManCell.prototype.move=function(e,t){CookieManCell.prototype.move.apply(this,arguments)},ColorCookieManCell.prototype.beforeMoveByTransporter=function(e){CookieManCell.prototype.beforeMoveByTransporter.apply(this,arguments)},ColorCookieManCell.prototype.process=function(){if(this.canUp&&Game.currentGame){for(var e=this.x,t=this.y,i=!1,s=t-1;0<=s;s--)if(Game.currentGame.field.cells[s][e]){i=!0;break}if(i){if(!Game.currentGame.field.cells[t-1][e])return;if(!Game.currentGame.field.cells[t-1][e].movable)return;if(Game.currentGame.field.cells[t-1][e].constructor===ColorCookieManCell||Game.currentGame.field.cells[t-1][e].constructor===CookieManCell)return;if(!1===Game.currentGame.field.barriers.canMove(t,e,t-1,e))return;var n=Game.currentGame.field.cells[t-1][e];this.canUp=!1,this.y=t-1;var o=!1;this.animate(BaseCell.ANIMATION_COOKIE_UP,function(){o||(this.onFinishMoveListener({x:this.x,y:this.y},{}),o=!0)}.bind(
this)),Game.counter.fieldCounter.setTimeout(function(){n.move({x:e,y:t},{moveInterval:.1})}.bind(this),500),Game.counter.fieldCounter.setTimeout(function(){o||(this.onFinishMoveListener({x:this.x,y:this.y},{}),o=!0),Game.currentGame.field.cells[t][e]=n,Game.currentGame.field.cells[t-1][e]=this}.bind(this),1e3)}else{if(!1===Game.currentGame.field.barriers.canMove(t,e,t-1,e))return;this.canUp=!1,0<Game.currentGame.moves&&Game.currentGame.setMoves(Game.currentGame.moves-1,{delay:300}),this.animate(BaseCell.ANIMATION_COOKIE_OUT,function(){}.bind(this)),Game.counter.fieldCounter.setTimeout(function(){Game.currentGame&&(this.delete(),Game.currentGame.field.cells[t][e]=void 0,ColorCookieManCell.exitToNextMove++)}.bind(this),1300)}}},ColorCookieManCell.prototype.getViewClass=function(){return ColorCookieManCellView},ColorCookieManCell.prototype.bundleId=function(){return"colorcookieman"},ColorCookieManCell.prototype.load=function(e){this.color=e[1],"."===this.color&&(
this.color=this.getRandomColor())},ColorCookieManCell.prototype.smile=function(){this.alive&&this.animate(BaseCell.ANIMATION_SMILE)},ColorCookieManCell.prototype.save=function(){return ColorCookieManCell.CODES.concat([this.color])},ColorCookieManCell.prototype.explode=function(e){this.explodeViaCollect(e)},ColorCookieManCell.prototype.getGoalId=function(){return ColorCookieManCell.GOAL_ID},ColorCookieManCell.GOAL_ID="color_cookie_man";var ColorBombCell=function(e,t){SpecialColorCell.call(this,e,t),this.createType=void 0,this.onChangeLivesListener=function(){},this.putInPoolAvailable=!0};ColorBombCell.prototype=Object.create(SpecialColorCell.prototype),(ColorBombCell.prototype.constructor=ColorBombCell).prototype.bundleId=function(){return"color_bomb"},ColorBombCell.prototype.getViewClass=function(){return ColorBombCellView},ColorBombCell.prototype.editorComponents=function(){return[BaseCellComponent,SwitchModeComponent,FireflyJarComponent]},
ColorBombCell.prototype.boomNeighbors=function(e){},ColorBombCell.prototype.hurt=function(e){this.lives<1||!this.alive||(this.animate(BaseCell.ANIMATION_HURT),this.lives--,this.lives<=0?this.explode(e):Game.counter.setTimeout(function(){this.onChangeLivesListener()}.bind(this),1e3*this.hurtDuration()))},ColorBombCell.prototype.hurtDuration=function(){return.5},ColorBombCell.prototype.explodeDuration=function(){return 1},ColorBombCell.prototype.getMaxLives=function(){return 3},ColorBombCell.prototype.explode=function(e){Game.counter.setTimeout(function(){this.mark&&(this.mark.explode(),this.mark=void 0),this.createType===CreateTypes.CREATE_AGAIN_TYPE&&Game.currentGame.field.addNextCell(ColorBombCell.CODES.concat([this.maxLives,".",CreateTypes.CREATE_AGAIN_TYPE])),BaseCell.prototype.explode.call(this,e)}.bind(this),1e3*this.explodeDuration()),Game.counter.setTimeout(function(){for(var e=Game.currentGame.field,i=[],t=[],s=this.y-1;s<=this.y+1;s++)for(var n=this.x-1;n<=this.x+1;n++)if((
s!==this.y||n!==this.x)&&0<=s&&s<Field.SIZE&&0<=n&&n<Field.SIZE){var o=e.cells[s][n];o&&this.isCellAllowed(o)&&e.isCellInField(s,n)&&o.alive&&0!==o.lives&&o.hurtable&&i.push(o),o?t.push(o):t.push(new BaseCell(n,s))}i.forEach(function(e,t){e.hurt({id:t,groupSize:i.length})}),t.forEach(function(e){RugTile.hurtViaCombo(this,e)}.bind(this))}.bind(this),800)},ColorBombCell.prototype.isCellAllowed=function(e){var t=e.constructor;return t!==MouseCell&&t!==DogCell&&t!==BlanketCell},ColorBombCell.prototype.load=function(e){this.maxLives=this.lives=parseInt(e[1]),this.color=e[2],"."===this.color&&(this.color=this.getRandomColor()),this.createType=e[3],"!"===e[e.length-1]&&this.addMark()},ColorBombCell.prototype.save=function(){var e=ColorBombCell.CODES.concat([this.lives,this.color,this.createType]);return this.mark&&e.push(this.mark.code),e};var FireflyJarCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1,this.onFlyToGoalListener=function(){}};FireflyJarCell.prototype=Object.create(
BaseCell.prototype),(FireflyJarCell.prototype.constructor=FireflyJarCell).prototype.load=function(e){this.lives=parseInt(e[1])},FireflyJarCell.prototype.save=function(){return FireflyJarCell.CODES.concat([this.lives])},FireflyJarCell.prototype.getViewClass=function(){return FireflyJarCellView},FireflyJarCell.prototype.editorComponents=function(){return[BaseCellComponent,FireflyJarComponent]},FireflyJarCell.prototype.getGoalId=function(){return FireflyJarCell.GOAL_ID},FireflyJarCell.prototype.boom=function(){this.hurt()},FireflyJarCell.prototype.hurt=function(e){this.lives<1||!this.alive||(this.lives--,this.animate(BaseCell.ANIMATION_HURT),Game.currentGame&&Game.currentGame.goals.typeInGoals(FireflyJarCell.GOAL_ID)&&this.onFlyToGoalListener(),Game.counter.setTimeout(function(){this.lives<=0&&this.explode(e)}.bind(this),1e3*this.hurtDuration()))},FireflyJarCell.prototype.hurtDuration=function(){return 1.2},FireflyJarCell.prototype.getMaxLives=function(){return 9},
FireflyJarCell.prototype.bundleId=function(){return"firefly_jar"},FireflyJarCell.GOAL_ID="firefly_jar_cell";var DirtyHoneyDecoratorCell=function(e,t){DecoratorCell.call(this,e,t),this.putInPoolAvailable=!0,this.onCreateNew=function(){}};DirtyHoneyDecoratorCell.prototype=Object.create(DecoratorCell.prototype),(DirtyHoneyDecoratorCell.prototype.constructor=DirtyHoneyDecoratorCell).prototype.getViewClass=function(){return DirtyHoneyDecoratorCellView},DirtyHoneyDecoratorCell.prototype.save=function(){return DirtyHoneyDecoratorCell.CODES.concat(this.innerCell.save())},DirtyHoneyDecoratorCell.prototype.getColor=function(){return this.innerCell.getColor()},DirtyHoneyDecoratorCell.prototype.showUpDuration=function(){return.5},DirtyHoneyDecoratorCell.prototype.explodeDuration=function(){return.5},DirtyHoneyDecoratorCell.prototype.onExplode=function(){DecoratorCell.prototype.onExplode.call(this),Game.currentGame.dirtyHoneyTileCanProcess=!1};var ColorContainerCell=function(e,t){BaseCell.call(this
,e,t),this.lives=2,this.movable=!0,this.putInPoolAvailable=!0,this.onSetColor=function(){}};ColorContainerCell.prototype=Object.create(BaseCell.prototype),(ColorContainerCell.prototype.constructor=ColorContainerCell).prototype.boom=function(e,t){var i=t&&t.getColor()||this.getRandomColor();this.boomColor?this.boomColor===i&&this.hurt():(this.boomColor=i,this.onSetColor(this.boomColor),this.hurt())},ColorContainerCell.prototype.hurt=function(e){this.boomColor||(this.boomColor=this.getRandomColor(),this.onSetColor(this.boomColor)),BaseCell.prototype.hurt.call(this,e)},ColorContainerCell.prototype.explode=function(e){this.explodeViaCollect(e)},ColorContainerCell.prototype.getViewClass=function(){return ColorContainerCellView},ColorContainerCell.prototype.bundleId=function(){return"color_container"},ColorContainerCell.prototype.getGoalId=function(){return ColorContainerCell.GOAL_ID},ColorContainerCell.prototype.hurtDuration=function(){return.7},ColorContainerCell.prototype.load=function(e
){},ColorContainerCell.prototype.save=function(){return ColorContainerCell.CODES},ColorContainerCell.GOAL_ID="color_container";var IceMakerCell=function(e,t){BaseCell.call(this,e,t),this.movable=!0,this.sticky=!0,this.lives=10,Game.currentGame&&-1===Game.currentGame.callsOnFieldReady.indexOf(IceMakerCell.onGameStart)&&Game.currentGame.callsOnFieldReady.push(IceMakerCell.onGameStart),Game.currentGame.counter.fieldCounter.registerStage(212,IceMakerCell.process),this.onChangeLivesListener=function(){}};IceMakerCell.prototype=Object.create(BaseCell.prototype),(IceMakerCell.prototype.constructor=IceMakerCell).prototype.bundleId=function(){return["ice_maker","ice"]},IceMakerCell.prototype.getGoalId=function(){return IceMakerCell.GOAL_ID},IceMakerCell.prototype.editorComponents=function(){return[BaseCellComponent,ColorBombCellComponent]},IceMakerCell.prototype.load=function(e){if(1<e.length){var t=e.splice(1).join("");this.lives=parseInt(t)}},IceMakerCell.prototype.save=function(){
var e=""+this.lives;return IceMakerCell.CODES.concat(e.split(""))},IceMakerCell.prototype.getViewClass=function(){return IceMakerCellView},IceMakerCell.prototype.boom=function(e,t){this.hurt()},IceMakerCell.prototype.hurt=function(){this.skipProcess=!0,BaseCell.prototype.hurt.call(this)},IceMakerCell.prototype.explode=function(e){Game.currentGame.goals.typeInGoals(IceMakerCell.GOAL_ID)?this.explodeViaCollect(e):BaseCell.prototype.explode.call(this,e)},IceMakerCell.prototype.process=function(){var e,s=Game.currentGame.field,n=this.x,o=this.y,a=[],r=[];BaseCell.neighbors.forEach(function(e){var t=n+e.x,i=o+e.y;if(s.isCellInField(i,t)&&!IceMakerCell.USED_CELLS[i+"_"+t]&&s.cells[i][t].movable&&!s.cells[i][t].controlDisabled&&!this.isProhibited(s.cells[i][t])){if(!1===Game.currentGame.field.barriers.canMove(o,n,i,t))return;void 0===s.floor[i][t]||s.floor[i][t]instanceof TransporterTile?a.push(s.cells[i][t]):s.floor[i][t]instanceof IceTile&&r.push(s.cells[i][t])}}.bind(this)),
0<a.length?e=cleverapps.Random.choose(a):0<r.length&&(e=cleverapps.Random.choose(r)),e&&(IceMakerCell.USED_CELLS[e.y+"_"+e.x]=!0,this.moveTo(e))},IceMakerCell.prototype.moveDuration=function(){return.2},IceMakerCell.prototype.createIceDuration=function(){return.8},IceMakerCell.prototype.cellMoveDelay=function(){return.1},IceMakerCell.prototype.moveTo=function(e){var t=this.x,i=this.y,s=e.x,n=e.y,o=void 0===Game.currentGame.field.floor[i][t];this.x=s,this.y=n,this.animate(BaseCell.ANIMATION_ICE_MAKER_MOVE,{iceAnimation:o,callback:function(){this.onFinishMoveListener({x:this.x,y:this.y},{}),o&&BaseCell.prototype.hurt.call(this)}.bind(this),dir:{x:s-t,y:n-i}});var a=this.moveDuration()+(o?this.createIceDuration():0);Game.counter.setTimeout(function(){e.move({x:t,y:i},{moveInterval:.1})}.bind(this),1e3*(this.cellMoveDelay()+(o?this.createIceDuration():0))),Game.counter.setTimeout(function(){this.move({x:s,y:n},{moveInterval:this.moveDuration()}),o&&this.createIceTile({x:t,y:i})}.bind(this)
,1e3*(o?this.createIceDuration():0)),Game.counter.setTimeout(function(){Game.currentGame.field.cells[i][t]=e,Game.currentGame.field.cells[n][s]=this}.bind(this),1e3*a)},IceMakerCell.prototype.createIceTile=function(e){var t=new IceTile(e.x,e.y);Game.currentGame.field.addTile(t),t.onCreateNew(),Game.counter.setTimeout(function(){},1e3*t.showUpDuration()),IceMakerCell.requiredIceAmount<1?Game.counter.goalSetTimeout(function(){if(Game.currentGame&&Game.currentGame.goals.typeInGoals(IceTile.GOAL_ID)){var e=Game.currentGame.goals.elements[IceTile.GOAL_ID];e.target++,e.onChangedListener(e.amount),e.checkIncompleted()}},1e3*t.showUpDuration()):IceMakerCell.requiredIceAmount--},IceMakerCell.prototype.isProhibited=function(e){for(var t=0;t<IceMakerCell.PROHIBITED_CELLS.length;t++)if(e instanceof IceMakerCell.PROHIBITED_CELLS[t])return!0;return!1},IceMakerCell.PROHIBITED_CELLS=[ColorCookieManCell,CookieManCell,IceMakerCell],IceMakerCell.process=function(){if(
Game.currentGame&&Game.currentGame.iceMakerCellCanProcess){Game.currentGame.iceMakerCellCanProcess=!1,IceMakerCell.USED_CELLS={};for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===IceMakerCell&&(Game.currentGame.field.cells[e][t].skipProcess?Game.currentGame.field.cells[e][t].skipProcess=!1:Game.currentGame.field.cells[e][t].process())}},IceMakerCell.onGameStart=function(){if(Game.currentGame&&Game.currentGame.goals.typeInGoals(IceTile.GOAL_ID)){for(var e=0,t=0;t<Field.SIZE;t++)for(var i=0;i<Field.SIZE;i++)Game.currentGame.field.floor[t][i]&&Game.currentGame.field.floor[t][i]instanceof IceTile&&e++;IceMakerCell.requiredIceAmount=Game.currentGame.goals.elements[IceTile.GOAL_ID].target-e}},IceMakerCell.GOAL_ID="ice_maker";var SharkCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1,this.lives=SharkCell.MAX_LIVES,this.putInPoolAvailable=!0,Game.currentGame.counter.fieldCounter.registerStage(
213,SharkCell.process),Game.currentGame&&-1===Game.currentGame.callsOnFieldReady.indexOf(SharkCell.onGameStart)&&Game.currentGame.callsOnFieldReady.push(SharkCell.onGameStart)};SharkCell.prototype=Object.create(BaseCell.prototype),(SharkCell.prototype.constructor=SharkCell).prototype.load=function(e){},SharkCell.prototype.bundleId=function(){return"shark"},SharkCell.prototype.save=function(){return SharkCell.CODES},SharkCell.prototype.getViewClass=function(){return SharkCellView},SharkCell.prototype.hurt=function(){this.alive&&(this.alive=!1,this.onDisappear(),Game.counter.setTimeout(function(){this.deleteSelf()}.bind(this),1e3))},SharkCell.prototype.boom=function(){this.hurt()},SharkCell.isProhibited=function(e){return-1!==[IceCreamMakerCell,CandleCell,DirtMakerCell,DonutBoxCell].indexOf(e.constructor)},SharkCell.prototype.deleteSelf=function(){SharkCell.appearAmountNext++,this.delete(),Game.currentGame&&Game.currentGame.field&&(Game.currentGame.field.cells[this.y][this.x]=void 0)},
SharkCell.getVariants=function(){for(var e=[],t=0;t<Field.SIZE;t++)for(var i=0;i<Field.SIZE;i++){var s=Game.currentGame.field.cells[t][i];if(Game.currentGame.field.isCellInField(t,i)&&s.canDelete()){for(var n=!0,o=0;o<BaseCell.neighbors.length;o++){var a=BaseCell.neighbors[o].x+s.x,r=BaseCell.neighbors[o].y+s.y;if(!Game.currentGame.field.isCellInField(r,a)){n=!1;break}var l=Game.currentGame.field.cells[r][a];if(SharkCell.isProhibited(l)||!l.movable||!l.getColor()){n=!1;break}}n&&e.push(s)}}return e},SharkCell.create=function(e){e.delete();var t=new SharkCell(e.x,e.y);Game.currentGame.field.addCell(t),t.onCreateNew(),Game.counter.fieldCounter.setTimeout(function(){},700),SharkCell.appearAmount--},SharkCell.prototype.hurtDuration=function(){return.8},SharkCell.prototype.flyDuration=function(){return 1.8},SharkCell.prototype.process=function(){this.lives--,0<this.lives?(this.onChangeLivesListener(),Game.counter.setTimeout(function(){},1e3*this.hurtDuration())):(this.onTakeMove(function(){
Game.currentGame&&0<Game.currentGame.moves&&Game.currentGame.setMoves(Game.currentGame.moves-1,{delay:300}),this.deleteSelf()}.bind(this)),Game.counter.setTimeout(function(){}.bind(this),1e3*this.flyDuration()))},SharkCell.process=function(){if(Game.currentGame.sharkCellCanProcess){Game.currentGame.sharkCellCanProcess=!1;for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var i=Game.currentGame.field.cells[e][t];i&&i.constructor===SharkCell&&i.process()}for(var s=SharkCell.getVariants();0<SharkCell.appearAmount&&0<s.length;){var n=cleverapps.Random.random(s.length);SharkCell.create(s[n]),s.splice(n,1)}}},SharkCell.prepareToProcess=function(){SharkCell.appearAmount+=SharkCell.appearAmountNext,SharkCell.appearAmountNext=0},SharkCell.onGameStart=function(){SharkCell.appearAmount=SharkCell.appearAmountNext=0},SharkCell.MAX_LIVES=3;var MovesCell=function(e,t){BaseCell.call(this,e,t),this.lives=1,this.moves=1,this.movable=!0};MovesCell.prototype=Object.create(BaseCell.prototype),(
MovesCell.prototype.constructor=MovesCell).prototype.bundleId=function(){return"moves_cell"},MovesCell.prototype.editorComponents=function(){return[BaseCellComponent,MovesCellComponent]},MovesCell.prototype.load=function(e){var t=e.splice(1).join("");this.moves=parseInt(t)},MovesCell.prototype.save=function(){var e=""+this.moves;return MovesCell.CODES.concat(e.split(""))},MovesCell.prototype.getViewClass=function(){return MovesCellView},MovesCell.prototype.boom=function(){this.hurt()},MovesCell.prototype.explodeDuration=function(){return.8};var GumDecoratorCell=function(e,t){DecoratorCell.call(this,e,t),this.onSetBorders=function(){},Game.currentGame.counter.fieldCounter.registerStage(218,GumDecoratorCell.adjustBordersForAll)};GumDecoratorCell.prototype=Object.create(DecoratorCell.prototype),(GumDecoratorCell.prototype.constructor=GumDecoratorCell).prototype.getViewClass=function(){return GumDecoratorCellView},GumDecoratorCell.prototype.load=function(e,t){e.shift(),0<="23".indexOf(e[0]
)&&(this.lives=parseInt(e[0]),e.shift()),this.setInnerCell(t.loadNext(this.y,this.x,e))},GumDecoratorCell.prototype.save=function(){var e=GumDecoratorCell.CODES;return 1<this.lives&&(e=e.concat(this.lives)),e.concat(this.innerCell.save())},GumDecoratorCell.prototype.boom=function(){this.boomHurt()},GumDecoratorCell.prototype.onExplode=function(){Game.currentGame.goals.inGoals(this)&&Game.counter.goalSetTimeout(function(){},500),DecoratorCell.prototype.onExplode.call(this)},GumDecoratorCell.prototype.hurt=function(e){DecoratorCell.prototype.hurt.apply(this,arguments),Game.currentGame.counter.setTimeout(this.adjustNeighborsBorders.bind(this),1e3*this.hurtDuration())},GumDecoratorCell.prototype.hurtDuration=function(){return 0<this.lives?.3:0},GumDecoratorCell.prototype.explode=function(e){Game.currentGame.goals.inGoals(this)?BaseCell.prototype.explodeViaCollect.call(this):BaseCell.prototype.explode.call(this)},GumDecoratorCell.prototype.getNeighbors=function(){if(
!Game.currentGame||!Game.currentGame.field)return[];var e=Game.currentGame.field.cells,t={};for(var i in GumDecoratorCell.DIRECTIONS){var s=GumDecoratorCell.DIRECTIONS[i],n=e[this.y+s.y]?e[this.y+s.y][this.x+s.x]:void 0;n&&n.constructor===GumDecoratorCell&&0<n.lives&&(t[i]=n)}return t},GumDecoratorCell.prototype.getBordersDirections=function(){var i=this.getNeighbors();return Object.keys(GumDecoratorCell.DIRECTIONS).filter(function(e){var t=i[e];return!t||t.lives!==this.lives}.bind(this))},GumDecoratorCell.prototype.adjustNeighborsBorders=function(){cleverapps.values(this.getNeighbors()).forEach(function(e){e.onSetBorders()})},GumDecoratorCell.onLevelLoad=function(){this.adjustBordersForAll()},GumDecoratorCell.adjustBordersForAll=function(){for(var e=Game.currentGame.field.cells,t=0;t<e.length;t++)for(var i=0;i<e.length;i++){var s=e[t][i];s&&s.constructor===GumDecoratorCell&&s.onSetBorders()}},GumDecoratorCell.prototype.getGoalId=function(){return GumDecoratorCell.GOAL_ID},
GumDecoratorCell.GOAL_ID="gum",GumDecoratorCell.UP="U",GumDecoratorCell.RIGHT="R",GumDecoratorCell.DOWN="D",GumDecoratorCell.LEFT="L",GumDecoratorCell.DIRECTIONS={},GumDecoratorCell.DIRECTIONS[GumDecoratorCell.UP]={x:0,y:-1},GumDecoratorCell.DIRECTIONS[GumDecoratorCell.DOWN]={x:0,y:1},GumDecoratorCell.DIRECTIONS[GumDecoratorCell.LEFT]={x:-1,y:0},GumDecoratorCell.DIRECTIONS[GumDecoratorCell.RIGHT]={x:1,y:0};var ClockCell=function(e,t){BigCell.call(this,e,t,ClockCell),this.hurtable=!0,this.isHead&&(this.colors=["a","b","c","d","e","w"],this.lives=this.colors.length)};ClockCell.prototype=Object.create(BigCell.prototype),(ClockCell.prototype.constructor=ClockCell).prototype.bundleId=function(){return"clock"},ClockCell.prototype.getViewClass=function(){return ClockCellView},ClockCell.prototype.boom=function(e,t){this.head.hurt(void 0,t)},ClockCell.prototype.hurt=function(e,t){if(this.isHead){if(0<this.lives){var i=t&&t.getColor();if(i&&this.colors[0]!==i)return;this.colors.shift(),
this.lives--;var s=Game.currentGame.goals.check(this,1,1);this.onChangeLivesListener(s),Game.counter.setTimeout(function(){this.lives<1&&this.head.explode()}.bind(this),1e3*this.hurtDuration())}}else this.head.hurt(e,t)},ClockCell.prototype.onHeadExplode=function(){BaseCell.prototype.explode.call(this)},ClockCell.prototype.hurtDuration=function(){return 1},ClockCell.prototype.getMaxLives=function(){return 8},ClockCell.prototype.editorComponents=function(){return this.isHead?[BaseCellComponent,BigCellComponent,ClockCellComponentCreator]:[BaseCellComponent]},ClockCell.prototype.load=function(e){this.isHead&&(this.colors=e.slice(1,e.length),this.lives=this.maxLives=this.colors.length)},ClockCell.prototype.save=function(){return this.isHead?ClockCell.CODES.concat(cleverapps.values(this.colors)):ClockCell.CODES},ClockCell.prototype.getGoalId=function(){return ClockCell.GOAL_ID},ClockCell.GOAL_ID="clock";var SmallPetardCell=function(e,t){BaseCell.call(this,e,t),
Game.currentGame.counter.fieldCounter.registerStage(301,SmallPetardCell.process),this.onChangeLivesListener=function(){},this.onBlowUpListener=function(){},this.onShowUpListener=function(){}};SmallPetardCell.prototype=Object.create(BaseCell.prototype),(SmallPetardCell.prototype.constructor=SmallPetardCell).prototype.bundleId=function(){return"small_petard"},SmallPetardCell.prototype.getViewClass=function(){return SmallPetardCellView},SmallPetardCell.prototype.editorComponents=function(){return[BaseCellComponent,LiveLineComponent]},SmallPetardCell.prototype.boom=function(e,t){this.hurt(void 0,t)},SmallPetardCell.prototype.hurt=function(e,t){this.lives<1||!this.alive||t&&t.getColor()!==this.color||(t||(Game.currentGame.smallPetardCellCanProcess=!0),this.lives--,Game.counter.setTimeout(function(){this.onChangeLivesListener(),this.lives<1&&this.alive&&(Game.currentGame.smallPetardCellCanProcess=!0,this.alive=!1,this.blowUp())}.bind(this),1e3*this.hurtDuration()))},
SmallPetardCell.prototype.hurtDuration=function(){return.65},SmallPetardCell.prototype.getMaxLives=function(){return 9},SmallPetardCell.prototype.blowUp=function(){BaseCell.neighbors.forEach(function(e){var i=[];this.iterateLineOfFire(this.x+e.x,this.y+e.y,e,function(e){i.push(e)});var t=[];this.iterateLineOfFire(this.x+e.x,this.y+e.y,e,function(e){t.push(e)},!0),i.forEach(function(e,t){e.hover(!1),e.hurt({id:t,groupSize:i.length})}),this.onBlowUpListener(i.length,e),t.forEach(function(e){RugTile.hurtViaCombo(this,e)}.bind(this))}.bind(this)),Game.counter.setTimeout(function(){}.bind(this),1500)},SmallPetardCell.prototype.process=function(){this.lives<1&&(this.lives=this.maxLives,this.alive=!0,this.onChangeLivesListener(),this.onShowUpListener())},SmallPetardCell.process=function(){if(Game.currentGame.smallPetardCellCanProcess){Game.currentGame.smallPetardCellCanProcess=!1;for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var i=Game.currentGame.field.cells[e][t]
;i&&i instanceof SmallPetardCell&&i.process()}}},SmallPetardCell.prototype.load=function(e){this.lives=this.maxLives=parseInt(e[1]),this.color=e[2],"."===this.color&&(this.color=ColorCell.prototype.getRandomColor.call(this))},SmallPetardCell.prototype.save=function(){return SmallPetardCell.CODES.concat([this.lives,this.color])};var CannonCell=function(e,t){BaseCell.call(this,e,t),Game.currentGame.counter.fieldCounter.registerStage(302,CannonCell.process),this.onChangeLivesListener=function(){},this.onTurnListener=function(){},this.onFireListener=function(){}};CannonCell.prototype=Object.create(BaseCell.prototype),(CannonCell.prototype.constructor=CannonCell).prototype.bundleId=function(){return"cannon"},CannonCell.prototype.editorComponents=function(){return[BaseCellComponent,LiveLineComponent,CannonCellComponent]},CannonCell.prototype.load=function(e){this.lives=this.maxLives=parseInt(e[1]),this.currDir=parseInt(e[2]),this.clockwise=!!parseInt(e[3]);var t=parseInt(e.splice(4).join("")
);this.dirs=[];for(var i=0;i<Object.keys(BaseCell.DIRECTIONS).length;i++)t&1<<i&&this.dirs.push(i)},CannonCell.prototype.save=function(){for(var e=CannonCell.CODES.concat([this.lives,this.currDir,this.clockwise?1:0]),t=0,i=0;i<this.dirs.length;i++)t|=1<<this.dirs[i];return e.concat(t.toString().split(""))},CannonCell.prototype.getViewClass=function(){return CannonCellView},CannonCell.prototype.boom=function(e,t){this.hurt(void 0,t)},CannonCell.prototype.hurt=function(e,t){this.lives<1||!this.alive||(this.lives--,this.onChangeLivesListener(),Game.counter.setTimeout(function(){0===this.lives&&this.fire()}.bind(this),1e3*this.hurtDuration()))},CannonCell.prototype.fire=function(){var t=[];this.iterateLineOfFire(this.x+BaseCell.DIRECTIONS[this.currDir].x,this.y+BaseCell.DIRECTIONS[this.currDir].y,BaseCell.DIRECTIONS[this.currDir],function(e){t.push(e)},!0),t=t.slice(0,t.map(function(e){return e.constructor===BaseCell}).lastIndexOf(!1)+1),this.hasFired=!0,t.forEach(function(e,t){
Game.counter.setTimeout(function(){e&&e.alive&&e.hurtable&&e.hurt({id:t,groupSize:1}),RugTile.hurtViaCombo(this,e)}.bind(this),t*CannonCell.timeFlyOneCellSec*1e3)}.bind(this)),Game.counter.setTimeout(function(){}.bind(this),1e3*(t.length*CannonCell.timeFlyOneCellSec+this.fireDuration())),this.onFireListener(t.length)},CannonCell.prototype.fireDuration=function(){return.5},CannonCell.prototype.hurtDuration=function(){return.5},CannonCell.prototype.chooseDirection=function(){var e=this.currDir;do{var t=this.getNextDir(this.clockwise);if(this.isViableDirection(t))return this.currDir=e,t;this.currDir=t}while(t!==e);return this.currDir=e},CannonCell.prototype.turn=function(){var e=this.chooseDirection();void 0!==e&&(this.currDir=e,this.onTurnListener(),Game.counter.setTimeout(function(){},500)),this.lives=this.maxLives,this.onChangeLivesListener()},CannonCell.prototype.getNextDir=function(e){var t=this.dirs.length,i=this.dirs.indexOf(this.currDir);return this.dirs[(i+(e?1:-1)+t)%t]},
CannonCell.prototype.isViableDirection=function(e){var t=!1;return e=BaseCell.DIRECTIONS[e],this.iterateLineOfFire(this.x+e.x,this.y+e.y,e,function(e){e&&e.alive&&e.hurtable&&(t=!0)}),t},CannonCell.prototype.process=function(){this.hasFired&&(this.hasFired=!1,this.turn())},CannonCell.process=function(){if(Game.currentGame.cannonCellCanProcess){Game.currentGame.cannonCellCanProcess=!1;for(var e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var i=Game.currentGame.field.cells[t][e];i&&i instanceof CannonCell&&i.process()}}},CannonCell.prototype.getMaxLives=function(){return 9},CannonCell.timeFlyOneCellSec=.2;var WallCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1,this.hurtable=!1};WallCell.prototype=Object.create(BaseCell.prototype),(WallCell.prototype.constructor=WallCell).prototype.hurt=function(){},WallCell.prototype.load=function(){},WallCell.prototype.save=function(){return WallCell.CODES},WallCell.prototype.getViewClass=function(){return WallCellView},
WallCell.prototype.bundleId=function(){return"wall"};var SpecialShapeCell=function(e,t,i){BaseCell.call(this,e,t),this.movable=!1,this.hurtable=!1,this.cellClass=i,this.headExploded=!1,this.isForGoal=void 0===e,this.isForEditor=-1===e,this.isForGoal||this.isForEditor||(Game.currentGame.HEADS||(Game.currentGame.HEADS=[]),this.isHovered=!1)};SpecialShapeCell.prototype=Object.create(BaseCell.prototype),(SpecialShapeCell.prototype.constructor=SpecialShapeCell).prototype.editorComponents=function(){if(this.isHead)return[BaseCellComponent,SpecialShapeCellComponent]},SpecialShapeCell.prototype.load=function(e){if(1<e.length){this.initConfig(e[1],parseInt(e[2]));var t,i,s=e.splice(3).join("");this.lives=parseInt(s);for(var n=!((this.head=this).isHead=!0),o=0;o<this.getSize().rows&&!n;o++)for(var a=0;a<this.getSize().cols&&!n;a++)1===this.config[o][a]&&(t=a,i=o,n=!0);this.head.topLeftX=this.head.x-t,this.head.topLeftY=this.head.y-i,this.isForGoal||this.isForEditor||Game.currentGame.HEADS.push(
this)}else this.initHead()},SpecialShapeCell.prototype.initHead=function(){this.head=this.findHead(this.x,this.y),this.isHead=!1},SpecialShapeCell.prototype.findHead=function(i,s){for(var e=0;e<Game.currentGame.HEADS.length;e++){var t=Game.currentGame.HEADS[e],n=!1;if(t.iterateSelf(function(e,t){i===e&&s===t&&(n=!0)}.bind(this)),n)return t}},SpecialShapeCell.prototype.save=function(){return this.isHead?this.getSaveData():this.cellClass.CODES},SpecialShapeCell.prototype.getSaveData=function(){var e=this.cellClass.CODES.concat([this.configId,this.rotation]),t=""+this.lives;return e.concat(t.split(""))},SpecialShapeCell.prototype.iterateSelf=function(e){Game.currentGame.field;for(var t=0;t<this.getSize().rows;t++)for(var i=0;i<this.getSize().cols;i++)1===this.config[t][i]&&e(this.head.topLeftX+i,this.head.topLeftY+t)},SpecialShapeCell.prototype.getSize=function(){return{rows:this.config.length,cols:this.config[0].length}},SpecialShapeCell.prototype.rotateConfig=function(e){for(
var t=this.getSize(),i=[],s=0;s<t.cols;s++)i.push([]);for(var n=0;n<t.rows;n++)for(var o=0;o<t.cols;o++)e?i[t.cols-1-o][n]=this.config[n][o]:i[o][t.rows-1-n]=this.config[n][o];this.config=i},SpecialShapeCell.prototype.getConfig=function(){throw"Not implemented"},SpecialShapeCell.prototype.initConfig=function(e,t){for(this.configId=e,this.config=this.getConfig(),this.rotation=t;0<t;)this.rotateConfig(),t--},SpecialShapeCell.prototype.getLives=function(){return this.isHead?this.lives:this.head.getLives()},SpecialShapeCell.prototype.hurt=function(){this.isHead?this.onHurt():this.head.hurt()},SpecialShapeCell.prototype.hover=function(e){BigCell.prototype.hover.apply(this,arguments)},SpecialShapeCell.prototype.animate=function(e,t){this.isHead?BaseCell.prototype.animate.call(this,e,t):this.head.animate(e,t)},SpecialShapeCell.prototype.onHeadExplode=function(){this.explodeViaCollect()},SpecialShapeCell.prototype.explode=function(){if(this.isHead){if(this.headExploded||!Game.currentGame
)return;this.headExploded=!0,this.iterateSelf(function(e,t){var i=Game.currentGame.field.cells[t][e];i!==this&&i.explode()}.bind(this)),this.onHeadExplode()}else BaseCell.prototype.explode.call(this)};var FigureDragonCell=function(e,t){SpecialShapeCell.call(this,e,t,FigureDragonCell),this.hurtable=!0};FigureDragonCell.prototype=Object.create(SpecialShapeCell.prototype),(FigureDragonCell.prototype.constructor=FigureDragonCell).prototype.getGoalId=function(){return FigureDragonCell.GOAL_ID},FigureDragonCell.prototype.editorComponents=function(){if(this.isHead)return[BaseCellComponent,SpecialShapeCellComponent,LiveLineComponent]},FigureDragonCell.prototype.boom=function(){this.hurt()},FigureDragonCell.prototype.bundleId=function(){return"figure_dragon"},FigureDragonCell.prototype.getConfig=function(){return FigureDragonCell.CONFIGS[this.configId]},FigureDragonCell.prototype.getViewClass=function(){return FigureDragonCellView},FigureDragonCell.GOAL_ID="figure_dragon",
FigureDragonCell.CONFIGS={0:[[0,1,0],[1,1,1]],1:[[0,1],[1,1],[1,0]],2:[[1,1,1],[1,0,0]],3:[[1,1,1,1]]};var MultiColorCell=function(e,t){BaseCell.call(this,e,t),this.movable=!0,this.explodeOnGameFinish=!0,this.putInPoolAvailable=!0,this.fallThroughBarrier=!0};MultiColorCell.prototype=Object.create(BaseCell.prototype),(MultiColorCell.prototype.constructor=MultiColorCell).prototype.load=function(e){},MultiColorCell.prototype.save=function(){return MultiColorCell.CODES},MultiColorCell.prototype.canMoveWith=function(e){return e instanceof ColorCell||e instanceof MultiColorCell},MultiColorCell.prototype.updateMoveHover=function(e){for(var t=Game.currentGame.field.cells,i=0;i<Field.SIZE;i++)for(var s=0;s<Field.SIZE;s++)t[i][s]&&t[i][s]!==this&&(-1===this.currentHoverColor&&t[i][s].hurtable||t[i][s].getColor()===this.currentHoverColor)&&t[i][s].hover(e)},MultiColorCell.prototype.removeMoveHover=function(){this.currentHoverColor&&(this.updateMoveHover(!1),this.currentHoverColor=void 0)},
MultiColorCell.prototype.addMoveHover=function(){this.currentHoverColor&&this.updateMoveHover(!0)},MultiColorCell.prototype.onRemoveSelection=function(){this.removeMoveHover()},MultiColorCell.prototype.onMouseMove=function(e){var t=void 0;e&&e.hurtable&&Math.abs(e.x-this.x)+Math.abs(e.y-this.y)===1&&e.movable&&(t=e instanceof MultiColorCell?-1:e.color),this.currentHoverColor!==t&&(this.removeMoveHover(),this.currentHoverColor=t,this.addMoveHover())},MultiColorCell.prototype.getViewClass=function(){return MultiColorCellView},MultiColorCell.prototype.explodeDuration=function(){return.5},MultiColorCell.prototype.chooseRandomColor=function(){for(var e=Game.currentGame.field.cells,t=[],i=0;i<Field.SIZE;i++)for(var s=0;s<Field.SIZE;s++)e[i][s]&&e[i][s].color&&t.push(e[i][s].color);if(0!==t.length)return cleverapps.Random.choose(t)},MultiColorCell.prototype.onExplode=function(){if(!this.hurtByMulticolor){BaseCell.prototype.onExplode.call(this),void 0===this.chosenColor&&(
this.chosenColor=this.chooseRandomColor());for(var i=[],e=0;e<Field.SIZE;e++)for(var t=0;t<Field.SIZE;t++){var s=Game.currentGame.field.cells[e][t];s&&s.alive&&0<s.lives&&(s.getColor()===this.chosenColor||this.chosenColor===MultiColorCell.COLOR_ALL)&&i.push(s)}i.forEach(function(e){e.prepareForBurn()}),cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.USE_MULTI_COLOR_CELL),cleverapps.missionManager.dispatchEvent(Mission.EVENT_USE_MULTI_COLOR_CELL);var n=[];Array.prototype.push.apply(n,i),cleverapps.shuffle(n).forEach(function(e){e.animate(BaseCell.ANIMATION_MULTI_COLOR_SELECT,{multiColorCell:this})}.bind(this));var o=this.chosenColor===MultiColorCell.COLOR_ALL;i.forEach(function(e,t){o?e instanceof MultiColorCell&&(e.hurtByMulticolor=!0):e.boomNeighbors(1),e.hurt({id:t,groupSize:i.length}),RugTile.hurtViaCombo(this,e)}.bind(this))}},MultiColorCell.COLOR_ALL=-1,MultiColorCell.MAX_SPECIAL_CREATE=5,MultiColorCell.prototype.crazyActionDuplicateCombos=function(i){
this.chosenColor=i.getColor();for(var e=[],t=0;t<Field.SIZE;t++)for(var s=0;s<Field.SIZE;s++){var n=Game.currentGame.field.cells[t][s];n&&n.canDelete()&&n.getColor()===this.chosenColor&&e.push(n)}e.length>MultiColorCell.MAX_SPECIAL_CREATE&&(e=cleverapps.shuffle(e).slice(0,MultiColorCell.MAX_SPECIAL_CREATE)),e.forEach(function(e){var t=ComboCell.Create(e,{neighbor:i});e.delete(),Game.currentGame.field.addCell(t),t.animate(BaseCell.ANIMATION_CREATE)}),this.explode()},MultiColorCell.prototype.crazyActionSimple=function(e){this.chosenColor=e.getColor(),this.explode()},MultiColorCell.IsAvailable=function(){return cleverapps.user.checkAvailable(MultiColorCell.AVAILABLE)},MultiColorCell.AVAILABLE={episode:0,level:2};var SuperMultiColorCell=function(e,t){BaseCell.call(this,e,t),this.movable=!0,this.fallThroughBarrier=!0};SuperMultiColorCell.prototype=Object.create(MultiColorCell.prototype),(SuperMultiColorCell.prototype.constructor=SuperMultiColorCell).prototype.load=function(e){},
SuperMultiColorCell.prototype.save=function(){return SuperMultiColorCell.CODES},SuperMultiColorCell.prototype.getViewClass=function(){return SuperMultiColorCellView},SuperMultiColorCell.prototype.explodeDuration=function(){return 1.4},SuperMultiColorCell.prototype.beforeExplodeTimeout=function(){return.3},SuperMultiColorCell.prototype.onExplode=function(){this.chosenColor=MultiColorCell.COLOR_ALL,MultiColorCell.prototype.onExplode.call(this)};var CombosLibrary={actions:{hurt:function(e,t){for(var i=0;i<e.algo.power;i++)t.hurt();RugTile.hurtViaCombo(e,t)},splashHurt:function(e,t){for(var i=e.algo.power,s=t.y-i;s<=t.y+i;s++)for(var n=t.x-i;n<=t.x+i;n++)s!==t.y&&n!==t.x||Game.currentGame.field.cells[s]&&Game.currentGame.field.cells[s][n]&&(Game.currentGame.field.cells[s][n].hurt(),RugTile.hurtViaCombo(e,Game.currentGame.field.cells[s][n]))},incCoefOrMakeHero:function(e,t,i){var s=cleverapps.Random.nextDouble();if(s>=e.algo.makeHeroProb&&t.incCoef)t.incCoef(e.algo.power);else if((
s<e.algo.makeHeroProb||0===i)&&t.canDelete()){var n=ComboCell.Create(t,{random:!0});n&&(t.delete(),Game.currentGame.field.addCell(n),n.animate(BaseCell.ANIMATION_CREATE))}},shuffle:function(e,t){Game.counter.setTimeout(function(){},600);for(var i=[],s=0;s<t.length;s++)i.push({x:t[s].x,y:t[s].y});for(s=0;s<t.length;s++){var n=i[(s+1)%i.length];Game.currentGame.field.cells[n.y][n.x]=t[s],t[s].x=n.x,t[s].y=n.y,t[s].animate(BaseCell.ANIMATION_GOTO_POSITION)}}},helpers:{classifyTargets:function(e){for(var t={simple:[],special:[]},i=0;i<Field.SIZE;i++)for(var s=0;s<Field.SIZE;s++){var n=Game.currentGame.field.cells[i][s],o=Game.currentGame.field.floor[i][s];if(n){if(e&&!CombosLibrary.filters.notAttackBuddies(e,n))continue;CombosLibrary.helpers.isForbiddenCell(n,e)||(CombosLibrary.helpers.isSimpleCell(n,o)?t.simple.push(n):t.special.push(n))}}return t},isForbiddenCell:function(e,t){return!(!e.willBurn&&e.alive&&0!==e.lives&&e.hurtable)||(!t&&e instanceof FireworkCell||(
e instanceof MultiColorCell||e instanceof CandleCell&&e.state===CandleCell.STATE_ON))},isSimpleCell:function(e,t){return!(-1===[ColorCell,GoalColorCell,HeroCell,HeroGoalCell,TulpanCell,ComboCell,ComboGoalCell].indexOf(e.constructor)||void 0!==e.mark||t&&t.constructor===IceTile||t&&t.constructor===DirtyHoneyTile||t&&t.constructor===RabbitTile&&0<t.lives)}},targets:{maxLife:function(e){var t=CombosLibrary.helpers.classifyTargets(e),i=t.special;0===i.length&&(i=t.simple);for(var s=0,n=0;n<i.length;n++)if((s=Math.max(s,i[n].totalLives()))>=e.algo.power){s=e.algo.power;break}var o=i.filter(function(e){return e.totalLives()>=s});return[cleverapps.Random.choose(o)]},byRowOrCol:function(e){for(var t=[],i=1;i<=Field.SIZE;i++)e.algo.dir|CombosLibrary.LINER_DIRECTION_HORIZONTAL&&(Game.currentGame.field.cells[e.y][e.x+i]&&t.push(Game.currentGame.field.cells[e.y][e.x+i]),Game.currentGame.field.cells[e.y][e.x-i]&&t.push(Game.currentGame.field.cells[e.y][e.x-i])),
e.algo.dir|CombosLibrary.LINER_DIRECTION_VERTICAL&&(Game.currentGame.field.cells[e.y+i]&&Game.currentGame.field.cells[e.y+i][e.x]&&t.push(Game.currentGame.field.cells[e.y+i][e.x]),Game.currentGame.field.cells[e.y-i]&&Game.currentGame.field.cells[e.y-i][e.x]&&t.push(Game.currentGame.field.cells[e.y-i][e.x]));return t}},filters:{notSelf:function(e,t){return e!==t},shuffleable:function(e,t){return t instanceof ColorCell&&t.movable&&t.alive&&!t.controlDisabled&&!t.sticky&&0!==t.lives},hurtable:function(e,t){return t&&t.hurtable&&t.alive&&0<t.lives},withCoefOrTurnToHero:function(e,t,i){return!!t&&(!(!t.alive||t.lives<=0)&&(!(!i||t.constructor!==ColorCell)||t.constructor===GoalColorCell))},closeBy:function(e,t){return Math.abs(e.x-t.x)<=1&&Math.abs(e.y-t.y)<=1},notOnThreeInRow:function(e,t,i){return!(Game.currentGame&&!i)||!Game.currentGame.field.isThreeInRow(t.y,t.x)},notAttackBuddies:function(e,t,i){return!!i||!ComboCell.checkComboTarget(t.x,t.y,e.color)},notAttackMulticolorCell:function(e
,t,i){return!!i||!(t instanceof MultiColorCell)}},checkFilters:function(e,t,i){if(!t)return!1;var s=e.algo.filters;Array.isArray(s)||(s=[s]);for(var n=0;n<s.length;n++){if(!(0,s[n])(e,t,i))return!1}return!0},ByShape:{},TYPE_PLANE:"plane",TYPE_LINER:"liner",TYPE_CROSS:"cross",LINER_DIRECTION_HORIZONTAL:1,LINER_DIRECTION_VERTICAL:2};CombosLibrary.ByShape[Shape.PLANE]={name:CombosLibrary.TYPE_PLANE,shootFlyDuration:function(e,t){return(Math.abs(t.x-e.x)+Math.abs(t.y-e.y)+2)*e.algo.plane_pace/1e3},shootAlgorithm:"plane",plane_pace:150,action_timeout:200,action_delay:0,between_shoot_timeout:0,noEffect:!0,bigZOrder:!0,numTargets:1,power:1,findTargets:CombosLibrary.targets.maxLife,filters:[CombosLibrary.filters.hurtable],action:CombosLibrary.actions.splashHurt},CombosLibrary.Liner={shootFlyDuration:function(e,t){var i=Math.abs(t.x-e.x)+Math.abs(t.y-e.y);return.8*e.algo.direct_timeout/1e3*i/e.algo.action_length},shootAlgorithm:"none",action_timeout:800,action_delay:300,direct_timeout:800,
action_length:8,between_shoot_timeout:0,bigZOrder:!0,numTargets:100,power:1,findTargets:CombosLibrary.targets.byRowOrCol,filters:[CombosLibrary.filters.hurtable],action:CombosLibrary.actions.hurt},CombosLibrary.ByShape[Shape.FOUR_H]=cleverapps.extend({},CombosLibrary.Liner,{name:CombosLibrary.TYPE_LINER,dir:CombosLibrary.LINER_DIRECTION_HORIZONTAL}),CombosLibrary.ByShape[Shape.FOUR_V]=cleverapps.extend({},CombosLibrary.Liner,{name:CombosLibrary.TYPE_LINER,dir:CombosLibrary.LINER_DIRECTION_VERTICAL}),CombosLibrary.ByShape[Shape.CROSS]=cleverapps.extend({},CombosLibrary.Liner,{name:CombosLibrary.TYPE_CROSS,dir:CombosLibrary.LINER_DIRECTION_HORIZONTAL|CombosLibrary.LINER_DIRECTION_VERTICAL});var ComboGoalCell=function(e,t,i,s){GoalColorCell.call(this,e,t,i),this.algo=s,this.explodeOnGameFinish=!0};ComboGoalCell.prototype=Object.create(GoalColorCell.prototype),ComboGoalCell.prototype.constructor=ComboGoalCell;var ComboCell=function(e,t,i,s){ColorCell.call(this,e,t,i,s),this.algo=s,
this.explodeOnGameFinish=!0};ComboCell.prototype=Object.create(ColorCell.prototype),(ComboCell.prototype.constructor=ComboCell).prototype.getViewClass=ComboGoalCell.prototype.getViewClass=function(){return ComboCellView},ComboCell.prototype.repaint=ComboGoalCell.prototype.repaint=function(){var e=this.getRandomColor(),t=new(ComboCell.CalcConstructor({color:e}))(this.x,this.y,e);return t.algo=ComboCell.CalcAlgo(t,{random:!0}),this.mark&&t.addMark(),t.missionMark=this.missionMark,t},ComboCell.prototype.getType=ComboGoalCell.prototype.getType=function(e){return this.algo.name},ComboCell.prototype.canMoveWith=ComboGoalCell.prototype.canMoveWith=function(e){return e instanceof ComboCell||e instanceof ComboGoalCell},ComboGoalCell.prototype.algoEffect=ComboCell.prototype.algoEffect=function(e){this.algo.beforeEffect&&this.algo.beforeEffect(this),Game.counter.setTimeout(function(){if(Game.currentGame&&Game.currentGame.field){for(var e=this.algo.findTargets(this).filter(function(e){
return void 0!==e}).map(function(e){return{x:e.x,y:e.y}}),t=0;t<e.length;t++)ComboCell.addComboTarget(e[t].x,e[t].y,this.color);if(this.algo.actionToAllCells){for(var i=[],s=0;s<e.length;s++){ComboCell.removeComboTarget(e[s].x,e[s].y,this.color);var n=Game.currentGame.field.cells[e[s].y][e[s].x];CombosLibrary.checkFilters(this,n,!0)&&i.push(n)}this.algo.action(this,i)}else{var o=0;e.forEach(function(t,i){var e=this.algo.shootFlyDuration(this,t),s=function(){this.algoShotAnimation(t,e),Game.counter.setTimeout(function(){ComboCell.removeComboTarget(t.x,t.y,this.color);var e=Game.currentGame.field.cells[t.y][t.x];CombosLibrary.checkFilters(this,e,!0)&&this.algo.action(this,e,i)}.bind(this),1e3*e)}.bind(this);0<o?Game.counter.setTimeout(s,o):s(),o+=this.algo.between_shoot_timeout}.bind(this))}}}.bind(this),this.algo.action_delay),this.algoEffectAnimation(),Game.counter.setTimeout(function(){e()},this.algo.action_delay+this.algo.action_timeout),cleverapps.dailyTasks.addProgress(
cleverapps.DailyTask.COLLECT_HERO_CELLS,{color:this.color}),cleverapps.missionManager.dispatchEvent(Mission.EVENT_COLLECT_HERO_CELLS)},ComboGoalCell.prototype.smile=function(){},ComboGoalCell.prototype.explode=ComboCell.prototype.explode=function(e){this.alive&&(this.alive=!1,Game.currentGame.score.addMoveExplode(2),e&&e.callback?this.algoEffect(this.afterExplode.bind(this,e.callback)):this.algoEffect(this.afterExplode.bind(this)))},ComboCell.CalcAlgo=function(e,t){return t.shape?CombosLibrary.ByShape[t.shape.calculateForm()]:t.neighbor?t.neighbor.algo:t.random?CombosLibrary.ByShape[Shape.PLANE]:void 0},ComboCell.CalcConstructor=function(e,t){return Game.currentGame&&Game.currentGame.goals.typeInGoals(e.color)?ComboGoalCell:ComboCell},ComboCell.Create=function(e,t){if(t.shape&&t.shape.calculateForm()===Shape.FIVE&&MultiColorCell.IsAvailable())return new MultiColorCell(e.x,e.y);if(!t.shape||t.shape.calculateForm()!==Shape.THREE){var i=ComboCell.CalcAlgo(e,t);if(i){var s=new(
ComboCell.CalcConstructor(e,t))(e.x,e.y,e.color,i);return e.mark&&!t.shape&&s.addMark(),s}}},ComboCell.resetComboTargets=function(){ComboCell.targets={}},ComboCell.comboTargetId=function(e,t,i){return e+"_"+t+"_"+i},ComboCell.checkComboTarget=function(e,t,i){var s=ComboCell.comboTargetId(e,t,i);return ComboCell.targets[s]&&0<ComboCell.targets[s]},ComboCell.addComboTarget=function(e,t,i){var s=ComboCell.comboTargetId(e,t,i);ComboCell.targets[s]||(ComboCell.targets[s]=0),ComboCell.targets[s]++},ComboCell.removeComboTarget=function(e,t,i){var s=ComboCell.comboTargetId(e,t,i);ComboCell.checkComboTarget(e,t,i)&&ComboCell.targets[s]--};var ViewHelper={flyOut:function(){var e=this.parent.getParent(),t=this.parent.getPosition();this.replaceParent(e),this.setPosition(t)}},CoefAnimation=BaseAnimation.extend({ctor:function(){this._super(res.coef_animation_json)}});CoefAnimation.fillPool=function(){for(var e=0;e<6;e++)cc.pool.putInPool(new CoefAnimation)},CoefAnimation.factory=function(){
return cc.pool.hasObject(CoefAnimation)?cc.pool.getFromPool(CoefAnimation):void 0};var CoefView=cc.Node.extend({ctor:function(e){this._super(),this.setPositionRound(.82*cleverapps.styles.BaseCellView.CELL_SIZE_PX,.14*cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.number=new cc.Sprite(res["coef_"+(e||1)]),this.addChild(this.number),this.reuse(e),this.setCascadeOpacityEnabled(!0)},createAnimation:function(){this.finishAnimation();var e=this.coefAnimation=CoefAnimation.factory();return e&&(e.setPosition(0,-this.number.height/2),this.addChild(e)),e},finishAnimation:function(){this.coefAnimation&&(this.coefAnimation.finishAnimation(),delete this.coefAnimation)},hide:function(e){this.number.visible=!1;var t=this.createAnimation();t&&t.runAnimate("coef_off",this.finishAnimation.bind(this))},popUp:function(e){if(!this.popUpAnimation){this.popUpAnimation=!0;var t=this.createAnimation();this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.CallFunc(function(){cleverapps.audio.playSound(
bundles.game.urls.inc_coef_effect)})));var i=function(){this.parent.cell.coef?this.updateImage(this.parent.cell.coef):this.number.visible=!1,this.popUpAnimation=!1}.bind(this);t&&t.animation?t.runAnimate("coef_on",function(){i(),this.finishAnimation()}.bind(this)):this.number.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.CallFunc(i)))}},updateImage:function(e){this.number.visible=!0,this.number.setSpriteFrame(res["coef_"+e])},remove:function(){cc.pool.putInPool(this)},reuse:function(e){0===e?this.number.visible=!1:(this.updateImage(e),this.number.visible=!0),this.popUpAnimation=!1},unuse:function(){this.finishAnimation(),this.removeFromParent(!1)}});CoefView.factory=function(e){return void 0===e&&(e=0),cc.pool.hasObject(CoefView)?cc.pool.getFromPool(CoefView,e):new CoefView(e)};var ExplosionView=cc.Node.extend({ctor:function(){this._super();var e=new cc.Sprite(res.boom_frames_1);this.addChild(e),e.setScale(1.2),this.sprite=e,this.frames=[];for(var t=2;res["boom_frames_"+t];t++
)this.frames.push(cc.spriteFrameCache.getSpriteFrame(res["boom_frames_"+t]))},animate:function(e,t){this.spine?(this.spine.setColor(e),this.spine.setCompleteListener(function(){cc.pool.putInPool(this)}.bind(this)),this.spine.setAnimation(0,"animation",!1)):(this.sprite.setColor(e),this.sprite.runAction(new cc.Sequence(cc.animate(new cc.Animation(this.frames,cleverapps.styles.ExplosionView.frame.duration/(this.frames.length+1))),new cc.CallFunc(function(){cc.pool.putInPool(this)}.bind(this)))))},reuse:function(){this.visible=!0,this.setScale(1)},unuse:function(){this.visible=!1,this.removeFromParent(!1)}});ExplosionView.fillPool=function(){for(var e=0;e<6;e++)cc.pool.putInPool(new ExplosionView)},ExplosionView.factory=function(){return cc.pool.hasObject(ExplosionView)?cc.pool.getFromPool(ExplosionView):void 0},cleverapps.styles.ExplosionView={frame:{duration:.15}};var MarkView=cc.Node.extend({ctor:function(e){this._super(),this.cell=e;cleverapps.styles.MarkView;this.setContentSize(
cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),this.image=new cc.Sprite(this.getImage()),this.image.setPosition(this.width/2,this.height/2),this.addChild(this.image),cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&(this.animation=new cleverapps.Spine(res.mark_spine_json,1),this.animation.setPosition(this.width/2,this.height/2),this.animation.setStartVisibleListener(function(){this.image.visible=!1}.bind(this)),this.addChild(this.animation),this.animation.visible=!1)},initialize:function(e){var t;this.mark=e.mark,this.cell=e,this.image.visible=!0,this.animation&&(cleverapps.styles.MarkView.animation.skins&&this.animation.setSkin(this.getSkin()),this.animation.visible=!1),this.mark.onExplodeListener=this.animateCollect.bind(this),this.mark.onSmileListener=this.smile.bind(this),cleverapps.styles.MarkView.positions[e.constructor.name]&&(t=cleverapps.styles.MarkView.positions[e.constructor.name],
cleverapps.styles.MarkView.positions[e.constructor.name][e.color]?t=cleverapps.styles.MarkView.positions[e.constructor.name][e.color]:e.color&&(t=void 0)),this.setPositionRound(t||{x:{align:"center"},y:{align:"center"}})},getImage:function(){return this.cell instanceof ColorBombCell?bundles.color_bomb.frames.mark_on_colorcell:bundles.game.frames.mark_on_colorcell},getGoalImage:function(){return res.mark_goal},getSkin:function(){},reuse:function(e){this.cell=e,this.image.setSpriteFrame(this.getImage()),this.setScale(1)},unuse:function(){this.removeFromParent(!1),this.animation&&this.animation.clearTrack(0),this.mark.onExplodeListener=function(){}},animateFlyStart:function(e){if(!this.animation)return this.image.setSpriteFrame(this.getGoalImage()),void this.image.runAction(new cc.Sequence(new cc.MoveBy(1,cc.p(cleverapps.styles.MarkViewLowModeUpFly.x,cleverapps.styles.MarkViewLowModeUpFly.y)),new cc.CallFunc(e)));cleverapps.styles.MarkView;this.animation.setAnimation(0,"fly_start",!1),
this.animation.setCompleteListener(e)},animateFlyGoal:function(e,t){var i=cleverapps.styles.MarkView;Game.currentGame&&(this.animation?(t.targetScale=i.flyAnimation.scale,this.animation.setAnimation(0,"fly_to_goal",!0),this.animation.setCompleteListener(function(){})):(t.flyDuration+=0,t.targetScale=1),Game.currentGame.goalsController.getViewByType(this.mark.getGoalId()).collect(this,t,e))},delete:function(){this.mark&&this.mark.putInPoolAvailable?cc.pool.putInPool(this):this.removeFromParent()},animateCollect:function(e,t){ViewHelper.flyOut.call(this),this.setLocalZOrder(100);var i=function(){this.delete()}.bind(this),s=e?this.animateFlyGoal.bind(this,i,t):i;this.animateFlyStart(s)},smile:function(){if(this.animation&&!this.smiling){this.smiling=!0;var e=cleverapps.styles.MarkView;this.animation.setCompleteListener(this.stopSmile.bind(this));var t=e.smile.animationName;Array.isArray(t)&&(t=cleverapps.Random.choose(t)),this.animation.setAnimation(0,t,!1)}},stopSmile:function(){
this.smiling&&(this.smiling=!1,this.image.visible=!0,this.animation.visible=!1)}});MarkView.factory=function(e){return cc.pool.hasObject(MarkView)?cc.pool.getFromPool(MarkView,e):new MarkView(e)},cleverapps.styles.MarkViewLowModeUpFly={x:0,y:100},cleverapps.styles.MarkView={positions:{},animation:{start:{duration:1}},flyAnimation:{scale:1.5},smile:{animationName:"idle"}};var MissionMarkView=cc.Sprite.extend({ctor:function(){this.icon=this.getIcon(),this._super(this.icon),this.setAnchorPoint(.5,.5);var e=cleverapps.styles.MissionMarkView;this.setScale(e.scale),this.setPosition(cleverapps.styles.BaseCellView.CELL_SIZE_PX/2+e.x,cleverapps.styles.BaseCellView.CELL_SIZE_PX/2+e.y)},getIcon:function(){return cleverapps.skins.getSlot("missionMarkIcon",{type:Game.currentGame.gameMission.type})},unuse:function(){if(Game.currentGame&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN){var e=Game.currentGame,t=cc.director.getRunningScene(),i=t.cloversView;if(i){var s=t.scene.convertToNodeSpace(
this.getParent().convertToWorldSpace(this.getPosition())),n=t.scene.convertToNodeSpace(i.convertToWorldSpace(i.icon.getPosition()));MissionAnimationView.show(e.getMissionType(),t.scene,{beginPos:s,targetPos:n,beginScale:this.getScale()*e.fieldController.fieldView.getScale(),targetScale:1,icon:this.icon,callback:function(){e.addClover(Mission.TYPE_COLLECT_MARK,1)}})}}this.removeFromParent(!1)},reuse:function(){this.icon=this.getIcon(),this.setSpriteFrame(this.icon)}});MissionMarkView.factory=function(){return cc.pool.hasObject(MissionMarkView)?cc.pool.getFromPool(MissionMarkView):new MissionMarkView},cleverapps.styles.MissionMarkView={scale:.5,x:-30,y:30};var ShineView=cc.Node.extend({ctor:function(){this._super(),this.shine=new cleverapps.Spine(res.target_json,1),this.addChild(this.shine),this.setPosition(cleverapps.styles.BaseCellView.CELL_SIZE_PX/2,cleverapps.styles.BaseCellView.CELL_SIZE_PX/2),this.prepareForCell()},prepareForCell:function(){this.shine.setAnimation(0,"target",!0),
cleverapps.styles.ShineView.zIndex&&this.setLocalZOrder(cleverapps.styles.ShineView.zIndex)},reuse:function(){this.prepareForCell()},unuse:function(){this.shine.clearTrack(0),this.removeFromParent(!1)}});ShineView.factory=function(){return cc.pool.hasObject(ShineView)?cc.pool.getFromPool(ShineView):new ShineView},cleverapps.styles.ShineView={zIndex:0};var BaseCellView={initialize:function(e){(this.cell=e).y<0&&0<=e.x&&(this.opacity=0,this.visible=!1),BaseCellViewBeforeShowUpAnimation.call(this),this.inShakeNow=!1,this.initializeZOrder(),this.setPosition(BaseCellView.alignInTheGrid(e.x,e.y)),cleverapps.config.debugMode&&(e.onDebugListener=function(){console.log(this.cell);var e=Game.currentGame.field.floor[this.cell.y][this.cell.x];e&&console.log(e)}.bind(this)),e.onHoverListener=this.showHover.bind(this),e.onAnimationListener=this.showAnimation.bind(this),e.onBeforeMoveListener=this.startMoving.bind(this),e.onFinishMoveListener=this.finishMoving.bind(this),
e.onWrongMoveListener=this.wrongMove.bind(this),e.onBeforeExplodeListener=this.startExploding.bind(this),e.onChangeParent=this.replaceParent.bind(this),e.onDeleteListener=this.delete.bind(this),e.onAppear=this.changeZOrder.bind(this),e.onFinishAppear=this.initializeZOrder.bind(this),e.onBeforeBoosterExecute=this.beforeBoosterExecute.bind(this),e.onAfterBoosterExecute=this.afterBoosterExecute.bind(this),e.onAvailableMoveListener=this.animateAvailableMove.bind(this),e.onDepthChanged=this.onDepthChanged.bind(this),e.onVisibleChanged=function(e){this.setVisible(e)}.bind(this),this.setVisible(e.visible),this.setOpacity(255),Game.currentGame&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN||this.removeMissionMarkView()},beforeBoosterExecute:function(){this.setLocalZOrder(100)},afterBoosterExecute:function(){this.setLocalZOrder(this.baseZOrder)},delete:function(){this.cell&&this.cell.putInPoolAvailable?cc.pool.putInPool(this):this.removeFromParent()},removeMissionMarkView:function(){
this.missionMarkView&&(cc.pool.putInPool(this.missionMarkView),this.missionMarkView=void 0)},changeZOrder:function(){this.setLocalZOrder(1e3-this.cell.getTypeId())},onDepthChanged:function(){this.initializeZOrder()},initializeZOrder:function(){0<=this.cell.x&&(this.cell.movable?this.setLocalZOrder(-this.cell.getTypeId()-BaseCellView.ZORDER_GAP_FOR_ONE_LAYER*this.cell.depth):this.setLocalZOrder(-this.cell.getTypeId()-BaseCellView.ZORDER_GAP_FOR_ONE_LAYER*this.cell.depth-BaseCellView.ZORDER_GAP_FOR_NON_MOVABLE_CELL)),this.baseZOrder=this.getLocalZOrder()}};BaseCellViewBeforeShowUpAnimation=function(){Game.currentGame.started||this.setScale(0)},BaseCellViewShowUpAnimation=function(){var e=this.getScaleX()||1;this.setScale(0),this.runAction(new cc.Sequence(new cc.DelayTime(.25+.4*(1.2*this.cell.y+this.cell.x)/Field.SIZE),new cc.ScaleTo(.6,e,1).easing(cc.easeBackOut())))},BaseCellView.showUp=function(){BaseCellViewShowUpAnimation.call(this)},BaseCellView.showHide=function(){this.runAction(
new cc.Sequence(new cc.DelayTime(.25+.4*(1.2*(Field.SIZE_Y-1-this.cell.y)+(Field.SIZE_X-1-this.cell.x))/Field.SIZE),new cc.ScaleTo(.3,0).easing(cc.easeIn(1))))},BaseCellViewStartMoving=function(e,t){var i;this.finishSmile&&this.finishSmile(),i=t&&t.alignInCenter?cc.p(this.parent.width/2,this.parent.height/2):BaseCellView.alignInTheGrid(e.x,e.y),this.stopAllActions(),t&&t.hasOwnProperty("scale")?this.scale=t.scale:this.scale=1,this.opacity=255,this.visible=!0,this.setRotation(0),Match3Rules.SlideFallDown?this.runAction(new cc.MoveTo(t.moveInterval,i)):this.runAction(new cc.MoveTo(t.moveInterval,i).easing(cc.easeIn(1.7)))},BaseCellView.startMoving=function(e,t){BaseCellViewStartMoving.call(this,e,t)},BaseCellView.finishMoving=function(e,t,i){var s=BaseCellView.alignInTheGrid(e.x,e.y);this.stopAllActions(),this.setPosition(s),t&&t.hasOwnProperty("scale")?this.scale=t.scale:this.scale=1,this.setRotation(0),this.setLocalZOrder(this.baseZOrder),this.coefView&&(this.coefView.opacity=255),
i&&"function"==typeof i&&i()},BaseCellView.wrongMove=function(e){WRONG_MOVE_ANIMATIONS[cleverapps.styles.BaseCellView.wrongMoveAnimationName].call(null,this,e)},BaseCellView.showHover=function(e){if(e){var t=cleverapps.styles.BaseCellView;cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&(this.cell.parentCell?this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.MoveBy(.2,0,t.hover.y).easing(cc.easeIn(.5)))):(this.shine=new cc.Node,this.addChild(this.shine),this.shine.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){this.shine.shine=ShineView.factory(),this.shine.addChild(this.shine.shine),this.runAction(new cc.MoveBy(.2,0,t.hover.y).easing(cc.easeIn(.5)))}.bind(this))))))}else{if(this.stopAllActions(),this.runAction(new cc.MoveTo(.2,BaseCellView.alignInTheGrid(this.cell.x,this.cell.y)).easing(cc.easeIn(.5))),this.shine){var i=this.shine;delete this.shine,i.stopAllActions(),i.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(
function(){i.shine&&cc.pool.putInPool(i.shine),i.removeFromParent()})))}this.initializeZOrder()}},BaseCellView.refuse=function(){if(0===this.getRotation()){this.runAction(new cc.Sequence(new cc.RotateBy(.05,-15).easing(cc.easeIn(1)),new cc.RotateBy(.1,30).easing(cc.easeIn(1)),new cc.RotateTo(.05,0).easing(cc.easeIn(1))))}},BaseCellView.showAnimation=function(e,t){switch(e){case BaseCell.ANIMATION_SHOWUP:this.showUp();break;case BaseCell.ANIMATION_SHOWHIDE:this.showHide();break;case BaseCell.ANIMATION_MISTAKE:this.refuse();break;case BaseCell.ANIMATION_DOWN:this.squeeze(-1);break;case BaseCell.ANIMATION_UP:this.squeeze(1);break;case BaseCell.ANIMATION_RIGHT:this.squeezeLeftRight(1);break;case BaseCell.ANIMATION_LEFT:this.squeezeLeftRight(-1);break;case BaseCell.ANIMATION_HURT:this.hurtAnimation();break;case BaseCell.ANIMATION_MULTI_COLOR_SELECT:this.multiColorSelectAnimation(t);break;case BaseCell.ANIMATION_CREATE:this.createAnimation(t);break;case BaseCell.ANIMATION_SMILE:this.smile()
;break;case BaseCell.ANIMATION_GOTO_POSITION:this.gotoPositionAnimation();break;case BaseCell.ANIMATION_CREATE_FROM_CELL:this.createFromCellAnimation(t);break;case BaseCell.ANIMATION_CREATE_FROM_CENTER:this.createFromCenterAnimation(t);break;case BaseCell.ANIMATION_OPEN:this.openAnimation();break;case BaseCell.ANIMATION_ONCLICK:this.onclick();break;case BaseCell.ANIMATION_COOKIE_UP:this.cookieUp(t);break;case BaseCell.ANIMATION_COOKIE_IN:this.cookieIn(t);break;case BaseCell.ANIMATION_COOKIE_OUT:this.cookieOut(t);break;case BaseCell.ANIMATION_SELECT:this.selectAnimation();break;case BaseCell.ANIMATION_BOOM_NEIGHBOUR:this.shakeAnimation();break;case BaseCell.ANIMATION_TRANSPORTER_LOOP_START:this.transporterLoopStart();break;case BaseCell.ANIMATION_TRANSPORTER_LOOP_FINISH:this.transporterLoopFinish();break;case BaseCell.ANIMATION_ICE_MAKER_MOVE:this.moveAnimation(t);break;case BaseCell.ANIMATION_MOVE_TO:this.moveToAnimation(t);break;case BaseCell.ANIMATION_CREATE_FROM_BOOSTER_BEFORE:
this.createFromBoosterBeforeAnimation(t)}},BaseCellView.transporterLoopStart=function(){this.runAction(new cc.ScaleTo(.2,0))},BaseCellView.transporterLoopFinish=function(){this.runAction(new cc.ScaleTo(.2,1))},BaseCellView.shakeAnimation=function(){this.inShakeNow||1!==this.getScaleX()||1!==this.getScaleY()||cleverapps.settings.fpsMode===cleverapps.Settings.FPS_MODE_LOW||(this.inShakeNow=!0,this.runAction(new cc.Sequence(new cc.ScaleTo(.2,.95),new cc.ScaleTo(.1,1),new cc.CallFunc(function(){this.inShakeNow=!1}.bind(this)))))},BaseCellView.moveToAnimation=function(e){this.stopAllActions();var t=BaseCellView.alignInTheGrid(e.target.x,e.target.y);this.runAction(new cc.MoveTo(e.duration,t).easing(cc.easeIn(2)))},BaseCellView.createFromAnimation=function(e,t,i,s,n){this.setScale(i),this.setOpacity(255),this.setVisible(!1),this.setPosition(e),this.setLocalZOrder(3),this.stopAllActions();var o=cleverapps.styles.BaseCellView,a=BaseCellView.alignInTheGrid(this.cell.x,this.cell.y),r=cc.p(a.x,
a.y+o.bezier.y),l=cc.p(e.x,e.y+o.bezier.y);this.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.CallFunc(function(){this.setVisible(!0)}.bind(this)),new cc.Spawn(new cc.ScaleTo(s,1),new cc.BezierTo(s,[l,r,a]).easing(cc.easeIn(1))),new cc.CallFunc(function(){this.setLocalZOrder(1),n&&n()}.bind(this))))},BaseCellView.gotoPositionAnimation=function(){var e=BaseCellView.alignInTheGrid(this.cell.x,this.cell.y);this.setLocalZOrder(3);var t=BaseAnimation.factoryLimited(res.C_hero_spine_effect_json);t.setLocalZOrder(100),t.setPosition(this.width/2,this.height/2),this.addChild(t),t.runAnimate("animation",function(){t.runAction(new cc.RemoveSelf)}),this.gotoAction&&this.stopAction(this.gotoAction),this.gotoAction=this.runAction(new cc.Sequence(new cc.MoveTo(.5,e),new cc.CallFunc(function(){this.setLocalZOrder(this.baseZOrder),this.gotoAction=void 0}.bind(this))))},BaseCellView.createFromCenterAnimation=function(e){e=e||{};this.createFromAnimation({
x:cleverapps.styles.BaseCellView.CELL_SIZE_PX*Field.SIZE_X/2,y:cleverapps.styles.BaseCellView.CELL_SIZE_PX*Field.SIZE_Y/2},0,e.scale||3,BaseCellView.CREATE_FROM_CENTER_DURATION/1e3-0,function(){cleverapps.audio.playSound(bundles.game.urls.create_multicolor_effect)})},BaseCellView.CREATE_FROM_CENTER_DURATION=500,BaseCellView.createFromBoosterBeforeAnimation=function(e){var t=BaseCellView.alignInTheGrid(this.cell.x,this.cell.y);this.setOpacity(50),this.setVisible(!0),this.setPosition(t),this.setLocalZOrder(3),this.stopAllActions(),this.setScale(2.5),this.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.5,1).easing(cc.easeBackOut()),new cc.FadeIn(.5)),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.create_multicolor_effect)}),new cc.DelayTime(.3),new cc.CallFunc(function(){this.setLocalZOrder(this.baseZOrder)}.bind(this)))),BoostersBeforeHelper.animateStars(this)},BaseCellView.createFromCellAnimation=function(e){var t=.4;void 0!==e.delay&&(t=e.delay),
this.createFromAnimation(BaseCellView.alignInTheGrid(e.x,e.y),t,.5,.5)},BaseCellView.openAnimation=function(){},BaseCellView.hurtAnimation=function(){},BaseCellView.squeeze=function(e){this.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.1,1.1,.9).easing(cc.easeIn(.5)),new cc.MoveBy(.1,cc.p(0,e*cleverapps.styles.BaseCellView.squeeze)).easing(cc.easeIn(.5))),new cc.Spawn(new cc.ScaleTo(.1,1,1).easing(cc.easeIn(.5)),new cc.MoveBy(.1,cc.p(0,-e*cleverapps.styles.BaseCellView.squeeze)).easing(cc.easeIn(.5)))))},BaseCellView.squeezeLeftRight=function(e){this.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.1,.9,1.1).easing(cc.easeIn(.5)),new cc.MoveBy(.1,cc.p(e*cleverapps.styles.BaseCellView.squeeze,0)).easing(cc.easeIn(.5))),new cc.Spawn(new cc.ScaleTo(.1,1,1).easing(cc.easeIn(.5)),new cc.MoveBy(.1,cc.p(-e*cleverapps.styles.BaseCellView.squeeze,0)).easing(cc.easeIn(.5)))))},BaseCellView.getBoomColor=function(){
return this.cell&&this.cell.color&&cleverapps.styles.COLORS.CELL_COLORS[this.cell.color.toLowerCase()]},BaseCellView.boomAnimation=function(e){var t=this.getBoomColor();if(t){var i=ExplosionView.factory();if(i)return i.setPosition(this.getPosition()),i.parent||this.parent.addChild(i),i.animate(t,e),cleverapps.audio.playSound(bundles.game.urls.boom_effect),i}},BaseCellView.startExploding=function(e){this.removeMissionMarkView(),this.finishSmile&&this.finishSmile(),this.setLocalZOrder(3),this.stopAllActions(),this.runAction(new cc.Sequence(new cc.ScaleTo(.3,1.5),new cc.CallFunc(function(){this.boomAnimation(e),this.delete()}.bind(this))))},BaseCellView.startExplodingViaCollect=function(e,t,i){this.removeMissionMarkView(),this.finishSmile&&this.finishSmile();var s=Game.currentGame.goalsController.getViewByType(e.type);s?(this.stopAllActions(),this.scale=1,i&&(void 0!==i.scale&&(this.scale=i.scale),void 0!==i.dy&&(this.y+=i.dy)),s.collect(this,e,t,function(){this.delete()}.bind(this))
):this.startExploding(e)},BaseCellView.reuse=function(e){this.scale=1,this.initialize(e)},BaseCellView.unuse=function(){this.removeFromParent(!1),this.cell.onAnimationListener=function(){},this.cell.onHoverListener=function(){},this.cell.onBeforeMoveListener=function(){},this.cell.onFinishMoveListener=function(){},this.cell.onBeforeExplodeListener=function(){},this.cell.onChangeParent=function(){},this.cell.onDeleteListener=function(){},this.cell.onAvailableMoveListener=function(){},this.cell.onDebugListener=function(){},this.cell.onVisibleChanged=function(){},delete this.gotoAction,delete this.cell},BaseCellView.alignInTheGrid=function(e,t){return cc.p((e+.5)*cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX*(Field.SIZE_Y-t-.5))},BaseCellViewMultiColorSelectAnimation=function(){if(!this.multicolorSelectAnimation){var e=ColorFulAnimationView.factory();e&&(this.multicolorSelectAnimation=!0,e.setPosition(this.getPosition()),this.getParent().addChild(
e),e.animate(function(){this.multicolorSelectAnimation=!1}.bind(this)))}},BaseCellView.multiColorSelectAnimation=function(e){BaseCellViewMultiColorSelectAnimation.call(this,e)},BaseCellView.createAnimation=function(){},BaseCellView.cookieUp=function(){},BaseCellView.cookieIn=function(){},BaseCellView.cookieOut=function(){},BaseCellView.selectAnimation=function(){BaseCellViewSelectAnimation.call(this)},BaseCellViewSelectAnimation=function(){this.squeeze(0),cleverapps.audio.playSound(res.cell_select_effect)},BaseCellView.animateAvailableMove=function(e,t){(0,AVAILABLE_MOVE_ANIMATIONS[cleverapps.styles.AvailableMoveView.animationName])(this,e,t)},BaseCellView.ZORDER_GAP_FOR_ONE_LAYER=2e3,BaseCellView.ZORDER_GAP_FOR_NON_MOVABLE_CELL=1e3,cleverapps.styles.BaseCellView={squeeze:10,wrongMoveAnimationName:"default",CELL_SIZE_PX:120,bezier:{y:200},wrongMove:{move:30},hover:{y:10}};var BoosterCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),
this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),this.image=this.getImage(e),this.image.setPosition(this.width/2,this.height/2),cleverapps.styles.BoosterCellView.scale&&this.image.setScale(cleverapps.styles.BoosterCellView.scale),this.addChild(this.image),this.initialize(e)},getImage:function(e){return new cc.Sprite(cleverapps.styles.BoosterCellView.images[e.type])},getCollectFlyPoints:function(){var e,t=cleverapps.styles.BoosterCellView.target,i=cc.p(this.x+(this.cell.x<Field.SIZE/2?t.dx:-t.dx),t.dy),s=cleverapps.styles.BaseGoalView;return e=cc.p(i.x,i.y+s.fly.lowMode.second.y),[cc.p((this.x+e.x)/2,(this.y+e.y)/2+s.fly.lowMode.first.y),e,i]},startExploding:function(){if(cleverapps.audio.playSound(bundles.game.urls.cell_collect_effect,{throttle:200}),Game.currentGame){this.stopAllActions();var e=cc.director.getRunningScene().scene;this.replaceParentSamePlace(e),this.setLocalZOrder(50)
;var t=this.getParent().getScale();this.setScale(t);var i=cleverapps.styles.BoosterCellView;this.runAction(new cc.Sequence(new cc.Spawn(new cc.MoveBy(.7,i.collect.x,i.collect.y).easing(cc.easeBackOut()),new cc.ScaleTo(.7,2)),new cc.RotateBy(.4,720).easing(cc.easeOut(1.5)),new cc.Spawn(new cc.BezierTo(.6,this.getCollectFlyPoints()).easing(cc.easeIn(1))),new cc.RemoveSelf))}}}));cleverapps.styles.BoosterCellView={scale:.9,images:[res.cellbooster_png,res.linebooster_png,res.colorbooster_png],collect:{x:0,y:300},target:{dx:250,dy:-100}};var TulpanCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage());this.image=t,this.image.setPosition(this.width/2,this.height/2),this.image.setScale(cleverapps.skins.getSlot("tulpanScale")),this.addChild(t),this.initialize(e);var i=e.onFinishAppear
;e.onFinishAppear=function(){i.call(this),cleverapps.audio.playSound(cleverapps.styles.TulpanCellView.appearSound)}},getImage:function(){return cleverapps.skins.getSlot("missionIcon",{type:Mission.TYPE_BURN_NEARBY})},startExploding:function(){if(Game.currentGame&&void 0===Game.currentGame.outcome){var e=Game.currentGame,t=cc.director.getRunningScene(),i=t.cloversView;if(i){var s=t.scene.convertToNodeSpace(this.getParent().convertToWorldSpace(this.getPosition())),n=t.scene.convertToNodeSpace(i.convertToWorldSpace(i.icon.getPosition()));MissionAnimationView.show(e.getMissionType(),t.scene,{beginPos:s,targetPos:n,beginScale:this.image.getScale()*e.fieldController.fieldView.getScale(),finalScale:i.icon.baseScale*i.getScale(),callback:function(){e.addClover(Mission.TYPE_BURN_NEARBY,1)}})}}this.removeFromParent(!1)}}));cleverapps.styles.TulpanCellView={scale:1.2,appearSound:res.tulpan_appear_effect};var BigCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){
this._super(),this.tileSize=2},showHover:function(e){if(e){var t=this.getStyles();this.setLocalZOrder(1),cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&(this.shine=ShineView.factory(),this.shine.setPosition(this.width/2,this.height/2),this.shine.setScale(2),this.addChild(this.shine)),this.runAction(new cc.MoveBy(.2,0,t.hover.y).easing(cc.easeIn(.5)))}else this.stopAllActions(),this.runAction(new cc.MoveTo(.2,this.calcPositionInTheGrid()).easing(cc.easeIn(.5))),this.shine&&(this.shine.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){this.setPosition(cleverapps.styles.BaseCellView.CELL_SIZE_PX/2,cleverapps.styles.BaseCellView.CELL_SIZE_PX/2),this.setScale(1),cc.pool.putInPool(this)}.bind(this.shine)))),this.shine=void 0),this.initializeZOrder()},calcPositionInTheGrid:function(){return BaseCellView.alignInTheGrid(this.cell.x+.5,this.cell.y+.5)},refuse:function(){if(0===this.getRotation()){this.runAction(new cc.Sequence(new cc.RotateBy(.1,-3
).easing(cc.easeIn(1)),new cc.RotateBy(.2,6).easing(cc.easeIn(1)),new cc.RotateTo(.1,0)).easing(cc.easeIn(1)))}},shakeAnimation:function(){}})),BlastAnimation=BaseAnimation.extend({ctor:function(e){this._super(bundles.burst.jsons.burst_blast_json),this.animation&&this.animation.setSkin(e)}});BlastAnimation.factory=function(e){return cc.pool.hasObject(BlastAnimations[e])?cc.pool.getFromPool(BlastAnimations[e]):new BlastAnimations[e]};var BlastAnimations={purple:BlastAnimation.extend({ctor:function(){this._super("purple")}}),yellow:BlastAnimation.extend({ctor:function(){this._super("yellow")}}),red:BlastAnimation.extend({ctor:function(){this._super("red")}}),green:BlastAnimation.extend({ctor:function(){this._super("green")}}),blue:BlastAnimation.extend({ctor:function(){this._super("blue")}})},ColorCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){if(this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,
cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),!e.useCustomView()){var t=new cc.Sprite(this.getImage(e));this.image=t,this.image.setPosition(this.width/2,this.height/2),this.addChild(t)}this.initialize(e),this.setCascadeOpacityEnabled(!0)},getImage:function(e){return res["cell_"+e.color]},initialize:function(e){BaseCellView.initialize.call(this,e),e.onBeforeExplodeMouseListener=this.startExplodingViaMouse.bind(this),e.onGameFinishListener=this.onGameFinish.bind(this),e.mark&&this.addMark(),e.missionMark&&this.addMissionMark()},unuse:function(){this.cell.onBeforeExplodeMouseListener=function(){},this.cell.onGameFinishListener=function(){},this.markView&&delete this.markView,BaseCellView.unuse.call(this)},reuse:function(e){BaseCellView.reuse.call(this,e),this.image.visible=!0},onGameFinish:function(){this.removeMissionMarkView()},addMark:function(){this.markView=MarkView.factory(this.cell),this.markView.initialize(this.cell),this.addChild(this.markView)},
addMissionMark:function(){!this.missionMarkView&&Game.currentGame&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN&&(this.missionMarkView=MissionMarkView.factory(),this.addChild(this.missionMarkView))},startExplodingViaMouse:function(e,t,i){this.removeMissionMarkView(),this.finishSmile&&this.finishSmile();var s=e.getView();this.stopAllActions(),s.collect(this,t,i,function(){this.delete()}.bind(this))}})),ColorCellView_a=ColorCellView.extend({}),ColorCellView_b=ColorCellView.extend({}),ColorCellView_c=ColorCellView.extend({}),ColorCellView_d=ColorCellView.extend({}),ColorCellView_e=ColorCellView.extend({}),ColorCellView_w=ColorCellView.extend({}),GoalColorCellView=ColorCellView.extend({shakeAnimation:function(){this.cell instanceof GoalColorCell&&!this.inShakeNow&&1===this.getScaleX()&&1===this.getScaleY()&&cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&(this.inShakeNow=!0,this.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.25),new cc.ScaleTo(.1,1),new cc.CallFunc(
function(){this.inShakeNow=!1}.bind(this)))))},getImage:function(e){return res["cell_"+e.color.toUpperCase()]},initialize:function(e){ColorCellView.prototype.initialize.call(this,e),this.coefView=CoefView.factory(e.coef),this.addChild(this.coefView),e.onBeforeResetCoef=this.onWillResetCoef.bind(this),e.onBeforeIncCoef=this.onWillIncCoef.bind(this)},smile:function(){if(!this.cell.useCustomView()&&cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&cleverapps.styles.GoalColorCellView.animation&&!this.smiling){this.smiling=!0;var e=this.cell.color.toUpperCase();this.animation=BaseAnimation.factory(res[e+"_spine_json"]),this.animation.setPosition(this.width/2,this.height/2),this.addChild(this.animation,-1),this.animation.runAnimate("animation",this.stopSmile.bind(this),this.image)}},startMoving:function(e,t,i){this.stopSmile(),this._super(e,t,i)},stopSmile:function(){this.smiling&&(this.smiling=!1,this.image.visible=!0,this.animation.finishAnimation())},unuse:function(){
this.stopSmile(),delete this.cell.onBeforeResetCoef,delete this.cell.onBeforeIncCoef,this.coefView.remove(),delete this.coefView,ColorCellView.prototype.unuse.call(this)},onWillResetCoef:function(e){this.coefView.hide(e)},startExploding:function(e,t){this.startExplodingViaCollect(e,t)},onWillIncCoef:function(e){this.coefView.popUp(e)}});cleverapps.styles.GoalColorCellView={animation:!0};var GoalColorCellView_A=GoalColorCellView.extend({}),GoalColorCellView_B=GoalColorCellView.extend({}),GoalColorCellView_C=GoalColorCellView.extend({}),GoalColorCellView_D=GoalColorCellView.extend({}),GoalColorCellView_E=GoalColorCellView.extend({}),GoalColorCellView_W=GoalColorCellView.extend({}),ComboCellViewCommon=cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(e);var t="rocket";switch(e.getType()){case CombosLibrary.TYPE_PLANE:t="plane";break;case CombosLibrary.TYPE_CROSS:t="cross"}this.animation=new cleverapps.Spine(bundles.game.jsons[t+"_combo_spine_json"],1),this.animation.setSkin(
e.color),this.animation.setPosition(this.width/2,this.height/2),this.addChild(this.animation,-1),e.getType()===CombosLibrary.TYPE_FOUR_V&&this.animation.setRotation(90),this.initialize(e)},createAnimation:function(e){(e=e||{}).silent?this.animation.setAnimation(0,"idle",!0):this.animation.setAnimationAndIdleAfter("open","idle"),cleverapps.audio.playSound(bundles.game.urls.booster_5_show_effect)},createFromCenterAnimation:function(){this.animation.setAnimation(0,"idle",!0),this._super.apply(this,arguments)},afterInitialize:function(e){e.algoEffectAnimation=this.animateEffect.bind(this),e.algoShotAnimation=this.animateShot.bind(this)},initialize:function(e){BaseCellView.initialize.call(this,e),this.afterInitialize(e)},beforeUnuse:function(){this.animation.visible=!1,this.cell.algoEffectAnimation=function(){},this.cell.algoShotAnimation=function(){}},unuse:function(){this.beforeUnuse(),BaseCellView.unuse.call(this)},reuse:function(e){BaseCellView.reuse.call(this,e),
this.animation.setAnimation(0,"idle",!0)},targetBlast:function(e){if(this.isRunningSafe()&&this.cell&&this.cell.algo){var t=this.cell.algo.blast_animation,i=BaseAnimation.factory(t);return i.setLocalZOrder(22),i.setPosition(e),this.parent.addChild(i),i.runAnimate("animation"),i}},shots:{bezier:function(e,t){var i=this.getPosition(),s=BaseCellView.alignInTheGrid(e.x,e.y),n=cc.p(i.x,Math.max(i.y,s.y)+cleverapps.styles.ComboCellView.shootBeginUp),o=cc.p(s.x,n.y),a=s.x<i.x?-180:180,r=new cc.Sprite(bundles.game.frames.bomb_png);r.setLocalZOrder(21),r.setPosition(i),r.setScale(.3),this.parent.addChild(r),r.runAction(new cc.Sequence(new cc.Spawn(new cc.BezierTo(t,[n,o,s]).easing(cc.easeIn(1)),new cc.RotateBy(t,a),new cc.ScaleTo(t/2,1)),new cc.CallFunc(function(){this.targetBlast(s)}.bind(this)),new cc.RemoveSelf))},plane:function(e,t){var i=new cleverapps.Spine(bundles.game.jsons.plane_combo_spine_json,1);i.setSkin(this.cell.color),i.setAnimation(0,"ignite",!1);var s=new Rocket(this.cell,e,{
delay:.1,duration:t-.1,json:this.cell.algo.shoot_animation,rocket:i,onLaunch:function(){i.setAnimation(0,"fly",!0),cleverapps.audio.playSound(bundles.game.urls.create_multicolor_effect)},onArrive:function(e){cleverapps.audio.playSound(bundles.game.urls.boom_effect),i.setCompleteListenerRemove(e),i.setAnimation(0,"splash",!1),i.setRotation(0)}});this.parent.addChild(s),s.setLocalZOrder(21)},rocket:function(e,t){var i=SimpleRocket(this.cell,e,{delay:.2,duration:t,json:this.cell.algo.shoot_animation});this.parent.addChild(i),i.setLocalZOrder(21)},blast:function(e,t){var i=BaseCellView.alignInTheGrid(e.x,e.y);this.targetBlast(i)},jump:function(e,t){var i=BaseCellView.alignInTheGrid(e.x,e.y),s=this.coefView;t*=.7,s&&s.setVisible(!1),this.setLocalZOrder(22),this.runAction(new cc.Sequence(new cc.MoveTo(t,i),new cc.CallFunc(function(){Game.currentGame&&Game.currentGame.shakeField({delay:150}),s&&s.setVisible(!0)}.bind(this))))},throw:function(e,t){var i,s=this.getPosition()
;i=this.cell.algo.getTargetPosition?this.cell.algo.getTargetPosition(e,s):BaseCellView.alignInTheGrid(e.x,e.y);var n=this.coefView;t*=.7,n&&n.setVisible(!1);var o=this.targetBlast(s);if(this.cell.algo.rotateToTarget&&o.setRotation(180*Math.atan2(i.x-s.x,i.y-s.y)/Math.PI),o){var a=new cc.MoveTo(t,i);this.cell.algo.applyEasing&&this.cell.algo.applyEasing(a);var r=this.cell.algo.blast_explde_animation_name;o.runAction(new cc.Sequence(a,new cc.CallFunc(function(){Game.currentGame&&Game.currentGame.shakeField({delay:150}),n&&n.setVisible(!0),r&&o.runAnimate(r)}.bind(this))))}},ray:function(e,t){var i=this.getPosition(),s=BaseCellView.alignInTheGrid(e.x,e.y),n=new cleverapps.Spine(this.cell.algo.shoot_animation,1);n.setAnimation(0,"idle",!0);var o=new cc.Node;o.setAnchorPoint2(.5,0),o.setContentSize2(n.getContentSize()),o.addChild(n),n.setPositionRound(o.width/2,o.height/2),this.parent.addChild(o),o.setLocalZOrder(21),o.setPositionRound(i),o.setRotation(180*Math.atan2(s.x-i.x,s.y-i.y
)/Math.PI);var a=Math.sqrt((s.x-i.x)*(s.x-i.x)+(s.y-i.y)*(s.y-i.y))/o.height;o.setScaleY(0),o.runAction(new cc.Sequence(new cc.ScaleTo(t,1,a),new cc.CallFunc(function(){n.setCompleteListenerRemove(),n.setAnimation(0,"finish",!1)})))},none:function(){}},animateShot:function(e,t){this.shots[this.cell.algo.shootAlgorithm].call(this,e,t)},effectSound:function(){cleverapps.audio.playSound(bundles.game.urls.multicolor_use_effect)},animateEffect:function(){this.cell.algo.bigZOrder?this.setLocalZOrder(20):this.setLocalZOrder(3),this.cell.algo.noEffect?this.animation.runAction(new cc.RemoveSelf):(this.animation.setCompleteListenerRemove(),this.animation.setAnimation(0,"out",!1))},startExploding:function(e,t){this.cell instanceof ComboGoalCell?GoalColorCellView.prototype.startExploding.call(this,e,t):ColorCellView.prototype.startExploding.call(this,e,t)}}),ComboCellView=cc.Node.extend(ComboCellViewCommon);cleverapps.styles.ComboCellView={shootBeginUp:150};var DecoratorCellView=cc.Node.extend(
cleverapps.extend({},BaseCellView,{ctor:function(){this._super(),this.setContentSize2(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint2()},initialize:function(e){BaseCellView.initialize.call(this,e),this.createSubView(),e.createSubView=this.createSubView.bind(this)},createSubView:function(){this.cell.innerCell&&Game.currentGame.field.cellEvents(this.cell.innerCell)},unuse:function(){this.cell.createSubView=function(){},BaseCellView.unuse.call(this)},reuse:function(e){this.scale=1,this.initialize(e)},animateExplode:function(e){e=e||function(){},this.stopAllActions(),this.setLocalZOrder(1),this.runAction(new cc.Sequence(new cc.Spawn(new cc.RotateBy(.5,720),new cc.ScaleTo(.5,0)),new cc.CallFunc(e)))},startExploding:function(){Game.currentGame.goals.inGoals(this.cell)?BaseCellView.startExplodingViaCollect.apply(this,arguments):this.animateExplode(function(){this.delete()}.bind(this))}})),
ChainDecoratorCellView=DecoratorCellView.extend({ctor:function(e){this._super();var t=this.image=new cc.Sprite(1===e.lives?res.chain_decorator_cell:res.chain_decorator_cell2);this.setContentSize2(t.getContentSize()),this.setAnchorPoint2(),t.setPositionRound(this.width/2,this.height/2),this.addChild(t),this.setCascadeOpacityEnabled(!0),this.initialize(e)},initialize:function(e){this._super(e),this.image.setSpriteFrame(1===e.lives?res.chain_decorator_cell:res.chain_decorator_cell2),this.image.setVisible(!0),this.cell.onChangeLivesListener=this.changeLives.bind(this)},changeLives:function(){if(1===this.cell.lives)if(cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW){var e=BaseAnimation.factoryLimited(res.chain2_animation_json);e.setPosition(this.getPosition()),e.parent||this.parent.addChild(e),cleverapps.audio.playSound(bundles.game.urls.chain_decorator_stage_decrease_effect),e.runAnimate("animation",function(){this.image.isRunningSafe()&&(this.image.setSpriteFrame(
res.chain_decorator_cell),this.image.visible=!0)}.bind(this),this.image)}else this.image.setSpriteFrame(res.chain_decorator_cell)},animateExplode:function(e){var t=BaseAnimation.factoryLimited(res.chain_animation_json);t.setPosition(this.getPosition()),t.parent||this.parent.addChild(t),cleverapps.audio.playSound(bundles.game.urls.chain_decorator_die_effect),t.runAnimate("animation",!1,new cc.FadeOut(.5),this.image),t.runAsync(e)}}),IceBlockAnimation=BaseAnimation.extend({ctor:function(){this._super(bundles.ice_block.jsons.ice_block_spine_json,"#images-ice_block1_stable.png")}});IceBlockAnimation.factory=function(){return cc.pool.hasObject(IceBlockAnimation)?cc.pool.getFromPool(IceBlockAnimation):new IceBlockAnimation};var IceBlockDecoratorCellView=DecoratorCellView.extend({ctor:function(e){this._super(),this.setAnchorPoint2(),this.setCascadeOpacityEnabled(!0),this.initialize(e)},getImage:function(e){return res["ice_block_"+e.lives+"_stable"]},initialize:function(e){
var t=this.image=new cc.Sprite(this.getImage(e));this.setContentSize2(t.getContentSize()),t.setPositionRound(this.width/2,this.height/2),this.addChild(t),this._super(e),this.cell.onChangeLivesListener=this.changeLives.bind(this),this.cell.onUpdate=this.updateImage.bind(this)},animate:function(e,t,i){var s=IceBlockAnimation.factory();s.setPosition(this.getPosition()),s.parent||this.parent.addChild(s),s.runAnimate(e,t,i,function(){this.image.visible=!1}.bind(this))},animateExplode:function(e){e=e||function(){},this.animate("0",e,new cc.FadeOut(.4)),cleverapps.audio.playSound(cleverapps.styles.IceBlockDecoratorCellView.dieSound)},changeLives:function(){this.cell.lives<=0||(this.animate("1",function(){0<this.cell.lives&&(this.image.setSpriteFrame(new cc.Sprite(this.getImage(this.cell)).getSpriteFrame()),this.image.setVisible(!0))}.bind(this)),cleverapps.audio.playSound(cleverapps.styles.IceBlockDecoratorCellView.stageDecreaseSound))},updateImage:function(){this.image.setSpriteFrame(
this.getImage(this.cell))}});cleverapps.styles.IceBlockDecoratorCellView={stageDecreaseSound:bundles.ice_block.urls.ice_block_live_effect,dieSound:bundles.ice_block.urls.ice_block_explode_effect};var BoxDecoratorCellView=DecoratorCellView.extend({ctor:function(e){this._super();var t=res["box_stable"+e.lives+"_png"];this.image=new cc.Sprite(t),this.setContentSize(this.image.getContentSize()),this.image.setPosition(this.width/2,this.height/2),this.addChild(this.image),this.initialize(e),this.cell.onChangeLivesListener=this.changeLives.bind(this)},finishSmile:function(){this.smiling&&(this.smiling.finishAnimation(),this.smiling=!1,this.image.setVisible(!0))},changeParent:function(e){this.smiling&&this.finishSmile(),this.replaceParent(e)},createAnimation:function(e){var t=BaseAnimation.factoryLimited(bundles.box.jsons.box_spine_json);return e?(t.setPosition(this.getPosition()),this.parent.addChild(t)):(t.setPosition(this.width/2,this.height/2),this.addChild(t)),t},changeLives:function(){
if(!(this.cell.lives<=0)&&this.cell.alive)if(cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW){if(this.finishSmile(),this.livesAnimation){var e=this.livesAnimation;this.runAsync(function(){e.isRunningSafe()&&e.setVisible(!1),e.finishAnimation()})}var t=this.livesAnimation=this.createAnimation(),i="open"+(this.cell.lives+1);t.runAnimate(i,function(){this.cell&&this.image.setSpriteFrame(res["box_stable"+Math.max(1,this.cell.lives)+"_png"]),this.image.visible=!0,delete this.livesAnimation}.bind(this),this.image),cleverapps.audio.playSound(bundles.box.urls["hurt_effect_"+(this.cell.lives+1)])}else this.image.setSpriteFrame(res["box_stable"+this.cell.lives+"_png"])},unuse:function(){this.cell.onChangeLivesListener=function(){},this._super.call(this)},smile:function(){if(!this.smiling&&cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW){this.smiling=this.createAnimation();var e=1===this.cell.lives?"smile":"smile"+this.cell.lives;this.smiling.runAnimate(e,
this.finishSmile.bind(this),this.image)}},animateExplode:function(e){this.finishSmile();var t=this.createAnimation(!0);cleverapps.audio.playSound(bundles.game.urls.box_decorator_die_effect),t.runAnimate("open",!1,new cc.FadeOut(.5)),t.runAction(new cc.CallFunc(function(){e()}.bind(this)))}}),MultiColorCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),this.animation=new cleverapps.Spine(res.multicolor_animation_json,1),this.animation.setPosition(this.width/2,this.height/2),this.addChild(this.animation),this.animation.setAnimation(0,"idle",!0),this.initialize(e)},initialize:function(e){BaseCellView.initialize.call(this,e),this.animation&&(this.stopAllActions(),this.animation.visible=!0,this.animation.setAnimation(0,"idle",!0),this.animation.setCompleteListener(function(){}))},createAnimation:function(){
this.animation.visible=!1,this.animation.setCompleteListener(function(){this.animation.setAnimation(0,"idle",!0)}.bind(this)),this.animation.setAnimation(0,"enter",!1),cleverapps.audio.playSound(bundles.game.urls.create_multicolor_effect)},startExploding:function(e){this.stopAllActions(),this.setLocalZOrder(100);var t=cleverapps.styles.MultiColorCellView,i=new cc.CallFunc(function(){this.animation.setCompleteListener(function(){this.animation.setVisible(!1),this.delete()}.bind(this)),this.animation.setAnimation(0,"exit",!1)}.bind(this));if(t.centerAnimation){var s=new cc.Spawn(new cc.MoveTo(t.centerAnimation.duration,this.getParent().width/2,this.getParent().height/2),new cc.ScaleTo(t.centerAnimation.duration,t.centerAnimation.scale));i=new cc.Sequence(s,i)}this.runAction(i),Game.currentGame&&Game.currentGame.shakeField(t.shakeField),cleverapps.audio.playSound(bundles.game.urls.multicolor_use_effect)}}));cleverapps.styles.MultiColorCellView={shakeField:{delay:400},centerAnimation:{
duration:.25,scale:2}};var SuperMultiColorCellView=MultiColorCellView.extend({ctor:function(e){this._super(e),this.setScale(1.2)},createAnimation:function(){cleverapps.audio.playSound(bundles.game.urls.create_multicolor_effect);var e=new cleverapps.Spine(res.blast_spine_json,1);e.setLocalZOrder(100),e.setPosition(this.width/2,this.height/2),this.addChild(e),e.setCompleteListenerRemove(),e.setAnimation(0,"animation",!1)}}),ColorFulAnimationView=cc.Node.extend({ctor:function(){this._super(),this.setLocalZOrder(15),this.animation=new cleverapps.Spine(res.multicolor_field_animation_json,1),this.addChild(this.animation)},animate:function(e){this.animation.setCompleteListener(function(){cc.pool.putInPool(this),e()}.bind(this)),this.animation.setAnimation(0,"animation",!1)},unuse:function(){this.removeFromParent(!1)}});ColorFulAnimationView.fillPool=function(){if(cleverapps.styles.ColorFulAnimationView.active)for(var e=0;e<cleverapps.styles.ColorFulAnimationView.animations.number;e++
)cc.pool.putInPool(new ColorFulAnimationView)},ColorFulAnimationView.factory=function(){return cc.pool.hasObject(ColorFulAnimationView)?cc.pool.getFromPool(ColorFulAnimationView):void 0},cleverapps.styles.ColorFulAnimationView={active:!0,animations:{number:3}};var FishCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage());this.image=t,this.image.setPosition(this.width/2,this.height/2),this.addChild(t),this.setCascadeOpacityEnabled(!0),this.initialize(e)},getImage:function(){return res.cell_fish},initialize:function(e){BaseCellView.initialize.call(this,e),e.onBeforeExplodeListener=this.startExplodingViaCollect.bind(this),this.image.setVisible(!0),this.smiling=!1},finishSmile:function(){this.smiling&&(this.smiling=!1,this.animation.finishAnimation(),this.image.visible=!0)},
runAnimate:function(e){this.animation=BaseAnimation.factory(res.fish_spine_json),this.animation.setPosition(this.width/2,this.height/2),this.animation.runAnimate(e,this.finishSmile.bind(this),this.image),this.addChild(this.animation)},smile:function(){this.smiling||(this.smiling=!0,this.runAnimate("animation"))},onclick:function(){this.finishSmile(),this.smiling=!0,this.runAnimate(cleverapps.styles.FishCellView.onclickAnimation)}}));cleverapps.styles.FishCellView={onclickAnimation:"smile"};var CookieManCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage());this.image=t,this.image.setPosition(this.width/2,this.height/2),this.addChild(t),cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&(this.animation=new cleverapps.Spine(bundles.cookieman.jsons.cookieman_spine_json,1)
,this.animation.setPosition(this.width/2,this.height/2),this.addChild(this.animation)),this.setCascadeOpacityEnabled(!0),this.initialize(e)},getImage:function(){return bundles.cookieman.frames.cookieman_stable},initialize:function(e){BaseCellView.initialize.call(this,e),e.onBeforeExplodeListener=this.startExplodingViaCollect.bind(this),this.image.setVisible(!0),this.animation&&this.animation.setVisible(!1),this.smiling=!1},swapImageToAnimation:function(){this.runAction(new cc.CallFunc(function(){this.image.visible=!1,this.animation.visible=!0}.bind(this)))},finishSmile:function(){this.smiling&&(this.smiling=!1,this.image.visible=!0,this.animation.visible=!1)},smile:function(){this.animation&&(this.smiling||(this.smiling=!0,this.animation.setCompleteListener(this.finishSmile.bind(this)),this.animation.setAnimation(0,"animation",!1),this.swapImageToAnimation()))},onclick:function(){this.animation&&(this.smiling=!0,this.animation.setCompleteListener(this.finishSmile.bind(this)),
this.animation.setAnimation(0,"smile",!1),this.swapImageToAnimation())},cookieUp:function(e){var t=this.getLocalZOrder();if(this.animation)this.setLocalZOrder(3),this.smiling=!0,this.animation.setCompleteListener(function(){e(),this.finishSmile(),this.setLocalZOrder(t)}.bind(this)),this.animation.setAnimation(0,"up",!1),this.swapImageToAnimation();else{this.setLocalZOrder(3);var i=BaseCellView.alignInTheGrid(this.cell.x,this.cell.y);this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.MoveTo(.5,i),new cc.CallFunc(function(){this.setLocalZOrder(t),e()}.bind(this))))}}})),LiveLineCellView={generateLive:function(e){var t=this.getStyles();this.startLives=e.lives;var i=new cc.Sprite(res.cell_life2_bg),s=new cc.Sprite(res.cell_life_bg),n=0;t.lives.additionalDx&&(n=t.lives.additionalDx),t.lives.scale&&i.setScale(t.lives.scale),i.setPosition(this.width/2+s.width+n,t.lifeBg.dy),this.addChild(i);var o=0;t.lives.circleGap&&(o=t.lives.circleGap),s.setAnchorPoint2(),s.setPosition(-s.width/2-o
,i.height/2),s.setLocalZOrder(3),t.circle.scale&&s.setScale(t.circle.scale),i.addChild(s);var a=new ScaledProgressBar(res.cell_life);a.setAnchorPoint2(),a.setPosition(s.width/2+t.circle.dx,t.circle.dy),a.setDimension(t.bar.width,t.bar.height),this.bar=a,i.addChild(a),this.livesTxt=new cleverapps.UI.ImageFont("white_digit_",""+this.startLives),this.livesTxt.setColor(cleverapps.styles.COLORS.MOUSE_LIFE_COLOR),this.livesTxt.setPosition(s.width/2,s.height/2),s.addChild(this.livesTxt),this.updateLivesTextSize(e),this.lifeBg=i},refuse:function(){if(0===this.cellWithoutLive.getRotation()){this.cellWithoutLive.runAction(new cc.Sequence(new cc.RotateBy(.1,-3).easing(cc.easeIn(1)),new cc.RotateBy(.2,6).easing(cc.easeIn(1)),new cc.RotateTo(.1,0)).easing(cc.easeIn(1)))}},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeLivesListener=this.changeLives.bind(this)},updateLivesTextSize:function(e){e.lives<10?this.livesTxt.setScale(.7):this.livesTxt.setScale(.55)},
changeLives:function(){this.reverseLive?this.bar.setPercentage(100*(this.startLives-this.cell.lives)/this.startLives):this.bar.setPercentage(100*this.cell.lives/this.startLives),this.livesTxt.setString(""+this.cell.lives),this.updateLivesTextSize(this.cell)},unuse:function(){this.cell.onChangeLivesListener=function(){},BaseCellView.unuse.call(this)},startExploding:function(){this.lifeBg&&(this.lifeBg.removeFromParent(!0),this.lifeBg=void 0),(Game.currentGame.goals.inGoals(this.cell)?BaseCellView.startExplodingViaCollect:BaseCellView.startExploding).apply(this,arguments)}},EaterCellView=BigCellView.extend(cleverapps.extend({},LiveLineCellView,{ctor:function(e){if(this._super(),e.isHead){this.reverseLive=!0;var t=this.getStyles();if(this.setContentSize2(t.width,t.height),this.setAnchorPoint(.5,.5),this.cellWithoutLive=new cc.Node,this.addChild(this.cellWithoutLive),this.cellWithoutLive.setContentSize2(t.width,t.height),e.isForGoal){this.setContentSize(t.goal.width,t.goal.height),
this.cellWithoutLive.setContentSize(t.goal.width,t.goal.height);var i=bundles[e.bundleId()].frames.eater_goal_png;void 0===i?(this.createEaterSpineContent(e),t.goal.animation&&t.goal.animation.scale&&this.animation.setScale(t.goal.animation.scale)):(this.image=new cc.Sprite(i),this.image.setAnchorPoint2(0,0),this.setPosition(this.width/2,this.height/2),this.cellWithoutLive.addChild(this.image),t.goal.image&&t.goal.image.scale&&this.image.setScale(t.goal.image.scale))}else this.generateLive(e),this.createEaterSpineContent(e);this.cellWithoutLive.setAnchorPoint(.5,.5),this.cellWithoutLive.setPositionRound(this.width/2,this.height/2),this.initialize(e),this.setPosition(BaseCellView.alignInTheGrid(e.x+.5,e.y+.5))}},getCenterPosition:function(){return this.getPosition()},getStyles:function(){return cleverapps.styles.EaterCellView},initialize:function(e){LiveLineCellView.initialize.call(this,e),e.onShowupViewListener=function(){return this}.bind(this)},createEaterSpineContent:function(e){
this.animation=new cleverapps.Spine(bundles[e.bundleId()].jsons.eater_spine_json,1),this.cellWithoutLive.addChild(this.animation),this.goIdle(),this.animation.setPosition(this.width/2,this.height/2)},unuse:function(){this.cell.onShowupViewListener=function(){},LiveLineCellView.unuse.call(this)},goIdle:function(){this.inHurt=!1,this.getStyles().idleAnimation&&this.animation.setAnimation(0,"idle",!0)},hurtAnimation:function(){this.inHurt||(this.inHurt=!0,this.animation.setCompleteListener(this.goIdle.bind(this)),this.animation.setAnimation(0,"collect",!1)),cleverapps.audio.playSound(bundles.game.urls.flower_open_effect)},getCollectFlyPoints:function(e){var t,i=this.getCenterPosition(),s=this.getStyles();return i.y+=s.collect.target.y,t=cc.p(i.x,i.y+s.collect.y),[cc.p((e.x+t.x)/2,(e.y+t.y)/2),t,i]},collect:function(e,t,i,s){cleverapps.audio.playSound(bundles.game.urls.cell_collect_effect,{throttle:200}),e.stopAllActions(),e.setLocalZOrder(10);var n=this.getCollectFlyPoints(e,i),
o=this.getStyles();e.runAction(new cc.Sequence(new cc.Spawn(new cc.MoveBy(Goals.UP_DURATION,0,o.collect.up)),new cc.DelayTime(t.waitDuration),new cc.Spawn(new cc.BezierTo(t.duration-Goals.UP_DURATION-t.waitDuration,n).easing(cc.easeIn(1)),new cc.ScaleTo(t.duration-Goals.UP_DURATION-t.waitDuration,o.collect.scale)),new cc.CallFunc(function(){cleverapps.goalCollectSound(this),s()}.bind(this))))}}));cleverapps.styles.EaterCellView={width:240,height:240,idleAnimation:!0,lives:{scale:1.3,additionalDx:-10},lifeBg:{dy:30},circle:{dx:-17,dy:2,scale:1.12},goal:{width:120,height:120,animation:{scale:.5}},hover:{y:10},collect:{y:300,up:30,scale:.5,target:{y:0}},bar:{width:110,height:7}},cc.sys.isMobile&&(cleverapps.styles.EaterCellView.circle.scale=1.5,cleverapps.styles.EaterCellView.lifeBg.dy=40,cleverapps.styles.EaterCellView.lives.additionalDx=-4,cleverapps.styles.EaterCellView.lives.circleGap=4);var BlanketCellView=EaterCellView.extend({ctor:function(e){this._super(e),this.blanketCell=e,
this.blanketCell.deleteView=this.deleteView.bind(this),e.isHead&&(e.isForGoal||(this.setAnchorPoint(0,0),this.setPositionRound(BaseCellView.alignInTheGrid(e.x,e.y)),this.setContentSize(e.cols*cleverapps.styles.BaseCellView.CELL_SIZE_PX,e.rows*cleverapps.styles.BaseCellView.CELL_SIZE_PX)))},getStyles:function(){return cleverapps.styles.BlanketCellView},createEaterSpineContent:function(e){var t=new cc.Node;t.setAnchorPoint(0,0),this.allCells=[];for(var i=0;i<e.rows;i++){for(var s=[],n=0;n<e.cols;n++){var o=new cleverapps.Spine(bundles.blanket.jsons.wrapper_spine1_json,1);t.addChild(o),o.setAnimation(0,"idle",!0),o.setPositionRound(n*cleverapps.styles.BaseCellView.CELL_SIZE_PX,-i*cleverapps.styles.BaseCellView.CELL_SIZE_PX),s.push(o)}this.allCells.push(s)}this.addChild(t);var a=(e.cols-1)*cleverapps.styles.BaseCellView.CELL_SIZE_PX/2,r=-(e.rows-1)*cleverapps.styles.BaseCellView.CELL_SIZE_PX/2,l=this.elementNode=new cc.Node;l.setPosition(a,r);var c=this.tartlet=new cc.Sprite(
bundles.blanket.frames.tartlet_png);c.setAnchorPoint(.5,.5),l.addChild(c),c.setScale(this.getStyles().centerImageTartlet.scale);var p=e.getAcceptedColors();if(p&&!(p&&p.length<=0)){var d=this.item=new cc.Sprite(bundles.game.frames["cell_"+p[0]]);d.setAnchorPoint(.5,.5),l.addChild(d),d.setPosition(0,this.getStyles().centerImageElement.dy),d.setScale(this.getStyles().centerImageElement.scale);var h=this.tartlet2=new cc.Sprite(bundles.blanket.frames.tartlet2_png);h.setAnchorPoint(.5,.5),l.addChild(h),h.setScale(this.getStyles().centerImageTartlet2.scale),this.addChild(l),this.lifeBg.setAnchorPoint(.5,.5),this.lifeBg.setPositionRound(a+this.getStyles().LiveLine.dx,r-d.height/1.2+this.getStyles().LiveLine.dy),this.lifeBg.setLocalZOrder(1)}},getCenterPosition:function(){var e=BaseCellView.alignInTheGrid(this.blanketCell.x,this.blanketCell.y),t=this.blanketCell.getCenterVector();return e.x+=t.x,e.y+=t.y,e},hurtAnimation:function(){if(!this.onHurtAnimating){this.onHurtAnimating=!0
;this.elementNode.runAction(new cc.Sequence(new cc.ScaleTo(.05,1.2).easing(cc.easeIn(1)),new cc.ScaleTo(.05,1).easing(cc.easeIn(1)),new cc.CallFunc(function(){this.onHurtAnimating=!1}.bind(this)))),cleverapps.audio.playSound(bundles.game.urls.blanket_cell_stage_decrease_effect)}},deleteView:function(){for(var e=0;e<this.blanketCell.rows;e++)for(var t=0;t<this.blanketCell.cols;t++)this.allCells[e][t].replaceParentSamePlace(this.parent),this.allCells[e][t].setAnimation(0,"animation",!1),this.allCells[e][t].setLocalZOrder(100);this.runAction(new cc.Sequence(new cc.DelayTime(this.blanketCell.explodeDuration()),new cc.RemoveSelf)),cleverapps.audio.playSound(bundles.game.urls.blanket_cell_die_effect)}});cleverapps.styles.BlanketCellView=cleverapps.overrideStyles(cleverapps.styles.EaterCellView,{width:120,height:120,idleAnimation:!0,goal:{width:120,height:120,image:{scale:.8}},centerImageTartlet:{scale:.96},centerImageElement:{scale:1.46,dy:13},centerImageTartlet2:{scale:.96},LiveLine:{dx:20,
dy:16}},!0),cc.sys.isMobile&&(cleverapps.styles.BlanketCellView.LiveLine.dx=28,cleverapps.styles.BlanketCellView.LiveLine.dy=20);var DragonCellView=BigCellView.extend(cleverapps.extend({},LiveLineCellView,{ctor:function(e){if(this._super(),e.isHead){this.reverseLive=!0;var t=this.getStyles();this.setContentSize2(t.width,t.height),this.setAnchorPoint(.5,.5),this.cellWithoutLive=new cc.Node,this.addChild(this.cellWithoutLive),this.cellWithoutLive.setContentSize2(t.width,t.height),this.animation=new cleverapps.Spine(bundles.dragon.jsons.dragon_spine_json,1),this.cellWithoutLive.addChild(this.animation),this.lastSmileTime=0,e.isForGoal?(this.setContentSize(t.goal.width,t.goal.height),this.cellWithoutLive.setContentSize2(t.goal.width,t.goal.height),this.image=new cc.Sprite(bundles.dragon.frames.dragon_stable_goal_png),this.image.setScale(.7),this.cellWithoutLive.addChild(this.image),this.image.setPosition(this.width/2,this.height/2),this.animation.setPosition(this.width/2,this.height/2),
this.animation.setScale(.7),this.goalType=!0):(this.image=new cc.Sprite(bundles.dragon.frames.dragon_stable_png),this.cellWithoutLive.addChild(this.image),this.image.setPosition(this.width/2,this.height/2),this.animation.setPosition(this.width/2,this.height/2),this.generateLive(e),this.goalType=!1),this.animation.setStartVisibleListener(function(){this.image.visible=!1}.bind(this)),this.cellWithoutLive.setAnchorPoint(.5,.5),this.cellWithoutLive.setPositionRound(this.width/2,this.height/2),this.initialize(e),this.setPosition(BaseCellView.alignInTheGrid(e.x+.5,e.y+.5))}},getStyles:function(){return cleverapps.styles.DragonCellView},finishAnimating:function(){this.animating&&(this.animating=!1,this.image.visible=!0,this.animation.visible=!1)},finishSmile:function(){cleverapps.styles.DragonCellView.smile.active&&this.finishAnimating()},smile:function(){this.animating||cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&(this.lastSmileTime>Date.now(
)-5e3||cleverapps.styles.DragonCellView.smile.active&&(this.lastSmileTime=Date.now(),this.animating=!0,this.animation.setCompleteListener(this.finishSmile.bind(this)),this.goalType?this.animation.setAnimation(0,"smile_0",!1):this.animation.setAnimation(0,"smile_1",!1)))},initialize:function(e){LiveLineCellView.initialize.call(this,e),e.onOpenAnimation=this.openAnimation.bind(this)},unuse:function(){this.cell.onOpenAnimation=function(){},LiveLineCellView.unuse.call(this)},hurtAnimation:function(){0<this.cell.lives&&(this.animating=!0,this.animation.setCompleteListener(this.finishAnimating.bind(this)),this.animation.setAnimation(0,"hit",!1),cleverapps.audio.playSound(bundles.dragon.urls.dragon_hit_effect||bundles.game.urls.nut_effect))},openAnimation:function(){this.animating=!0,this.animation.setCompleteListener(function(){cleverapps.styles.DragonCellView.flyToGoalAnimation.active?this.animation.setAnimation(0,"fly_to_goal",!0):this.finishAnimating()}.bind(this)),
this.animation.setAnimation(0,"open",!1),this.image.setSpriteFrame(bundles.dragon.frames.dragon_stable_goal_png),this.goalType=!0,this.lifeBg&&(this.lifeBg.removeFromParent(!0),this.lifeBg=void 0),cleverapps.audio.playSound(bundles.dragon.urls.dragon_collect_effect||bundles.game.urls.nut_effect)}}));cleverapps.styles.DragonCellView={width:240,height:240,lives:{scale:1.3,additionalDx:-10},lifeBg:{dy:30},circle:{dx:-17,dy:2,scale:1.12},goal:{width:120,height:120},hover:{y:10},smile:{active:!0},flyToGoalAnimation:{active:!1},bar:{width:110,height:7}},cc.sys.isMobile&&(cleverapps.styles.DragonCellView.circle.scale=1.5,cleverapps.styles.DragonCellView.lifeBg.dy=40,cleverapps.styles.DragonCellView.lives.additionalDx=-4,cleverapps.styles.DragonCellView.lives.circleGap=4);var BombCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){if(this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),
this.setAnchorPoint(.5,.5),void 0===e.x){var t=new cc.Sprite(bundles.bomb.frames.bomb_goal);return this.addChild(t),void t.setPositionRound(this.width/2,this.height/2)}this.container=new cc.Node,this.container.setAnchorPoint(.5,.5),this.container.setPositionRound(this.width/2,this.height/2),this.addChild(this.container);t=new cc.Sprite(this.getImage(e));this.image=t,this.image.setPositionRound(0,0),this.container.addChild(t),this.animation=new cleverapps.Spine(bundles.bomb.jsons.bomb_spine_json,1),this.animation.setVisible(!1),this.updateAnimationSkin(e),this.animation.setPositionRound(0,0),this.container.addChild(this.animation),this.timerTxt=new cleverapps.UI.generateTTFText("",cleverapps.styles.FONTS.BOMB_TIMER_TEXT),this.timerTxt.setPositionRound(cleverapps.styles.BombCellView.timer),this.timerTxt.setAnchorPoint2(),this.container.addChild(this.timerTxt),this.initialize(e),this.state=void 0,this.onUntilExplodeChanged(),this.setCascadeOpacityEnabled(!0),
this.container.setCascadeOpacityEnabled(!0)},getImage:function(e){return this.isDanger(e)?bundles.bomb.frames["bomb_danger_"+e.color]:bundles.bomb.frames["bomb_"+e.color]},isDanger:function(e){return e.untilExplode<=3},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeColor=this.onColorChanged.bind(this),e.onChangeUntilExplode=this.onUntilExplodeChanged.bind(this),e.onBoom=this.boom.bind(this),Game.currentGame.started?this.setScale(1):this.setScale(0)},unuse:function(){this.cell.onChangeColor=function(){},this.cell.onChangeUntilExplode=function(){},this.cell.onBoom=function(){},BaseCellView.unuse.call(this)},boom:function(){Game.counter.setTimeout(function(){cleverapps.audio.playSound(cleverapps.styles.BombCellView.boomSound)},100)},reuse:function(e){BaseCellView.reuse.call(this,e),this.state=void 0,this.onColorChanged()},onEnterTransitionDidFinish:function(){this._super(),this.cell&&this.onUntilExplodeChanged()},startExploding:function(){
Game.currentGame.goals.inGoals(this.cell)?BaseCellView.startExplodingViaCollect.apply(this,arguments):BaseCellView.startExploding.apply(this,arguments),cleverapps.audio.playSound(cleverapps.styles.BombCellView.dieSound)},updateImageTexture:function(){this.image.setSpriteFrame(this.getImage(this.cell))},updateAnimationSkin:function(e){this.animation.setSkin("skin_"+e.color)},onColorChanged:function(){this.updateImageTexture(),this.updateAnimationSkin(this.cell)},onUntilExplodeChanged:function(){if(this.isDanger(this.cell)){if(this.state!==BombCellView.DANGER){this.state=BombCellView.DANGER,this.updateImageTexture(),this.timerTxt.setFont(cleverapps.styles.FONTS.BOMB_TIMER_DANGER_TEXT);var e=cleverapps.styles.BombCellView,t=e.danger.duration;this.container.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(t,e.danger.scale),new cc.ScaleTo(t,1))))}}else this.state!==BombCellView.SIMPLE&&(this.state=BombCellView.SIMPLE,this.updateImageTexture(),this.timerTxt.setFont(
cleverapps.styles.FONTS.BOMB_TIMER_TEXT),this.container.stopAllActions());10<=this.cell.untilExplode?this.timerTxt.setScale(.9):this.timerTxt.setScale(1),this.timerTxt.setString(""+this.cell.untilExplode)},finishSmile:function(){this.smiling&&(this.smiling=!1,this.image.visible=!0,this.animation.visible=!1)},smile:function(){cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&(this.smiling||(this.smiling=!0,this.animation.setCompleteListener(this.finishSmile.bind(this)),this.animation.setStartVisibleListener(function(){this.image.visible=!1}.bind(this)),this.isDanger(this.cell)?this.animation.setAnimation(0,"animation",!1):this.animation.setAnimation(0,"stay",!1)))}}));cleverapps.overrideColors(cleverapps.styles.COLORS,{BOMB_TIMER_COLOR:new cc.Color(130,70,40,255),BOMB_TIMER_DANGER_COLOR:new cc.Color(255,50,50,255)}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{BOMB_TIMER_TEXT:{prefix:"bomb#white_digit_",color:cleverapps.styles.COLORS.BOMB_TIMER_COLOR},
BOMB_TIMER_DANGER_TEXT:{prefix:"bomb#white_digit_",color:cleverapps.styles.COLORS.BOMB_TIMER_DANGER_COLOR}}),cleverapps.styles.BombCellView={timer:{x:2,y:-24},danger:{scale:1.2,duration:.6},boomSound:bundles.bomb.urls.bomb_explosion,growUpSound:res.special_element_grow_up,dieSound:res.special_element_die},BombCellView.SIMPLE=0,BombCellView.DANGER=1;var DirtDecoratorCellView=DecoratorCellView.extend({ctor:function(e){this._super();var t=res.cell_dirt;e.isForGoal&&res.cell_dirt_goal&&(t=res.cell_dirt_goal),this.image=new cc.Sprite(t),this.image.setPosition(this.width/2,this.height/2),this.addChild(this.image),e.isForGoal||this.initialize(e)},initialize:function(e){e.onCreate&&(this.image.visible=!1),DecoratorCellView.prototype.initialize.call(this,e),e.onCreateNew=this.animateCreateNew.bind(this)},unuse:function(){this.cell.onCreateNew=function(){},DecoratorCellView.prototype.unuse.call(this)},finishSmile:function(){this.animation&&(this.animation.finishAnimation(),this.animation=!1,
this.image.setVisible(!0))},animate:function(e,t,i){this.finishSmile(),this.animation=DirtAnimation.factory(),this.animation.setPosition(this.width/2,this.height/2),this.addChild(this.animation),this.animation.runAnimate(e,function(){this.animation=!1,this.image.visible=!0,t&&t()}.bind(this),i,this.image)},animateCreateNew:function(e){cleverapps.audio.playSound(bundles.game.urls.dirt_decorator_grow_up_effect);var t=new cc.Sequence(new cc.CallFunc(function(e){e.setOpacity(0)}),new cc.FadeIn(.5));this.animate(e,!1,t,this.image)},animateExplode:function(e){this.setLocalZOrder(0),this.animate("out",e,new cc.FadeOut(.7)),cleverapps.audio.playSound(bundles.game.urls.dirt_decorator_die_effect)}}),DirtAnimation=BaseAnimation.extend({ctor:function(){this._super(res.dirt_spine_json,res.cell_dirt)}});DirtAnimation.factory=function(){return cc.pool.hasObject(DirtAnimation)?cc.pool.getFromPool(DirtAnimation):new DirtAnimation};var CrabDecoratorCellView=DecoratorCellView.extend({ctor:function(e){
this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=res.cell_crab;e.isForGoal&&res.cell_crab_goal&&(t=res.cell_crab_goal),this.image=new cc.Sprite(t),e.isForGoal&&cleverapps.styles.CrabDecoratorCellView.goalImage&&cleverapps.styles.CrabDecoratorCellView.goalImage.scale&&this.image.setScale(cleverapps.styles.CrabDecoratorCellView.goalImage.scale);var i=0;e.isForGoal&&cleverapps.styles.CrabDecoratorCellView.goalImage&&cleverapps.styles.CrabDecoratorCellView.goalImage.dy&&(i=cleverapps.styles.CrabDecoratorCellView.goalImage.dy),this.image.setPosition(this.width/2,this.height/2+i),this.addChild(this.image),e.isForGoal||this.initialize(e)},initialize:function(e){DecoratorCellView.prototype.initialize.call(this,e),this.cell.onCrabMove=this.animateMove.bind(this),this.cell.onCrabFinishMove=this.animateFinishMove.bind(this),cleverapps.Random.random(2
)&&!e.createdByCrabMaker||this.image.setScaleX(-1)},unuse:function(){this.cell.onCrabMove=function(){},this.cell.onCrabFinishMove=function(){},DecoratorCellView.prototype.unuse.call(this)},finishSmile:function(){this.animation&&(this.animation.finishAnimation(),this.animation=!1,this.image.setVisible(!0))},smile:function(){cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&(this.animation||this.animate("animation"))},animate:function(e,t,i){this.finishSmile(),this.animation=CrabAnimation.factory(),this.animation.setPosition(this.width/2,this.height/2),this.animation.setScaleX(this.image.getScaleX()),this.addChild(this.animation),this.animation.runAnimate(e,function(){this.animation=!1,this.image.visible=!0,t&&t()}.bind(this),i,this.image)},animateExplode:function(e){this.setLocalZOrder(0),this.animate("death",e,new cc.Spawn(new cc.ScaleTo(.5,0),new cc.RotateBy(.5,360))),cleverapps.audio.playSound(bundles.game.urls.crab_decorator_die_effect)},animateFinishMove:function(e){
this.stopAllActions(),this.setPosition(BaseCellView.alignInTheGrid(e.x,e.y))},animateMove:function(e,t,i){0!==i&&this.image.setScaleX(i),this.setLocalZOrder(0),this.runAction(new cc.MoveTo(t,BaseCellView.alignInTheGrid(e.x,e.y))),this.animate("walk");cleverapps.styles.CrabDecoratorCellView;cleverapps.audio.playSound(bundles.game.urls.crab_decorator_move_effect,{throttle:200})}});cleverapps.styles.CrabDecoratorCellView={};var CrabAnimation=BaseAnimation.extend({ctor:function(){this._super(res.crab_spine_json,res.cell_crab)}});CrabAnimation.factory=function(){return cc.pool.hasObject(CrabAnimation)?cc.pool.getFromPool(CrabAnimation):new CrabAnimation};var FlowerCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage(e.lives));this.image=t,this.image.setPosition(this.width/2,this.height/2
),this.addChild(t),this.initialize(e)},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeLivesListener=this.changeLives.bind(this),this.changeLives()},getImage:function(e){return res["flower_cell_"+e]},changeLives:function(){this.image.setSpriteFrameAsync(this.getImage(this.cell.lives))},unuse:function(){this.cell.onChangeLivesListener=function(){},BaseCellView.unuse.call(this)},finishAnimation:function(){this.animation&&(this.animation.finishAnimation(),delete this.animation),this.isAnimationRunning=!1,this.image.visible=!0},runAnimate:function(e){this.isAnimationRunning=!0,this.animation=BaseAnimation.factoryLimited(res.flower_spine_json),this.animation.setPosition(this.width/2,this.height/2),this.addChild(this.animation),this.animation.runAnimate(e,this.finishAnimation.bind(this),this.image)},hurtAnimation:function(){this.isAnimationRunning||(this.runAnimate(FlowerAnimationView.animations[this.cell.lives]),cleverapps.audio.playSound(
bundles.game.urls.flower_open_effect))},startExploding:function(){(Game.currentGame.goals.inGoals(this.cell)?BaseCellView.startExplodingViaCollect:BaseCellView.startExploding).apply(this,arguments)}})),GingerHouseCellView=BigCellView.extend({ctor:function(e){if(this._super(),e.isHead){e.onCollectPartListener=this.collectPart.bind(this);var t=cleverapps.styles.GingerHouseCellView;if(this.setContentSize2(t.width,t.height),this.setAnchorPoint(.5,.5),e.isForGoal)this.setContentSize(t.goal.width,t.goal.height),this.image=new cc.Sprite(bundles.gingerbread_house.frames.ginger_house_goal_png),this.image.setScale(.8),this.image.setPosition(this.width/2,this.height/2),this.addChild(this.image);else for(var i in this.image=new cc.Sprite(bundles.gingerbread_house.frames.ginger_house_slot_png),this.image.setPosition(this.width/2,this.height/2),this.addChild(this.image),this.partsImages={},this.partsImages[GingerHousePartCell.TYPES.WALL]=new cc.Sprite(
bundles.gingerbread_house.frames.ginger_house_wall_png),this.partsImages[GingerHousePartCell.TYPES.DOOR]=new cc.Sprite(bundles.gingerbread_house.frames.ginger_house_door_png),this.partsImages[GingerHousePartCell.TYPES.WINDOW]=new cc.Sprite(bundles.gingerbread_house.frames.ginger_house_window_png),this.partsImages[GingerHousePartCell.TYPES.ROOF]=new cc.Sprite(bundles.gingerbread_house.frames.ginger_house_roof_png),this.partsImages){var s=this.partsImages[i],n=t.imageOffsets&&t.imageOffsets[i]||{x:0,y:0};s.setVisible(!1),s.setPosition(this.width/2+n.x,this.height/2+n.y),this.addChild(s)}this.initialize(e),this.setPosition(BaseCellView.alignInTheGrid(e.x+.5,e.y+.5))}},initialize:function(e){BaseCellView.initialize.call(this,e)},startExploding:function(){BaseCellView.startExplodingViaCollect.apply(this,arguments)},unuse:function(){this.cell.onCollectPartListener=function(){},BaseCellView.unuse.call(this)},getPartStyles:function(e){switch(e){case GingerHousePartCell.TYPES.DOOR:
return cleverapps.styles.GingerHouseCellView.door;case GingerHousePartCell.TYPES.ROOF:return cleverapps.styles.GingerHouseCellView.roof;case GingerHousePartCell.TYPES.WINDOW:return cleverapps.styles.GingerHouseCellView.window;case GingerHousePartCell.TYPES.WALL:return cleverapps.styles.GingerHouseCellView.wall}},getCollectFlyPoints:function(e){var t,i=this.getPosition(),s=this.getPartStyles(e.cell.type);i.x+=s.x,i.y+=s.y;var n=cleverapps.styles.GingerHouseCellView;return t=cc.p(i.x,i.y+n.collect.y),[cc.p((e.x+t.x)/2,(e.y+t.y)/2),t,i]},collectPart:function(e,t){var i=e.view;i.stopAllActions(),i.setLocalZOrder(10),cleverapps.audio.playSound(bundles.game.urls.cell_collect_effect,{throttle:200});var s=this.getCollectFlyPoints(i),n=cleverapps.styles.GingerHouseCellView,o=this.getPartStyles(e.type),a=o.scaleX,r=o.scaleY;t=t-Goals.UP_DURATION-Goals.WAIT_DURATION,i.runAction(new cc.Sequence(new cc.MoveBy(Goals.UP_DURATION,0,n.collect.up),new cc.DelayTime(Goals.WAIT_DURATION),new cc.Spawn(
new cc.BezierTo(t,s).easing(cc.easeIn(1)),new cc.ScaleTo(t,a,r)),new cc.CallFunc(function(){cleverapps.goalCollectSound(this),this.partsImages[e.type].setVisible(!0),void 0!==o.zOrder&&this.partsImages[e.type].setLocalZOrder(o.zOrder),i.delete()}.bind(this))))}});cleverapps.styles.GingerHouseCellView={width:240,height:240,goal:{width:120,height:120},smile:{active:!0},collect:{y:300,up:30},door:{x:-42,y:-68,scaleX:.95,scaleY:.95},window:{x:46,y:-58,scaleX:.85,scaleY:.85},roof:{x:-1,y:36,scaleX:2.1,scaleY:1.7},wall:{x:0,y:-40,scaleX:1.9,scaleY:1.5}};var GingerHousePartCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super();var t=cleverapps.styles.GingerHousePartCellView;this.setContentSize2(t.width,t.height),this.setAnchorPoint(.5,.5),this.image=new cc.Sprite(this.getImage(e)),this.addChild(this.image),this.image.setPosition(this.width/2,this.height/2),this.initialize(e),this.setPosition(BaseCellView.alignInTheGrid(e.x,e.y))},getImage:function(e){switch(
e.type){case GingerHousePartCell.TYPES.ROOF:return bundles.gingerbread_house.frames.ginger_house_part_roof_png;case GingerHousePartCell.TYPES.DOOR:return bundles.gingerbread_house.frames.ginger_house_part_door_png;case GingerHousePartCell.TYPES.WINDOW:return bundles.gingerbread_house.frames.ginger_house_part_window_png;case GingerHousePartCell.TYPES.WALL:return bundles.gingerbread_house.frames.ginger_house_part_wall_png}},initialize:function(e){BaseCellView.initialize.call(this,e),this.image.setSpriteFrame(this.getImage(e)),e.view=this,e.onBeforeExplodeListener=this.startExploding.bind(this)},unuse:function(){this.cell.view=void 0,this.cell.onBeforeExplodeListener=function(){},BaseCellView.unuse.call(this)},startExploding:function(){}}));cleverapps.styles.GingerHousePartCellView={width:120,height:120};var CrabMakerCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(e),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,
cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage(e.stage));t.setAnchorPoint2(),t.setPositionRound(this.width/2,this.height/2),this.addChild(t),this.image=t,cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&this.addAnimation(),this.initialize(e)},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeStage=this.changeStage.bind(this)},unuse:function(){this.cell.onChangeStage=function(){},BaseCellView.unuse.call(this)},addAnimation:function(){var e=new cleverapps.Spine(bundles.crab_maker.jsons.crab_maker_animation_json,1);e.setPosition(this.width/2,this.height/2),e.setStartVisibleListener(function(){this.image.visible=!1}.bind(this)),this.addChild(e),this.animation=e},getImage:function(e){return bundles.crab_maker.frames["crab_maker_stable_"+e]},changeStage:function(e){0!==this.cell.stage&&(cleverapps.settings.fpsMode===cleverapps.Settings.FPS_MODE_LOW?(this.image.setSpriteFrame(this.getImage(
this.cell.stage)),e&&e()):(this.animation||this.addAnimation(),this.animation.setCompleteListener(function(){this.image.setSpriteFrame(this.getImage(this.cell.stage)),this.image.visible=!0,this.animation.visible=!1,e&&e()}.bind(this)),this.animation.setAnimation(0,""+this.cell.stage,!1)),bundles.crab_maker.urls.fly_effect&&cleverapps.audio.playSound(bundles.crab_maker.urls.fly_effect))},hurtAnimation:function(){}})),FireworkCellView=ColorCellView.extend({ctor:function(e){this._super(e)},initialize:function(e){if(BaseCellView.initialize.call(this,e),void 0===e.x){var t=new cc.Sprite(res.firework_cell_goal);return this.addChild(t),void t.setPositionRound(this.width/2,this.height/2)}e.onOutburstListener=this.outburst.bind(this),this.animation||(this.animation=new cleverapps.Spine(res.firework_animation_json,1),this.animation.setPosition(this.width/2,this.height/2),this.addChild(this.animation)),this.updateImage(e),this.image.visible=!0,this.animation.visible=!1,this.animation.setSkin(
this.getSkin(e)),this.animation.setStartVisibleListener(function(){this.image.visible=!1}.bind(this)),this.originalZOrder=this.getLocalZOrder()},unuse:function(){this.cell.onOutburstListener=function(){},BaseCellView.unuse.call(this)},updateImage:function(e){this.image.setSpriteFrame(this.getImage(e))},getImage:function(e){return res["firework_cell_"+e.color]},getSkin:function(e){return"bombcup_"+{a:"blue",b:"green",c:"purple",d:"red",e:"yellow",w:"white"}[e.color]},collectToGoal:function(){var t=this.cell,i=Game.currentGame.goalsController.getViewByType(t.getGoalId());if(i){var s=new cc.Sprite(this.getImage(t));cc.director.getRunningScene().fieldView.addChild(s),s.setPositionRound(BaseCellView.alignInTheGrid(t.x,t.y)),s.setScale(0),s.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.ScaleTo(.3,1.2),new cc.CallFunc(function(){if(Game.currentGame){var e=Game.currentGame.goals.check(t,1,1);i.collect(s,e,1,function(){s.runAction(new cc.RemoveSelf)}.bind(this))}}.bind(this))))}},
outburst:function(p){if(this.collectToGoal(),0!==p.length){var d=cleverapps.styles.FireworkCellView;p.forEach(function(i,s){var e=this.getPosition(),n=BaseCellView.alignInTheGrid(i.x,i.y),o=cc.p(e.x,Math.max(e.y,n.y)+d.bomb.flyUp),a=cc.p(n.x,o.y),r=new cc.Sprite(bundles.game.frames.bomb_png);r.opacity=0,this.parent.addChild(r);var t=0;d.bomb.startDX&&(t+=d.bomb.startDX);var l=0;d.bomb.startDY&&(l+=d.bomb.startDY),r.setPosition(e.x+t,e.y+l);var c=new cleverapps.Spine(res.bomb_animation_json,1);c.setPosition(r.width/2,r.height/2),r.addChild(c),r.setLocalZOrder(21),this.setLocalZOrder(1),this.runAction(new cc.Sequence(new cc.DelayTime(FireworkCell.HURT_DELAY+s*FireworkCell.ANIMATION_DURATION),new cc.CallFunc(function(){this.animation.setAnimation(0,"animation",!1),s===p.length-1&&this.animation.setCompleteListener(function(){this.setLocalZOrder(this.originalZOrder)}.bind(this));var e=this.cell.getFlyDuration(i),t=i.x<this.cell.x?-180:180;cleverapps.audio.playSound(
bundles.game.urls.firework_explode),r.runAction(new cc.Sequence(new cc.DelayTime(FireworkCell.ANIMATION_DURATION),new cc.FadeIn(0),new cc.Spawn(new cc.BezierTo(e,[o,a,n]).easing(cc.easeIn(1)),new cc.RotateBy(e,t)),new cc.FadeOut(0))),c.runAction(new cc.Sequence(new cc.DelayTime(FireworkCell.ANIMATION_DURATION+e),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.bomb_by_left_moves_explosion_effect),c.setAnimation(0,"animation",!1),c.setCompleteListener(function(){r.runAction(new cc.RemoveSelf)}.bind(this))}.bind(this))))}.bind(this))))}.bind(this))}},createAnimation:function(e){if((e=e||{}).silent||(this.setScale(0),this.runAction(new cc.ScaleTo(.4,1).easing(cc.easeBackOut()))),cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW){var t=new cleverapps.Spine(res.story_light_animation_json,2);t.setAnimation(0,"animation",!0),t.setPositionRound(this.width/2+cleverapps.styles.FireworkCellView.light.x,this.height/2+cleverapps.styles.FireworkCellView.light.y),
t.setLocalZOrder(-1),this.addChild(t);var i=this.getLocalZOrder();i||(i=0),this.setLocalZOrder(3),t.runAction(new cc.Sequence(new cc.DelayTime(1.5),new cc.ScaleTo(.2,0),new cc.CallFunc(function(){this.setLocalZOrder(i)}.bind(this)),new cc.RemoveSelf))}}});cleverapps.styles.FireworkCellView={bomb:{flyUp:150},light:{x:-6,y:-14}};var CakeAnimation=BaseAnimation.extend({ctor:function(){this._super(bundles.cake.jsons.cake_splash_json)}});CakeAnimation.factory=function(){return cc.pool.hasObject(CakeAnimation)?cc.pool.getFromPool(CakeAnimation):new CakeAnimation};var CakeCellView=BigCellView.extend({ctor:function(e){this._super(e),e.isForGoal?this.initGoal(e):(e.isHead&&this.initHead(e),this.initialize(e))},initGoal:function(){var e=cleverapps.styles.CakeCellView;this.setAnchorPoint2(),this.setContentSize(e.goal.width,e.goal.height);var t=new cc.Sprite(bundles.cake.frames.cake_goal_png);t.setAnchorPoint2(),t.setPositionRound(this.width/2,this.height/2),t.setScaleX(-1),this.addChild(t)},
initHead:function(){var e=cleverapps.styles.CakeCellView;this.setContentSize2(e.width,e.height),this.setAnchorPoint2();var t=new cc.Sprite(bundles.cake.frames.plate_png);t.setAnchorPoint2(),t.setPositionRound(this.width/2,this.height/2),this.addChild(t);var i={1:{x:1,y:0},2:{x:0,y:0},3:{x:1,y:1},4:{x:0,y:1}},s={1:{x:this.width/4,y:3*this.height/4},2:{x:3*this.width/4,y:3*this.height/4},3:{x:this.width/4,y:this.height/4},4:{x:3*this.width/4,y:this.height/4}};this.images={};for(var n=1;n<=4;++n){var o=new cc.Sprite(bundles.cake.frames["cake_"+n+"_3_png"]);o.setAnchorPoint(i[n]),this.addChild(o);var a=s[n].x+(i[n].x-.5)*o.width,r=s[n].y+(i[n].y-.5)*o.height;o.setPositionRound(a,r),this.images[n]=o}},getStyles:function(){return cleverapps.styles.CakeCellView},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeLivesListener=this.changeLives.bind(this),this.setPositionRound(BaseCellView.alignInTheGrid(e.x+.5,e.y+.5))},unuse:function(){
this.cell.onChangeLivesListener=function(){},BaseCellView.unuse.call(this)},getImage:function(e){return e=e||this.cell,bundles.cake.frames["cake_"+e.part+"_"+e.lives+"_png"]},changeLives:function(e,t){if(this.cell.isHead){0<e.lives?this.images[e.part].setSpriteFrame(this.getImage(e)):this.images[e.part].visible=!1;var i=CakeAnimation.factory();i.setPosition(BaseCellView.alignInTheGrid(e.x,e.y)),i.parent||this.parent.addChild(i),i.runAnimate("animation");var s=new cc.Sprite(bundles.cake.frames.cake_goal_png);s.setPosition(BaseCellView.alignInTheGrid(e.x,e.y)),this.parent.addChild(s),s.setScale(.5),t.duration-=.4,t.waitDuration-=.4,s.runAction(new cc.Sequence(new cc.ScaleTo(.4,1).easing(new cc.easeBackOut),new cc.CallFunc(function(){Game.currentGame&&Game.currentGame.goalsController.getViewByType(t.type).collect(s,t,1,function(){s.isRunningSafe()&&s.runAction(new cc.RemoveSelf)})})))}},startExploding:function(){this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.ScaleTo(.3,0),
new cc.RemoveSelf))},hurtAnimation:function(){if(this.cell.isHead){this.runAction(new cc.Sequence(new cc.ScaleTo(.2,.9),new cc.ScaleTo(.2,1)))}}});cleverapps.styles.CakeCellView={width:240,height:240,goal:{width:120,height:120},hover:{y:10}};var BurstCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage(e.lives));this.image=t,this.image.setPosition(this.width/2,this.height/2),this.addChild(t),this.animation=new cleverapps.Spine(bundles.burst.jsons.burst_json,1),this.animation.setPosition(this.width/2,this.height/2),this.animation.setStartVisibleListener(function(){this.image.visible=!1}.bind(this)),this.addChild(this.animation),this.initialize(e)},getImage:function(e){return e=e||this.cell.lives,bundles.burst.frames["burst_"+(4-e)]},updateImage:function(){var e=this.getImage()
;void 0!==e&&this.image.setSpriteFrame(e)},initialize:function(e){BaseCellView.initialize.call(this,e),this.image.setVisible(!0),this.animation.setVisible(!1),e.onChangeLivesListener=this.changeLives.bind(this),e.onBurstListener=this.burstAnimation.bind(this)},animate:function(e,t,i){this.animation.setCompleteListener(i),this.animation.setAnimation(0,e,t)},finishAnimation:function(){this.updateImage(),this.image.setVisible(!0),this.animation.setVisibleAsync(!1)},changeLives:function(){0<this.cell.lives?this.cell.lives<BurstCell.MAX_LIVES?this.animate(""+(BurstCell.MAX_LIVES-this.cell.lives),!1,this.finishAnimation.bind(this)):this.updateImage():this.animate("4_idle",!0,function(){}),bundles.burst.urls.burst_fill_effect&&cleverapps.audio.playSound(bundles.burst.urls.burst_fill_effect)},unuse:function(){this.cell.onChangeLivesListener=function(){},BaseCellView.unuse.call(this)},openAnimation:function(){var e=this.getLocalZOrder();this.setLocalZOrder(2),this.animate("open",!1,function(){
this.setLocalZOrder(e)}.bind(this));var t=cleverapps.styles.BurstCellView;this.runAction(new cc.Sequence(new cc.DelayTime(t.openSound.delay),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.burstcell_open_effect)}.bind(this))))},burstAnimation:function(e,t){var i=["purple","yellow","green","red","blue"],s=new cc.Sprite(bundles.burst.frames["ball_"+i[t]]);s.setOpacity(0),this.parent.addChild(s),s.setAnchorPoint2(),s.setPosition(this.getPosition()),s.y-=cleverapps.styles.BaseCellView.CELL_SIZE_PX/2;var n=t*BurstCell.BURST_INTERVAL,o=this.cell.burstDuration(e,t),a=BaseCellView.alignInTheGrid(e.x,e.y);s.runAction(new cc.Sequence(new cc.DelayTime(n),new cc.Spawn(new cc.FadeIn(.1),new cc.MoveTo(o-n,a).easing(new cc.easeQuadraticActionIn),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.bomb_by_left_moves_explosion_effect,{throttle:0})}),new cc.Sequence(new cc.ScaleTo((o-n)/2,1.8),new cc.ScaleTo((o-n)/2,1.3)),new cc.Sequence(new cc.DelayTime(
o-n-.1),new cc.FadeOut(.1))),new cc.RemoveSelf)),this.runAction(new cc.Sequence(new cc.DelayTime(o),new cc.CallFunc(function(){var e=BlastAnimation.factory(i[t]);e.setPosition(a),e.setLocalZOrder(10),this.parent.addChild(e),e.runAnimate("animation")}.bind(this))))},hurtAnimation:function(){}}));cleverapps.styles.BurstCellView={openSound:{delay:.4}};var DirtMakerCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(e),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage(e.stage));t.setAnchorPoint2(),t.setPositionRound(this.width/2,this.height/2),this.addChild(t),this.image=t,this.initialize(e),cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&this.addAnimation()},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeStage=this.changeStage.bind(this),e.onShoot=this.shoot.bind(this)},unuse:function(){
this.cell.onChangeStage=function(){},BaseCellView.unuse.call(this)},addAnimation:function(){var e=new cleverapps.Spine(bundles.dirt_maker.jsons.dirt_maker_spine_json,1);e.setPosition(this.width/2,this.height/2),this.addChild(e),this.animation=e,cleverapps.styles.DirtMakerCellView.idleAnimation&&0<this.cell.stage&&(e.visible=!0,this.animation.setAnimation(0,this.cell.stage+cleverapps.styles.DirtMakerCellView.idleAnimation,!0))},getImage:function(e){return bundles.dirt_maker.frames["dirt_maker_stable_"+e]},changeStage:function(e){cleverapps.settings.fpsMode===cleverapps.Settings.FPS_MODE_LOW?(this.image.setSpriteFrame(this.getImage(this.cell.stage)),e&&e()):(this.animation||this.addAnimation(),this.animation.setCompleteListener(function(){this.image.setSpriteFrame(this.getImage(this.cell.stage)),cleverapps.styles.DirtMakerCellView.idleAnimation?(this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,this.cell.stage+cleverapps.styles.DirtMakerCellView.idleAnimation
,!0)):(this.image.visible=!0,this.animation.visible=!1),e&&e()}.bind(this)),this.animation.setStartVisibleListener(function(){this.image.visible=!1}.bind(this)),this.animation.setAnimation(0,""+this.cell.stage,!1),cleverapps.audio.playSound(bundles.game.urls.dirt_maker_fill))},shoot:function(e,t){this.animation||this.addAnimation();var i=this.getLocalZOrder();this.setLocalZOrder(10),this.animation.setCompleteListener(function(){this.image.setSpriteFrame(this.getImage(this.cell.stage)),this.image.visible=!0,this.setLocalZOrder(i)}.bind(this)),this.animation.setStartVisibleListener(function(){this.image.visible=!1}.bind(this)),this.animation.setAnimation(0,""+DirtMakerCell.STAGES_COUNT,!1);var s=new cc.Sprite(bundles.dirt_maker.frames.dirt_blob);this.parent.addChild(s),s.setPosition(this.getPosition()),s.setScale(0);var n=BaseCellView.alignInTheGrid(e,t),o=Math.max(this.y,n.y)+cleverapps.styles.DirtMakerCellView.fly.y,a=new cc.p(this.x,o),r=new cc.p(n.x,o),l=new cc.p(n.x,
n.y+cleverapps.styles.BaseCellView.CELL_SIZE_PX/2);s.runAction(new cc.Sequence(new cc.DelayTime(cleverapps.styles.DirtMakerCellView.shot.delay),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.dirt_maker_explode)}),new cc.Spawn(new cc.ScaleTo(.2,2),new cc.BezierTo(1,[a,r,l])),new cc.RemoveSelf))},hurtAnimation:function(){}}));cleverapps.styles.DirtMakerCellView={fly:{y:300},shot:{delay:1}};var WaffleCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(e),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage(e));this.image=t,this.image.setPosition(this.width/2,this.height/2),this.addChild(t),this.initialize(e),this.setCascadeOpacityEnabled(!0)},getImage:function(e){return void 0===e.color?bundles.waffle.frames.waffle_goal:bundles.waffle.frames["waffle_cell_"+e.color]},updateImage:function(e){
this.image.setSpriteFrame(this.getImage(e))},initialize:function(e){BaseCellView.initialize.call(this,e),this.updateImage(e),e.mark&&this.addMark()},unuse:function(){this.markView&&delete this.markView,BaseCellView.unuse.call(this)},reuse:function(e){BaseCellView.reuse.call(this,e),this.image.visible=!0},startExploding:function(e,t){this.startExplodingViaCollect(e,t)},addMark:function(){this.markView=MarkView.factory(this.cell),this.markView.initialize(this.cell),this.addChild(this.markView)}})),TruffleCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){if(this._super(e),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),void 0===e.color){var t=new cc.Sprite(bundles.truffle.frames.truffle_goal);t.setPosition(this.width/2,this.height/2),this.addChild(t)}else{this.images=[];for(var i=0;i<TruffleCell.LIVES;i++){var s=new cc.Sprite;s.setLocalZOrder(-i),this.addChild(s),
this.images.push(s)}}cleverapps.styles.TruffleCellView.rose&&!e.isForGoal&&(this.rose=new cc.Sprite(bundles.truffle.frames.truffle_rose),this.rose.setLocalZOrder(10),this.addChild(this.rose)),this.initialize(e),this.setCascadeOpacityEnabled(!0)},changeLives:function(){if(this.images){var s=TruffleCell.LIVES-this.cell.lives;this.images.forEach(function(e,t){var i=t-s;i<0?e.visible=!1:(this.positionImage(e,i),e.visible=!0)},this)}},updateRose:function(){if(this.rose){var e=cleverapps.styles.TruffleCellView.rose,t=this.images[0].getPosition();this.rose.setPositionRound(t.x+e.x,t.y+e.y)}},positionImage:function(e,t){var i=cleverapps.styles.TruffleCellView;e.setPosition(this.width/2,this.height/2+t*i.images[t].offsetY),e.setScale(i.images[t].scale)},updateImages:function(){this.images&&this.images.forEach(function(e,t){var i=this.cell.colors[t],
s=t<this.images.length-1||!bundles.truffle.frames["truffle_cell_last_"+i]?bundles.truffle.frames["truffle_cell_"+i]:bundles.truffle.frames["truffle_cell_last_"+i];e.setSpriteFrame(s)},this)},getSkin:function(e){return{a:"blue",b:"green",c:"purple",d:"red",e:"yellow",w:"white"}[e.color]},initialize:function(e){BaseCellView.initialize.call(this,e),this.updateImages(),this.changeLives(),this.updateRose(),e.mark&&this.addMark(),e.onChangeLivesListener=this.changeLives.bind(this)},unuse:function(){this.cell.onChangeLivesListener=function(){},this.markView&&delete this.markView,BaseCellView.unuse.call(this)},startExploding:function(e,t){this.startExplodingViaCollect(e,t)},positionAnimation:function(){this.animation.setPosition(this.width/2,this.height/2)},hurtAnimation:function(){this.setLocalZOrder(11),this.animation=BaseAnimation.factoryLimited(bundles.truffle.jsons.truffles_spine_json);var e=this.positionAnimation();this.animation.setSkin(this.getSkin(this.cell)),this.addChild(
this.animation),this.animation.setLocalZOrder(1),this.animation.runAnimate("animation",function(){this.cell.alive&&this.setLocalZOrder(this.baseZOrder)}.bind(this),e),this.roseAnimation(),cleverapps.audio.playSound(bundles.game.urls.flower_open_effect)},roseAnimation:function(){if(this.rose){var e=cleverapps.styles.TruffleCellView,t=this.height/2+(0<this.cell.lives?e.rose.y+e.topOffsetY[this.cell.lives]:0);this.rose.stopAllActions(),this.rose.runAction(new cc.Sequence(new cc.ScaleTo(.1,1.2,.8),new cc.Spawn(new cc.ScaleTo(.15,1,1),new cc.MoveBy(.15,0,e.rose.jumpHeight)),new cc.MoveTo(.15,this.rose.x,t)))}},addMark:function(){this.markView=MarkView.factory(this.cell),this.markView.initialize(this.cell),this.addChild(this.markView)}}));cleverapps.styles.TruffleCellView={images:{0:{offsetY:0,scale:.8},1:{offsetY:20,scale:.6},2:{offsetY:18,scale:.4}}};var LollipopAnimation=BaseAnimation.extend({ctor:function(e){this._super(bundles.lollipop.jsons.lollipop_json),
this.animation&&this.animation.setSkin(e)}});LollipopAnimation.factory=function(e){return cc.pool.hasObject(LollipopAnimations[e])?cc.pool.getFromPool(LollipopAnimations[e]):new LollipopAnimations[e]};var LollipopAnimations={a:LollipopAnimation.extend({ctor:function(){this._super("blue")}}),b:LollipopAnimation.extend({ctor:function(){this._super("green")}}),c:LollipopAnimation.extend({ctor:function(){this._super("purple")}}),d:LollipopAnimation.extend({ctor:function(){this._super("red")}}),e:LollipopAnimation.extend({ctor:function(){this._super("yellow")}}),w:LollipopAnimation.extend({ctor:function(){this._super("white")}})},LollipopCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(e),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage(e));this.image=t,this.image.setPosition(this.width/2,this.height/2),this.addChild(t),
this.initialize(e),this.setCascadeOpacityEnabled(!0)},getImage:function(e){return void 0===e.color?bundles.lollipop.frames.lollipop_goal:bundles.lollipop.frames["lollipop_cell_"+e.color]},updateImage:function(e){this.image.setSpriteFrame(this.getImage(e))},initialize:function(e){BaseCellView.initialize.call(this,e),this.image.visible=!0,this.updateImage(e),e.mark&&this.addMark(),e.onChangeColorListener=this.changeColorAnimation.bind(this)},changeColorAnimation:function(e,t){this.finishSmile();var i=LollipopAnimation.factory(t);i.setPosition(this.width/2,this.height/2),i.setLocalZOrder(1),this.addChild(i),this.changingColor=!0,i.runAnimate("animation",function(){this.updateImage(e),this.image.visible=!0,this.changingColor=!1}.bind(this),this.image),cleverapps.audio.playSound(bundles.lollipop.urls.lollipop_change_color_effect)},finishSmile:function(){this.smiling&&(this.smiling=!1,this.image.visible=!0,this.animation.finishAnimation())},smile:function(){
cleverapps.styles.LollipopCellView.smile&&(this.smiling||this.changingColor||(this.animation=LollipopAnimation.factory(this.cell.color),this.addChild(this.animation),this.animation.setPositionRound(this.width/2,this.height/2),this.smiling=!0,this.animation.runAnimate("smile",this.finishSmile.bind(this),this.image),cleverapps.audio.playSound(bundles.lollipop.urls.lollipop_smile_effect)))},unuse:function(){this.markView&&delete this.markView,this.cell.onChangeColorListener=function(e){},BaseCellView.unuse.call(this)},reuse:function(e){BaseCellView.reuse.call(this,e),this.image.visible=!0},startExploding:function(e,t){cleverapps.audio.playSound(bundles.lollipop.urls.lollipop_collect_effect),this.startExplodingViaCollect(e,t)},addMark:function(){this.markView=MarkView.factory(this.cell),this.markView.initialize(this.cell),this.markView.setLocalZOrder(2),this.addChild(this.markView)}}));cleverapps.styles.LollipopCellView={smile:!1};var CandleCellView=cc.Node.extend(cleverapps.extend({},
BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cleverapps.Spine(bundles.candle.jsons.candle_json,1);t.setPosition(this.width/2,this.height/2),e.state===CandleCell.STATE_ON||e.isForGoal?t.setAnimation(0,"burn",!0):t.setAnimation(0,"put_out",!1),this.addChild(t),this.animation=t,this.initialize(e)},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeStateListener=this.update.bind(this)},update:function(){this.cell.state===CandleCell.STATE_ON?(this.animation.setCompleteListener(function(){this.animation.setAnimation(0,"burn",!0)}.bind(this)),this.animation.setAnimation(0,"lights_up",!1),cleverapps.audio.playSound(bundles.candle.urls.turn_on_effect)):(this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,"put_out",!1),cleverapps.audio.playSound(bundles.candle.urls.turn_off_effect))}})),
BagDecoratorCellView=DecoratorCellView.extend({ctor:function(e){this._super(),this.image=new cc.Sprite(this.getImage(e)),this.setContentSize(this.image.getContentSize()),this.image.setPosition(this.width/2,this.height/2),this.addChild(this.image),this.initialize(e)},initialize:function(e){this._super(e),this.image.setVisible(!0)},getImage:function(e){return void 0===e.x?bundles.bag.frames.bag_cell_goal:bundles.bag.frames["bag_cell_"+e.color]},createAnimation:function(){var e=BaseAnimation.factoryLimited(bundles.bag.jsons.bag_spine_json);return e.setPosition(this.getPosition()),e.setVisible(!1),e.setSkin(ColorCell.CODE_COLORS[this.cell.color]),e.parent||this.parent.addChild(e),e},finishSmile:function(){},smile:function(){},animateExplode:function(e){var t=this.createAnimation();cleverapps.audio.playSound(bundles.game.urls.bag_decorator_die_effect),t.runAnimate("animation",!1,new cc.FadeOut(.5)),t.runAction(new cc.CallFunc(function(){t.setVisible(!0),this.image.setVisible(!1),e()}.bind(
this)))}}),ColorCookieManCellView=ColorCellView.extend({ctor:function(e){this._super(e),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&void 0!==e.color&&(this.animation=new cleverapps.Spine(bundles.colorcookieman.jsons.color_cookieman_spine_json,1),this.animation.setPosition(this.width/2,this.height/2),this.addChild(this.animation)),this.setCascadeOpacityEnabled(!0),this.initialize(e)},updateImage:function(e){this.image.setSpriteFrame(this.getImage(e))},getImage:function(e){return void 0===e.color?bundles.colorcookieman.frames.color_cookieman_goal:bundles.colorcookieman.frames["color_cookieman_"+e.color]},getSkin:function(e){return{a:"blue",b:"green",c:"purple",d:"red",e:"yellow",w:"white"}[e.color]},initialize:function(e){BaseCellView.initialize.call(this,e),e.onBeforeExplodeListener=this.startExplodingViaCollect.bind(this),
e.onFinishMoveListener=this.cookieManFinishMoving.bind(this),this.updateImage(e),this.image.setVisible(!0),this.animation&&(this.animation.setSkin(this.getSkin(e)),this.animation.setVisible(!1)),this.smiling=!1,this.setVisible(e.visible)},cookieManFinishMoving:function(e,t,i){this.finishMoving(e,t,i),this.finishSmile()},swapImageToAnimation:function(){this.runAction(new cc.CallFunc(function(){this.image.visible=!1,this.animation.visible=!0}.bind(this)))},finishSmile:function(){this.smiling&&(this.smiling=!1,this.image.visible=!0,this.animation.visible=!1)},smile:function(){this.animation&&(this.smiling||(this.smiling=!0,this.animation.setCompleteListener(this.finishSmile.bind(this)),this.animation.setAnimation(0,"animation",!1),this.swapImageToAnimation(),bundles.colorcookieman.urls.clown_smile_effect&&cleverapps.audio.playSound(bundles.colorcookieman.urls.clown_smile_effect)))},startExplodingViaCollect:function(){
bundles.colorcookieman.urls.clown_collect_effect&&cleverapps.audio.playSound(bundles.colorcookieman.urls.clown_collect_effect),BaseCellView.startExplodingViaCollect.apply(this,arguments)},cookieUp:function(e){e=e||function(){};var t=this.getLocalZOrder();if(this.animation)this.setLocalZOrder(3),this.smiling=!0,this.animation.setCompleteListener(function(){e(),this.finishSmile(),this.setLocalZOrder(t)}.bind(this)),this.animation.setAnimation(0,"up",!1),this.swapImageToAnimation();else{this.setLocalZOrder(3);var i=BaseCellView.alignInTheGrid(this.cell.x,this.cell.y);this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.MoveTo(.5,i),new cc.CallFunc(function(){this.setLocalZOrder(t),e()}.bind(this))))}bundles.colorcookieman.urls.clown_jump_effect&&cleverapps.audio.playSound(bundles.colorcookieman.urls.clown_jump_effect)},cookieIn:function(e){e=e||function(){},cleverapps.audio.playSound(bundles.colorcookieman.urls.clown_in_effect||bundles.game.urls.bomb_by_left_moves_explosion_effect),
this.animation?(this.smiling=!0,this.animation.setCompleteListener(function(){e(),this.finishSmile()}.bind(this)),this.animation.setAnimation(0,"in",!1),this.swapImageToAnimation()):(this.setScale(0),this.runAction(new cc.Sequence(new cc.Spawn(new cc.RotateBy(1,720),new cc.ScaleTo(1,1)),new cc.CallFunc(e))))},cookieOut:function(e){e=e||function(){},cleverapps.audio.playSound(bundles.colorcookieman.urls.clown_out_effect||bundles.game.urls.bomb_by_left_moves_explosion_effect),this.animation?(this.smiling=!0,this.animation.setCompleteListener(function(){e(),this.finishSmile(),this.setVisible(!1)}.bind(this)),this.animation.setAnimation(0,"out",!1),this.swapImageToAnimation()):this.runAction(new cc.Sequence(new cc.Spawn(new cc.RotateBy(1,-720),new cc.ScaleTo(1,0)),new cc.CallFunc(e)))}}),ColorBombCellView=ColorCellView.extend({ctor:function(e){this._super(e)},initialize:function(e){BaseCellView.initialize.call(this,e),this.animation||(this.animation=new cleverapps.Spine(
bundles.color_bomb.jsons.color_bomb_json,1),this.animation.setPositionRound(this.width/2,this.height/2),this.animation.setAnimation(0,"stage_1_0",!0),this.addChild(this.animation)),this.animation.setVisible(!0),this.updateAnimationSkin(e),this.updateAnimation(),this.image.setVisible(!1),e.mark&&this.addMark(),e.onChangeLivesListener=this.changeLives.bind(this)},changeLives:function(){0<this.cell.lives&&this.updateAnimation()},startExploding:function(){this.removeMissionMarkView(),this.finishSmile&&this.finishSmile(),this.delete()},unuse:function(){BaseCellView.unuse.call(this)},reuse:function(e){BaseCellView.reuse.call(this,e),this.image.setVisible(!1)},hurtAnimation:function(){var e=!1;1===this.cell.lives&&(e=!0),e&&(this.setLocalZOrder(11),this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){Game.currentGame&&Game.currentGame.shakeField(),cleverapps.audio.playSound(bundles.color_bomb.urls.bomb_explosion,{throttle:20})}))));var t="stage_"+(3-this.cell.lives+1
).toString()+"_1";cc.loader.getRes(bundles.color_bomb.jsons.color_bomb_json).animations[t]&&this.animation.setAnimation(0,t,!1),cleverapps.audio.playSound(bundles.color_bomb.urls.bomb_hurt||bundles.game.urls.colorbomb_stage_decrease_effect)},updateAnimation:function(){this.animation.setAnimation(0,"stage_"+(3-this.cell.lives+1).toString()+"_0",!0)},updateAnimationSkin:function(e){this.animation.setSkin(this.getSkin(e))},getSkin:function(e){return{a:"blue",b:"green",c:"purple",d:"red",e:"yellow",w:"white"}[e.color]}}),FireflyJarCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),e.isForGoal?this.initSetGoalSprite():this.initialize(e)},initialize:function(e){BaseCellView.initialize.call(this,e);var t=this.animation=new cleverapps.Spine(bundles.firefly_jar.jsons.firefly_jar_json,1);this.updateAnimation(),
this.addChild(t),t.setPositionRound(this.width/2,this.height/2),e.onFlyToGoalListener=this.createListener(this.flyToGoal.bind(this))},initSetGoalSprite:function(){var e=this.jar=new cc.Sprite(bundles.firefly_jar.frames.firefly_goal_png);e.setPositionRound(this.width/2,this.height/2),this.addChild(e)},updateAnimation:function(){this.cell.lives<1||!this.cell.alive||(this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,4<this.cell.lives?"idle_5":"idle_"+this.cell.lives,!0))},changeLives:function(){this.updateAnimation()},hurtAnimation:function(){var e="open_"+(this.cell.lives+1);this.cell.lives+1===5&&(e="open_5"),5<this.cell.lives+1&&(e="open_5_1"),this.animation.setAnimation(0,e,!1),this.setLocalZOrder(9),this.animation.setCompleteListener(function(){this.updateAnimation(),this.setLocalZOrder(this.baseZOrder)}.bind(this))},flyToGoal:function(){var t=new cleverapps.Spine(bundles.firefly_jar.jsons.firefly_goal_json,1);t.setPositionRound(
BaseCellView.alignInTheGrid(this.cell.x,this.cell.y)),this.parent.addChild(t),t.runAction(new cc.Sequence(new cc.DelayTime(FireflyJarCellView.FLY_TO_GOAL_DURATION),new cc.CallFunc(function(){if(t.setAnimation(0,"animation",!0),cleverapps.audio.playSound(bundles.firefly_jar.urls.firefly_effect),Game.currentGame){var e=Game.currentGame.goals.check(this.cell,1,1);t.visible=!0,Game.currentGame.goalsController.getViewByType(e.type).collect(t,e,1,function(){t.runAction(new cc.RemoveSelf)},{moveBy:{x:0,y:0}})}}.bind(this))))},unuse:function(){this.cell.onChangeLivesListener=function(){},this.cell.onFlyToGoalListener=function(){},BaseCellView.unuse.call(this)},startExploding:function(){this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.ScaleTo(.3,0),new cc.RemoveSelf))}}));FireflyJarCellView.FLY_TO_GOAL_DURATION=1;var DirtyHoneyDecoratorCellView=DecoratorCellView.extend({ctor:function(e){if(this._super(),this.initialize(e),e.isForGoal){
var t=cleverapps.styles.DirtyHoneyDecoratorCellView;this.setContentSize2(t.width,t.height)}var i=this.image=new cc.Sprite(res.dirty_honey_decorator);i.setPositionRound(this.width/2,this.height/2),this.addChild(i)},initialize:function(e){this._super(e),e.onCreateNew=this.animateCreateNew.bind(this)},animateCreateNew:function(){this.image.visible=!1,BaseAnimation.runAnimate(this,res.dirty_honey_json,"top_on",function(){this.image.visible=!0}.bind(this),this.image),cleverapps.audio.playSound(cleverapps.styles.DirtyHoneyDecoratorCellView.growUpSound)},animateExplode:function(){this.setLocalZOrder(11),BaseAnimation.runAnimate(this,res.dirty_honey_json,"top_off",this.image),cleverapps.audio.playSound(cleverapps.styles.DirtyHoneyDecoratorCellView.dieSound)}});cleverapps.styles.DirtyHoneyDecoratorCellView={width:120,height:120,growUpSound:res.dirty_honey_create_effect,dieSound:res.special_element_die};var ColorContainerCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e
){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),e.isForGoal?(this.image=new cc.Sprite(bundles.color_container.frames.color_container_goal),this.addChild(this.image),this.image.setPositionRound(this.width/2,this.height/2)):(this.animation=new cleverapps.Spine(bundles.color_container.jsons.color_container_json,1),this.addChild(this.animation),this.animation.setPositionRound(this.width/2,this.height/2),this.animation.setSkin("blue"),this.animation.setAnimation(0,"bottle_2",!0)),this.initialize(e)},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeLivesListener=this.changeLives.bind(this),e.onSetColor=this.setColor.bind(this)},setColor:function(e){this.animation.setSkin(ColorCell.CODE_COLORS[e])},changeLives:function(){this.animation.setAnimation(0,"bottle_"+this.cell.lives+"_up",!1),this.animation.setCompleteListener(function(){this.animation.setAnimation(0,
"bottle_"+this.cell.lives,!1)}.bind(this)),cleverapps.audio.playSound(bundles.color_container.urls.fill_effect)},startExploding:function(e,t){cleverapps.audio.playSound(bundles.color_container.urls.collect_effect),this.startExplodingViaCollect(e,t)}})),IceMakerCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(e),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=this.animation=new cleverapps.Spine(bundles.ice_maker.jsons.ice_maker_json,1),i=cleverapps.styles.IceMakerCellView.animations;if(t.setAnimation(0,e.isForGoal&&i.goal?"goal":"idle",!0),this.addChild(t),t.setPositionRound(this.width/2,this.height/2),!e.isForGoal){i=cleverapps.styles.IceMakerCellView.lives;this.livesText=new cleverapps.UI.ImageFont("ice_maker#white_digit_",""+e.lives),this.livesText.setColor(cleverapps.styles.COLORS[i.color]),this.addChild(this.livesText)}this.initialize(e),
this.updateLivesText()},initialize:function(e){BaseCellView.initialize.call(this,e),this.cell.onChangeLivesListener=this.changeLives.bind(this),this.livesText&&(this.livesText.setVisible(!0),this.updateLivesText()),this.animation&&this.animation.setAnimation(0,e.isForGoal&&cleverapps.styles.IceMakerCellView.animations.goal?"goal":"idle",!0)},changeLives:function(){this.updateLivesText(),this.squeeze(-1)},updateLivesText:function(){if(this.livesText){var e=cleverapps.styles.IceMakerCellView.lives;this.cell.lives<10?this.livesText.setScale(e.scale[0]):this.livesText.setScale(e.scale[1]),this.livesText.setString(""+this.cell.lives),this.animation.getScaleX()<0?this.livesText.setPositionRound(cleverapps.styles.BaseCellView.CELL_SIZE_PX-e.x,e.y):this.livesText.setPositionRound(e)}},moveAnimation:function(e){var t=this.animation;0!==e.dir.x&&e.dir.x===this.animation.getScaleX()&&(t.setScaleX(-t.getScaleX()),this.updateLivesText());var i=cleverapps.styles.IceMakerCellView.animations,
s=0!==e.dir.x&&i.horizontal?"move_horizontal":"move_vertical",n=function(){this.setLocalZOrder(10),t.setAnimation(0,s,!1),t.setCompleteListener(function(){t.setAnimation(0,"idle",!0),this.setLocalZOrder(this.baseZOrder),t.setCompleteListener(function(){}),e.callback()}.bind(this)),cleverapps.audio.playSound(bundles.ice_maker.urls.ice_maker_fly_effect)}.bind(this);e.iceAnimation?(t.setAnimation(0,"honey",!1),t.setCompleteListener(n)):n()},startExplodingViaCollect:function(){var e=cleverapps.styles.IceMakerCellView.animations;this.animation.setAnimation(0,e.goal?"goal":"move_vertical",!0),BaseCellView.startExplodingViaCollect.apply(this,arguments)},startExploding:function(){this.livesText&&this.livesText.setVisible(!1),Game.currentGame.goals.inGoals(this.cell)?this.startExplodingViaCollect.apply(this,arguments):(this.stopAllActions(),this.animation.runAction(new cc.Spawn(new cc.ScaleTo(.5,0),new cc.RotateBy(.5,360))))},getStyles:function(){return cleverapps.styles.IceMakerCellView},
refuse:function(){BaseCellView.refuse.call(this)}}));cleverapps.styles.IceMakerCellView={lives:{x:50,y:15,scale:[.7,.6],color:"WHITE"},animations:{horizontal:!0}};var SharkCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),this.animation=new cleverapps.Spine(bundles.shark.jsons.shark_json,1),this.animation.setPosition(this.width/2,this.height/2),this.animation.setAnimation(0,"idle_3",!0),this.addChild(this.animation),this.initialize(e)},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeLivesListener=this.changeLives.bind(this),e.onCreateNew=this.createNew.bind(this),e.onTakeMove=this.takeMove.bind(this),e.onDisappear=this.disappear.bind(this),this.animation.setAnimation(0,"idle_3",!0)},unuse:function(){this.cell.onChangeLivesListener=function(){},this.cell.onCreateNew=function(){},
this.cell.onTakeMove=function(){},this.cell.onDisappear=function(){},BaseCellView.unuse.call(this)},changeLives:function(){this.animation.setAnimation(0,"transition_"+this.cell.lives,!1),this.animation.setCompleteListener(function(){0<this.cell.lives&&this.animation.setAnimation(0,"idle_"+this.cell.lives,!0)}.bind(this)),cleverapps.audio.playSound(cleverapps.styles.SharkCellView.stageDecreaseSound)},createNew:function(){this.setScale(0),this.runAction(new cc.Sequence(new cc.ScaleTo(.1,.25).easing(cc.easeBackOut()),new cc.ScaleTo(.1,.15).easing(cc.easeBackOut()),new cc.ScaleTo(.3,1.05).easing(cc.easeBackOut()),new cc.ScaleTo(.1,1).easing(cc.easeBackOut()))),cleverapps.audio.playSound(cleverapps.styles.SharkCellView.growUpSound)},takeMove:function(e){this.setLocalZOrder(100),this.animation.setAnimation(0,"fly",!0),WindowHelper.animateCollect(this,{scale:1,target:cleverapps.styles.UI.MovesView_target,noSound:!0,remove:!1},function(){this.animation.setAnimation(0,"explode",!1),
Game.currentGame&&Game.currentGame.shakeField({delay:200,target:cc.director.getRunningScene().movesView}),cleverapps.audio.playSound(bundles.shark.urls.shark_poof_effect),this.animation.setCompleteListener(function(){this.delete(),e(),this.animation.setCompleteListener(function(){})}.bind(this))}.bind(this))},disappear:function(){var e=1<this.cell.lives?"explode_idle_"+this.cell.lives:"explode";this.setLocalZOrder(11),this.animation.setAnimation(0,e,!1),cleverapps.audio.playSound(cleverapps.styles.SharkCellView.dieSound),Game.currentGame&&Game.currentGame.shakeField({delay:200}),this.animation.setCompleteListener(function(){this.setLocalZOrder(this.baseZOrder),this.animation.setCompleteListener(function(){})}.bind(this))}}));cleverapps.styles.SharkCellView={stageDecreaseSound:bundles.shark.urls.shark_effect,growUpSound:res.special_element_grow_up,dieSound:bundles.shark.urls.shark_effect};var MovesCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),
this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),this.image=new cc.Sprite(bundles.moves_cell.frames.moves_cell),this.image.setPosition(this.width/2,this.height/2),this.addChild(this.image);var t=cleverapps.styles.MovesCellView.text,i=e.moves;t.plus&&(i="+"+i),this.movesText=cleverapps.UI.generateTTFText(i,cleverapps.styles.FONTS.MOVES_CELL_TEXT),this.addChild(this.movesText),this.movesText.setPositionRound(this.width/2+t.x,this.height/2+t.y),10<=e.moves&&t.scale&&this.movesText.setScale(t.scale),this.initialize(e)},initialize:function(e){BaseCellView.initialize.call(this,e)},startExploding:function(){this.setLocalZOrder(100),WindowHelper.animateCollect(this,{scale:.5,remove:!1,target:cleverapps.styles.UI.MovesView_target},function(){Game.currentGame&&Game.currentGame.setMoves(Game.currentGame.moves+this.cell.moves,{delay:300}),this.delete()}.bind(this))},updateMoves:function(){
this.movesText.setString("+"+this.cell.moves)}}));cleverapps.styles.MovesCellView={text:{x:-5,y:5,plus:!0}};var GumDecoratorCellView=DecoratorCellView.extend({ctor:function(e){this._super(),this.setLayers(e),this.initialize(e),this.setAllBorders(),this.cell.onChangeLivesListener=this.changeLives.bind(this),this.cell.onSetBorders=this.setBorders.bind(this)},setLayers:function(e){this.layers=[],this.initialLayersCount=e.lives;for(var t=0;t<e.lives;t++)this.setImage(t,e)},setImage:function(e,t){var i=new cc.Sprite(res.gum_body_png);"editor"===cleverapps.environment.scene?i.setOpacity(90+50*e):-1!==t.x&&(this.layers[e]=i),this.setContentSize(i.getContentSize()),i.setPosition(this.width/2,this.height/2),this.addChild(i)},setAllBorders:function(){if(this.borders={},"editor"!==cleverapps.environment.scene&&-1!==this.cell.x){var e={L:-90,R:90,D:180,U:0};for(var t in e){var i=new cc.Sprite(res.gum_border_png);i.setRotation(e[t]),i.setLocalZOrder(5);var s=GumDecoratorCellView.POSITIONS[t]
;i.setPosition(this.width*s.x,this.height*s.y),this.addChild(i),this.borders[t]=i}this.setBorders(this.cell)}},removeAllBorders:function(){for(var e in this.borders)this.borders[e].setVisible(!1)},setBorders:function(e,t){var i=e||this.cell;GumDecoratorCellView.FORCE_BORDERS===t&&(this.onHoverNow=!0);var s=Object.keys(this.borders);if(GumDecoratorCellView.FORCE_BORDERS!==t&&(s=i.getBordersDirections(),this.setLocalZOrder(this.baseZOrder+i.lives)),t===GumDecoratorCellView.HOVER_END)this.onHoverNow=!1,Object.keys(this.borders).forEach(function(e){-1===s.indexOf(e)&&this.borders[e].runAction(new cc.Sequence(new cc.DelayTime(.15),new cc.CallFunc(function(){this.onHoverNow||(this.borders[e].setVisible(!1),this.onHoverNow=!1)}.bind(this))))},this);else for(var n in this.borders)this.borders[n].setVisible(-1!==s.indexOf(n))},showHover:function(e){e?this.setBorders(this.cell,GumDecoratorCellView.FORCE_BORDERS):this.setBorders(this.cell,GumDecoratorCellView.HOVER_END),
BaseCellView.showHover.apply(this,arguments),this.setLocalZOrder(this.baseZOrder+this.cell.lives)},changeLives:function(){if(!(this.cell.lives<=0)&&this.cell.alive){var t=this.getScale(),i=this.cell.lives;this.runAction(new cc.Sequence(new cc.ScaleTo(.25,1.3*t),new cc.CallFunc(function(){this.setScale(t);var e=this.boomAnimation();e&&e.setScale(1.2),this.setLocalZOrder(this.baseZOrder+i),this.setBorders(),this.removelayer(i)}.bind(this)))),cleverapps.audio.playSound(cleverapps.styles.GumDecoratorCellView.stageDecreaseSound)}},changeParent:function(e){this.replaceParent(e),e===Game.levelTutorialView.fieldViewClone?this.setBorders(this.cell,GumDecoratorCellView.FORCE_BORDERS):this.setBorders()},removelayer:function(e){var t=this.layers[e];t&&(t.visible=!1)},unuse:function(){this.cell.onChangeLivesListener=function(){},this.cell.onSetBorders=function(){},this._super.call(this)},startExploding:function(){cleverapps.audio.playSound(cleverapps.styles.GumDecoratorCellView.dieSound),
this.setBorders(this.cell,GumDecoratorCellView.FORCE_BORDERS),Game.currentGame.goals.inGoals(this.cell)?(BaseCellView.startExplodingViaCollect.apply(this,arguments),this.runAction(new cc.Sequence(new cc.DelayTime(.35),new cc.CallFunc(function(){if(this.cell){this.boomAnimation();for(var e=0;e<this.initialLayersCount;e++)this.removelayer(e);this.removeAllBorders();var t=new cc.Sprite(res.gum_goal_png);t.setPosition(this.width/2,this.height/2),this.addChild(t)}}.bind(this))))):BaseCellView.startExploding.apply(this,arguments)},boomColor:function(){return cleverapps.styles.GumDecoratorCellView.boomColor}});cleverapps.styles.GumDecoratorCellView={boomColor:new cc.Color(252,163,202,255),stageDecreaseSound:res.special_element_stage_decrease,dieSound:res.special_element_die},GumDecoratorCellView.FORCE_BORDERS=1,GumDecoratorCellView.HOVER_END=2,GumDecoratorCellView.OPACITY_BASE=50,GumDecoratorCellView.OPACITY_STEP=50,GumDecoratorCellView.CODES=["U","R","D","L"],GumDecoratorCellView.POSITIONS={
U:{x:.5,y:1},R:{x:1,y:.5},D:{x:.5,y:0},L:{x:0,y:.5}};var ClockCellView=BigCellView.extend({ctor:function(e){if(this._super(e),e.isForGoal){var t=this.getStyles();this.setAnchorPoint2(),this.setContentSize2(t.goal.width,t.goal.height);var i=new cc.Sprite(bundles.clock.frames.clock_goal);return this.addChild(i),void i.setPositionRound(this.width/2,this.height/2)}e.isHead&&(this.initialize(e),this.createBg(),this.createItems(e))},createBg:function(){var e=this.bg=new cleverapps.Spine(bundles.clock.jsons.clock_json,1);e.setAnimation(0,"animation",!0),e.setLocalZOrder(10),this.addChild(e),e.setPositionRound(this.width/2,this.height/2)},createItems:function(s){this.items&&this.items.forEach(function(e){e.view.removeFromParent(!0)}),this.items=[],s.colors.forEach(function(e,t){var i=this.createItem(e);this.addChild(i),i.setAnchorPoint2(0,.5),i.setPositionRound(this.width/2,this.height/2),i.setRotation(this.calcRotation(t)),i.setScaleY(this.calcScale()),i.setLocalZOrder(s.colors.length-t),
0===t&&(this.addCurrentAnimation(i),i.setScaleY(1.2*i.getScaleY())),this.items.push({view:i})}.bind(this))},removeCurrentAnimation:function(e){e.currAnimation&&(e.stopAction(e.currAnimation),delete e.currAnimation)},addCurrentAnimation:function(e){var t=e.getScaleX(),i=e.getScaleY();e.currAnimation=e.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.4,1.1*t,1.1*i),new cc.ScaleTo(.4,t,i))))},createItem:function(e){var t=new cleverapps.Spine(bundles.clock.jsons.petal_json,1);t.setSkin(ColorCell.CODE_COLORS[e]),t.setAnimation(0,"idle_1",!1);var i=new cc.Node;return i.setAnchorPoint2(),i.setContentSize2(this.getStyles().animation),i.addChild(t),(i.animation=t).setPositionRound(t.width/2,t.height/2),i},calcScale:function(){return.55+(1.4-.55)/this.cell.getMaxLives()*(this.cell.getMaxLives()-this.cell.colors.length)},calcRotation:function(e){return 360/this.cell.colors.length*e-90},initialize:function(e){BaseCellView.initialize.call(this,e),
e.onChangeLivesListener=this.changeLives.bind(this),this.setPositionRound(BaseCellView.alignInTheGrid(e.x+.5,e.y+.5))},calcPosition:function(e,t){var i=Math.cos(-e.rotation*Math.PI/180),s=Math.sin(-e.rotation*Math.PI/180);return cc.p(e.x+i*t,e.y+s*t)},changeLives:function(e){var t=this.getStyles(),i=this.items[0].view;i.replaceParentSamePlace(this.parent),this.items.shift();var s=this.calcPosition(i,t.moveBy.distance);this.setLocalZOrder(9),this.removeCurrentAnimation(i),i.runAction(new cc.Sequence(new cc.MoveTo(.2,s),new cc.CallFunc(function(){Game.currentGame&&(Game.currentGame.goalsController.getViewByType(e.type).collect(i,e,1,function(){i.isRunningSafe()&&i.runAction(new cc.RemoveSelf)},{moveBy:{x:0,y:0}}),i.runAction(new cc.RotateTo(.3,-90)))}.bind(this)))),this.runAction(new cc.Sequence(new cc.DelayTime(.6),new cc.CallFunc(function(){this.setLocalZOrder(this.baseZOrder),this.rotateAll()}.bind(this))))},rotateAll:function(){this.items.forEach(function(e,t){e.view.runAction(
new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.3,1,this.calcScale()),new cc.RotateTo(.3,this.calcRotation(t))),new cc.CallFunc(function(){0===t&&e.view.runAction(new cc.Sequence(new cc.ScaleTo(.3,e.view.getScaleX(),1.2*e.view.getScaleY()),new cc.CallFunc(function(){this.addCurrentAnimation(e.view)}.bind(this))))}.bind(this))))}.bind(this))},unuse:function(){this.cell.onChangeLivesListener=function(){},BaseCellView.unuse.call(this)},getStyles:function(){return cleverapps.styles.ClockCellView}});cleverapps.styles.ClockCellView={radius:75,hover:{y:10},goal:{width:120,height:120},animation:{width:100,height:100},moveBy:{distance:70}};var SmallPetardCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(e),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=this.getStyles(),i=this.animation=new cleverapps.Spine(bundles.small_petard.jsons.small_petard_json,1);i.setSkin(
ColorCell.CODE_COLORS[e.color]),i.setAnimation(0,"idle",!0),this.addChild(i),i.setPositionRound(this.width/2,this.height/2);var s=this.livesBg=new cc.Sprite(bundles.small_petard.frames.small_petard_lives_bg);this.addChild(s),s.setPositionRound(this.width/2+t.livesBg.x,t.livesBg.y);var n=this.livesText=cleverapps.UI.generateTTFText(e.lives,cleverapps.styles.FONTS.TEXT);n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.addChild(n),n.setPositionRound(s.width/2+t.livesText.x,s.height/2+t.livesText.y),n.setScale(t.livesText.scale[0]),9<e.lives&&n.setScale(t.livesText.scale[1]),this.initialize(e)},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeLivesListener=this.changeLives.bind(this),e.onBlowUpListener=this.blowUp.bind(this),e.onShowUpListener=this.showUp.bind(this)},changeLives:function(){var e=this.getStyles();this.livesText.setString(this.cell.lives),this.livesText.setScale(e.livesText.scale[0]),9<this.cell.lives&&this.livesText.setScale(e.livesText.scale[1])},
showUp:function(){this.setScale(0),this.animation.setAnimation(0,"idle",!0),this.animation.setCompleteListener(function(){}),this.livesBg.setVisible(!0),this.stopAllActions(),this.runAction(new cc.Sequence(new cc.ScaleTo(.3,1).easing(cc.easeBackOut())))},blowUp:function(e,t){this.livesBg.setVisible(!1),this.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.CallFunc(function(){SmallPetardCellView.explosionWavesAnimation.call(this,{image:bundles.small_petard.frames.small_petard_wave,directions:[t],cellsToFlyCount:e})}.bind(this)))),this.animation.setAnimation(0,"explode",!1),this.animation.setCompleteListener(function(){this.animation.setAnimation(0,"explode_idle",!0),this.animation.setCompleteListener(function(){})}.bind(this))},getStyles:function(){return cleverapps.styles.SmallPetardCellView}}));SmallPetardCellView.explosionWavesAnimation=function(d){d=d||{},Game.currentGame&&Game.currentGame.shakeField();var e=void 0!==d.fieldDX||void 0!==d.fieldDY,t=0,i=0;d.fieldDX&&(t=d.fieldDX
),d.fieldDY&&(i=d.fieldDY);var h=BaseCellView.alignInTheGrid(this.cell.x+t,this.cell.y+i);!e&&this instanceof BigCellView&&(h=BaseCellView.alignInTheGrid(this.cell.x+.5,this.cell.y+.5));var u=this.getParent(),s=d.directions||BaseCell.DIRECTIONS;s=s.map(function(e){return{x:e.x,y:-1*e.y}}),cleverapps.values(s).forEach(function(e){var t=new cc.Sprite(d.image);u.addChild(t);var i=Math.acos(e.y/Math.sqrt(e.x*e.x+e.y*e.y))/Math.PI*180;e.x<0&&(i*=-1);var s=1;e.x*e.y!=0&&(s/=Math.sqrt(2));var n=cc.p(h.x+e.x*this.width*s,h.y+e.y*this.height*s),o=-1===e.x?n.x:0===e.x?1e4:u.width-n.x,a=-1===e.y?n.y:0===e.y?1e4:u.height-n.y,r=Math.min(o,a),l=cc.p(n.x+e.x*r,n.y+e.y*r);if(t.setRotation(i),t.setPositionRound(n),t.setScale(d.scale||1),t.setLocalZOrder(30),d.bulletFly){var c=d.timeFlyOneCellSec*d.cellsToFlyCount;l=cc.p(n.x+e.x*d.cellsToFlyCount*cleverapps.styles.BaseCellView.CELL_SIZE_PX,n.y+e.y*d.cellsToFlyCount*cleverapps.styles.BaseCellView.CELL_SIZE_PX);t.setScale(1.5),t.setScaleX(.3),t.runAction(
new cc.ScaleTo(c/2,1.5,1.5)),t.runAction(new cc.Sequence(new cc.MoveTo(c,l),new cc.RemoveSelf))}else{d.hasOwnProperty("cellsToFlyCount")&&(l=cc.p(n.x+e.x*d.cellsToFlyCount*cleverapps.styles.BaseCellView.CELL_SIZE_PX,n.y+e.y*d.cellsToFlyCount*cleverapps.styles.BaseCellView.CELL_SIZE_PX));var p=Math.sqrt((n.x-l.x)*(n.x-l.x)+(n.y-l.y)*(n.y-l.y))/u.width*1.1;t.runAction(new cc.Sequence(new cc.Spawn(new cc.MoveTo(p,l).easing(cc.easeOut(2)),new cc.Sequence(new cc.DelayTime(p/2),new cc.FadeOut(p/2).easing(cc.easeOut(2)))),new cc.RemoveSelf))}}.bind(this))},cleverapps.styles.SmallPetardCellView={livesBg:{y:30,x:1},livesText:{scale:[.75,.65],y:-2,x:-1},scale:.95};var CannonCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(e),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),this.initialize(e)},initialize:function(e){BaseCellView.initialize.call(this,e);var t=this.styles(
).text,i=bundles.cannon;this.static=new cleverapps.Spine(i.jsons.json,1),this.static.setAnimation(0,"gun_static",!1),this.animationsNode=new cc.Node,this.animationsNode.setContentSize2(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.animationsNode.addChild(this.static),this.animationsNode.setLocalZOrder(0),this.animationsNode.setPositionRound(this.width/2,this.height/2),this.addChild(this.animationsNode),this.shot=new cleverapps.Spine(i.jsons.json,1),this.animationsNode.addChild(this.shot),this.shot.setStartVisibleListener(function(){this.static.visible=!1}.bind(this)),this.angle=CannonCellView.ROTATION_BY_DIR[e.currDir],this.animationsNode.setRotation(-this.angle),this.livesText=new cleverapps.UI.ImageFont("white_digit_",""+e.lives),this.livesText.setColor(cleverapps.styles.COLORS[t.color]),this.livesText.setScale(t.scale),this.livesText.setLocalZOrder(1),this.addChild(this.livesText),this.livesText.setPositionRound(this.width/2+t.x,
this.height/2+t.y),this.cell.onChangeLivesListener=this.changeLives.bind(this),this.cell.onTurnListener=this.turn.bind(this),this.cell.onFireListener=this.fire.bind(this),this.cell.view=this},changeLives:function(){this.updateLivesText()},fire:function(e){this.shot.setAnimation(0,"gun_action",!1),this.animationsNode.runAction(new cc.Sequence(new cc.DelayTime(.12),new cc.CallFunc(function(){SmallPetardCellView.explosionWavesAnimation.call(this,{image:bundles.cannon.frames.cannonBullet,directions:[BaseCell.DIRECTIONS[CannonCellView.ROTATION_BY_DIR.indexOf(this.angle)]],bulletFly:!0,timeFlyOneCellSec:CannonCell.timeFlyOneCellSec,cellsToFlyCount:0===e?e:e-1})}.bind(this)))),this.shot.setCompleteListener(function(){this.shot.setVisibleAsync(!1),this.static.setVisibleAsync(!0)}.bind(this))},turn:function(){var e=this.angle,t=CannonCellView.ROTATION_BY_DIR[this.cell.currDir],i=(this.cell.clockwise,-(t-e+360)%360);this.cell.clockwise||(i=(360+i)%360),
this.animationsNode&&this.animationsNode.runAction(new cc.RotateBy(.5,i)),this.angle=t},updateLivesText:function(){this.livesText.setString(""+this.cell.lives)},styles:function(){return cleverapps.styles.CannonCellView}}));CannonCellView.ROTATION_BY_DIR=[0,45,90,135,180,-135,-90,-45],cleverapps.styles.CannonCellView={text:{color:"WHITE",scale:1,x:0,y:0}};var WallCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(e),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),this.initialize(e),this.image=new cc.Sprite(bundles.wall.frames.wall_tile),this.image.setPositionRound(this.width/2,this.height/2),this.addChild(this.image)},refuse:function(){}})),SpecialShapeCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(e)},initialize:function(e){BaseCellView.initialize.call(this,e);var t=e.getSize(),i=cleverapps.styles.BaseCellView.CELL_SIZE_PX
,s=this.getStyles();this.setAnchorPoint2(),e.isForEditor||e.isForGoal?this.setContentSize2(s.goal.width,s.goal.width):(this.setContentSize2(i*t.rows,i*t.cols),this.setPositionRound(this.calcPositionInTheGrid()))},calcPositionInTheGrid:function(){var e=this.cell.getSize();return BaseCellView.alignInTheGrid(this.cell.topLeftX+e.cols/2-.5,this.cell.topLeftY+e.rows/2-.5)},scaleViewContent:function(){var e=this.getStyles(),t=cleverapps.styles.BaseCellView.CELL_SIZE_PX,i=this.cell.getSize(),s=e.goal.width/(i.rows*t),n=e.goal.height/(i.cols*t);this.getChildren().forEach(function(e){e.setScale(Math.min(s,n))})},showHover:function(){BigCellView.prototype.showHover.apply(this,arguments)},refuse:function(){if(0===this.getRotation()){this.runAction(new cc.Sequence(new cc.RotateBy(.1,-3).easing(cc.easeIn(1)),new cc.RotateBy(.2,6).easing(cc.easeIn(1)),new cc.RotateTo(.1,0)).easing(cc.easeIn(1)))}},shakeAnimation:function(){},getStyles:function(){return cleverapps.styles.SpecialShapeCellView}}))
;SpecialShapeCellView.ROTATION_BY_ID=[0,90,180,-90],cleverapps.styles.SpecialShapeCellView={hover:{y:10},goal:{width:120,height:120}};var FigureDragonCellView=SpecialShapeCellView.extend({ctor:function(e){if(this._super(e),e.isForGoal){this.setContentSize2(this.getStyles().goal),this.setAnchorPoint2();var t=new cc.Sprite(bundles.figure_dragon.frames.figure_dragon_goal);return this.addChild(t),void t.setPositionRound(this.width/2,this.height/2)}if(e.isHead){this.initialize(e);t=new cc.Sprite(this.getImage());this.addChild(t),t.setPositionRound(this.width/2,this.height/2),t.setRotation(SpecialShapeCellView.ROTATION_BY_ID[e.rotation]),this.livesText=cleverapps.UI.generateTTFText(e.lives,cleverapps.styles.FONTS.WINDOW_TEXT),this.addChild(this.livesText),this.livesText.setPositionRound(this.width/2,this.height/2+this.getStyles().livesText.y),this.livesText.setPosition(this.width/2,this.height/2+this.getStyles().livesText.y),this.livesText.setLocalZOrder(1)}},initialize:function(e){
SpecialShapeCellView.prototype.initialize.call(this,e),e.onChangeLivesListener=this.changeLives.bind(this)},changeLives:function(){this.livesText.setString(this.cell.lives)},getImage:function(){return bundles.figure_dragon.frames["figure_dragon_"+this.cell.configId]},getStyles:function(){return cleverapps.styles.FigureDragonCellView}});cleverapps.styles.FigureDragonCellView=cleverapps.overrideStyles(cleverapps.styles.SpecialShapeCellView,{livesText:{y:-60}},!0);var FieldController=function(n,e){var t=e.scene,o=new FloorView;t.addChild(o);var a=new FieldView(n,e),i=new BarriersView(n.barriers,a,BaseCellView.alignInTheGrid);t.addChild(i),t.addChild(a),this.fieldView=a,this.floorView=o,this.barriersView=i,n.onShakeField=function(e){if(cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW){(e=e||{}).strength=cleverapps.styles.FieldController.shake;var t=a.innerContainer;e.base={x:t.getParent().width/2,y:t.getParent().height/2,r:0},cleverapps.UI.shake(t,e)}},
this.getTouchedCell=function(e){var t=a.convertTouchToNodeSpace(e),i=a.getCellPosition(t);return n.cells[i.row]&&n.cells[i.row][i.col]},n.onChangeSize=function(){a.ajustScale(),o.ajustSize(a),i.adjustSize(a)},n.onBackgroundAdded=o.addBackground.bind(o),n.onAddBorder=o.addBorder.bind(o),this.upForTutorial=function(e,t,i){i=i||{},o.backgroundChangeParent(e,t,Game.levelTutorialView.floorViewClone,o);var s=n.floor[t][e];s&&(s instanceof RabbitTile&&2===s.size&&s.isRoot&&i.cellBooster||s.onChangeParent(Game.levelTutorialView.floorViewClone));n.cells[t][e].changeParent(Game.levelTutorialView.fieldViewClone),Game.currentGame.fieldController.barriersView.changeCellParent(t,e,Game.levelTutorialView.barriersViewClone)},this.backFromTutorial=function(e,t,i){i=i||{},o.backgroundChangeParent(e,t,o,Game.levelTutorialView.floorViewClone);var s=n.floor[t][e];s&&(s instanceof RabbitTile&&2===s.size&&s.isRoot&&i.cellBooster||s.onChangeParent(o));n.cells[t][e].changeParent(a),
Game.currentGame.fieldController.barriersView.changeCellParent(t,e,Game.currentGame.fieldController.barriersView)},n.onBombByLeftMovesCreate=function(e){var t=BombByLeftMovesView.factory(e);if(!t.parent){var i=a;cleverapps.styles.BombByLeftMovesView.parentScene&&(i=i.parent),i.addChild(t)}},n.onCellAdded=function(e){if(!e.viewExists){var t=e.getViewClass(),i=cc.pool.hasObject(t)?cc.pool.getFromPool(t,e):new t(e);a.addChild(i),e.viewExists=!0}},n.onScoreAdded=function(e,t,i,s){var n=FieldScoreView.factory(e,t,i,s);n&&a.addChild(n)},n.onCloverAdded=function(e,t,i){Game.currentGame&&MissionAnimationView.show(Game.currentGame.getMissionType(),a,{amount:e,beginPos:BaseCellView.alignInTheGrid(t,i)})},n.onTileAdded=function(e){var t=e.getViewClass(),i=cc.pool.hasObject(t)?cc.pool.getFromPool(t,e):new t(e);o.addChild(i)};var s=void 0;a.onTouchBeganListener=function(e,t){Game.counter.isActive()||n.hidden?s=void 0:(n.availableMove.boo(),s={x:e.x,y:e.y},n.swipeSelected=t,n.onTouchStarted(
n.cells[t.row]&&n.cells[t.row][t.col]))},a.onTouchMovedListener=function(e,t){!Game.counter.isActive()&&cleverapps.metha.isControlEnabled("field")?(n.onTouchMoved(n.cells[t.row]&&n.cells[t.row][t.col]),s&&(Math.abs(s.x-e.x)>=Math.abs(s.y-e.y)?s.x-e.x>FieldController.MOVE_TRESHOLD?(n.onTouchSwiped({row:0,col:-1}),s=void 0):e.x-s.x>FieldController.MOVE_TRESHOLD&&(n.onTouchSwiped({row:0,col:1}),s=void 0):e.y-s.y>FieldController.MOVE_TRESHOLD?(n.onTouchSwiped({row:-1,col:0}),s=void 0):s.y-e.y>FieldController.MOVE_TRESHOLD&&(n.onTouchSwiped({row:1,col:0}),s=void 0))):s=void 0},a.onTouchEndedListener=function(e,t){n.swipeSelected=void 0,!Game.counter.isActive()&&cleverapps.metha.isControlEnabled("field")&&s&&(cleverapps.config.debugMode&&(n.cells[t.row]&&n.cells[t.row][t.col]?n.cells[t.row][t.col].onDebugListener():console.log("Empty: "+t)),n.onTouchEnded(n.cells[t.row]&&n.cells[t.row][t.col])),s=void 0},n.onChangeSelected=a.createListener(function(e){e?a.showSelection(e.y,e.x
):a.hideSelection()}),n.onShuffleAnimationListener=function(){a.onShuffleAnimation()},n.onGoalsDoneAnimationListener=function(){a.onGoalsDoneAnimation()},n.onBigExplodeAnimationListener=function(e){a.onBigExplodeAnimation(e)},n.onFiveMovesLeftListener=function(){a.fiveMovesLeftAnimation()},n.onMoveAnimationListener=function(e,t,i){a.moveAnimation(e,t,i)},n.onLetsGoAnimationListener=a.createListener(function(){a.letsGoAnimation()}),n.onHardLevelAnimationListener=a.createListener(function(){a.hardLevelAnimation()}),n.onTutorialFinishAnimation=function(){a.tutorialFinishAnimation()},n.onBonusByLeftMovesListener=function(){a.onBonusByLeftMovesAnimation()},n.onShowUpAnimationStartListener=a.createListener(function(){a.onShowUpAnimationStart()}),n.onHideAll=function(){a.hide(),a.hide.call(o),a.hide.call(i)}};FieldController.MOVE_TRESHOLD=12,cleverapps.styles.FieldController={shake:{dx:2,dy:2}};var GoalsController=function(e,t){GoalsController.initFactory(),this.goalsView=new GoalsView(e,this
),t.addChild(this.goalsView),this.upForTutorial=function(){this.goalsView.replaceParentSamePlace(Game.levelTutorialView)}.bind(this),this.backFromTutorial=function(){this.goalsView.replaceParentSamePlace(t)}.bind(this)};GoalsController.initFactory=function(){GoalsController.creators||(GoalsController.creators={},GoalsController.registerViewFactory("a",GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory("b",GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory("c",GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory("d",GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory("e",GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory("w",GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(FishCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(FlowerCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(
NutCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(Mark.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(MouseCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(IceTile.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(DragonCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(CookieManCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(GingerHouseCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(CakeCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(MuffinGoalCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(WaffleCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(CandleCell.GOAL_ID,GoalsController.baseGoalViewCreator),
GoalsController.registerViewFactory(RabbitTile.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(LollipopCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(DogCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(TruffleCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(ColorCookieManCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(FireflyJarCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(IceMakerCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(RugTile.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(DirtyHoneyTile.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(ColorContainerCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(
GumDecoratorCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(ClockCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(DirtDecoratorCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(CrabDecoratorCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(BoxDecoratorCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(BagDecoratorCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(BombCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(FireworkCell.GOAL_ID,GoalsController.baseGoalViewCreator),GoalsController.registerViewFactory(SyrupTile.GOAL_ID,GoalsController.baseGoalViewCreator),"riddles"===cleverapps.config.name&&GoalsController.registerViewFactory(FigureDragonCell.GOAL_ID,GoalsController.baseGoalViewCreator))},
GoalsController.baseGoalViewCreator=function(e,t){switch(e.type){case Mark.GOAL_ID:return new MarkGoalView(e,new cc.Sprite(res.mark_goal))}var i;switch(e.type){case"a":case"b":case"c":case"d":case"e":case"w":(i=new GoalColorCell).color=e.type;break;case FlowerCell.GOAL_ID:(i=new FlowerCell(-1,-1)).lives=0;break;case FishCell.GOAL_ID:i=new FishCell;break;case CookieManCell.GOAL_ID:i=new CookieManCell;break;case NutCell.GOAL_ID:i=new NutCell;break;case MouseCell.GOAL_ID:i=new MouseCell(-1,-1);break;case BlanketCell.GOAL_ID:i=new BlanketCell(-1,-1,2,2);break;case DogCell.GOAL_ID:i=new DogCell(-1,-1);break;case DragonCell.GOAL_ID:i=new DragonCell(-1,-1);break;case IceTile.GOAL_ID:i=new IceTile(-1,-1);break;case GingerHouseCell.GOAL_ID:i=new GingerHouseCell(-1,-1);break;case CakeCell.GOAL_ID:i=new CakeCell(-1,-1);break;case MuffinGoalCell.GOAL_ID:i=new MuffinGoalCell;break;case WaffleCell.GOAL_ID:i=new WaffleCell(-1,-1);break;case TruffleCell.GOAL_ID:i=new TruffleCell(-1,-1);break
;case LollipopCell.GOAL_ID:i=new LollipopCell(-1,-1);break;case CandleCell.GOAL_ID:i=new CandleCell;break;case RabbitTile.GOAL_ID:i=new RabbitTile;break;case ColorCookieManCell.GOAL_ID:i=new ColorCookieManCell(-1,-1);break;case ColorBombCell.GOAL_ID:i=new ColorBombCell(-1,-1);break;case RugTile.GOAL_ID:i=new RugTile(-1,-1);break;case FireflyJarCell.GOAL_ID:i=new FireflyJarCell(-1,-1);break;case DirtyHoneyTile.GOAL_ID:i=new DirtyHoneyTile(-1,-1);break;case ColorContainerCell.GOAL_ID:i=new ColorContainerCell(-1,-1);break;case IceMakerCell.GOAL_ID:i=new IceMakerCell(-1,-1);break;case GumDecoratorCell.GOAL_ID:i=new GumDecoratorCell(-1,-1);break;case ClockCell.GOAL_ID:i=new ClockCell(-1,-1);break;case SyrupTile.GOAL_ID:i=new SyrupTile;break;case DirtDecoratorCell.GOAL_ID:i=new DirtDecoratorCell(-1,-1);break;case CrabDecoratorCell.GOAL_ID:i=new CrabDecoratorCell(-1,-1);break;case BoxDecoratorCell.GOAL_ID:i=new BoxDecoratorCell(-1,-1);break;case BagDecoratorCell.GOAL_ID:i=new BagDecoratorCell
;break;case BombCell.GOAL_ID:i=new BombCell;break;case FireworkCell.GOAL_ID:i=new FireworkCell;break;case FigureDragonCell.GOAL_ID:i=new FigureDragonCell}return new CellGoalView(e,i,t)},GoalsController.registerViewFactory=function(e,t){GoalsController.creators[e]=t},GoalsController.createView=function(e,t){return new GoalsController.creators[e.type](e,t)},GoalsController.prototype.getViewByType=function(e){return this.viewByType[e]};var LevelTutorialController=function(s){var n=s.tutorial,o=s.fieldController,a=s.boostersController,r=s.goalsController,l=s.movesView;n.onChangeStep=function(t){if(!t.cellBooster||t.cellBooster.alive&&Game.currentGame&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN){var e=function(e){var i=new LevelTutorialView(t,o.fieldView,o.floorView,o.barriersView,n);s.scene.addChild(i),i.upCell=function(e,t){o.upForTutorial(e,t,i.data)},i.upMoves=function(){if(t.moves){l.replaceParentSamePlace(i),l.actor&&l.actor.replaceParentSamePlace(i);var e=l.getPosition()
;return e.y-=l.height/4,e}},i.finishStep=function(){n.finishStep(),Game.counter.setTimeout(function(){},300)},i.upGoals=function(){t.goals&&r.upForTutorial(t.goals)},i.upBooster=function(){if(void 0!==t.booster)return a.upForTutorial(t.booster)},i.downCell=function(e,t){o.backFromTutorial(e,t,i.data)},i.downGoals=function(){t.goals&&r.backFromTutorial(t.goals)},i.downMoves=function(){t.moves&&(l.replaceParentSamePlace(l.targetPanel),l.actor&&l.actor.replaceParentSamePlace(l.targetPanel))},i.downBooster=function(){if(void 0!==t.booster)return a.backFromTutorial(t.booster)},i.init(),n.onChangeSelected=i.createListener(function(e){e?i.removeFinger():i.createFinger()}),n.onFinishStep=i.createListener(function(){i.clear(e),n.onChangeSelected=function(){},n.onFinishStep=function(){},i=void 0})};s.onIntro?(cleverapps.metha.controlFreeFocus("field"),cleverapps.metha.controlFreeFocus("panel_controls"),cleverapps.metha.controlFreeFocus("panel_info"),e(function(){})
):cleverapps.metha.displayWhenFreeFocus({focus:"LevelTutorial",control:["field","panel_controls","panel_info"],action:e})}else n.finishStep()}.bind(this)},Match3Scene=GameSceneBase.extend({addScoreView:function(){var e=new ScoreView(this.game.score,this.scene,this.infoPanel);e.setLocalZOrder(1),this.infoPanel.addChild(e)},addMovesView:function(){var e=new MovesView(this.game);e&&(this.movesView=e,this.movesView.targetPanel=this.infoPanel,this.infoPanel.addChild(e))},addGoals:function(){this.game.goalsController=new GoalsController(this.game,this.infoPanel)},addLevelRewards:function(){cleverapps.styles.PassLevelReward.enabled&&(this.passLevelRewards=new PassLevelReward(this.infoPanel,this))},ctor:function(t,e){this._super(t,e),FreeMoves.calcAvailable();var i=cleverapps.styles.GameScene.actor;i&&(this.actor=new Actor(i),this.controlsPanel.addChild(this.actor),this.actor.setLocalZOrder(11),t.heroAnimation=this.actor.createListener(this.actor.animate.bind(this.actor)),
this.gunView&&this.gunView.initActor(this.actor)),this.addGoals(),this.addScoreView(),this.addMovesView();var s=t.fieldController=new FieldController(t.field,this);if(this.fieldView=s.fieldView,t.field.boosterAdvice){var n=new BoosterAdviceView(t.field.boosterAdvice,this.fieldView);this.scene.addChild(n)}var o=t.boostersController=new BoostersController(t.boosters,this.controlsPanel,s.getTouchedCell);if(t.onBoosterCellCollected=this.createListener(this.showBoosterCellReward.bind(this)),t.createTutorialController=function(e){t.tutorial&&new LevelTutorialController({tutorial:t.tutorial,scene:this.scene,fieldController:s,boostersController:o,goalsController:t.goalsController,movesView:this.movesView,infoPanel:this.infoPanel,onIntro:e})}.bind(this),t.load(),t.onMoveEnded=function(e){switch(t.churnActivated(),cleverapps.playSession.notifyActive(),t.score.addMoves(),e<=9&&(cleverapps.gun.showUp(),cleverapps.gun.isForceAvailable()&&cleverapps.gun.showForce()),e){case 5:
return t.field.onFiveMovesLeftListener(),!0;case 0:return(!Game.currentGame||Game.currentGame&&!Game.currentGame.loseByBombExplodeRunning)&&this.outOfMoves(),!0;case 3:this.level.isCurrentLevel()&&HelpByFiveAttemptsWindow.showIfCan();break;case 2:case 1:return this.helpFromFriendMoves()}return!1}.bind(this),this.addLevelRewards(),levels.levelAttempts.addAttempt(this.level),cleverapps.playSession.inc(cleverapps.EVENTS.PLAY_TIMES),e.isHard()&&cleverapps.styles.HardLevelIcon.enabled){var a=cleverapps.styles.HardLevelIcon.parentSceneScene?this.scene:this;this.hardLevelIcon=new HardLevelIcon(a)}this.passLevelRewards&&this.game.backgroundMission&&this.game.backgroundMission.isRunning()&&this.passLevelRewards.addPrize(PassLevelReward.BACKGROUND_CLOVER),this.controlsPanel.hide(),-1!==["adventure","heroes","runes"].indexOf(cleverapps.config.name)&&(Game.currentGame.fieldController.fieldView.setVisible(!1),Game.currentGame.fieldController.floorView.setVisible(!1),
Game.currentGame.fieldController.barriersView.setVisible(!1),cleverapps.styles.FieldView.slideAnimation.movesView&&this.movesView&&this.movesView.setVisible(!1))},showBoosterCellReward:function(){this.passLevelRewards&&this.passLevelRewards.addPrize(PassLevelReward.BOOSTER)},showProperWindow:function(e){var t=this.game.outcome;t!==GameBase.OUTCOME_GAVEUP?(t===GameBase.OUTCOME_LOST?new LoseWindow(function(t){this.boatswain.intent=function(e){this.boatswain.REPLAY(e,t)}.bind(this)}.bind(this),this.game):new VictoryWindow({level:this.level,score:this.score,stars:this.stars,game:this.game,oldChestStars:this.oldChestStars,oldStars:this.oldStars,starChestChange:this.starChestChange,boatswain:this.boatswain}),cleverapps.metha.onceNoWindowsListener=e):e()},onWinWindowReadyListener:function(e,t){cleverapps.config.results,this.score=this.game.score.points,this.stars=this.game.score.stars,this.tapToSkip&&this.tapToSkip.hide(),this.infoPanel.hide(),this.hardLevelIcon&&this.hardLevelIcon.hide(),
this.game.field.onHideAll(),this.waitingWinLoseAnimations?this.waitingWinLoseAnimations():this.waitingWinLoseAnimations=!1},saveFinalResults:function(e){this.oldChestStars=cleverapps.starChest.stars,this.oldStars=0,this.level.isRegular()&&!this.level.isCurrentLevel()&&(this.oldStars=cleverapps.userresult.getStarsForLevel(this.level.episodeNo,this.level.levelNo)),this.game.outcome===GameBase.OUTCOME_VICTORY&&(cleverapps.social.sendActivity&&cleverapps.social.sendActivity(cleverapps.Social.ACTIVITY.LVL_PASSED,{userName:cleverapps.friends.getPlayer().name,score:this.score,levelNo:this.level.getHumanReadableNumber()}),this.starChestChange=this.calcAddedStars(this.stars),cleverapps.starChest&&cleverapps.starChest.addStars(this.starChestChange),cleverapps.config.results&&cleverapps.userresult.updateLevel(this.level.episodeNo,this.level.levelNo,this.score,this.stars)),GameSceneBase.prototype.saveFinalResults.call(this,e)},waitWinLoseAnimations:function(e){
!1===this.waitingWinLoseAnimations||this.game.outcome!==GameBase.OUTCOME_VICTORY?e():this.waitingWinLoseAnimations=e},helpFromFriendMoves:function(){var e=function(e,t){if(e){var i=cleverapps.UI.generateTTFText(t.amount,cleverapps.styles.FONTS.MOVES_TEXT);i.setPosition(e),e.parent.addChild(i),WindowHelper.animateCollect(i,{scale:1.5,target:cleverapps.styles.UI.MovesView_target})}this.counter.setTimeout(function(){this.setMoves(this.moves+t.amount)}.bind(this),700)}.bind(this.game);return HelpFromFriendsWindow.showIfCanMoves(e)},outOfMoves:function(){cleverapps.audio.playSound(bundles.game.urls.no_moves_effect),Game.currentGame.prolongation.updateFree(FreeMoves.available),FreeMoves.available&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FREE_MOVES),cleverapps.metha.displayWhenFreeFocus({focus:"AddMovesWindow",control:"panel_info",action:function(e){this.game&&Game.currentGame===this.game&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN?cleverapps.metha.compound(e,[function(e){
Game.currentGame.counter.setTimeout(e,500)},function(e){new ProlongationWindow(Game.currentGame.prolongation,function(){Game.counter&&Game.counter.setTimeout(function(){Game.currentGame&&Game.currentGame.lose()},0)}),cleverapps.metha.onceNoWindowsListener=e},function(e){FreeMoves.available=!1,e()}]):e()}.bind(this)})},beforeWin:function(){this.game.field.stopSmile(),this.game.outcome===GameBase.OUTCOME_VICTORY&&(0<=this.game.beginMoves&&"runes"!==cleverapps.config.name&&(this.tapToSkip=new TapToSkipButton,this.scene.addChild(this.tapToSkip)),this.runAction(new cc.Sequence(new cc.DelayTime("runes"===cleverapps.config.name?0:4),new cc.CallFunc(function(){"runes"===cleverapps.config.name?Game.currentGame&&Game.currentGame===this.game&&Game.currentGame.skipWinAnimation():Game.counter.setAfterRunStages(function(){Game.currentGame&&Game.currentGame===this.game&&Game.currentGame.skipWinAnimation()}.bind(this))}.bind(this)))),
this.game.onVictoryAnimationsFinished=this.onWinWindowReadyListener.bind(this)),GameSceneBase.prototype.beforeWin.call(this)}});(GameScene=Match3Scene).BUNDLES=function(e,t){return GameSceneBase.BUNDLES(e,t)};var PassLevelReward=cleverapps.Layout.extend({ctor:function(e,t){this.game=Game.currentGame,this.occupiedSlots=0,this.scene=t,this.createSlots();var i=this.checkGameFieldOverlap(e),s=cleverapps.UI.HORIZONTAL;(cleverapps.wideMode.mode===cleverapps.WideMode.SQUARE||i)&&(s=cleverapps.UI.VERTICAL),this._super(this.slots,{direction:s}),cleverapps.wideMode.mode!==cleverapps.WideMode.HORIZONTAL&&this.slots.reverse(),e.addChild(this);var n=cleverapps.styles.PassLevelReward.positions[i?cleverapps.WideMode.SQUARE:cleverapps.wideMode.mode];this.setPositionRound(n),this.setLocalZOrder(10)},checkGameFieldOverlap:function(e){if(cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL)return!1;var t=new cc.Node;t.setAnchorPoint2();var i=cleverapps.styles.PassLevelReward.slot;t.setContentSize2(
i.width*PassLevelReward.SLOTS,i.height);var s=cleverapps.styles.PassLevelReward.positions[cleverapps.WideMode.VERTICAL];return t.setPositionRound(s),e.addChild(t),e.hideHandler&&e.hideHandler.originalPosition&&(t.x+=e.hideHandler.originalPosition.x-e.x,t.y+=e.hideHandler.originalPosition.y-e.y),this.scene.fieldView.overlapsWithField(t,e)},createSlots:function(){var e=cleverapps.styles.PassLevelReward;this.slots=[];for(var t=0;t<PassLevelReward.SLOTS;t++){var i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(e.slot),this.slots.push(i)}},createReward:function(e){var t=cleverapps.styles.PassLevelReward,i=this.getIcon(e),s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(i.width*i.scale,i.height*i.scale),s.addChild(i),i.setPosition(s.width/2,s.height/2);var n=cleverapps.UI.generateTTFText(this.getAmount(e),t.prize.text.font);return n.setVisible(!1),n.baseScale=n.getScale(),s.addChild(n),n.setPositionRound(t.prize.text),s.icon=i,s.amount=n,s},addPrize:function(e){
var t=cleverapps.styles.PassLevelReward;if(this.game&&this.occupiedSlots<this.slots.length){var i=this.createReward(e);i.icon.setScale(t.prize.icon.scale[e]),i.setScale(0);var s=this.slots[this.occupiedSlots];s.type=e,this.occupiedSlots++,s.reward=i,s.addChild(i),i.setPositionRound({x:{align:"center"},y:{align:"center"}}),cleverapps.tooltipManager.create(s,{text:Messages.get("PassLevelRewardTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.below});var n=t.delay[e];i.runAction(new cc.Sequence(new cc.DelayTime(n),new cc.Spawn(new cc.ScaleTo(.4,1).easing(cc.easeBackOut()),new cc.Sequence(new cc.RotateTo(.1,10),new cc.RotateTo(.1,-20),new cc.RotateTo(.1,10),new cc.RotateTo(.1,0))))),i.amount.runAction(new cc.Sequence(new cc.DelayTime(n+.3),new cc.CallFunc(function(){i.amount.setVisible(!0)}),new cc.ScaleTo(.2,i.amount.baseScale)))}},getIcon:function(e){var t;switch(e){case PassLevelReward.BACKGROUND_CLOVER:t=this.game.backgroundMission.getIcon();break;case PassLevelReward.BOOSTER:
t=[bundles.reward_icons.frames.cellbooster,bundles.reward_icons.frames.linebooster,bundles.reward_icons.frames.colorbooster][this.game.collectedBoosterCell.type]}var i=new cc.Sprite(t);return i.setScale(1),i},getAmount:function(e){var t;switch(e){case PassLevelReward.BACKGROUND_CLOVER:t=this.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER];break;case PassLevelReward.BOOSTER:t=1}return 1<t?""+t:""}});PassLevelReward.BACKGROUND_CLOVER="bc",PassLevelReward.BOOSTER="b",PassLevelReward.SLOTS=3,cleverapps.styles.FONTS.PASS_LEVE_REWARD={prefix:"digits_game#goals_digit_",size:28,scale:.9,color:cleverapps.styles.COLORS.WHITE},cleverapps.styles.PassLevelReward={enabled:!0,width:100,height:300,delay:{bc:3,b:1.7},positions:[{x:{align:"right",dx:-20},y:{align:"bottom",dy:-70}},{x:{align:"right",dx:100},y:{align:"top",dy:-30}},{x:{align:"center",dx:10},y:{align:"bottom",dy:-75}}],slot:{width:65,height:80},prize:{margin:0,icon:{scale:{bc:.6,b:.45}},text:{x:{align:"right",dx:0},y:{align:"bottom",dy:5},
font:cleverapps.styles.FONTS.PASS_LEVE_REWARD}}};var Panel=cc.Node.extend({ctor:function(e,t){this._super(),this.position=e,this.setAnchorPoint2(),this.setContentSize2(this.getStyles().sizes[cleverapps.wideMode.mode]),this.setBackground();var i=this.getStyles().zIndex;if(void 0!==i&&(Array.isArray(i)&&(i=i[cleverapps.wideMode.mode]),this.setLocalZOrder(i)),this.setPositionRound(this.getStyles().position),this.baseScale=1,this.getStyles().scales&&(this.baseScale=this.getStyles().scales[cleverapps.wideMode.mode]),this.setScale(this.baseScale),SceneControlButtonsView.needToAddInsidePanel()&&e===Panel.DOWN){var s=new SceneControlButton(SceneControlButtonsView.menuButtonData);s.setPositionRound(this.getStyles().menuButton.position),this.addChild(s)}cleverapps.UI.makeHideable(this,-1!==[Panel.UP,Panel.DOWN].indexOf(e)?cleverapps.UI.VERTICAL:cleverapps.UI.HORIZONTAL),cleverapps.metha.registerControl("panel_"+t,this)},getStyles:function(){},setBackground:function(){var e=this.getStyles(
).background;if(e){e.width=this.width,e.height=this.height;var i=this.background=cleverapps.UI.createSprite(e),t=e.positions?e.positions[cleverapps.wideMode.mode]:{x:this.width/2,y:this.height/2};this.addChild(i),i.setPositionRound(t),e.decors&&e.decors.forEach(function(e){var t=new cc.Sprite(e.image);t.setPositionRound(e.position),t.setLocalZOrder(10),i.addChild(t),i.rotation&&t.setRotation(i.rotation),t.replaceParentSamePlace(this)},this)}}}),ControlsPanel=Panel.extend({ctor:function(){var e=ControlsPanel.IS_DOWN()?Panel.DOWN:Panel.RIGHT;this._super(e,"controls")},getStyles:function(){return cleverapps.styles.ControlsPanel}});ControlsPanel.IS_DOWN=function(){return cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL};var InfoPanel=Panel.extend({ctor:function(){var e=cleverapps.wideMode.mode===cleverapps.WideMode.HORIZONTAL?Panel.LEFT:Panel.UP;this._super(e,"info")},getStyles:function(){return cleverapps.styles.InfoPanel}});Panel.UP=0,Panel.RIGHT=1,Panel.DOWN=2,Panel.LEFT=3,
cleverapps.styles.InfoPanel={position:[{x:{align:"center"},y:{align:"top"}},{x:{align:"center"},y:{align:"top"}},{x:{align:"left"},y:{align:"center"}}],sizes:[{width:675,height:215},{width:675,height:205},{width:205,height:642}],background:{scale9:cleverapps.UI.Scale9Rect.TwoPixelXY,image:res.goals_background,rotations:[0,0,-90],decors:[{image:bundles.game.frames.goals_background_decor_left,position:{x:{align:"left",dx:-40},y:{align:"top",dy:15}}},{image:bundles.game.frames.goals_background_decor_right,position:{x:{align:"right",dx:58},y:{align:"top"}}}]}},cleverapps.styles.ControlsPanel={zIndex:10,menuButton:{position:{x:{align:"left",dx:60},y:{align:"center",dy:0}}},position:[{x:{align:"center",dx:0},y:{align:"bottom",dy:0}},{x:{align:"right",dx:0},y:{align:"center",dy:0}},{x:{align:"right",dx:0},y:{align:"center",dy:0}}],sizes:[{width:720,height:200},{width:190,height:650},{width:190,height:650}],background:{rotations:[0,-90,-90],image:res.boosters_background_png,
scale9:cleverapps.UI.Scale9Rect.TwoPixelXY}},Prolongation.prototype.countOfGoals=function(){return this.game.goals&&Object.keys(this.game.goals.elements).length},Prolongation.prototype.createGoalIcons=function(){var e=[];for(var t in this.game.goals.elements){var i=this.game.goalsController.getViewByType(t),s=this.game.goals.elements[t],n={};i.actor&&(n.skin=i.actor.currSkin,n.spine=i.actor.currSpine);var o=GoalsController.createView(s,n);e.push(new WindowGoalView(s,o))}return e};var LevelTutorialView=cc.Node.extend({ctor:function(e,t,i,s,n){this.data=e,(Game.levelTutorialView=this)._super();var o=cleverapps.UI.getSceneSize();this.setContentSize2(o),this.setLocalZOrder(12),this.setCascadeOpacityEnabled(!0);var a=cleverapps.UI.addShadowLayer();this.addChild(a),a.y-=cleverapps.UI.getSceneOffsetY(),a.setOpacity(0),a.runAction(new cc.FadeTo(.15,cleverapps.styles.ShadowView.opacity)),this.fieldView=t,this.floorView=i,this.barriersView=s,this.prepareData(),this.tutorial=n,
this.createFieldClone(),this.createDialogue()},createDialogue:function(){this.dialogue=new Dialogue({text:this.data.textBlock.text},{showUp:!0}),this.dialogue.on("buttonClicked",cleverapps.once(this.tutorial.finishAll.bind(this.tutorial))),this.dialogueView=new DialogueView(this.dialogue,{rects:this.data.rects,autoPosition:!0,button:{text:"messages:SkipButton",textLast:"messages:SkipButton"},inner:!0,delay:.5}),this.dialogue.run()},prepareData:function(){if(this.data.cellBooster)for(this.data.light=[],i=0;i<Field.SIZE;i++)for(j=0;j<Field.SIZE;j++){var e=Game.currentGame.field.cells[i][j];e&&e instanceof BoosterCell&&this.data.light.push([e.x,e.y])}this.data.rects=[],this.data.control&&0<this.data.control.length&&Array.prototype.push.apply(this.data.rects,this.getControlRects()),void 0!==this.data.booster&&this.data.rects.push(Game.currentGame.boostersController.getView(this.data.booster).getGlobalBoundingBox()),this.data.moves&&this.data.rects.push(cc.director.getRunningScene(
).movesView.getGlobalBoundingBox()),this.data.cellBooster&&this.data.rects.push(this.getCellBoundingBox([this.data.cellBooster.x,this.data.cellBooster.y]))},getControlRects:function(){return(this.data.fingerType&&"click"===this.data.fingerType?[this.data.control[0]]:[this.data.control[0],this.data.control[1]]).map(this.getCellBoundingBox.bind(this))},getCellBoundingBox:function(e){var t=BaseCellView.alignInTheGrid(e[0],e[1]),i=cleverapps.styles.BaseCellView.CELL_SIZE_PX,s=cc.rect(t.x-i/2,t.y-i/2,i,i);return this.getGlobalBoundingBox(s,this.floorView)},init:function(){if(this.data.light)for(var e=0;e<this.data.light.length;e++)this.upCell(this.data.light[e][0],this.data.light[e][1]);this.hideGoals=this.shouldHideGoals(),this.hideGoals||this.upGoals();var t=this.upMoves(),i=this.upBooster();this.createFinger(t||i),this.applyControlCells(this.data.light,this.data.booster),this.data.closeByTouch&&setTimeout(function(){this.finishByTouch=!0}.bind(this),500)},shouldHideGoals:function(){if(
!this.data.goals||this.data.goalsForce||!Game.currentGame||!Game.currentGame.goalsController)return!1;var e=Game.currentGame.goalsController.goalsView;return!!e&&this.dialogueView.intersectsWithNode(e)},clear:function(e){if(this.removeFinger(),this.data.light)for(var t=0;t<this.data.light.length;t++)this.downCell(this.data.light[t][0],this.data.light[t][1]);this.downBooster(),this.hideGoals||this.downGoals(),this.downMoves(),this.fieldView.selection.replaceParent(this.fieldView),this.runAction(new cc.Sequence(new cc.FadeTo(.15,0),new cc.CallFunc(function(){this.data=void 0,this.fieldView=void 0,this.floorView=void 0,this.barriersView=void 0,this.floorViewClone=void 0,this.fieldViewClone=void 0,this.barriersViewClone=void 0,this.dialogue||e()}.bind(this)),new cc.RemoveSelf)),this.dialogue&&(this.dialogue.on("afterClose",e),this.dialogue.close())},createFinger:function(e){if(!this.data.cellBooster){var t=this.data.fingerType;t||(
t=this.data.control&&0<this.data.control.length?"swipe":"click"),"click"===t&&(this.finger=new FingerView,this.finger.setVisible(!0),this.finger.setLocalZOrder(10),this.finger.delay(.2),e?(this.finger.fadeIn(e),this.addChild(this.finger)):(this.finger.fadeIn(BaseCellView.alignInTheGrid(this.data.control[0][0],this.data.control[0][1])),this.fieldViewClone.addChild(this.finger)),this.finger.press(),this.finger.delay(.3),this.finger.unPress(),this.finger.fadeOut(),this.finger.delay(.8),this.finger.run({looped:!0})),"swipe"===t&&(this.finger=new FingerView,this.finger.setVisible(!0),this.finger.setLocalZOrder(10),this.fieldViewClone.addChild(this.finger),this.finger.delay(.2),this.finger.fadeIn(BaseCellView.alignInTheGrid(this.data.control[0][0],this.data.control[0][1])),this.finger.press(),this.finger.delay(.2),this.finger.moveTo(BaseCellView.alignInTheGrid(this.data.control[1][0],this.data.control[1][1])),this.finger.unPress(),this.finger.fadeOut(),this.finger.delay(.8),this.finger.run({
looped:!0}))}},removeFinger:function(){this.finger&&(this.finger.removeFromParent(!0),this.finger=!1)},createFieldClone:function(){this.floorViewClone=new cc.Node,this.floorViewClone.setAnchorPoint(this.floorView.getAnchorPoint()),this.floorViewClone.setPosition(this.floorView.getPosition()),this.floorViewClone.setContentSize(this.floorView.getContentSize()),this.floorViewClone.setScale(this.floorView.getScale()),this.addChild(this.floorViewClone),this.barriersViewClone=new cc.Node,this.barriersViewClone.setAnchorPoint(this.barriersView.getAnchorPoint()),this.barriersViewClone.setPosition(this.barriersView.getPosition()),this.barriersViewClone.setContentSize(this.barriersView.getContentSize()),this.barriersViewClone.setScale(this.barriersView.getScale()),this.addChild(this.barriersViewClone),this.fieldViewClone=new cc.Node,this.fieldViewClone.setAnchorPoint(this.fieldView.getAnchorPoint()),this.fieldViewClone.setPosition(this.fieldView.getPosition()),this.fieldViewClone.setContentSize(
this.fieldView.getContentSize()),this.fieldViewClone.setScale(this.fieldView.getScale()),this.addChild(this.fieldViewClone),this.fieldView.selection.replaceParent(this.fieldViewClone)},applyControlCells:function(o,a){o=o||[],cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(e){if(!this.data.cellBooster){for(var t=this.fieldView.getCellPosition(this.fieldView.convertTouchToNodeSpace(e)),i=0;i<o.length;i++)if(o[i][0]===t.col&&o[i][1]===t.row)return!1;var s=cleverapps.styles.UI.BoostersTargets;for(i=0;i<s.length;i++){var n=s[i];if(n.containsTouch(e)&&n.booster.id===a)return!1}}return this.finishByTouch&&(this.finishByTouch=!1,this.finishStep()),!0}.bind(this)},this)}}),FloorView=cc.Node.extend({ctor:function(){this._super(),this.setAnchorPoint(.5,.5),this.setLocalZOrder(1),this.setCascadeOpacityEnabled(!0),this.onTouchBeganListener=function(e,t){},this.onTouchMovedListener=function(){},this.onTouchEndedListener=function(){}},
ajustSize:function(e){this.scale=e.scale,this.setContentSize(e.getContentSize()),this.setPosition(e.getPosition())},addBackground:function(e,t){var i=[res.tile_background_1,res.tile_background_2][(e+t)%2],s=new cc.Sprite(i);s.setPosition(BaseCellView.alignInTheGrid(e,t)),this.addChild(s,-1,e*Field.SIZE+t)},backgroundChangeParent:function(e,t,i,s){s.getChildByTag(e*Field.SIZE+t).replaceParent(i)},addBorder:function(e,t,i,s){var n=res["border_"+FloorView.DIR_NAMES[i]+FloorView.TURN_NAMES[s]];if(n){var o=new cc.Sprite(n);o.setAnchorPoint(0,0),o.setPosition(BaseCellView.alignInTheGrid(t,e)),o.x+=-Floor.DIRS[i].x*cleverapps.styles.BaseCellView.CELL_SIZE_PX/2+cleverapps.styles.UI.Border[i][s].x,o.y+=Floor.DIRS[i].y*cleverapps.styles.BaseCellView.CELL_SIZE_PX/2+cleverapps.styles.UI.Border[i][s].y,o.setLocalZOrder(1),this.addChild(o)}}});FloorView.DIR_NAMES=["left","top","right","bottom"],FloorView.TURN_NAMES=["_left","_straight","_right"];var BarriersView=cc.Node.extend({ctor:function(e,t,i){
this.barriers=e,this.alignerGrid=i,this._super(),this.adjustSize(t),this.setAnchorPoint(.5,.5),this.setLocalZOrder(4),this.barriers.onLoadListener=this.load.bind(this)},load:function(){if(this.barriers){if(this.downSprites=[],this.barriers.isDownBarrier)for(var e=0;e<this.barriers.isDownBarrier.length;e++){this.downSprites[e]=[];for(var t=0;t<this.barriers.isDownBarrier[e].length;t++)if(this.barriers.isDownBarrier[e][t]){(i=new cc.Sprite(res.barrier)).setPosition(this.alignerGrid(t,e)),this.addChild(i),this.downSprites[e].push(i)}else this.downSprites[e].push(null)}if(this.rightSprites=[],this.barriers.isRightBarrier)for(e=0;e<this.barriers.isRightBarrier.length;e++){this.rightSprites[e]=[];for(t=0;t<this.barriers.isRightBarrier[e].length;t++)if(this.barriers.isRightBarrier[e][t]){var i;(i=new cc.Sprite(res.barrier)).setPosition(this.alignerGrid(t,e)),i.setRotation(-90),this.addChild(i),this.rightSprites[e].push(i)}else this.rightSprites[e].push(null)}}},adjustSize:function(e){
this.scale=e.scale,this.setContentSize(e.getContentSize()),this.setPosition(e.getPosition())},changeCellParent:function(e,t,i){this.downSprites&&e<this.downSprites.length&&this.downSprites[e][t]&&this.downSprites[e][t].replaceParent(i),this.downSprites&&1<=e&&this.downSprites[e-1][t]&&this.downSprites[e-1][t].replaceParent(i),this.rightSprites&&t<this.rightSprites[e].length&&this.rightSprites[e][t]&&this.rightSprites[e][t].replaceParent(i),this.rightSprites&&1<=t&&this.rightSprites[e][t-1]&&this.rightSprites[e][t-1].replaceParent(i)}}),FieldView=cc.Node.extend({ctor:function(e,t){this._super(),this.gameScene=t,this.setLocalZOrder(5),this.setAnchorPoint2(),this.innerContainer=new cc.Node,this.innerContainer.setAnchorPoint2(),this.addChild(this.innerContainer),this.addChild=function(e){this.innerContainer.addChild(e)}.bind(this),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),
onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)},this),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:this.onTouchMoved.bind(this)},this),this.onTouchBeganListener=function(e,t){},this.onTouchMovedListener=function(){},this.onTouchEndedListener=function(){},this.onGoalsShownListener=function(){},this.selection=new cc.Sprite(res.selected_cell),this.hideSelection(),this.addChild(this.selection,1);var i=new AvailableMoveView(e.availableMove);this.addChild(i),this.calculatePosition(),this.hideGoals()},overlapsWithField:function(e){return e.replaceParentSamePlace(this.gameScene.scene),cc.rectIntersectsRect(this.getBoundingBox(),e.getBoundingBox())},calculatePosition:function(e){var t=cleverapps.UI.getSceneSize(),i=cleverapps.styles.UI.FieldView.margins[cleverapps.wideMode.mode],s=t.width-(i.left+i.right),n=t.height-(i.top+i.bottom);this.setPositionRound(i.left+s/2,i.bottom+n/2)},ajustScale:function(){
var e=cleverapps.UI.getSceneSize(),t=cleverapps.styles.UI.FieldView.margins[cleverapps.wideMode.mode],i=e.width-(t.left+t.right),s=e.height-(t.top+t.bottom),n=Math.min(i/(cleverapps.styles.BaseCellView.CELL_SIZE_PX*Field.SIZE_X),s/(cleverapps.styles.BaseCellView.CELL_SIZE_PX*Field.SIZE_Y));n>FieldView.MAX_SCALE&&(n=FieldView.MAX_SCALE),this.setScale(n),this.setContentSize(Field.SIZE_X*cleverapps.styles.BaseCellView.CELL_SIZE_PX,Field.SIZE_Y*cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.innerContainer.setContentSize(this.getContentSize()),this.innerContainer.setPositionRound(this.width/2,this.height/2)},onTouchBegan:function(e){var t=this.convertTouchToNodeSpace(e);return!!cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)&&(this.onTouchBeganListener(t,this.getCellPosition(t)),!0)},getCellPosition:function(e){return{row:Field.SIZE_Y-1-Math.floor(e.y/cleverapps.styles.BaseCellView.CELL_SIZE_PX),col:Math.floor(e.x/cleverapps.styles.BaseCellView.CELL_SIZE_PX)}},
onTouchMoved:function(e){var t=this.convertTouchToNodeSpace(e);this.onTouchMovedListener(t,this.getCellPosition(t))},onTouchEnded:function(e){var t=this.convertTouchToNodeSpace(e);this.onTouchEndedListener(t,this.getCellPosition(t))},showSelection:function(e,t){this.selection.setPosition(BaseCellView.alignInTheGrid(t,e)),this.selection.setVisible(!0),cleverapps.audio.playSound(res.select_cell_effect)},hideSelection:function(){this.selection.setVisible(!1)},onShuffleAnimation:function(){cleverapps.exclamation.show("messages:message.Shuffle",FieldView.MESSAGE_NORMAL)},onGoalsDoneAnimation:function(){cleverapps.exclamation.show("messages:message.YouWin",FieldView.MESSAGE_CONGRATS)},onBigExplodeAnimation:function(){var e=cleverapps.Random.mathChoose(cleverapps.exclamation.getCongratulations());cleverapps.exclamation.show(e,FieldView.MESSAGE_CONGRATS)},fiveMovesLeftAnimation:function(){cleverapps.exclamation.show("messages:message.MovesLeft",FieldView.MESSAGE_WARNING)},
hardLevelAnimation:function(){cleverapps.exclamation.show("messages:message.hardLevel",FieldView.MESSAGE_WARNING)},letsGoAnimation:function(){cleverapps.exclamation.show("messages:message.Letsgo",FieldView.MESSAGE_NORMAL)},tutorialFinishAnimation:function(){cleverapps.exclamation.show("messages:message.KeepGoing",FieldView.MESSAGE_NORMAL)},moveAnimation:function(e,t,i){var s=i?cleverapps.styles.FieldView.animateValidMove:cleverapps.styles.FieldView.animateWrongMove;if(s){var n=BaseAnimation.factory(s);n.setLocalZOrder(100),n.runAnimate("animation"),n.setPositionRound(BaseCellView.alignInTheGrid((e.x+t.x)/2,(e.y+t.y)/2)),n.setRotation(e.y!==t.y?90:0),this.addChild(n)}},onBonusByLeftMovesAnimation:function(){this.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.rolling_pin_use_effect)})))},hideGoals:function(){cleverapps.values(Game.currentGame.goalsController.viewByType).forEach(function(e){e.visible=!1})},
onShowUpAnimationStart:function(){var p=this.getLocalZOrder();this.setLocalZOrder(11),this.addShowUpAnimation();var e=this.createAnimationGoals(),d=e.goals,t=e.viewByType,i=cleverapps.styles.FieldView,s=cleverapps.styles.FieldView.messagesScale[cleverapps.wideMode.mode]/this.getScale();cleverapps.UI.wrap(d),d.setAnchorPoint(.5,.5),d.setPositionRound(this.width/2,this.height/2-i.start.goals.y*s),d.setVisible(!1),d.setScale(.1),this.addChild(d),d.setLocalZOrder(11),d.runAction(new cc.Sequence(new cc.DelayTime(.25),new cc.CallFunc(function(){d.setVisible(!0)}),new cc.Spawn(new cc.ScaleTo(.25,1).easing(cc.easeIn(2)),new cc.MoveBy(.25,cc.p(0,i.start.goals.y*s))),new cc.ScaleTo(.1,1.1,.9),new cc.ScaleTo(.1,1))),this.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(Game.currentGame.showStartLevelMessage.bind(Game.currentGame))));var h=Object.keys(Game.currentGame.goals.elements).length;Object.keys(Game.currentGame.goals.elements).forEach(function(o,a,r){var l=t[o]
;l.icon&&l.icon.amount&&(l.icon.amount.visible=!1);var c=this.getAnimationGoalTarget(o);l.runAction(new cc.Sequence(new cc.DelayTime(1.5),new cc.CallFunc(function(){var e=l.getRelativeCoordinates(c),t=this.getGoalTargetScale(o);cleverapps.styles.InfoPanel.scales&&(t*=cleverapps.styles.InfoPanel.scales[cleverapps.wideMode.mode]);var i=t/this.scale,s=t/this.scale,n=BaseGoalView.prototype.getCollectFlyPoints.call(c,l,a,e);l.runAction(new cc.Sequence(new cc.Spawn(new cc.BezierTo(.7,n).easing(cc.easeIn(1)),new cc.ScaleTo(.7,i,s)),new cc.Sequence(new cc.ScaleTo(.1,1.15*i,.85*s),new cc.ScaleTo(.1,i,s)),new cc.CallFunc(function(){this.showGoal(o),0===a&&this.setLocalZOrder(p),0===--h&&d.removeFromParent(),a===r.length-1&&this.onGoalsShownListener(!0)}.bind(this))))}.bind(this))))}.bind(this)),this.runAction(new cc.Sequence(new cc.DelayTime(i.slideAnimation.controlsPanel.delay),new cc.CallFunc(function(){cc.director.getRunningScene().controlsPanel.show()})))},addShowUpAnimation:function(){
var e=cleverapps.styles.FieldView,t=cleverapps.styles.FieldView.messagesScale[cleverapps.wideMode.mode]/this.getScale(),i=this.startAnimation=new cleverapps.Spine(bundles.game.jsons.start_level_animation_json||bundles.dialogues.jsons.start_level_animation_json,t);i.setPositionRound(this.width/2,this.height/2+e.animation.offsetY),cc.Node.prototype.addChild.call(this,i),i.setLocalZOrder(-1),e.start.sound&&cleverapps.audio.playSound(res[e.start.sound]),i.setAnimation(0,"animation",!1),i.setCompleteListener(function(){i.runAction(new cc.RemoveSelf)})},createGoalView:function(e){var t=Game.currentGame.goals.elements[e],i=GoalsController.createView(t);return new StartGoalView(t,i)},getAnimationGoalTarget:function(e){var t=Game.currentGame.goalsController.viewByType[e];return t.visible=!1,t},showGoal:function(e){var t=Game.currentGame.goalsController.viewByType[e];t.setVisible(!0),t.animateSmile()},getGoalTargetScale:function(){return 1},createAnimationGoals:function(){if(
Game.currentGame&&Game.currentGame.goalsController&&Game.currentGame.goalsController.viewByType){var e=cleverapps.styles.FieldView,t=cleverapps.styles.FieldView.messagesScale[cleverapps.wideMode.mode]/this.getScale()+e.baseScale,i=new cc.Node,s={},n=[];for(var o in Game.currentGame.goals.elements){var a=this.createGoalView(o),r=Array.isArray(e.start.goals.scale)?e.start.goals.scale[cleverapps.wideMode.mode]:e.start.goals.scale;a.scale=r*t,Game.currentGame.gameMission&&(a.scale*=Math.abs(cleverapps.styles.Goals.singleItem.scaleY)/Math.abs(cleverapps.styles.Goals.singleItem.withTournament.scaleY)),s[o]=a,n.push(a),a.goalType=o;var l=Game.currentGame.goalsController.viewByType[o];a.setAnchorPoint(l.getAnchorPoint().x,l.getAnchorPoint().y)}n=n.sort(function(e,t){return e=Game.currentGame.goalsController.viewByType[e.goalType],t=Game.currentGame.goalsController.viewByType[t.goalType],e.x!==t.x?e.x-t.x:e.y-t.y});var c=e.start.width;n.forEach(function(e){i.addChild(e),c-=e.width})
;var p=Object.keys(s).length+1,d=(c/p+e.offset)*t;return cleverapps.UI.arrangeWithMargins(i.children,{direction:cleverapps.UI.HORIZONTAL,margin:d}),{goals:i,viewByType:s,views:n}}},hide:function(){this.runAction(new cc.Sequence(new cc.ScaleTo(.3,0).easing(cc.easeBackIn()),new cc.CallFunc(function(){this.setVisible(!1)}.bind(this))))}});FieldView.MAX_SCALE=2,FieldView.MESSAGE_NORMAL=100,FieldView.MESSAGE_WARNING=101,FieldView.MESSAGE_CONGRATS=102,cleverapps.styles.FieldView={animateWrongMove:res.wrong_move_json,animateValidMove:res.cells_swap_json,offset:-20,baseScale:.25,start:{width:520,sound:!1,animation:{position:{dy:195,dx:0}},goals:{scale:1,y:200}},messagesScale:[.8,1,1],animation:{offsetY:-20},slideAnimation:{controlsPanel:{delay:3}}};var TapToSkipButton=cc.Node.extend({ctor:function(){this._super();var e=this.styles=cleverapps.styles.TapToSkipButton,t=this.text=cleverapps.UI.generateTTFText("messages:TapToSkip",e.text.font),i=this.button=new cleverapps.UI.Button({
button_png:res.blue_button_png,button_on_png:res.blue_button_on_png,width:t.width+2*e.text.margin.x,height:t.height+2*e.text.margin.y,content:t,onClicked:this.onClick.bind(this)});this.setContentSize2(i.width,i.height),this.setAnchorPoint2(),this.addChild(i),i.setPositionRound(this.width/2,this.height/2)},onClick:function(){Game.currentGame&&Game.currentGame.skipWinAnimation(),this.hide()},onEnterTransitionDidFinish:function(){this._super(),this.show()},show:function(){this.setPositionRound(cleverapps.styles.TapToSkipButton),this.setLocalZOrder(30),this.scale=0,this.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.ScaleTo(.5,1).easing(cc.easeBackOut()),new cc.CallFunc(function(){this.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.3,1.01),new cc.ScaleTo(.3,1))))}.bind(this))))},hide:function(){if(!this.hideRunning){var e=cc.director.getRunningScene()&&cc.director.getRunningScene().fieldView;e&&this.replaceParentSamePlace(e),this.hideRunning=!0,this.stopAllActions(),
this.runAction(new cc.Sequence(new cc.ScaleTo(.5,0),new cc.CallFunc(function(){this.setVisible(!1)}.bind(this))))}}});cleverapps.styles.TapToSkipButton={x:{align:"center"},y:{align:"bottom",dy:40},text:{font:cleverapps.styles.FONTS.NOTIFICATION_TEXT,x:{align:"center"},y:{align:"top",dy:-20},margin:{x:40,y:30}}};var ScoreView=cc.Node.extend({ctor:function(e,t){this._super();var i=this.inEditor;this.score=e,this.setAnchorPoint(.5,.5);var s=cleverapps.UI.createScale9Sprite(res.score_bar_bg),n=cleverapps.styles.UI.ScoreView.modes[i?cleverapps.WideMode.SQUARE:cleverapps.wideMode.mode],o=cleverapps.styles.UI.ScoreView.stars;this.setContentSize(n.width,s.height),n.x=n.x||0;var a=new cc.Node;n.rotation&&(a.setRotation(n.rotation),this.setRotation(n.rotation)),a.setLocalZOrder(15),a.setScale(this.getScale()),a.setAnchorPoint(this.getAnchorPoint()),a.setPositionRound(o.animation.position[i?cleverapps.WideMode.SQUARE:cleverapps.wideMode.mode]),a.setContentSize(this.getContentSize()),
t&&t.addChild(a),s.setContentSize(this.getContentSize()),s.setPosition(this.width/2,this.height/2+cleverapps.styles.UI.ScoreView.bar.offsetY),this.drawPercent=0,this.needPercent=0,this.bar=new ScaledProgressBar(res.score_bar),this.bar.setDimension(this.width,this.height),this.bar.setMinWidth(cleverapps.styles.UI.ScoreView.bar.minWidth),this.bar.setPosition(0,cleverapps.styles.UI.ScoreView.bar.offsetY),this.addChild(s),this.addChild(this.bar),this.stars=[],this.stars.push(new StarView(res.game_stars_1star0,res.game_stars_1star1,i)),this.stars.push(new StarView(res.game_stars_2star0,res.game_stars_2star1,i)),this.stars.push(new StarView(res.game_stars_3star0,res.game_stars_3star1,i));var r=o;r.starsDelta&&(r=r.starsDelta[i?cleverapps.WideMode.SQUARE:cleverapps.wideMode.mode]);for(var l=0;l<3;l++){var c=Score.COEFS[l]*this.width;this.stars[l].setPosition(c,this.height/2+r.dy),n.rotation&&this.stars[l].setRotation(-n.rotation),this.stars[l].setLocalZOrder(2),this.addChild(this.stars[l]),
this.stars[l].starAnimation&&(this.stars[l].starAnimation.setPosition(c,this.height/2+r.dy),a.addChild(this.stars[l].starAnimation))}if(e.onChangePercentListener=this.createListener(this.changePercent.bind(this)),e.onAddStarListener=this.createListener(this.addStar.bind(this)),this.bar.schedule(this.drawPercentInterval.bind(this)),cleverapps.styles.UI.ScoreView.backBackground){var p=cleverapps.UI.createSprite(cleverapps.styles.UI.ScoreView.backBackground);p.setLocalZOrder(-1),this.addChild(p),n.scaleX&&p.setScaleX(n.scaleX),p.setPositionRound(cleverapps.styles.UI.ScoreView.backBackground)}!cleverapps.config.debugMode||cleverapps.config.editorMode||cleverapps.screenshotsMode||(this.percent=cleverapps.UI.generateTTFText(0,cleverapps.styles.FONTS.MOVES_TEXT),this.percent.setPosition(cleverapps.styles.UI.ScoreView.percent),this.percent.setScale(cleverapps.styles.UI.ScoreView.percent.scale),this.addChild(this.percent)),this.setPositionRound(n.x,n.y)},drawPercentInterval:function(){if(
this.drawPercent!==this.needPercent){var e=(this.needPercent-this.drawPercent)/20;if(e>ScoreView.MIN_STEP?this.drawPercent+=Math.min(e,ScoreView.MAX_STEP):this.drawPercent=this.needPercent,this.bar.setPercentage(this.drawPercent),0<this.drawPercent&&this.scoreLineEndAnimation)if(this.drawPercent<100){var t=cleverapps.styles.UI.ScoreView.lineEndAnimation;this.scoreLineEndAnimation.setVisible(!0),this.scoreLineEndAnimation.setPositionRound(this.bar.width+t.dx,this.bar.y+this.bar.height/2+t.dy)}else this.scoreLineEndAnimation.setVisible(!1)}},changePercent:function(e){100<e&&(e=100),this.needPercent=e,cleverapps.config.debugMode&&!cleverapps.config.editorMode&&this.percent&&this.percent.setString(Math.round(100*this.score.points/this.score.baseRequired))},addStar:function(e){this.stars[e-1].on(),cleverapps.audio.playSound(res.score_star_effect)}}),StarView=cc.Node.extend({ctor:function(e,t,i){this._super(),this.sprite=new cc.Sprite(e),this.onFilename=t
;var s=cleverapps.styles.UI.ScoreView.bar.offsetY,n=cleverapps.wideMode.mode!==cleverapps.WideMode.HORIZONTAL||i?0:s,o=cleverapps.wideMode.mode!==cleverapps.WideMode.HORIZONTAL||i?s:0;this.sprite.setPosition(this.width/2-n,this.height/2+o),this.addChild(this.sprite),cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&bundles.game.jsons.stars_json&&(this.starAnimation=new cleverapps.Spine(bundles.game.jsons.stars_json,1),this.starAnimation.visible=!1,cleverapps.styles.UI.ScoreView.modes[i?cleverapps.WideMode.SQUARE:cleverapps.wideMode.mode].rotation&&this.starAnimation.setRotation(-cleverapps.styles.UI.ScoreView.modes[i?cleverapps.WideMode.SQUARE:cleverapps.wideMode.mode].rotation))},on:function(){if(this.starAnimation){this.starAnimation.setAnimation(0,"animation",!1),cleverapps.styles.UI.ScoreView.stars.animation.hideSprite&&this.starAnimation.setStartVisibleListener(function(){this.sprite.visible=!1}.bind(this));var e=this.createListener(function(){this.sprite.setVisible(
!0),this.sprite.setSpriteFrame(this.onFilename)});this.starAnimation.setCompleteListener(function(){this.starAnimation.runAction(new cc.RemoveSelf),e()}.bind(this))}else this.sprite.setSpriteFrame(this.onFilename),this.sprite.runAction(new cc.Sequence(new cc.ScaleTo(.15,2),new cc.RotateTo(.1,15),new cc.RotateTo(.1,-30),new cc.RotateTo(.1,15),new cc.CallFunc(function(){this.sprite.setRotation(0)}.bind(this)),new cc.ScaleTo(.15,1)))}});ScoreView.MIN_STEP=.001,ScoreView.MAX_STEP=.5,cleverapps.styles.UI.ScoreView={backBackground:{scale9:cleverapps.UI.Scale9Rect.Default,sizes:[{width:510,height:46},{width:510,height:46},{width:450,height:46}],x:{align:"center",dx:8},y:{align:"center"},image:"score_bar_back_bg"},modes:[{x:{align:"center",dx:75},y:{align:"bottom",dy:12},width:440},{x:{align:"center",dx:75},y:{align:"bottom",dy:12},width:440},{x:{align:"center",dx:75},y:{align:"center",dy:-104},width:400,rotation:-90,scaleX:-1}],bar:{minWidth:15,offsetY:3},percent:{x:650,y:12,scale:.7},stars:{
dy:0,animation:{delay:1,position:[{x:{align:"center",dx:74},y:{align:"top",dy:-172}},{x:{align:"center",dx:74},y:{align:"top",dy:-172}},{x:{align:"left",dx:-20},y:{align:"center",dy:-104}}]}}};var FieldScoreView=cc.Node.extend({ctor:function(){this._super(),this.text=new cleverapps.UI.ImageFont("white_digit_","+"),this.text.setScale(1.2),this.addChild(this.text),this.setLocalZOrder(-1e6),this.setCascadeOpacityEnabled(!0)},onEnterTransitionDidFinish:function(){this._super(),this.text.setString("+"+this.score),cleverapps.styles.COLORS.CELL_COLORS[this.cellColor]&&this.text.setColor(cleverapps.styles.COLORS.CELL_COLORS[this.cellColor]),this.setPosition(BaseCellView.alignInTheGrid(this.targetPosition.x,this.targetPosition.y)),this.setOpacity(255),this.runAction(new cc.Sequence(new cc.DelayTime(.8),new cc.Spawn(new cc.MoveBy(1,cleverapps.styles.FieldScoreView.animation.moveBy),new cc.FadeOut(1)),new cc.CallFunc(function(){cc.pool.putInPool(this)}.bind(this))))},reuse:function(e,t,i,s){
this.score=e,this.cellColor=t,this.targetPosition=cc.p(i,s)},unuse:function(){this.removeFromParent()}});FieldScoreView.factory=function(e,t,i,s){return cc.pool.hasObject(FieldScoreView)?cc.pool.getFromPool(FieldScoreView,e,t,i,s):void 0},FieldScoreView.fillPool=function(){for(var e=0;e<3;e++)cc.pool.putInPool(new FieldScoreView)},cleverapps.styles.FieldScoreView={animation:{moveBy:{x:0,y:50}}};var AvailableMoveView=cc.Node.extend({ctor:function(e){this._super(),this.availableMove=e,AVAILABLE_MOVE_ANIMATIONS[cleverapps.styles.AvailableMoveView.animationName]||(this.move=new cleverapps.Spine(res.available_move_json,1),this.move.setAnimation(0,"animation",!0),this.move=cleverapps.UI.wrapWithPadding(this.move),this.addChild(this.move),this.move.visible=!1,this.setLocalZOrder(10)),e.onChangeVisibleListener=this.createListener(function(e){this.setVisible(e)}.bind(this)),e.onChangeMoveListener=this.createListener(this.setMove.bind(this))},setMove:function(e){this.move&&(this.setPosition(
BaseCellView.alignInTheGrid(e.start.x,e.start.y)),this.x+=e.dir.col*cleverapps.styles.BaseCellView.CELL_SIZE_PX/2,this.y-=e.dir.row*cleverapps.styles.BaseCellView.CELL_SIZE_PX/2,this.setRotation(0!==e.dir.row?90:0))},setVisible:function(e){if(e&&cleverapps.audio.playSound(res.available_move_effect),this.move)this.move.visible=e;else{if(!Game.currentGame||!Game.currentGame.field||!Game.currentGame.field.cells)return;var t=this.availableMove.move;if(cleverapps.styles.AvailableMoveView.animateShape){var i=[];if(t.shape)i=t.shape.cells;else{var s=t.start,n=Game.currentGame.field.cells[s.y+t.dir.row][s.x+t.dir.col];if(!s||!n)return;i.push(s),i.push(n)}e?i.forEach(function(e){(e.innerCell||e).onAvailableMoveListener(null,t)}):i.forEach(function(e){(e.innerCell||e).onBeforeMoveListener({x:e.x,y:e.y},{moveInterval:.1,easing:cc.easeOut(1)})})}else{s=t.start,n=Game.currentGame.field.cells[s.y+t.dir.row][s.x+t.dir.col];if(!s||!n)return;e?(s.onAvailableMoveListener(t.dir,t),
n.onAvailableMoveListener({col:-1*t.dir.col,row:-1*t.dir.row},t)):(s.onBeforeMoveListener({x:s.x,y:s.y},{moveInterval:.1,easing:cc.easeOut(1)}),n.onBeforeMoveListener({x:n.x,y:n.y},{moveInterval:.1,easing:cc.easeOut(1)}))}}}});cleverapps.styles.AvailableMoveView={};var MovesView=cc.Node.extend({create:function(){var e=cleverapps.styles.UI.MovesView;if(0<this.game.moves){if(this.addMovesBar(),this.addBackground(),this.text=cleverapps.UI.generateTTFText(this.game.moves,cleverapps.styles.FONTS.MOVES_TEXT),this.text.setPositionRound(e.text.margin.x,e.text.margin.y),this.addChild(this.text),e.icon){var t=bundles.game.frames.game_moves_icon;bundles.game.frames.game_moves_en_icon&&"en"===cleverapps.settings.language&&(t=bundles.game.frames.game_moves_en_icon);var i=new cc.Sprite(t);this.addChild(i),i.setPositionRound(e.icon.x,e.icon.y)}}else if(e.locked.image){var s=this.addBackground(),n=new cc.Sprite(e.locked.image);s.addChild(n),n.setPositionRound(e.locked.x,e.locked.y),
bundles.game.frames.moves_jar_content_bg&&(s.opacity=0)}},getTarget:function(){return this.text},ctor:function(e){this._super(),this.updateMovesTimeout=new cc.Node,this.addChild(this.updateMovesTimeout),this.maxMoves=e.moves,this.game=e;var t=cleverapps.styles.UI.MovesView;this.setAnchorPoint(.5,.5),t.scale&&this.setScale(t.scale[cleverapps.wideMode.mode]),this.create(),this.setPositionRound(t.position),cleverapps.styles.UI.MovesView_target=this.getTarget(),e.onChangeMovesListener=this.updateMoves.bind(this),e.onAnimatedChangeMovesListener=this.changeMovesAnimation.bind(this),e.onChangeMovesStateListener=this.setStyle.bind(this),this.setLocalZOrder(1),this.setCascadeOpacityEnabled(!0)},addBackground:function(){var e,t=cleverapps.styles.UI.MovesView.background;return t.animation?((e=new cleverapps.Spine(t.animation.json,1)).isAnimation=!0,e.setAnimation(0,"normal",!0)):e=cleverapps.UI.createSprite(t),this.addChild(e),e.setPositionRound(t.x,t.y),
0<this.game.moves&&cleverapps.tooltipManager.create(e,{text:Messages.get("MovesTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.below}),this.background=e},addMovesBar:function(){if(bundles.game.frames.moves_jar_content_bg){var e=cleverapps.styles.UI.MovesView.content,t=new ScaledProgressBar(bundles.game.frames.moves_jar_content_bg);t.setDimension(e.width,e.height),t.setLayout(ScaledProgressBar.VERTICAL),t.setMinHeight(cleverapps.styles.UI.MovesView.content.minHeight),t.setPercentage(100),this.bar=t,this.addChild(t),t.setAnchorPoint2(),t.setPositionRound(e.x,e.y),t.setCascadeOpacityEnabled(!0)}},setStyle:function(e){switch(e){case Match3.MOVES_STATE_DANGER:this.setState(Match3.MOVES_STATE_DANGER);break;case Match3.MOVES_STATE_NORMAL:this.setState(Match3.MOVES_STATE_NORMAL)}},setState:function(e){if(this.text){if(this.background.isAnimation){var t=e===Match3.MOVES_STATE_DANGER?"danger":"normal";this.background.setAnimation(0,t,!0)}
e===Match3.MOVES_STATE_DANGER?this.text.runAction(new cc.Sequence(new cc.TintTo(MovesView.HUMAN_DELAY,cleverapps.styles.COLORS.MOVES_DANGER.r,cleverapps.styles.COLORS.MOVES_DANGER.g,cleverapps.styles.COLORS.MOVES_DANGER.b),new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.5,1.1,1.1).easing(cc.easeBackInOut()),new cc.ScaleTo(.5,1,1))))):this.text.setColor(cleverapps.styles.COLORS.WHITE)}},runTextAnimation:function(e,t){this.text&&this.runAction(new cc.Sequence(new cc.DelayTime(MovesView.HUMAN_DELAY),new cc.CallFunc(function(){cleverapps.UI.animateDelta(t,{font:0<t?cleverapps.styles.FONTS.INC_MOVES_TEXT:cleverapps.styles.FONTS.DEC_MOVES_TEXT,parent:this,x:this.text.x,y:this.text.y,dy:cleverapps.styles.UI.MovesView.changeAnimation.delta,duration:cleverapps.styles.UI.MovesView.changeAnimation.duration,zOrder:10}).replaceParentSamePlace(this.getParent()),this.text.setString(e),this.text.setAnchorPoint2(),0<t&&this.text.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.4),new cc.ScaleTo(.1,1)
))}.bind(this))))},updateMoves:function(e,t,i){var s=(i=i||{}).delay||0;this.movesDiff=(this.movesDiff||0)+t,e>this.maxMoves&&(this.maxMoves=e),this.updateMovesTimeout.stopAllActions(),this.updateMovesTimeout.runAction(new cc.Sequence(new cc.DelayTime(s/1e3),new cc.CallFunc(function(){0!==this.movesDiff&&(this.bar&&this.bar.animatedChange(100*e/this.maxMoves-this.bar.percentage),this.runTextAnimation(e,this.movesDiff)),delete this.movesDiff}.bind(this))))},changeMovesAnimation:function(e,t,i){var s=new cc.Node;s.setAnchorPoint2();var n=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.MOVES_TEXT),o=new cc.Sprite(res.moves_icon);s.addChild(n),s.addChild(o),cleverapps.UI.arrangeWithMargins(s.children,{margin:0,direction:cleverapps.UI.HORIZONTAL}),cleverapps.UI.wrap(s);var a=cc.director.getRunningScene(),r=a.fieldView;if(a.isRunningSafe()&&r&&r.isRunningSafe()){var l=r.getContentSize();s.setPosition(l.width/2,l.height/2),r.addChild(s),s.visible=!t.boosterBefore,setTimeout(function(
){var e={scale:1,target:this.getTarget()};t.boosterBefore?(e.scale=0,s.visible=!0,BoostersBeforeHelper.animateAppear(s,e,i)):WindowHelper.animateCollect(s,e,i)}.bind(this),MovesView.ANIMATE_COLLECT_DELAY)}},hideAnimation:function(){this.runAction(new cc.Sequence(new cc.FadeOut(.3),new cc.CallFunc(function(){this.setVisibleAsync(!1)}.bind(this))))}});MovesView.HUMAN_DELAY=.4,MovesView.ANIMATE_COLLECT_DELAY=0,cleverapps.styles.UI.MovesView={changeAnimation:{delta:60,duration:.7},position:[{x:{align:"left",dx:85},y:{align:"center",dy:0}},{x:{align:"left",dx:85},y:{align:"center",dy:0}},{x:{align:"center",dx:-15},y:{align:"center",dy:230}}],text:{margin:{x:0,y:-5}},content:{width:120,height:114,x:-60,y:-60,minHeight:10},scale:[.8,1,1],margin:[{x:{align:"center",dx:-238},y:-100},{x:{align:"center",dx:-238},y:-100},{x:{align:"center",dx:-238},y:-100}],background:{image:bundles.game.frames.moves_jar_bg,x:0,y:0},locked:{x:{align:"center"},y:{align:"center"},image:res.locked_png}}
;var BombByLeftMovesView=cc.Node.extend({ctor:function(e){this._super(),this.setLocalZOrder(20),this.setCascadeOpacityEnabled(!0),this.addImage(),this.initialize(e)}});BombByLeftMovesView.prototype.addImage=function(){var e=new cc.Sprite(bundles.game.frames.bomb_png);this.addChild(e),this.image=e},BombByLeftMovesView.prototype.initialize=function(e){this.setVisible(!0),this.bomb=e,this.image&&(this.image.visible=!0,this.image.opacity=255),this.setScale(0),this.opacity=255,this.bomb.onExplodeListener=this.onExplode.bind(this),this.bomb.onAnimateListener=this.animate.bind(this),this.animation=BombByLeftMovesAnimation.factory(),this.animation&&this.addChild(this.animation)},BombByLeftMovesView.prototype.animate=function(){var e=cc.director.getRunningScene().movesView,t=Game.currentGame.fieldController.fieldView,i=this.getRelativeCoordinates(e),s=BaseCellView.alignInTheGrid(this.bomb.x,this.bomb.y);s=this.parent.convertToNodeSpace(t.convertToWorldSpace(s));var n=cc.p((i.x+2*s.x)/3,
i.y+cleverapps.styles.BombByLeftMovesView.bezier.y),o=cc.p((i.x+n.x)/2,(i.y+n.y)/2);this.setPosition(i),this.setScale(.4),this.setOpacity(0),this.runAction(new cc.Sequence(new cc.Spawn(new cc.FadeIn(.2),new cc.BezierTo(.7,[o,n,s]).easing(cc.easeIn(1)),new cc.ScaleTo(.7,.8).easing(cc.easeIn(1)),new cc.RotateBy(.7,cleverapps.Random.nextDouble()<.5?360:-360)),new cc.ScaleTo(.2,1.2),new cc.Sequence(new cc.CallFunc(function(){this.animation?(this.scale=1,this.image.visible=!1,this.animation.animate()):this.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.2,1.5),new cc.FadeOut(.2)))),cleverapps.audio.playSound(bundles.game.urls.bomb_by_left_moves_explosion_effect,{throttle:200})}.bind(this)))))},BombByLeftMovesView.prototype.onExplode=function(){this.stopAllActions(),cc.pool.putInPool(this)},BombByLeftMovesView.prototype.reuse=function(e){this.initialize(e)},BombByLeftMovesView.prototype.unuse=function(){this.visible=!1,this.bomb.onExplodeListener=function(){},
this.bomb.onAnimateListener=function(){},delete this.bomb,this.animation&&cc.pool.putInPool(this.animation)},BombByLeftMovesView.factory=function(e){return cc.pool.hasObject(BombByLeftMovesView)?cc.pool.getFromPool(BombByLeftMovesView,e):new BombByLeftMovesView(e)},cleverapps.styles.BombByLeftMovesView={bezier:{y:300},parentScene:!0};var BombByLeftMovesAnimation=cc.Node.extend({ctor:function(){this._super();var e=new cleverapps.Spine(res.bomb_animation_json,1);this.addChild(e),this.animation=e,this.setCascadeOpacityEnabled(!0)},animate:function(){this.animation.setAnimation(0,"animation",!1)},unuse:function(){this.animation.visible=!1,this.removeFromParent(!1)}});BombByLeftMovesAnimation.fillPool=function(){for(var e=0;e<BombByLeftMovesAnimation.POOL_SIZE;e++)cc.pool.putInPool(new BombByLeftMovesAnimation)},BombByLeftMovesAnimation.factory=function(){return cc.pool.hasObject(BombByLeftMovesAnimation)?cc.pool.getFromPool(BombByLeftMovesAnimation):void 0},
BombByLeftMovesAnimation.POOL_SIZE=5;var StartGoalView=cc.Node.extend({ctor:function(e,t){this._super(),this.addChild(t),this.setContentSize(t.getContentSize()),this.setAnchorPoint(.5,.5),(this.icon=t).setPositionRound(this.width/2,this.height/2)}}),HardLevelIcon=cc.Node.extend({ctor:function(e){this._super();var t=cleverapps.styles.HardLevelIcon,i=cleverapps.wideMode.mode;if(t.alignment[i]){this.setAnchorPoint2();var s=this.image=new cc.Sprite(res[t.image]);this.addChild(s),s.setScale(t.scale[i]),s.setRotation(t.rotation),this.setContentSize2(s.getContentSize()),s.setPositionRound(this.width/2,this.height/2),this.setPositionRound(t.alignment[i]),e.addChild(this),this.runAnimation()}},runAnimation:function(){var e=this.image.scale,t=this.image.rotation;this.image.setScale(.1*e),this.image.setVisible(!1),this.image.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(function(){this.image.setVisible(!0)}.bind(this)),new cc.ScaleTo(.5,1.1*e).easing(cc.easeBackOut()),
new cc.CallFunc(function(){this.image.runAction(new cc.RepeatForever(new cc.Sequence(new cc.DelayTime(6),new cc.RotateTo(.15,t+15).easing(cc.easeIn(1)),new cc.RotateTo(.15,t-15).easing(cc.easeIn(1)),new cc.RotateTo(.15,t+10).easing(cc.easeIn(1)),new cc.RotateTo(.15,t).easing(cc.easeIn(1)))))}.bind(this))))},hide:function(){this.setVisible(!1)}});cleverapps.styles.HardLevelIcon={image:"hard_level_1",scale:[.4,.7,.7],rotation:-10,alignment:[{x:{align:"center",dx:-285},y:{align:"top",dy:-87}},{x:{align:"center",dx:400},y:{align:"top",dy:-7}},{x:{align:"center",dx:400},y:{align:"top",dy:-7}}],enabled:!1,parentSceneScene:!0};var BaseGoalView=cc.Node.extend({getStyles:function(){var e=cleverapps.styles.Goals.singleItem;return Game.currentGame&&Game.currentGame.moves<=0&&e.no_moves&&0<Game.currentGame.levelContent.moves?e.no_moves:Game.currentGame.gameMission?e.withTournament:e},getTarget:function(){return this.icon},ctor:function(e,t){this._super(),this.goal=e,this.icon=t,
this.icon.setLocalZOrder(0);var i=this.getStyles();this.setContentSize(i.width,i.height),this.setAnchorPoint2(),this.baseScaleX=i.scaleX,this.baseScaleY=i.scaleY,this.icon.setScale(this.baseScaleX,this.baseScaleY),this.icon.setPositionRound(this.width/2+i.icon.x,this.height-cleverapps.styles.BaseCellView.CELL_SIZE_PX*this.icon.scaleY/2+i.icon.y),this.addChild(this.icon),this.amount=cleverapps.UI.generateTTFText("",cleverapps.styles.FONTS.GOAL_TEXT),this.amount.setScale(i.amount.scale||1),this.amount.setPositionRound(this.width/2+i.amount.x,i.amount.y),this.addChild(this.amount),this.update(e.amount);var s=new cc.Sprite(res.goal_done_sign);s.setPositionRound(this.amount.getPosition()),s.setVisible(!1),this.checkMark=s,this.addChild(s),this.amount.setLocalZOrder(1)},bindGoal:function(){this.goal.onChangedListener=this.update.bind(this),this.goal.onCompletedListener=this.setCompleted.bind(this),this.goal.onIncompletedListener=this.setIncompleted.bind(this)},update:function(e){if(
cleverapps.config.editorMode){if(void 0===e||void 0===this.goal.target)return;this.amount&&this.amount.setString(e+"/"+this.goal.target)}else this.amount&&0<=this.goal.target-e&&this.amount.setString(this.goal.target-e)},setCompleted:function(){if(this.amount.setVisible(!1),this.checkMark.setVisible(!0),cleverapps.config.editorMode){this.amount.setVisible(!0);var e=cleverapps.styles.BaseGoalView.editorModeCheckOffset;this.checkMark.setPosition(this.checkMark.x+e.x,this.checkMark.y+e.y)}cleverapps.audio.playSound(bundles.game.urls.goal_completed_effect)},setIncompleted:function(){this.amount.setVisible(!0),this.checkMark.setVisible(!1)},setFailed:function(){if(res.failed_goal_png){var e=new cc.Sprite(res.failed_goal_png);e.setPositionRound(this.width*this.scale+cleverapps.styles.BaseGoalView.icon.margin.x,cleverapps.styles.BaseGoalView.icon.margin.y),this.addChild(e)}this.amount&&this.amount.setColor(cleverapps.styles.FONTS.ADDMOVES_GOAL_RED_TEXT.color)},animateScale:function(){
this.icon.stopAllActions(),this.icon.setScale(1.2*this.baseScaleX,1.2*this.baseScaleY),this.icon.runAction(new cc.ScaleTo(.2,this.baseScaleX,this.baseScaleY))},animateSmile:function(){},getCollectFlyPoints:function(e,t,i){var s,n;i=i||e.getRelativeCoordinates(this.getTarget());var o=cleverapps.styles.BaseGoalView;return cleverapps.wideMode.mode===cleverapps.WideMode.HORIZONTAL?(n=cc.p(i.x,i.y+o.fly.lowMode.second.y),s=cc.p((e.x+n.x)/2,(e.y+n.y)/2+o.fly.lowMode.first.y)):(t||(BaseGoalView.FLY_SIGN=1,e.x<i.x&&(BaseGoalView.FLY_SIGN=-1)),n=cc.p(i.x+o.fly.sign.y*BaseGoalView.FLY_SIGN,i.y+o.fly.second.y),s=cc.p((e.x+n.x)/2,(e.y+n.y)/2)),[s,n,i]},collectPrepareAction:function(e){var t=cc.p(cleverapps.styles.BaseGoalView.collect.x,cleverapps.styles.BaseGoalView.collect.y);return e.moveBy&&(t=cc.p(e.moveBy.x,e.moveBy.y)),new cc.MoveBy(Goals.UP_DURATION,t)},collectFlyAction:function(e,t,i){var s=this.targetScale(e),n=this.getCollectFlyPoints(e,i,this.getTargetPosition(e))
;return this.createCollectFlyAction(e,s,n,t)},targetScale:function(e){var t,i=cleverapps.styles.BaseGoalView;return i.targetWidth?t=i.targetWidth/e.width:(t=(this.baseScaleY||this.scale)/e.getParent().scale,e.tileSize&&(t/=e.tileSize)),t},createCollectFlyAction:function(e,t,i,s){return new cc.Spawn(new cc.BezierTo(s,i).easing(cc.easeIn(1)),new cc.Sequence(new cc.DelayTime(s/4),new cc.ScaleTo(3*s/4,t)))},getTargetPosition:function(e){},goalCollectSound:function(){cleverapps.goalCollectSound(this)},beforeCollect:function(e){var t=cc.director.getRunningScene().fieldView?cc.director.getRunningScene().fieldView.scale:1;e.replaceParentSamePlace(cc.director.getRunningScene().scene);var i=t/e.getParent().scale;e.setScale(e.scaleX*i,e.scaleY*i),e.stopAllActions(),e.setLocalZOrder(10)},collect:function(e,t,i,s,n){cleverapps.audio.playSound(bundles.game.urls.cell_collect_effect,{throttle:200}),n=n||{},this.beforeCollect(e),n.originalScaleX=e.scaleX,n.originalScaleY=e.scaleY
;var o=this.createListener(function(){this.goalCollectSound(),this.animateScale(),this.animateSmile()}.bind(this));e.runAction(new cc.Sequence(this.collectPrepareAction(n),new cc.DelayTime(t.waitDuration),this.collectFlyAction(e,t.duration-Goals.UP_DURATION-t.waitDuration,i),new cc.CallFunc(function(){o(),s()})))}});BaseGoalView.FLY_SIGN=1,cleverapps.styles.BaseGoalView={editorModeCheckOffset:{x:40,y:40},icon:{margin:{x:-15,y:15}},fly:{lowMode:{first:{y:300},second:{y:300}},sign:{y:300},second:{y:100}},collect:{x:0,y:30}};var GoalsView=cc.Node.extend({ctor:function(e,t){this._super(),this.game=e,this.goalController=t;var i=this.game.gameMission?cleverapps.styles.Goals.sizes.withMission:cleverapps.styles.Goals.sizes.noMission;this.setContentSize2(i[cleverapps.wideMode.mode]),this.setBackground(),this.setAnchorPoint2(),this.setGoals();var s=(this.game.gameMission?cleverapps.styles.Goals.positionWithMission:cleverapps.styles.Goals.positionNoMission)[cleverapps.wideMode.mode]
;Array.isArray(s)&&(s=s[e.goals.amountGoals-1]),this.setPositionRound(s),s.rotation&&this.setRotation(s.rotation)},setBgTitle:function(){var e=cleverapps.styles.Goals.bgTitle;if(e){var t=void 0;if(e.image&&cleverapps.settings.language===cc.sys.LANGUAGE_ENGLISH?t=e.image:e.image_ru&&cleverapps.settings.language===cc.sys.LANGUAGE_RUSSIAN&&(t=e.image_ru),void 0!==t){var i=new cc.Sprite(t);this.addChild(i);var s=e.position[cleverapps.wideMode.mode];s.rotation&&(i.setRotation(s.rotation),i.setScale(s.scale)),i.setPositionRound(s)}}},setBackground:function(){var e={scale9:cleverapps.UI.Scale9Rect.TwoPixelXY,image:cleverapps.styles.GoalsView.background.image,width:this.width,height:this.height};if(e.image){var t=cleverapps.UI.createSprite(e);this.addChild(t);var i=cleverapps.styles.GoalsView.background;t.setPositionRound(i.x,i.y,this.getContentSize()),cleverapps.styles.COLORS.HARD&&this.game.level.isHard()&&t.setColor(cleverapps.styles.COLORS.HARD),this.setBgTitle()}},setGoals:function(){
var e=this.views=[];this.goalController.viewByType={};var t=0;for(var i in this.game.goals.elements){var s=this.game.goals.elements[i],n=GoalsController.createView(s);n.setAnchorPoint2(),n.setLocalZOrder(cleverapps.styles.GoalsView.zOrders[t]),n.bindGoal(),this.goalController.viewByType[i]=n,this.addChild(n),e.push(n),t++}var o=this.width/e.length,a=this.height/2+cleverapps.styles.GoalsView.goals.offsetY[cleverapps.wideMode.mode],r=void 0;cleverapps.styles.GoalsView.amountGoalsScales&&cleverapps.styles.GoalsView.amountGoalsScales[cleverapps.wideMode.mode]&&cleverapps.styles.GoalsView.amountGoalsScales[cleverapps.wideMode.mode][t-1]&&(r=cleverapps.styles.GoalsView.amountGoalsScales[cleverapps.wideMode.mode][t-1]),cleverapps.styles.GoalsView.amountGoalsDelta&&cleverapps.styles.GoalsView.amountGoalsDelta[cleverapps.wideMode.mode]&&cleverapps.styles.GoalsView.amountGoalsDelta[cleverapps.wideMode.mode][t-1]&&(o+=cleverapps.styles.GoalsView.amountGoalsDelta[cleverapps.wideMode.mode][t-1].dx,
a+=cleverapps.styles.GoalsView.amountGoalsDelta[cleverapps.wideMode.mode][t-1].dy),e.forEach(function(e,t){var i=o*t+o/2;e.setPositionRound(i,a),cleverapps.wideMode.mode===cleverapps.WideMode.HORIZONTAL&&e.setRotation(90),r&&e.setScale(r),e.baseScale=e.scale,cleverapps.tooltipManager.create(e.icon||e,{text:Messages.get("GoalsTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.below})})}});cleverapps.styles.GoalsView={x:{align:"center"},y:{align:"center"},zOrders:[3,3,3],background:{x:{align:"center"},y:{align:"center"},image:res.goal_common_bg},goals:{offsetY:[-5,-5,0]}};var MarkGoalView=BaseGoalView.extend({collect:function(e,t,i){cleverapps.audio.playSound(bundles.game.urls.cell_collect_effect,{throttle:200});var s=e.getRelativeCoordinates(this.getTarget()),n=cleverapps.styles.MarkGoalView;s.y+=n.target.y,e.stopAllActions(),e.runAction(new cc.Sequence(new cc.Spawn(new cc.MoveTo(t.flyDuration,s).easing(cc.easeIn(1.7)),new cc.ScaleTo(t.flyDuration,t.targetScale)),new cc.CallFunc(
function(){this.goalCollectSound(),i()}.bind(this))))}});cleverapps.styles.MarkGoalView={target:{y:-90}};var GrassTile=function(e,t){BaseTile.call(this,e,t)};GrassTile.prototype=Object.create(BaseTile.prototype),(GrassTile.prototype.constructor=GrassTile).CODES=["G"],GrassTile.prototype.getViewClass=function(){return GrassTileView},GrassTile.prototype.hurt=function(){},GrassTile.prototype.save=function(){return GrassTile.CODES};var GrassTileView=cc.Sprite.extend(cleverapps.extend({},BaseTileView,{ctor:function(e){this._super(res.tile_grass),this.initialize(e),this.setLocalZOrder(4)}})),IceCreamMakerCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1,Game.currentGame.counter.fieldCounter.registerStage(201,IceCreamMakerCell.process)};IceCreamMakerCell.prototype=Object.create(BaseCell.prototype),(IceCreamMakerCell.prototype.constructor=IceCreamMakerCell).prototype.load=function(e){this.lives=parseInt(e[1])},IceCreamMakerCell.prototype.bundleId=function(){return"ice_cream_maker"},
IceCreamMakerCell.prototype.save=function(){return IceCreamMakerCell.CODES.concat([this.lives])},IceCreamMakerCell.prototype.getViewClass=function(){return IceCreamMakerCellView},IceCreamMakerCell.prototype.hurt=function(){this.lives<1||(this.lives--,this.onChangeLivesListener(),this.animate(BaseCell.ANIMATION_HURT))},IceCreamMakerCell.prototype.boom=function(){this.hurt()},IceCreamMakerCell.prototype.processTo=function(e){var t;IceCreamMakerCell.changed[e.y][e.x]=!0,t=Game.currentGame.goals.typeInGoals(IceCreamMakerCell.MAKE_COLOR)?new GoalColorCell(e.x,e.y,IceCreamMakerCell.MAKE_COLOR):new ColorCell(e.x,e.y,IceCreamMakerCell.MAKE_COLOR),Game.currentGame.field.addCell(t),t.animate(BaseCell.ANIMATION_CREATE_FROM_CELL,{x:this.x,y:this.y}),Game.counter.setTimeout(function(){e.delete()}.bind(this),900)},IceCreamMakerCell.prototype.process=function(){if(Game.currentGame){var e,t,i=[];for(e=0;e<Field.SIZE;e++)for(t=0;t<Field.SIZE;t++)if(
!IceCreamMakerCell.changed[e][t]&&Game.currentGame.field.cells[e][t]){var s=Game.currentGame.field.cells[e][t];s.canDelete()&&s.color!==IceCreamMakerCell.MAKE_COLOR&&i.push(s)}if(0<i.length){for(e=0;e<4&&0<i.length;e++){var n=cleverapps.Random.random(i.length);this.processTo(i[n]),i.splice(n,1)}this.animate(BaseCell.ANIMATION_OPEN),Game.counter.setTimeout(function(){this.lives=4,this.onChangeLivesListener(),this.animate(BaseCell.ANIMATION_HURT)}.bind(this),1200)}}},IceCreamMakerCell.process=function(){var e,t,i=[];for(e=0;e<Field.SIZE;e++)for(t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===IceCreamMakerCell&&0===Game.currentGame.field.cells[e][t].lives&&i.push(Game.currentGame.field.cells[e][t]);if(0<i.length){for(IceCreamMakerCell.changed=[],e=0;e<Field.SIZE;e++)for(IceCreamMakerCell.changed.push([]),t=0;t<Field.SIZE;t++)IceCreamMakerCell.changed.push(!1);for(e=0;e<i.length;e++)i[e].process()}},IceCreamMakerCell.MAKE_COLOR="e"
;var IceCreamMakerCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage(e.lives));this.image=t,this.image.setPosition(this.width/2,this.height/2),this.addChild(t),this.animation=new cleverapps.Spine(bundles.ice_cream_maker.jsons.iceCreamMaker_spine_json,1),this.animation.setPosition(this.width/2,this.height/2),this.animation.visible=!1,this.addChild(this.animation),this.initialize(e)},getImage:function(e){return bundles.ice_cream_maker.frames["iceCreamMaker_"+(4-e)]},initialize:function(e){BaseCellView.initialize.call(this,e),this.image.setVisible(!0),this.animation.setVisible(!1),e.onChangeLivesListener=this.changeLives.bind(this)},changeLives:function(){0<this.cell.lives?this.image.setSpriteFrame(this.getImage(this.cell.lives)):(this.image.setVisible(!1),this.animation.setVisible(
!0),this.animation.setAnimation(0,"idle_4",!0)),cleverapps.audio.playSound(bundles.ice_cream_maker.urls.icecream_maker_fill_effect)},unuse:function(){this.cell.onChangeLivesListener=function(){},BaseCellView.unuse.call(this)},openAnimation:function(){var e=this.getLocalZOrder();this.setLocalZOrder(2),this.animation.setAnimation(0,"open",!1),this.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.goal_completed_effect)}.bind(this)))),this.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){this.setLocalZOrder(e),this.image.setVisible(!0),this.animation.setVisible(!1)}.bind(this))))},hurtAnimation:function(){}})),DonutBoxCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1,Game.currentGame.counter.fieldCounter.registerStage(205,DonutBoxCell.process)};DonutBoxCell.prototype=Object.create(BaseCell.prototype),(DonutBoxCell.prototype.constructor=DonutBoxCell).prototype.load=function(e){
this.lives=parseInt(e[1])},DonutBoxCell.prototype.bundleId=function(){return"donut_box"},DonutBoxCell.prototype.save=function(){return DonutBoxCell.CODES.concat([this.lives])},DonutBoxCell.prototype.getViewClass=function(){return DonutBoxCellView},DonutBoxCell.prototype.hurt=function(){this.lives<1||(this.lives--,this.onChangeLivesListener(),this.animate(BaseCell.ANIMATION_HURT))},DonutBoxCell.prototype.boom=function(){this.hurt()},DonutBoxCell.prototype.processTo=function(e){var t;DonutBoxCell.changed[e.y][e.x]=!0,t=Game.currentGame.goals.typeInGoals(DonutBoxCell.MAKE_COLOR)?new GoalColorCell(e.x,e.y,DonutBoxCell.MAKE_COLOR):new ColorCell(e.x,e.y,DonutBoxCell.MAKE_COLOR),Game.currentGame.field.addCell(t),t.animate(BaseCell.ANIMATION_CREATE_FROM_CELL,{x:this.x,y:this.y,delay:.1}),Game.counter.setTimeout(function(){e.delete()}.bind(this),600)},DonutBoxCell.prototype.process=function(){var e,t,i=[];for(e=0;e<Field.SIZE;e++)for(t=0;t<Field.SIZE;t++)if(
!DonutBoxCell.changed[e][t]&&Game.currentGame.field.cells[e][t]){var s=Game.currentGame.field.cells[e][t];s.canDelete()&&s.color!==DonutBoxCell.MAKE_COLOR&&i.push(s)}if(0<i.length){for(e=0;e<4&&0<i.length;e++){var n=cleverapps.Random.random(i.length);this.processTo(i[n]),i.splice(n,1)}this.animate(BaseCell.ANIMATION_OPEN),Game.counter.setTimeout(function(){this.lives=4,this.onChangeLivesListener(),this.animate(BaseCell.ANIMATION_HURT)}.bind(this),900)}},DonutBoxCell.process=function(){var e,t,i=[];for(e=0;e<Field.SIZE;e++)for(t=0;t<Field.SIZE;t++)Game.currentGame.field.cells[e][t]&&Game.currentGame.field.cells[e][t].constructor===DonutBoxCell&&0===Game.currentGame.field.cells[e][t].lives&&i.push(Game.currentGame.field.cells[e][t]);if(0<i.length){for(DonutBoxCell.changed=[],e=0;e<Field.SIZE;e++)for(DonutBoxCell.changed.push([]),t=0;t<Field.SIZE;t++)DonutBoxCell.changed.push(!1);for(e=0;e<i.length;e++)i[e].process()}},DonutBoxCell.MAKE_COLOR="a";var DonutBoxCellView=cc.Node.extend(
cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage(e.lives));this.image=t,this.image.setPosition(this.width/2,this.height/2),this.addChild(t),this.animation=new cleverapps.Spine(bundles.donut_box.jsons.donutBox_spine_json,1),this.animation.setPosition(this.width/2,this.height/2),this.animation.setStartVisibleListener(function(){this.image.visible=!1}.bind(this)),this.addChild(this.animation),this.initialize(e)},getLivesId:function(e){return 4-e},getImage:function(e){return bundles.donut_box.frames["donutBox_"+this.getLivesId(e)]},initialize:function(e){BaseCellView.initialize.call(this,e),this.image.setVisible(!0),this.animation.setVisible(!1),e.onChangeLivesListener=this.changeLives.bind(this)},changeLives:function(){this.image.setSpriteFrame(this.getImage(this.cell.lives));var e=this.getLivesId(
this.cell.lives);0<e&&cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW?(this.animation.setCompleteListener(function(){4===e?(this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,"idle_4",!0)):(this.image.setVisible(!0),this.animation.setVisible(!1))}.bind(this)),this.animation.setAnimation(0,e-1+"_"+e,!0)):(this.image.setVisible(!0),this.animation.setVisible(!1)),cleverapps.audio.playSound(bundles.donut_box.urls.donutBox_maker_fill_effect)},unuse:function(){this.cell.onChangeLivesListener=function(){},BaseCellView.unuse.call(this)},openAnimation:function(){var e=this.getLocalZOrder();this.setLocalZOrder(2),this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,"open",!1),this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.donut_box.urls.donutBox_open_effect||bundles.game.urls.goal_completed_effect)}.bind(this)))),this.runAction(new cc.Sequence(new cc.DelayTime(
1.7),new cc.CallFunc(function(){this.setLocalZOrder(e),this.image.setVisible(!0),this.animation.setVisible(!1)}.bind(this))))},hurtAnimation:function(){}})),NutCell=function(e,t){BaseCell.call(this,e,t),this.movable=!0};NutCell.prototype=Object.create(BaseCell.prototype),(NutCell.prototype.constructor=NutCell).prototype.load=function(e){this.lives=parseInt(e[1])},NutCell.prototype.save=function(){return NutCell.CODES.concat([this.lives])},NutCell.prototype.getViewClass=function(){return NutCellView},NutCell.prototype.getGoalId=function(){return NutCell.GOAL_ID},NutCell.prototype.boom=function(){this.hurt()},NutCell.prototype.explode=function(){Game.currentGame.goals.inGoals(this)?BaseCell.prototype.explodeViaCollect.call(this):BaseCell.prototype.explode.call(this)},NutCell.prototype.smile=function(){this.alive&&this.animate(BaseCell.ANIMATION_SMILE)},NutCell.GOAL_ID="nut_cell_0";var NutCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),
this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5);var t=new cc.Sprite(this.getImage(e.lives));this.image=t,this.image.setPosition(this.width/2,this.height/2),this.addChild(t),this.initialize(e)},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeLivesListener=this.changeLives.bind(this)},getImage:function(e){return res["nut_cell_"+e]},changeLives:function(){this.image.setSpriteFrame(this.getImage(this.cell.lives))},unuse:function(){this.cell.onChangeLivesListener=function(){},BaseCellView.unuse.call(this)},smile:function(){this.smiling||(this.smiling=BaseAnimation.factoryLimited(res.nut_spine_json),this.smiling.setPosition(this.width/2,this.height/2),this.addChild(this.smiling),this.smiling.runAnimate("smile",this.finishSmile.bind(this),this.image))},finishSmile:function(){this.smiling&&(this.image.visible=!0,this.smiling.finishAnimation(),this.smiling=!1)},
animateExploding:function(e){this.setLocalZOrder(3),this.stopAllActions(),this.finishSmile();var t=NutAnimationView.animations[this.cell.lives],i=BaseAnimation.factoryLimited(res.nut_spine_json);i.setPosition(this.width/2,this.height/2),this.addChild(i),i.runAnimate(t,function(){this.delete()}.bind(this),this.image),cleverapps.audio.playSound(bundles.game.urls.nut_effect)},startExploding:function(){Game.currentGame.goals.inGoals(this.cell)?BaseCellView.startExplodingViaCollect.apply(this,arguments):this.animateExploding.apply(this,arguments)}})),MuffinCell=function(e,t){BaseCell.call(this,e,t),this.movable=!1,this.isForGoal=void 0===e,this.isForEditor=e<0};MuffinCell.prototype=Object.create(BaseCell.prototype),(MuffinCell.prototype.constructor=MuffinCell).prototype.bundleId=function(){return"muffin"},MuffinCell.prototype.load=function(e){this.lives=parseInt(e[1])},MuffinCell.prototype.save=function(){return MuffinCell.CODES.concat([this.lives])},
MuffinCell.prototype.getMaxLives=function(){return 2},MuffinCell.prototype.getViewClass=function(){return MuffinCellView},MuffinCell.prototype.getGoalId=function(){return MuffinCell.GOAL_ID},MuffinCell.prototype.boom=function(){this.hurt()},MuffinCell.prototype.explode=function(){BaseCell.prototype.explode.call(this)},MuffinCell.prototype.smile=function(){this.alive&&this.animate(BaseCell.ANIMATION_SMILE)};var MuffinCellView=cc.Node.extend(cleverapps.extend({},BaseCellView,{ctor:function(e){this._super(),this.setContentSize(cleverapps.styles.BaseCellView.CELL_SIZE_PX,cleverapps.styles.BaseCellView.CELL_SIZE_PX),this.setAnchorPoint(.5,.5),this.initialize(e),this.createAnimation()},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeLivesListener=this.changeLives.bind(this)},createAnimation:function(){this.animation||(this.animation=new cleverapps.Spine(bundles.muffin.jsons.muffin_json,1),this.addChild(this.animation),this.animation.setPosition(this.width/2,
this.height/2),this.updateAnimation())},getIdleAnimationName:function(){return"muffin_"+this.cell.lives},getTransitionAnimationName:function(){return"muffin_"+this.cell.lives+"_transition"},getSmileAnimationName:function(){return"muffin_"+this.cell.lives+"_smile"},updateAnimation:function(){0<this.cell.lives&&this.animation.setAnimation(0,this.getIdleAnimationName(),!0)},changeLives:function(e){e?this.updateAnimation():(0<this.cell.lives&&(this.animation.setAnimation(0,this.getTransitionAnimationName(),!1),this.animation.setCompleteListener(function(){this.animation.setCompleteListener(function(){}),this.updateAnimation()}.bind(this))),this.getStyles().hurtEffect&&cleverapps.audio.playSound(this.getStyles().hurtEffect))},finishSmile:function(){this.smiling&&(this.smiling=!1,this.updateAnimation())},smile:function(){this.smiling||!this.getStyles().smile||this.cell.isForGoal||this.cell.lives<1||(this.smiling=!0,this.animation.setCompleteListener(this.finishSmile.bind(this)),
this.animation.setAnimation(0,this.getSmileAnimationName(),!1))},getStyles:function(){return cleverapps.styles.MuffinCellView},unuse:function(){this.cell.onChangeLivesListener=function(){},BaseCellView.unuse.call(this)},getBoomColor:function(){return cleverapps.styles.MuffinCellView.boomColor}}));cleverapps.styles.MuffinCellView={smile:!1,hurtEffect:!1,boomColor:new cc.Color(156,51,0,255)};var MuffinGoalCell=function(e,t){MuffinCell.call(this,e,t)};MuffinGoalCell.prototype=Object.create(MuffinCell.prototype),(MuffinGoalCell.prototype.constructor=MuffinGoalCell).prototype.save=function(){return MuffinGoalCell.CODES.concat([this.lives])},MuffinGoalCell.prototype.getViewClass=function(){return MuffinGoalCellView},MuffinGoalCell.prototype.getGoalId=function(){return MuffinGoalCell.GOAL_ID},MuffinGoalCell.prototype.explode=function(){BaseCell.prototype.explodeViaCollect.call(this)},MuffinGoalCell.prototype.preCollectDuration=function(){return.3},MuffinGoalCell.GOAL_ID="muffin_goal_cell"
;var MuffinGoalCellView=MuffinCellView.extend({createAnimation:function(){this.cell.isForGoal?this.createGoalImage():this._super()},getIdleAnimationName:function(){return"muffin_goal_"+this.cell.lives},getTransitionAnimationName:function(){return"muffin_goal_"+this.cell.lives+"_transition"},getSmileAnimationName:function(){return"muffin_goal_"+this.cell.lives+"_smile"},createGoalImage:function(){this.goalImage||(this.goalImage=new cc.Sprite(bundles.muffin.frames.muffin_cherry),this.addChild(this.goalImage),this.goalImage.setPositionRound(this.width/2,this.height/2))},initialize:function(e){this._super(e),this.animation?this.updateAnimation():this.createAnimation(),this.cell.isForGoal||(this.goalImage&&this.goalImage.setVisible(!1),this.animation.setVisible(!0))},startExploding:function(e,t){this.finishSmile();var i=function(){Game.currentGame&&(this.animation.setVisible(!1),this.createGoalImage(),this.goalImage.setVisible(!0),this.startExplodingViaCollect(e,t,{scale:.8,
dy:this.getStyles().explode.dy}))}.bind(this);this.setLocalZOrder(3),this.stopAllActions(),this.runAction(new cc.Sequence(new cc.ScaleTo(.3,1.5),new cc.CallFunc(function(){this.boomAnimation(.5),i()}.bind(this))))},getStyles:function(){return this.styles||(this.styles=cleverapps.overrideStyles(cleverapps.styles.MuffinCellView,cleverapps.styles.MuffinGoalCellView,!0)),this.styles}});cleverapps.styles.MuffinGoalCellView={explode:{dy:34}};var NutAnimationView=BaseAnimation.extend({ctor:function(){this._super(res.nut_spine_json)}});NutAnimationView.animations={1:"animation_2_1",0:"animation_1_0"};var MultiColorBombCell=function(e,t){BigCell.call(this,e,t,MultiColorBombCell),this.hurtable=!0,this.isHead&&(this.colors=["a","b","c","d","e","w"],this.lives=this.colors.length)};MultiColorBombCell.prototype=Object.create(BigCell.prototype),(MultiColorBombCell.prototype.constructor=MultiColorBombCell).prototype.bundleId=function(){return"petards"},
MultiColorBombCell.prototype.getViewClass=function(){return MultiColorBombCellView},MultiColorBombCell.prototype.boom=function(e,t){this.head.hurt(void 0,t)},MultiColorBombCell.prototype.hurt=function(e,t,i){if(t||(t=this,i=!0),this.isHead){if(0<this.lives){var s=!i&&t.getColor(),n=function(e){this.lives--,this.colors[e]=null}.bind(this);Game.counter.setTimeout(function(){this.onChangeLivesListener(s,t,n),this.lives<1&&this.head.explode()}.bind(this),1e3*this.hurtDuration())}}else this.head.hurt(e,t,i)},MultiColorBombCell.prototype.isSelf=function(e,t){return e>=this.head.x&&e<=this.head.x+1&&t>=this.head.y&&t<=this.head.y+1},MultiColorBombCell.prototype.processRugOnExplode=function(){if(Game.currentGame){for(var t,e=[[[1,3],[0,3]],[[1,2],[0,2]]],i=[],s=0;s<=1;s++)for(var n=0;n<=1;n++){var o=Game.currentGame.field.floor[this.head.y+n][this.head.x+s];if(o&&o.constructor===RugTile){for(var a=0;a<2;a++)this.iterateLineOfFire(this.head.x+s,this.head.y+n,BaseCell.neighbors[e[s][n][a]],
function(e){i.push(e)},!0);t=new BaseCell(this.head.x+s,this.head.y+n)}}i.forEach(function(e){RugTile.hurtViaCombo(t,e)})}},MultiColorBombCell.prototype.onHeadExplode=function(){Game.counter.setTimeout(function(){var i=[];this.head.x,this.head.y;BaseCell.neighbors.forEach(function(e){this.iterateLineOfFire(this.head.x,this.head.y,e,function(e){this.isSelf(e.x,e.y)||i.push(e)}.bind(this))}.bind(this)),BaseCell.neighbors.forEach(function(e){this.iterateLineOfFire(this.head.x+1,this.head.y+1,e,function(e){this.isSelf(e.x,e.y)||i.push(e)}.bind(this))}.bind(this)),i.forEach(function(e,t){e.hover(!1),e.hurt({id:t,groupSize:i.length})}),this.processRugOnExplode()}.bind(this),1e3*this.explodeDuration()),Game.counter.setTimeout(function(){BaseCell.prototype.explode.call(this)}.bind(this),1e3*this.explodeDelay())},MultiColorBombCell.prototype.explodeDuration=function(){return.7},MultiColorBombCell.prototype.explodeDelay=function(){return.3},MultiColorBombCell.prototype.hurtDuration=function(){
return.2},MultiColorBombCell.prototype.getMaxLives=function(){return 6},MultiColorBombCell.prototype.editorComponents=function(){return this.isHead?[BaseCellComponent,BigCellComponent,MultiColorBombCellComponentCreator]:[BaseCellComponent]},MultiColorBombCell.prototype.load=function(e){this.isHead&&(this.colors=e.slice(1,e.length),this.lives=this.colors.length)},MultiColorBombCell.prototype.save=function(){return this.isHead?MultiColorBombCell.CODES.concat(cleverapps.values(this.colors)):MultiColorBombCell.CODES};var MultiColorBombCellView=BigCellView.extend({ctor:function(e){this._super(e);var t=cleverapps.styles.MultiColorBombCellView;if(e.isForGoal){this.setLocalZOrder(11),this.setAnchorPoint2(),this.setContentSize2(t.goal.width,t.goal.height);var i=new cc.Sprite(bundles.petards.frames.mclrbmb_a);return i.setScale(t.goal.scale),i.setPositionRound(this.width/2,this.height/2),void this.addChild(i)}e.isHead&&(this.createItems(e),this.initialize(e))},createItems:function(e){
var n=cleverapps.styles.MultiColorBombCellView;this.items&&this.items.forEach(function(e){e.view.removeFromParent(!0)}),this.items=[];var o=cleverapps.styles.MultiColorBombCellView.items[e.colors.length];e.colors.forEach(function(e,t){var i=o.scale||1,s=new cleverapps.Spine(bundles.petards.jsons.petards_json,i);s.setContentSize2(n.item.width,n.item.height),s.setSkin(this.getSkin(e)),s.setAnimation(0,"off",!0),this.addChild(s),s.setPositionRound(o.positions[t]),s.setLocalZOrder(o.positions[t].zOrder),this.items.push({view:s,color:e,activated:!1})}.bind(this))},createItem:function(e){return new cc.Sprite(bundles.petards.frames["mclrbmb_"+e])},getSkin:function(e){return{a:"blue",b:"green",c:"purple",d:"red",e:"yellow",w:"white"}[e]},getClosestItemIndex:function(r,l){var c,p=Number.MAX_SAFE_INTEGER||Number.MAX_VALUE;return this.items.forEach(function(e,t){if(!(e.activated||l&&e.color!==l)){var i=this.getParent().convertToNodeSpace(e.view.getParent().convertToWorldSpace(e.view.getPosition()
)),s=BaseCellView.alignInTheGrid(r.x,r.y),n=Math.abs(i.x-s.x),o=Math.abs(i.y-s.y),a=Math.sqrt(n*n+o*o);a<p&&(p=a,c=t)}}.bind(this)),c},initialize:function(e){BaseCellView.initialize.call(this,e),e.onChangeLivesListener=this.changeLives.bind(this),this.setPositionRound(BaseCellView.alignInTheGrid(e.x+.5,e.y+.5))},changeLives:function(e,t,i){var s=this.getClosestItemIndex(t,e);if(void 0!==s){var n=this.items[s];n.activated=!0,n.view.setAnimation(0,"on",!0),i(s),this.cell&&this.cell.lives<1&&cleverapps.audio.playSound(bundles.petards.urls.petards_explosion_effect)}},boomAnimation:function(){var e=new cleverapps.Spine(bundles.petards.jsons.petards_explosion_json,1);e.setAnimation(0,"boom",!1),e.setCompleteListener(function(){this.runAction(new cc.RemoveSelf)}.bind(this)),e.setLocalZOrder(20),this.addChild(e),e.setPositionRound(0,0);for(var t=[[[BaseCell.UP,BaseCell.LEFT],[BaseCell.LEFT,BaseCell.DOWN]],[[BaseCell.UP,BaseCell.RIGHT],[BaseCell.DOWN,BaseCell.RIGHT]]],i=0;i<=1;i++)for(
var s=0;s<=1;s++)for(var n=0;n<2;n++){var o=[];this.cell.iterateLineOfFire(this.cell.x+i,this.cell.y+s,BaseCell.DIRECTIONS[t[i][s][n]],function(e){o.push(e)},!0),SmallPetardCellView.explosionWavesAnimation.call(this,{image:"#mclrbm_wave.png",scale:.9,directions:[BaseCell.DIRECTIONS[t[i][s][n]]],fieldDX:i,fieldDY:s,cellsToFlyCount:o.length})}},startExploding:function(){this.setLocalZOrder(11),this.stopAllActions(),this.runAction(new cc.Sequence(new cc.ScaleTo(.3,1.5),new cc.CallFunc(function(){this.items.forEach(function(e){e.view.setVisible(!1)}),this.boomAnimation()}.bind(this))))},unuse:function(){this.cell.onChangeLivesListener=function(){},BaseCellView.unuse.call(this)},getStyles:function(){return cleverapps.styles.MultiColorBombCellView}});cleverapps.styles.MultiColorBombCellView={item:{width:70,height:130},items:{6:{scale:.7,positions:[{x:-28,y:28,zOrder:0},{x:28,y:28,zOrder:0},{x:45,y:-10,zOrder:1},{x:28,y:-48,zOrder:2},{x:-28,y:-48,zOrder:2},{x:-45,y:-10,zOrder:1}]},5:{
scale:.8,positions:[{x:0,y:32,zOrder:0},{x:44,y:4,zOrder:1},{x:32,y:-36,zOrder:2},{x:-32,y:-36,zOrder:2},{x:-44,y:4,zOrder:1}]},4:{scale:.8,positions:[{x:0,y:32,zOrder:0},{x:40,y:0,zOrder:1},{x:0,y:-36,zOrder:2},{x:-40,y:0,zOrder:1}]},3:{positions:[{x:-40,y:10,zOrder:1},{x:40,y:10,zOrder:1},{x:0,y:-35,zOrder:2}]},2:{scale:.9,positions:[{x:-23,y:23,zOrder:0},{x:23,y:-23,zOrder:1}]},1:{positions:[{x:0,y:0,zOrder:0}]}},hover:{y:10},goal:{scale:.7,width:120,height:120}};var FlowerAnimationView=BaseAnimation.extend({ctor:function(){this._super(res.flower_spine_json)}});FlowerAnimationView.animations={2:"animation_3_2",1:"animation_2_1",0:"animation_1_0"};var ChampionFriendView=cc.Node.extend({ctor:function(e,t){this.id=t,this._super(),this.setAnchorPoint(.5,.5);var i=cleverapps.styles.ChampionFriendView,s=new cleverapps.UI.Avatar(e);s.setScale(0===t?i.me.scale:i.others.scale),this.addChild(s),this.setContentSize(Math.floor(s.width*s.scale),Math.floor(s.height*s.scale)),s.setPosition(
this.width/2,i.Avatar.y),this.setCascadeOpacityEnabled(!0),s.setCascadeOpacityEnabled(!0)},showAnimation:function(){var e=this.id,t=2===e?1:1===e?4/3:7/3;this.scale=6,this.opacity=0,this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.Spawn(new cc.ScaleTo(.25,1),new cc.FadeIn(.25)),new cc.CallFunc(function(){0===e&&this.setLocalZOrder(0)}.bind(this))))},stopAnimation:function(){this.stopAllActions(),this.scale=1,this.opacity=255}});cleverapps.styles.ChampionFriendView={Avatar:{y:110},me:{scale:1.2},others:{scale:1}};var ChampionWindow=Window.extend({onWindowLoaded:function(e){this.level=e;var t=cleverapps.styles.ChampionWindow,i=new cc.Node;i.setAnchorPoint(.5,.5),i.setContentSize(t.width,t.height),this.content=i,this.addBackground(),this.addHighScores(),this._super({title:"messages:ChampionWindow.Title",name:"championwindow",content:i,button:{width:t.Button.width,height:t.Button.height,text:Messages.get("OK"),onPressed:this.close.bind(this)},
buttons:this.getButtons(),shareCheckBox:this.getShareOptions()}),this.content.setLocalZOrder(3)},addHighScores:function(){var e=this.level,o=this.content,a=cleverapps.styles.ChampionWindow.positions,t=e.episode.friendsResults.listTop4(e.levelNo).slice(0,3);this.views=t.map(function(e,t){var i=new ChampionFriendView(e,t),s=Math.floor(o.width/2)+a[t].x,n=Math.floor(o.height/2)+a[t].y;return i.setPosition(s,n),i.setLocalZOrder(3-t),o.addChild(i),i}.bind(this))},onShow:function(){this.views.forEach(function(e){e.showAnimation()}),this.runAction(new cc.Sequence(new cc.DelayTime(ChampionWindow.SOUND_DELAY),new cc.CallFunc(function(){this.visible&&cleverapps.audio.playSound(bundles.main.urls.champion_window_effect)}.bind(this))));var e=this.animation;e.setAnimation(0,"animation",!1),e.setCompleteListener(function(){e.setAnimation(0,"idle",!1)});var t=this.text;t.stopAllActions(),t.scale=0,t.runAction(new cc.Sequence(new cc.DelayTime(2.75),new cc.ScaleTo(.3,1)))},onHide:function(){
this.views&&this.views.forEach(function(e){e.stopAnimation()})},getButtons:function(){var e=[];if(this.level.isRegular()){var t=ShareBonusButton.create({shareBonus:cleverapps.ShareBonus.SHARES.champion,toReplace:{levelNo:this.level.getHumanReadableNumber(),score:cleverapps.userresult.getScoresForLevel(this.level.episode.episodeNo,this.level.levelNo)}});t&&e.push(t)}return e},getShareOptions:function(){return{shareId:cleverapps.ShareBonus.SHARES.champion.id,toReplace:{levelNo:this.level.getHumanReadableNumber(),score:cleverapps.userresult.getScoresForLevel(this.level.episode.episodeNo,this.level.levelNo)}}},addBackground:function(){var e=this.content,t=cleverapps.styles.ChampionWindow,i=cleverapps.UI.generateTTFText("messages:ChampionWindow.Text",cleverapps.styles.FONTS.WINDOW_TEXT,{levelNo:this.level.getHumanReadableNumber()});i.setPosition(Math.floor(e.width/2),Math.floor(i.height/2)+t.Text.Margin.y),i.setDimensions(cc.size(e.width-t.Text.Dimensions.x,t.Text.Dimensions.y)),
i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.addChild(i);var s=new cleverapps.Spine(bundles.champion_window.jsons.champion_spine_json,1);s.setPosition(Math.floor(e.width/2),Math.floor(e.height/2)+t.Animation.Margin.y),s.setLocalZOrder(1),e.addChild(s),this.text=i,this.animation=s}});ChampionWindow.prototype.listBundles=function(){return["champion_window"]},ChampionWindow.AVAILABLE={episode:0,level:5},ChampionWindow.SOUND_DELAY=.9,cleverapps.styles.ChampionWindow={positions:{0:cc.p(-6,150),1:cc.p(170,46),2:cc.p(-180,16)},width:550,height:700,Button:{width:280,height:110},Share:{Margin:{x:26}},Text:{Margin:{y:125},Dimensions:{x:-50,y:120}},ShareCheckBox:{y:40},Animation:{Margin:{y:-100}}},(VictoryWindow=VictoryWindowBase.extend({onWindowLoaded:function(e){this.oldChestStars=e.oldChestStars||0,this.oldStars=e.oldStars||0,this.starChestChange=e.starChestChange,this.game=e.game,this.score=e.score,this.stars=e.stars,this.mission=e.game?e.game.gameMission:void 0,this.level=e.level,
this.boatswain=e.boatswain,this.providedKey=!this.level.episode.isDailyCup()&&cleverapps.farm&&cleverapps.farm.providedKey||void 0;var t=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.VictoryWindow,!0),i=new cleverapps.Layout(this.listContent(),{direction:cleverapps.UI.VERTICAL,margin:t.margin}),s=cleverapps.UI.wrapWithPadding(i,{x:0,y:t.padding});this._super({name:"victorywindow",title:this.getTitle(),shareCheckBox:this.getShareOptions(),buttons:this.addButtons(),styles:t,content:s}),this.runChanges(this.listChanges()),HighScoresComponent({parent:this,level:this.level}),new HardLevelDecorationComponent({parent:this}),cleverapps.config.debugMode&&this.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER]&&0<=["riddles","heroes"].indexOf(cleverapps.config.name)&&this.addChild(new MedallionComponent({shovels:this.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER]})),cleverapps.audio.playSound(bundles.game.urls.win_effect)},getTitleText:function(){
return this.level.episode.isDailyCup()||this.level.episode.isRegular()&&cleverapps.user.isPassedAll()?"messages:LevelCompleted":"messages:VictoryWindow.clear"},getTitle:function(){if(!1===cleverapps.styles.VictoryWindow.Title)return!1;var e=cleverapps.styles.FONTS.LEVEL_WINDOW_TITLE;return this.level.isHard()&&cleverapps.styles.FONTS.HARD_LEVEL_TITLE&&(e=cleverapps.styles.FONTS.HARD_LEVEL_TITLE),{text:this.getTitleText(),font:e,toReplace:{levelNo:this.level.getHumanReadableNumber()}}},listContent:function(){var e=[];if(this.providedKey){var t=ProvidesComponent({key:this.providedKey,victory:!0});e.push(t)}else if(cleverapps.styles.ScoreComponent.enabled){var i=ScoreComponent({level:this.level,score:this.score,victory:!0});e.push(i)}var s=this.createRewardsBlock();if(s&&e.push(s),this.showStarsComponent()){var n=StarsComponent({level:this.level,stars:this.stars,victory:!0});e.push(n)}return e},showStarsComponent:function(){return cleverapps.config.results},isLongWindow:function(){
return this.existRewards},listBundles:function(e){var t=this._super(e);return cleverapps.metha.getType()===Metha.FARM&&t.push("farm_windows"),t.push("reward_icons"),t}})).EXP_PRIZE=1,VictoryWindow.HARD_LEVEL_EXP_PRIZE=3,cleverapps.styles.VictoryWindow={width:550,height:600,padding:50,Next:{width:280,height:110},OK:{width:280,height:110},Replay:{width:300,height:110},Share:{Margin:{x:20}},bgOffset:{x:0,y:10},victoryText:!1};var NativeInstallWindow=Window.extend({ctor:function(){NativeInstallWindow.alreadyShowed||(this.os=this.getOS(),void 0!==this.os&&void 0!==this.getUrl()&&this._super())},onWindowLoaded:function(){var e=cleverapps.styles.NativeInstallWindow;this._super({title:"messages:NativeInstallWindow.title",name:"nativeinstallwindow",content:this.getContent(),button:{text:Messages.get("NativeInstallWindow.button.text"),width:e.button.width,height:e.button.height,onPressed:function(){cc.sys.openURL(this.getUrl())}.bind(this)},notCloseByTouchInShadow:!0})},onEnter:function(){
this._super(),NativeInstallWindow.alreadyShowed=!0},getContent:function(){var e=cleverapps.styles.NativeInstallWindow,t=cleverapps.UI.generateTTFText("messages:NativeInstallWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT);t.setDimensions(e.width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER);var i=this.getImage();i.setAnchorPoint2(),i.setScale(1.5);var s=new cleverapps.Layout([t,i],{direction:cleverapps.UI.VERTICAL,margin:e.content.margin,padding:e.content.padding});return s.setPositionRound({align:"center"},{align:"center"}),s},getUrl:function(){if(void 0!==cleverapps.config[this.os])return cleverapps.config[this.os].url},getImage:function(){var e={android:bundles.store_links.urls.android_png,ios:bundles.store_links.urls.ios_png,amazon:bundles.store_links.urls.amazon_png};return new cc.Sprite(e[this.os])},getOS:function(){var e=cleverapps.User.calcSource();if("mobile_ok"!==e&&"web_ok"!==e){var t=cc.sys.os;if(
t===cc.sys.OS_IOS)return"ios";if(t===cc.sys.OS_ANDROID){var i=window.navigator.userAgent,s=["Kindle","Silk","KFTT","KFOT","KFJWA","KFJWI","KFSOWI","KFTHWA","KFTHWI","KFAPWA","KFAPWI","KFASWI","KFTBWI","KFMEWI","KFFOWI","KFSAWA","KFSAWI","KFARWI"];for(index=0;index<s.length;index++){if(new RegExp(s[index]).test(i))return"amazon"}return"android"}}}});NativeInstallWindow.prototype.listBundles=function(){return["store_links"]},NativeInstallWindow.alreadyShowed=!1,cleverapps.styles.NativeInstallWindow={width:500,content:{margin:20,padding:{x:0,y:40}},button:{width:350,height:100}},PagesView.prototype.customize=function(){var e=cleverapps.UI.getSceneSize();this.setPosition(this.width/2,e.height/2)},ProlongationWindow.prototype.onAddMovesAnimation=function(e){var t=cleverapps.styles.ProlongationWindow;(e=t.movesIcon?new cc.Sprite(t.movesIcon):cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.MOVES_TEXT)).setPosition(this.window.width/2,this.buttons.y),this.window.addChild(e),
e.replaceParentSamePlace(cc.director.getRunningScene()),cleverapps.styles.UI.MovesView_target&&!this.collectAnimationFinished&&(this.collectAnimationFinished=!0,setTimeout(function(){WindowHelper.animateCollect(e,{scale:1.5,targetDelta:t.targetDelta,target:cleverapps.styles.UI.MovesView_target}),cleverapps.audio.playSound(res.shop_buy_effect)}.bind(this),MovesView.ANIMATE_COLLECT_DELAY))},ProlongationWindow.prototype.update=function(e){var t=cleverapps.styles.ProlongationWindow.alert.delta;0<this.addHeight&&(this.addHeight-=t,this.bg.setContentSize(this.bg.width,this.bg.height+t),this.bg.setPosition(this.bg.x,this.bg.y+t/2),this.window.titleText.setPosition(this.window.titleText.x,this.window.titleText.y+t),this.closeButton.setPosition(this.closeButton.x,this.closeButton.y+t),this.onChangeBackground(this.window))},ProlongationWindow.prototype.createGoalsViews=function(e){var t=cleverapps.styles.ProlongationWindow,i=[];if(e&&t.goals.animation){var s=this.askIconAnimation=new cc.Node
;s.setAnchorPoint2(),s.setContentSize2(t.goals.animation.width,t.goals.animation.height);var n=new cleverapps.Spine(t.goals.animation.json,t.goals.animation.scale);n.setContentSize(t.goals.animation.width,t.goals.animation.height),n.setAnimation(0,t.goals.animation.name,!0),t.goals.animation.scaleX&&n.setScaleX(n.scaleX*t.goals.animation.scaleX),this.askIconSpine=n,s.addChild(n),n.setPositionRound(t.goals.animation.x,t.goals.animation.y),i.push(s)}this.prolongation.createGoalIcons().forEach(function(e){t.goals.scale&&e.setScale(t.goals.scale[cleverapps.wideMode.mode]),t.goals.amountGoalsScale&&e.setScale(t.goals.amountGoalsScale[cleverapps.wideMode.mode][this.prolongation.countOfGoals()-1]),i.push(e)}.bind(this));var o=this.content.width;i.forEach(function(e){o-=e.width*e.scale}.bind(this));var a=i.length+1,r=o/a,l=this.viewsLayout=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:r});return this.content.addChild(l),l.setPositionRound(this.content.width/2,t.y),i},
ProlongationWindow.prototype.giveUpAlertShow=function(){var e,t=cleverapps.styles.ProlongationWindow.alert,i=t.position[cleverapps.wideMode.mode];if(this.askIconAnimation&&"window"!==t.width){var s=this.window.convertToNodeSpace(this.askIconAnimation.parent.parent.convertToWorldSpace(this.askIconAnimation.parent.getPosition()));e=this.window.width-(s.x+this.askIconAnimation.width/2),this.askIconAnimation.setLocalZOrder(1),e*=t.widthMultiplier}else e=this.content.width*this.content.scaleX-2*t.padding.x,i=cc.p(this.viewsLayout.width/2,i.y);var n={width:Math.max(e,t.minWidth),height:t.size[cleverapps.wideMode.mode].height},o=new GiveUpAlertView(this.giveUpAlert,{size:n,position:i});this.viewsLayout.addChild(o);var a=this.window.convertToNodeSpace(o.getParent().convertToWorldSpace(o.getPosition()));this.closeButton.y-t.distToClose.height<a.y+o.height/2&&(this.addHeight=a.y+o.height/2-this.closeButton.y+t.distToClose.height),
this.askIconSpine&&t.askIconAnimation&&this.askIconSpine.setAnimation(0,t.askIconAnimation,!0)},ProlongationWindow.prototype.customize=function(){FreeMoves.available?(this.finger=new FingerView,this.finger.setLocalZOrder(30),cc.director.getRunningScene().scene.addChild(this.finger),this.hint=new Dialogue({text:"messages:outOfMovesHint"},{showUp:!0}),new DialogueView(this.hint,{autoPosition:!0,parent:this,button:{noButton:!0}}),this.hint.run()):this.goldInfo=new ShopUserGoldView(cleverapps.styles.ProlongationWindow.ShopUserGoldView)},ProlongationWindow.prototype.onPopUpAnimationFinished=function(){if(this.finger){this.finger.clearActions(),this.finger.delay(1);var e=this.finger.getRelativeCoordinates(this.coinProlongButton);this.finger.fadeIn(e),this.finger.press(),this.finger.delay(.3),this.finger.unPress(),this.finger.fadeOut(),this.finger.delay(1.3),this.finger.run({looped:!0})}},ProlongationWindow.prototype._listBundles=ProlongationWindow.prototype.listBundles,
ProlongationWindow.prototype.listBundles=function(){return ProlongationWindow.prototype._listBundles.apply(this,arguments).concat(["shop_user_gold_view"])},cleverapps.overrideStyles(cleverapps.styles.ProlongationWindow,{height:470,alert:{widthMultiplier:1.08,size:[{height:255},{height:205},{height:205}],position:[{x:440,y:300},{x:470,y:300},{x:470,y:300}],minWidth:410,padding:{x:30},delta:10,distToClose:{height:80}},ask_icon:{width:200},question:{y:110},goals:{scale:!1,animation:{json:bundles.prolongation_window.jsons.sad_jelly_spine_json,name:"animation",scale:1,x:-30,y:20,width:234,height:214}}});var AddBombMovesWindow=Window.extend({onWindowLoaded:function(e,t,i,s,n){if(!Game.currentGame)return!1;this.onCancel=s,this.onCloseCallback=n,this.price=e,this.onSuccess=i,this.priceTxt=FreeBombMoves.isAvailable()?"messages:FREE":e;var o=cleverapps.styles.AddBombMovesWindow,a=this.content=new cc.Node;a.setAnchorPoint(.5,.5),a.setContentSize(o.width,o.height);var r=o.bomb_icon.scale,
l=this.bombIconAnimation=new cleverapps.Spine(bundles.bomb.jsons.bomb_spine_json,r);l.setPosition(o.bomb_icon.x,o.bomb_icon.y),a.addChild(l),l.setSkin("skin_"+t),l.setAnimation(0,"animation",!0);var c=o.timer.text.scale,p=this.timerTxt=cleverapps.UI.generateTTFText("0",cleverapps.styles.FONTS.BOMB_TIMER_DANGER_TEXT);p.setScale(c),p.setPositionRound(o.bomb_icon.x,o.bomb_icon.y+o.timer.margin.y*r),a.addChild(p);var d=this.sadIconAnimation=new cleverapps.Spine(bundles.bomb.jsons.bomb_window_json,r);d.setPositionRound(o.bomb_icon.x,o.bomb_icon.y),a.addChild(d),d.setAnimation(0,"windowsbomb",!0);var h=cleverapps.UI.generateTTFText("messages:AddBombMovesWindow.addMoves",cleverapps.styles.FONTS.WINDOW_TEXT,{moves:AddBombMovesWindow.MOVES_TO_ADD});h.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),h.setDimensions(o.width+o.question.dimensions.margin.x,o.question.dimensions.y),h.setPositionRound(a.width/2,o.question.y),a.addChild(h),BreakView.AddBreakViews(a,[l,p,d],o.breakView.y),this._super({
title:Messages.get("AddBombMovesWindow.title"),name:"addbombmoveswindow",content:a,button:this.getButton()}),cleverapps.audio.playSound(bundles.game.urls.lose_effect)},takeMoves:function(){return!!levels.user.takeGold(this.price)&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HINT_USED,{amount:this.price}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOMB_MOVES_BOUGHT),this.onCancel=function(){},this.close(),this.onSuccess(),!0)},customize:function(){var e=cleverapps.styles.AddBombMovesWindow;if(FreeBombMoves.isAvailable()){this.window.setPositionRound(this.window.x,this.window.y+e.freeBombMoves.window.margin.y),this.window.basePosition=this.window.getPosition(),this.finger=new FingerView,this.finger.setLocalZOrder(30),this.finger.delay(1);var t=cc.director.getRunningScene().scene,i=t.convertToNodeSpace(this.button.parent.convertToWorldSpace(this.button.getPosition()));this.finger.fadeIn(i),t.addChild(this.finger),this.finger.press(),this.finger.delay(.3),this.finger.unPress(
),this.finger.fadeOut(),this.finger.delay(1.3),this.finger.run({looped:!0}),this.hint=new Dialogue({text:"messages:outOfBombMovesHint",person:cleverapps.styles.AddBombMovesWindow.freeBombMoves.person},{showUp:!0}),new DialogueView(this.hint,{autoPosition:!0,parent:this,button:{noButton:!0}}),this.hint.run()}else this.goldInfo=new ShopUserGoldView},onShow:function(){Game.currentGame&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN?(this.goldInfo&&this.goldInfo.showUp(),this.button.disabled=!0,this.button.scale=0,this.button.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.ScaleTo(.5,1).easing(cc.easeBackOut()),new cc.CallFunc(function(){this.button.disabled=!1}.bind(this))))):this.close()},onHide:function(){this.button&&(this.button.stopAllActions(),this.button.setScale(1),this.button.disabled=!1),this.goldInfo&&this.goldInfo.onHide()},getButton:function(){var e=cleverapps.styles.AddBombMovesWindow.button,t=new cc.Sprite(bundles.menubar.frames.coin_png);t.setScale(e.coin.scale)
;var i=cleverapps.UI.generateTTFText(this.priceTxt,cleverapps.styles.FONTS.BUTTON_TEXT),s=new cleverapps.Layout([t,i],{direction:cleverapps.UI.HORIZONTAL,margin:e.margin,padding:e.padding});return{content:s,width:Math.max(s.width,e.width),height:e.height,onPressed:function(){this.takeMoves()&&(this.takeMoves=function(){})}.bind(this)}},onClose:function(){this.goldInfo&&this.goldInfo.close(),this.finger&&this.finger.removeFromParent(!0),this.hint&&this.hint.close(),this.onCancel.call(this),this.onCloseCallback()}});AddBombMovesWindow.prototype.listBundles=function(){return["shop_user_gold_view"]},AddBombMovesWindow.MOVES_TO_ADD=5,cleverapps.styles.AddBombMovesWindow={width:700,height:500,bomb_icon:{x:350,y:284,scale:1.7},question:{y:90,dimensions:{margin:{x:-10},y:200}},breakView:{y:56},button:{width:300,height:100,margin:10,textWidth:240,padding:{x:20,y:0},coin:{scale:1}},timer:{margin:{y:-24},text:{scale:1.4}},freeBombMoves:{window:{margin:{y:50}},person:cleverapps.overrideStyles(
cleverapps.styles.DialogueView.persons.default,{styles:{offsetX:-15,mobileScale:.8}},!0)}},FingerView.ANCHOR_POINT=cc.p(.3,.9);MissionRulesWindow=Window.extend({onWindowLoaded:function(e){this.mission=e,this.missionName=e.getName();var t=cleverapps.styles.MissionRulesWindow;this.generateContent(),this.windowStyles=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.MissionRulesWindow,!0),this._super({title:this.getTitle(),name:"missionruleswindow",content:this.content,styles:this.windowStyles,button:{width:t.button.width,height:t.button.height,text:Messages.get("GotIt"),onPressed:this.close.bind(this)}})},getTitle:function(){return""},generateContent:function(){var e=cleverapps.styles.MissionRulesWindow,t=bundles[this.mission.bundle];this.heroAnimationNode=new cc.Node,this.heroAnimationNode.setContentSize2(e.animation.mainAnimationWidth,e.animation.mainAnimationHeight),this.heroAnimationNode.setAnchorPoint(.5,.5),this.heroAnimationNode.setLocalZOrder(1),
this.heroAnimation=new cleverapps.Spine(t.jsons.json,1),this.heroAnimation.setPosition(this.heroAnimationNode.width/2,this.heroAnimationNode.height/2),this.heroAnimationNode.addChild(this.heroAnimation);var i=["messages:Missions."+this.missionName+".AnimationMainTextInfo0","messages:Missions."+this.missionName+".AnimationMainTextInfo1"];this.autoScrollText=new AutoScrollText(i,{styles:e.autoScrollText}),this.autoScrollText.setVisible(!1);var s=new cc.Sprite(bundles.main.frames.tournamentstory_bg_triangle);this.autoScrollText.addChild(s),s.setScale(-1,-1),s.setLocalZOrder(0),s.setPositionRound(e.triangle);var n=[],o=cleverapps.UI.generateTTFText(Messages.get("board"===cleverapps.config.type?"messages:Missions.BoardGame.Rules2":"messages:Missions.Rules2",{header:Messages.get("messages:Missions."+this.mission.getName()+".Rules1")}),cleverapps.styles.FONTS.TOURNAMENTSTORY_INFO_DOWN_TEXT);o.setDimensions(e.aboveButtonInfoTextWidth,0),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),
o.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),n.push(o),n.push(this.heroAnimationNode),n.push(this.autoScrollText),this.content=new cleverapps.Layout(n,{margin:e.margin}),this.content.setLocalZOrder(5)},onShow:function(){cleverapps.audio.playSound(res.mission_rules_open_effect),this.autoScrollText.setTextByIndex(0),this.autoScrollText.reinitTimer(),this.runAction(new cc.Sequence(new cc.DelayTime(.8),new cc.CallFunc(function(){this.autoScrollText.setVisible(!0)}.bind(this)))),this.heroAnimation.setAnimation(0,"open",!1),this.heroAnimation.setCompleteListener(function(){this.heroAnimation.setAnimation(0,"start",!0)}.bind(this))},onHide:function(){this.autoScrollText&&this.autoScrollText.setVisible(!1)},listBundles:function(e){return-1!==[Mission.TYPE_COMBO,Mission.TYPE_COLLECT_MARK,Mission.TYPE_BURN_NEARBY].indexOf(e.type)?[Missions[e.type].bundle]:[]}});[Mission.TYPE_COMBO,Mission.TYPE_COLLECT_MARK,Mission.TYPE_BURN_NEARBY].forEach(function(e){cleverapps.override(Missions[e],{
startWindow:MissionRulesWindow})}),cleverapps.overrideStyles(cleverapps.styles.MissionRulesWindow,{width:650,height:800,margin:90,aboveButtonInfoTextWidth:700,animation:{mainAnimationWidth:420,mainAnimationHeight:420},autoScrollText:{width:550,height:240,font:cleverapps.styles.FONTS.TOURNAMENTSTORY_OFFERS_MAIN_TEXT,bg:{image:bundles.main.frames.tournamentstory_bg}},triangle:{x:{align:"right",dx:-100},y:{align:"bottom",dy:-40}},noBackground:!0,contentOffset:90,Title:{bg:!1},image:{y:50,scale:1.4,text:{y:20}},button:{width:250,height:100},BottomButton:{bottomPadding:-80},MagicTournament:{text1:{y:460},text2:{y:160},collectImage:{y:330,images:[{image:res.clover_png,scale:.5},{image:res.clover_png,scale:.75},{image:res.clover_png,scale:1},{image:res.clover_png,scale:.75},{image:res.clover_png,scale:.5}],margin:6}},RoseTournament:{text1:{y:460},text2:{y:160},collectImage:{y:330,images:[{image:res.rose_png,scale:.5},{image:res.rose_png,scale:.75},{image:res.rose_png,scale:1},{
image:res.rose_png,scale:.75},{image:res.rose_png,scale:.5}],margin:6}},TulpanTournament:{text1:{y:460},text2:{y:160},collectImage:{y:330,images:[{image:res.tulpan_png,scale:.5},{image:res.tulpan_png,scale:.75},{image:res.tulpan_png,scale:1},{image:res.tulpan_png,scale:.75},{image:res.tulpan_png,scale:.5}],margin:6}}});var WindowGoalView=cc.Node.extend({ctor:function(e,t){this._super(),this.addChild(t),this.setContentSize(t.getContentSize()),this.setAnchorPoint2(),t.setPositionRound(this.width/2,this.height/2);var i=cleverapps.styles.WindowGoalView;t.life&&(t.life.updateAmount(e.target-e.amount,{silent:!0}),t.life.setScale(t.life.scale*i.life.scale)),e.amount>=e.target?t.setCompleted():t.setFailed()}});cleverapps.styles.WindowGoalView={life:{scale:1}};var BoostersView=cc.Node.extend({ctor:function(e,t){this._super(),this.setAnchorPoint(.5,.5),this.setLocalZOrder(10),this.fieldParent=new cc.Node,this.fieldParent.setLocalZOrder(-1),this.addChild(this.fieldParent),this.boosters=e,
this.controlsPanel=t,e.onSetActiveListener=this.createListener(this.onSetActive.bind(this)),e.onExecuteListener=this.createListener(this.onExecute.bind(this)),cc.sys.isNative?cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(){return!0},onTouchMoved:this.onMouseMove.bind(this),onTouchEnded:function(){this.pointer&&this.pointer.setVisible(!1)}.bind(this)},this):cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:this.onMouseMove.bind(this)},this);var i=cleverapps.styles.BoostersView;(t.boosterdView=this).setContentSize2(t.getContentSize());var s=i.position[cleverapps.wideMode.mode];this.setPositionRound(s.x,s.y,t.getContentSize())},onSetActive:function(){this.boosters.active&&cleverapps.audio.playSound(bundles.game.urls.select_booster_effect),this.boosters.active&&this.pointer?(this.updatePointer(),this.updateLayout()):this.boosters.active?(this.addLayout(),this.addPointer()):this.pointer&&this.backAnimation()},
onExecute:function(e){e&&this.executeAnimation()},addLayout:function(){if(Game.currentGame&&(!Game.currentGame.tutorial||Game.currentGame.tutorial.finished)){this.layout&&(this.layout.stopAllActions(),this.layout.removeFromParent()),this.layout=new cc.Node,this.layout.setLocalZOrder(-2),this.controlsPanel.addChild(this.layout);var e=cleverapps.UI.addShadowLayer();e.setOpacity(cleverapps.styles.ShadowView.opacity),this.layout.addChild(e),this.generateInfoBlock(),[Game.currentGame.fieldController.floorView,Game.currentGame.fieldController.barriersView,Game.currentGame.fieldController.fieldView].forEach(function(e){e.realParent||(e.realParent=e.getParent(),e.realPosition=e.getPosition(),e.replaceParentSamePlace(this.fieldParent))}.bind(this)),this.layout.setOpacity(0),this.layout.setCascadeOpacityEnabled(!0),this.layout.runAction(new cc.FadeIn(.15));var t=cc.director.getRunningScene().scene.getRelativeCoordinates(this.layout);this.layout.setPosition({x:-t.x,y:-t.y})}},
generateInfoBlock:function(){this.infoBlock&&this.infoBlock.removeFromParent();var e=Game.currentGame.fieldController.fieldView,t=cleverapps.UI.getSceneSize(),i=cleverapps.styles.BoostersView,s=(i=i.infoBlock).valign[cleverapps.wideMode.mode],n=new cc.Node;n.setAnchorPoint2(),n.setCascadeOpacityEnabled(!1),n.valign=s;var o={width:e.width*e.scale,height:e.height*e.scale},a=i.sizes[cleverapps.wideMode.mode].height,r=i.sizes[cleverapps.wideMode.mode].width;n.setContentSize2("field"===r?o.width:t.width+i.sizes[cleverapps.wideMode.mode].addx,2*a);var l=cleverapps.UI.createScale9Sprite(res[i.bg]);l.setContentSize2(n.width,n.height),l.setPositionRound(n.width/2,n.height/2),n.addChild(l);var c=new cc.Node;c.setAnchorPoint2(),c.setContentSize2("field"===r?n.width:t.width,a),c.setPositionRound(n.width/2,"top"===s?c.height/2:n.height-c.height/2),n.addChild(c);var p=new cc.Sprite(cleverapps.styles.UI.BoostersTargets[this.boosters.active.id].icons.icon_active_png);p.setScale(
i.icon.scales[cleverapps.wideMode.mode].scale);var d=p.width*i.icon.scales[cleverapps.wideMode.mode].scale;p.setPositionRound(i.margin+d/2,c.height/2),c.addChild(p);var h=c.width-d-3*i.margin,u=cleverapps.UI.generateTTFText("messages:Boosters."+this.boosters.active.id+".Hint",i.font);u.setDimensions(h,0),u.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),u.setPositionRound(d+2*i.margin+u.width/2,c.height/2),u.fitTo(0,c.height),c.addChild(u);var v=cc.director.getRunningScene().scene;this.infoBlock=n,v.addChild(n);var g=e.realPosition?e.realPosition.x:e.x,m="top"===s?t.height:0;n.setPositionRound(g,m),n.hidePosition=cc.p(g,m+("top"===s?n.height/2:-n.height/2)),cleverapps.UI.makeHideable(n,cleverapps.UI.VERTICAL),n.setPosition(n.hidePosition),n.runAction(new cc.MoveBy(.3,cc.p(0,"top"===s?-n.height/2:n.height/2)).easing(cc.easeBackOut())),n.setLocalZOrder(30)},addPointer:function(){var e=new cc.Sprite;e.setVisible(!1),e.setLocalZOrder(100),cc.director.getRunningScene().scene.addChild(e),
this.pointer=e,this.updatePointer()},updateLayout:function(){this.generateInfoBlock()},updatePointer:function(){if(this.boosters.active&&this.pointer){var e=cleverapps.styles.UI.BoostersTargets[this.boosters.active.id];this.pointer.stopAllActions(),this.pointer.setSpriteFrame(e.icons.icon_moving_png),this.pointer.setPosition(this.pointer.getRelativeCoordinates(e)),this.pointer.originalPosition=this.pointer.getPosition()}},onMouseMove:function(e){if(this.pointer&&this.boosters.active){var t=this.pointer.getParent().convertToNodeSpace(e.getLocation());this.pointer.setPosition(t),this.pointer.setVisible(!0),this.pointer.mouseMoved=!0}this.boosters.active&&this.infoBlock&&"bottom"===this.infoBlock.valign&&(this.boosters.active.hoverCell?this.infoBlock.hide():this.infoBlock.show(!1,.5))},removeLayout:function(){this.infoBlock&&(this.infoBlock.runAction(new cc.Sequence(new cc.MoveTo(.15,this.infoBlock.hidePosition),new cc.RemoveSelf)),delete this.infoBlock),this.layout&&(
this.layout.stopAllActions(),this.layout.runAction(new cc.Sequence(new cc.FadeOut(.2),new cc.CallFunc(function(){Game.currentGame&&[Game.currentGame.fieldController.floorView,Game.currentGame.fieldController.barriersView,Game.currentGame.fieldController.fieldView].forEach(function(e){e.realParent&&(e.replaceParent(e.realParent),e.setPosition(e.realPosition),e.realParent=void 0)}.bind(this)),delete this.layout}.bind(this)),new cc.RemoveSelf)))},removePointer:function(){this.pointer&&(this.pointer.removeFromParent(),delete this.pointer)},executeAnimation:function(){this.removeLayout();var e=this.pointer;e&&(e.stopAllActions(),e.runAction(new cc.Sequence(new cc.FadeOut(.2),new cc.CallFunc(this.removePointer.bind(this)))))},backAnimation:function(){var e=this.pointer,t=e.getPosition(),i=e.originalPosition;if(Math.abs(t.x-i.x)<e.width/2&&Math.abs(t.y-i.y)<e.height/2)return this.removeLayout(),void this.removePointer();e.stopAllActions(),e.setVisible(!0),e.runAction(new cc.Sequence(
new cc.Spawn(new cc.MoveTo(.3,i).easing(cc.easeIn(1.1)),new cc.Sequence(new cc.DelayTime(.1),new cc.FadeTo(.2,100))),new cc.CallFunc(function(){this.removeLayout(),this.removePointer()}.bind(this))))}});cleverapps.styles.BoostersView={background:!1,position:[{x:{align:"center"},y:{align:"center",dy:10}},{x:{align:"center"},y:{align:"center"}},{x:{align:"center"},y:{align:"center"}}],infoBlock:{bg:"notification_bg_png",sizes:[{width:"full",addx:90,height:220},{width:"field",height:180},{width:"field",height:110}],font:cleverapps.styles.FONTS.NOTIFICATION_TEXT,icon:{scales:[{scale:1.2},{scale:1},{scale:.7}]},margin:20,valign:["top","top","bottom"]}};var BreakView=cc.Node.extend({ctor:function(e,t,i){this._super();var s=cleverapps.styles.BreakView[e],n="";switch(e){case BreakView.TYPE_MISSION:n="messages:AddMovesWindow.mission."+Game.currentGame.gameMission.getName();break;case BreakView.TYPE_LANTERN:n="messages:AddMovesWindow.lantern";break;case BreakView.TYPE_BOOSTER:
n="messages:AddMovesWindow.booster";break;case BreakView.TYPE_COLLECTED_GOLD:n="messages:AddMovesWindow.collectedGold"}var o=cleverapps.UI.generateTTFText(n,cleverapps.styles.FONTS.BREAKVIEW_LOSE_TEXT);o.setAnchorPoint2();var a=void 0;switch(e){case BreakView.TYPE_MISSION:a=Game.currentGame.gameMission.getIcon();break;case BreakView.TYPE_BOOSTER:a=[res.cellbooster_small_png,res.linebooster_small_png,res.colorbooster_small_png][Game.currentGame.collectedBoosterCell.type]}var r=new cc.Sprite(a||s.icon.image);r.setAnchorPoint2(),r.setScale(s.icon.scale);var l=cleverapps.UI.generateTTFText("x"+t,cleverapps.styles.FONTS.BREAKVIEW_AMOUNT_TEXT);l.setAnchorPoint2();var c=new cleverapps.Layout([r,l],{direction:cleverapps.UI.HORIZONTAL,margin:s.icon.margin}),p=new cleverapps.Layout([o].concat(c),{direction:cleverapps.UI.HORIZONTAL,margin:s.margin});if(p.width>i){for(var d=1,h=0;p.width*d>i&&h<100;)d*=.97,h++;p.setScale(d)}this.addChild(p)}});BreakView.AddBreakViews=function(i,s,n){n=n||0
;var o=cleverapps.styles.BreakView,a=0,e=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN)&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_LANTERN).logic.lantern;return[{type:BreakView.TYPE_BOOSTER,amount:"1",isActive:Game.currentGame&&Game.currentGame.collectedBoosterCell},{type:BreakView.TYPE_MISSION,amount:Game.currentGame.rewards.clover,isActive:Game.currentGame&&Game.currentGame.gameMission&&Game.currentGame.gameMission.isRunning()&&0<Game.currentGame.rewards.clover},{type:BreakView.TYPE_LANTERN,amount:e&&e.isActive(Game.currentGame.level)&&e.getCurrentStreak(),isActive:e&&e.isActive(Game.currentGame.level)&&0<e.getCurrentStreak()},{type:BreakView.TYPE_COLLECTED_GOLD,amount:Game.currentGame.rewards[GameBase.REWARD_GOLD],isActive:Game.currentGame.rewards[GameBase.REWARD_GOLD]&&Game.currentGame.rewards[GameBase.REWARD_GOLD]>Game.currentGame.basicGoldReward}].forEach(function(e){if(e.isActive){i.height+=o.extraHeight,a+=o.extraHeight,s.forEach(
function(e){e.y+=o.extraHeight});var t=new BreakView(e.type,e.amount,.95*i.width);t.setAnchorPoint2(),t.setPositionRound(i.width/2,o.y+n),i.addChild(t),s.push(t)}}),a},BreakView.TYPE_MISSION=1,BreakView.TYPE_BOOSTER=2,BreakView.TYPE_LANTERN=3,BreakView.TYPE_COLLECTED_GOLD=4,cleverapps.styles.BreakView={extraHeight:50,y:130},cleverapps.overrideFonts(cleverapps.styles.FONTS,{BREAKVIEW_LOSE_TEXT:{size:32,color:cleverapps.styles.COLORS.DARK_RED},BREAKVIEW_AMOUNT_TEXT:{size:36,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.DARK_OLIVE_GREEN_STROKE}}),cleverapps.styles.BreakView[BreakView.TYPE_MISSION]={margin:10,icon:{scale:.55,margin:5}},cleverapps.styles.BreakView[BreakView.TYPE_BOOSTER]={margin:10,icon:{scale:1.1,margin:5}},cleverapps.styles.BreakView[BreakView.TYPE_LANTERN]={margin:10,icon:{image:res.lantern_streak_icon,scale:1,margin:5}},cleverapps.styles.BreakView[BreakView.TYPE_COLLECTED_GOLD]={margin:10,icon:{image:bundles.game.frames.collected_gold_png,
scale:.35,margin:5}},cleverapps.StarChest=function(e){this.onStarsChangedListener=function(){},cleverapps.Chest.call(this,{storage:cleverapps.DataLoaderTypes.STAR_CHEST,serverTaskName:"starchests",isNewUser:e})},cleverapps.StarChest.prototype=Object.create(cleverapps.Chest.prototype),cleverapps.StarChest.prototype.constructor=cleverapps.StarChest,cleverapps.StarChest.prototype.fromJSON=function(e){this.locked=!0,this.setStars(e.stars)},cleverapps.StarChest.prototype.toJSON=function(){return{stars:this.stars}},cleverapps.StarChest.prototype.initializeForNewUser=function(){this.locked=!0,this.setStars(0)},cleverapps.StarChest.prototype.addStars=function(e){0!==e&&(this.setStars(this.stars+e),this.save(),this.onStarsChangedListener(),0<e&&(cleverapps.dailyTasks.addProgress(cleverapps.DailyTask.COLLECT_STARS,e),cleverapps.missionManager.dispatchEvent(Mission.EVENT_COLLECT_STARS,{amount:e})))},cleverapps.StarChest.prototype.setStars=function(e){e<0&&(e=0),this.stars=e,
this.locked&&this.stars>=cleverapps.StarChest.GOAL_AMOUNT&&this.unlock()},cleverapps.StarChest.prototype.open=function(){this.locked=!0,this.addStars(-cleverapps.StarChest.GOAL_AMOUNT),this.changeLockedListener()},cleverapps.StarChest.GOAL_AMOUNT=20,cleverapps.StarChest.BEGINNER_PRIZE={gold:50},cleverapps.StarChest.PRZIES=[{boosters:{5:1},gold:100},{boosters:{6:1},gold:100},{boosters:{7:1},gold:100},{boosters:{5:2},gold:100},{boosters:{6:2},gold:100},{boosters:{7:2},gold:100}];var StarChestWindow=RewardWindow.extend({ctor:function(e){(e=e||{}).reward=this.calcReward(),this._super(e)},onWindowLoaded:function(e){var t=cleverapps.styles.StarChestWindow;this._super({reward:e.reward,title:"messages:StarChestWindow.title",minHeight:t.minHeight,name:"starchestwindow",buttonText:"OK",closeButton:!1,rewardName:"starChest"}),this.button.setVisible(!1)},getContentItems:function(){var e=this._super();return e.push(this.createChest()),e},createChest:function(){
var e=cleverapps.styles.StarChestWindow,t=this.chest=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.chest);var i=this.chestAnimation=new cleverapps.Spine(bundles.starchest_window.jsons.star_chest_spine_json);return i.setAnimation(0,"ready_to_open",!0),t.addChild(i),i.setPositionRound(t.width/2,t.height/2),t.setLocalZOrder(-1),t},runRewardsListAnimation:function(){},addAnimation:function(){},calcReward:function(){return this.reward?this.reward:cleverapps.user.prepareRewardByRich(levels.user.isBeginner()?cleverapps.StarChest.BEGINNER_PRIZE:cleverapps.Random.choose(cleverapps.StarChest.PRZIES))},onShow:function(){var e=cleverapps.styles.StarChestWindow;this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){this.visible&&e.star_chest_reward_effect&&cleverapps.audio.playSound(res[e.star_chest_reward_effect])}.bind(this)),new cc.DelayTime(1.1),new cc.CallFunc(function(){this.visible&&e.star_chest_open_effect&&cleverapps.audio.playSound(
res[e.star_chest_open_effect])}.bind(this)))),this.chestAnimation.setAnimation(0,"ready_to_open",!0),this.rewardsList.iterateRewards(function(e){e.stopAllActions(),e.setVisible(!1)}),this.button.stopAllActions(),this.button.setVisible(!1),this.doubleButton&&(this.doubleButton.stopAllActions(),this.doubleButton.setVisible(!1)),this.shareCheckBox&&this.shareCheckBox.setVisible(!1);var t=function(){t=function(){},this.button.setVisible(!0),this.button.setOpacity(0),this.button.runAction(new cc.FadeIn(.3)),this.shareCheckBox&&(this.shareCheckBox.setVisible(!0),this.shareCheckBox.setCascadeOpacityEnabled(!0),this.shareCheckBox.setOpacity(0),this.shareCheckBox.runAction(new cc.FadeIn(.3))),this.doubleButton&&(this.doubleButton.setVisible(!0),this.doubleButton.setOpacity(0),this.doubleButton.runAction(new cc.FadeIn(.3)))}.bind(this);this.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.CallFunc(function(){this.chestAnimation.setAnimation(0,"opening",!1),
this.chestAnimation.setCompleteListener(function(){this.chestAnimation.setAnimation(0,"open_idle",!0)}.bind(this)),this.rewardsList.iterateRewards(function(e){this.rewardShowAnimation(e,t)}.bind(this))}.bind(this))))},rewardShowAnimation:function(e,t){e.targetPosition||(e.targetPosition=e.getPosition());var i,s,n=cleverapps.styles.StarChestWindow,o=e.getRelativeCoordinates(this.chest);e.setCascadeOpacityEnabled(!0),e.setOpacity(0),e.setScale(.5),e.setPosition(o),e.setLocalZOrder(2),e.setVisible(!0),i=cc.p(o.x+(e.targetPosition.x-o.x)/3,o.y+n.reward.arc.y2),s=cc.p(e.targetPosition.x,(e.targetPosition.y+o.y)/2),e.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.Spawn(new cc.FadeIn(.3),new cc.ScaleTo(.4,1),new cc.BezierTo(.5,[i,s,e.targetPosition]).easing(cc.easeIn(1))),new cc.CallFunc(t)))},onHide:function(){this.chestAnimation&&this.chestAnimation.setAnimation(0,"open_idle",!0),this.rewardsList&&this.rewardsList.iterateRewards(function(e){e.stopAllActions(),
e.targetPosition&&e.setPosition(e.targetPosition)})},onReceiveReward:function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.STAR_CHEST_OPEN)},receiveReward:function(){cleverapps.starChest.locked||(cleverapps.starChest.open(),this.onReceiveReward(),cleverapps.Chest.prototype._receiveReward(this.reward))}});StarChestWindow.prototype.listBundles=function(){return["reward_icons","starchest_window"]},cleverapps.styles.StarChestWindow={minHeight:750,chest:{width:300,height:300},rewards:{y:-200},text:{x:0,y:-10},animation:{x:0,y:150},reward:{arc:{y2:100}},star_chest_reward_effect:"star_chest_reward_effect",star_chest_open_effect:"star_chest_open_effect"};var StarChestLockedWindow=Window.extend({onWindowLoaded:function(){var e=new cc.Node;e.setAnchorPoint(.5,.5);var t=cleverapps.styles.StarChestLockedWindow;e.setContentSize2(t.width,t.height),this.content=e,this.addChest();var i={text:Messages.get("ASKS_PLAYERS"),onPressed:function(){cleverapps.social.checkConnection(function(){
new SelectFriendWindow("askStars",function(e,t){cleverapps.social.sendRequest(e,"askStarRequest",function(){e.forEach(function(e){cleverapps.friends.inApp(e)&&levels.friendRequests.sendServerRequest(e,levels.FriendRequest.TYPE_ASK_STAR)}),t()})})}.bind(this))},width:t.button.width,height:t.button.height};-1!==["huzcom","plinga","pliega"].indexOf(cleverapps.User.calcSource())&&(i={text:Messages.get("OK"),onPressed:this.close.bind(this)}),this._super({title:"messages:StarChestLockedWindow.title",name:"starchestlockedwindow",content:e,button:i}),cleverapps.audio.playSound(res.window_effect)},addChest:function(){var e=new cc.Node;e.setAnchorPoint(.5,.5);var t=cleverapps.styles.StarChestLockedWindow,i=cleverapps.UI.generateTTFText(cleverapps.starChest.stars+"/"+cleverapps.StarChest.GOAL_AMOUNT,cleverapps.styles.FONTS.WINDOW_TEXT,!1);e.addChild(i);var s=new cleverapps.Spine(t.jelly.animation.json);s.setAnimation(0,"get_stars",!0),e.addChild(s);var n=new cleverapps.Spine(
bundles.starchest_window.jsons.star_chest_spine_json,t.chest.scale);n.setAnimation(0,"ready_to_open",!0),e.addChild(n);var o={amount:cleverapps.StarChest.GOAL_AMOUNT-cleverapps.starChest.stars},a=cleverapps.UI.generateTTFText("messages:StarChestLockedWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT,o);a.setDimensions(this.content.width,0),a.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.addChild(a),a.setPositionRound(t.message),s.setPositionRound(t.jelly),n.setPosition(t.chest.position),i.setPositionRound(t.text),this.chest=e;var r=this.content;r.addChild(e),e.setPositionRound(r.width/2,0)}});StarChestLockedWindow.prototype.listBundles=function(){return["starchest_window"].concat(cleverapps.Spine.listBundles(cleverapps.styles.StarChestLockedWindow.jelly.animation.json))},cleverapps.styles.StarChestLockedWindow={button:{width:470,height:100},message:{x:0,y:110},jelly:{x:-120,y:350,animation:{json:bundles.starchest_window.jsons.starchest_life_jelly_spine_json}},chest:{position:{
x:130,y:390},scale:.7},text:{x:130,y:280},width:560,height:620};var CellGoalView=BaseGoalView.extend({ctor:function(e,t,i){var s=new((this.cell=t).getViewClass())(t);this._super(e,s,i)},getTargetPosition:function(e){return this.cell.getGoalTargetPosition?this.cell.getGoalTargetPosition(e.getRelativeCoordinates(this.getTarget())):this._super(e)},animateSmile:function(){this.cell.smile&&this.cell.smile()}});Gun.NUMBER_OF_SHOTS=5,Gun.prototype.executeOld=Gun.prototype.execute,Gun.prototype.execute=function(e){Game.counter.isActive()?e():this.executeOld(e)},Gun.prototype.onExecute=function(e){Game.currentGame&&Game.currentGame.score&&Game.currentGame.score.addGun(),this.setAmount(this.getAmount()-1),this.attack(),this.save(),Game.counter.setTimeout(function(){Game.currentGame&&BombByLeftMoves.ChooseLocations(Game.currentGame.field,Gun.NUMBER_OF_SHOTS).forEach(function(e){Game.currentGame.field.bombByLeftMovesCreate(e)});this.resetState(),e&&e()}.bind(this),700)},
RewardedAdsManager.AVAILABLE={episode:1,level:0},RewardedAdsManager.INTERSTITIAL_PROB=[0,0,0,0,.3,.5,.5,.7,1],ColorCell.CODES=["a","b","c","d","e","w"],FlowerCell.CODES=["f"],ColorContainerCell.CODES=["g"],IceCreamMakerCell.CODES=["i"],GumDecoratorCell.CODES=["k"],MultiColorBombCell.CODES=["l"],CannonCell.CODES=["m"],MovesCell.CODES=["n"],DirtyHoneyDecoratorCell.CODES=["o"],DonutBoxCell.CODES=["p"],DirtMakerCell.CODES=["q"],BurstCell.CODES=["r"],SmallPetardCell.CODES=["s"],ColorBombCell.CODES=["t"],ClockCell.CODES=["u"],FireflyJarCell.CODES=["v"],SharkCell.CODES=["x"],DogCell.CODES=["y"],GoalColorCell.CODES=["A","B","C","D","E","W"],FishCell.CODES=["F"],GingerHouseCell.CODES=["H"],MuffinCell.CODES=["I"],CookieManCell.CODES=["J"],CakeCell.CODES=["K"],MuffinGoalCell.CODES=["L"],MouseCell.CODES=["M"],NutCell.CODES=["N"],LollipopCell.CODES=["O"],GingerHousePartCell.CODES=["P"],TruffleCell.CODES=["Q"],FireworkCell.CODES=["R"],WaffleCell.CODES=["S"],DragonCell.CODES=["U"],
ColorCookieManCell.CODES=["V"],CandleCell.CODES=["X"],IceMakerCell.CODES=["Y"],BombCell.CODES=["Z"],BoxDecoratorCell.CODES=["~"],CrabMakerCell.CODES=["$"],DirtDecoratorCell.CODES=["%"],BagDecoratorCell.CODES=["^"],CrabDecoratorCell.CODES=["&"],MultiColorCell.CODES=["*"],SuperMultiColorCell.CODES=["("],ChainDecoratorCell.CODES=["-"],IceBlockDecoratorCell.CODES=[":"],BlanketCell.CODES=[""],FigureDragonCell.CODES=[""],WallCell.CODES=[""],Loader.WILDCARD=".",cleverapps.HERO_ACTIVATE_BY_CLICK_NONE=0,cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE=1,cleverapps.HERO_ACTIVATE_BY_CLICK_NO_MOVE=2;var HeroesLibrary={helpers:{followDir:function(e,t){for(var i=t.x,s=t.y,n=[],o=0,a=0;o<t.algo.numTargets&&(i+=e.x,s+=e.y,Game.currentGame.field.inField(s,i));){var r=Game.currentGame.field.cells[s][i];if(r instanceof WallCell)break;o++,r&&(CombosLibrary.filters.notOnThreeInRow(t,r)&&CombosLibrary.filters.hurtable(t,r)&&a++,n.push(r))}return{path:n,actionLength:o,hurtLength:a}},allFiltersCells:function(e,t){
var i,s,n=[];if(Game.currentGame&&Game.currentGame.field)for(i=0;i<Field.SIZE;i++)for(s=0;s<Field.SIZE;s++)CombosLibrary.checkFilters(e,Game.currentGame.field.cells[i][s],t)&&n.push(Game.currentGame.field.cells[i][s]);return n},chooseDirection:function(e){for(var t=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}],i=[],s=-1,n=0;n<t.length;n++){var o=HeroesLibrary.helpers.followDir(t[n],e);o.hurtLength>s&&(s=o.hurtLength,i=[]),o.hurtLength===s&&i.push(t[n])}var a=cleverapps.Random.choose(i);e.actionDirection=a,e.actionLength=HeroesLibrary.helpers.followDir(a,e).actionLength}},targets:{findByFilters:function(e){var t=HeroesLibrary.helpers.allFiltersCells(e);if(t.length<e.algo.numTargets){var i=HeroesLibrary.helpers.allFiltersCells(e,!0);i=cleverapps.Random.shuffle(i);for(var s=0;s<i.length&&!(t.indexOf(i[s])<0&&(t.push(i[s]),t.length>=e.algo.numTargets));s++);}else t=(t=cleverapps.Random.shuffle(t)).slice(0,e.algo.numTargets);return t},byDirection:function(e){
return HeroesLibrary.helpers.followDir(e.actionDirection,e).path}}};HeroesLibrary.levels={e:{1:{numTargets:1},2:{numTargets:2},3:{numTargets:3},4:{numTargets:3,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},5:{numTargets:4,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},6:{numTargets:5,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},7:{numTargets:5,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NO_MOVE}},d:{1:{numTargets:2},2:{numTargets:3},3:{numTargets:4},4:{numTargets:4,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},5:{numTargets:5,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},6:{numTargets:8,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},7:{numTargets:8,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NO_MOVE}},a:{1:{power:1,makeHeroProb:.2},2:{power:2,makeHeroProb:.25},3:{power:3,makeHeroProb:.3},4:{power:3,makeHeroProb:.3,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},5:{power:4,makeHeroProb:.35,
activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},6:{power:5,makeHeroProb:.4,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},7:{power:5,makeHeroProb:.4,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NO_MOVE}},b:{1:{power:1},2:{power:2},3:{power:3},4:{power:3,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},5:{power:4,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},6:{power:5,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},7:{power:5,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NO_MOVE}},c:{1:{numTargets:7},2:{numTargets:10},3:{numTargets:15},4:{numTargets:15,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},5:{numTargets:20,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},6:{numTargets:30,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},7:{numTargets:30,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NO_MOVE}},w:{1:{numTargets:1},2:{numTargets:2},3:{numTargets:3},4:{numTargets:3,
activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},5:{numTargets:4,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},6:{numTargets:5,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE},7:{numTargets:5,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NO_MOVE}}},HeroesLibrary.byColors={e:{shootFlyDuration:function(e,t){var i=(Math.abs(t.x-e.x)+Math.abs(t.y-e.y))/10;return i=Math.max(i,.8),i=Math.min(i,2.5)},shootAlgorithm:"bezier",action_timeout:1300,action_delay:700,between_shoot_timeout:100,blast_animation:bundles.game.jsons.bomb_animation_json,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NONE,numTargets:1,power:1,findTargets:HeroesLibrary.targets.findByFilters,filters:[CombosLibrary.filters.notSelf,CombosLibrary.filters.hurtable,CombosLibrary.filters.notAttackBuddies,CombosLibrary.filters.notAttackMulticolorCell,CombosLibrary.filters.notOnThreeInRow],action:CombosLibrary.actions.hurt},d:{shootFlyDuration:function(){return 0},shootAlgorithm:"blast",
action_timeout:700,action_delay:1200,between_shoot_timeout:0,bigZOrder:!0,blast_animation:bundles.game.jsons.bomb_animation_json,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NONE,numTargets:1,power:1,findTargets:HeroesLibrary.targets.findByFilters,filters:[CombosLibrary.filters.notSelf,CombosLibrary.filters.hurtable,CombosLibrary.filters.closeBy,CombosLibrary.filters.notOnThreeInRow,CombosLibrary.filters.notAttackBuddies,CombosLibrary.filters.notAttackMulticolorCell],action:CombosLibrary.actions.hurt},a:{shootFlyDuration:function(){return 1.2},shootAlgorithm:"blast",action_timeout:1500,action_delay:400,between_shoot_timeout:0,bigZOrder:!0,blast_animation:bundles.heroes.jsons.A_hero_spine_effect_json,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NONE,numTargets:5,power:1,makeHeroProb:.2,findTargets:HeroesLibrary.targets.findByFilters,filters:[CombosLibrary.filters.notSelf,CombosLibrary.filters.withCoefOrTurnToHero,CombosLibrary.filters.notAttackBuddies,
CombosLibrary.filters.notOnThreeInRow],action:CombosLibrary.actions.incCoefOrMakeHero},b:{shootFlyDuration:function(){return 1},shootAlgorithm:"jump",action_timeout:1400,action_delay:175,between_shoot_timeout:0,bigZOrder:!0,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NONE,numTargets:1,power:1,findTargets:CombosLibrary.targets.maxLife,filters:[CombosLibrary.filters.notSelf,CombosLibrary.filters.hurtable,CombosLibrary.filters.notAttackBuddies,CombosLibrary.filters.notAttackMulticolorCell,CombosLibrary.filters.notOnThreeInRow],action:CombosLibrary.actions.hurt},c:{shootFlyDuration:function(e,t){return 1.2},shootAlgorithm:"blast",action_timeout:900,action_delay:700,between_shoot_timeout:0,bigZOrder:!0,blast_animation:bundles.heroes.jsons.C_hero_spine_effect_json,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NONE,numTargets:3,power:1,findTargets:HeroesLibrary.targets.findByFilters,filters:[CombosLibrary.filters.notSelf,CombosLibrary.filters.shuffleable,
CombosLibrary.filters.notAttackBuddies,CombosLibrary.filters.notOnThreeInRow],actionToAllCells:!0,action:CombosLibrary.actions.shuffle},w:{shootFlyDuration:function(e,t){var i=Math.abs(t.x-e.x)+Math.abs(t.y-e.y),s=.8*e.algo.direct_timeout/1e3;return e.actionLength?s*i/e.actionLength:s},shootAlgorithm:"none",action_timeout:1500,action_delay:1e3,direct_timeout:600,between_shoot_timeout:0,bigZOrder:!0,activateByClick:cleverapps.HERO_ACTIVATE_BY_CLICK_NONE,numTargets:1,power:1,beforeEffect:HeroesLibrary.helpers.chooseDirection,findTargets:HeroesLibrary.targets.byDirection,filters:[CombosLibrary.filters.hurtable],action:CombosLibrary.actions.hurt}};var Heroes=function(){this.load(),this.onHeroChangeLevel=function(e,t){},this.onUnlockTutorial=function(){},this.onUpgradeTutorial=function(){},this.checkAvailableToOpen()};Heroes.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.HEROES);void 0===e?(this.data={},this.save()):this.data=e},
Heroes.prototype.getInfo=function(){return this.data},Heroes.prototype.updateInfo=function(e,t){this.data=e,this.save(t)},Heroes.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.HEROES,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("heroes")},Heroes.prototype.available=function(){return"undefined"!=typeof match3&&levels.user.checkAvailable(Heroes.AVAILABLE)},Heroes.prototype.checkAvailableToOpen=function(){if(this.available())for(var e in Heroes.OPEN_HERO)this.getLevel(e)||this.setLevel(e,1)},Heroes.prototype.canUpgradeSomebody=function(){for(var e=0;e<Heroes.AVAILABLE_HEROES.length;e++)if(this.canUpgradeHero(Heroes.AVAILABLE_HEROES[e]))return!0;return!1},Heroes.prototype.getListOfAvailableColors=function(){return Object.keys(this.data)},Heroes.prototype.getLevel=function(e){return Heroes.AVAILABLE_HEROES.indexOf(e)<0?0:this.data[e]||0},Heroes.prototype.getHero=function(e,t){var i=this.getLevel(e);if(t&&t.nextLevel&&i++,!(i<=0)){var s={level:i}
;return cleverapps.extend(s,HeroesLibrary.byColors[e],HeroesLibrary.levels[e][i]),s}},Heroes.prototype.isMaxLevel=function(e){return this.getLevel(e)>=Heroes.HEROES_MAX_LEVEL},Heroes.prototype.expUpgradePrice=function(e){var t=this.getLevel(e);return e===Heroes.UPGRADE_TUTORIAL_HERO&&this.canUpgradeTutorial()?0:e===Heroes.UNLOCK_TUTORIAL_HERO&&this.canUnlockTutorial()?0:t>=Heroes.UPGRADE_EXP_PRICE.length?void 0:Heroes.UPGRADE_EXP_PRICE[t]},Heroes.prototype.canUpgradeTutorial=function(){return 1===this.getLevel(Heroes.UPGRADE_TUTORIAL_HERO)},Heroes.prototype.upgradeTutorial=function(){this.canUpgradeTutorial()&&cleverapps.environment.isHeroesScene()&&cleverapps.metha.display({focus:"UPGRADE_HEROES",action:function(e){this.onUpgradeTutorial(),cleverapps.forces.onceForceClosed=e}.bind(this)})},Heroes.prototype.canUnlockTutorial=function(){return Heroes.UNLOCK_TUTORIAL_HERO&&0===this.getLevel(Heroes.UNLOCK_TUTORIAL_HERO)},Heroes.prototype.unlockTutorial=function(){this.canUnlockTutorial(
)&&cleverapps.environment.isHeroesScene()&&cleverapps.metha.display({focus:"UNLOCK_HEROES",action:function(e){this.onUnlockTutorial(),cleverapps.forces.onceForceClosed=e}.bind(this)})},Heroes.prototype.readyToOpen=function(){for(var e in Heroes.OPEN_HERO)if(!this.getLevel(e)&&levels.user.checkAvailable(Heroes.OPEN_HERO[e]))return e;return!1},Heroes.prototype.coinUpgradePrice=function(e){var t=this.getLevel(e);return e===Heroes.UPGRADE_TUTORIAL_HERO&&this.upgradeTutorial()?0:e===Heroes.UNLOCK_TUTORIAL_HERO&&this.unlockTutorial()?0:t>=Heroes.UPGRADE_GOLD_PRICE.length?void 0:Heroes.UPGRADE_GOLD_PRICE[t]},Heroes.prototype.canUpgradeHero=function(e){if(this.isMaxLevel(e))return!1;var t=this.expUpgradePrice(e);return void 0!==t&&levels.user.canTakeExp(t)},Heroes.prototype.getCurrentSkin=function(){return Heroes.REGULAR_SKIN},Heroes.prototype.listStats=function(e,t){var i=this.getHero(e,{nextLevel:t}),s={level:i.level,numTargets:i.numTargets,power:i.power};return i.makeHeroProb&&(
s.makeHeroProb=Math.round(100*i.makeHeroProb)),s},Heroes.prototype.incLevel=function(e){this.setLevel(e,this.getLevel(e)+1),cleverapps.history.add("hero",1)},Heroes.prototype.setLevel=function(e,t){this.data[e]=t,this.onHeroChangeLevel(e,t),this.save()},Heroes.UPGRADE_GOLD_PRICE=[0,0,30,100,200,300,300],Heroes.UPGRADE_EXP_PRICE=[3,5,15,150,300,400,500],Heroes.HEROES_MAX_LEVEL=7,Heroes.REGULAR_SKIN="regular",Heroes.AVAILABLE_HEROES=["e","d","a","b","c","w"],Heroes.UPGRADE_TUTORIAL_HERO="e",Heroes.UNLOCK_TUTORIAL_HERO="w",Heroes.OPEN_HERO={a:{episode:0,level:1},d:{episode:0,level:4},e:{episode:0,level:6},b:{episode:0,level:8}},Heroes.AVAILABLE={episode:1,level:0};var HeroWindow=Window.extend({onWindowLoaded:function(e,t){this.hero=e,"info"!==t.type||match3.heroes.getLevel(e.color)||(t.type="locked"),this.options=t;var i=cleverapps.styles.HeroWindow,s=this.generateContent(),n="messages:HeroWindow.title."+t.type,o={width:i.button.width,height:i.button.height},a=levels.user.canTakeExp(
match3.heroes.expUpgradePrice(this.hero.color))||!cleverapps.flags.nopayments;"upgrade"!==t.type&&"unlock"!==t.type||!a?(o.text=Messages.get("OK"),o.onPressed=this.close.bind(this)):("unlock"===t.type?o.text=Messages.get("Heroes.Unlock.Button"):o.text=Messages.get("Heroes.Upgrade.Button"),o.onPressed=this.upgrade.bind(this)),this._super({title:n,name:"finisherwindow",content:cleverapps.UI.wrapWithPadding(s,{x:0,y:i.topBottom}),button:o});var r=this.scale;this.scale=1,this.heroView.replaceParentSamePlace(this.window),this.scale=r,"upgrade"===t.type||"unlock"===t.type?cleverapps.audio.playSound(bundles.game.urls.upgrade_effect):cleverapps.audio.playSound(res.window_effect)},onClose:function(){this.finger&&this.finger.removeFromParent(!0),this.options.onClose&&this.options.onClose()},upgrade:function(){levels.user.canTakeExp(match3.heroes.expUpgradePrice(this.hero.color))?levels.user.takeGold(match3.heroes.coinUpgradePrice(this.hero.color))&&levels.user.takeExp(
match3.heroes.expUpgradePrice(this.hero.color))&&(match3.heroes.incLevel(this.hero.color),this.close()):new ExpInfoWindow},onShow:function(){var e=cleverapps.styles.HeroWindow;this.expPriceText&&this.expPriceText.setFont(e.canUpgrade.price.font),this.coinsPriceText&&this.coinsPriceText.setFont(e.canUpgrade.price.font)},getStyles:function(){return cleverapps.styles.HeroWindow},onPopUpAnimationFinished:function(){if("upgrade"===this.options.type&&this.hero.color===Heroes.UPGRADE_TUTORIAL_HERO&&match3.heroes.upgradeTutorial()||"unlock"===this.options.type&&this.hero.color===Heroes.UNLOCK_TUTORIAL_HERO&&match3.heroes.unlockTutorial()){this.finger=new FingerView,this.finger.setLocalZOrder(30),this.finger.delay(1);var e=cc.director.getRunningScene().scene,t=e.convertToNodeSpace(this.button.parent.convertToWorldSpace(this.button.getPosition()));t.y-=this.button.height/2+cleverapps.styles.HeroWindow.finger.y,this.finger.fadeIn(t),e.addChild(this.finger),this.finger.press(),this.finger.delay(.3
),this.finger.unPress(),this.finger.fadeOut(),this.finger.delay(1.3),this.finger.run({looped:!0})}},createPriceBlock:function(){var e=this.getStyles(),t=new cc.Node,i=new cc.Node;0===(s=match3.heroes.expUpgradePrice(this.hero.color))&&(s="messages:FREE");var s=cleverapps.UI.generateTTFText(s,e.canUpgrade.price.font);this.expPriceText=s,i.addChild(s);var n=new cc.Sprite(bundles.menubar.frames.exp_png);n.setScale(e.canUpgrade.price.exp.scale),i.addChild(n),cleverapps.UI.arrangeWithMargins(i.children,{direction:cleverapps.UI.HORIZONTAL,margin:e.canUpgrade.price.margin}),cleverapps.UI.wrap(i),t.addChild(i);var o=new cc.Node;0===(a=match3.heroes.coinUpgradePrice(this.hero.color))&&(a="messages:FREE");var a=cleverapps.UI.generateTTFText(a,e.canUpgrade.price.font);o.addChild(a);var r=new cc.Sprite(bundles.menubar.frames.coin_png);return r.setScale(e.canUpgrade.price.coin.scale),o.addChild(r),this.coinsPriceText=a,cleverapps.UI.arrangeWithMargins(o.children,{direction:cleverapps.UI.HORIZONTAL,
margin:e.canUpgrade.price.margin}),cleverapps.UI.wrap(o),t.addChild(o),cleverapps.UI.arrangeWithMargins(t.children,{direction:cleverapps.UI.HORIZONTAL,margin:e.canUpgrade.margin}),cleverapps.UI.wrap(t),t},createHelpText:function(e){var t=this.getStyles();return(e=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.WINDOW_SMALL_TEXT)).setDimensions(t.helpBlock.text.width,0),e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),e},createHelpBlock:function(){var e=this.getStyles(),t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.helpBlock.animation);var i=new cleverapps.Spine(bundles.hero_window.jsons.hero_window_help_json,1);i.setSkin(ColorCell.CODE_COLORS[this.hero.color]),t.addChild(i),i.setPositionRound(e.helpBlock.animation),i.setAnimation(0,"animation",!0);var s=new cleverapps.Layout([this.createHelpText("messages:HeroWindow.help2"),this.createHelpText("messages:HeroWindow.help")],{margin:e.helpBlock.text.margin,direction:cleverapps.UI.VERTICAL});return new cleverapps.Layout([t,
s],{margin:e.helpBlock.margin,direction:cleverapps.UI.HORIZONTAL})},createStatsBlock:function(){var e=this.getStyles(),t=match3.heroes.listStats(this.hero.color,"upgrade"===this.options.type||"unlock"===this.options.type||"locked"===this.options.type),i=t;"upgrade"===this.options.type&&(i=match3.heroes.listStats(this.hero.color));var s=[];for(var n in t){var o="";"makeHeroProb"===n&&(o="%");var a=(c=t[n])-i[n],r=[];(new cc.Node).setAnchorPoint2();var l=cleverapps.UI.generateTTFText("messages:HeroWindow.stats."+n,cleverapps.styles.FONTS.HERO_STATS_VALUE);r.push(l);var c,p=cleverapps.styles.FONTS.HERO_STATS_VALUE,d=i[n];if((c=cleverapps.UI.generateTTFText(d+o,p)).setScale(1.2),c.y=e.statsBlock.digits.dy,r.push(c),a){var h=cleverapps.UI.generateTTFText("+ "+a+o,cleverapps.styles.FONTS.HERO_STATS_UPGRADE_VALUE);h.y=e.statsBlock.digits.dy,h.setScale(1.2),r.push(h)}var u=new cleverapps.Layout(r,{direction:cleverapps.UI.HORIZONTAL,margin:e.statsBlock.margin});s.unshift(u)}
var v=this.createActivateText();v&&s.unshift(v);var g=new cleverapps.Layout(s,{margin:e.statsBlock.rowMargin,direction:cleverapps.UI.VERTICAL});return s.forEach(function(e){e.setPositionRound({align:"left"},e.y)}),this.heroView=this.createHero(),u=new cleverapps.Layout([this.heroView,g],{margin:e.statsBlock.heroMargin,direction:cleverapps.UI.HORIZONTAL})},createActivateText:function(){var e=this.getStyles(),t=match3.heroes.getHero(this.hero.color,{nextLevel:-1!==["upgrade","unlock","locked"].indexOf(this.options.type)}),i=t;if("upgrade"===this.options.type&&(i=match3.heroes.getHero(this.hero.color)),t.activateByClick!==cleverapps.HERO_ACTIVATE_BY_CLICK_NONE){var s="Heroes.CanActivateByDblClick";t.activateByClick===cleverapps.HERO_ACTIVATE_BY_CLICK_NO_MOVE&&(s="Heroes.CanActivateByDblClickNoMove");var n=cleverapps.UI.generateTTFText("messages:"+s,t.activateByClick!==i.activateByClick?cleverapps.styles.FONTS.HERO_STATS_UPGRADE_VALUE:cleverapps.styles.FONTS.WINDOW_SMALL_TEXT)
;return n.setDimensions(e.activateText.width,0),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),n}},createHero:function(){var e=this.getStyles(),t=new cc.Node;t.setLocalZOrder(3),t.setAnchorPoint2(),t.setContentSize2(e.hero.width*e.hero.scale,e.hero.height*e.hero.scale);var i=this.hero.color.toUpperCase(),s=this.animation=new cleverapps.Spine(bundles.heroes.jsons[i+"_hero_spine_json"],e.hero.scale);s.setSkin(match3.heroes.getCurrentSkin()),s.setPosition(t.width/2,t.height/2),t.addChild(s);var n=new cleverapps.Spine(res.story_light_animation_json,2.5);return t.addChild(n),n.setAnimation(0,"animation",!0),n.setPositionRound(s.getPosition()),n.setLocalZOrder(-1),t},generateContent:function(){var e=cleverapps.styles.HeroWindow,t=[],i=this.hero.color.toUpperCase();"upgrade"!==this.options.type&&"unlock"!==this.options.type||t.push(this.createPriceBlock()),t.push(this.createHelpBlock());var s=cleverapps.UI.generateTTFText("messages:HeroWindow."+i,cleverapps.styles.FONTS.WINDOW_TEXT)
;s.setDimensions(e.width,0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.push(s),t.push(this.createStatsBlock());var n=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL,margin:e.margin});return this.runSequence(this.animation,["idle","idle","out"]),n},runSequence:function(t,i){var s=0,n=function(){var e=i[s];s++,i.length===s&&(s=0),t.setCompleteListener(function(){n()}),t.setAnimation(0,e,!1)};n()}});HeroWindow.prototype.listBundles=function(){return["heroes","game","hero_window"]},cleverapps.styles.HeroWindow={width:600,finger:{y:-30},canUpgrade:{margin:70,price:{margin:10,exp:{scale:.9},coin:{scale:.9},font:cleverapps.styles.FONTS.HERO_UPGRADE}},activateText:{width:350},helpBlock:{margin:30,text:{margin:50,width:300},animation:{width:300,height:300,x:150,y:150}},statsBlock:{margin:5,rowMargin:0,heroMargin:40,digits:{dy:2}},hero:{width:200,height:200,scale:1.5},button:{width:300,height:100},animation:{y:30},margin:20,topBottom:50}
;var CanUpgradeHeroWindow=Window.extend({onWindowLoaded:function(){var n=cleverapps.styles.CanUpgradeHeroWindow,e=new cc.Node,o=new cc.Node;o.setAnchorPoint(.5,.5),o.setContentSize2(n.heroesNode.width,n.heroesNode.height),cleverapps.styles.HeroesScene.heroBuildings.forEach(function(e,t){var i=e.color.toUpperCase(),s=new cleverapps.Spine(bundles.heroes.jsons[i+"_hero_spine_json"],n.heroes[t].scale);s.setSkin(match3.heroes.getCurrentSkin()),s.setPosition(o.width/2+n.heroes[t].x,o.height/2+n.heroes[t].y),s.setAnimation(0,"idle",!0),o.addChild(s)},this);var t=cleverapps.UI.generateTTFText("messages:CanUpgradeHeroes.Text",cleverapps.styles.FONTS.WINDOW_TEXT);t.setDimensions(n.heroesNode.width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);e=new cleverapps.Layout([t,o],{margin:n.content.margin,padding:n.content.padding,direction:cleverapps.UI.VERTICAL});this._super({title:"messages:CanUpgradeHeroes.Title",name:"canupgradeherowindow",content:e,button:{text:Messages.get(
"CanUpgradeHeroes.Button"),onPressed:function(){cleverapps.metha.distract({focus:"CanUpgradeHeroesScene",action:function(e){cleverapps.scenes.replaceScene(new HeroesScene,e)}})},maxWidth:n.button.maxWidth,width:n.button.width,height:n.button.height}}),cleverapps.audio.playSound(res.window_effect)}});CanUpgradeHeroWindow.prototype.listBundles=function(){return["heroes"]},cleverapps.styles.CanUpgradeHeroWindow={content:{margin:0,padding:{x:0,y:100}},button:{width:200,height:90,maxWidth:400},heroesNode:{width:550,height:350},heroes:[{x:-56,y:150,scale:1},{x:56,y:150,scale:1},{x:-150,y:50,scale:1.25},{x:150,y:50,scale:1.25},{x:-80,y:-50,scale:1.4},{x:80,y:-50,scale:1.4}]};var HeroesScene=cleverapps.FixedWidthScene.extend({ctor:function(){this._super(cleverapps.Environment.SCENE_HEROES),match3.heroes.onHeroChangeLevel=this.createListener(this.heroBuildingUpgraded.bind(this)),this.heroBuildings={},cleverapps.styles.HeroesScene.heroBuildings.forEach(function(e){var t=e.color
;this.heroBuildings[t]=this.createHeroBuilding(e,match3.heroes.getLevel(t)),this.scene.parallaxContainer.addChild(this.heroBuildings[t])},this),cleverapps.user.onChangeExpListeners.heroesbuildings=this.createListener(this.updateAllInfo.bind(this)),match3.heroes.onUnlockTutorial=this.createListener(this.unlockTutorial.bind(this)),match3.heroes.onUpgradeTutorial=this.createListener(this.upgradeTutorial.bind(this)),this.customize(),cleverapps.placements.run(Placements.INTERMEDIATE)},getRefreshSceneActionOnChangeSize:function(){return function(e){cleverapps.scenes.replaceScene(new HeroesScene,e)}},onPressed:function(e){cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce(),this.clickHero(e.hero_color)},createHeroBuilding:function(e,t){var i=new cc.Node;i.hero_color=e.color;var s=cleverapps.styles.HeroesScene;cleverapps.UI.onClick(i,this.onPressed.bind(this,i));var n=e.color.toUpperCase(),o=new cc.Node;o.setAnchorPoint2(),o.setContentSize2(s.heroBuilding.width,
s.heroBuilding.height);var a=i.animation=new cleverapps.Spine(bundles.heroes.jsons[n+"_hero_spine_json"],s.heroBuilding.scale);a.setSkin(match3.heroes.getCurrentSkin()),a.setAnimation(0,"idle",!0),o.addChild(a),a.setPositionRound(o.width/2,o.height/2);var r=i.button=this.createButton(i),l=new cleverapps.Layout([r,o],{direction:cleverapps.UI.VERTICAL,margin:s.margin});i.setContentSize2(l.getContentSize()),i.addChild(l),l.setPositionRound(i.width/2,i.height/2);var c=i.levelBlock=cleverapps.UI.createScale9Sprite(s.levelBlock.bg);return c.setContentSize2(s.levelBlock.width,s.levelBlock.height),c.setPositionRound(i.width/2+s.levelBlock.x,i.height/2+s.levelBlock.y),i.addChild(c),0===t&&(c.setVisible(!1),"adventure"===cleverapps.config.name?a.setColor(new cc.Color(120,120,120,255)):cleverapps.UI.convertToGrayScale(a.spine)),this.updateLevelText(c,t),i.setAnchorPoint2(),i.setPosition(this.scene.width/2+e.x,this.scene.height/2+e.y),i},createButton:function(e){var t,i=e.hero_color,
s=match3.heroes.canUpgradeHero(i),n=match3.heroes.getLevel(i),o=match3.heroes.isMaxLevel(i),a=cleverapps.styles.HeroesScene.buttons;if(s){var r=0===n?"messages:Heroes.Unlock.Button":"messages:Heroes.Upgrade.Button";t=cleverapps.UI.generateTTFText(r,a.upgradeButton.font)}else if(match3.heroes.isMaxLevel(i))a=a.infoButton,t=cleverapps.UI.generateTTFText("messages:Heroes.Info.MaxLevel",a.font);else{a=a.infoButton,t=new cc.Node;var l=new cc.Sprite(bundles.menubar.frames.exp_png);l.setScale(a.content.exp.scale),t.addChild(l);var c=cleverapps.UI.generateTTFText(levels.user.exp+"/"+match3.heroes.expUpgradePrice(i),a.font);t.addChild(c),cleverapps.UI.arrangeWithMargins(t.children,{direction:cleverapps.UI.HORIZONTAL,margin:a.content.margin}),cleverapps.UI.wrap(t)}return new cleverapps.UI.Button({button_png:s||o?res.small_green_button:res.small_blue_button,button_on_png:s||o?res.small_green_button_on:res.small_blue_button_on,width:cleverapps.styles.HeroesScene.buttons.width,
height:cleverapps.styles.HeroesScene.buttons.height,onClicked:this.onPressed.bind(this,e),content:t})},updateLevelText:function(e,t){e.removeAllChildren();var i=cleverapps.styles.HeroesScene,s=cleverapps.UI.generateTTFText(t,i.levelBlock.font);s.setPositionRound(e.width/2,e.height/2),e.addChild(s)},updateAllInfo:function(){for(var e in this.heroBuildings)this.updateBuildingInfo(this.heroBuildings[e])},updateBuildingInfo:function(e){var t=e.button.getPosition();e.button.removeFromParent(),e.button=this.createButton(e),e.addChild(e.button),e.button.setPositionRound(t)},clickHero:function(i){cleverapps.metha.display({focus:"HeroWindow",control:["MenuBarGoldItem","MenuBarExpItem"],action:function(e){if(match3.heroes.isMaxLevel(i))new HeroWindow({color:i},{type:"info"});else{var t=match3.heroes.getLevel(i);new HeroWindow({color:i},{type:0===t?"unlock":"upgrade"})}cleverapps.metha.onceNoWindowsListener=e}})},heroBuildingUpgraded:function(e,t){var i=cleverapps.styles.HeroesScene,
s=this.heroBuildings[e];s.levelBlock.setVisible(!1),s.button.setVisible(!1),"adventure"===cleverapps.config.name?s.animation.setColor(new cc.Color(255,255,255,255)):cleverapps.UI.convertToGrayScale(s.animation.spine,!0),this.updateBuildingInfo(s),s.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){s.levelBlock.setVisible(!0),s.levelBlock.setScale(0),s.button.setScale(0),this.updateLevelText(s.levelBlock,t),s.levelBlock.runAction(new cc.ScaleTo(.3,1)),s.button.runAction(new cc.ScaleTo(.3,1))}.bind(this)),new cc.DelayTime(.5)));var n=new cleverapps.Spine(i.upgradeAnimation.json,1);n.setAnimation(0,"animation",!1),n.setLocalZOrder(1),n.setPositionRound(s.width/2+i.upgradeAnimation.x,s.height/2+i.upgradeAnimation.y),s.addChild(n),cleverapps.audio.playSound(i.upgradeAnimation.sound),n.setCompleteListener(function(){n.runAction(new cc.RemoveSelf)}.bind(this))},unlockTutorial:function(){cleverapps.forces.create(this.heroBuildings[Heroes.UNLOCK_TUTORIAL_HERO],
Forces.UNLOCK_HEROES)},upgradeTutorial:function(){cleverapps.forces.create(this.heroBuildings[Heroes.UPGRADE_TUTORIAL_HERO],Forces.UPGRADE_HEROES)},customize:function(){},getBackgroundStyles:function(){return cleverapps.styles.HeroesScene.background}});HeroesScene.BUNDLES=["heroes_backgrounds","heroes","menubar"],cleverapps.styles.HeroesScene={background:{background:bundles.heroes_backgrounds.urls.heroes_bg,scale:2,parallax:!0},margin:40,upgradeAnimation:{x:0,y:0,json:bundles.main.jsons.hero_oblako_spine_json,sound:bundles.main.urls.stage_change_effect},buttons:{width:220,height:70,infoButton:{font:cleverapps.styles.FONTS.INFO_EXP_TEXT,content:{exp:{scale:.5},margin:10}},upgradeButton:{font:cleverapps.styles.FONTS.BUTTON_SMALL_TEXT}},levelBlock:{bg:res.heroes_level_bg,font:cleverapps.styles.FONTS.WINDOW_WHITE_TEXT,width:70,height:50,x:-70,y:135},heroBuilding:{width:120,height:120,scale:1.5}};var slots=[];[320,0,-320].forEach(function(t){[-180,180].forEach(function(e){slots.push({x:e,
y:t})})}),cleverapps.styles.HeroesScene.heroBuildings=["e","d","a","b","c","w"].map(function(e,t){return{color:e,x:slots[t].x,y:slots[t].y}});var HeroesIcon=SideBarIcon.extend({ctor:function(e){var t=cleverapps.overrideStyles(cleverapps.styles.SideBarIcon,cleverapps.styles.HeroesIcon,!0);this._super(e,t)},onEnter:function(){this._super(),match3.heroes.canUpgradeSomebody()&&this.turnOnAttention()},onPressed:function(){this._super(),cleverapps.metha.display({focus:"HeroesSceneFromIcon",control:["toolbar","sidebar"],action:function(e){cleverapps.scenes.replaceScene(new HeroesScene,e)}})}});HeroesIcon.IsAvailable=function(){return"undefined"!=typeof match3&&match3.heroes&&match3.heroes.available()},cleverapps.styles.HeroesIcon={animation:bundles.sidebar.jsons.heroes_icon_json};var HeroGoalCell=function(e,t,i,s){ComboGoalCell.call(this,e,t,i,s),this.putInPoolAvailable=!0};HeroGoalCell.prototype=Object.create(ComboGoalCell.prototype),(HeroGoalCell.prototype.constructor=HeroGoalCell
).prototype.explode=function(e){GoalColorCell.prototype.explode.call(this,e)},HeroGoalCell.prototype.explodeViaCollect=function(e){this.algoEffect(GoalColorCell.prototype.explodeViaCollect.bind(this,e))};var HeroCell=function(e,t,i,s){ComboCell.call(this,e,t,i,s),this.putInPoolAvailable=!0};HeroCell.prototype=Object.create(ComboCell.prototype),(HeroCell.prototype.constructor=HeroCell).prototype.useCustomView=HeroGoalCell.prototype.useCustomView=function(){return!0},HeroCell.prototype.simpleExplode=function(e){this.algoEffect(ColorCell.prototype.simpleExplode.bind(this,e))},HeroCell.prototype.explode=function(e){ColorCell.prototype.explode.call(this,e)},HeroCell.prototype.onDoubleTouch=HeroGoalCell.prototype.onDoubleTouch=function(){!Game.currentGame||this.algo.activateByClick!==cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE&&this.algo.activateByClick!==cleverapps.HERO_ACTIVATE_BY_CLICK_NO_MOVE||(this.algo.activateByClick===cleverapps.HERO_ACTIVATE_BY_CLICK_MOVE&&(
Game.currentGame.field.removeSelection(),Game.currentGame.field.onMoveListener()),this.hurt())},HeroCell.prototype.getRandomColor=HeroGoalCell.prototype.getRandomColor=function(){var t=Game.currentGame.levelContent.colors.map(function(e){return e.toLowerCase()});return cleverapps.Random.choose(match3.heroes.getListOfAvailableColors().filter(function(e){return-1!==t.indexOf(e)})).toLowerCase()},HeroCell.prototype.getViewClass=HeroGoalCell.prototype.getViewClass=function(){if("a"===this.color)return HeroCellView_A;if("b"===this.color)return HeroCellView_B;if("c"===this.color)return HeroCellView_C;if("d"===this.color)return HeroCellView_D;if("e"===this.color)return HeroCellView_E;if("w"===this.color)return HeroCellView_W;throw"unknown color: "+this.color},Match3Rules.Heroes&&(ComboCell.CalcAlgo=function(e,t){return match3.heroes.getHero(e.color,t)},ComboCell.CalcConstructor=function(e,t){return Game.currentGame&&Game.currentGame.goals.typeInGoals(e.color)?HeroGoalCell:HeroCell})
;var HeroCellView=GoalColorCellView.extend(cleverapps.extend({},ComboCellViewCommon,{ctor:function(e){this._super(e);var t=e.color.toUpperCase();this.animation=new cleverapps.Spine(bundles.heroes.jsons[t+"_hero_spine_json"],1),this.animation.setSkin(match3.heroes.getCurrentSkin()),this.animation.setPosition(this.width/2,this.height/2),this.animation.setAnimation(0,"idle",!0),this.addChild(this.animation,-1)},createAnimation:function(e){if(cleverapps.audio.playSound(bundles.game.urls.booster_5_show_effect),(e=e||{}).silent||(this.setScale(0),this.runAction(new cc.ScaleTo(.4,1).easing(cc.easeBackOut()))),cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW){var t=this.light=new cleverapps.Spine(res.story_light_animation_json,2);t.setPositionRound(this.width/2+cleverapps.styles.FireworkCellView.light.x,this.height/2+cleverapps.styles.FireworkCellView.light.y),t.setLocalZOrder(-2),this.addChild(t);var i=this.getLocalZOrder();i||(i=0),this.setLocalZOrder(3),t.setAnimation(0,
"animation",!0),t.runAction(new cc.Sequence(new cc.DelayTime(1.5),new cc.ScaleTo(.2,0),new cc.CallFunc(function(){this.setLocalZOrder(i),this.removeLight()}.bind(this))))}this.cell.algo.createAnimation?this.animation.setAnimationAndIdleAfter(this.cell.algo.createAnimation,"idle"):this.animation.setAnimation(0,"idle",!0)},removeLight:function(){this.light&&(this.light.stopAllActions(),this.light.runAction(new cc.RemoveSelf),this.light=void 0)},animateEffect:function(){this.removeLight(),this.inShakeNow=!0,this.cell.algo.bigZOrder?this.setLocalZOrder(20):this.setLocalZOrder(3),this.animation.setCompleteListener(function(){this.animation.setAnimation(0,"idle",!0),this.inShakeNow=!1}.bind(this)),this.effectSound();var e=this.coefView;if(this.cell.actionDirection){e&&e.setVisible(!1),this.setLocalZOrder(22);var t=cleverapps.styles.HeroCellView.animation.overshoot?.25:0,i=this.cell.x+(this.cell.actionLength+t)*this.cell.actionDirection.x,s=this.cell.y+(this.cell.actionLength+t
)*this.cell.actionDirection.y,n=BaseCellView.alignInTheGrid(i,s);this.runAction(new cc.Sequence(new cc.DelayTime(.8*this.cell.algo.action_delay/1e3),new cc.MoveTo(this.cell.algo.direct_timeout/1e3,n),new cc.CallFunc(function(){e&&e.setVisible(!0)}.bind(this))));var o=cleverapps.styles.HeroCellView.animation.direction;0<this.cell.actionDirection.x?this.animation.setAnimation(0,o.right,!1):this.cell.actionDirection.x<0?this.animation.setAnimation(0,o.left,!1):0<this.cell.actionDirection.y?this.animation.setAnimation(0,o.down,!1):this.animation.setAnimation(0,o.up,!1)}else this.animation.setAnimation(0,"out",!1)},effectSound:function(){this.cell.color&&bundles.game.urls["hero_sound_"+this.cell.color]&&cleverapps.audio.playSound(bundles.game.urls["hero_sound_"+this.cell.color])},smile:function(){},stopSmile:function(){},initialize:function(e){GoalColorCellView.prototype.initialize.call(this,e),this.afterInitialize(e)},unuse:function(){this.animation.visible=!1,this.beforeUnuse(),
this.stopSmile(),GoalColorCellView.prototype.unuse.call(this)},startExploding:function(e,t){this.cell instanceof HeroGoalCell?GoalColorCellView.prototype.startExploding.call(this,e,t):ColorCellView.prototype.startExploding.call(this,e,t)}})),HeroCellView_A=HeroCellView.extend({}),HeroCellView_B=HeroCellView.extend({}),HeroCellView_C=HeroCellView.extend({}),HeroCellView_D=HeroCellView.extend({}),HeroCellView_E=HeroCellView.extend({}),HeroCellView_W=HeroCellView.extend({});cleverapps.styles.HeroCellView={animation:{overshoot:!0,direction:{left:"out",right:"out2",up:"out",down:"out2"}}},Match3Rules.Heroes&&(CrazyCombosLibrary.comboCombo=function(e,t){Game.currentGame&&!Game.currentGame.field.isThreeInRow(e.y,e.x)&&(e.mustHurtNextBurn=!0),Game.currentGame&&!Game.currentGame.field.isThreeInRow(t.y,t.x)&&(t.mustHurtNextBurn=!0)},Field.prototype._findAllShapes=Field.prototype.findAllShapes,Field.prototype.findAllShapes=function(e){var t=this._findAllShapes(e);if(!e)for(
var i=0;i<Field.SIZE;i++)for(var s=0;s<Field.SIZE;s++)if(this.isCellInField(i,s)&&this.cells[i][s].mustHurtNextBurn){delete this.cells[i][s].mustHurtNextBurn;var n=new Shape;n.add(this.cells[i][s]),t.push(n)}return t}),cleverapps.Lives=function(e){cleverapps.config.debugMode&&(cleverapps.Lives.TIMEOUT="1 minute"),e?(this.amount=cleverapps.Lives.MAX_REGEN_AMOUNT,this.whenStart=void 0,this.save()):this.load(),this.onChangeAmountListeners={},this.onStartRegenerateListener=function(){},this.onBuyUnlimitedLivesListener=function(){},this.processRegenerateState()},cleverapps.Lives.prototype.processRegenerateState=function(e){var t,i;for(this.stopRegenerateTimeout();this.amount<cleverapps.Lives.MAX_REGEN_AMOUNT&&this.whenStart&&this.whenStart+cleverapps.parseInterval(cleverapps.Lives.TIMEOUT)<=Date.now();)this.amount++,this.whenStart+=cleverapps.parseInterval(cleverapps.Lives.TIMEOUT),i=t=!0;t&&!e&&this.runListeners(),this.amount>=cleverapps.Lives.MAX_REGEN_AMOUNT?delete this.whenStart:(
this.whenStart||(this.whenStart=Date.now(),i=!0),this.startRegenerateTimeout(e)),i&&this.save(),this.processLocalPushes()},cleverapps.Lives.prototype.startRegenerateTimeout=function(e){void 0===this.finishRegenerateTimeout&&(this.finishRegenerateTimeout=new cleverapps.LongTimeout(this.processRegenerateState.bind(this),this.calcTimeLeft()),e||this.onStartRegenerateListener())},cleverapps.Lives.prototype.stopRegenerateTimeout=function(){void 0!==this.finishRegenerateTimeout&&(this.finishRegenerateTimeout.clear(),this.finishRegenerateTimeout=void 0)},cleverapps.Lives.prototype.isRegenerateRunning=function(){return void 0!==this.finishRegenerateTimeout},cleverapps.Lives.prototype.calcTimeLeft=function(){var e=(this.whenStart||Date.now())+cleverapps.parseInterval(cleverapps.Lives.TIMEOUT)-Date.now();return e<0&&(e=0),e>cleverapps.parseInterval(cleverapps.Lives.TIMEOUT)&&(e=cleverapps.parseInterval(cleverapps.Lives.TIMEOUT)),e},cleverapps.Lives.prototype.isEmpty=function(){
return 0===this.amount&&!cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)},cleverapps.Lives.prototype.isFull=function(){return this.amount>=cleverapps.Lives.MAX_REGEN_AMOUNT||cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)},cleverapps.Lives.prototype.give=function(e){e=void 0===e?1:e,this.setAmount(this.amount+e)},cleverapps.Lives.prototype.setAmount=function(e,t){e<0&&(e=0),this.amount!==e&&(this.amount=e,this.save(),t||this.runListeners()),this.processRegenerateState(t)},cleverapps.Lives.prototype.processLocalPushes=function(){if(this.amount>=cleverapps.Lives.MAX_REGEN_AMOUNT||cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES))cleverapps.localPushes.cancelPush(cleverapps.LocalPushes.LIVES_CODE);else{var e=cleverapps.Lives.MAX_REGEN_AMOUNT-this.amount,t=(this.whenStart||Date.now())+cleverapps.parseInterval(cleverapps.Lives.TIMEOUT)*e-Date.now();cleverapps.localPushes.sendPush(cleverapps.LocalPushes.LIVES_CODE,t)
}},cleverapps.Lives.prototype.reset=function(){this.amount=cleverapps.Lives.MAX_REGEN_AMOUNT,this.whenStart=void 0,this.processRegenerateState(),this.save()},cleverapps.Lives.prototype.take=function(e){cleverapps.config.editorMode||(this.amount>=cleverapps.Lives.MAX_REGEN_AMOUNT&&delete this.whenStart,0<this.amount&&this.setAmount(this.amount-1,e))},cleverapps.Lives.prototype.getInfo=function(){return{amount:this.amount,whenStart:this.whenStart}},cleverapps.Lives.prototype.updateInfo=function(e,t){this.amount=e.amount,this.whenStart=e.whenStart,this.processRegenerateState(),this.save(t)},cleverapps.Lives.prototype.runListeners=function(){cleverapps.values(this.onChangeAmountListeners).forEach(function(e){e()})},cleverapps.Lives.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.LIVES,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("lives")},cleverapps.Lives.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.LIVES
);e?(this.amount=e.amount,this.whenStart=e.whenStart):(this.amount=cleverapps.Lives.MAX_REGEN_AMOUNT,this.whenStart=void 0)},cleverapps.Lives.MAX_REGEN_AMOUNT=5,cleverapps.Lives.TIMEOUT="30 minutes",cleverapps.Lives.AVAILABLE={episode:0,level:5};var AskLivesProduct=function(){this.icon="askLives_png",this.itemId="askLives",this.title="messages:LivesShopWindow.products.askLives"};AskLivesProduct.prototype.prototype=Object.create(Product.prototype),(AskLivesProduct.prototype.constructor=AskLivesProduct).prototype.getCurrentPrice=function(){return"messages:FREE"},AskLivesProduct.prototype.buy=function(i){cleverapps.social.checkConnection(function(){new SelectFriendWindow("askLives",function(e,t){cleverapps.social.sendRequest(e,"askLiveRequest",function(){e.forEach(function(e){cleverapps.friends.inApp(e)&&levels.friendRequests.sendServerRequest(e,levels.FriendRequest.TYPE_ASK_LIVE)}),t(),i()})})}.bind(this))};var RefillLivesProduct=function(){this.icon="refillLives_5_png",
this.itemId="refillLives",this.amountText="messages:LivesShopWindow.products.refillLives",this.title="messages:LivesShopWindow.products.refillLives",this.coinsProduct=!0,this.reward=cleverapps.Lives.MAX_REGEN_AMOUNT};RefillLivesProduct.prototype.prototype=Object.create(Product.prototype),(RefillLivesProduct.prototype.constructor=RefillLivesProduct).prototype.getCurrentPrice=function(){return RefillLivesProduct.PRICE},RefillLivesProduct.prototype.buy=function(e){return!!levels.user.takeGold(RefillLivesProduct.PRICE)&&(cleverapps.history.add("refill",1),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LIVES_BOUGHT),cleverapps.lives.give(this.reward),cleverapps.audio.playSound(res.shop_buy_effect),e(),!0)},RefillLivesProduct.PRICE=100,cleverapps.Bet=function(){cleverapps.config.debugMode&&(cleverapps.Bet.TIMEOUT="1 minute"),this.changeLockedListener=function(){},this.locked=!0,this.interval=cleverapps.parseInterval(cleverapps.Bet.TIMEOUT),this.load(),this.convertUnlimLivesToGold(
RewardsConfig)},cleverapps.Bet.prototype.take=function(){cleverapps.config.editorMode||cleverapps.user.gold>=cleverapps.Bet.REGEN_AMOUNT&&cleverapps.user.setGold(cleverapps.user.gold-cleverapps.Bet.REGEN_AMOUNT)},cleverapps.Bet.prototype.convertUnlimLivesToGold=function(t){if(void 0!==t){if(t.unlimitedLives){var e=cleverapps.parseInterval(t.unlimitedLives)/9e4;delete t.unlimitedLives,t.gold?t.gold+=e:t.gold=e,100<t.gold&&0<t.gold%50&&(t.gold=t.gold+50-t.gold%50)}Object.keys(t).forEach(function(e){this.convertUnlimLivesToGold(t[e])}.bind(this))}},cleverapps.Bet.prototype.isEnough=function(){return cleverapps.user.gold>=cleverapps.Bet.REGEN_AMOUNT},cleverapps.Bet.prototype.setWhenUnlock=function(e){this.when=Math.min(e,Date.now()+this.interval),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.BET_BONUS,{nextTime:this.when}),void 0!==this.countdown?this.countdown.resetTimeLeft(this.when-Date.now()):this.countdown=new cleverapps.CountDown(this.when-Date.now(),{onFinish:function(){
this.locked=!1,this.changeLockedListener()}.bind(this),permanent:!0})},cleverapps.Bet.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.BET_BONUS);void 0===e?this.setWhenUnlock(Date.now()+this.interval):this.setWhenUnlock(e.nextTime)},cleverapps.Bet.prototype.giveBonus=function(){this.locked=!0,this.setWhenUnlock(Date.now()+this.interval),this.changeLockedListener(),setTimeout(function(){cleverapps.user.setGold(cleverapps.user.gold+cleverapps.Bet.REGEN_AMOUNT)},1e3*CoinsRewardView.COLLECT_COIN_TIME)},cleverapps.Bet.REGEN_AMOUNT=100,cleverapps.Bet.TIMEOUT="1 hour",cleverapps.styles.COLORS=cleverapps.overrideColors(cleverapps.styles.COLORS,{COLOR_WINDOW_TEXT:new cc.Color(130,70,40,255),MINI_GAME_TEXT_COLOR:new cc.Color(71,122,217,255)}),cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{WINDOW_TITLE_STROKE:{color:new cc.Color(168,28,54,255),size:4},TITLE_TEXT_SHADOW:{color:cleverapps.styles.COLORS.BLACK,direction:cc.size(0,-4),blur:5}}),
cleverapps.styles.FONTS=cleverapps.overrideFonts(cleverapps.styles.FONTS,{WINDOW_TITLE_TEXT:{size:65,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.WINDOW_TITLE_STROKE},BUTTON_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE},DAILY_TASK_BUTTON_TEXT:{size:44,color:cleverapps.styles.COLORS.WHITE},BUTTON_SMALL_TEXT:{size:34,color:cleverapps.styles.COLORS.WHITE},GAME_REWARD_BUTTON_TEXT:{size:28,color:cleverapps.styles.COLORS.WHITE},LOADING_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE},WINDOW_WHITE_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE},WINDOW_SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},TEXT:{size:60,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT,prefix:"digits#timer_digit_",scale:.8},MENUBAR_TEXT:{size:36,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT,prefix:"digits#timer_digit_",scale:.8},TRANSITION_LOADING_TEXT:{size:40,color:cleverapps.styles.COLORS.MINI_GAME_TEXT_COLOR,prefix:"digits#timer_digit_",scale:.8},
PACK_ICON_TEXT:{prefix:"digits#timer_digit_",size:34,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},WHITE_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE},TIMER_WHITE_TEXT:{size:36,color:cleverapps.styles.COLORS.WHITE},SMALL_WHITE_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE},WINDOW_BIG_TEXT:{size:50,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},DAILY_TASKS_LEVEL_TEXT:{size:35,color:cleverapps.styles.COLORS.WHITE},FORCE_MESSAGE_TEXT:{size:40,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},PACK_WINDOW_TEXT:{size:32,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},LANGUAGE_TEXT:{size:30,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},LANGUAGE_SELECTED_TEXT:{size:30,color:new cc.Color(95,50,28,255)},REWARD_ELEMENT_TEXT:{prefix:"digits#timer_digit_",size:40,color:cleverapps.styles.COLORS.WHITE},REWARDS_LIST_TEXT:{prefix:"digits#timer_digit_",size:40,scale:.8,
color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},CONGRATE_TEXT:{size:100,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TITLE_TEXT_SHADOW},TILE_SHOP_OFFER_TEXT_LARGE:{prefix:"digits#timer_digit_",scale:.6,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},TILE_SHOP_OFFER_TEXT_SMALL:{prefix:"digits#timer_digit_",scale:.75,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},TILE_SHOP_OFFER_TEXT:{prefix:"digits#timer_digit_",scale:.8,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},NOTIFICATION_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE},WINDOW_TEXT:{size:40,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT}}),cleverapps.overrideStyles(levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_ADMIN_GIFTS],{avatar:"thg_present_box_pink"}),cleverapps.overrideStyles(cleverapps.styles.UI,{Avatar:{x:4,top:4,bottom:8},TTFText:{verticalAlignment:cc.VERTICAL_TEXT_ALIGNMENT_CENTER},Tooltip:{rewards:{extraWidth:40}}}),cleverapps.overrideStyles(
cleverapps.styles.MenuBar,{smallMargin:16,margin:24}),cleverapps.overrideStyles(cleverapps.styles.MenuBarItem,{textOffset:{x:-8,y:-2},iconBlockWidth:100,noPlusDx:18,plusButton:{position:!1}}),cleverapps.override(cleverapps.styles.SettingsWindow,{Button:{width:480,width2:230,width3:150},topPadding:52,bottomPadding:-60,width:550,height:530,window:{bgOffset:{x:0,y:-40}}}),cleverapps.overrideStyles(cleverapps.styles.Window,{minHeight:400,minWidth:300,Background:{scale9:cleverapps.UI.Scale9Rect.TwoPixelXY,paddingX:10},CloseButton:{offsetX:-40,offsetY:-27},BottomButton:{width:350,bottomPadding:50},Title:{offset:75},decors:{leaves_left:!0,leaves_right:!0},Border:{x:75,y:120}}),cleverapps.overrideStyles(cleverapps.styles.ReloadWindow,{width:600,paddingY:30,Button:{width:500},padding:{y:40}}),cleverapps.overrideStyles(cleverapps.styles.Tabs,{y:{align:"bottom",dy:81},button:{width:194}}),cleverapps.overrideStyles(cleverapps.styles.LeadersWindow,{width:620,height:820,head:{y:950},
button_on:"shop_tab_on",button_off:"shop_tab_off",player:{height:78,width:700,avatar:{scale:.6},name:{width:200,height:40}},table:{head:{y:805,height:40},rank:{x:90},player:{x:330},rating:{x:600}},worldContent:{top:-66,arrow:{x:345,y:-330}},friendsContent:{top:-66,noFriends:{Text:{y:160},Button:{width:380,y:0}}},window:{CloseButton:{offsetX:-34,offsetY:-27}}}),cleverapps.overrideStyles(cleverapps.styles.NewLeagueWindow,{height:300,button:{y:-70},text:{y:160},share:{Text:{offsetY:15},RewardText:{offsetY:-24}}}),cleverapps.overrideStyles(cleverapps.styles.Notification,{text:{y:-54},targetY:120}),cleverapps.overrideStyles(cleverapps.styles.HelpFromFriendsWindow,{button:{RewardCoins:{scale:.6,offsetX:30}},addcoinsvideo:{button:{RewardCoins:{offsetX:40}}}}),cleverapps.overrideStyles(cleverapps.styles.RestartWindow,{decors:{leaves_left:!1,leaves_right:!1}}),cleverapps.overrideStyles(cleverapps.styles.SideBarIcon,{timer:{offsetY:2,textWidth:130,regularFont:{offsetY:-3},bg:{scale9:!0,
width:148,height:50,arrow:{image:bundles.sidebar.frames.icon_text_arrow_bg,x:{align:"center"},y:0}}}}),cleverapps.overrideStyles(cleverapps.styles.TransitionAnimation,{loading:{delay:1.5}}),cleverapps.overrideStyles(cleverapps.styles.SceneDecors,{sceneControlButtonValentines:[{x:{align:"center"},y:{align:"bottom",dy:-10},image:bundles.valentines.frames.valentines_scene_button_decor_png}],menuBarItemValentines:[{x:{align:"left",dx:-20},y:{align:"top",dy:-20},image:bundles.valentines.frames.valentines_menu_bar_decor_1_png},{x:{align:"right",dx:8},y:{align:"top",dy:-10},image:bundles.valentines.frames.valentines_menu_bar_decor_2_png}],toolbarViewValentines:[{x:{align:"left",dx:-130},y:{align:"center",dy:23},image:bundles.valentines.frames.valentines_toolbar_decor_1_png,scale:{x:-1,y:1},zOrder:-1},{x:{align:"right",dx:130},y:{align:"center",dy:23},image:bundles.valentines.frames.valentines_toolbar_decor_1_png,zOrder:-1}],toolbarViewEaster:[{x:{align:"left",dx:-151},y:{align:"center",dy:11
},scale:{x:-1,y:1},zOrder:-1,image:bundles.easter.frames.toolbar_right},{x:{align:"right",dx:151},y:{align:"center",dy:11},zOrder:-1,image:bundles.easter.frames.toolbar_right}],toolbarViewMemorial:[{x:{align:"left",dx:-165},y:{align:"center",dy:40},scale:{x:1,y:1},zOrder:-1,image:bundles.memorial.frames.toolbar_decor},{x:{align:"right",dx:165},y:{align:"center",dy:40},scale:{x:-1,y:1},zOrder:-1,image:bundles.memorial.frames.toolbar_decor}]}),cleverapps.overrideStyles(cleverapps.styles.SideBarSlot,{padding:{top:240}}),cleverapps.overrideStyles(cleverapps.styles.SceneControlButtonsView,{scale:[.7,1,.8],panelPosition:{x:{align:"left",dx:60},y:{align:"center",dy:0}}}),cleverapps.overrideStyles(cleverapps.styles.FbConnectWindow,{padding:{y:50},offsetY:45}),cleverapps.overrideStyles(cleverapps.styles.WaitWindow,{text:{y:-60}}),cleverapps.overrideStyles(cleverapps.styles.LoadingScene,{bar:{x:2,y:1,scale9:{width:380,height:60,minWidth:60}},barBg:{y:70,scale9:{width:384,height:62}},message:{y:0
}}),cleverapps.overrideStyles(cleverapps.styles.ShadowView,{opacity:160}),cleverapps.overrideStyles(cleverapps.styles.LivesProductTile,{title:{paddingX:15,x:0,y:0}}),cleverapps.overrideStyles(cleverapps.styles.LargeTileRewardsBlock,{width:300,height:150,colMargin:15,offsetY:-20,gold:{scale:.6},imageFont:cleverapps.styles.FONTS.TILE_SHOP_OFFER_TEXT_LARGE}),cleverapps.overrideStyles(cleverapps.styles.LargeTileIcon,{wrap:{dy:-12},sweetPack:{wrap:{dy:5}},jamPack:{wrap:{dy:5}},tastyPack:{wrap:{dy:0}}}),cleverapps.overrideStyles(cleverapps.styles.LargeTileButton,{height:70,width:220,text:{padding:-80}}),cleverapps.overrideStyles(cleverapps.styles.LargeTileBadge,{timer:{x:{align:"center",dx:0},y:{align:"center",dy:-19},rotation:0},x:{align:"right",dx:25},y:{align:"top",dy:35},text:{rotation:20,width:110,x:-4,y:0}}),cleverapps.overrideStyles(cleverapps.styles.PackProductTile,{title:{width:362,height:130,text:{height:110,y:{align:"center",dy:5}}},okIcon:{y:{align:"center",dy:60}},vkIcon:{y:{
align:"center",dy:30}},offset:{y:40}}),cleverapps.overrideStyles(cleverapps.styles.SmallTileRewardsBlock,{colMargin:15,gold:{scale:.6},imageFont:cleverapps.styles.FONTS.TILE_SHOP_OFFER_TEXT_SMALL}),cleverapps.overrideStyles(cleverapps.styles.SmallTileIcon,{scale:1.2,wrap:{dy:-12}}),cleverapps.styles.Decorators={leaves_left:{lovesBackground:!0,type:Decors.TYPE_IMAGE,image:bundles.windows.frames.window_decor_1_png,scale:1,zOrder:1,x:{align:"left",dx:-43},y:{align:"top",dy:33}},leaves_right:{lovesBackground:!0,type:Decors.TYPE_IMAGE,image:bundles.windows.frames.window_decor_2_png,scale:1,zOrder:1,x:{align:"right",dx:16},y:{align:"top",dy:25}},gears_animation:{lovesBackground:!0,type:Decors.TYPE_ANIMATION,json:"settings_animation_json",animation:"animation",scale:.75,zOrder:-2,x:{align:"center",dx:0},y:{align:"top",dy:80}},hard_level_title_bg:{lovesBackground:!0,type:Decors.TYPE_SCALE9,image:bundles.windows.frames.hard_level_title_bg,scale:1,zOrder:0,x:{align:"center",dx:0},y:{align:"top",
dy:0},offsetWidth:30,width:50,height:128},hard_level_fire:{lovesBackground:!0,type:Decors.TYPE_IMAGE,image:bundles.windows.frames.hard_level_fire,scale:1,zOrder:1,x:{align:"left",dx:45},y:{align:"top",dy:-27}},hl_animation_left:{lovesBackground:!0,type:Decors.TYPE_ANIMATION,json:bundles.windows.jsons.hl_animation_left_json,animation:"animation",looped:!1,delay:.8,scale:1,zOrder:0,x:{align:"left",dx:-14},y:{align:"top",dy:-35}},hl_animation_right:{lovesBackground:!0,type:Decors.TYPE_ANIMATION,json:bundles.windows.jsons.hl_animation_right_json,animation:"animation",looped:!1,delay:.8,scale:1,zOrder:0,x:{align:"right",dx:8},y:{align:"top",dy:-81}},web_top:{type:Decors.TYPE_IMAGE,lovesBackground:!0,image:bundles.halloween.frames.halloween_web_top,scale:1,zOrder:1,x:{align:"left",dx:10},y:{align:"top",dy:0}},web_bottom:{type:Decors.TYPE_IMAGE,lovesBackground:!0,image:bundles.halloween.frames.halloween_web_bottom,scale:1,zOrder:0,x:{align:"left",dx:16},y:{align:"bottom",dy:25}},
candle_animation:{type:Decors.TYPE_ANIMATION,lovesBackground:!0,json:bundles.halloween.jsons.halloween_candle_json,animation:"animation",scale:1,zOrder:5,x:{align:"left",dx:352},y:{align:"top",dy:135}},owls_animation:{type:Decors.TYPE_ANIMATION,lovesBackground:!0,json:bundles.halloween.jsons.halloween_owls_json,animation:"animation",scale:.6,zOrder:5,x:{align:"center",dx:13},y:{align:"top",dy:743}},pumpkins:{type:Decors.TYPE_IMAGE,lovesBackground:!0,image:bundles.halloween.frames.halloween_pumpkins,scale:1,zOrder:1,x:{align:"left",dx:76},y:{align:"top",dy:126}},forest:{type:Decors.TYPE_IMAGE,lovesBackground:!0,image:bundles.halloween.frames.halloween_decor_forest,scale:1.2,zOrder:-2,x:{align:"center",dx:0},y:{align:"top",dy:345}},roots_top_left:{type:Decors.TYPE_IMAGE,lovesBackground:!0,image:bundles.halloween.frames.halloween_roots_top_left,scale:1,zOrder:1,x:{align:"left",dx:-30},y:{align:"top",dy:55}},roots_top_right:{type:Decors.TYPE_IMAGE,lovesBackground:!0,
image:bundles.halloween.frames.halloween_roots_top_right,scale:1,zOrder:1,x:{align:"right",dx:36},y:{align:"top",dy:68}},pumpkin_animation:{type:Decors.TYPE_ANIMATION,lovesBackground:!0,fearHigh:!0,json:bundles.halloween.jsons.halloween_jack_json,animation:"animation",scale:.9,zOrder:5,x:{align:"center",dx:-50},y:{align:"top",dy:-270}},xmas_window_1:{lovesBackground:!0,type:Decors.TYPE_IMAGE,image:bundles.xmas.frames.window_decor_1_png,scale:1,zOrder:1,x:{align:"left",dx:-43},y:{align:"top",dy:38}},xmas_window_2:{lovesBackground:!0,type:Decors.TYPE_IMAGE,image:bundles.xmas.frames.window_decor_2_png,scale:1,zOrder:1,x:{align:"right",dx:16},y:{align:"top",dy:2}},valentines_decor_left:{type:Decors.TYPE_IMAGE,image:bundles.valentines.frames.valentines_window_decor_cloud_2_png,lovesBackground:!0,scale:{x:-1,y:1},zOrder:1,x:{align:"left",dx:-55},y:{align:"bottom",dy:-60}},valentines_decor_right:{type:Decors.TYPE_IMAGE,image:bundles.valentines.frames.valentines_window_decor_cloud_2_png,
lovesBackground:!0,scale:1,zOrder:1,x:{align:"right",dx:55},y:{align:"bottom",dy:-60}},valentines_decor_top_1:{type:Decors.TYPE_IMAGE,image:bundles.valentines.frames.valentines_window_cloud_up2_png,lovesBackground:!0,scale:{x:-1,y:1},zOrder:-2,x:{align:"left",dx:19},y:{align:"top",dy:61}},valentines_decor_top_2:{type:Decors.TYPE_IMAGE,image:bundles.valentines.frames.valentines_window_cloud_up2_png,lovesBackground:!0,scale:1,zOrder:-2,x:{align:"right",dx:-21},y:{align:"top",dy:61}},valentines_decor_heart_top_1:{type:Decors.TYPE_IMAGE,image:bundles.valentines.frames.valentines_window_cloud_up_heart_png,lovesBackground:!0,scale:{x:-1,y:1},zOrder:0,x:{align:"left",dx:-30},y:{align:"top",dy:55}},window_bottom_left:{type:Decors.TYPE_IMAGE,image:bundles.easter.frames.window_bottom_left,lovesBackground:!0,zOrder:-1,scale:1,x:{align:"left",dx:-122},y:{align:"bottom",dy:-77}},window_bottom_right:{type:Decors.TYPE_IMAGE,image:bundles.easter.frames.window_bottom_right,lovesBackground:!0,zOrder:-1,
scale:1,x:{align:"right",dx:114},y:{align:"bottom",dy:-66}},memorial_decor_top:{type:Decors.TYPE_IMAGE,image:bundles.memorial.frames.memorial_decor_top,lovesBackground:!0,scale:{x:-1,y:1},zOrder:-1,x:{align:"right",dx:7},y:{align:"top",dy:87}},memorial_decor_bottom_left:{type:Decors.TYPE_IMAGE,image:bundles.memorial.frames.memorial_decor_bottom_left,lovesBackground:!0,scale:1,zOrder:1,x:{align:"left",dx:7},y:{align:"bottom",dy:-24}},memorial_decor_bottom_right:{type:Decors.TYPE_IMAGE,image:bundles.memorial.frames.memorial_decor_bottom_right,lovesBackground:!0,scale:1,zOrder:1,x:{align:"right",dx:-10},y:{align:"bottom",dy:-24}}};var SimpleMainScene=MainScene.extend({ctor:function(){this._super();var e=this.playButton=new PlayButtonView;this.scene.addChild(e),e.addFingerTip(),this.scene.addChild(new ProgressView),cleverapps.knockoutTutorial&&(cleverapps.knockoutTutorial.onPlayButtonForceListener=this.createListener(this.showPlayButtonForce.bind(this)))},showPlayButtonForce:function(e){
this.playButton.show(!0),cleverapps.forces.isAvailable(this.playButton,Forces.METHA_PLAY_BUTTON)?(cleverapps.forces.create(this.playButton,Forces.METHA_PLAY_BUTTON),cleverapps.forces.onceForceClosed=e):e()},getBackgroundStyles:function(){return{background:bundles["simple_background_"+cleverapps.simple.getCurrent()].urls.background}}});SimpleMainScene.BUNDLES=function(){return["simple_background_"+cleverapps.simple.getCurrent(),"merge"]};var Simple=function(){for(cleverapps.EventEmitter.call(this),this.stars=0,this.current=0,this.pendingsStars=0,this.bgsAmount=0;bundles["simple_background_"+this.bgsAmount];)this.bgsAmount++;"differences"===cleverapps.config.name&&(this.knockoutGame=new KnockoutGame),this.load()};Simple.prototype=Object.create(cleverapps.EventEmitter.prototype),(Simple.prototype.constructor=Simple).prototype.earnStars=function(e,t){this.stars+=e,t||(this.pendingsStars+=e),this.save(),this.trigger("changeStars")},Simple.prototype.getCurrent=function(){
return this.isPassedAll()?this.bgsAmount-1:this.current},Simple.prototype.isPassedAll=function(){return this.current>=this.bgsAmount-1},Simple.prototype.canMoveNext=function(){return this.stars>=this.getRequiredStars()&&this.current<this.bgsAmount-1},Simple.prototype.moveNext=function(e){var t="simple_background_"+(this.current+1);cleverapps.bundleLoader.loadBundle(t),cleverapps.metha.compound(e,[function(e){setTimeout(e,500)},function(e){var t=this.current,i=this.stars;this.current++,this.stars=0,this.save(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SIMPLE_METHA_BACKGROUND),new BackgroundsWindow({moveNext:!0,current:t,stars:i}),cleverapps.metha.onceNoWindowsListener=e}.bind(this),function(e){new RewardWindow({reward:Simple.CalcReward()}),cleverapps.metha.onceNoWindowsListener=e}.bind(this),function(e){cleverapps.scenes.replaceScene(new SimpleMainScene,e),cleverapps.bundleLoader.deleteBundle(t)}.bind(this)])},Simple.prototype.updateProgress=function(e){this.trigger(
"updateProgress",this.pendingsStars),e&&setTimeout(e,1e3*this.pendingsStars+1300),this.pendingsStars=0},Simple.prototype.amountLevelStars=function(e){return e.isHard()?3:1},Simple.prototype.getRequiredStars=function(e){return 0===(e=void 0!==e?e:this.current)?15:e<=12?30:50},Simple.prototype.gamePlayed=function(e,t){this.knockoutGame&&this.knockoutGame.rumble.getCurrentRound().calcWinners(e),e===GameBase.OUTCOME_VICTORY&&(this.earnStars(this.amountLevelStars(t.level)),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.METHA_LEVEL),cleverapps.playSession.set(cleverapps.EVENTS.METHA_LEVEL,!0))},Simple.prototype.wantsToPlay=function(e,t){var i=this.knockoutGame?this.knockoutGame.wantsToPlayActions():[];i.push(function(){MethaHelper.start(e,!1,t)}.bind(this)),cleverapps.metha.compound(e,i)},Simple.prototype.updateInfo=function(e){this.stars=e.stars||0,this.current=e.current||0,this.knockoutGame&&this.knockoutGame.save(e),this.save(!0)},Simple.prototype.getInfo=function(){var e={
stars:this.stars,current:this.current};return this.knockoutGame&&cleverapps.override(e,this.knockoutGame.getInfo()),e},cleverapps.config.debugMode&&(Simple.prototype.reset=function(){this.stars=0,this.current=0,this.save()}),Simple.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SIMPLE,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("metha")},Simple.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SIMPLE);e&&(this.stars=e.stars||0,this.current=e.current||0),this.knockoutGame&&this.knockoutGame.load(e)},Simple.CalcReward=function(){var t={gold:50},e=[];return"stacks"===cleverapps.config.subtype&&(e=[BoostersBefore.TYPE_HIGHLIGHT,BoostersBefore.TYPE_EYE,BoostersBefore.TYPE_HINT]),"solitaire"===cleverapps.config.type&&(e=[BoostersBefore.TYPE_MAGNET,BoostersBefore.TYPE_DICE,BoostersBefore.TYPE_TWO_JOKERS]),BoostersBefore.isAvailable()&&0<e.length&&e.every(function(e){return cleverapps.user.checkAvailable(
BoostersBeforeConfig[e].available)})&&(t.boosters={},e.forEach(function(e){t.boosters[e]=1})),"differences"===cleverapps.config.name&&(t.boosters={},t.boosters[DiscoverBooster.ID]=1,t.boosters[BrushBooster.ID]=1),t};var StarsProgressBar=cc.Node.extend({ctor:function(e){this._super(),this.options=e,this.stars=void 0!==this.options.stars?this.options.stars:cleverapps.simple.stars,this.current=void 0!==this.options.current?this.options.current:cleverapps.simple.current;var t=cleverapps.styles.StarsProgressBar;this.setAnchorPoint2(),this.setContentSize2(this.options.width,t.bar.height),this.addProgressBar(),this.addCounter(),this.options.withPresent&&this.addPresent(),cleverapps.simple.on("changeStars",function(){this.setStars(0<cleverapps.simple.pendingsStars?cleverapps.simple.stars-cleverapps.simple.pendingsStars:cleverapps.simple.stars)}.bind(this)),this.setStars(this.stars)},addProgressBar:function(){var e=cleverapps.styles.StarsProgressBar;this.barBg=new cc.Scale9Sprite(
bundles.simple.frames.bar_bg_png),this.addChild(this.barBg),this.barBg.setContentSize2(this.options.width+2*e.barBg.padding.x,e.bar.height+2*e.barBg.padding.y),this.barBg.setPositionRound(e.barBg),this.barBg.setLocalZOrder(-10),this.bar=new ScaledProgressBar(bundles.simple.frames.bar_png),this.addChild(this.bar),this.bar.setDimension(this.options.width,e.bar.height),this.bar.setMinWidth(e.bar.minWidth),this.bar.setPercentage(0)},addPresent:function(){var e=cleverapps.styles.StarsProgressBar;this.present=new cleverapps.Spine(bundles.windows.jsons.present_json),this.addChild(this.present),this.present.setScale(e.present.scale),this.present.setSkin("green"),this.present.setAnimation(0,"animation",!0),this.present.setPositionRound(e.present),this.present.setLocalZOrder(10),cleverapps.tooltipManager.create(this.present,{text:"messages:OpenBackgroundTooltip",rewards:Simple.CalcReward(),position:cleverapps.styles.UI.Tooltip.LOCATION.below,size:cleverapps.styles.UI.Tooltip.SIZE.medium})},
addCounter:function(){var e=cleverapps.styles.StarsProgressBar;this.counter=cleverapps.UI.generateTTFText(this.stars+"/"+cleverapps.simple.getRequiredStars(this.current),cleverapps.styles.FONTS.STARS_PROGRESS_BAR_TEXT),this.counter.setAnchorPoint2(0,.5),this.star=new cc.Sprite(bundles.simple.frames.star_png),this.counterLayout=new cleverapps.Layout([this.star,this.counter],{direction:cleverapps.UI.HORIZONTAL,margin:e.counter.margin}),this.counter.y+=e.counter.text.offsetY,this.addChild(this.counterLayout),this.counterLayout.setPositionRound(e.counter)},setStars:function(e){this.stars=e,this.counter.setString(e+"/"+cleverapps.simple.getRequiredStars(this.current)),this.bar.setPercentage(100*e/cleverapps.simple.getRequiredStars(this.current))},updateProgress:function(e){var t=cleverapps.styles.StarsProgressBar;this.barAnimation||(this.barAnimation=new cleverapps.Spine(bundles.simple.jsons.progress_bar_json),this.bar.addChild(this.barAnimation)),this.stars+=e,this.counter.setString(
this.stars+"/"+cleverapps.simple.getRequiredStars(this.current));var i=e/cleverapps.simple.getRequiredStars()*100;this.barAnimation.setPositionRound(this.bar.getPercentage()/100*this.bar.totalWidth+t.barAnimation.offsetX,this.bar.totalHeight/2),this.barAnimation.setAnimation(0,"animation",!1),this.barAnimation.runAction(new cc.MoveTo(.8,(this.bar.getPercentage()+i)/100*this.bar.totalWidth+t.barAnimation.offsetX,this.barAnimation.y).easing(cc.easeOut(2))),this.bar.animatedChange(i)}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{STARS_PROGRESS_BAR_TEXT:{prefix:"digits#timer_digit_",scale:.8,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.StarsProgressBar={bar:{height:50,minWidth:10},barAnimation:{offsetX:-15},barBg:{padding:{x:15,y:17},x:{align:"center"},y:{align:"center",dy:-4}},counter:{x:{align:"center"},y:{align:"center"},text:{offsetY:0},margin:2},present:{scale:.7,x:{align:"right",dx:90},y:{align:"center",dy:5}}};var ProgressView=cc.Node.extend({ctor:function(){
this._super(),this.setAnchorPoint2(),this.hoverContainer=new cc.Node,this.hoverContainer.setAnchorPoint2(),this.addChild(this.hoverContainer),this.addProgressBar(),this.addArrows(),this.addIcons(),cleverapps.UI.wrap(this.hoverContainer),this.setContentSize2(this.hoverContainer.getContentSize()),this.hoverContainer.setPositionRound(this.width/2,this.height/2),this.addPerson(),cleverapps.UI.applyHover(this.hoverContainer),cleverapps.UI.onClick(this,function(){cleverapps.metha.display({focus:"BackgroundsWindow",action:function(e){new BackgroundsWindow,cleverapps.metha.onceNoWindowsListener=e}})});var e=cleverapps.styles.ProgressView,t=cc.p(cleverapps.clone(e.x),cleverapps.clone(e.y));t.y.dy-=cleverapps.UI.getSceneOffsetY(),this.setPositionRound(t),cleverapps.UI.makeHideable(this,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("progress_view",this),cleverapps.simple.on("updateProgress",this.createListener(this.updateProgress.bind(this))),SceneDecors.add(this.hoverContainer,
cleverapps.skins.getSlot("progressViewDecor"))},addPerson:function(){var e=cleverapps.styles.ProgressView.person;if(e){this.person=new cc.Node,this.person.setAnchorPoint2(),this.person.setPositionRound(e),this.person.setContentSize2(e),this.addChild(this.person);var t=new cleverapps.Spine(e.animation.json,e.scale);cleverapps.user.on("heroSkinUpdated",this.createListener(function(e){t.setSkin(e)}.bind(this))),t.setAnimation(0,e.animation.idle,!0),t.setPositionRound(e.animation),this.person.addChild(t),e.animation.click&&cleverapps.UI.onClick(this.person,function(){t.setCompleteListener(function(){t.setCompleteListener(function(){}),t.setAnimation(0,e.animation.idle,!0)}),t.setAnimation(0,e.animation.click,!1),e.animation.clickSound&&cleverapps.audio.playSound(e.animation.clickSound)})}},updateProgress:function(i){this.show(!0);for(var s=cc.director.getRunningScene().scene,e=this.progressBar.star,n=s.convertToNodeSpace(e.getParent().convertToWorldSpace(e.getPosition())),
o=cleverapps.styles.ProgressView,a=function(){if(!cleverapps.simple.isPassedAll()&&cleverapps.simple.canMoveNext()){var e=new cleverapps.Spine(bundles.simple.jsons.progress_bar_spark_json);this.hoverContainer.addChild(e),e.setPositionRound(o.bar.spark),e.setCompleteListenerRemove(),e.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.CallFunc(function(){e.setAnimation(0,"animation",!1)})));var t=new cleverapps.Spine(bundles.simple.jsons.avatar_spark_json);this.hoverContainer.addChild(t),t.setPositionRound(this.nextIcon.getPosition()),t.setCompleteListenerRemove(),t.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.CallFunc(function(){t.setAnimation(0,"animation",!1),cleverapps.audio.playSound(bundles.simple.urls.simple_win_effect)})))}}.bind(this),t=function(e){var t=new cleverapps.Spine(bundles.simple.jsons.star_json);s.addChild(t),t.setCompleteListenerRemove(),t.setPositionRound(n.x,s.height/2),t.setLocalZOrder(10),t.runAction(new cc.Sequence(new cc.DelayTime(.8*e),
new cc.CallFunc(function(){t.setAnimation(0,"collect",!1)}),new cc.MoveTo(1,n).easing(cc.easeIn(2)),new cc.CallFunc(function(){this.progressBar.updateProgress(1),cleverapps.audio.playSound(bundles.simple.urls.star_collect_effect),e===i-1&&a()}.bind(this))))}.bind(this),r=0;r<i;r++)t(r)},addProgressBar:function(){var e=cleverapps.styles.ProgressView;this.progressBar=new StarsProgressBar({width:e.bar.width,stars:0<cleverapps.simple.pendingsStars?cleverapps.simple.stars-cleverapps.simple.pendingsStars:void 0}),this.hoverContainer.addChild(this.progressBar)},addArrows:function(){for(var e=cleverapps.styles.ProgressView,t=new cc.Sprite(bundles.simple.frames.arrow_png).width,i=(this.progressBar.width-e.arrows.widthOffset)/(t+e.arrows.margin),s=[],n=0;n<i;n++)s.push(new cc.Sprite(bundles.simple.frames.arrow_png));var o=new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL,margin:e.arrows.margin});o.setLocalZOrder(-1),this.progressBar.addChild(o),o.setPositionRound(
this.progressBar.width/2,this.progressBar.height/2)},addIcons:function(){var e=cleverapps.styles.ProgressView,t=this.currentIcon=this.createIcon(cleverapps.simple.current);this.hoverContainer.addChild(t),t.setPositionRound(-e.bar.width/2-e.icon.offset.x,this.height/2+e.icon.offset.y),t.setRotation(-e.icon.rotation||0);var i=this.nextIcon=this.createIcon(cleverapps.simple.current+1);i.setRotation(e.icon.rotation||0),this.hoverContainer.addChild(i),i.setPositionRound(e.bar.width/2+e.icon.offset.x,this.height/2+e.icon.offset.y)},createIcon:function(e){var t,i=cleverapps.styles.ProgressView,s=!bundles.simple.frames["background_icon_"+e];t=s?new cc.LayerColor(cleverapps.styles.COLORS.CLOSED_BACKGROUND_COLOR,i.comingSoon.icon.width,i.comingSoon.icon.height):new cc.Sprite(bundles.simple.frames["background_icon_"+e]);var n=this.createIconBg(t,e),o=new cc.Node;if(o.setAnchorPoint2(),o.setContentSize2(n.getContentSize()),o.addChild(t),o.addChild(n),o.setLocalZOrder(10),s){var a=new cc.Sprite(
bundles.simple.frames.lock_png);o.addChild(a),a.setLocalZOrder(10),a.setScale(i.comingSoon.lock.scale),a.setPositionRound(i.comingSoon.lock),t.setPositionRound(o.width/2-t.width/2,o.height/2-t.height/2)}else t.setPositionRound(o.width/2,o.height/2);return o},createIconBg:function(e,t){var i=cleverapps.styles.ProgressView.icon.bg,s=t>cleverapps.simple.current,n=new cc.Scale9Sprite(s?bundles.simple.frames.frame_gold_png:bundles.simple.frames.frame_silver_png);return i.flipped?(i=i.flipped,s&&n.setScaleX(-1),n.setPositionRound(s?i.right:i.left)):(n.setContentSize2(e.width*e.scaleX+2*i.padding.x,e.height*e.scaleY+2*i.padding.y),n.setPositionRound(i)),n}});cleverapps.styles.ProgressView={x:{align:"center"},y:{align:"bottom",dy:250},person:!1,bar:{width:350,spark:{x:{align:"center",dx:0},y:{align:"center",dy:0}}},arrows:{x:{align:"center"},y:{align:"center"},widthOffset:40,margin:15},icon:{offset:{y:0,x:52},bg:{padding:{x:12,y:15},x:{align:"center"},y:{align:"center",dy:-3}}},comingSoon:{
lock:{x:{align:"center"},y:{align:"center"},scale:.3},icon:{width:96,height:92}}};var BackgroundsWindow=Window.extend({onWindowLoaded:function(e){this.options=e||{},this.stars=void 0!==this.options.stars?this.options.stars:cleverapps.simple.stars,this.current=void 0!==this.options.current?this.options.current:cleverapps.simple.getCurrent();var t=this.createContent();this._super({content:t,title:"messages:BackgroundsWindow.title",name:"backgrounswindow",styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.BackgroundsWindow.window,!0)}),this.options.moveNext&&this.changeCurrent()},changeCurrent:function(){var e=this.bgs[this.bgs.length-cleverapps.simple.current],t=this.bgs[this.bgs.length-cleverapps.simple.current-1],i=this.bgs[this.bgs.length-cleverapps.simple.current-2];cleverapps.simple.current===this.bgs.length-2&&(i=!1),e.progressBar.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.ScaleTo(.3,1.2*e.progressBar.baseScale).easing(cc.easeOut(2)),
new cc.ScaleTo(.3,0).easing(cc.easeIn(2)),new cc.DelayTime(1.3))),this.addTape(e),e.tape.setScale(0),e.tape.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.ScaleTo(.5,1).easing(cc.easeBackInOut(.6)))),t.lock.runAction(new cc.Sequence(new cc.DelayTime(1.2),new cc.ScaleTo(.4,1.3*t.lock.scale).easing(cc.easeInOut(3)),new cc.ScaleTo(.4,0).easing(cc.easeIn(3)),new cc.RemoveSelf)),t.layerColor.runAction(new cc.Sequence(new cc.DelayTime(1.4),new cc.FadeOut(.5))),this.runAction(new cc.Sequence(new cc.DelayTime(1.3),new cc.CallFunc(function(){this.scroll.scrollTo(t,1.4),cleverapps.audio.playSound(bundles.simple.urls.simple_transition_effect)}.bind(this)))),i&&(i.closedImage.runAction(new cc.Sequence(new cc.DelayTime(1.4),new cc.FadeOut)),this.addLayerColor(i),i.layerColor.setOpacity(150)),this.addPresent(t),t.name&&this.runAction(new cc.Sequence(new cc.DelayTime(1.6),new cc.CallFunc(function(){t.name.setFont(cleverapps.styles.FONTS.BACKGROUNDS_WINDOW_NAME_TEXT)})))},
createContent:function(){var e=cleverapps.styles.BackgroundsWindow,t=Messages.get("messages:BackgroundsWindow.text");this.options.moveNext&&"scramble"===cleverapps.config.name&&(t=Messages.get("messages:BackgroundsWindow.moveNextText",{place:Messages.get("messages:background_name_"+cleverapps.simple.getCurrent())}));var i=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.BACKGROUNDS_WINDOW_TEXT);i.setDimensions(e.text.width,0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.bgs=[];for(var s=0,n=void 0;bundles["backgrounds_window_"+s];){var o=this.createItem(s);s===this.current&&(n=o),this.bgs.unshift(o),s++}this.bgs.unshift(this.createItem(s));var a=new cleverapps.Layout(this.bgs,{direction:cleverapps.UI.VERTICAL,margin:e.scroll.margin,padding:e.scroll.padding}),r=this.scroll=new cleverapps.UI.ScrollView(a,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_LINEAR});if(r.setContentSize2(a.width,e.scroll.height),r.scrollTo(n),e.scroll.bg){
var l=r.bg=new cc.Scale9Sprite(bundles.simple.frames.scroll_bg_png);l.setContentSize2(r.width+2*e.scroll.bg.padding.x,r.height+2*e.scroll.bg.padding.y),l.addChild(r),r.setPositionRound(e.scroll)}return new cleverapps.Layout([r.bg||r,i],{direction:cleverapps.UI.VERTICAL,margin:e.margin})},createItem:function(e){var t=cleverapps.styles.BackgroundsWindow,i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(t.item.width+2*t.item.bg.padding.x,t.item.height+2*t.item.bg.padding.y);var s=e<=this.current?t.item.imgCur:t.item.imgLocked,n=cleverapps.UI.createScale9Sprite(s,cleverapps.UI.Scale9Rect.TwoPixelXY);if(n.setContentSize2(i.getContentSize()),i.addChild(n),n.setPositionRound(i.width/2,i.height/2),n.setLocalZOrder(10),e<this.current)this.addTape(i),this.addBg(i,e);else if(e===this.current)this.addProgressBar(i,this.current,this.stars),this.addBg(i,e);else if(e<cleverapps.simple.bgsAmount){var o=i.lock=new cc.Sprite(bundles.simple.frames.lock_png);i.addChild(o),o.setPositionRound(t.lock),
e===this.current+1?(this.addBg(i,e),this.addLayerColor(i),i.layerColor.setOpacity(150)):this.addClosedImage(i),this.options.moveNext&&e===this.current+2&&this.addBg(i,e)}else{this.addClosedImage(i);var a=cleverapps.UI.generateTTFText("messages:EpisodeView.ComingSoonTitle",cleverapps.styles.FONTS.BACKGROUNDS_WINDOW_NAME_COMING_SOON);a.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),a.setDimensions(t.comingSoon.width,0),i.addChild(a),a.setPositionRound(t.comingSoon)}return i},addPresent:function(s){var e=cleverapps.styles.BackgroundsWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.present),s.addChild(t),t.setPositionRound(e.present),cleverapps.UI.applyHover(t),t.setScale(0);var i=new cleverapps.Spine(bundles.main.jsons.reward_spine_json);t.addChild(i),i.setScale(e.present.animation.scale),i.setPositionRound(e.present.animation),i.setAnimation(0,"animation",!0);var n=new cleverapps.Spine(bundles.windows.jsons.present_json);t.addChild(n),n.setScale(e.present.scale),n.setSkin(
"green"),n.setPositionRound(t.width/2,t.height/2),n.setLocalZOrder(10),n.setAnimation(0,"animation",!0);var o=new cleverapps.UI.Button({width:e.present.button.width,height:e.present.button.height,button_png:bundles.buttons_main.frames.small_green_button,button_on_png:bundles.buttons_main.frames.small_green_button_on,content:cleverapps.UI.generateTTFText("messages:BackgroundsWindow.Get",cleverapps.styles.FONTS.WHITE_TEXT),onClicked:function(){}.bind(this)});n.addChild(o),o.setScale(e.present.button.scale),o.baseScale=o.scale,o.setPositionRound(e.present.button),t.runAction(new cc.Sequence(new cc.DelayTime(2.1),new cc.ScaleTo(.2,1.2).easing(cc.easeOut(2)),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.simple.urls.metha_present_effect)}),new cc.ScaleTo(.2,1).easing(cc.easeIn(2)),new cc.CallFunc(function(){var e=new FingerView;e.setLocalZOrder(100),s.addChild(e);var t=s.convertToNodeSpace(o.getParent().convertToWorldSpace(o.getPosition()));e.setPositionRound(t),e.delay(.3),
e.fadeIn(new cc.p(0,0)),e.press(),e.delay(.3),e.unPress(),e.delay(.1),e.press(),e.delay(.3),e.unPress(),e.fadeOut(),e.delay(.5),e.run({looped:!0});var i=new cc.Node;i.setAnchorPoint2(),this.addChild(i),i.setLocalZOrder(1e3),i.setContentSize2(this.width,this.height),i.setPositionRound(this.width/2,this.height/2),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(){return!0}.bind(this),onTouchEnded:function(){return this.close(),!0}.bind(this)},i)}.bind(this))))},addProgressBar:function(e,t,i){var s=cleverapps.styles.BackgroundsWindow,n=e.progressBar=new StarsProgressBar({width:s.bar.width,stars:i,current:t,withPresent:!this.options.moveNext&&!cleverapps.simple.isPassedAll()});e.addChild(n),n.setScale(s.bar.scale),n.baseScale=s.bar.scale,n.setPositionRound(s.bar)},addTape:function(e){var t=cleverapps.styles.BackgroundsWindow,i=e.tape=new cc.Sprite(bundles.simple.frames.tape_png);if(i.setLocalZOrder(11),e.addChild(i),
i.setPositionRound(t.tape),i.setRotation(t.tape.rotation),t.tape.text){var s=cleverapps.UI.generateTTFText(Messages.get("messages:BackgroundsWindow.tapeText").toUpperCase(),cleverapps.styles.FONTS.BACKGROUNDS_WINDOW_TAPE_TEXT);s.setLocalZOrder(12),i.addChild(s),s.setRotation(t.tape.text.rotation),s.fitTo(t.tape.text.width),s.setPositionRound(t.tape.text)}},addLayerColor:function(e){var t=cleverapps.styles.BackgroundsWindow;e.layerColor=new cc.LayerColor(cleverapps.styles.COLORS.CLOSED_BACKGROUND_COLOR,t.item.width,t.item.height),e.layerColor.setLocalZOrder(-9),e.addChild(e.layerColor),e.layerColor.setPositionRound(e.width/2-e.layerColor.width/2+t.layerColor.offsetX,e.height/2-e.layerColor.height/2+t.layerColor.offsetY)},addClosedImage:function(e){var t=cleverapps.styles.BackgroundsWindow;e.closedImage=new cc.Sprite(bundles.simple.frames.closed_bg_png),e.closedImage.setLocalZOrder(-9),e.addChild(e.closedImage),e.closedImage.setPositionRound(t.item.bg)},addBg:function(e,t){
var i=cleverapps.styles.BackgroundsWindow,s=new cc.Sprite(bundles["backgrounds_window_"+t].urls.background);s.setLocalZOrder(-10),e.addChild(s),s.setPositionRound(i.item.bg),this.addNameText(e,t)},addNameText:function(e,t){var i=cleverapps.styles.BackgroundsWindow;if(i.name){var s=cleverapps.styles.FONTS.BACKGROUNDS_WINDOW_NAME_TEXT,n="messages:background_name_"+t;t>this.current&&(s=cleverapps.styles.FONTS.BACKGROUNDS_WINDOW_NAME_TEXT_CLOSED);var o=e.name=cleverapps.UI.generateTTFText(n,s);e.addChild(o,11),o.setPositionRound(i.name),t===this.current+1&&e.lock.setPositionRound(i.lockWithName)}},listBundles:function(e){e=e||{};var t=[],i=cleverapps.simple.current+1;e.moveNext&&i++;for(var s=0;s<=i;s++)t.push("backgrounds_window_"+s);return t}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{BACKGROUNDS_WINDOW_TAPE_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:{size:1,color:cleverapps.styles.COLORS.BLACK},shadow:{direction:cc.size(0,-2),color:cleverapps.styles.COLORS.BLACK,
blur:2}},BACKGROUNDS_WINDOW_NAME_COMING_SOON:{size:60,color:new cc.Color(255,232,72,255),stroke:{size:1,color:new cc.Color(198,90,22,255)},shadow:{direction:cc.size(0,-4),color:new cc.Color(198,90,22,255),blur:1}},BACKGROUNDS_WINDOW_TEXT:{size:35,color:cleverapps.styles.COLORS.COLOR_BROWN},BACKGROUNDS_WINDOW_NAME_TEXT:{size:60,color:new cc.Color(255,232,72,255),stroke:{size:1,color:new cc.Color(198,90,22,255)},shadow:{direction:cc.size(0,-4),color:new cc.Color(198,90,22,255),blur:1}},BACKGROUNDS_WINDOW_NAME_TEXT_CLOSED:{size:60,color:new cc.Color(190,209,215,255),stroke:{size:1,color:new cc.Color(108,127,155,255)},shadow:{direction:cc.size(0,-4),color:new cc.Color(108,127,155,255),blur:1}}}),cleverapps.overrideColors(cleverapps.styles.COLORS,{CLOSED_BACKGROUND_COLOR:new cc.Color(0,8,38,255)}),cleverapps.styles.BackgroundsWindow={margin:15,text:{width:500},lock:{x:{align:"center"},y:{align:"center",dy:8}},tape:{x:{align:"right",dx:6},y:{align:"bottom",dy:-2},rotation:0,text:{x:88,y:51,
rotation:-46,width:110}},layerColor:{offsetX:0,offsetY:5},comingSoon:{width:500,x:{align:"center"},y:{align:"center"}},bar:{width:300,scale:.8,x:{align:"center"},y:{align:"bottom",dy:80}},item:{width:600,height:350,imgCur:bundles.simple.frames.frame_gold_png,imgLocked:bundles.simple.frames.frame_silver_png,bg:{padding:{x:13,y:14},x:{align:"center"},y:{align:"center",dy:3}}},scroll:{x:{align:"center"},y:{align:"center",dy:-1},height:810,margin:15,padding:{x:35,y:20},bg:{padding:{x:0,y:6}}},present:{x:{align:"center",dx:0},y:{align:"center",dy:-30},width:200,height:200,scale:1,animation:{scale:.5,x:{align:"center",dx:0},y:{align:"center",dy:0}},button:{width:150,height:80,scale:.7,x:{align:"center"},y:{align:"bottom"}}},window:{Title:{bg:{image:bundles.simple.frames.backgrounds_window_title_bg}},Border:{x:35,y:125},contentOffset:-65}},PackWindow.prototype.generateContent=function(e){var t=cleverapps.styles.PackWindow,i=this.content=new cc.Node;return i.setAnchorPoint2(),
i.setPositionRound({align:"center"},{align:"center"}),i.setContentSize2(t),t.animation&&(i.animation=this.generateAnimation(e,t.animation),i.addChild(i.animation)),t.rewards&&(i.rewards=this.generateRewards(e,t.rewards),i.addChild(i.rewards)),t.discountLabel&&(i.discountLabel=this.generateText(t.discountLabel.text,t.discountLabel),i.addChild(i.discountLabel)),t.Title&&(i.title=this.generateText(e.title,t.Title),i.addChild(i.title)),i.setScale(t.scales[cleverapps.wideMode.mode]),i},PackWindow.prototype.applyTextStyles=function(e,t){e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.split&&e.setString(e.string.split(/\s+/).join("\n")),t.fontSize&&e.setFontSize(t.fontSize),t.fitTo&&e.fitTo(t.fitTo.width,t.fitTo.height),t.dimension&&e.setDimensions(t.dimension.width,t.dimension.height),t.lineHeight&&e.setLineHeight(t.lineHeight),t.rotation&&e.setRotation(t.rotation)},PackWindow.prototype.generateAnimation=function(e,t){t=cleverapps.extend({},t.default||{},t[e.product]||{})
;var i=new cleverapps.Spine(bundles[e.bundle].jsons.pack_json,1);return i.setAnchorPoint2(),i.setPositionRound({align:"center",dx:t.dx||0},{align:"center",dy:t.dy||0}),t.introAnimation?(i.setAnimation(0,t.introAnimation,!1),i.addAnimation(0,t.idleAnimation,!0,t.idleDelay||0)):i.setAnimation(0,t.idleAnimation,!0),i},PackWindow.prototype.generateText=function(e,t){var i=cleverapps.UI.generateTTFText(e,t.font);return i.comingInDelay=t.delay,this.applyTextStyles(i,t),i.setAnchorPoint2(),i.setPositionRound({align:"center",dx:t.dx||0},{align:"center",dy:t.dy||0}),i},PackWindow.prototype.generateRewards=function(e,s){s=cleverapps.clone(s);var t=cleverapps.extend({},s.positions.default||{},s.positions[e.product]||{}),n=new cc.Node;n.setAnchorPoint2(),n.setPositionRound({align:"center"},{align:"center"});var i=function(e,t){var i=new cleverapps.UI.generateTTFText(e,s.font);i.comingInDelay=t.delay,s.split=t.split,s.rotation=t.rotation,this.applyTextStyles(i,s),i.setAnchorPoint2(),
i.setPositionRound(t),n.addChild(i)};for(var o in e.reward){var a=e.reward[o],r=t[o];if(void 0!==r)if("boosters"===o)for(var l in a){var c=a[l],p=r[l];void 0!==p&&i.call(this,"x"+c,p)}else i.call(this,"unlimitedLives"===o?Product.FormatUnlimitedLives(a).title:"x"+a,r)}return n},PackWindow.prototype.onShow=function(){cleverapps.styles.PackWindow.onShow.call(this)},PackWindow.prototype.customize=function(){},PackWindow.prototype.setButtonContent=function(e){var t=cleverapps.styles.PackWindow.button,i=new Product(this.pack.product);e.content=this.generateButtonText(i),e.content.content.setPositionRound(e.content.width/2,e.content.height/2+(t.priceAlignment||0))},PackWindow.simpleOnShow=function(){var e=this.content,t=function(e){e.setVisible(!1),e.runAction(cc.sequence(cc.delayTime(e.comingInDelay||0),cc.show()))};cleverapps.audio.playSound(bundles.main.urls.open_window_effect),e.rewards&&e.rewards.children.forEach(t),e.discountLabel&&t(e.discountLabel),e.title&&t(e.title)},
PackWindow.fadeInOnShow=function(){var e=this.content,t=function(e){e.setOpacity(0),e.runAction(cc.sequence(cc.delayTime(e.comingInDelay||0),cc.fadeIn(.675)))};cleverapps.audio.playSound(bundles.main.urls.open_window_effect),e.rewards&&e.rewards.children.forEach(t),e.discountLabel&&t(e.discountLabel),e.title&&t(e.title)},PackWindow.caseOnShow=function(){var e=this.content;e.title&&e.rewards&&(e.title.setVisible(!1),e.rewards.children.forEach(function(e){e.setOpacity(0)}),this.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){cleverapps.audio.playSound(bundles.main.urls.casestarter_pack_sfx)}),cc.delayTime(.5),cc.callFunc(function(){e.title.setVisible(!0)}),cc.delayTime(1.55),cc.callFunc(function(){e.rewards.children.forEach(function(e){e.runAction(cc.fadeIn(.475))})}))))},cleverapps.styles.COLORS=cleverapps.overrideColors(cleverapps.styles.COLORS,{PACKWINDOW_TITLE_YELLOW:new cc.Color(249,205,23,255),PACKWINDOW_TITLE_SHADOW:new cc.Color(97,47,1,255),
PACKWINDOW_PRICE_STROKE:new cc.Color(9,88,3,255)}),cleverapps.styles.DECORATORS=cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{PACKWINDOW_TITLE_STROKE:{size:3,color:cleverapps.styles.COLORS.PACKWINDOW_TITLE_SHADOW},PACKWINDOW_BUTTON_STROKE:{size:3,color:cleverapps.styles.COLORS.PACKWINDOW_PRICE_STROKE},PACKWINDOW_LABEL_STROKE:{color:cleverapps.styles.COLORS.BLACK,size:3}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{PACKWINDOW_TITLE_TEXT:{size:70,color:cleverapps.styles.COLORS.PACKWINDOW_TITLE_YELLOW,stroke:cleverapps.styles.DECORATORS.PACKWINDOW_TITLE_STROKE},PACKWINDOW_BUTTON_TEXT:{size:60,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.PACKWINDOW_BUTTON_STROKE},PACKWINDOW_LABEL_TEXT:{size:80,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.PACKWINDOW_LABEL_STROKE},PACK_LABELS:{size:77,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.MESSAGE_RED_STROKE}}),cleverapps.overrideStyles(
cleverapps.styles.PackWindow,{width:440,height:750,scales:[.85,1,1],Title:void 0,discountLabel:void 0,animation:void 0,rewards:void 0});var DraugiemProducts={buyExp10:3750,buyExp150:3751,addMoves1:3741,addMoves2:3752,addMoves3:3753,addMoves5:3754,piggybank500:3755,piggybank1800:3756,piggybank6000:3757,piggybank25000:3758,gunShot:3759,gold500:3768,gold1800:3774,gold3800:3747,gold6000:3775,gold25000:3746,starterPack0:3740,starterPack:3748,starterPack2:3749,colorPack10:3742,cellPack2:3767,linePack3:3770,colorPack4:3771,battlepass:3824,unlimitedLives:3769,sweetPack:3772,jamPack:3761,tastyPack:3764,honeyPack:3762,epicPack:3763,lives074:3878,lives3:3890,exp1:3886,exp4:3892,unlimitedLives05:3885,unlimitedLives2:3888};TreasureSearchWindow.prototype.createActiveCellContent=function(e,t,i){},TreasureSearchWindow.prototype.generateContent=function(){var e=cleverapps.styles.TreasureSearchWindow.content,t=this.createGame(),i=cleverapps.UI.generateTTFText("messages:TreasureSearchWindow.text",
cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);i.setDimensions(t.width*e.text.widthMultiplier[cleverapps.wideMode.mode],0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var s=new cc.Node;if(s.setAnchorPoint2(),s.setContentSize2(1.05*i.width,1.15*i.height),s.addChild(i),i.setPositionRound(s.width/2,s.height/2),this.bundle.frames.speech_bubble_png||bundles.main.frames.tournamentstory_bg){var n=cleverapps.UI.createScale9Sprite(this.bundle.frames.speech_bubble_png||bundles.main.frames.tournamentstory_bg);n.setContentSize(s.getContentSize()),s.addChild(n),n.setPositionRound(s.width/2,s.height/2),n.setLocalZOrder(-1)}this.content=new cleverapps.Layout([s,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:e.padding})},TreasureSearchWindow.prototype.createShovelsNode=function(){var e=cleverapps.styles.TreasureSearchWindow.content.shovel,t=new cc.Node;t.setAnchorPoint2(),t.setAnchorPoint2();var i=new cc.Sprite(this.bundle.frames.shovel);t.setContentSize2(i.getContentSize()),
t.addChild(i),i.setPosition(t.width/2,t.height/2);var s=this.amountText=cleverapps.UI.generateTTFText(this.game.mission.currency,cleverapps.styles.FONTS.SHOVEL_FONT);if(t.addChild(s),s.setPositionRound(e.amount),s.setLocalZOrder(2),t.setAnchorPoint2(0,0),this.bundle.frames.amount_bg){var n=new cc.Sprite(this.bundle.frames.amount_bg);t.addChild(n),n.setPositionRound(s.x+e.amountBg.offset.x,s.y+e.amountBg.offset.y),n.setLocalZOrder(1)}return cleverapps.tooltipManager.create(t,{text:Messages.get("ShovelsTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.below}),t},TreasureSearchWindow.prototype.addCustomBg=function(){var e=cleverapps.styles.TreasureSearchWindow;this.closeButton.setLocalZOrder(2),this.content.setLocalZOrder(1);var t=new cc.Sprite(this.bundle.frames.bg);this.window.addChild(t),t.setPosition(this.window.width/2,this.window.height-t.height/2+e.bg.y),t.setLocalZOrder(0);var i=(this.window.width+e.bg.padding)/t.width;t.setScaleX(i);var s=new cc.Sprite(
this.bundle.frames.bg_left);this.window.addChild(s),s.setPositionRound(e.bg.left.x,t.y-1.1*t.height*this.content.scale);var n=new cc.Sprite(this.bundle.frames.bg_right);this.window.addChild(n),n.setPositionRound(this.window.width+e.bg.right.x,t.y-t.height)},TreasureSearchWindow.prototype._customize=TreasureSearchWindow.prototype.customize,TreasureSearchWindow.prototype.customize=function(){this._customize(),this.addCustomBg();var e=cleverapps.styles.TreasureSearchWindow;this.fieldNode.setSkewY(e.skew),this.fieldNode.setRotation(e.skew);var t=.7*this.window.width/(this.fieldNode.width*this.content.scale);t<1&&this.fieldNode.setScale(t);for(var i=0;i<this.field.length;i++)for(var s=0;s<this.field[i].length;s++)this.game.hasElement(s,i)||this.createOpenedCellContent(s,i,this.field[i][s],!1,!0);var n=this.createShovelsNode(),o=this.window.width/(this.infoNode.width*this.content.scale);o<1&&(this.infoNode.setScale(o),n.setScale(.85*o)),this.window.addChild(n),n.setPositionRound(
e.content.shovel)},TreasureSearchWindow.prototype.processPointer=function(){this.pointer||(this.pointer=new cleverapps.Spine(this.bundle.jsons.hover,1),this.pointer.setLocalZOrder(21),this.pointer.setAnimation(0,"idle",!0),this.content.addChild(this.pointer));var e=this.field[this.index.row][this.index.col];this.pointer.setPositionRound(this.getPositionInContent(e)),this.pointer.setVisible(!0)},TreasureSearchWindow.prototype.createGameInfo=function(){for(var e=cleverapps.styles.TreasureSearchWindow.game.infoNode,t=this.flowers=[],i=0;i<TreasureSearch.GEMS;i++){var s=new cc.Node;s.setAnchorPoint2(),s.setLocalZOrder(TreasureSearch.GEMS-i),s.setContentSize2(e.flowerNode),t.push(s);var n=new cleverapps.Spine(this.bundle.jsons.holder,1);n.setPosition(s.width/2,s.height/2+e.flowerNode.flower.y),s.addChild(n),s.animation=n,this.game.mission.result<=i?n.setAnimation(0,"glass_empty",!0):n.setAnimation(0,"glass_idle",!0)}var o=new cleverapps.Layout(t,{direction:cleverapps.UI.HORIZONTAL}),
a=new cc.Node;a.setAnchorPoint2(),a.setContentSize2(e.prize);var r=this.prizeBox=new cleverapps.Spine(this.bundle.jsons.prize,1);r.setAnimation(0,"red_idle_closed",!0),r.setPosition(a.width/2,a.height/2),a.addChild(r),cleverapps.tooltipManager.create(a,{rewards:this.game.getReward(),text:Messages.get("TreasureSearch.prizeTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.below}),cleverapps.UI.applyHover(a),cleverapps.UI.onClick(a,this.onClickHelp.bind(this));var l=new cc.Node;return l.setAnchorPoint2(),l.setContentSize2(e),o.setPositionRound(e.flowerNode),a.setPositionRound(e.prize),l.addChild(o),l.addChild(a),l},TreasureSearchWindow.prototype.onClickHelp=function(){new TellWindow({type:"gardenHelp",text:"messages:TreasureSearchWindow.Help.Text",title:"messages:TreasureSearchWindow.Help.Title"})},TreasureSearchWindow.prototype._createCell=TreasureSearchWindow.prototype.createCell,TreasureSearchWindow.prototype.createCell=function(){var e=this._createCell(),t=new cc.Sprite(
this.bundle.frames.tile);return t.setPosition(e.width/2,e.height/2),e.addChild(t),e},TreasureSearchWindow.prototype.createOpenedCellContent=function(e,t,i,s,n){if(!s){var o=new cleverapps.Spine(this.bundle.jsons.weed,1);o.setLocalZOrder(TreasureSearch.HEIGHT*TreasureSearch.WIDTH-(e+t*TreasureSearch.HEIGHT)),o.setPosition(this.getPositionInContent(i)),this.content.addChild(o),o.runAction(new cc.Sequence(new cc.DelayTime(n?0:.7),new cc.CallFunc(function(){n?o.setAnimation(0,"idle",!0):(o.setAnimation(0,"animation",!1),o.addAnimation(0,"idle",!0))})))}},TreasureSearchWindow.prototype._open=TreasureSearchWindow.prototype.open,TreasureSearchWindow.prototype.open=function(e){this._open(e);var t=this.field[e.row][e.col];t.runAction(new cc.Sequence(new cc.DelayTime(this.game.gemWasThere(e.col,e.row)?1.3:0),new cc.CallFunc(function(){this.createOpenedCellContent(e.col,e.row,t)}.bind(this))))},TreasureSearchWindow.prototype.prize=function(e){var t=this.field[e.row][e.col],
i=this.getPositionInContent(t),s=this.flowers[e.score-1],n=cc.p(this.content.width/2,this.content.height),o=this.getPositionInContent(s);this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){var e=new cleverapps.Spine(this.bundle.jsons.holder,1);e.setPosition(i.x,i.y+cleverapps.styles.TreasureSearchWindow.content.flower.y),e.setAnimation(0,"in",!1),e.setLocalZOrder(22),this.content.addChild(e),e.setCompleteListener(function(){e.setAnimation(0,"glass_in",!1),e.setCompleteListener(function(){}),cleverapps.audio.playSound(bundles.main.urls.treasure_search_found_effect),s.animation.setAnimation(0,"empty_out",!1),s.animation.setCompleteListener(function(){s.animation.setCompleteListener(function(){}),s.animation.setVisible(!1)})}),e.runAction(new cc.Sequence(new cc.DelayTime(1.5),new cc.BezierTo(.7,[e.getPosition(),n,o]),new cc.CallFunc(function(){s.animation.setAnimation(0,"glass_idle",!0),e.runAction(new cc.RemoveSelf)})))}.bind(this))))},
TreasureSearchWindow.prototype.finish=function(e){var t=this.getPositionInContent(this.prizeBox);this.prizeBox.removeFromParent(),this.prizeBox.setPosition(t),this.content.addChild(this.prizeBox);var i=cc.p(this.content.width/2,1.1*this.content.height),s=cc.p(this.content.width/2,.55*this.content.height);this.runAction(new cc.Sequence(new cc.DelayTime(e&&e.silent?0:2.7),new cc.CallFunc(function(){this.prizeBox.setLocalZOrder(22),this.prizeBox.runAction(new cc.Spawn(new cc.BezierTo(.6,[t,i,s]),new cc.Sequence(new cc.DelayTime(.37),new cc.CallFunc(function(){this.prizeBox.setAnimation(0,"red_open",!1)}.bind(this)),new cc.DelayTime(.55),new cc.CallFunc(function(){this.close()}.bind(this)))))}.bind(this))))},cleverapps.overrideStyles(cleverapps.styles.TreasureSearchWindow,{skew:10,bg:{y:-126,padding:-20,left:{x:179},right:{x:-213}},content:{margin:25,shovel:{amount:{x:{align:"right",dx:-20},y:{align:"bottom",dy:-30}},x:{align:"right",dx:-20},y:{align:"center",dy:-140}},flower:{y:30}},
game:{margin:20,field:{padding:{x:0,y:10}},cell:{width:120,height:80},infoNode:{width:810,height:246,margin:20,padding:{x:35,y:0},prize:{x:{align:"right",dx:0},y:{align:"center",dy:-10},width:200,height:200},flowerNode:{x:{align:"left",dx:100},y:{align:"center"},width:130,height:245,flower:{y:-30}}}},window:{contentOffset:-30,Border:{y:50}}}),cleverapps.styles.comicses={begin:{stages:[{showAnimation:"trans_1",idleAnimation:"idle_1",dialogueStages:1},{showAnimation:"trans_2",idleAnimation:"idle_2",dialogueStages:1},{showAnimation:"trans_3",idleAnimation:"idle_3",dialogueStages:5}],dialogue:[{text:"messages:Comics.Begin.Text1",person:!1},{text:"messages:Comics.Begin.Text2",person:!1},{text:"messages:Comics.Begin.Text3",person:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{animation:"normal",position:"right",styles:{json:bundles.dialogues.jsons.dialogue_yellow_json,title:"messages:Yellow.Name"}},!0)},{text:"messages:Comics.Begin.Text4",
person:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{animation:"normal",position:"left",styles:{json:bundles.dialogues.jsons.dialogue_purple_json,title:"messages:Purple.Name",height:260}},!0)},{text:"messages:Comics.Begin.Text5",person:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{animation:"normal",position:"right",styles:{json:bundles.dialogues.jsons.dialogue_red_json,title:"messages:Red.Name"}},!0)},{text:"messages:Comics.Begin.Text6",person:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{animation:"normal",position:"left",styles:{json:bundles.dialogues.jsons.dialogue_green_json,title:"messages:Green.Name",height:220}},!0)},{text:"messages:Comics.Begin.Text7",person:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{animation:"normal",position:"right",styles:{json:bundles.dialogues.jsons.dialogue_purple_json,title:"messages:Purple.Name",height:260}},!0)}],bundles:["comicses"],
json:bundles.comicses.jsons.begin_json,onFinish:"game"}},cleverapps.SCENE_HORIZONTAL_BG_DX=8,cleverapps.styles.COLORS=cleverapps.overrideColors(cleverapps.styles.COLORS,{MOVES_DANGER:new cc.Color(255,0,0,255),PATH_COLOR:new cc.Color(255,230,180,255),LETTER:new cc.Color(94,24,89,255),COLOR_LIGHTBROWN:new cc.Color(200,171,124,255),COLOR_LIGHT_WINDOW_TEXT:new cc.Color(160,100,70,255),COLOR_EXTRA:new cc.Color(0,76,118,255),COLOR_VICTORY:new cc.Color(253,217,61,255),COLOR_LIGHT_SKY_BLUE:new cc.Color(107,222,255,255),HELP_BUTTON_STROKE_COLOR:new cc.Color(21,60,3,255),COLOR_GREEN_STROKE:new cc.Color(129,190,1,255),GOAL_NOT_DONE_COLOR:new cc.Color(255,100,100,255),GOLDVIEW_HINT_COLOR:new cc.Color(130,70,40,255),MOUSE_LIFE_COLOR:new cc.Color(130,70,40,255),BOMB_TIMER_COLOR:new cc.Color(130,70,40,255),BOMB_TIMER_DANGER_COLOR:new cc.Color(255,50,50,255),HARD:new cc.Color(255,241,226,255),CLOVER_COLOR:new cc.Color(36,203,114,255),CELL_COLORS:{a:new cc.Color(20,160,237,255),b:new cc.Color(20,200,0,
255),c:new cc.Color(195,61,225,255),d:new cc.Color(255,11,28,255),e:new cc.Color(234,199,48,255),w:new cc.Color(50,200,255,255)},BLUE:new cc.Color(54,97,175,255),HARD_LEVEL_TITLE_YELLOW:new cc.Color(255,216,0,255)}),cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{EXTRA_TITLE_STROKE:{color:cleverapps.styles.COLORS.COLOR_EXTRA,size:5},LEVEL_STROKE:{color:new cc.Color(124,108,100,255),size:1},MISSION_RULES_STROKE:{color:new cc.Color(160,70,87,255),size:4},DAILY_TASKS_TIMER_STROKE:{color:new cc.Color(127,71,46,255),size:4},CLOVER_VICTORY_STROKE:{color:new cc.Color(121,94,46,255),size:2},VICTORY_STROKE:{color:new cc.Color(224,108,7,255),size:1},BROWN_TEXT_STROKE:{color:new cc.Color(255,255,255,150),size:2},BROWN_2_STROKE:{color:cleverapps.styles.COLORS.COLOR_BROWN,size:2},GREEN_TEXT_STROKE:{color:cleverapps.styles.COLORS.COLOR_GREEN_STROKE,size:2},RED_TEXT_STROKE:{color:cleverapps.styles.COLORS.COLOR_RED,size:2},WHITE_TEXT_SHADOW:{color:new cc.Color(0,0,0,120),direction:cc.size(0,-4
),blur:1},GAMESCENE_TEXT_SHADOW:{color:cleverapps.styles.COLORS.BLACK,direction:cc.size(0,-1),blur:2},BOOSTER_AMOUNT_STROKE:{color:new cc.Color(0,81,19,255),size:3},MOVES_DEC_STROKE:{color:new cc.Color(128,0,0,255),size:3},SPECIAL_MINI_GAME_AMOUNT_STROKE:{color:new cc.Color(66,179,244,255),size:2}}),cleverapps.styles.FONTS=cleverapps.overrideFonts(cleverapps.styles.FONTS,{MISSION_RULES_BUTTON_TEXT:{size:64,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.MISSION_RULES_STROKE},STORY_TUTORIAL_SMALL_TEXT:{size:40,color:cleverapps.styles.COLORS.GOLDVIEW_HINT_COLOR},LEVEL_TUTORIAL_SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.GOLDVIEW_HINT_COLOR},LEVEL_TUTORIAL_TEXT:{size:40,color:cleverapps.styles.COLORS.GOLDVIEW_HINT_COLOR},LEVEL_TUTORIAL_TEXT_2:{size:40,color:new cc.Color(50,137,182,255)},EDITOR_RED_TEXT:{size:40,color:cleverapps.styles.COLORS.COLOR_RED},INCDECBLOCK_AUTO_TEXT:{size:32,color:cleverapps.styles.COLORS.MESSAGE_GREEN},EDITOR_BLACK_TEXT:{size:50,
color:cleverapps.styles.COLORS.BLACK},EDITOR_FIELD_TEXT:{size:20,color:cleverapps.styles.COLORS.BLACK},FIELD_SCORE_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.BROWN_TEXT_STROKE},SHARE_BUTTON_REWARD_TEXT:{size:35,color:cleverapps.styles.COLORS.WHITE},HIGHSCORE_INVITE_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE},WINDOW_LIGHT_TEXT:{size:40,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},ADDMOVES_PRICE:{size:40,color:cleverapps.styles.COLORS.COLOR_LIGHT_WINDOW_TEXT},TILE_SHOP_SPECIAL_OFFER_IMAGE_TEXT:{prefix:"shop_digits#shop_digit_",color:cleverapps.styles.COLORS.WHITE},LIVES_SHOP_TIMER_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.DARK_OLIVE_GREEN_STROKE},SHOP_USER_GOLD_TEXT:{size:52,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT,prefix:"digits#timer_digit_"},VICTORY_CHEST_TEXT:{prefix:"digits#timer_digit_",scale:.85,size:50,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},
TOURNAMENTSTORY_OFFERS_MAIN_TEXT:{size:34,color:cleverapps.styles.COLORS.BLUE},TOURNAMENTSTORY_ARROW_TEXT:{size:32,color:cleverapps.styles.COLORS.BLUE},TOURNAMENTSTORY_INFO_DOWN_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE},VERY_BIG_TEXT:{size:80,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.DARK_OLIVE_GREEN_STROKE},BIG_TEXT:{size:85,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.DARK_OLIVE_GREEN_STROKE},EPISODE_TITLE_TEXT:{size:80,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},EXTRA_TITLE_TEXT:{size:50,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},DESCRIPTION_TEXT:{size:23,color:cleverapps.styles.COLORS.COLOR_LIGHTBROWN},ADDMOVES_GOAL_RED_TEXT:{size:40,color:cleverapps.styles.COLORS.GOAL_NOT_DONE_COLOR},DAILY_TASKS_TIMER_TEXT:{size:46,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.DAILY_TASKS_TIMER_STROKE},HARD_LEVEL_TITLE:{size:60,color:cleverapps.styles.COLORS.HARD_LEVEL_TITLE_YELLOW,
stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},DEC_MOVES_TEXT:{size:60,color:cleverapps.styles.COLORS.COLOR_RED,stroke:cleverapps.styles.DECORATORS.MOVES_DEC_STROKE},INC_MOVES_TEXT:{size:60,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.RED_TEXT_STROKE},MINI_GAME_AMOUNT_TEXT:{size:45,color:cleverapps.styles.COLORS.MINI_GAME_TEXT_COLOR},MINI_GAME_SCENE_TEXT:{size:35,color:cleverapps.styles.COLORS.MINI_GAME_TEXT_COLOR},MISSION_MINI_GAME_REWARD_WINDOW_TEXT:{size:45,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.WINDOW_TITLE_STROKE},DIALOGUE_PERSON_TITLE_TEXT:{color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},SHOVEL_FONT:{prefix:"digits#timer_digit_",scale:.8,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},SUBSCRIPTION_BUTTON_SMALL_TEXT:{size:36,color:cleverapps.styles.COLORS.WHITE},SUBSCRIPTION_BUTTON_TEXT:{size:44,color:cleverapps.styles.COLORS.WHITE},SUBSCRIPTION_OFFERS_MAIN_TEXT:{size:33,color:cleverapps.styles.COLORS.WHITE
},SUBSCRIPTION_OFFERS_TEXT:{size:22,color:cleverapps.styles.COLORS.WHITE},SUBSCRIPTION_MAIN_TEXT:{size:25,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},SUBSCRIPTION_REWARD_READY_TEXT:{size:34,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},SUBSCRIPTION_BUTTON_ADDITIONAL_TEXT:{size:18,color:cleverapps.styles.COLORS.GUN_PRICE_FONT_COLOR},SUBSCRIPTION_ICON_TEXT:{size:23,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},REWARD_ELEMENT_TEXT:{prefix:"booster_digit_",size:40,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.FONTS.BOOSTERS_SALE_WINDOW_TITLE_TEXT=cleverapps.styles.FONTS.DAILY_TOURNAMENT_TITLE_TEXT,cleverapps.styles.UI.FieldView={margins:[{top:230,bottom:230,left:2,right:2},{top:225,bottom:30,left:80,right:230},{top:8,bottom:8,left:240,right:220}]},cleverapps.styles.UI.BoostersPositions=[[{x:{align:"center",dx:-110},y:{align:"center",dy:-8}},{x:{align:"center",dx:48},y:{align:"center",dy:-8}},{x:{align:"center",dx:206},y:{align:"center",dy:-8}}],[{x:{align:"center"
},y:{align:"center",dy:160}},{x:{align:"center"},y:{align:"center",dy:-5}},{x:{align:"center"},y:{align:"center",dy:-170}}],[{x:{align:"center"},y:{align:"center",dy:160}},{x:{align:"center"},y:{align:"center",dy:-5}},{x:{align:"center"},y:{align:"center",dy:-170}}]],cleverapps.styles.UI.Border=[[{x:-17,y:-43},{x:-7,y:-43},{x:-7,y:-43}],[{x:-43,y:-7},{x:-43,y:-7},{x:-43,y:-17}],[{x:-7,y:-67},{x:-7,y:-77},{x:-17,y:-67}],[{x:-67,y:-17},{x:-77,y:-7},{x:-67,y:-7}]],cleverapps.overrideStyles(cleverapps.styles.UI.RewardElementView,{width:125,height:125,image:{scale:.9},text:{scale:1,x:25,y:-25},positions:[{x:{align:"center",dx:320},y:{align:"center",dy:79}},{x:{align:"center",dx:320},y:{align:"center",dy:79}},{x:{align:"center",dx:46},y:{align:"center",dy:-190}}],background:[{scale9:cleverapps.UI.Scale9Rect.TwoPixelXY,height:125,width:125,image:"goal_common_bg"},{scale9:cleverapps.UI.Scale9Rect.TwoPixelXY,height:125,width:125,image:"goal_common_bg"},{
scale9:cleverapps.UI.Scale9Rect.TwoPixelXY,height:125,width:125,image:"goal_common_bg"}],scale:[1,1,1],TulpanTournament:{icon:{x:0,y:3}}}),cleverapps.override(cleverapps.styles.LevelView,{coming_soon:[{x:40,y:-500}],betweenEpisodesFlag:{spine:res.between_episodes_json,passed:"flag2",notpassed:"flag1",levels_1:{default:{x:245,y:690}},levels_2:{default:{x:-260,y:690}}},levels_1:[{x:-210,y:-490},{x:-84,y:-428},{x:59,y:-382},{x:186,y:-306},{x:254,y:-190},{x:220,y:-64},{x:96,y:2},{x:-40,y:26},{x:-170,y:76},{x:-256,y:174},{x:-220,y:282},{x:-106,y:350},{x:28,y:388},{x:158,y:434},{x:244,y:530}],levels_2:[{x:210,y:-490},{x:80,y:-422},{x:-60,y:-376},{x:-188,y:-298},{x:-256,y:-180},{x:-220,y:-56},{x:-104,y:8},{x:36,y:32},{x:164,y:80},{x:254,y:184},{x:200,y:306},{x:72,y:364},{x:-60,y:404},{x:-184,y:456},{x:-256,y:546}]}),cleverapps.styles.Goals={singleItem:{width:100,height:120,scaleX:-.85,scaleY:.85,icon:{x:0,y:0},amount:{x:40,y:30},withTournament:{width:60,height:100,scaleX:-.75,scaleY:.75,
icon:{x:0,y:0},amount:{x:28,y:30}},no_moves:{width:100,height:120,scaleX:-1,scaleY:1,icon:{x:0,y:0},amount:{x:54,y:-10,scale:1.3}}},bgTitle:{image:bundles.game.frames.goals_title,image_ru:bundles.game.frames.goals_title_ru,position:[{x:{align:"center",dx:0},y:{align:"top",dy:13}},{x:{align:"center",dx:0},y:{align:"top",dy:13}},{x:{align:"right",dx:40},y:{align:"center",dy:0},rotation:90,scale:.8}]},positionNoMission:[{x:{align:"center",dx:77},y:{align:"center",dy:15}},{x:{align:"center",dx:77},y:{align:"center",dy:15}},{x:{align:"center",dx:-20},y:{align:"center",dy:-85},rotation:-90}],positionWithMission:[{x:{align:"center",dx:10},y:{align:"center",dy:15}},{x:{align:"center",dx:10},y:{align:"center",dy:15}},{x:{align:"center",dx:-17},y:{align:"center",dy:-25},rotation:-90}],sizes:{noMission:[{height:133,width:480},{height:133,width:480},{height:135,width:440}],withMission:[{height:125,width:350},{height:125,width:350},{height:125,width:330}]}},cleverapps.overrideStyles(
cleverapps.styles.EpisodeView,{fingerTip:!0}),cleverapps.overrideStyles(cleverapps.styles.LevelView,{PlayerViewLeft:{x:130,y:-20,scale:.7},PlayerViewRight:{x:-20,y:-20,scale:.7},PlayerViewLeft0:{x:140,y:40,scale:.7},PlayerViewRight0:{x:-45,y:40,scale:.7},leftLevels:[1,2,3,4,5,11,12,13,14],playerLeftLevels:[0,1,2,3,9,10,11,12,13],hideHardLevelNo:!0}),cleverapps.extend(cleverapps.styles.FinisherWindow,{padding:{x:0,y:45},Text:{font:cleverapps.styles.FONTS.WINDOW_TEXT,paddingTop:10,paddingBottom:10,width:600},Button:{width:380,height:100},width:650,height:750}),cleverapps.overrideStyles(cleverapps.styles.FinishEpisodeWindow,{width:600,padding:{y:55},animation:{height:300,json:bundles.finish_episode_window.jsons.episode_completed_json,y:295}}),cleverapps.overrideStyles(cleverapps.styles.RewardsListComponent,{stars:{title:{y:-36},scale:1},gun:{y:-30,x:-100,scale:1.4}}),cleverapps.overrideStyles(cleverapps.styles.VictoryWindowButton,{width:280,height:110}),cleverapps.overrideStyles(
cleverapps.styles.BaseBoosterView,{amount:{x:-32,y:26},price:{x:0,y:19},background:[{scale9:cleverapps.UI.Scale9Rect.TwoPixelXY,width:150,height:150},{scale9:cleverapps.UI.Scale9Rect.TwoPixelXY,width:150,height:150},{scale9:cleverapps.UI.Scale9Rect.TwoPixelXY,width:150,height:150}],locked:{x:{align:"center"},y:{align:"center"}}}),cleverapps.overrideStyles(cleverapps.styles.UI.MovesView,{scale:[1,1,1],text:{margin:{x:0,y:12}},icon:{x:{align:"center"},y:-36}}),cleverapps.overrideStyles(cleverapps.styles.BaseGoalView,{imageFont:{prefix:"digits_game#goals_digit_"}}),cleverapps.overrideStyles(cleverapps.styles.GunView,{scale:[1.2,1.3,1.3],animation:{x:{align:"center",dx:-50},y:{align:"center",dy:-30}},position:[{x:{align:"left",dx:-15},y:{align:"top",dy:-114}},{x:{align:"left",dx:30},y:{align:"top",dy:-40}},{x:{align:"left",dx:30},y:{align:"top",dy:-40}}],price:{position:[{x:{align:"left",dx:30},y:30},{x:{align:"left",dx:30},y:-20},{x:{align:"left",dx:30},y:-20}]},size:{width:154,height:154
}}),cleverapps.overrideStyles(cleverapps.styles.MissionAnimationView,{flyTo:{second:{y:15}}}),cleverapps.overrideStyles(cleverapps.styles.HardLevelDecorationComponent,{on:{hard_level_title_bg:!0,hl_animation_left:!0,hl_animation_right:!0,hard_level_fire:!0},off:{leaves_left:!0,leaves_right:!0}}),cleverapps.overrideStyles(cleverapps.styles.FireworkCellView,{bomb:{startDY:40}}),cleverapps.overrideStyles(cleverapps.styles.DailyCupScene,{title:{x:{align:"center",dx:0},y:{align:"center",dy:10},width:520,height:100},titleBg:{x:{align:"center",dx:0},y:{align:"top",dy:-148},width:670,height:120,useRibbonTitle:!0,scaleY:1.2}}),cleverapps.overrideStyles(cleverapps.styles.FingerView,{deltaXforCircle:16}),cleverapps.overrideStyles(cleverapps.styles.BoostersSaleWindow,{icons:{rotation:10},title:{ribbonTitle:{offsetX:70}},row:{padding:[{x:35,y:20},{x:35,y:20},{x:35,y:20}]},rowMargin:4,progressBar:{width:336,bar:{x:0,y:0},textMargin:10,descriptionText:{width:[520,600,600],height:70,marginY:40},
prize:{width:100,height:100,x:60,y:30,scale:1.5},scale:[.8,1,1]},window:{Title:{bg:!1}}}),cleverapps.overrideStyles(cleverapps.styles.HeroesScene,{background:{animation:bundles.heroes_backgrounds.jsons.heroes_bg_json}}),cleverapps.overrideStyles(cleverapps.styles.DialogueView,{persons:{default:{styles:{offsetX:0}}}}),cleverapps.overrideStyles(cleverapps.styles.UI.MovesView,{locked:{image:bundles.game.frames.locked_flower}}),cleverapps.overrideStyles(cleverapps.styles.CanUpgradeHeroWindow,{heroes:[{x:-70,y:136,scale:1.1},{x:70,y:136,scale:1.1},{x:-150,y:50,scale:1.25},{x:150,y:50,scale:1.25},{x:-76,y:-50,scale:1.4},{x:76,y:-50,scale:1.4}]}),cleverapps.overrideStyles(cleverapps.styles.ShopUserGoldView,{items:{gold:{dy:-2},boosters:{dy:0}}}),Field.SHOW_UP_ANIMATION_START_DELAY=0,cleverapps.overrideStyles(cleverapps.styles.ProlongationWindow,{alert:{askIconAnimation:"animation2"}}),cleverapps.overrideStyles(cleverapps.styles.ComicsScene,{createFilmEffect:{layerSizeKoef:0},dialogue:{
offsetY:50}}),cleverapps.overrideStyles(cleverapps.styles.PagesView,{maxWidth:1500}),cleverapps.overrideStyles(cleverapps.styles.RaffleWindow,{padding:{y:70},description:{subTitleWidth:620},tickets:{bar:{offsetY:3,amount:{x:{align:"center",dx:19},y:{align:"bottom",dy:8}}}}}),cleverapps.overrideStyles(cleverapps.styles.RaffleRulesWindow,{animation:{height:720},subText:{left:{y:{align:"top",dy:-275}},right:{y:{align:"top",dy:-250}},bottom:{y:{align:"center",dy:-360}}}}),cleverapps.overrideStyles(cleverapps.styles.RaffleChangeView,{alignment:{x:{align:"center",dx:-300},y:{align:"bottom",dy:200}}}),cleverapps.overrideStyles(cleverapps.styles.ConfirmExitWindow,{height:730,text:{x:0,y:140},breakView:{y:115}}),cleverapps.overrideStyles(cleverapps.styles.SmallTileButton,{text:{padding:-70}}),cleverapps.overrideStyles(cleverapps.styles.SubscriptionButtons,{shiftY:20}),cleverapps.overrideStyles(cleverapps.styles.TellWindow,{padding:{y:[50,50,50]}}),cleverapps.overrideStyles(
cleverapps.styles.GingerHouseCellView,{imageOffsets:{0:{x:0,y:-47},1:{x:-42,y:-63},2:{x:48,y:-56},3:{x:0,y:47}}}),cleverapps.overrideStyles(cleverapps.styles.MedallionComponent,{positions:[{x:{align:"left",dx:10},y:{align:"top",dy:350}},{x:{align:"left",dx:65},y:{align:"top",dy:230}},{x:{align:"left",dx:170},y:{align:"top",dy:230}}]}),cleverapps.overrideStyles(Forces.GUN.Finger,{startY:60,x:110,y:90}),cleverapps.overrideStyles(cleverapps.styles.TreasureSearchWindow,{window:{Background:{image:bundles.treasuresearch.frames.win_bg},Title:{bg:void 0}}}),cleverapps.override(cleverapps.styles.SettingsWindow,{window:{decors:{gears_animation:!0}}}),cleverapps.styles.DECORATORS=cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{PACKWINDOW_LABEL_STROKE:{color:cleverapps.styles.COLORS.COLOR_BROWN,size:3}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{PACK_TITLE:{size:90,lineHeight:10,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.PACKWINDOW_LABEL_STROKE},
PACK_LABELS:{size:50,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.PACKWINDOW_LABEL_STROKE}}),cleverapps.overrideStyles(cleverapps.styles.PackWindow,{width:440,height:850,onShow:PackWindow.fadeInOnShow,Title:{fitTo:{width:360,height:70},dx:11,dy:320,font:cleverapps.styles.FONTS.PACK_TITLE,delay:.5},discountLabel:{dx:314,dy:15,text:"-70%",font:cleverapps.styles.FONTS.TILE_SHOP_WINDOW_TITLE_TEXT,fontSize:58,delay:2.1},animation:{default:{idleDelay:-.5,dx:40,dy:0},starterPack0:{idleAnimation:"0_idle",introAnimation:"0_start"},starterPack:{idleAnimation:"1_idle",introAnimation:"1_start"},starterPack2:{idleAnimation:"2_idle",introAnimation:"2_start"}},button:{priceAlignment:-7},rewards:{font:cleverapps.styles.FONTS.PACK_LABELS,lineHeight:50,positions:{default:{boosters:{5:{x:-70,y:111,delay:1.8},6:{x:183,y:69,delay:1.8},7:{x:-195,y:77,delay:1.8}},gold:{x:5,y:-186,delay:1.8},unlimitedLives:{split:!0,x:72,y:123,delay:1.8}}}}}),cleverapps.overrideStyles(
cleverapps.styles.DailyCupRow,{data:{scale:.33}}),cleverapps.styles.BackgroundsWindow.window=void 0,cleverapps.overrideStyles(cleverapps.styles.comicses,{begin:!1}),Simple.prototype.gamePlayed=function(e,t){};var __showProperWindow=Match3Scene.prototype.showProperWindow;Match3Scene.prototype.showProperWindow=function(e){this.game.outcome===GameBase.OUTCOME_VICTORY&&(cleverapps.simple.earnStars(this.stars),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.METHA_LEVEL),cleverapps.playSession.set(cleverapps.EVENTS.METHA_LEVEL,!0)),__showProperWindow.call(this,e)},VictoryWindow.prototype.showStarsComponent=function(){return!0},LevelStartWindow.prototype.showStarsComponent=function(){return!0};var __BackgroundsWindowCreateContent=BackgroundsWindow.prototype.createContent;BackgroundsWindow.prototype.createContent=function(){var e=__BackgroundsWindowCreateContent.call(this);return e.children[1].setVisible(!1),e},"undefined"!=typeof mobileOkReturned&&mobileOkReturned||(
cc.game.onStart=function(){cleverapps.onStart()},cc.game.run());
//# sourceMappingURL=main-115f22be6c.js.map
}.call(this));